import{i as fp,B as hd,F as Zf,A as YL,a as og,C as zL,P as Fe,R as Gr,S as es,T as ts,b as KL,c as Hi,s as dd,d as hT,M as Or,e as dT,f as jn,G as lg,g as XL,h as qL,E as QL,j as JL,I as ZL,k as $L,l as eU,m as tU,p as sU,n as rU,o as cg,q as iU,r as nU,t as jo,u as _,v as o,w as g,x as $f,y as em,z as aU,D as ei,H as tm,J as X,K as ha,L as Za,N as oU,O as lU,Q as os,U as cU,V as sm,W as uU,X as _T,Y as ws,Z as hU,_ as dU,$ as _U,a0 as Ma,a1 as Da,a2 as rm,a3 as Qc,a4 as gT,a5 as fT,a6 as mT,a7 as gU,a8 as fU,a9 as ET,aa as mU,ab as EU,ac as pT,ad as Ah,ae as pU,af as IU,ag as TU,ah as IT,ai as ug,aj as RU,ak as OU,al as SU,am as CU,an as AU,ao as im,ap as nm,aq as NU,ar as yU,as as MU,at as mp,au as DU,av as vU,aw as C_,ax as A_,ay as N_,az as bU}from"./vendor-886a9b86.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();class me{static log(...e){this.LOG_DEBUG&&console.log(this.logPrefix(),...e)}static warn(...e){this.LOG_WARN&&console.warn(this.logPrefix(),...e)}static error(...e){this.LOG_ERROR&&console.error(this.logPrefix(),...e)}static events(...e){this.LOG_EVENTS&&console.log(this.logPrefix(),...e)}static packets(...e){this.LOG_PACKETS&&console.log(this.logPrefix(),...e)}static logPrefix(){return"[Nitro]"}}me.LOG_DEBUG=!1;me.LOG_WARN=!1;me.LOG_ERROR=!1;me.LOG_EVENTS=!1;me.LOG_PACKETS=!1;class Zt{constructor(e=null){if(this._length=0,this._dictionary=new Map,this._array=[],this._keys=[],e)for(const[t,s]of e.entries())this.add(t,s)}get length(){return this._length}get disposed(){return!this._dictionary}dispose(){if(!this._dictionary){for(const e of this._dictionary.keys())this._dictionary.delete(e);this._dictionary=null}this._length=0,this._array=null,this._keys=null}reset(){for(const e of this._dictionary.keys())this._dictionary.delete(e);this._length=0,this._array=[],this._keys=[]}unshift(e,t){return this._dictionary.get(e)!==null?!1:(this._dictionary.set(e,t),this._array.unshift(t),this._keys.unshift(e),this._length++,!0)}add(e,t){return this._dictionary.get(e)!==void 0?!1:(this._dictionary.set(e,t),this._array[this._length]=t,this._keys[this._length]=e,this._length++,!0)}remove(e){const t=this._dictionary.get(e);if(!t)return null;const s=this._array.indexOf(t);return s>=0&&(this._array.splice(s,1),this._keys.splice(s,1),this._length--),this._dictionary.delete(e),t}getWithIndex(e){return e<0||e>=this._length?null:this._array[e]}getKey(e){return e<0||e>=this._length?null:this._keys[e]}getKeys(){return this._keys.slice()}hasKey(e){return this._keys.indexOf(e)>-1}getValue(e){return this._dictionary.get(e)}getValues(){return this._array.slice()}hasValue(e){return this._array.indexOf(e)>-1}indexOf(e){return this._array.indexOf(e)}concatenate(e){for(const t of e._keys)this.add(t,e.getValue(t))}clone(){const e=new Zt;return e.concatenate(this),e}}const TT=n=>{let e="";const t=new Uint8Array(n),s=t.byteLength;for(let r=0;r<s;r++)e+=String.fromCharCode(t[r]);return window.btoa(e)};class _d{constructor(e){this._position=0,this._dataView=new DataView(e)}readBytes(e){const t=new _d(this._dataView.buffer.slice(this._position,this._position+e));return this._position+=e,t}readByte(){const e=this._dataView.getInt8(this._position);return this._position++,e}readShort(){const e=this._dataView.getInt16(this._position);return this._position+=2,e}readInt(){const e=this._dataView.getInt32(this._position);return this._position+=4,e}readFloat(){const e=this._dataView.getFloat32(this._position);return this._position+=4,e}readDouble(){const e=this._dataView.getFloat64(this._position);return this._position+=8,e}remaining(){return this._dataView.byteLength-this._position}toString(e){return new TextDecoder().decode(this._dataView.buffer)}toArrayBuffer(){return this._dataView.buffer}}class Ep{constructor(){this._buffer=new Uint8Array,this._position=0}writeByte(e){const t=new Uint8Array(1);return t[0]=e,this.appendArray(t),this}writeBytes(e){const t=new Uint8Array(e);return this.appendArray(t),this}writeShort(e){const t=new Uint8Array(2);return t[0]=e>>8,t[1]=e&255,this.appendArray(t),this}writeInt(e){const t=new Uint8Array(4);return t[0]=e>>24,t[1]=e>>16,t[2]=e>>8,t[3]=e&255,this.appendArray(t),this}writeString(e,t=!0){const s=new TextEncoder().encode(e);return t?(this.writeShort(s.length),this.appendArray(s)):this.appendArray(s),this}appendArray(e){if(!e)return;const t=new Uint8Array(this.position+e.length>this._buffer.length?this.position+e.length:this._buffer.length);t.set(this._buffer),t.set(e,this.position),this._buffer=t,this.position+=e.length}getBuffer(){return this._buffer.buffer}get position(){return this._position}set position(e){this._position=e}toString(e){return new TextDecoder(e).decode(this._buffer)}}const RT=class OT{constructor(e){this._jsonFile=null,this._image=null,this._imageData=null,this._baseTexture=null,this.parse(e)}parse(e){const t=new _d(e);let s=t.readShort();for(;s>0;){const r=t.readShort(),i=t.readBytes(r).toString(),a=t.readInt(),l=t.readBytes(a);if(i.endsWith(".json")){const c=fp(l.toArrayBuffer());this._jsonFile=JSON.parse(OT.TEXT_DECODER.decode(c))}else{const c=fp(l.toArrayBuffer()),u=TT(c);this._baseTexture=new hd("data:image/png;base64,"+u)}s--}}get jsonFile(){return this._jsonFile}get baseTexture(){return this._baseTexture}};RT.TEXT_DECODER=new TextDecoder("utf-8");let ST=RT;class CT extends Zf{constructor(e){super(`attribute vec2 aVertexPosition;
            attribute vec2 aTextureCoord;
            
            uniform mat3 projectionMatrix;
            
            varying vec2 vTextureCoord;
            
            void main(void)
            {
                gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
                vTextureCoord = aTextureCoord;
            }`,`varying vec2 vTextureCoord;
            uniform sampler2D uSampler;
            
            uniform float gamma;
            uniform float contrast;
            uniform float saturation;
            uniform float brightness;
            uniform float red;
            uniform float green;
            uniform float blue;
            uniform float alpha;
            
            void main(void)
            {
                vec4 c = texture2D(uSampler, vTextureCoord);
            
                if (c.a > 0.0) {
                    c.rgb /= c.a;
            
                    vec3 rgb = pow(c.rgb, vec3(1. / gamma));
                    rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);
                    rgb.r *= red;
                    rgb.g *= green;
                    rgb.b *= blue;
                    c.rgb = rgb * brightness;
            
                    c.rgb *= c.a;
                }
            
                gl_FragColor = c * alpha;
            }`),this.gamma=1,this.saturation=1,this.contrast=1,this.brightness=1,this.red=1,this.green=1,this.blue=1,this.alpha=1,Object.assign(this,e)}apply(e,t,s,r){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,e.applyFilter(this,t,s,r)}}const PU=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
uniform mat3 projectionMatrix;
varying vec2 vTextureCoord;
void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,LU=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform sampler2D mask;
uniform int fromChannel;
uniform int toChannel;

void main(void) {
    vec4 maskColor = texture2D(mask, vTextureCoord);
    vec4 currentColor = texture2D(uSampler, vTextureCoord);
    vec4 adjusted = currentColor;

    if(maskColor.r == 0.0 && maskColor.g == 0.0 && maskColor.b == 0.0)
    {
        adjusted.a = 0.0;
    }

    gl_FragColor = vec4(adjusted.r, adjusted.g, adjusted.b, adjusted.a);
}`;class gd extends Zf{constructor(e,t,s){super(PU,LU,{mask:e.castToBaseTexture(),fromChannel:t,toChannel:s})}}gd.CHANNEL_RED=0;gd.CHANNEL_GREEN=1;gd.CHANNEL_BLUE=2;gd.CHANNEL_ALPHA=3;const AT=class hg extends YL{constructor(e){super(e),hg.INSTANCE||(hg.INSTANCE=this)}static get instance(){return this.INSTANCE||null}};AT.INSTANCE=null;let Us=AT;const qs=()=>{var n;return((n=Us.instance)==null?void 0:n.ticker)||null},UU=()=>{var n;return((n=qs())==null?void 0:n.FPS)||0},ve=()=>{var n;return((n=qs())==null?void 0:n.lastTime)||0};class FU extends og{}class xU extends hd{}class di extends zL{}class NT extends Zf{}class Ii extends Fe{}class yT extends Gr{}class jt extends es{}class am extends ts{}class wU extends KL{}const GU=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
uniform mat3 projectionMatrix;
varying vec2 vTextureCoord;
void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,BU=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform sampler2D lut;
uniform int channel;

void main(void) {
    vec4 currentColor = texture2D(uSampler, vTextureCoord);
    vec4 adjusted = currentColor;

    if(currentColor.a > 0.0)
    {
        if(channel == 0)
        {
            adjusted = texture2D(lut, vec2((currentColor.r * 255.0 + 0.5) / 256.0, 0.5));
        } else if(channel == 1) {
            adjusted = texture2D(lut, vec2((currentColor.g * 255.0 + 0.5) / 256.0, 0.5));
        } else if(channel == 2) {
            adjusted = texture2D(lut, vec2((currentColor.b * 255.0 + 0.5) / 256.0, 0.5));
        } else if(channel == 3) {
            adjusted = texture2D(lut, vec2((currentColor.a * 255.0 + 0.5) / 256.0, 0.5));
        }
    }

    gl_FragColor = vec4(adjusted.r, adjusted.g, adjusted.b, currentColor.a);
}`,Jc=class Xo extends NT{constructor(e,t=Xo.CHANNEL_RED){super(GU,BU),this._channel=t;let s=[];s=this.getLutForPalette(e),this._lut=xU.fromBuffer(Uint8Array.from(s),s.length/4,1,{mipmap:0,scaleMode:0}),this.uniforms.lut=this._lut,this.uniforms.channel=this._channel}getLutForPalette(e){const t=[];for(let s=0;s<e.length;s++)t[s*4+Xo.CHANNEL_RED]=e[s]>>16&255,t[s*4+Xo.CHANNEL_GREEN]=e[s]>>8&255,t[s*4+Xo.CHANNEL_BLUE]=e[s]&255,t[s*4+Xo.CHANNEL_ALPHA]=e[s]>>24&255;return t}get lut(){return this._lut}get channel(){return this._channel}};Jc.CHANNEL_RED=0;Jc.CHANNEL_GREEN=1;Jc.CHANNEL_BLUE=2;Jc.CHANNEL_ALPHA=3;let pp=Jc;const MT=class DT{constructor(){this.RENDER_TEXTURE_POOL=new Map,this.RENDER_TEXTURE_CACHE=[]}clearCache(){this.RENDER_TEXTURE_POOL.forEach(e=>e==null?void 0:e.destroy(!0)),this.RENDER_TEXTURE_POOL.clear(),this.RENDER_TEXTURE_CACHE=[]}clearRenderTexture(e){return e?this.writeToRenderTexture(new es(ts.EMPTY),e):null}getTextureIdentifier(e,t,s){return`${s??DT.DEFAULT_PLANE_ID}:${e}:${t}`}createRenderTexture(e,t,s=null){if(e<0||t<0)return null;if(!s){const i=Hi.create({width:e,height:t});return this.RENDER_TEXTURE_CACHE.push(i),i}s=this.getTextureIdentifier(e,t,s);let r=this.RENDER_TEXTURE_POOL.get(s);return r||(r=Hi.create({width:e,height:t}),this.RENDER_TEXTURE_CACHE.push(r),this.RENDER_TEXTURE_POOL.set(s,r)),r}createAndFillRenderTexture(e,t,s=null,r=16777215){if(e<0||t<0)return null;const i=this.createRenderTexture(e,t,s);return this.clearAndFillRenderTexture(i,r)}createAndWriteRenderTexture(e,t,s,r=null,i=null){if(e<0||t<0)return null;const a=this.createRenderTexture(e,t,r);return this.writeToRenderTexture(s,a,!0,i)}clearAndFillRenderTexture(e,t=16777215){if(!e)return null;const s=new es(ts.WHITE);return s.tint=t,s.width=e.width,s.height=e.height,this.writeToRenderTexture(s,e)}writeToRenderTexture(e,t,s=!0,r=null){return!e||!t?null:(this.getRenderer().render(e,{renderTexture:t,clear:s,transform:r}),t)}getPixels(e,t=null){return this.getExtractor().pixels(e)}getRenderer(){return Us.instance.renderer}getExtractor(){return this.getRenderer().plugins.extract}};MT.DEFAULT_PLANE_ID="DEFAULT";let kU=MT;class ht{static generateTexture(e,t=null,s=null,r=1){return e?(s===null&&(s=dd.SCALE_MODE),this.getRenderer().generateTexture(e,{scaleMode:s,resolution:r,region:t})):null}static generateTextureFromImage(e){return e?ts.from(e):null}static generateImage(e){return e?this.getExtractor().image(e):null}static generateImageUrl(e){return e?this.getExtractor().base64(e):null}static generateCanvas(e){return e?this.getExtractor().canvas(e):null}static clearRenderTexture(e){return e?this.writeToRenderTexture(new es(ts.EMPTY),e):null}static createRenderTexture(e,t){return e<0||t<0?null:Hi.create({width:e,height:t})}static createAndFillRenderTexture(e,t,s=16777215){if(e<0||t<0)return null;const r=this.createRenderTexture(e,t);return this.clearAndFillRenderTexture(r,s)}static createAndWriteRenderTexture(e,t,s,r=null){if(e<0||t<0)return null;const i=this.createRenderTexture(e,t);return this.writeToRenderTexture(s,i,!0,r)}static clearAndFillRenderTexture(e,t=16777215){if(!e)return null;const s=new es(ts.WHITE);return s.tint=t,s.width=e.width,s.height=e.height,this.writeToRenderTexture(s,e)}static writeToRenderTexture(e,t,s=!0,r=null){return!e||!t?null:(this.getRenderer().render(e,{renderTexture:t,clear:s,transform:r}),t)}static getPixels(e,t=null){return this.getExtractor().pixels(e)}static getRenderer(){return Us.instance.renderer}static getExtractor(){return this.getRenderer().plugins.extract}}const vT=class hc{static createAsset(e,t,s,r,i,a=!1,l=!1,c=!1){const u=hc.GRAPHIC_POOL.length?hc.GRAPHIC_POOL.pop():new hc;return u._name=e,u._source=t||null,s?(u._texture=s,u._initialized=!1):(u._texture=null,u._initialized=!0),u._usesPalette=c,u._x=r,u._y=i,u._flipH=a,u._flipV=l,u._rectangle=null,u}recycle(){this._texture=null,hc.GRAPHIC_POOL.push(this)}initialize(){this._initialized||!this._texture||(this._width=this._texture.width,this._height=this._texture.height,this._initialized=!0)}getImageUrl(){return ht.generateImageUrl(new es(this._texture))}get name(){return this._name}get source(){return this._source}get texture(){return this._texture}get usesPalette(){return this._usesPalette}get x(){return this._x}get y(){return this._y}get width(){return this.initialize(),this._width}get height(){return this.initialize(),this._height}get offsetX(){return this._flipH?-this._x:this._x}get offsetY(){return this._flipV?-this._y:this._y}get flipH(){return this._flipH}get flipV(){return this._flipV}get rectangle(){return this._rectangle||(this._rectangle=new Gr(0,0,this.width,this.height)),this._rectangle}};vT.GRAPHIC_POOL=[];let VU=vT;class HU{constructor(e,t,s){for(this._palette=e;this._palette.length<256;)this._palette.push([0,0,0]);this._primaryColor=t,this._secondaryColor=s}dispose(){}applyPalette(e){var a,l;const t=ht.createAndWriteRenderTexture(e.width,e.height,new es(e)),s=ht.getPixels(t);for(let c=0;c<s.length;c+=4){let u=this._palette[s[c+1]];u===void 0&&(u=[0,0,0]),s[c]=u[0],s[c+1]=u[1],s[c+2]=u[2]}const r=(a=t.baseTexture._glTextures[1])==null?void 0:a.texture,i=(l=Us.instance.renderer)==null?void 0:l.gl;return i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,s),i.bindTexture(i.TEXTURE_2D,null),t}get primaryColor(){return this._primaryColor}get secondaryColor(){return this._secondaryColor}}const bT=class dg{constructor(e,t){if(!e)throw new Error("invalid_collection");this._name=e.name,this._baseTexture=t&&t.baseTexture||null,this._data=e,this._textures=new Map,this._assets=new Map,this._palettes=new Map,this._paletteAssetNames=[],t&&this.addLibraryAsset(t.textures),this.define(e)}static removeFileExtension(e){return e.substring(0,e.lastIndexOf("."))||e}dispose(){if(this._palettes){for(const e of this._palettes.values())e.dispose();this._palettes.clear()}if(this._paletteAssetNames&&(this.disposePaletteAssets(),this._paletteAssetNames=null),this._assets){for(const e of this._assets.values())e.recycle();this._assets.clear()}}addReference(){this._referenceCount++,this._referenceTimestamp=ve()}removeReference(){this._referenceCount--,this._referenceCount<=0&&(this._referenceCount=0,this._referenceTimestamp=ve(),this.disposePaletteAssets(!1))}define(e){const t=e.assets,s=e.palettes;t&&this.defineAssets(t),s&&this.definePalettes(s)}defineAssets(e){if(e)for(const t in e){const s=e[t];if(!s)continue;const r=-s.x||0,i=-s.y||0;let a=!1;const l=!1,c=s.usesPalette||!1;let u=s.source||"";s.flipH&&u.length&&(a=!0),u.length||(u=t);const h=this.getLibraryAsset(u);if(!h)continue;let d=this.createAsset(t,u,h,a,l,r,i,c);if(!d){const f=this.getAsset(t);f&&f.name!==f.source&&(d=this.replaceAsset(t,u,h,a,l,r,i,c))}}}definePalettes(e){if(e)for(const t in e){const s=e[t];if(!s)continue;const r=s.id.toString();if(this._palettes.get(r))continue;let i=16777215,a=16777215,l=s.color1;l&&l.length>0&&(i=parseInt(l,16)),l=s.color2,l&&l.length>0&&(a=parseInt(l,16)),this._palettes.set(r,new HU(s.rgb,i,a))}}createAsset(e,t,s,r,i,a,l,c){if(this._assets.get(e))return!1;const u=VU.createAsset(e,t,s,a,l,r,i,c);return this._assets.set(e,u),!0}replaceAsset(e,t,s,r,i,a,l,c){const u=this._assets.get(e);return u&&(this._assets.delete(e),u.recycle()),this.createAsset(e,t,s,r,i,a,l,c)}getAsset(e){if(!e)return null;const t=this._assets.get(e);return t||null}getAssetWithPalette(e,t){const s=e+"@"+t;let r=this.getAsset(s);if(!r){if(r=this.getAsset(e),!r||!r.usesPalette)return r;const i=this.getPalette(t);if(i){const a=i.applyPalette(r.texture);a&&(this._paletteAssetNames.push(s),this.createAsset(s,r.source+"@"+t,a,r.flipH,r.flipV,r.x,r.y,!1),r=this.getAsset(s))}}return r}getTexture(e){return this._textures.get(e)}getPaletteNames(){return Array.from(this._palettes.keys())}getPaletteColors(e){const t=this.getPalette(e);return t?[t.primaryColor,t.secondaryColor]:null}getPalette(e){if(!e)return null;const t=this._palettes.get(e);return t||null}addAsset(e,t,s,r=0,i=0,a=!1,l=!1){if(!e||!t)return!1;const c=this.getLibraryAsset(e);return c?s?(c.baseTexture=t.baseTexture,c.frame=t.frame,c.trim=t.trim,c.updateUvs(),!0):!1:(this._textures.set(e,t),this.createAsset(e,e,t,a,l,r,i,!1))}disposeAsset(e){const t=this._assets.get(e);if(!t)return;this._assets.delete(e);const s=this.getLibraryAsset(t.source);s&&(this._textures.delete(t.source),s.destroy(!0)),t.recycle()}getLibraryAsset(e){if(!e)return null;e=this._name+"_"+e;const t=this._textures.get(e);return t||null}addLibraryAsset(e){if(e)for(const t in e){const s=e[t];s&&this._textures.set(dg.removeFileExtension(t),s)}}disposePaletteAssets(e=!0){if(this._paletteAssetNames&&(e||this._paletteAssetNames.length>dg.PALETTE_ASSET_DISPOSE_THRESHOLD)){for(const t of this._paletteAssetNames)this.disposeAsset(t);this._paletteAssetNames=[]}}get referenceCount(){return this._referenceCount}get referenceTimestamp(){return this._referenceTimestamp}get name(){return this._name}get baseTexture(){return this._baseTexture}get data(){return this._data}get textures(){return this._textures}get assets(){return this._assets}};bT.PALETTE_ASSET_DISPOSE_THRESHOLD=10;let PT=bT;const _g=class{constructor(){this._textures=new Map,this._collections=new Map}getTexture(e){if(!e)return null;const t=this._textures.get(e);return t||null}setTexture(e,t){!e||!t||this._textures.set(e,t)}getAsset(e){if(!e)return null;for(const t of this._collections.values()){if(!t)continue;const s=t.getAsset(e);if(s)return s}return null}getCollection(e){if(!e)return null;const t=this._collections.get(e);return t||null}createCollection(e,t){if(!e)return null;const s=new PT(e,t);if(s){for(const[r,i]of s.textures.entries())this.setTexture(r,i);this._collections.set(s.name,s)}return s}async downloadAsset(e){return await this.downloadAssets([e])}async downloadAssets(e){if(!e||!e.length)return Promise.resolve(!0);try{for(const t of e){const s=await fetch(t);if(s.status!==200)continue;let r="application/octet-stream";switch(s.headers.has("Content-Type")&&(r=s.headers.get("Content-Type")),r){case"application/octet-stream":{const i=await s.arrayBuffer(),a=new ST(i);await this.processAsset(a.baseTexture,a.jsonFile);break}case"image/png":case"image/jpeg":case"image/gif":{const i=await s.arrayBuffer(),a=TT(i),l=hd.from(`data:${r};base64,${a}`),c=async()=>{const u=new ts(l);this.setTexture(t,u)};l.valid?await c():await new Promise((u,h)=>{l.once("update",async()=>(await c(),u()))});break}}}return Promise.resolve(!0)}catch(t){return me.error(t),Promise.resolve(!1)}}async processAsset(e,t){const s=t.spritesheet;if(!e||!s||!Object.keys(s).length){this.createCollection(t,null);return}const r=async()=>{const i=new hT(e,s);await i.parse(),this.createCollection(t,i)};e.valid?await r():await new Promise((i,a)=>{e.once("update",async()=>(await r(),i()))})}get collections(){return this._collections}};_g._INSTANCE=new _g;let jU=_g;const Fr=()=>jU._INSTANCE;class WU{constructor(e,t,s){this.name=e,this.textures=t,this.durations=s}}class om{}om.UNKNOWN=0;om.BROWSER=1;class fd{}fd.UNKNOWN=0;fd.FLASH=1;fd.HTML5=2;class oi{}oi.CONNECTION_OPENED="open";oi.CONNECTION_CLOSED="close";oi.CONNECTION_ERROR="error";oi.CONNECTION_MESSAGE="message";class Ue{static parseConfiguration(e,t=!1){if(!e)return!1;try{const s=new RegExp(/\${(.*?)}/g);for(const r in e){let i=e[r];typeof i=="string"&&(i=this.interpolate(i,s)),this._definitions.has(r)?t&&this.setValue(r,i):this.setValue(r,i)}return!0}catch(s){return me.error(s.stack),!1}}static interpolate(e,t=null){t||(t=new RegExp(/\${(.*?)}/g));const s=e.match(t);if(s&&s.length)for(const r of s){const i=this._definitions.get(this.removeInterpolateKey(r));i&&(e=e.replace(r,i))}return e}static removeInterpolateKey(e){return e.replace("${","").replace("}","")}static getValue(e,t=null){let s=this._definitions.get(e);if(s===void 0){if(this._missingKeys.indexOf(e)>=0)return t;this._missingKeys.push(e),me.warn(`Missing configuration key: ${e}`),s=t}return s}static setValue(e,t){const s=e.split(".");let r=this._config;for(let i=0;i<s.length;i++){const a=s[i].toString();if(i!==s.length-1){r[a]||(r[a]={}),r=r[a];continue}r[a]=t}this._definitions.set(e,t)}static get definitions(){return this._definitions}}Ue._definitions=new Map;Ue._config={};Ue._missingKeys=[];const Ie=class so{static getExpressionTimeout(e){switch(e=parseInt(e),e){case 1:return 5e3;case 2:return 1400;case 3:return 2e3;case 4:return 2e3;case 5:return 0;case 6:return 700;case 7:return 2e3;case 8:return 1500;case 9:return 1500;case 10:return 1500;default:return 0}}static getExpressionId(e){return so.EXPRESSION_MAP.indexOf(e)}static getExpression(e){return e>so.EXPRESSION_MAP.length?null:so.EXPRESSION_MAP[e]}static getGestureId(e){return so.GESTURE_MAP.indexOf(e)}static getGesture(e){return e>so.GESTURE_MAP.length?null:so.GESTURE_MAP[e]}static idToAvatarActionState(e){return e==="Lay"?"lay":e==="Float"?"float":e==="Swim"?"swim":e==="Sit"?"sit":e==="Respect"?"respect":e==="Wave"?"wave":e==="Idle"?"idle":e==="Dance"?"dance":e==="UseItem"?"usei":e==="CarryItem"?"cri":e==="Talk"?"talk":e==="Sleep"?"Sleep":e==="Move"?"mv":"std"}};Ie.CARRY_OBJECT="cri";Ie.DANCE="dance";Ie.EFFECT="fx";Ie.EXPRESSION="expression";Ie.EXPRESSION_BLOW_A_KISS="blow";Ie.EXPRESSION_CRY="cry";Ie.EXPRESSION_IDLE="idle";Ie.EXPRESSION_LAUGH="laugh";Ie.EXPRESSION_RESPECT="respect";Ie.EXPRESSION_RIDE_JUMP="ridejump";Ie.EXPRESSION_SNOWBOARD_OLLIE="sbollie";Ie.EXPRESSION_SNOWBORD_360="sb360";Ie.EXPRESSION_WAVE="wave";Ie.GESTURE="gest";Ie.GESTURE_AGGRAVATED="agr";Ie.GESTURE_SAD="sad";Ie.GESTURE_SMILE="sml";Ie.GESTURE_SURPRISED="srp";Ie.GUIDE_STATUS="guide";Ie.MUTED="muted";Ie.PET_GESTURE_BLINK="eyb";Ie.PET_GESTURE_CRAZY="crz";Ie.PET_GESTURE_JOY="joy";Ie.PET_GESTURE_MISERABLE="mis";Ie.PET_GESTURE_PUZZLED="puz";Ie.PET_GESTURE_TONGUE="tng";Ie.PLAYING_GAME="playing_game";Ie.POSTURE="posture";Ie.POSTURE_FLOAT="float";Ie.POSTURE_LAY="lay";Ie.POSTURE_SIT="sit";Ie.POSTURE_STAND="std";Ie.POSTURE_SWIM="swim";Ie.POSTURE_WALK="mv";Ie.SIGN="sign";Ie.SLEEP="sleep";Ie.SNOWWAR_DIE_BACK="swdieback";Ie.SNOWWAR_DIE_FRONT="swdiefront";Ie.SNOWWAR_PICK="swpick";Ie.SNOWWAR_RUN="swrun";Ie.SNOWWAR_THROW="swthrow";Ie.TALK="talk";Ie.BLINK="blink";Ie.TYPING="typing";Ie.USE_OBJECT="usei";Ie.VOTE="vote";Ie.GESTURE_MAP=["",Ie.GESTURE_SMILE,Ie.GESTURE_AGGRAVATED,Ie.GESTURE_SURPRISED,Ie.GESTURE_SAD,Ie.PET_GESTURE_JOY,Ie.PET_GESTURE_CRAZY,Ie.PET_GESTURE_TONGUE,Ie.PET_GESTURE_BLINK,Ie.PET_GESTURE_MISERABLE,Ie.PET_GESTURE_PUZZLED];Ie.EXPRESSION_MAP=["",Ie.EXPRESSION_WAVE,Ie.EXPRESSION_BLOW_A_KISS,Ie.EXPRESSION_LAUGH,Ie.EXPRESSION_CRY,Ie.EXPRESSION_IDLE,Ie.DANCE,Ie.EXPRESSION_RESPECT,Ie.EXPRESSION_SNOWBOARD_OLLIE,Ie.EXPRESSION_SNOWBORD_360,Ie.EXPRESSION_RIDE_JUMP];let fe=Ie;class xr{}xr.DIRECTION_TO_ANGLE=[45,90,135,180,225,270,315,0];xr.DIRECTION_IS_FLIPPED=[!1,!1,!1,!1,!0,!0,!0,!1];xr.MIN_DIRECTION=0;xr.MAX_DIRECTION=7;class ur{}ur.GENERIC="hd";ur.HEAD="head";ur.TORSO="torso";ur.LEGS="legs";ur.HOTLOOKS="hotlooks";ur.WARDROBE="wardrobe";ur.EFFECTS="effects";const rt=class{};rt.BODY="bd";rt.SHOES="sh";rt.LEGS="lg";rt.CHEST="ch";rt.WAIST_ACCESSORY="wa";rt.CHEST_ACCESSORY="ca";rt.HEAD="hd";rt.HAIR="hr";rt.FACE_ACCESSORY="fa";rt.EYE_ACCESSORY="ea";rt.HEAD_ACCESSORY="ha";rt.HEAD_ACCESSORY_EXTRA="he";rt.COAT_CHEST="cc";rt.CHEST_PRINT="cp";rt.LEFT_HAND_ITEM="li";rt.LEFT_HAND="lh";rt.LEFT_SLEEVE="ls";rt.RIGHT_HAND="rh";rt.RIGHT_SLEEVE="rs";rt.FACE="fc";rt.EYES="ey";rt.HAIR_BIG="hrb";rt.RIGHT_HAND_ITEM="ri";rt.LEFT_COAT_SLEEVE="lc";rt.RIGHT_COAT_SLEEVE="rc";rt.FIGURE_SETS=[rt.SHOES,rt.LEGS,rt.CHEST,rt.WAIST_ACCESSORY,rt.CHEST_ACCESSORY,rt.HEAD,rt.HAIR,rt.FACE_ACCESSORY,rt.EYE_ACCESSORY,rt.HEAD_ACCESSORY,rt.HEAD_ACCESSORY_EXTRA,rt.COAT_CHEST,rt.CHEST_PRINT];let qe=rt;class Li{}Li.NONE=0;Li.GUIDE=1;Li.REQUESTER=2;class Xr{}Xr.LARGE="h";Xr.SMALL="sh";class bs{}bs.FULL="full";bs.HEAD="head";bs.BODY="body";class Ui{}Ui.VERTICAL="vertical";Ui.SITTING="sitting";Ui.HORIZONTAL="horizontal";Ui.SWIM="swim";Ui.SNOWWARS_HORIZONTAL="swhorizontal";class be{}be.DOG=0;be.CAT=1;be.CROCODILE=2;be.TERRIER=3;be.BEAR=4;be.PIG=5;be.LION=6;be.RHINO=7;be.SPIDER=8;be.TURTLE=9;be.CHICKEN=10;be.FROG=11;be.DRAGON=12;be.MONSTER=13;be.MONKEY=14;be.HORSE=15;be.MONSTERPLANT=16;be.BUNNY=17;be.BUNNYEVIL=18;be.BUNNYDEPRESSED=19;be.BUNNYLOVE=20;be.PIGEONGOOD=21;be.PIGEONEVIL=22;be.DEMONMONKEY=23;be.BABYBEAR=24;be.BABYTERRIER=25;be.GNOME=26;be.LEPRECHAUN=27;be.KITTENBABY=28;be.PUPPYBABY=29;be.PIGLETNBABY=30;be.HALOOMPA=31;be.FOOLS=32;be.PTEROSAUR=33;be.VELOCIRAPTOR=34;class Xs{}Xs.NONE=0;Xs.HEART=1;Xs.SMILE=2;Xs.BOBBA=3;Xs.RELATIONSHIP_TYPES=[0,1,2,3];Xs.RELATIONSHIP_NAMES=["None","Heart","Smile","Bobba"];class ea{}ea.HOTEL_VIEW="hotel_view";ea.HOME_ROOM="home_room";ea.NAVIGATOR="navigator";ea.CATALOG="catalog";ea.INVENTORY="inventory";ea.ME_MENU="me_menu";ea.FRIEND_LIST="friendlist";class yo{}yo.LOVE_LOCK=0;yo.CARVE_A_TREE=1;yo.FRIENDS_PORTRAIT=2;yo.WILD_WEST_WANTED=3;yo.HABBOWEEN=4;class xa{}xa.CATALOG="catalog";xa.INVENTORY="inventory";class C{}C.OBJECT_ROOM_ID="object_room_id";C.OBJECT_ACCURATE_Z_VALUE="object_accurate_z_value";C.TILE_CURSOR_HEIGHT="tile_cursor_height";C.FIGURE="figure";C.GENDER="gender";C.OWN_USER="own_user";C.FIGURE_CAN_STAND_UP="figure_can_stand_up";C.FIGURE_VERTICAL_OFFSET="figure_vertical_offset";C.FIGURE_TALK="figure_talk";C.FIGURE_DANCE="figure_dance";C.FIGURE_SLEEP="figure_sleep";C.FIGURE_BLINK="figure_blink";C.FIGURE_EFFECT="figure_effect";C.FIGURE_CARRY_OBJECT="figure_carry_object";C.FIGURE_USE_OBJECT="figure_use_object";C.FIGURE_GESTURE="figure_gesture";C.FIGURE_POSTURE="figure_posture";C.FIGURE_POSTURE_PARAMETER="figure_posture_parameter";C.FIGURE_HIGHLIGHT_ENABLE="figure_highlight_enable";C.FIGURE_HIGHLIGHT="figure_highlight";C.FURNITURE_PURCHASER_NAME="furniture_purchaser_name";C.FURNITURE_PURCHASER_FIGURE="furniture_purchaser_figure";C.STD="std";C.FIGURE_SIGN="figure_sign";C.FIGURE_FLAT_CONTROL="figure_flat_control";C.FIGURE_IS_TYPING="figure_is_typing";C.FIGURE_IS_MUTED="figure_is_muted";C.FIGURE_GAINED_EXPERIENCE="figure_gained_experience";C.FIGURE_EXPERIENCE_TIMESTAMP="figure_experience_timestamp";C.FIGURE_NUMBER_VALUE="figure_number_value";C.FIGURE_IS_PLAYING_GAME="figure_is_playing_game";C.FIGURE_GUIDE_STATUS="figure_guide_status";C.FIGURE_EXPRESSION="figure_expression";C.HEAD_DIRECTION="head_direction";C.FURNITURE_CUSTOM_VARIABLES="furniture_custom_variables";C.FURNITURE_AUTOMATIC_STATE_INDEX="furniture_automatic_state_index";C.FURNITURE_ALWAYS_STACKABLE="furniture_always_stackable";C.FURNITURE_DISABLE_PICKING_ANIMATION="furniture_disable_picking_animation";C.FURNITURE_DATA_FORMAT="furniture_data_format";C.FURNITURE_UNIQUE_SERIAL_NUMBER="furniture_unique_serial_number";C.FURNITURE_UNIQUE_EDITION_SIZE="furniture_unique_edition_size";C.FURNITURE_CRACKABLE_STATE="furniture_crackable_state";C.FURNITURE_CRACKABLE_HITS="furniture_crackable_hits";C.FURNITURE_CRACKABLE_TARGET="furniture_crackable_target";C.FURNITURE_CREDIT_VALUE="furniture_credit_value";C.FURNITURE_DATA="furniture_data";C.FURNITURE_ITEMDATA="furniture_itemdata";C.FURNITURE_COLOR="furniture_color";C.FURNITURE_LIFT_AMOUNT="furniure_lift_amount";C.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID="furniture_guild_customized_guild_id";C.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME="furniture_guild_customized_asset_name";C.FURNITURE_GUILD_CUSTOMIZED_COLOR_1="furniture_guild_customized_color_1";C.FURNITURE_GUILD_CUSTOMIZED_COLOR_2="furniture_guild_customized_color_2";C.FURNITURE_STATE_UPDATE_TIME="furniture_state_update_time";C.FURNITURE_SELECTION_DISABLED="furniture_selection_disabled";C.FURNITURE_SIZE_X="furniture_size_x";C.FURNITURE_SIZE_Y="furniture_size_y";C.FURNITURE_SIZE_Z="furniture_size_z";C.FURNITURE_CENTER_X="furniture_center_x";C.FURNITURE_CENTER_Y="furniture_center_y";C.FURNITURE_CENTER_Z="furniture_center_z";C.FURNITURE_ALLOWED_DIRECTIONS="furniture_allowed_directions";C.FURNITURE_AD_URL="furniture_ad_url";C.FURNITURE_TYPE_ID="furniture_type_id";C.FURNITURE_EXTRAS="furniture_extras";C.FURNITURE_EXPIRY_TIME="furniture_expiry_time";C.FURNITURE_EXPIRTY_TIMESTAMP="furniture_expiry_timestamp";C.FURNITURE_REAL_ROOM_OBJECT="furniture_real_room_object";C.FURNITURE_IS_STICKIE="furniture_is_stickie";C.FURNITURE_BRANDING_IMAGE_STATUS="furniture_branding_image_status";C.FURNITURE_BRANDING_IMAGE_URL="furniture_branding_image_url";C.FURNITURE_BRANDING_URL="furniture_branding_url";C.FURNITURE_BRANDING_OFFSET_X="furniture_branding_offset_x";C.FURNITURE_BRANDING_OFFSET_Y="furniture_branding_offset_y";C.FURNITURE_BRANDING_OFFSET_Z="furniture_branding_offset_z";C.FURNITURE_BRANDING_IS_ANIMATED="furniture_branding_is_animated";C.FURNITURE_BADGE_IMAGE_STATUS="furniture_badge_image_status";C.FURNITURE_BADGE_ASSET_NAME="furniture_badge_asset_name";C.FURNITURE_BADGE_VISIBLE_IN_STATE="furniture_badge_visible_in_state";C.FURNITURE_ALPHA_MULTIPLIER="furniture_alpha_multiplier";C.FURNITURE_USAGE_POLICY="furniture_usage_policy";C.FURNITURE_OWNER_ID="furniture_owner_id";C.FURNITURE_OWNER_NAME="furniture_owner_name";C.FURNITURE_ROOM_BACKGROUND_COLOR_HUE="furniture_room_background_color_hue";C.FURNITURE_ROOM_BACKGROUND_COLOR_SATURATION="furniture_room_background_color_saturation";C.FURNITURE_ROOM_BACKGROUND_COLOR_LIGHTNESS="furniture_room_background_color_lightness";C.FURNITURE_USES_PLANE_MASK="furniture_uses_plane_mask";C.FURNITURE_PLANE_MASK_TYPE="furniture_plane_mask_type";C.FURNITURE_IS_VARIABLE_HEIGHT="furniture_is_variable_height";C.FURNITURE_VOTE_MAJORITY_RESULT="furniture_vote_majority_result";C.FURNITURE_VOTE_COUNTER_COUNT="furniture_vote_counter_count";C.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED="furniture_soundblock_relative_animation_speed";C.FURNITURE_MANNEQUIN_NAME="furniture_mannequin_name";C.FURNITURE_MANNEQUIN_GENDER="furniture_mannequin_gender";C.FURNITURE_MANNEQUIN_FIGURE="furniture_mannequin_figure";C.FURNITURE_HIGHSCORE_SCORE_TYPE="furniture_highscore_score_type";C.FURNITURE_HIGHSCORE_CLEAR_TYPE="furniture_highscore_clear_type";C.FURNITURE_HIGHSCORE_DATA_ENTRY_COUNT="furniture_highscore_data_entry_count";C.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_USERS_="furniture_highscore_data_entry_base_users_";C.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_SCORE_="furniture_highscore_data_entry_base_score_";C.FURNITURE_INTERNAL_LINK="furniture_internal_link";C.FURNITURE_CLOTHING_BOY="furniture_clothing_boy";C.FURNITURE_CLOTHING_GIRL="furniture_clothing_girl";C.FURNITURE_PLANETSYSTEM_DATA="furniture_planetsystem_data";C.FURNITURE_FIREWORKS_DATA="furniture_fireworks_data";C.PET_PALETTE_INDEX="pet_palette_index";C.PET_COLOR="pet_color";C.PET_HEAD_ONLY="pet_head_only";C.PET_CUSTOM_LAYER_IDS="pet_custom_layer_ids";C.PET_CUSTOM_PARTS_IDS="pet_custom_part_ids";C.PET_CUSTOM_PALETTE_IDS="pet_custom_palette_ids";C.PET_IS_RIDING="pet_is_riding";C.PET_TYPE="pet_type";C.PET_ALLOWED_DIRECTIONS="pet_allowed_directions";C.RACE="race";C.ROOM_MAP_DATA="room_map_data";C.ROOM_PLANE_MASK_XML="room_plane_mask_xml";C.ROOM_FLOOR_TYPE="room_floor_type";C.ROOM_WALL_TYPE="room_wall_type";C.ROOM_LANDSCAPE_TYPE="room_landscape_type";C.ROOM_WALL_THICKNESS="room_wall_thickness";C.ROOM_FLOOR_THICKNESS="room_floor_thickness";C.ROOM_FLOOR_HOLE_UPDATE_TIME="room_floor_hole_update_time";C.ROOM_FLOOR_VISIBILITY="room_floor_visibility";C.ROOM_WALL_VISIBILITY="room_wall_visibility";C.ROOM_LANDSCAPE_VISIBILITY="room_landscape_visibility";C.ROOM_DOOR_X="room_door_x";C.ROOM_DOOR_Y="room_door_y";C.ROOM_DOOR_Z="room_door_z";C.ROOM_DOOR_DIR="room_door_dir";C.ROOM_BACKGROUND_COLOR="room_background_color";C.ROOM_COLORIZE_BG_ONLY="room_colorize_bg_only";C.ROOM_RANDOM_SEED="room_random_seed";C.ROOM_WORLD_TYPE="room_world_type";C.ROOM_SELECTED_X="room_selected_x";C.ROOM_SELECTED_Y="room_selected_y";C.ROOM_SELECTED_Z="room_selected_z";C.ROOM_SELECTED_PLANE="room_selected_plane";C.IMAGE_QUERY_SCALE="image_query_scale";C.FURNITURE_FRIENDFURNI_ENGRAVING="furniture_friendfurni_engraving_type";C.SESSION_URL_PREFIX="session_url_prefix";C.SESSION_CURRENT_USER_ID="session_current_user_id";class LT{}LT.UNIQUE_SET=256;class Ba{constructor(){this._flags=0,this._uniqueNumber=0,this._uniqueSeries=0}parseWrapper(e){(this._flags&LT.UNIQUE_SET)>0&&(this._uniqueNumber=e.readInt(),this._uniqueSeries=e.readInt())}initializeFromRoomObjectModel(e){this._uniqueNumber=e.getValue(C.FURNITURE_UNIQUE_SERIAL_NUMBER),this._uniqueSeries=e.getValue(C.FURNITURE_UNIQUE_EDITION_SIZE)}writeRoomObjectModel(e){e&&(e.setValue(C.FURNITURE_UNIQUE_SERIAL_NUMBER,this._uniqueNumber),e.setValue(C.FURNITURE_UNIQUE_EDITION_SIZE,this._uniqueSeries))}getLegacyString(){return""}compare(e){return!1}get state(){const e=parseInt(this.getLegacyString());return isNaN(e)?0:e}get isUnique(){return this._uniqueSeries>0}get uniqueNumber(){return this._uniqueNumber}set uniqueNumber(e){this._uniqueNumber=e}get uniqueSeries(){return this._uniqueSeries}set uniqueSeries(e){this._uniqueSeries=e}get rarityLevel(){return-1}get flags(){return this._flags}set flags(e){this._flags=e}}class fr{}fr.LEGACY_KEY=0;fr.MAP_KEY=1;fr.STRING_KEY=2;fr.VOTE_KEY=3;fr.EMPTY_KEY=4;fr.NUMBER_KEY=5;fr.HIGHSCORE_KEY=6;fr.CRACKABLE_KEY=7;const UT=class FT extends Ba{constructor(){super(),this._state="",this._hits=0,this._target=0}parseWrapper(e){e&&(this._state=e.readString(),this._hits=e.readInt(),this._target=e.readInt(),super.parseWrapper(e))}initializeFromRoomObjectModel(e){super.initializeFromRoomObjectModel(e),this._state=e.getValue(C.FURNITURE_CRACKABLE_STATE),this._hits=e.getValue(C.FURNITURE_CRACKABLE_HITS),this._target=e.getValue(C.FURNITURE_CRACKABLE_TARGET)}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,FT.FORMAT_KEY),e.setValue(C.FURNITURE_CRACKABLE_STATE,this._state),e.setValue(C.FURNITURE_CRACKABLE_HITS,this._hits),e.setValue(C.FURNITURE_CRACKABLE_TARGET,this._target)}getLegacyString(){return this._state}compare(e){return!0}get hits(){return this._hits}get target(){return this._target}};UT.FORMAT_KEY=fr.CRACKABLE_KEY;let Ip=UT;const xT=class wT extends Ba{parseWrapper(e){e&&(this._state="",super.parseWrapper(e))}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,wT.FORMAT_KEY)}getLegacyString(){return this._state}compare(e){return super.compare(e)}};xT.FORMAT_KEY=fr.EMPTY_KEY;let Tp=xT;class Rp{constructor(){this._score=-1,this._users=[]}get score(){return this._score}set score(e){this._score=e}get users(){return this._users}set users(e){this._users=e}addUsername(e){this._users.push(e)}}const GT=class BT extends Ba{constructor(){super(),this._state="",this._scoreType=-1,this._clearType=-1,this._entries=[]}parseWrapper(e){if(!e)return;this._state=e.readString(),this._scoreType=e.readInt(),this._clearType=e.readInt();let t=e.readInt();for(;t>0;){const s=new Rp;s.score=e.readInt();let r=e.readInt();for(;r>0;)s.addUsername(e.readString()),r--;this._entries.push(s),t--}super.parseWrapper(e)}initializeFromRoomObjectModel(e){this._scoreType=e.getValue(C.FURNITURE_HIGHSCORE_SCORE_TYPE),this._clearType=e.getValue(C.FURNITURE_HIGHSCORE_CLEAR_TYPE),this._entries=[];const t=e.getValue(C.FURNITURE_HIGHSCORE_DATA_ENTRY_COUNT);let s=0;for(;s<t;){const r=new Rp;r.score=e.getValue(C.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_SCORE_+s),r.users=e.getValue(C.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_USERS_+s),this._entries.push(r),s++}super.initializeFromRoomObjectModel(e)}writeRoomObjectModel(e){if(super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,BT.FORMAT_KEY),e.setValue(C.FURNITURE_HIGHSCORE_SCORE_TYPE,this._scoreType),e.setValue(C.FURNITURE_HIGHSCORE_CLEAR_TYPE,this._clearType),this._entries){e.setValue(C.FURNITURE_HIGHSCORE_DATA_ENTRY_COUNT,this._entries.length);let t=0;for(;t<this._entries.length;){const s=this._entries[t];e.setValue(C.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_SCORE_+t,s.score),e.setValue(C.FURNITURE_HIGHSCORE_DATA_ENTRY_BASE_USERS_+t,s.users),t++}}}getLegacyString(){return this._state}get entries(){return this._entries}get clearType(){return this._clearType}get scoreType(){return this._scoreType}};GT.FORMAT_KEY=fr.HIGHSCORE_KEY;let Op=GT;const kT=class VT extends Ba{constructor(){super(),this._data=""}parseWrapper(e){e&&(this._data=e.readString(),super.parseWrapper(e))}initializeFromRoomObjectModel(e){super.initializeFromRoomObjectModel(e),this._data=e.getValue(C.FURNITURE_DATA)}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,VT.FORMAT_KEY),e.setValue(C.FURNITURE_DATA,this._data)}getLegacyString(){return this._data}compare(e){return this._data===e.getLegacyString()}setString(e){this._data=e}};kT.FORMAT_KEY=fr.LEGACY_KEY;let Br=kT;const md=class rh extends Ba{constructor(){super(),this._data={}}parseWrapper(e){if(!e)return;this._data={};const t=e.readInt();if(t)for(let s=0;s<t;s++)this._data[e.readString()]=e.readString();super.parseWrapper(e)}initializeFromRoomObjectModel(e){super.initializeFromRoomObjectModel(e),this._data=e.getValue(C.FURNITURE_DATA)||{}}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,rh.FORMAT_KEY),e.setValue(C.FURNITURE_DATA,this._data)}getLegacyString(){if(!this._data)return"";const e=this._data[rh.STATE];return e??""}compare(e){return!1}getValue(e){return this._data[e]}get rarityLevel(){if(!this._data)return-1;const e=this._data[rh.RARITY];return e==null?-1:parseInt(e)}get data(){return this._data}};md.FORMAT_KEY=fr.MAP_KEY;md.STATE="state";md.RARITY="rarity";let Uc=md;const lm=class ih extends Ba{constructor(){super(),this._data=[]}parseWrapper(e){if(!e)return;this._data=[];const t=e.readInt();if(t)for(let s=0;s<t;s++)this._data.push(e.readInt());super.parseWrapper(e)}initializeFromRoomObjectModel(e){super.initializeFromRoomObjectModel(e),this._data=e.getValue(C.FURNITURE_DATA)}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,ih.FORMAT_KEY),e.setValue(C.FURNITURE_DATA,this._data)}getLegacyString(){return!this._data||!this._data.length?"":this._data[ih.STATE].toString()}compare(e){if(!(e instanceof ih))return!1;let t=0;for(;t<this._data.length;){if(t!==0){if(this._data[t]!==e.getValue(t))return!1}t++}return!0}getValue(e){if(!this._data||!this._data.length)return-1;const t=this._data[e];return t??-1}};lm.FORMAT_KEY=fr.NUMBER_KEY;lm.STATE=0;let gg=lm;const cm=class nh extends Ba{constructor(){super(),this._data=[]}parseWrapper(e){if(!e)return;this._data=[];const t=e.readInt();if(t)for(let s=0;s<t;s++)this._data.push(e.readString());super.parseWrapper(e)}initializeFromRoomObjectModel(e){super.initializeFromRoomObjectModel(e),this._data=e.getValue(C.FURNITURE_DATA)}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,nh.FORMAT_KEY),e.setValue(C.FURNITURE_DATA,this._data)}getLegacyString(){return!this._data||!this._data.length?"":this._data[nh.STATE]}compare(e){if(!(e instanceof nh))return!1;let t=0;for(;t<this._data.length;){if(t!==0){if(this._data[t]!==e.getValue(t))return!1}t++}return!0}getValue(e){return this._data[e]||""}setValue(e){this._data=e}};cm.FORMAT_KEY=fr.STRING_KEY;cm.STATE=0;let ta=cm;const HT=class jT extends Ba{constructor(){super(),this._state="",this._result=0}parseWrapper(e){e&&(this._state=e.readString(),this._result=e.readInt(),super.parseWrapper(e))}writeRoomObjectModel(e){super.writeRoomObjectModel(e),e.setValue(C.FURNITURE_DATA_FORMAT,jT.FORMAT_KEY);const t={};t.S=this._state,t.R=this._result.toString(),e.setValue(C.FURNITURE_DATA,t)}getLegacyString(){return this._state}compare(e){return!0}setString(e){this._state=e}get result(){return this._result}};HT.FORMAT_KEY=fr.VOTE_KEY;let fg=HT;class un{static getData(e){let t=null;switch(e&255){case Ip.FORMAT_KEY:t=new Ip;break;case Tp.FORMAT_KEY:t=new Tp;break;case Op.FORMAT_KEY:t=new Op;break;case Br.FORMAT_KEY:t=new Br;break;case Uc.FORMAT_KEY:t=new Uc;break;case gg.FORMAT_KEY:t=new gg;break;case ta.FORMAT_KEY:t=new ta;break;case fg.FORMAT_KEY:t=new fg;break}return t?(t.flags=e&65280,t):null}}class k{}k.MINIMUM=-2;k.ROOM=0;k.FLOOR=10;k.WALL=20;k.UNIT=100;k.CURSOR=200;class Z{}Z.FURNITURE_BASIC="furniture_basic";Z.FURNITURE_MULTISTATE="furniture_multistate";Z.FURNITURE_MULTIHEIGHT="furniture_multiheight";Z.FURNITURE_RANDOMSTATE="furniture_randomstate";Z.FURNITURE_PLACEHOLDER="furniture_placeholder";Z.FURNITURE_CREDIT="furniture_credit";Z.FURNITURE_STICKIE="furniture_stickie";Z.FURNITURE_PRESENT="furniture_present";Z.FURNITURE_TROPHY="furniture_trophy";Z.FURNITURE_ECOTRON_BOX="furniture_ecotron_box";Z.FURNITURE_DICE="furniture_dice";Z.FURNITURE_HOCKEY_SCORE="furniture_hockey_score";Z.FURNITURE_HABBOWHEEL="furniture_habbowheel";Z.FURNITURE_ONE_WAY_DOOR="furniture_one_way_door";Z.FURNITURE_PLANET_SYSTEM="furniture_planet_system";Z.FURNITURE_WINDOW="furniture_window";Z.FURNITURE_EXTERNAL_IMAGE_WALLITEM="furniture_external_image_wallitem";Z.FURNITURE_ROOMDIMMER="furniture_roomdimmer";Z.FURNITURE_SOUND_MACHINE="furniture_sound_machine";Z.FURNITURE_JUKEBOX="furniture_jukebox";Z.FURNITURE_CRACKABLE="furniture_crackable";Z.FURNITURE_PUSHABLE="furniture_pushable";Z.FURNITURE_CLOTHING_CHANGE="furniture_clothing_change";Z.FURNITURE_COUNTER_CLOCK="furniture_counter_clock";Z.FURNITURE_SCORE="furniture_score";Z.FURNITURE_ES="furniture_es";Z.FURNITURE_FIREWORKS="furniture_fireworks";Z.FURNITURE_SONG_DISK="furniture_song_disk";Z.FURNITURE_BB="furniture_bb";Z.FURNITURE_BG="furniture_bg";Z.FURNITURE_WELCOME_GIFT="furniture_welcome_gift";Z.FURNITURE_FLOOR_HOLE="furniture_floor_hole";Z.FURNITURE_MANNEQUIN="furniture_mannequin";Z.FURNITURE_GUILD_CUSTOMIZED="furniture_guild_customized";Z.FURNITURE_GROUP_FORUM_TERMINAL="furniture_group_forum_terminal";Z.FURNITURE_PET_CUSTOMIZATION="furniture_pet_customization";Z.FURNITURE_CUCKOO_CLOCK="furniture_cuckoo_clock";Z.FURNITURE_VOTE_COUNTER="furniture_vote_counter";Z.FURNITURE_VOTE_MAJORITY="furniture_vote_majority";Z.FURNITURE_SOUNDBLOCK="furniture_soundblock";Z.FURNITURE_RANDOM_TELEPORT="furniture_random_teleport";Z.FURNITURE_MONSTERPLANT_SEED="furniture_monsterplant_seed";Z.FURNITURE_PURCHASABLE_CLOTHING="furniture_purchasable_clothing";Z.FURNITURE_BACKGROUND_COLOR="furniture_background_color";Z.FURNITURE_MYSTERYBOX="furniture_mysterybox";Z.FURNITURE_EFFECTBOX="furniture_effectbox";Z.FURNITURE_MYSTERYTROPHY="furniture_mysterytrophy";Z.FURNITURE_ACHIEVEMENT_RESOLUTION="furniture_achievement_resolution";Z.FURNITURE_LOVELOCK="furniture_lovelock";Z.FURNITURE_WILDWEST_WANTED="furniture_wildwest_wanted";Z.FURNITURE_HWEEN_LOVELOCK="furniture_hween_lovelock";Z.FURNITURE_BADGE_DISPLAY="furniture_badge_display";Z.FURNITURE_HIGH_SCORE="furniture_high_score";Z.FURNITURE_INTERNAL_LINK="furniture_internal_link";Z.FURNITURE_CUSTOM_STACK_HEIGHT="furniture_custom_stack_height";Z.FURNITURE_YOUTUBE="furniture_youtube";Z.FURNITURE_RENTABLE_SPACE="furniture_rentable_space";Z.FURNITURE_CHANGE_STATE_WHEN_STEP_ON="furniture_change_state_when_step_on";Z.FURNITURE_VIMEO="furniture_vimeo";Z.FURNITURE_EDITABLE_INTERNAL_LINK="furniture_editable_internal_link";Z.FURNITURE_EDITABLE_ROOM_LINK="furniture_editable_room_link";Z.FURNITURE_CRAFTING_GIZMO="furniture_crafting_gizmo";Z.ROOM="room";Z.USER="user";Z.BOT="bot";Z.RENTABLE_BOT="rentable_bot";Z.PET="pet";Z.TILE_CURSOR="tile_cursor";Z.SELECTION_ARROW="selection_arrow";Z.GAME_SNOWBALL="game_snowball";Z.GAME_SNOWSPLASH="game_snowsplash";class ye{}ye.OBJECT_UNDEFINED="OBJECT_UNDEFINED";ye.OBJECT_MOVE="OBJECT_MOVE";ye.OBJECT_PLACE="OBJECT_PLACE";ye.OBJECT_ROTATE_POSITIVE="OBJECT_ROTATE_POSITIVE";ye.OBJECT_ROTATE_NEGATIVE="OBJECT_ROTATE_NEGATIVE";ye.OBJECT_MOVE_TO="OBJECT_MOVE_TO";ye.OBJECT_PLACE_TO="OBJECT_PLACE_TO";ye.OBJECT_PICKUP="OBJECT_PICKUP";ye.OBJECT_PICKUP_BOT="OBJECT_PICKUP_BOT";ye.OBJECT_PICKUP_PET="OBJECT_PICKUP_PET";ye.OBJECT_EJECT="OBJECT_EJECT";ye.OBJECT_SAVE_STUFF_DATA="OBJECT_SAVE_STUFF_DATA";class Rt{}Rt.USER=1;Rt.PET=2;Rt.BOT=3;Rt.RENTABLE_BOT=4;const Mo=class ro{static getTypeNumber(e){return ro.AVATAR_TYPES[e]}static getTypeString(e){for(const t in ro.AVATAR_TYPES)if(t&&ro.AVATAR_TYPES[t]===e)return t;return null}static getRealType(e){switch(e){case ro.BOT:case ro.RENTABLE_BOT:return ro.USER;default:return e}}};Mo.USER="user";Mo.PET="pet";Mo.BOT="bot";Mo.RENTABLE_BOT="rentable_bot";Mo.MONSTER_PLANT="monsterplant";Mo.AVATAR_TYPES={user:1,pet:2,bot:3,rentable_bot:4};let ft=Mo;class re{}re.FURNITURE_STATIC="furniture_static";re.FURNITURE_ANIMATED="furniture_animated";re.FURNITURE_RESETTING_ANIMATED="furniture_resetting_animated";re.FURNITURE_POSTER="furniture_poster";re.FURNITURE_EXTERNAL_IMAGE="furniture_external_image";re.FURNITURE_HABBOWHEEL="furniture_habbowheel";re.FURNITURE_VAL_RANDOMIZER="furniture_val_randomizer";re.FURNITURE_BOTTLE="furniture_bottle";re.FURNITURE_PLANET_SYSTEM="furniture_planet_system";re.FURNITURE_QUEUE_TILE="furniture_queue_tile";re.FURNITURE_PARTY_BEAMER="furniture_party_beamer";re.FURNITURE_CUBOID="furniture_cuboid";re.FURNITURE_GIFT_WRAPPED="furniture_gift_wrapped";re.FURNITURE_GIFT_WRAPPED_FIREWORKS="furniture_gift_wrapped_fireworks";re.FURNITURE_COUNTER_CLOCK="furniture_counter_clock";re.FURNITURE_WATER_AREA="furniture_water_area";re.FURNITURE_SCORE_BOARD="furniture_score_board";re.FURNITURE_FIREWORKS="furniture_fireworks";re.FURNITURE_BB="furniture_bb";re.FURNITURE_ISOMETRIC_BB="furniture_isometric_bb";re.FURNITURE_BG="furniture_bg";re.FURNITURE_STICKIE="furniture_stickie";re.FURNITURE_MANNEQUIN="furniture_mannequin";re.FURNITURE_GUILD_CUSTOMIZED="furniture_guild_customized";re.FURNITURE_GUILD_ISOMETRIC_BADGE="furniture_guild_isometric_badge";re.FURNITURE_VOTE_COUNTER="furniture_vote_counter";re.FURNITURE_VOTE_MAJORITY="furniture_vote_majority";re.FURNITURE_SOUNDBLOCK="furniture_soundblock";re.FURNITURE_BADGE_DISPLAY="furniture_badge_display";re.FURNITURE_YOUTUBE="furniture_youtube";re.FURNITURE_BUILDER_PLACEHOLDER="furniture_builder_placeholder";re.ROOM="room";re.USER="user";re.PET_ANIMATED="pet_animated";re.BOT="bot";re.RENTABLE_BOT="rentable_bot";re.TILE_CURSOR="tile_cursor";class kn{constructor(e,t,s,r=null){this._id=e,this._location=t,this._targetLocation=s,this._movementType=r}get id(){return this._id}get location(){return this._location}get targetLocation(){return this._targetLocation}get movementType(){return this._movementType}}kn.MOVE="mv";kn.SLIDE="sld";class um{}um.KICKED_OUT_OF_ROOM=4008;um.STRIP_LOCKED_FOR_TRADING=-13001;class gl{}gl.OLD_IDENTITY=0;gl.NEW_IDENTITY=1;gl.REAL_NOOB=2;class ct{}ct.NONE=0;ct.GUEST=1;ct.GUILD_MEMBER=2;ct.GUILD_ADMIN=3;ct.ROOM_OWNER=4;ct.MODERATOR=5;const Ed=class ah{static getLocalizationKey(e){switch(e){case ah.FREE_TRADING:return"${trading.mode.free}";case ah.ROOM_CONTROLLER_REQUIRED:return"${trading.mode.controller}";case ah.NO_TRADING:return"${trading.mode.not.allowed}"}return""}};Ed.NO_TRADING=0;Ed.ROOM_CONTROLLER_REQUIRED=1;Ed.FREE_TRADING=2;let oh=Ed;class Cr{}Cr.SUPER_USER=9;Cr.ADMINISTRATOR=8;Cr.COMMUNITY=7;Cr.PLAYER_SUPPORT=6;Cr.MODERATOR=5;Cr.EMPLOYEE=4;Cr.BUS_PARTNER=3;Cr.PARTNER=2;Cr.CELEBRITY=1;Cr.NONE=0;var go=(n=>(n.FLOOR="S",n.WALL="I",n.EFFECT="E",n.BADGE="B",n.ROBOT="R",n.HABBO_CLUB="H",n.PET="P",n))(go||{});class Ti{}Ti.MATCH_ALL_PIXELS=-1;Ti.MATCH_OPAQUE_PIXELS=128;Ti.MATCH_NOTHING=256;class Rr{}Rr.DEFAULT=1;Rr.ROOM_PLANE=2;Rr.AVATAR=3;Rr.AVATAR_OWN=4;class WT{}class F{constructor(e=0,t=0,s=0){this._x=e,this._y=t,this._z=s,this._length=NaN}static sum(e,t){return!e||!t?null:new F(e.x+t.x,e.y+t.y,e.z+t.z)}static dif(e,t){return!e||!t?null:new F(e.x-t.x,e.y-t.y,e.z-t.z)}static product(e,t){return e?new F(e.x*t,e.y*t,e.z*t):null}static dotProduct(e,t){return!e||!t?0:e.x*t.x+e.y*t.y+e.z*t.z}static crossProduct(e,t){return!e||!t?null:new F(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}static scalarProjection(e,t){if(!e||!t)return-1;const s=t.length;return s>0?(e.x*t.x+e.y*t.y+e.z*t.z)/s:-1}static cosAngle(e,t){if(!e||!t)return 0;const s=e.length*t.length;return s?F.dotProduct(e,t)/s:0}static isEqual(e,t){return!(!e||!t||e.x!==t.x||e.y!==t.y||e.z!==t.z)}negate(){this._x=-this._x,this._y=-this._y,this._z=-this._z}add(e){e&&(this._x+=e.x,this._y+=e.y,this._z+=e.z,this._length=NaN)}subtract(e){e&&(this._x-=e.x,this._y-=e.y,this._z-=e.z,this._length=NaN)}multiply(e){this._x*=e,this._y*=e,this._z*=e,this._length=NaN}divide(e){e&&(this._x/=e,this._y/=e,this._z/=e,this._length=NaN)}assign(e){e&&(this._x=e.x,this._y=e.y,this._z=e.z,this._length=NaN)}get x(){return this._x}set x(e){this._x=e,this._length=NaN}get y(){return this._y}set y(e){this._y=e,this._length=NaN}get z(){return this._z}set z(e){this._z=e,this._length=NaN}get length(){return isNaN(this._length)&&(this._length=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)),this._length}toString(){return`[Vector3d: ${this._x}, ${this._y}, ${this._z}]`}}class ie{}ie.MOUSE_CLICK="click";ie.DOUBLE_CLICK="double_click";ie.MOUSE_MOVE="mousemove";ie.MOUSE_DOWN="mousedown";ie.MOUSE_DOWN_LONG="mousedown_long";ie.MOUSE_UP="mouseup";ie.ROLL_OVER="mouseover";ie.ROLL_OUT="mouseout";ie.RIGHT_CLICK="contextmenu";class Ks{}Ks.TOUCH_START="touchstart";Ks.TOUCH_MOVE="touchmove";Ks.TOUCH_CANCEL="touchcancel";Ks.TOUCH_END="touchend";Ks.TOUCH_LONG="touchlong";const rr=class{constructor(e){this._ordinal=e}get ordinal(){return this._ordinal}equals(e){return e&&e._ordinal==this._ordinal}};rr.NONE=new rr(0);rr.WAVE=new rr(1);rr.BLOW=new rr(2);rr.LAUGH=new rr(3);rr.CRY=new rr(4);rr.IDLE=new rr(5);rr.JUMP=new rr(6);rr.RESPECT=new rr(7);let on=rr;class Tt{}Tt.DUMMY="DUMMY";Tt.FRIEND_FURNITURE="FRIEND_FURNITURE";Tt.MONSTERPLANT_SEED="MONSTERPLANT_SEED";Tt.MYSTERY_BOX="MYSTERY_BOX";Tt.EFFECT_BOX="EFFECT_BOX";Tt.MYSTERY_TROPHY="MYSTERY_TROPHY";Tt.RANDOM_TELEPORT="RANDOM_TELEPORT";Tt.PURCHASABLE_CLOTHING="PURCHASABLE_CLOTHING";Tt.GENERIC_USABLE="GENERIC_USABLE";class De{}De.CHAT_WIDGET="RWE_CHAT_WIDGET";De.INFOSTAND="RWE_INFOSTAND";De.ME_MENU="RWE_ME_MENU";De.CHAT_INPUT_WIDGET="RWE_CHAT_INPUT_WIDGET";De.FURNI_PLACEHOLDER="RWE_FURNI_PLACEHOLDER";De.FURNI_CREDIT_WIDGET="RWE_FURNI_CREDIT_WIDGET";De.FURNI_STICKIE_WIDGET="RWE_FURNI_STICKIE_WIDGET";De.FURNI_TROPHY_WIDGET="RWE_FURNI_TROPHY_WIDGET";De.FURNI_LOVELOCK_WIDGET="RWE_FURNI_LOVELOCK_WIDGET";De.FURNI_PRESENT_WIDGET="RWE_FURNI_PRESENT_WIDGET";De.FURNI_ECOTRONBOX_WIDGET="RWE_FURNI_ECOTRONBOX_WIDGET";De.FURNI_PET_PACKAGE_WIDGET="RWE_FURNI_PET_PACKAGE_WIDGET";De.PLAYLIST_EDITOR_WIDGET="RWE_PLAYLIST_EDITOR_WIDGET";De.DOORBELL="RWE_DOORBELL";De.LOADINGBAR="RWE_LOADINGBAR";De.ROOM_QUEUE="RWE_ROOM_QUEUE";De.ROOM_POLL="RWE_ROOM_POLL";De.ROOM_VOTE="RWE_ROOM_VOTE";De.USER_CHOOSER="RWE_USER_CHOOSER";De.FURNI_CHOOSER="RWE_FURNI_CHOOSER";De.ROOM_DIMMER="RWE_ROOM_DIMMER";De.FRIEND_REQUEST="RWE_FRIEND_REQUEST";De.CLOTHING_CHANGE="RWE_CLOTHING_CHANGE";De.CONVERSION_TRACKING="RWE_CONVERSION_TRACKING";De.USER_NOTIFICATION="RWE_USER_NOTIFICATION";De.FRIENDS_BAR="RWE_FRIENDS_BAR";De.PURSE_WIDGET="RWE_PURSE_WIDGET";De.AVATAR_INFO="RWE_AVATAR_INFO";De.WELCOME_GIFT="RWE_WELCOME_GIFT";De.SPAMWALL_POSTIT_WIDGET="RWE_SPAMWALL_POSTIT_WIDGET";De.EFFECTS="RWE_EFFECTS";De.MANNEQUIN="RWE_MANNEQUIN";De.FURNITURE_CONTEXT_MENU="RWE_FURNITURE_CONTEXT_MENU";De.LOCATION_WIDGET="RWE_LOCATION_WIDGET";De.CAMERA="RWE_CAMERA";De.ROOM_THUMBNAIL_CAMERA="RWE_ROOM_THUMBNAIL_CAMERA";De.ROOM_BACKGROUND_COLOR="RWE_ROOM_BACKGROUND_COLOR";De.CUSTOM_USER_NOTIFICATION="RWE_CUSTOM_USER_NOTIFICATION";De.FURNI_ACHIEVEMENT_RESOLUTION_ENGRAVING="RWE_FURNI_ACHIEVEMENT_RESOLUTION_ENGRAVING";De.FRIEND_FURNI_CONFIRM="RWE_FRIEND_FURNI_CONFIRM";De.FRIEND_FURNI_ENGRAVING="RWE_FRIEND_FURNI_ENGRAVING";De.HIGH_SCORE_DISPLAY="RWE_HIGH_SCORE_DISPLAY";De.INTERNAL_LINK="RWE_INTERNAL_LINK";De.CUSTOM_STACK_HEIGHT="RWE_CUSTOM_STACK_HEIGHT";De.YOUTUBE="RWE_YOUTUBE";De.RENTABLESPACE="RWE_RENTABLESPACE";De.VIMEO="RWE_VIMEO";De.ROOM_TOOLS="RWE_ROOM_TOOLS";De.EXTERNAL_IMAGE="RWE_EXTERNAL_IMAGE";De.WORD_QUIZZ="RWE_WORD_QUIZZ";De.UI_HELP_BUBBLE="RWE_UI_HELP_BUBBLE";De.ROOM_LINK="RWE_ROOM_LINK";De.CRAFTING="RWE_CRAFTING";De.ROOMGAME_CHECKERS="RWE_GAME_CHECKERS";class Kt{}Kt.INFOSTAND_EXTRA_PARAM="RWEIEP_INFOSTAND_EXTRA_PARAM";Kt.JUKEBOX="RWEIEP_JUKEBOX";Kt.USABLE_PRODUCT="RWEIEP_USABLE_PRODUCT";Kt.SONGDISK="RWEIEP_SONGDISK";Kt.CRACKABLE_FURNI="RWEIEP_CRACKABLE_FURNI";Kt.BRANDING_OPTIONS="RWEIEP_BRANDING_OPTIONS";Kt.USABLE="RWEIEP_USABLE";class Fc{}Fc.NOBODY=0;Fc.CONTROLLER=1;Fc.EVERYBODY=2;class Vn{}Vn.NORMAL=0;Vn.GENERIC=1;Vn.BOT=2;class Hr{constructor(){this._isDisposed=!1,this._isDisposing=!1}dispose(){this._isDisposed||this._isDisposing||(this._isDisposing=!0,this.onDispose(),this._isDisposed=!0,this._isDisposing=!1)}onDispose(){}get disposed(){return this._isDisposed}get isDisposing(){return this._isDisposing}}class jr extends Hr{constructor(){super(),this._listeners=new Map}onDispose(){this.removeAllListeners(),super.onDispose()}addEventListener(e,t){if(!e||!t)return;const s=this._listeners.get(e);if(!s){this._listeners.set(e,[t]);return}s.push(t)}removeEventListener(e,t){if(!e||!t)return;const s=this._listeners.get(e);if(!(!s||!s.length)){for(const[r,i]of s.entries())if(!(!i||i!==t)){s.splice(r,1),s.length||this._listeners.delete(e);return}}}dispatchEvent(e){return e?(me.events("Dispatched Event",e.type),this.processEvent(e),!0):!1}processEvent(e){const t=this._listeners.get(e.type);if(!t||!t.length)return;const s=[];for(const r of t)r&&s.push(r);for(;s.length;){const r=s.shift();try{r(e)}catch(i){me.error(i.stack);return}}}removeAllListeners(){this._listeners.clear()}}class En extends Hr{constructor(){super(),this._events=new jr,this._isLoaded=!1,this._isLoading=!1}init(){this._isLoaded||this._isLoading||this.isDisposing||(this._isLoading=!0,this.onInit(),this._isLoaded=!0,this._isLoading=!1)}onInit(){}onDispose(){this._events&&this._events.dispose(),super.onDispose()}reload(){this.dispose(),this.init()}get events(){return this._events}get isLoaded(){return this._isLoaded}get isLoading(){return this._isLoading}}class YU{constructor(e){this._value=e}get value(){return this._value}}class zU{constructor(e,t){this._header=e,this._buffer=t}readBytes(e){return this._buffer?this._buffer.readBytes(e):null}readByte(){return this._buffer?this._buffer.readByte():-1}readBoolean(){return this.readByte()===1}readShort(){return this._buffer?this._buffer.readShort():-1}readInt(){return this._buffer?this._buffer.readInt():-1}readFloat(){return this._buffer?this._buffer.readFloat():-1}readDouble(){return this._buffer?this._buffer.readDouble():-1}readString(){const e=this.readShort();return this._buffer.readBytes(e).toString("utf8")}get header(){return this._header}get bytesAvailable(){return this._buffer&&this._buffer.remaining()>0}}class KU{constructor(e){this._value=e}get value(){return this._value}}class XU{encode(e,t){const s=new Ep;s.writeShort(e);for(const i of t){let a=typeof i;switch(a==="object"&&(i===null?a="null":i instanceof YU?a="byte":i instanceof KU?a="short":i instanceof ArrayBuffer&&(a="arraybuffer")),a){case"undefined":case"null":s.writeShort(0);break;case"byte":s.writeByte(i.value);break;case"short":s.writeShort(i.value);break;case"number":s.writeInt(i);break;case"boolean":s.writeByte(i?1:0);break;case"string":i?s.writeString(i,!0):s.writeShort(0);break;case"arraybuffer":s.writeBytes(i);break}}const r=s.getBuffer();return r?new Ep().writeInt(r.byteLength).writeBytes(r):null}decode(e){if(!e||!e.dataBuffer||!e.dataBuffer.byteLength)return null;const t=[];for(;e.dataBuffer.byteLength&&!(e.dataBuffer.byteLength<4);){const s=new _d(e.dataBuffer),r=s.readInt();if(r>e.dataBuffer.byteLength-4)break;const i=s.readBytes(r);t.push(new zU(i.readShort(),i)),e.dataBuffer=e.dataBuffer.slice(r+4)}return t}}class v{constructor(e,t){this._callBack=e,this._parserClass=t,this._parser=null,this._connection=null}dispose(){this._callBack=null,this._parserClass=null,this._parser=null,this._connection=null}get callBack(){return this._callBack}get parserClass(){return this._parserClass}get parser(){return this._parser}set parser(e){this._parser=e}get connection(){return this._connection}set connection(e){this._connection=e}}class He{constructor(e){this._type=e}get type(){return this._type}}class Ps extends He{constructor(e,t,s){super(e),this._connection=t,this._originalEvent=event}get connection(){return this._connection}get originalEvent(){return this._originalEvent}}Ps.CONNECTION_OPENED="SCE_OPEN";Ps.CONNECTION_CLOSED="SCE_CLOSED";Ps.CONNECTION_ERROR="SCE_ERROR";Ps.CONNECTION_MESSAGE="SCE_MESSAGE";class al extends He{constructor(e,t){super(e),this._library=t}get library(){return this._library}}al.DOWNLOAD_COMPLETE="ARELE_DOWNLOAD_COMPLETE";class pd{}pd.AVATAR_RENDER_READY="AVATAR_RENDER_READY";class ol extends He{constructor(e,t){super(e),this._library=t}get library(){return this._library}}ol.DOWNLOAD_COMPLETE="ARLE_DOWNLOAD_COMPLETE";class Nh extends He{constructor(e){super(e)}}Nh.INITIALIZED="RCWM_INITIALIZED";class Qt extends He{constructor(e,t){super(e),this._connection=t}get connection(){return this._connection}}Qt.CONNECTION_ESTABLISHED="NCE_ESTABLISHED";Qt.CONNECTION_CLOSED="NCE_CLOSED";Qt.CONNECTION_ERROR="NCE_ERROR";Qt.CONNECTION_HANDSHAKING="NCE_HANDSHAKING";Qt.CONNECTION_HANDSHAKED="NCE_HANDSHAKED";Qt.CONNECTION_HANDSHAKE_FAILED="NCE_HANDSHAKE_FAILED";Qt.CONNECTION_AUTHENTICATED="NCE_AUTHENTICATED";class Ca extends He{constructor(e){super(e)}}Ca.LOADED="NLE_LOADED";Ca.FAILED="NLE_FAILED";const YT=class mg extends He{constructor(){super(mg.SETTINGS_UPDATED)}clone(){const e=new mg;return e._volumeSystem=this._volumeSystem,e._volumeFurni=this._volumeFurni,e._volumeTrax=this._volumeTrax,e._oldChat=this._oldChat,e._roomInvites=this._roomInvites,e._cameraFollow=this._cameraFollow,e._flags=this._flags,e._chatType=this._chatType,e}get volumeSystem(){return this._volumeSystem}set volumeSystem(e){this._volumeSystem=e}get volumeFurni(){return this._volumeFurni}set volumeFurni(e){this._volumeFurni=e}get volumeTrax(){return this._volumeTrax}set volumeTrax(e){this._volumeTrax=e}get oldChat(){return this._oldChat}set oldChat(e){this._oldChat=e}get roomInvites(){return this._roomInvites}set roomInvites(e){this._roomInvites=e}get cameraFollow(){return this._cameraFollow}set cameraFollow(e){this._cameraFollow=e}get flags(){return this._flags}set flags(e){this._flags=e}get chatType(){return this._chatType}set chatType(e){this._chatType=e}};YT.SETTINGS_UPDATED="NSE_SETTINGS_UPDATED";let fl=YT;class ml extends He{constructor(e,t){super(e),this._sampleCode=t}get sampleCode(){return this._sampleCode}}ml.PLAY_SOUND="NSOE_PLAY_SOUND";class hm extends He{constructor(e){super(e)}get iconId(){return this._iconId}set iconId(e){this._iconId=e}get iconName(){return this._iconName}set iconName(e){this._iconName=e}}hm.TOOLBAR_CLICK="NTE_TOOLBAR_CLICK";hm.SELECT_OWN_AVATAR="NTE_SELECT_OWN_AVATAR";const zT=class KT extends hm{constructor(e,t,s){super(KT.ANIMATE_ICON),this._image=e,this._x=t,this._y=s}get image(){return this._image}get x(){return this._x}get y(){return this._y}};zT.ANIMATE_ICON="NTAIE_ANIMATE_ICON";let Eg=zT;class je extends He{constructor(e,t){super(e),this._roomId=t}get roomId(){return this._roomId}}je.INITIALIZED="REE_INITIALIZED";je.ENGINE_INITIALIZED="REE_ENGINE_INITIALIZED";je.OBJECTS_INITIALIZED="REE_OBJECTS_INITIALIZED";je.NORMAL_MODE="REE_NORMAL_MODE";je.GAME_MODE="REE_GAME_MODE";je.ROOM_ZOOMED="REE_ROOM_ZOOMED";je.DISPOSED="REE_DISPOSED";const XT=class qT extends je{constructor(e,t,s,r){super(qT.ROOM_COLOR,e),this._color=t,this._brightness=s,this._bgOnly=r}get color(){return this._color}get brightness(){return this._brightness}get bgOnly(){return this._bgOnly}};XT.ROOM_COLOR="REE_ROOM_COLOR";let QT=XT;class hn extends He{constructor(e,t){super(e),this._contentType=t}get contentType(){return this._contentType}}hn.RCLE_SUCCESS="RCLE_SUCCESS";hn.RCLE_FAILURE="RCLE_FAILURE";hn.RCLE_CANCEL="RCLE_CANCEL";const JT=class ZT extends je{constructor(e,t,s){super(ZT.ROOM_DRAG,e),this._offsetX=t,this._offsetY=s}get offsetX(){return this._offsetX}get offsetY(){return this._offsetY}};JT.ROOM_DRAG="RDE_ROOM_DRAG";let $T=JT;const eR=class tR extends je{constructor(e,t,s,r,i,a){super(tR.ROOM_COLOR,e),this._state=t,this._presetId=s,this._effectId=r,this._color=i,this._brightness=a}get state(){return this._state}get presetId(){return this._presetId}get effectId(){return this._effectId}get color(){return this._color}get brightness(){return this._brightness}};eR.ROOM_COLOR="REDSE_ROOM_COLOR";let sR=eR;class ue extends je{constructor(e,t,s,r){super(e,t),this._objectId=s,this._category=r}get objectId(){return this._objectId}get category(){return this._category}}ue.SELECTED="REOE_SELECTED";ue.DESELECTED="REOE_DESELECTED";ue.ADDED="REOE_ADDED";ue.REMOVED="REOE_REMOVED";ue.PLACED="REOE_PLACED";ue.PLACED_ON_USER="REOE_PLACED_ON_USER";ue.CONTENT_UPDATED="REOE_CONTENT_UPDATED";ue.REQUEST_MOVE="REOE_REQUEST_MOVE";ue.REQUEST_ROTATE="REOE_REQUEST_ROTATE";ue.REQUEST_MANIPULATION="REOE_REQUEST_MANIPULATION";ue.MOUSE_ENTER="REOE_MOUSE_ENTER";ue.MOUSE_LEAVE="REOE_MOUSE_LEAVE";ue.DOUBLE_CLICK="REOE_DOUBLE_CLICK";class pg extends ue{constructor(e,t,s,r,i,a,l,c,u,h,d,f,E){super(e,t,s,r),this._wallLocation="",this._x=0,this._y=0,this._z=0,this._direction=0,this._placedInRoom=!1,this._placedOnFloor=!1,this._placedOnWall=!1,this._instanceData=null,this._wallLocation=i,this._x=a,this._y=l,this._z=c,this._direction=u,this._placedInRoom=h,this._placedOnFloor=d,this._placedOnWall=f,this._instanceData=E}get wallLocation(){return this._wallLocation}get x(){return this._x}get y(){return this._y}get z(){return this._z}get direction(){return this._direction}get placedInRoom(){return this._placedInRoom}get placedOnFloor(){return this._placedOnFloor}get placedOnWall(){return this._placedOnWall}get instanceData(){return this._instanceData}}class qU extends ue{constructor(e,t,s,r,i,a){super(e,t,s,r),this._droppedObjectId=i,this._droppedObjectCategory=a}get droppedObjectId(){return this._droppedObjectId}get droppedObjectCategory(){return this._droppedObjectCategory}}class ll extends ue{constructor(e,t,s,r,i,a=1){super(e,t,s,r),this._soundId=i,this._pitch=a}get soundId(){return this._soundId}get pitch(){return this._pitch}}ll.PLAY_SOUND="REOPSE_PLAY_SOUND";ll.PLAY_SOUND_AT_PITCH="REOPSE_PLAY_SOUND_AT_PITCH";class gi extends ue{}gi.FURNI_CLICK="RERAE_FURNI_CLICK";gi.FURNI_DOUBLE_CLICK="RERAE_FURNI_DOUBLE_CLICK";gi.TOOLTIP_SHOW="RERAE_TOOLTIP_SHOW";gi.TOOLTIP_HIDE="RERAE_TOOLTIP_HIDE";class Tr extends ue{constructor(e,t,s,r,i,a=1){super(e,t,s,r),this._sampleId=i,this._pitch=a}get sampleId(){return this._sampleId}get pitch(){return this._pitch}}Tr.ROOM_OBJECT_INITIALIZED="ROPSPE_ROOM_OBJECT_INITIALIZED";Tr.ROOM_OBJECT_DISPOSED="ROPSPE_ROOM_OBJECT_DISPOSED";Tr.PLAY_SAMPLE="ROPSPE_PLAY_SAMPLE";Tr.CHANGE_PITCH="ROPSPE_CHANGE_PITCH";class q extends ue{constructor(e,t,s,r,i=null){super(e,t,s,r),this._widget=i}get widget(){return this._widget}get contextMenu(){return this._widget}}q.OPEN_WIDGET="RETWE_OPEN_WIDGET";q.CLOSE_WIDGET="RETWE_CLOSE_WIDGET";q.OPEN_FURNI_CONTEXT_MENU="RETWE_OPEN_FURNI_CONTEXT_MENU";q.CLOSE_FURNI_CONTEXT_MENU="RETWE_CLOSE_FURNI_CONTEXT_MENU";q.REQUEST_PLACEHOLDER="RETWE_REQUEST_PLACEHOLDER";q.REQUEST_CREDITFURNI="RETWE_REQUEST_CREDITFURNI";q.REQUEST_STACK_HEIGHT="RETWE_REQUEST_STACK_HEIGHT";q.REQUEST_EXTERNAL_IMAGE="RETWE_REQUEST_EXTERNAL_IMAGE";q.REQUEST_STICKIE="RETWE_REQUEST_STICKIE";q.REQUEST_PRESENT="RETWE_REQUEST_PRESENT";q.REQUEST_TROPHY="RETWE_REQUEST_TROPHY";q.REQUEST_TEASER="RETWE_REQUEST_TEASER";q.REQUEST_ECOTRONBOX="RETWE_REQUEST_ECOTRONBOX";q.REQUEST_DIMMER="RETWE_REQUEST_DIMMER";q.REMOVE_DIMMER="RETWE_REMOVE_DIMMER";q.REQUEST_CLOTHING_CHANGE="RETWE_REQUEST_CLOTHING_CHANGE";q.REQUEST_PLAYLIST_EDITOR="RETWE_REQUEST_PLAYLIST_EDITOR";q.REQUEST_MANNEQUIN="RETWE_REQUEST_MANNEQUIN";q.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG="ROWRE_REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG";q.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG="ROWRE_REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG";q.REQUEST_BACKGROUND_COLOR="RETWE_REQUEST_BACKGROUND_COLOR";q.REQUEST_MYSTERYBOX_OPEN_DIALOG="RETWE_REQUEST_MYSTERYBOX_OPEN_DIALOG";q.REQUEST_EFFECTBOX_OPEN_DIALOG="RETWE_REQUEST_EFFECTBOX_OPEN_DIALOG";q.REQUEST_MYSTERYTROPHY_OPEN_DIALOG="RETWE_REQUEST_MYSTERYTROPHY_OPEN_DIALOG";q.REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING="RETWE_REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING";q.REQUEST_ACHIEVEMENT_RESOLUTION_FAILED="RETWE_REQUEST_ACHIEVEMENT_RESOLUTION_FAILED";q.REQUEST_FRIEND_FURNITURE_CONFIRM="RETWE_REQUEST_FRIEND_FURNITURE_CONFIRM";q.REQUEST_FRIEND_FURNITURE_ENGRAVING="RETWE_REQUEST_FRIEND_FURNITURE_ENGRAVING";q.REQUEST_BADGE_DISPLAY_ENGRAVING="RETWE_REQUEST_BADGE_DISPLAY_ENGRAVING";q.REQUEST_HIGH_SCORE_DISPLAY="RETWE_REQUEST_HIGH_SCORE_DISPLAY";q.REQUEST_HIDE_HIGH_SCORE_DISPLAY="RETWE_REQUEST_HIDE_HIGH_SCORE_DISPLAY";q.REQUEST_INTERNAL_LINK="RETWE_REQUEST_INTERNAL_LINK";q.REQUEST_ROOM_LINK="RETWE_REQUEST_ROOM_LINK";q.REQUEST_YOUTUBE="RETWE_REQUEST_YOUTUBE";class Sl extends ue{constructor(e,t,s,r,i=-1,a=-1){super(e,t,s,r),this._inventoryStripId=i,this._furnitureTypeId=a}get inventoryStripId(){return this._inventoryStripId}get furnitureTypeId(){return this._furnitureTypeId}}Sl.USE_PRODUCT_FROM_ROOM="REUPE_USE_PRODUCT_FROM_ROOM";Sl.USE_PRODUCT_FROM_INVENTORY="REUPE_USE_PRODUCT_FROM_INVENTORY";class Ai extends He{constructor(e,t){super(e),this._object=t}get object(){return this._object}get objectId(){return this._object?this._object.id:-1}get objectType(){return this._object?this._object.type:null}}class _n extends Ai{constructor(e,t,s,r=!0){super(e,t),this._badgeId=s,this._groupBadge=r}get badgeId(){return this._badgeId}get groupBadge(){return this._groupBadge}}_n.LOAD_BADGE="ROBAE_LOAD_BADGE";class fi extends Ai{constructor(e,t){super(e,t)}}fi.RODRE_CURRENT_USER_ID="RODRE_CURRENT_USER_ID";fi.RODRE_URL_PREFIX="RODRE_URL_PREFIX";const rR=class iR extends Ai{constructor(e,t,s,r,i,a){super(iR.DIMMER_STATE,e),this._state=t,this._presetId=s,this._effectId=r,this._color=i,this._brightness=a}get state(){return this._state}get presetId(){return this._presetId}get effectId(){return this._effectId}get color(){return this._color}get brightness(){return this._brightness}};rR.DIMMER_STATE="RODSUE_DIMMER_STATE";let yc=rR;class nr extends Ai{constructor(e,t){super(e,t)}}nr.ADD_HOLE="ROFHO_ADD_HOLE";nr.REMOVE_HOLE="ROFHO_REMOVE_HOLE";class oe extends Ai{}oe.DICE_OFF="ROFCAE_DICE_OFF";oe.DICE_ACTIVATE="ROFCAE_DICE_ACTIVATE";oe.USE_HABBOWHEEL="ROFCAE_USE_HABBOWHEEL";oe.STICKIE="ROFCAE_STICKIE";oe.ENTER_ONEWAYDOOR="ROFCAE_ENTER_ONEWAYDOOR";oe.SOUND_MACHINE_INIT="ROFCAE_SOUND_MACHINE_INIT";oe.SOUND_MACHINE_START="ROFCAE_SOUND_MACHINE_START";oe.SOUND_MACHINE_STOP="ROFCAE_SOUND_MACHINE_STOP";oe.SOUND_MACHINE_DISPOSE="ROFCAE_SOUND_MACHINE_DISPOSE";oe.JUKEBOX_INIT="ROFCAE_JUKEBOX_INIT";oe.JUKEBOX_START="ROFCAE_JUKEBOX_START";oe.JUKEBOX_MACHINE_STOP="ROFCAE_JUKEBOX_MACHINE_STOP";oe.JUKEBOX_DISPOSE="ROFCAE_JUKEBOX_DISPOSE";oe.MOUSE_BUTTON="ROFCAE_MOUSE_BUTTON";oe.MOUSE_ARROW="ROFCAE_MOUSE_ARROW";class yh extends je{constructor(e,t,s,r,i,a){super(e,t),this._enable=s,this._hue=r,this._saturation=i,this._lightness=a}get enable(){return this._enable}get hue(){return this._hue}get saturation(){return this._saturation}get lightness(){return this._lightness}}yh.ROOM_BACKGROUND_COLOR="ROHSLCEE_ROOM_BACKGROUND_COLOR";class Sa extends Ai{constructor(e,t,s,r,i,a){super(e,t),this._enable=s,this._hue=r,this._saturation=i,this._lightness=a}get enable(){return this._enable}get hue(){return this._hue}get saturation(){return this._saturation}get lightness(){return this._lightness}}Sa.ROOM_BACKGROUND_COLOR="ROHSLCEE_ROOM_BACKGROUND_COLOR";class Me extends Ai{constructor(e,t,s,r=!1,i=!1,a=!1,l=!1){super(e,t),this._eventId="",this._eventId=s,this._altKey=r,this._ctrlKey=i,this._shiftKey=a,this._buttonDown=l}get eventId(){return this._eventId}get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get shiftKey(){return this._shiftKey}get buttonDown(){return this._buttonDown}get localX(){return this._localX}set localX(e){this._localX=e}get localY(){return this._localY}set localY(e){this._localY=e}get spriteOffsetX(){return this._spriteOffsetX}set spriteOffsetX(e){this._spriteOffsetX=e}get spriteOffsetY(){return this._spriteOffsetY}set spriteOffsetY(e){this._spriteOffsetY=e}}Me.CLICK="ROE_MOUSE_CLICK";Me.DOUBLE_CLICK="ROE_MOUSE_DOUBLE_CLICK";Me.MOUSE_MOVE="ROE_MOUSE_MOVE";Me.MOUSE_DOWN="ROE_MOUSE_DOWN";Me.MOUSE_DOWN_LONG="ROE_MOUSE_DOWN_LONG";Me.MOUSE_UP="ROE_MOUSE_UP";Me.MOUSE_ENTER="ROE_MOUSE_ENTER";Me.MOUSE_LEAVE="ROE_MOUSE_LEAVE";class hr extends Ai{constructor(e,t){super(e,t)}}hr.POSITION_CHANGED="ROME_POSITION_CHANGED";hr.OBJECT_REMOVED="ROME_OBJECT_REMOVED";class Wn extends oe{constructor(e,t,s,r=1){super(e,t),this._soundId=s,this._pitch=r}get soundId(){return this._soundId}get pitch(){return this._pitch}}Wn.PLAY_SOUND="ROPSIE_PLAY_SOUND";Wn.PLAY_SOUND_AT_PITCH="ROPSIE_PLAY_SOUND_AT_PITCH";class Ut extends Ai{constructor(e,t,s="",r=""){super(e,t),this._imageUrl="",this._clickUrl="",this._imageUrl=s,this._clickUrl=r}get imageUrl(){return this._imageUrl}get clickUrl(){return this._clickUrl}}Ut.ROOM_AD_LOAD_IMAGE="RORAE_ROOM_AD_LOAD_IMAGE";Ut.ROOM_AD_FURNI_CLICK="RORAE_ROOM_AD_FURNI_CLICK";Ut.ROOM_AD_FURNI_DOUBLE_CLICK="RORAE_ROOM_AD_FURNI_DOUBLE_CLICK";Ut.ROOM_AD_TOOLTIP_SHOW="RORAE_ROOM_AD_TOOLTIP_SHOW";Ut.ROOM_AD_TOOLTIP_HIDE="RORAE_ROOM_AD_TOOLTIP_HIDE";class is extends Ai{constructor(e,t,s,r=1){super(e,t),this._sampleId=s,this._pitch=r}get sampleId(){return this._sampleId}get pitch(){return this._pitch}}is.ROOM_OBJECT_INITIALIZED="ROPSPE_ROOM_OBJECT_INITIALIZED";is.ROOM_OBJECT_DISPOSED="ROPSPE_ROOM_OBJECT_DISPOSED";is.PLAY_SAMPLE="ROPSPE_PLAY_SAMPLE";is.CHANGE_PITCH="ROPSPE_CHANGE_PITCH";class Dt extends ue{}Dt.SOUND_MACHINE_INIT="ROSM_SOUND_MACHINE_INIT";Dt.SOUND_MACHINE_SWITCHED_ON="ROSM_SOUND_MACHINE_SWITCHED_ON";Dt.SOUND_MACHINE_SWITCHED_OFF="ROSM_SOUND_MACHINE_SWITCHED_OFF";Dt.SOUND_MACHINE_DISPOSE="ROSM_SOUND_MACHINE_DISPOSE";Dt.JUKEBOX_INIT="ROSM_JUKEBOX_INIT";Dt.JUKEBOX_SWITCHED_ON="ROSM_JUKEBOX_SWITCHED_ON";Dt.JUKEBOX_SWITCHED_OFF="ROSM_JUKEBOX_SWITCHED_OFF";Dt.JUKEBOX_DISPOSE="ROSM_JUKEBOX_DISPOSE";class it extends Ai{constructor(e,t,s=0){super(e,t),this._state=s}get state(){return this._state}}it.STATE_CHANGE="ROSCE_STATE_CHANGE";it.STATE_RANDOM="ROSCE_STATE_RANDOM";class yn extends Me{constructor(e,t,s,r,i,a,l=!1,c=!1,u=!1,h=!1){super(e,t,s,l,c,u,h),this._tileX=r,this._tileY=i,this._tileZ=a}get tileX(){return this._tileX}get tileY(){return this._tileY}get tileZ(){return this._tileZ}get tileXAsInt(){return Math.trunc(this._tileX+.499)}get tileYAsInt(){return Math.trunc(this._tileY+.499)}get tileZAsInt(){return Math.trunc(this._tileZ+.499)}}class qo extends Me{constructor(e,t,s,r,i,a,l,c,u,h=!1,d=!1,f=!1,E=!1){super(e,t,s,h,d,f,E),this._wallLocation=new F,this._wallWd=new F,this._wallHt=new F,this._wallLocation.assign(r),this._wallWd.assign(i),this._wallHt.assign(a),this._x=l,this._y=c,this._direction=u}get wallLocation(){return this._wallLocation}get wallWidth(){return this._wallWd}get wallHeight(){return this._wallHt}get x(){return this._x}get y(){return this._y}get direction(){return this._direction}}class W extends Ai{constructor(e,t){super(e,t)}}W.OPEN_WIDGET="ROWRE_OPEN_WIDGET";W.CLOSE_WIDGET="ROWRE_CLOSE_WIDGET";W.OPEN_FURNI_CONTEXT_MENU="ROWRE_OPEN_FURNI_CONTEXT_MENU";W.CLOSE_FURNI_CONTEXT_MENU="ROWRE_CLOSE_FURNI_CONTEXT_MENU";W.PLACEHOLDER="ROWRE_PLACEHOLDER";W.CREDITFURNI="ROWRE_CREDITFURNI";W.STACK_HEIGHT="ROWRE_STACK_HEIGHT";W.EXTERNAL_IMAGE="ROWRE_EXTERNAL_IMAGE";W.STICKIE="ROWRE_STICKIE";W.PRESENT="ROWRE_PRESENT";W.TROPHY="ROWRE_TROPHY";W.TEASER="ROWRE_TEASER";W.ECOTRONBOX="ROWRE_ECOTRONBOX";W.DIMMER="ROWRE_DIMMER";W.WIDGET_REMOVE_DIMMER="ROWRE_WIDGET_REMOVE_DIMMER";W.CLOTHING_CHANGE="ROWRE_CLOTHING_CHANGE";W.JUKEBOX_PLAYLIST_EDITOR="ROWRE_JUKEBOX_PLAYLIST_EDITOR";W.MANNEQUIN="ROWRE_MANNEQUIN";W.PET_PRODUCT_MENU="ROWRE_PET_PRODUCT_MENU";W.GUILD_FURNI_CONTEXT_MENU="ROWRE_GUILD_FURNI_CONTEXT_MENU";W.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG="ROWRE_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG";W.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG="ROWRE_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG";W.BACKGROUND_COLOR="ROWRE_BACKGROUND_COLOR";W.MYSTERYBOX_OPEN_DIALOG="ROWRE_MYSTERYBOX_OPEN_DIALOG";W.EFFECTBOX_OPEN_DIALOG="ROWRE_EFFECTBOX_OPEN_DIALOG";W.MYSTERYTROPHY_OPEN_DIALOG="ROWRE_MYSTERYTROPHY_OPEN_DIALOG";W.ACHIEVEMENT_RESOLUTION_OPEN="ROWRE_ACHIEVEMENT_RESOLUTION_OPEN";W.ACHIEVEMENT_RESOLUTION_ENGRAVING="ROWRE_ACHIEVEMENT_RESOLUTION_ENGRAVING";W.ACHIEVEMENT_RESOLUTION_FAILED="ROWRE_ACHIEVEMENT_RESOLUTION_FAILED";W.FRIEND_FURNITURE_CONFIRM="ROWRE_FRIEND_FURNITURE_CONFIRM";W.FRIEND_FURNITURE_ENGRAVING="ROWRE_FRIEND_FURNITURE_ENGRAVING";W.BADGE_DISPLAY_ENGRAVING="ROWRE_BADGE_DISPLAY_ENGRAVING";W.HIGH_SCORE_DISPLAY="ROWRE_HIGH_SCORE_DISPLAY";W.HIDE_HIGH_SCORE_DISPLAY="ROWRE_HIDE_HIGH_SCORE_DISPLAY";W.INERNAL_LINK="ROWRE_INTERNAL_LINK";W.ROOM_LINK="ROWRE_ROOM_LINK";W.YOUTUBE="ROWRE_YOUTUBE";class QU{constructor(e,t,s,r,i,a,l=0,c=0,u=!1,h=!1,d=!1,f=!1){this._type=e,this._eventId=t,this._canvasId=s,this._spriteTag=r,this._screenX=i,this._screenY=a,this._localX=l,this._localY=c,this._ctrlKey=u,this._altKey=h,this._shiftKey=d,this._buttonDown=f,this._spriteOffsetX=0,this._spriteOffsetY=0}get type(){return this._type}get eventId(){return this._eventId}get canvasId(){return this._canvasId}get spriteTag(){return this._spriteTag}get screenX(){return this._screenX}get screenY(){return this._screenY}get localX(){return this._localX}get localY(){return this._localY}get ctrlKey(){return this._ctrlKey}get altKey(){return this._altKey}get shiftKey(){return this._shiftKey}get buttonDown(){return this._buttonDown}get spriteOffsetX(){return this._spriteOffsetX}set spriteOffsetX(e){this._spriteOffsetX=e}get spriteOffsetY(){return this._spriteOffsetY}set spriteOffsetY(e){this._spriteOffsetY=e}}class JU extends He{constructor(e){super(e)}}class xc extends JU{constructor(e,t){super(e),this._targetLocation=t}get targetLocation(){return this._targetLocation}}xc.ROAME_MOVE_TO="ROAME_MOVE_TO";const nR=class aR extends je{constructor(e,t,s=!1,r=!1){super(aR.ROOM_ZOOM,e),this._level=t,this._forceFlip=s,this._asDelta=r}get level(){return this._level}get forceFlip(){return this._forceFlip}get asDelta(){return this._asDelta}};nR.ROOM_ZOOM="REE_ROOM_ZOOM";let Ig=nR;const oR=class lR extends He{constructor(e,t){super(lR.IMAGE_READY),this._badgeId=e,this._image=t}get badgeId(){return this._badgeId}get image(){return this._image}};oR.IMAGE_READY="BIME_BADGE_IMAGE_READY";let To=oR;const cR=class uR extends He{constructor(e,t){super(uR.MYSTERY_BOX_KEYS_UPDATE),this._boxColor=e,this._keyColor=t}get boxColor(){return this._boxColor}get keyColor(){return this._keyColor}};cR.MYSTERY_BOX_KEYS_UPDATE="mbke_update";let hR=cR;const ZU=class dR extends He{constructor(){super(dR.PERKS_UPDATED)}};ZU.PERKS_UPDATED="PUE_perks_updated";class Ne extends He{constructor(e,t,s=!0){super(e),this._session=t,this._openLandingView=s}get session(){return this._session}get openLandingView(){return this._openLandingView}}Ne.CREATED="RSE_CREATED";Ne.STARTED="RSE_STARTED";Ne.ENDED="RSE_ENDED";Ne.ROOM_DATA="RSE_ROOM_DATA";class we extends Ne{constructor(e,t,s,r,i,a=0,l=null,c=-1){super(e,t),this._objectId=s,this._message=r,this._chatType=i,this._links=l,this._extraParam=c,this._style=a}get objectId(){return this._objectId}get message(){return this._message}get chatType(){return this._chatType}get links(){return this._links}get extraParam(){return this._extraParam}get style(){return this._style}}we.CHAT_EVENT="RSCE_CHAT_EVENT";we.FLOOD_EVENT="RSCE_FLOOD_EVENT";we.CHAT_TYPE_SPEAK=0;we.CHAT_TYPE_WHISPER=1;we.CHAT_TYPE_SHOUT=2;we.CHAT_TYPE_RESPECT=3;we.CHAT_TYPE_PETRESPECT=4;we.CHAT_TYPE_HAND_ITEM_RECEIVED=5;we.CHAT_TYPE_PETTREAT=6;we.CHAT_TYPE_PETREVIVE=7;we.CHAT_TYPE_PET_REBREED_FERTILIZE=8;we.CHAT_TYPE_PET_SPEED_FERTILIZE=9;we.CHAT_TYPE_MUTE_REMAINING=10;const _R=class gR extends Ne{constructor(e,t,s,r,i,a){super(gR.CONFIRM_PET_BREEDING,e),this._nestId=t,this._pet1=s,this._pet2=r,this._rarityCategories=i,this._resultPetTypeId=a}get nestId(){return this._nestId}get pet1(){return this._pet1}get pet2(){return this._pet2}get rarityCategories(){return this._rarityCategories}get resultPetTypeId(){return this._resultPetTypeId}};_R.CONFIRM_PET_BREEDING="RSPFUE_CONFIRM_PET_BREEDING";let $U=_R;const fR=class mR extends Ne{constructor(e,t,s){super(mR.RSPFUE_CONFIRM_PET_BREEDING_RESULT,e),this._breedingNestStuffId=t,this._result=s}get breedingNestStuffId(){return this._breedingNestStuffId}get result(){return this._result}};fR.RSPFUE_CONFIRM_PET_BREEDING_RESULT="RSPFUE_CONFIRM_PET_BREEDING_RESULT";let e0=fR;const ER=class pR extends Ne{constructor(e,t,s){super(pR.RSDE_DANCE,e),this._roomIndex=t,this._danceId=s}get roomIndex(){return this._roomIndex}get danceId(){return this._danceId}};ER.RSDE_DANCE="RSDE_DANCE";let IR=ER;class t0{constructor(e,t,s,r){this._id=e,this._type=t,this._color=s,this._brightness=r}get id(){return this._id}get type(){return this._type}get color(){return this._color}get brightness(){return this._brightness}}class Mh extends Ne{constructor(e,t){super(e,t),this._selectedPresetId=0,this._presets=[]}storePreset(e,t,s,r){this._presets[e-1]=new t0(e,t,s,r)}getPreset(e){return e<0||e>=this._presets.length?null:this._presets[e]}get presetCount(){return this._presets.length}get selectedPresetId(){return this._selectedPresetId}set selectedPresetId(e){this._selectedPresetId=e}}Mh.ROOM_DIMMER_PRESETS="RSDPE_PRESETS";class mi extends Ne{constructor(e,t,s){super(e,t),this._userName="",this._userName=s}get userName(){return this._userName}}mi.DOORBELL="RSDE_DOORBELL";mi.RSDE_REJECTED="RSDE_REJECTED";mi.RSDE_ACCEPTED="RSDE_ACCEPTED";class Be extends Ne{constructor(e,t,s=null){super(e,t),this._message=s}get message(){return this._message}}Be.RSEME_KICKED="RSEME_KICKED";Be.RSEME_PETS_FORBIDDEN_IN_HOTEL="RSEME_PETS_FORBIDDEN_IN_HOTEL";Be.RSEME_PETS_FORBIDDEN_IN_FLAT="RSEME_PETS_FORBIDDEN_IN_FLAT";Be.RSEME_MAX_PETS="RSEME_MAX_PETS";Be.RSEME_MAX_NUMBER_OF_OWN_PETS="RSEME_MAX_NUMBER_OF_OWN_PETS";Be.RSEME_NO_FREE_TILES_FOR_PET="RSEME_NO_FREE_TILES_FOR_PET";Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET="RSEME_SELECTED_TILE_NOT_FREE_FOR_PET";Be.RSEME_BOTS_FORBIDDEN_IN_HOTEL="RSEME_BOTS_FORBIDDEN_IN_HOTEL";Be.RSEME_BOTS_FORBIDDEN_IN_FLAT="RSEME_BOTS_FORBIDDEN_IN_FLAT";Be.RSEME_BOT_LIMIT_REACHED="RSEME_BOT_LIMIT_REACHED";Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT="RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT";Be.RSEME_BOT_NAME_NOT_ACCEPTED="RSEME_BOT_NAME_NOT_ACCEPTED";const TR=class RR extends Ne{constructor(e,t,s,r,i){super(RR.FAVOURITE_GROUP_UPDATE,e),this._roomIndex=t,this._habboGroupId=s,this._habboGroupName=i,this._status=r}get roomIndex(){return this._roomIndex}get habboGroupId(){return this._habboGroupId}get habboGroupName(){return this._habboGroupName}get status(){return this._status}};TR.FAVOURITE_GROUP_UPDATE="RSFGUE_FAVOURITE_GROUP_UPDATE";let OR=TR;const SR=class CR extends Ne{constructor(e,t,s,r){super(CR.RSFRE_FRIEND_REQUEST,e),this._requestId=0,this._userId=0,this._requestId=t,this._userId=s,this._userName=r}get requestId(){return this._requestId}get userId(){return this._userId}get userName(){return this._userName}};SR.RSFRE_FRIEND_REQUEST="RSFRE_FRIEND_REQUEST";let s0=SR;const AR=class NR extends Ne{constructor(e,t,s){super(NR.NEST_BREEDING_SUCCESS,e),this._petId=t,this._rarityCategory=s}get rarityCategory(){return this._rarityCategory}get petId(){return this._petId}};AR.NEST_BREEDING_SUCCESS="RSPFUE_NEST_BREEDING_SUCCESS";let r0=AR;const yR=class MR extends Ne{constructor(e,t,s,r){super(MR.PET_BREEDING,e),this._state=t,this._ownPetId=s,this._otherPetId=r}get state(){return this._state}get ownPetId(){return this._ownPetId}get otherPetId(){return this._otherPetId}};yR.PET_BREEDING="RSPFUE_PET_BREEDING";let i0=yR;const DR=class vR extends Ne{constructor(e,t,s){super(vR.PET_BREEDING_RESULT,e),this._resultData=t,this._otherResultData=s}get resultData(){return this._resultData}get otherResultData(){return this._otherResultData}};DR.PET_BREEDING_RESULT="RSPFUE_PET_BREEDING_RESULT";let n0=DR;const a0=class bR extends Ne{constructor(e,t,s,r){super(bR.PET_COMMANDS,e),this._petId=t,this._allCommandIds=s,this._enabledCommandIds=r}get id(){return this._petId}get commands(){return this._allCommandIds}get enabledCommands(){return this._enabledCommandIds}};a0.PET_COMMANDS="RSPIUE_ENABLED_PET_COMMANDS";const PR=class LR extends Ne{constructor(e,t,s){super(LR.PET_FIGURE_UPDATE,e),this._petId=t,this._figure=s}get id(){return this._petId}get figure(){return this._figure}};PR.PET_FIGURE_UPDATE="RSPFUE_PET_FIGURE_UPDATE";let o0=PR;const UR=class FR extends Ne{constructor(e,t){super(FR.PET_INFO,e),this._petInfo=t}get petInfo(){return this._petInfo}};UR.PET_INFO="RSPIUE_PET_INFO";let xR=UR;const wR=class GR extends Ne{constructor(e,t,s){super(GR.PET_LEVEL_UPDATE,e),this._petId=t,this._level=s}get petId(){return this._petId}get level(){return this._level}};wR.PET_LEVEL_UPDATE="RSPLUE_PET_LEVEL_UPDATE";let l0=wR;class Aa extends Ne{constructor(e,t,s,r,i,a){super(e,t),this._objectId=-1,this._nameValidationStatus=0,this._nameValidationInfo=null,this._objectId=s,this._figureData=r,this._nameValidationStatus=i,this._nameValidationInfo=a}get objectId(){return this._objectId}get figureData(){return this._figureData}get nameValidationStatus(){return this._nameValidationStatus}get nameValidationInfo(){return this._nameValidationInfo}}Aa.RSOPPE_OPEN_PET_PACKAGE_REQUESTED="RSOPPE_OPEN_PET_PACKAGE_REQUESTED";Aa.RSOPPE_OPEN_PET_PACKAGE_RESULT="RSOPPE_OPEN_PET_PACKAGE_RESULT";const BR=class kR extends Ne{constructor(e,t,s,r,i,a){super(kR.PET_STATUS_UPDATE,e),this._petId=t,this._canBreed=s,this._canHarvest=r,this._canRevive=i,this._hasBreedingPermission=a}get petId(){return this._petId}get canBreed(){return this._canBreed}get canHarvest(){return this._canHarvest}get canRevive(){return this._canRevive}get hasBreedingPermission(){return this._hasBreedingPermission}};BR.PET_STATUS_UPDATE="RSPFUE_PET_STATUS_UPDATE";let VR=BR;class ui extends Ne{constructor(e,t,s){super(e,t),this._id=-1,this._numQuestions=0,this._startMessage="",this._endMessage="",this._questionArray=null,this._npsPoll=!1,this._id=s}get id(){return this._id}get headline(){return this._headline}set headline(e){this._headline=e}get summary(){return this._summary}set summary(e){this._summary=e}get numQuestions(){return this._numQuestions}set numQuestions(e){this._numQuestions=e}get startMessage(){return this._startMessage}set startMessage(e){this._startMessage=e}get endMessage(){return this._endMessage}set endMessage(e){this._endMessage=e}get questionArray(){return this._questionArray}set questionArray(e){this._questionArray=e}get npsPoll(){return this._npsPoll}set npsPoll(e){this._npsPoll=e}}ui.OFFER="RSPE_POLL_OFFER";ui.ERROR="RSPE_POLL_ERROR";ui.CONTENT="RSPE_POLL_CONTENT";class Dh extends Ne{constructor(e,t,s,r,i,a,l,c,u){super(e,t),this._classId=0,this._itemType="",this._placedItemId=0,this._placedItemType="",this._classId=s,this._itemType=r,this._productCode=i,this._placedItemId=a,this._placedItemType=l,this._placedInRoom=c,this._petFigureString=u}get classId(){return this._classId}get itemType(){return this._itemType}get productCode(){return this._productCode}get placedItemId(){return this._placedItemId}get placedInRoom(){return this._placedInRoom}get placedItemType(){return this._placedItemType}get petFigureString(){return this._petFigureString}}Dh.RSPE_PRESENT_OPENED="RSPE_PRESENT_OPENED";class Tg extends Ne{constructor(e,t){super(e,t)}}Tg.RSDUE_ALLOW_PETS="RSDUE_ALLOW_PETS";const Zc=class HR extends Ne{constructor(e,t,s,r=!1){super(HR.QUEUE_STATUS,e),this._name=t,this._target=s,this._queues=new Map,this._isActive=r}get isActive(){return this._isActive}get queueSetName(){return this._name}get queueSetTarget(){return this._target}get queueTypes(){return Array.from(this._queues.keys())}getQueueSize(e){return this._queues.get(e)}addQueue(e,t){this._queues.set(e,t)}};Zc.QUEUE_STATUS="RSQE_QUEUE_STATUS";Zc.QUEUE_TYPE_CLUB="c";Zc.QUEUE_TYPE_NORMAL="d";Zc.QUEUE_TARGET_VISITOR=2;Zc.QUEUE_TARGET_SPECTATOR=1;class Rg extends Ne{constructor(e,t){super(e,t)}}Rg.SPECTATOR_MODE="RSSME_SPECTATOR_MODE";const jR=class WR extends Ne{constructor(e,t,s){super(WR.RSUBE_BADGES,e),this._userId=0,this._badges=[],this._userId=t,this._badges=s}get userId(){return this._userId}get badges(){return this._badges}};jR.RSUBE_BADGES="RSUBE_BADGES";let YR=jR;const zR=class KR extends Ne{constructor(e,t){super(KR.USER_DATA_UPDATED,e),this._addedUsers=t}get addedUsers(){return this._addedUsers}};zR.USER_DATA_UPDATED="RMUDUE_USER_DATA_UPDATED";let XR=zR;const qR=class QR extends Ne{constructor(e,t,s,r,i,a){super(QR.USER_FIGURE,e),this._roomIndex=0,this._figure="",this._gender="",this._customInfo="",this._roomIndex=t,this._figure=s,this._gender=r,this._customInfo=i,this._achievementScore=a}get roomIndex(){return this._roomIndex}get figure(){return this._figure}get gender(){return this._gender}get customInfo(){return this._customInfo}get activityPoints(){return this._achievementScore}};qR.USER_FIGURE="RSUBE_FIGURE";let JR=qR;const c0=class ZR extends He{constructor(e,t){super(ZR.UTRE_USER_TAGS_RECEIVED),this._userId=e,this._tags=t}get userId(){return this._userId}get tags(){return this._tags}};c0.UTRE_USER_TAGS_RECEIVED="UTRE_USER_TAGS_RECEIVED";class cl extends Ne{constructor(e,t,s,r,i=null,a=0){super(e,t),this._question="",this._SafeStr_7654=0,this._choices=[],this._SafeStr_7651=[],this._question=s,this._choices=r,this._SafeStr_7651=i,this._SafeStr_7651==null&&(this._SafeStr_7651=[]),this._SafeStr_7654=a}get question(){return this._question}get choices(){return this._choices.slice()}get _SafeStr_4173(){return this._SafeStr_7651.slice()}get _SafeStr_4174(){return this._SafeStr_7654}}cl.VOTE_QUESTION="RSPE_VOTE_QUESTION";cl.VOTE_RESULT="RSPE_VOTE_RESULT";class hi extends Ne{constructor(e,t,s=-1){super(e,t),this._id=-1,this._pollType=null,this._pollId=-1,this._questionId=-1,this._duration=-1,this._question=null,this._userId=-1,this._id=s}get id(){return this._id}get pollType(){return this._pollType}set pollType(e){this._pollType=e}get pollId(){return this._pollId}set pollId(e){this._pollId=e}get questionId(){return this._questionId}set questionId(e){this._questionId=e}get duration(){return this._duration}set duration(e){this._duration=e}get question(){return this._question}set question(e){this._question=e}get userId(){return this._userId}set userId(e){this._userId=e}get value(){return this._value}set value(e){this._value=e}get answerCounts(){return this._answerCounts}set answerCounts(e){this._answerCounts=e}}hi.QUESTION="RWPUW_NEW_QUESTION";hi.FINISHED="RWPUW_QUESION_FINSIHED";hi.ANSWERED="RWPUW_QUESTION_ANSWERED";const $R=class eO extends He{constructor(e){super(eO.UPDATED),this._uiFlags=e}get uiFlags(){return this._uiFlags}};$R.UPDATED="APUE_UPDATED";let u0=$R;const tO=class sO extends He{constructor(e){super(sO.UNUE_NAME_UPDATED),this._name=e}get name(){return this._name}};tO.UNUE_NAME_UPDATED="unue_name_updated";let Sp=tO;class h0{constructor(){this._messageIdByEvent=new Map,this._messageIdByComposer=new Map,this._messageInstancesById=new Map}dispose(){this._messageIdByEvent.clear(),this._messageIdByComposer.clear(),this._messageInstancesById.clear()}registerMessages(e){for(const[t,s]of e.events)this.registerMessageEventClass(t,s);for(const[t,s]of e.composers)this.registerMessageComposerClass(t,s)}registerMessageEventClass(e,t){!e||!t||this._messageIdByEvent.set(t,e)}registerMessageComposerClass(e,t){!e||!t||this._messageIdByComposer.set(t,e)}registerMessageEvent(e){if(!e)return;const t=this.getEventId(e);if(!t)return;let s=this._messageInstancesById.get(t);(!s||!s.length)&&(s=[],this._messageInstancesById.set(t,s)),s.push(e)}removeMessageEvent(e){if(!e)return;const t=this.getEventId(e);if(!t)return;const s=this._messageInstancesById.get(t);if(s){for(const[r,i]of s.entries())if(i&&i===e){s.splice(r,1),s.length===0&&this._messageInstancesById.delete(t),i.dispose();return}}}getEvents(e){if(!e)return;const t=this._messageInstancesById.get(e);if(t)return t}getEventId(e){if(!e)return-1;const t=e instanceof v?e.constructor:e,s=this._messageIdByEvent.get(t);return s||-1}getComposerId(e){if(!e)return-1;const t=this._messageIdByComposer.get(e.constructor);return t||-1}}class d0 extends jr{constructor(e,t){super(),this._communicationManager=e,this._stateListener=t,this._socket=null,this._messages=new h0,this._codec=new XU,this._dataBuffer=null,this._isReady=!1,this._pendingClientMessages=[],this._pendingServerMessages=[],this._isAuthenticated=!1,this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.onError=this.onError.bind(this),this.onMessage=this.onMessage.bind(this)}init(e){this._stateListener&&this._stateListener.connectionInit(e),this.createSocket(e)}onDispose(){super.onDispose(),this.destroySocket(),this._communicationManager=null,this._stateListener=null,this._messages=null,this._codec=null,this._dataBuffer=null}onReady(){this._isReady||(this._isReady=!0,this._pendingServerMessages&&this._pendingServerMessages.length&&this.processWrappers(...this._pendingServerMessages),this._pendingClientMessages&&this._pendingClientMessages.length&&this.send(...this._pendingClientMessages),this._pendingServerMessages=[],this._pendingClientMessages=[])}createSocket(e){e&&(this.destroySocket(),this._dataBuffer=new ArrayBuffer(0),this._socket=new WebSocket(e),this._socket.addEventListener(oi.CONNECTION_OPENED,this.onOpen),this._socket.addEventListener(oi.CONNECTION_CLOSED,this.onClose),this._socket.addEventListener(oi.CONNECTION_ERROR,this.onError),this._socket.addEventListener(oi.CONNECTION_MESSAGE,this.onMessage))}destroySocket(){this._socket&&(this._socket.removeEventListener(oi.CONNECTION_OPENED,this.onOpen),this._socket.removeEventListener(oi.CONNECTION_CLOSED,this.onClose),this._socket.removeEventListener(oi.CONNECTION_ERROR,this.onError),this._socket.removeEventListener(oi.CONNECTION_MESSAGE,this.onMessage),this._socket.readyState===WebSocket.OPEN&&this._socket.close(),this._socket=null)}onOpen(e){this.dispatchConnectionEvent(Ps.CONNECTION_OPENED,e)}onClose(e){this.dispatchConnectionEvent(Ps.CONNECTION_CLOSED,e)}onError(e){this.dispatchConnectionEvent(Ps.CONNECTION_ERROR,e)}onMessage(e){if(!e)return;const t=new FileReader;t.readAsArrayBuffer(e.data),t.onloadend=()=>{this._dataBuffer=this.concatArrayBuffers(this._dataBuffer,t.result),this.processReceivedData()}}dispatchConnectionEvent(e,t){this.dispatchEvent(new Ps(e,this,t))}authenticated(){this._isAuthenticated=!0}send(...e){if(this.disposed||!e)return!1;if(e=[...e],this._isAuthenticated&&!this._isReady)return this._pendingClientMessages||(this._pendingClientMessages=[]),this._pendingClientMessages.push(...e),!1;for(const t of e){if(!t)continue;const s=this._messages.getComposerId(t);if(s===-1){me.packets("Unknown Composer",t.constructor.name);continue}const r=t.getMessageArray(),i=this._codec.encode(s,r);if(!i){me.packets("Encoding Failed",t.constructor.name);continue}me.packets("OutgoingComposer",s,t.constructor.name,r),this.write(i.getBuffer())}return!0}write(e){this._socket.readyState===WebSocket.OPEN&&this._socket.send(e)}processReceivedData(){try{this.processData()}catch(e){me.error(e)}}processData(){const e=this.splitReceivedMessages();if(!(!e||!e.length)){if(this._isAuthenticated&&!this._isReady){this._pendingServerMessages||(this._pendingServerMessages=[]),this._pendingServerMessages.push(...e);return}this.processWrappers(...e)}}processWrappers(...e){if(!(!e||!e.length))for(const t of e){if(!t)continue;const s=this.getMessagesForWrapper(t);!s||!s.length||(me.packets("IncomingMessage",t.header,s[0].constructor.name,s[0].parser),this.handleMessages(...s))}}splitReceivedMessages(){return!this._dataBuffer||!this._dataBuffer.byteLength?null:this._codec.decode(this)}concatArrayBuffers(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s.buffer}getMessagesForWrapper(e){if(!e)return null;const t=this._messages.getEvents(e.header);if(!t||!t.length){me.packets("IncomingMessage",e.header,"UNREGISTERED",e);return}try{const s=new t[0].parserClass;if(!s||!s.flush()||!s.parse(e))return null;for(const r of t)r.parser=s}catch(s){return me.error("Error parsing message",s,t[0].constructor.name),null}return t}handleMessages(...e){e=[...e];for(const t of e)t&&(t.connection=this,t.callBack&&t.callBack(t))}registerMessages(e){e&&this._messages.registerMessages(e)}addMessageEvent(e){!e||!this._messages||this._messages.registerMessageEvent(e)}removeMessageEvent(e){!e||!this._messages||this._messages.removeMessageEvent(e)}get isAuthenticated(){return this._isAuthenticated}get dataBuffer(){return this._dataBuffer}set dataBuffer(e){this._dataBuffer=e}}class _0 extends Hr{constructor(){super(),this._connections=[]}onDispose(){if(!(!this._connections||!this._connections.length))for(const e of this._connections.values())e&&e.dispose()}createConnection(e=null){const t=new d0(this,e);if(t)return this._connections.push(t),t}update(e){let t=0;for(;t<this._connections.length;){const s=this._connections[t];if(s.processReceivedData(),this.disposed)return;s.disposed?this._connections.splice(t,1):t++}}}class _i extends He{constructor(e){super(e)}}_i.LOADED="NCE_LOADED";_i.FAILED="NCE_FAILED";class g0 extends En{constructor(){super(),this._definitions=new Map,this._config=[],this._pendingUrls=[],this._missingKeys=[],this.onConfigurationLoaded=this.onConfigurationLoaded.bind(this)}onInit(){Ue.parseConfiguration(this.getDefaultConfig(),!0),this._pendingUrls=Ue.getValue("config.urls").slice(),this.loadNextConfiguration()}loadNextConfiguration(){if(!this._pendingUrls.length){this.dispatchConfigurationEvent(_i.LOADED);return}this.loadConfigurationFromUrl(this._pendingUrls[0])}loadConfigurationFromUrl(e){if(!e||e===""){this.dispatchConfigurationEvent(_i.FAILED);return}fetch(e).then(t=>t.json()).then(t=>this.onConfigurationLoaded(t,e)).catch(t=>this.onConfigurationFailed(t))}onConfigurationLoaded(e,t){if(e){if(Ue.parseConfiguration(e)){const s=this._pendingUrls.indexOf(t);s>=0&&this._pendingUrls.splice(s,1),this.loadNextConfiguration();return}this.dispatchConfigurationEvent(_i.FAILED)}}onConfigurationFailed(e){this.dispatchConfigurationEvent(_i.FAILED)}dispatchConfigurationEvent(e){this.events&&this.events.dispatchEvent(new _i(e))}getDefaultConfig(){return NitroConfig}}const dm=class dc{static sayHello(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){const e=[`
 %c %c %c Nitro ${dc.UI_VERSION} - Renderer ${dc.RENDERER_VERSION} %c %c %c https://discord.nitrodev.co %c %c 

`,"background: #ffffff; padding:5px 0;","background: #ffffff; padding:5px 0;","color: #ffffff; background: #000000; padding:5px 0;","background: #ffffff; padding:5px 0;","background: #ffffff; padding:5px 0;","background: #000000; padding:5px 0;","background: #ffffff; padding:5px 0;","background: #ffffff; padding:5px 0;"];self.console.log(...e)}else self.console&&self.console.log(`Nitro ${dc.UI_VERSION} - Renderer ${dc.RENDERER_VERSION} `)}};dm.RENDERER_VERSION="1.6.6";dm.UI_VERSION="";let Id=dm;class f0 extends Hr{constructor(){super(),Id.sayHello(),this._configuration=new g0,this._communication=new _0}onDispose(){this._communication&&(this._communication.dispose(),this._communication=null)}get configuration(){return this._configuration}get communication(){return this._communication}}class m0{constructor(e){this._id=parseInt(e.id),this._value=parseInt(e.id),this._prevents=e.prevents||[],this._preventHeadTurn=e.preventHeadTurn||!1,this._isAnimated=!0,e.animated!==void 0&&e.animated===!1&&(this._isAnimated=!1)}get id(){return this._id}get value(){return this._value}get prevents(){return this._prevents}get preventHeadTurn(){return this._preventHeadTurn}get isAnimated(){return this._isAnimated}}class E0{constructor(e){if(this._id=e.id,this._state=e.state,this._precedence=e.precedence,this._activePartSet=e.activePartSet,this._assetPartDefinition=e.assetPartDefinition,this._lay=e.lay,this._geometryType=e.geometryType,this._isMain=e.main||!1,this._isDefault=e.isDefault||!1,this._isAnimation=e.animation||!1,this._startFromFrameZero=e.startFromFrameZero||!1,this._prevents=e.prevents||[],this._preventHeadTurn=e.preventHeadTurn||!1,this._types=new Map,this._params=new Map,this._defaultParameterValue="",this._canvasOffsets=null,e.params&&e.params.length>0)for(const t of e.params)t&&(t.id==="default"?this._defaultParameterValue=t.value:this._params.set(t.id,t.value));if(e.types&&e.types.length>0)for(const t of e.types){if(!t)continue;const s=new m0(t);this._types.set(s.id,s)}}setOffsets(e,t,s){this._canvasOffsets||(this._canvasOffsets=new Map);let r=this._canvasOffsets.get(e);r||(r=new Map,this._canvasOffsets.set(e,r)),r.set(t,s)}getOffsets(e,t){if(!this._canvasOffsets)return null;const s=this._canvasOffsets.get(e);return s?s.get(t):null}getType(e){if(!e)return null;const t=this._types.get(parseInt(e));return t||null}getParameterValue(e){if(!e)return"";const t=this._params.get(e);return t||this._defaultParameterValue}getPrevents(e){return this._prevents.concat(this.getTypePrevents(e))}getTypePrevents(e){if(!e)return[];const t=this._types.get(parseInt(e));return t?t.prevents:[]}getPreventHeadTurn(e){if(!e)return this._preventHeadTurn;const t=this.getType(e);return t?t.preventHeadTurn:this._preventHeadTurn}isAnimated(e){if(!e)return!0;const t=this.getType(e);return t?t.isAnimated:!0}get id(){return this._id}get state(){return this._state}get precedence(){return this._precedence}get activePartSet(){return this._activePartSet}get assetPartDefinition(){return this._assetPartDefinition}get lay(){return this._lay}get geometryType(){return this._geometryType}get isMain(){return this._isMain}get isDefault(){return this._isDefault}get isAnimation(){return this._isAnimation}get startFromFrameZero(){return this._startFromFrameZero}get prevents(){return this._prevents}get preventHeadTurn(){return this._preventHeadTurn}get params(){return this._params}}class Og{constructor(e,t="",s=0){this._actionType=e||"",this._actionParameter=t||"",this._definition=null,this._startFrame=s||0,this._overridingAction=null}dispose(){this._actionType=null,this._actionParameter=null,this._definition=null}get id(){return this._definition?this._definition.id+"_"+this._actionParameter:""}get actionType(){return this._actionType}get actionParameter(){return this._actionParameter}set actionParameter(e){this._actionParameter=e}get definition(){return this._definition}set definition(e){this._definition=e}get startFrame(){return this._startFrame}get overridingAction(){return this._overridingAction}set overridingAction(e){this._overridingAction=e}}class p0{constructor(e,t){this._assets=e,this._actions=new Map,this._defaultAction=null,this.updateActions(t)}updateActions(e){if(e){for(const t of e.actions){if(!t||!t.state)continue;const s=new E0(t);this._actions.set(s.state,s)}e.actionOffsets&&this.parseActionOffsets(e.actionOffsets)}}parseActionOffsets(e){if(!(!e||!e.length))for(const t of e){const s=this._actions.get(t.action);if(s)for(const r of t.offsets){const i=r.size||"",a=r.direction;if(i===""||a===void 0)continue;const l=r.x||0,c=r.y||0,u=r.z||0;s.setOffsets(i,a,[l,c,u])}}}getActionDefinition(e){if(!e)return null;for(const t of this._actions.values())if(!(!t||t.id!==e))return t;return null}getActionDefinitionWithState(e){const t=this._actions.get(e);return t||null}getDefaultAction(){if(this._defaultAction)return this._defaultAction;for(const e of this._actions.values())if(!(!e||!e.isDefault))return this._defaultAction=e,e;return null}getCanvasOffsets(e,t,s){let r=[];for(const i of e){if(!i)continue;const a=this._actions.get(i.actionType),l=a&&a.getOffsets(t,s);l&&(r=l)}return r}sortActions(e){if(!e)return null;e=this.filterActions(e);const t=[];for(const s of e){if(!s)continue;const r=this._actions.get(s.actionType);r&&(s.definition=r,t.push(s))}return t.sort(this.sortByPrecedence),t}filterActions(e){let t=[];const s=[];for(const r of e){if(!r)continue;const i=this._actions.get(r.actionType);i&&(t=t.concat(i.getPrevents(r.actionParameter)))}for(const r of e){if(!r)continue;let i=r.actionType;r.actionType==="fx"&&(i=i+("."+r.actionParameter)),!(t.indexOf(i)>=0)&&s.push(r)}return s}sortByPrecedence(e,t){if(!e||!t)return 0;const s=e.definition.precedence,r=t.definition.precedence;return s<r?1:s>r?-1:0}}class I0{constructor(e,t){this._name=e,this._link=t.link,this._flipH=t.flipH,this._flipV=t.flipV}get name(){return this._name}get link(){return this._link}get flipH(){return this._flipH}get flipV(){return this._flipV}}class T0{constructor(e,t){this._avatarRenderManager=e,this._aliases=new Map,this._assets=t,this._missingAssetNames=[]}dispose(){this._assets=null,this._aliases=null}reset(){this.init()}init(){for(const e of this._assets.collections.values()){if(!e)continue;const t=e.data&&e.data.aliases;if(t)for(const s in t){const r=t[s];r&&this._aliases.set(s,new I0(s,r))}}}hasAlias(e){return!!this._aliases.get(e)}getAssetName(e){let t=e,s=5;for(;this.hasAlias(t)&&s>=0;)t=this._aliases.get(t).link,s--;return t}getAsset(e){if(!this._assets)return null;e=this.getAssetName(e);const t=this._assets.getAsset(e);return t||null}}class R0{constructor(e){this._id=e.id||"",this._align=e.align||"",this._base=e.base||"",this._ink=e.ink||0,this._blend=0;const t=e.blend;t&&t.length>0&&(this._blend=parseInt(t),this._blend>1&&(this._blend=this._blend/100))}get id(){return this._id}get align(){return this._align}get base(){return this._base}get ink(){return this._ink}get blend(){return this._blend}get isBlended(){return this._blend!==1}}class Pi{constructor(e,t,s){if(this._id=e.id,this._animationFrame=e.frame||0,this._dx=e.dx||0,this._dy=e.dy||0,this._dz=e.dz||0,this._directionOffset=e.dd||0,this._type=t,this._base=e.base||"",this._items=new Map,e.items)for(const r of e.items)this._items.set(r.id,r.base);this._base!==""&&this.baseAsInt().toString(),s&&(this._action=new Og(s.state,this.base),this._action.definition=s)}get items(){return this._items}baseAsInt(){let e=0,t=0;for(;t<this._base.length;)e=e+this._base.charCodeAt(t),t++;return e}get id(){return this._id}get animationFrame(){return this._animationFrame}get dx(){return this._dx}get dy(){return this._dy}get dz(){return this._dz}get dd(){return this._directionOffset}get type(){return this._type}get base(){return this._base}get action(){return this._action}}Pi.BODYPART="bodypart";Pi.FX="fx";class O0{constructor(e){this._ink=e.ink;let t=e.foreground,s=e.background;t=t.replace("#",""),s=s.replace("#",""),this._foreGround=parseInt(t,16),this._backGround=parseInt(s,16),this._colorTransform=null,this._rgb=parseInt(t,16),this._r=this._rgb>>16&255,this._g=this._rgb>>8&255,this._b=this._rgb>>0&255,this._redMultiplier=this._r/255*1,this._greenMultiplier=this._g/255*1,this._blueMultiplier=this._b/255*1,this._alphaMultiplier=1,this._paletteIsGrayscale=!0,this._ink===37&&(this._alphaMultiplier=.5,this._paletteIsGrayscale=!1),this._colorTransform=new CT({red:this._r/255,green:this._g/255,blue:this._b/255,alpha:this._alphaMultiplier}),this._colorMap=this.generatePaletteMapForGrayscale(this._backGround,this._foreGround)}get ink(){return this._ink}get colorTransform(){return this._colorTransform}get reds(){return this._colorMap.get("reds")}get greens(){return this._colorMap.get("greens")}get blues(){return this._colorMap.get("blues")}get alphas(){return this._colorMap.get("alphas")}get paletteIsGrayscale(){return this._paletteIsGrayscale}generatePaletteMapForGrayscale(e,t){const s=e>>24&255,r=e>>16&255,i=e>>8&255,a=e>>0&255,l=t>>24&255,c=t>>16&255,u=t>>8&255,h=t>>0&255,d=(l-s)/255,f=(c-r)/255,E=(u-i)/255,m=(h-a)/255,R=new Map,I=[],S=[],A=[];let N=s,L=r,M=i,b=a;for(let B=0;B<256;B++)L==r&&M==i&&b==a&&(N=0),N=N+d,L=L+f,M=M+E,b=b+m,I.push(N<<24|L<<16|M<<8|b),S.push(N<<24|L<<16|M<<8|b),A.push(N<<24|L<<16|M<<8|b);return R.set("alphas",I),R.set("reds",I),R.set("greens",S),R.set("blues",A),R}}class S0{constructor(e){this._offset=e.offset}get offset(){return this._offset}}class C0{constructor(e,t){this._animation=e,this._id=t.id,this._ink=t.ink,this._member=t.member,this._hasStaticY=!!t.staticY,this._hasDirections=!!t.directions,this._dx=[],this._dy=[],this._dz=[];const s=t.directionList;if(s&&s.length)for(const r of s){const i=r.id;i!==void 0&&(this._dx[i]=r.dx||0,this._dy[i]=r.dy||0,this._dz[i]=r.dz||0)}}getDirectionOffsetX(e){return e<this._dx.length?this._dx[e]:0}getDirectionOffsetY(e){return e<this._dy.length?this._dy[e]:0}getDirectionOffsetZ(e){return e<this._dz.length?this._dz[e]:0}get animation(){return this._animation}get id(){return this._id}get ink(){return this._ink}get member(){return this._member}get hasDirections(){return this._hasDirections}get hasStaticY(){return this._hasStaticY}}const rO=class lh{constructor(e,t){if(this._id=t.name,this._description=this._id,this._frames=[],this._spriteData=null,this._avatarData=null,this._directionData=null,this._removeData=null,this._addData=null,this._overriddenActions=null,this._overrideFrames=null,this._resetOnToggle=t.resetOnToggle||!1,t.sprites&&t.sprites.length){this._spriteData=[];for(const s of t.sprites)this._spriteData.push(new C0(this,s))}if(t.avatars&&t.avatars.length&&(this._avatarData=new O0(t.avatars[0])),t.directions&&t.directions.length&&(this._directionData=new S0(t.directions[0])),t.removes&&t.removes.length){this._removeData=[];for(const s of t.removes)this._removeData.push(s.id)}if(t.adds&&t.adds.length){this._addData=[];for(const s of t.adds)this._addData.push(new R0(s))}if(t.overrides&&t.overrides.length){this._overrideFrames=new Map,this._overriddenActions=new Map;for(const s of t.overrides){const r=s.name,i=s.override;this._overriddenActions.set(i,r);const a=[];this.parseFrames(a,s.frames,e),this._overrideFrames.set(r,a)}}this.parseFrames(this._frames,t.frames,e)}parseFrames(e,t,s){if(!(!t||!t.length))for(const r of t){let i=1;r.repeats&&r.repeats>1&&(i=r.repeats);let a=0;for(;a<i;){const l=[];if(r.bodyparts&&r.bodyparts.length)for(const c of r.bodyparts){const u=s.getActionDefinition(c.action),h=new Pi(c,Pi.BODYPART,u);l.push(h)}if(r.fxs&&r.fxs.length)for(const c of r.fxs){const u=s.getActionDefinition(c.action),h=new Pi(c,Pi.FX,u);l.push(h)}e.push(l),a++}}}frameCount(e=null){if(!e)return this._frames.length;if(this._overrideFrames){const t=this._overrideFrames.get(e);if(t)return t.length}return 0}hasOverriddenActions(){return this._overriddenActions?this._overriddenActions.size>0:!1}overriddenActionNames(){if(!this._overriddenActions)return null;const e=[];for(const t of this._overriddenActions.keys())e.push(t);return e}overridingAction(e){return this._overriddenActions?this._overriddenActions.get(e):null}getFrame(e,t=null){e<0&&(e=0);let s=[];if(!t)this._frames.length>0&&(s=this._frames[e%this._frames.length]);else{const r=this._overrideFrames.get(t);r&&r.length>0&&(s=r[e%r.length])}return s}getAnimatedBodyPartIds(e,t=null){const s=[];for(const r of this.getFrame(e,t))if(r.type===Pi.BODYPART)s.push(r.id);else if(r.type===Pi.FX&&this._addData&&this._addData.length)for(const i of this._addData)i.id===r.id&&s.push(i.align);return s}getLayerData(e,t,s=null){for(const r of this.getFrame(e,s)){if(r.id===t)return r;if(r.type===Pi.FX&&this._addData&&this._addData.length){for(const i of this._addData)if(i.align===t&&i.id===r.id)return r}}return null}hasAvatarData(){return this._avatarData!==null}hasDirectionData(){return this._directionData!==null}hasAddData(){return this._addData!==null}getAddData(e){if(this._addData){for(const t of this._addData)if(t.id===e)return t}return null}get id(){return this._id}get spriteData(){return this._spriteData||lh.EMPTY_ARRAY}get avatarData(){return this._avatarData}get directionData(){return this._directionData}get removeData(){return this._removeData||lh.EMPTY_ARRAY}get addData(){return this._addData||lh.EMPTY_ARRAY}toString(){return this._description}get resetOnToggle(){return this._resetOnToggle}};rO.EMPTY_ARRAY=[];let A0=rO;class N0{constructor(){this._animations=new Map}registerAnimation(e,t){if(!t)return!1;const s=t[Object.keys(t)[0]],r=new A0(e,s);return this._animations.set(s.name,r),!0}getAnimation(e){const t=this._animations.get(e);return t||null}getLayerData(e,t,s){const r=this.getAnimation(e);return r?r.getLayerData(t,s):null}get animations(){return this._animations}}const $c=class Mn extends jr{constructor(e,t,s,r){super(),this._state=Mn.NOT_LOADED,this._libraryName=e,this._revision=t,this._downloadUrl=r,this._assets=s,this._downloadUrl=this._downloadUrl.replace(/%libname%/gi,this._libraryName),this._downloadUrl=this._downloadUrl.replace(/%revision%/gi,this._revision),this._assets.getCollection(this._libraryName)&&(this._state=Mn.LOADED)}async downloadAsset(){if(!this._assets||this._state===Mn.LOADING||this._state===Mn.LOADED)return;if(this._assets.getCollection(this._libraryName)){this._state=Mn.LOADED,this.dispatchEvent(new ol(ol.DOWNLOAD_COMPLETE,this));return}this._state=Mn.LOADING,await this._assets.downloadAsset(this._downloadUrl)&&(this._state=Mn.LOADED,this.dispatchEvent(new ol(ol.DOWNLOAD_COMPLETE,this)))}get libraryName(){return this._libraryName}get isLoaded(){return this._state===Mn.LOADED}};$c.DOWNLOAD_COMPLETE="AADL_DOWNLOAD_COMPLETE";$c.NOT_LOADED=0;$c.LOADING=1;$c.LOADED=2;let y0=$c;const Td=class Sg extends jr{constructor(e,t){super(),this._assets=e,this._structure=t,this._missingMandatoryLibs=Ue.getValue("avatar.mandatory.libraries"),this._figureMap=new Map,this._pendingContainers=[],this._figureListeners=new Map,this._incompleteFigures=new Map,this._pendingDownloadQueue=[],this._currentDownloads=[],this._libraryNames=[],this._isReady=!1,this.onLibraryLoaded=this.onLibraryLoaded.bind(this),this.onAvatarRenderReady=this.onAvatarRenderReady.bind(this),this.loadFigureMap(),this._structure.renderManager.events.addEventListener(pd.AVATAR_RENDER_READY,this.onAvatarRenderReady)}loadFigureMap(){const e=new XMLHttpRequest;try{e.open("GET",Ue.getValue("avatar.figuremap.url")),e.send(),e.onloadend=t=>{if(e.responseText){const s=JSON.parse(e.responseText);this.processFigureMap(s.libraries),this.processMissingLibraries(),this._isReady=!0,this.dispatchEvent(new He(Sg.DOWNLOADER_READY))}},e.onerror=t=>{throw new Error("invalid_avatar_figure_map")}}catch(t){me.error(t)}}processFigureMap(e){if(e)for(const t of e){if(!t)continue;const s=t.id,r=t.revision||"";if(this._libraryNames.indexOf(s)>=0)continue;this._libraryNames.push(s);const i=new y0(s,r,this._assets,Ue.getValue("avatar.asset.url"));i.addEventListener(ol.DOWNLOAD_COMPLETE,this.onLibraryLoaded);for(const a of t.parts){const l=a.id,u=a.type+":"+l;let h=this._figureMap.get(u);h||(h=[]),h.push(i),this._figureMap.set(u,h)}}}onAvatarRenderReady(e){if(e){for(const[t,s]of this._pendingContainers)this.downloadAvatarFigure(t,s);this._pendingContainers=[]}}onLibraryLoaded(e){if(!e||!e.library)return;const t=[];for(const[r,i]of this._incompleteFigures.entries()){let a=!0;for(const l of i)if(!(!l||l.isLoaded)){a=!1;break}if(a){t.push(r);const l=this._figureListeners.get(r);if(l)for(const c of l)!c||c.disposed||c.resetFigure(r);this._figureListeners.delete(r),this.dispatchEvent(new He(Sg.LIBRARY_LOADED))}}for(const r of t)r&&this._incompleteFigures.delete(r);let s=0;for(;s<this._currentDownloads.length;){const r=this._currentDownloads[s];r&&r.libraryName===e.library.libraryName&&this._currentDownloads.splice(s,1),s++}}processMissingLibraries(){const e=this._missingMandatoryLibs.slice();for(const t of e){if(!t)continue;const s=this._figureMap.get(t);if(s)for(const r of s)r&&this.downloadLibrary(r)}}isAvatarFigureContainerReady(e){return!this._isReady||!this._structure.renderManager.isReady?!1:!this.getAvatarFigurePendingLibraries(e).length}getAvatarFigurePendingLibraries(e){const t=[];if(!e||!this._structure)return t;const s=this._structure.figureData;if(!s)return t;const r=e.getPartTypeIds();for(const i of r){const a=s.getSetType(i);if(!a)continue;const l=a.getPartSet(e.getPartSetId(i));if(l)for(const c of l.parts){if(!c)continue;const u=c.type+":"+c.id,h=this._figureMap.get(u);if(h!==void 0)for(const d of h)!d||d.isLoaded||t.indexOf(d)>=0||t.push(d)}}return t}downloadAvatarFigure(e,t){if(!this._isReady||!this._structure.renderManager.isReady){this._pendingContainers.push([e,t]);return}const s=e.getFigureString(),r=this.getAvatarFigurePendingLibraries(e);if(r&&r.length){if(t&&!t.disposed){let i=this._figureListeners.get(s);i||(i=[],this._figureListeners.set(s,i)),i.push(t)}this._incompleteFigures.set(s,r);for(const i of r)i&&this.downloadLibrary(i)}else t&&!t.disposed&&t.resetFigure(s)}downloadLibrary(e){!e||e.isLoaded||this._pendingDownloadQueue.indexOf(e)>=0||this._currentDownloads.indexOf(e)>=0||(this._pendingDownloadQueue.push(e),this.processDownloadQueue())}processDownloadQueue(){for(;this._pendingDownloadQueue.length;)this._pendingDownloadQueue[0].downloadAsset(),this._currentDownloads.push(this._pendingDownloadQueue.shift())}};Td.DOWNLOADER_READY="AADM_DOWNLOADER_READY";Td.LIBRARY_LOADED="AADM_LIBRARY_LOADED";Td.MAX_DOWNLOADS=2;let ac=Td;class Mc{constructor(e){this._parts=new Map,this.parseFigure(e)}getPartTypeIds(){return this.partSets().keys()}hasPartType(e){return!!this.partSets().get(e)}getPartSetId(e){const t=this.partSets().get(e);return t?t.get("setid"):0}getPartColorIds(e){const t=this.partSets().get(e);return t?t.get("colorids"):null}updatePart(e,t,s){const r=new Map;r.set("type",e),r.set("setid",t),r.set("colorids",s);const i=this.partSets();i.delete(e),i.set(e,r)}removePart(e){this.partSets().delete(e)}getFigureString(){const e=[];for(const t of this.partSets().keys()){if(!t)continue;let s=[];s.push(t),s.push(this.getPartSetId(t)),s=s.concat(this.getPartColorIds(t)),e.push(s.join("-"))}return e.join(".")}partSets(){return this._parts||(this._parts=new Map),this._parts}parseFigure(e){e||(e="");for(const t of e.split(".")){const s=t.split("-");if(s.length>=2){const r=s[0],i=parseInt(s[1]),a=[];let l=2;for(;l<s.length;)a.push(parseInt(s[l])),l++;this.updatePart(r,i,a)}}}}class M0{constructor(){this._cache=new Map,this.setLastAccessTime(ve())}dispose(){if(this.debugInfo("[dispose]"),!!this._cache){for(const e of this._cache.values())e&&e.dispose();this._cache.clear()}}getDirectionCache(e){const t=this._cache.get(e.toString());return t||null}updateDirectionCache(e,t){this._cache.set(e.toString(),t)}setLastAccessTime(e){this._lastAccessTime=e}getLastAccessTime(){return this._lastAccessTime}debugInfo(e){}}class Cp{constructor(){this._cache=new Map}setAction(e,t){this._currentAction||(this._currentAction=e);const s=this.getActionCache(this._currentAction);s&&s.setLastAccessTime(t),this._currentAction=e}dispose(){if(!this._disposed){if(!this._cache)return;this.disposeActions(0,2147483647),this._cache.clear(),this._cache=null,this._disposed=!0}}disposeActions(e,t){if(!(!this._cache||this._disposed))for(const[s,r]of this._cache.entries()){if(!r)continue;const i=r.getLastAccessTime();t-i>=e&&(r.dispose(),this._cache.delete(s))}}getAction(){return this._currentAction}setDirection(e){this._currentDirection=e}getDirection(){return this._currentDirection}getActionCache(e=null){return this._currentAction?(e||(e=this._currentAction),e.overridingAction?this._cache.get(e.overridingAction):this._cache.get(e.id)):null}updateActionCache(e,t){e.overridingAction?this._cache.set(e.overridingAction,t):this._cache.set(e.id,t)}debugInfo(e){}}class D0{constructor(e,t,s){this._image=e,this._regPoint=t,this._offset=new Fe(0,0),this._regPoint=t,this._isCacheable=s,this.cleanPoints()}dispose(){this._image&&this._image.destroy({children:!0}),this._image=null,this._regPoint=null,this._offset=null}cleanPoints(){}setRegPoint(e){this._regPoint=e,this.cleanPoints()}get image(){return this._image}set image(e){this._image&&this._image!==e&&this._image.destroy({children:!0}),this._image=e}get regPoint(){const e=this._regPoint.clone();return e.x+=this._offset.x,e.y+=this._offset.y,e}set offset(e){this._offset=e,this.cleanPoints()}get isCacheable(){return this._isCacheable}}class v0{constructor(e){this._partList=e,this._images=new Map}dispose(){for(const e of this._images.values())e&&e.dispose();this._images=null}getPartList(){return this._partList}getImageContainer(e){const t=this._images.get(this.getCacheKey(e));return t||null}updateImageContainer(e,t){const s=this.getCacheKey(t),r=this._images.get(s);r&&r.dispose(),this._images.set(s,e)}getCacheKey(e){let t="";for(const s of this._partList)t+=s.getCacheableKey(e)+"/";return t}debugInfo(e){}}class Ap{constructor(e,t,s,r,i,a=null){this._texture=e,this._container=a,this._rect=t,this._regPoint=s,this._flipH=r,this._colorTransform=i,r&&(this._regPoint.x=-this._regPoint.x+t.width)}dispose(){this._texture=null,this._regPoint=null,this._colorTransform=null}get texture(){return this._texture}get container(){return this._container}get rect(){return this._rect}get regPoint(){return this._regPoint}get flipH(){return this._flipH}get colorTransform(){return this._colorTransform}get offsetRect(){return new Gr(-this._regPoint.x,-this._regPoint.y,this._rect.width,this._rect.height)}}class iO{constructor(e,t,s,r){this._structure=e,this._avatar=t,this._assets=s,this._scale=r,this._cache=new Map,this._canvas=null,this._disposed=!1,this._unionImages=[],this._matrix=new Or,this._serverRenderData=[]}dispose(){if(!this._disposed){if(this._structure=null,this._avatar=null,this._assets=null,this._canvas=null,this._disposed=!0,this._cache){for(const e of this._cache.values())e&&e.dispose();this._cache=null}if(this._unionImages){for(const e of this._unionImages)e&&e.dispose();this._unionImages=[]}}}disposeInactiveActions(e=6e4){const t=ve();if(this._cache)for(const s of this._cache.values())s&&s.disposeActions(e,t)}resetBodyPartCache(e){if(this._cache)for(const t of this._cache.values())t&&t.setAction(e,0)}setDirection(e,t){const s=this._structure.getBodyPartsUnordered(e);if(s)for(const r of s){const i=this.getBodyPartCache(r);i&&i.setDirection(t)}}setAction(e,t){const s=this._structure.getActiveBodyPartIds(e,this._avatar);for(const r of s){const i=this.getBodyPartCache(r);i&&i.setAction(e,t)}}setGeometryType(e){if(this._geometryType!==e){if(this._geometryType===Ui.SITTING&&e===Ui.VERTICAL||this._geometryType===Ui.VERTICAL&&e===Ui.SITTING||this._geometryType===Ui.SNOWWARS_HORIZONTAL&&(e=Ui.SNOWWARS_HORIZONTAL)){this._geometryType=e,this._canvas=null;return}this.disposeInactiveActions(0),this._geometryType=e,this._canvas=null}}getImageContainer(e,t,s=!1){let r=this.getBodyPartCache(e);r||(r=new Cp,this._cache.set(e,r));let i=r.getDirection(),a=r.getAction(),l=t;a.definition.startFromFrameZero&&(l-=a.startFrame);let c=a,u=[],h=new Map;const d=new Fe;if(!(!a||!a.definition)&&a.definition.isAnimation){let I=i;const S=this._structure.getAnimation(a.definition.state+"."+a.actionParameter),A=t-a.startFrame;if(S){const N=S.getLayerData(A,e,a.overridingAction);N&&(I=i+N.dd,N.dd<0?I<0?I=8+I:I>7&&(I=8-I):I<0?I=I+8:I>7&&(I=I-8),this._scale===Xr.LARGE?(d.x=N.dx,d.y=N.dy):(d.x=N.dx/2,d.y=N.dy/2),l=N.animationFrame,N.action&&(a=N.action),N.type===Pi.BODYPART?(N.action!=null&&(c=N.action),i=I):N.type===Pi.FX&&(i=I),h=N.items),u=S.removeData}}let f=r.getActionCache(c);(!f||s)&&(f=new M0,r.updateActionCache(c,f));let E=f.getDirectionCache(i);if(!E||s){const I=this._structure.getParts(e,this._avatar.getFigure(),c,this._geometryType,i,u,this._avatar,h);E=new v0(I),f.updateDirectionCache(i,E)}let m=E.getImageContainer(l);if(!m||s){const I=E.getPartList();if(m=this.renderBodyPart(i,I,l,a,s),m&&!s)m.isCacheable&&E.updateImageContainer(m,l);else return null}const R=this._structure.getFrameBodyPartOffset(c,i,l,e);return d.x+=R.x,d.y+=R.y,m.offset=d,m}getServerRenderData(){return this._serverRenderData=[],this._serverRenderData}getBodyPartCache(e){let t=this._cache.get(e);return t||(t=new Cp,this._cache.set(e,t)),t}renderBodyPart(e,t,s,r,i=!1){if(!t||!t.length||!this._canvas&&(this._canvas=this._structure.getCanvas(this._scale,this._geometryType),!this._canvas))return null;const a=xr.DIRECTION_IS_FLIPPED[e]||!1;let l=r.definition.assetPartDefinition,c=!0,u=t.length-1;for(;u>=0;){const m=t[u];let R=16777215;if(!(e==7&&(m.partType==="fc"||m.partType==="ey"))&&!(m.partType==="ri"&&!m.partId)){const I=m.partId,S=m.getFrameDefinition(s);let A=m.partType,N=0;S?(N=S.number,S.assetPartDefinition&&S.assetPartDefinition!==""&&(l=S.assetPartDefinition)):N=m.getFrameIndex(s);let L=e,M=!1;a&&(l==="wav"&&(A===qe.LEFT_HAND||A===qe.LEFT_SLEEVE||A===qe.LEFT_COAT_SLEEVE)||l==="drk"&&(A===qe.RIGHT_HAND||A===qe.RIGHT_SLEEVE||A===qe.RIGHT_COAT_SLEEVE)||l==="blw"&&A===qe.RIGHT_HAND||l==="sig"&&A===qe.LEFT_HAND||l==="respect"&&A===qe.LEFT_HAND||A===qe.RIGHT_HAND_ITEM||A===qe.LEFT_HAND_ITEM||A===qe.CHEST_PRINT?M=!0:(e===4?L=2:e===5?L=1:e===6&&(L=0),m.flippedPartType!==A&&(A=m.flippedPartType)));let b=this._scale+"_"+l+"_"+A+"_"+I+"_"+L+"_"+N,B=this._assets.getAsset(b);if(B||(b=this._scale+"_std_"+A+"_"+I+"_"+L+"_0",B=this._assets.getAsset(b)),B){const w=B.texture;if(!w||!w.valid||!w.baseTexture)c=!1;else{m.isColorable&&m.color&&(R=m.color.rgb);const x=new Fe(-B.x,-B.y);if(M&&(x.x=x.x+(this._scale===Xr.LARGE?65:31)),i){const U=new WT;U.name=this._assets.getAssetName(b),U.x=-x.x-33,U.y=-x.y,U.z=this._serverRenderData.length*-1e-4,U.width=B.rectangle.width,U.height=B.rectangle.height,U.flipH=M,l==="lay"&&(U.x=U.x+53),a&&(U.flipH=!U.flipH,U.flipH?U.x=-U.x-w.width:U.x=U.x+65),m.isColorable&&(U.color=`${R}`),this._serverRenderData.push(U)}this._unionImages.push(new Ap(w,B.rectangle,x,M,R))}}}u--}if(!this._unionImages.length)return null;const h=this.createUnionImage(this._unionImages,a),d=this._scale===Xr.LARGE?this._canvas.height-16:this._canvas.height-8,f=new Fe(-h.regPoint.x,d-h.regPoint.y);a&&l!=="lay"&&(f.x=f.x+(this._scale===Xr.LARGE?67:31));let E=this._unionImages.length-1;for(;E>=0;){const m=this._unionImages.pop();m&&m.dispose(),E--}return new D0(h.container,f,c)}convertColorToHex(e){let t=(e*255).toString(16);return t.length<2&&(t="0"+t),t}createUnionImage(e,t){const s=new Gr;for(const l of e)l&&s.enlarge(l.offsetRect);const r=new Fe(-s.x,-s.y),i=new di,a=new jt(ts.EMPTY);a.width=s.width,a.height=s.height,i.addChild(a);for(const l of e){if(!l)continue;const c=l.texture,u=l.colorTransform,h=!(t&&l.flipH)&&(t||l.flipH),d=r.clone();d.x-=l.regPoint.x,d.y-=l.regPoint.y,t&&(d.x=i.width-(d.x+l.rect.width)),h?(this._matrix.a=-1,this._matrix.tx=l.rect.x+l.rect.width+d.x,this._matrix.ty=d.y-l.rect.y):(this._matrix.a=1,this._matrix.tx=d.x-l.rect.x,this._matrix.ty=d.y-l.rect.y);const f=new jt(c);f.tint=u,f.transform.setFromMatrix(this._matrix),i.addChild(f)}return new Ap(null,i.getLocalBounds(),r,t,null,i)}}iO.DEFAULT_MAX_CACHE_STORAGE_TIME_MS=6e4;const pn=class Dn{constructor(e,t,s,r,i,a=null){this._frameCounter=0,this._directionOffset=0,this._isAnimating=!1,this._animationHasResetOnToggle=!1,this._actionsSorted=!1,this._fullImageCacheSize=5,this._isCachedImage=!1,this._useFullImageCache=!1,this._effectIdInUse=-1,this._cachedBodyPartsDirection=-1,this._cachedBodyPartsGeometryType=null,this._cachedBodyPartsAvatarSet=null,this._canvasOffsets=[],this._actions=[],this._cachedBodyParts=[],this._changes=!0,this._disposed=!1,this._effectManager=i,this._structure=e,this._assets=t,this._scale=r,this._effectListener=a,this._scale==null&&(this._scale=Xr.LARGE),s==null&&(s=new Mc("hr-893-45.hd-180-2.ch-210-66.lg-270-82.sh-300-91.wa-2007-.ri-1-")),this._figure=s,this._cache=new iO(this._structure,this,this._assets,this._scale),this.setDirection(Dn.DEFAULT_AVATAR_SET,Dn.DEFAULT_DIRECTION),this._actions=[],this._defaultAction=new Og(fe.POSTURE_STAND),this._defaultAction.definition=this._structure.getActionDefinition(Dn.DEFAULT_ACTION),this.resetActions(),this._fullImageCache=new Zt,this._animationFrameCount=0}getServerRenderData(){return this.getAvatarPartsForCamera(bs.FULL),this._cache.getServerRenderData()}dispose(){if(!this._disposed){if(this._structure=null,this._assets=null,this._mainAction=null,this._figure=null,this._avatarSpriteData=null,this._actions=null,this._image&&(this._image.destroy(),this._image=null),this._cache&&(this._cache.dispose(),this._cache=null),this._fullImageCache){for(const e of this._fullImageCache.getValues())e&&e.destroy();this._fullImageCache=null}this._image=null,this._canvasOffsets=null,this._disposed=!0}}get disposed(){return this._disposed}getFigure(){return this._figure}getScale(){return this._scale}getPartColor(e){return this._structure.getPartColor(this._figure,e)}setDirection(e,t){t=t+this._directionOffset,t<xr.MIN_DIRECTION&&(t=xr.MAX_DIRECTION+(t+1)),t>xr.MAX_DIRECTION&&(t=t-(xr.MAX_DIRECTION+1)),this._structure.isMainAvatarSet(e)&&(this._mainDirection=t),(e===bs.HEAD||e===bs.FULL)&&(e===bs.HEAD&&this.isHeadTurnPreventedByAction()&&(t=this._mainDirection),this._headDirection=t),this._cache.setDirection(e,t),this._changes=!0}setDirectionAngle(e,t){this.setDirection(e,Math.floor(t/45))}getSprites(){return this._sprites}getCanvasOffsets(){return this._canvasOffsets}getLayerData(e){return this._structure.getBodyPartData(e.animation.id,this._frameCounter,e.id)}updateAnimationByFrames(e=1){this._frameCounter+=e,this._changes=!0}resetAnimationFrameCounter(){this._frameCounter=0,this._changes=!0}getFullImageCacheKey(){if(!this._useFullImageCache)return null;if(this._sortedActions.length==1&&this._mainDirection==this._headDirection)return this._mainDirection+this._currentActionsString+this._frameCounter%4;if(this._sortedActions.length==2)for(const e of this._sortedActions){if(e.actionType=="fx"&&(e.actionParameter=="33"||e.actionParameter=="34"||e.actionParameter=="35"||e.actionParameter=="36"))return this._mainDirection+this._currentActionsString+0;if(e.actionType=="fx"&&(e.actionParameter=="38"||e.actionParameter=="39"))return this._mainDirection+"_"+this._headDirection+this._currentActionsString+this._frameCounter%11;if(e.actionType==="dance"&&(e.actionParameter==="1"||e.actionParameter==="2"||e.actionParameter==="3"||e.actionParameter==="4")){let t=this._frameCounter%8;return e.actionParameter==="3"&&(t=this._frameCounter%10),e.actionParameter==="4"&&(t=this._frameCounter%16),this._mainDirection+e.actionType+e.actionParameter+t}}return null}getBodyParts(e,t,s){return(s!=this._cachedBodyPartsDirection||t!=this._cachedBodyPartsGeometryType||e!=this._cachedBodyPartsAvatarSet)&&(this._cachedBodyPartsDirection=s,this._cachedBodyPartsGeometryType=t,this._cachedBodyPartsAvatarSet=e,this._cachedBodyParts=this._structure.getBodyParts(e,t,s)),this._cachedBodyParts}getAvatarPartsForCamera(e){let t;if(this._mainAction==null||this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType)==null)return;const r=this.getBodyParts(e,this._mainAction.definition.geometryType,this._mainDirection);let i=r.length-1;for(;i>=0;)t=r[i],this._cache.getImageContainer(t,this._frameCounter,!0),i--}getImage(e,t,s=1,r=!0){if(!this._changes)return this._image;if(!this._mainAction)return null;this._actionsSorted||this.endActionAppends();const i=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!i)return null;this._image&&(this._image.width!==i.width||this._image.height!==i.height)&&(this._reusableTexture&&(this._reusableTexture.destroy(!0),this._reusableTexture=null),this._image=null,this._isCachedImage=!1);const a=this.getBodyParts(e,this._mainAction.definition.geometryType,this._mainDirection);this._image=null;const l=new di;let c=!0,u=a.length-1;for(;u>=0;){const h=a[u],d=this._cache.getImageContainer(h,this._frameCounter);if(d){const f=d.image;if(!f)return l.destroy({children:!0}),null;c=c&&d.isCacheable;const E=d.regPoint.clone();if(E){E.x+=i.offset.x,E.y+=i.offset.y,E.x+=i.regPoint.x,E.y+=i.regPoint.y;const m=new di;m.addChild(f),m&&(m.position.set(E.x,E.y),l.addChild(m))}}u--}return this._avatarSpriteData&&(l.filters||(l.filters=[]),this._avatarSpriteData.colorTransform&&l.filters.push(this._avatarSpriteData.colorTransform),this._avatarSpriteData.paletteIsGrayscale&&(this.convertToGrayscale(l),l.filters.push(new pp(this._avatarSpriteData.reds,pp.CHANNEL_RED)))),r?(this._reusableTexture?(Us.instance.renderer.render(l,{renderTexture:this._reusableTexture,clear:!0}),this._reusableTexture.baseTexture.hitMap=null):this._reusableTexture=ht.generateTexture(l,new Gr(0,0,i.width,i.height)),this._reusableTexture?(this._image=this._reusableTexture,this._changes=!1,this._image):null):ht.generateTexture(l,new Gr(0,0,i.width,i.height))}applyPalette(e,t=[],s=[],r=[]){const i=ht.generateCanvas(e),a=i.getContext("2d"),l=a.getImageData(0,0,i.width,i.height),c=l.data;for(let h=0;h<c.length;h+=4){if(t.length==256){let d=t[c[h]];d===void 0&&(d=0),c[h]=d>>16&255,c[h+1]=d>>8&255,c[h+2]=d&255}if(s.length==256){let d=s[c[h+1]];d===void 0&&(d=0),c[h]=d>>16&255,c[h+1]=d>>8&255,c[h+2]=d&255}if(r.length==256){let d=s[c[h+2]];d===void 0&&(d=0),c[h]=d>>16&255,c[h+1]=d>>8&255,c[h+2]=d&255}}a.putImageData(l,0,0);const u=new es(ts.from(i));return Us.instance.renderer.render(u,{renderTexture:e,clear:!0}),e}getImageAsSprite(e,t=1){if(!this._mainAction)return null;this._actionsSorted||this.endActionAppends();const s=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!s)return null;const r=this.getBodyParts(e,this._mainAction.definition.geometryType,this._mainDirection),i=new jt,a=new jt(ts.EMPTY);a.width=s.width,a.height=s.height,i.addChild(a);let l=r.length-1;for(;l>=0;){const c=r[l],u=this._cache.getImageContainer(c,this._frameCounter);if(u){const h=u.image;if(!h)return i.destroy({children:!0}),null;const d=u.regPoint.clone();if(d){d.x+=s.offset.x,d.y+=s.offset.y,d.x+=s.regPoint.x,d.y+=s.regPoint.y;const f=new di;f.addChild(h),f.position.set(d.x,d.y),i.addChild(f)}}l--}return i}getCroppedImage(e,t=1){if(!this._mainAction)return null;this._actionsSorted||this.endActionAppends();const s=this._structure.getCanvas(this._scale,this._mainAction.definition.geometryType);if(!s)return null;const r=this.getBodyParts(e,this._mainAction.definition.geometryType,this._mainDirection),i=new di;let a=r.length-1;for(;a>=0;){const u=r[a],h=this._cache.getImageContainer(u,this._frameCounter);if(h){const d=h.image;if(!d)return i.destroy({children:!0}),null;const f=h.regPoint.clone();if(f){f.x+=s.offset.x,f.y+=s.offset.y,f.x+=s.regPoint.x,f.y+=s.regPoint.y;const E=new di;E.addChild(d),E&&(E.position.set(f.x,f.y),i.addChild(E))}}a--}const l=ht.generateTexture(i,new Gr(0,0,s.width,s.height)),c=ht.generateImage(l);return c||null}getFullImage(e){const t=this._fullImageCache.getValue(e);return t?(t.valid||(this._fullImageCache.remove(e),t.destroy(!0)),t):null}cacheFullImage(e,t){const s=this._fullImageCache.getValue(e);if(s&&(this._fullImageCache.remove(e),s.destroy(!0)),this._fullImageCache.length===this._fullImageCacheSize){const r=this._fullImageCache.getKey(0);r&&this._fullImageCache.remove(r).destroy(!0)}this._fullImageCache.add(e,t)}getAsset(e){return this._assets.getAsset(e)}getDirection(){return this._mainDirection}initActionAppends(){this._actions=[],this._actionsSorted=!1,this._currentActionsString="",this._useFullImageCache=!1}endActionAppends(){if(this.sortActions()){for(const e of this._sortedActions)e.actionType===fe.EFFECT&&(this._effectManager.isAvatarEffectReady(parseInt(e.actionParameter))||this._effectManager.downloadAvatarEffect(parseInt(e.actionParameter),this));this.resetActions(),this.setActionsToParts()}}appendAction(e,...t){let s="";switch(this._actionsSorted=!1,t&&t.length>0&&(s=t[0]),s!=null&&(s=s.toString()),e){case fe.POSTURE:switch(s){case fe.POSTURE_LAY:case fe.POSTURE_WALK:case fe.POSTURE_STAND:case fe.POSTURE_SWIM:case fe.POSTURE_FLOAT:case fe.POSTURE_SIT:case fe.SNOWWAR_RUN:case fe.SNOWWAR_DIE_FRONT:case fe.SNOWWAR_DIE_BACK:case fe.SNOWWAR_PICK:case fe.SNOWWAR_THROW:(s===fe.POSTURE_LAY||s===fe.POSTURE_LAY||s===fe.POSTURE_LAY)&&(s===fe.POSTURE_LAY&&(this._mainDirection==0?this.setDirection(bs.FULL,4):this.setDirection(bs.FULL,2)),this._useFullImageCache=!0,this._useFullImageCache=!0),this.addActionData(s);break}break;case fe.GESTURE:switch(s){case fe.GESTURE_AGGRAVATED:case fe.GESTURE_SAD:case fe.GESTURE_SMILE:case fe.GESTURE_SURPRISED:this.addActionData(s);break}break;case fe.EFFECT:case fe.DANCE:case fe.TALK:case fe.EXPRESSION_WAVE:case fe.SLEEP:case fe.SIGN:case fe.EXPRESSION_RESPECT:case fe.EXPRESSION_BLOW_A_KISS:case fe.EXPRESSION_LAUGH:case fe.EXPRESSION_CRY:case fe.EXPRESSION_IDLE:case fe.EXPRESSION_SNOWBOARD_OLLIE:case fe.EXPRESSION_SNOWBORD_360:case fe.EXPRESSION_RIDE_JUMP:s===fe.EFFECT&&(s==="33"||s==="34"||s==="35"||s==="36"||s==="38"||s==="39")&&(this._useFullImageCache=!0),this.addActionData(e,s);break;case fe.CARRY_OBJECT:case fe.USE_OBJECT:{const r=this._structure.getActionDefinitionWithState(e);r&&(s=r.getParameterValue(s)),this.addActionData(e,s);break}}return!0}addActionData(e,t=""){let s;this._actions||(this._actions=[]);let r=0;for(;r<this._actions.length;){if(s=this._actions[r],s.actionType==e&&s.actionParameter==t)return;r++}this._actions.push(new Og(e,t,this._frameCounter))}isAnimating(){return this._isAnimating||this._animationFrameCount>1}resetActions(){return this._animationHasResetOnToggle=!1,this._isAnimating=!1,this._sprites=[],this._avatarSpriteData=null,this._directionOffset=0,this._structure.removeDynamicItems(this),this._mainAction=this._defaultAction,this._mainAction.definition=this._defaultAction.definition,this.resetBodyPartCache(this._defaultAction),!0}isHeadTurnPreventedByAction(){let e,t;if(this._sortedActions==null)return!1;for(const s of this._sortedActions)e=this._structure.getActionDefinitionWithState(s.actionType),e!=null&&e.getPreventHeadTurn(s.actionParameter)&&(t=!0);return t}sortActions(){let e,t,s;if(this._currentActionsString="",this._sortedActions=this._structure.sortActions(this._actions),this._animationFrameCount=this._structure.maxFrames(this._sortedActions),!this._sortedActions)this._canvasOffsets=[0,0,0],this._lastActionsString!==""&&(s=!0,this._lastActionsString="");else{this._canvasOffsets=this._structure.getCanvasOffsets(this._sortedActions,this._scale,this._mainDirection);for(const r of this._sortedActions)if(this._currentActionsString=this._currentActionsString+(r.actionType+r.actionParameter),r.actionType===fe.EFFECT){const i=parseInt(r.actionParameter);this._effectIdInUse!==i&&(e=!0),this._effectIdInUse=i,t=!0}t||(this._effectIdInUse>-1&&(e=!0),this._effectIdInUse=-1),e&&this._cache.disposeInactiveActions(0),this._lastActionsString!=this._currentActionsString&&(s=!0,this._lastActionsString=this._currentActionsString)}return this._actionsSorted=!0,s}setActionsToParts(){if(!this._sortedActions==null)return;const e=ve(),t=[];for(const s of this._sortedActions)t.push(s.actionType);for(const s of this._sortedActions)if(s&&s.definition&&s.definition.isAnimation){const r=this._structure.getAnimation(s.definition.state+"."+s.actionParameter);if(r&&r.hasOverriddenActions()){const i=r.overriddenActionNames();if(i)for(const a of i)t.indexOf(a)>=0&&(s.overridingAction=r.overridingAction(a))}r&&r.resetOnToggle&&(this._animationHasResetOnToggle=!0)}for(const s of this._sortedActions)if(!(!s||!s.definition)&&(s.definition.isAnimation&&s.actionParameter===""&&(s.actionParameter="1"),this.setActionToParts(s,e),s.definition.isAnimation)){this._isAnimating=s.definition.isAnimated(s.actionParameter);const r=this._structure.getAnimation(s.definition.state+"."+s.actionParameter);r&&(this._sprites=this._sprites.concat(r.spriteData),r.hasDirectionData()&&(this._directionOffset=r.directionData.offset),r.hasAvatarData()&&(this._avatarSpriteData=r.avatarData))}}setActionToParts(e,t){e==null||e.definition==null||e.definition.assetPartDefinition!=""&&(e.definition.isMain&&(this._mainAction=e,this._cache.setGeometryType(e.definition.geometryType)),this._cache.setAction(e,t),this._changes=!0)}resetBodyPartCache(e){e&&e.definition.assetPartDefinition!==""&&(e.definition.isMain&&(this._mainAction=e,this._cache.setGeometryType(e.definition.geometryType)),this._cache.resetBodyPartCache(e),this._changes=!0)}get avatarSpriteData(){return this._avatarSpriteData}convertToGrayscale(e,t="CHANNELS_EQUAL"){let s=.33,r=.33,i=.33;switch(t){case Dn.CHANNELS_UNIQUE:s=.3,r=.59,i=.11;break;case Dn.CHANNELS_RED:s=1,r=0,i=0;break;case Dn.CHANNELS_GREEN:s=0,r=1,i=0;break;case Dn.CHANNELS_BLUE:s=0,r=0,i=1;break;case Dn.CHANNELS_DESATURATED:s=.3086,r=.6094,i=.082;break}const a=new dT;return a.matrix=[s,r,i,0,0,s,r,i,0,0,s,r,i,0,0,0,0,0,1,0],e.filters.push(a),e}errorThis(e){}logThis(e){}isPlaceholder(){return!1}forceActionUpdate(){this._lastActionsString=""}get animationHasResetOnToggle(){return this._animationHasResetOnToggle}get mainAction(){return this._mainAction.actionType}resetEffect(e){e===this._effectIdInUse&&(this.resetActions(),this.setActionsToParts(),this._animationHasResetOnToggle=!0,this._changes=!0,this._effectListener&&this._effectListener.resetEffect(e))}};pn.CHANNELS_EQUAL="CHANNELS_EQUAL";pn.CHANNELS_UNIQUE="CHANNELS_UNIQUE";pn.CHANNELS_RED="CHANNELS_RED";pn.CHANNELS_GREEN="CHANNELS_GREEN";pn.CHANNELS_BLUE="CHANNELS_BLUE";pn.CHANNELS_DESATURATED="CHANNELS_DESATURATED";pn.DEFAULT_ACTION="Default";pn.DEFAULT_DIRECTION=2;pn.DEFAULT_AVATAR_SET=bs.FULL;let nO=pn;class ch{constructor(e){this._number=e.number,this._assetPartDefinition=e.assetPartDefinition||null}get number(){return this._number}get assetPartDefinition(){return this._assetPartDefinition}}class b0{constructor(e){if(this._frames=[],e.frames&&e.frames.length>0)for(const t of e.frames){if(!t)continue;this._frames.push(new ch(t));let s=t.repeats||0;if(s>1)for(;--s>0;)this._frames.push(this._frames[this._frames.length-1])}}get frames(){return this._frames}}const aO=class uh{constructor(e){if(this._id=e.id,this._actionParts=new Map,this._bodyPartOffsets=new Map,this._frameCount=0,this._frameIndexes=[],e.parts&&e.parts.length>0)for(const t of e.parts){if(!t)continue;const s=new b0(t);this._actionParts.set(t.setType,s),this._frameCount=Math.max(this._frameCount,s.frames.length)}if(e.offsets&&e.offsets.frames&&e.offsets.frames.length>0)for(const t of e.offsets.frames){if(!t)continue;const s=t.id;this._frameCount=Math.max(this._frameCount,s);const r=new Map;if(this._bodyPartOffsets.set(s,r),t.directions&&t.directions.length>0)for(const i of t.directions){if(!i)continue;const a=i.id,l=new Map;if(r.set(a,l),i.bodyParts&&i.bodyParts.length>0)for(const c of i.bodyParts){if(!c)continue;const u=c.id;let h=0,d=0;c.dx!==void 0&&(h=c.dx),c.dy!==void 0&&(d=c.dy),l.set(u,new Fe(h,d))}}if(this._frameIndexes.push(s),t.repeats!==void 0){let i=t.repeats||0;if(i>1)for(;--i>0;)this._frameIndexes.push(s)}}}getPart(e){if(!e)return null;const t=this._actionParts.get(e);return t||null}getFrameBodyPartOffset(e,t,s){const r=t%this._frameIndexes.length,i=this._frameIndexes[r],a=this._bodyPartOffsets.get(i);if(!a)return uh.DEFAULT_OFFSET;const l=a.get(e);if(!l)return uh.DEFAULT_OFFSET;const c=l.get(s);return c||uh.DEFAULT_OFFSET}get id(){return this._id}get parts(){return this._actionParts}get frameCount(){return this._frameCount}};aO.DEFAULT_OFFSET=new Fe(0,0);let Cg=aO;class P0{constructor(){this._actions=new Map}parse(e){if(e&&e.length>0)for(const t of e){if(!t)continue;const s=new Cg(t);this._actions.set(s.id,s)}return!0}appendJSON(e){for(const t of e.action)this._actions.set(t.id,new Cg(t));return!0}getAction(e){const t=this._actions.get(e.id);return t||null}getFrameCount(e){const t=this.getAction(e);return t?t.frameCount:0}}class L0{constructor(e,t){this._id=e.id,this._width=e.width,this._height=e.height,this._offset=new Fe(e.dx,e.dy),t==Xr.LARGE?this._regPoint=new Fe((this._width-64)/2,0):this._regPoint=new Fe((this._width-32)/2,0)}get width(){return this._width}get height(){return this._height}get offset(){return this._offset}get id(){return this._id}get regPoint(){return this._regPoint}}const oO=class lO extends jr{constructor(e,t){super(),this._dataReceiver=t,this.download(e)}download(e){const t=new XMLHttpRequest;try{t.open("GET",e),t.send(),t.onloadend=s=>{const r=t.responseText;if(!r||!r.length)throw new Error("invalid_figure_data");this._dataReceiver&&this._dataReceiver.appendJSON(JSON.parse(r)),this.dispatchEvent(new He(lO.AVATAR_STRUCTURE_DONE))},t.onerror=s=>{throw new Error("invalid_avatar_figure_data")}}catch(s){me.error(s)}}};oO.AVATAR_STRUCTURE_DONE="AVATAR_STRUCTURE_DONE";let Np=oO;class U0{constructor(e){if(!e)throw new Error("invalid_data");this._id=e.id,this._type=e.type,this._index=e.index,this._colorLayerIndex=e.colorindex,this._paletteMapId=-1,this._breed=-1}dispose(){}get id(){return this._id}get type(){return this._type}get breed(){return this._breed}get index(){return this._index}get colorLayerIndex(){return this._colorLayerIndex}get paletteMap(){return this._paletteMapId}}class F0{constructor(e,t){if(!e||!t)throw new Error("invalid_data");this._id=t.id,this._type=e,this._gender=t.gender,this._clubLevel=t.club,this._isColorable=t.colorable,this._isSelectable=t.selectable,this._parts=[],this._hiddenLayers=[],this._isPreSelectable=t.preselectable,this._isSellable=t.sellable;for(const s of t.parts){const r=new U0(s),i=this.getPartIndex(r);i!==-1?this._parts.splice(i,0,r):this._parts.push(r)}if(t.hiddenLayers)for(const s of t.hiddenLayers)this._hiddenLayers.push(s.partType)}dispose(){for(const e of this._parts)e.dispose();this._parts=null,this._hiddenLayers=null}getPartIndex(e){const t=this._parts.length;if(!t)return-1;for(let s=0;s<t;s++){const r=this._parts[s];if(r&&!(r.type!==e.type||r.index>e.index))return s}return-1}getPart(e,t){for(const s of this._parts)if(!(s.type!==e||s.id!==t))return s;return null}get id(){return this._id}get type(){return this._type}get gender(){return this._gender}get clubLevel(){return this._clubLevel}get isColorable(){return this._isColorable}get isSelectable(){return this._isSelectable}get parts(){return this._parts}get hiddenLayers(){return this._hiddenLayers}get isPreSelectable(){return this._isPreSelectable}get isSellable(){return this._isSellable}}class x0{constructor(e){if(!e)throw new Error("invalid_data");this._id=e.id,this._index=e.index,this._clubLevel=e.club||0,this._isSelectable=e.selectable,this._rgb=parseInt("0x"+e.hexCode,16)}get id(){return this._id}get index(){return this._index}get clubLevel(){return this._clubLevel}get isSelectable(){return this._isSelectable}get rgb(){return this._rgb}}class yp{constructor(e){if(!e)throw new Error("invalid_data");this._id=e.id,this._colors=new Zt,this.append(e)}append(e){for(const t of e.colors){const s=new x0(t);this._colors.add(t.id.toString(),s)}}getColor(e){return e===void 0||e<0?null:this._colors.getValue(e.toString())||null}get id(){return this._id}get colors(){return this._colors}}class y_{constructor(e){if(!e)throw new Error("invalid_data");this._type=e.type,this._paletteId=e.paletteId,this._isMandatory={},this._isMandatory.F=[e.mandatory_f_0,e.mandatory_f_1],this._isMandatory.M=[e.mandatory_m_0,e.mandatory_m_1],this._partSets=new Zt,this.append(e)}dispose(){for(const e of this._partSets.getValues())e.dispose();this._partSets=null}cleanUp(e){for(const t of e.sets){const s=t.id.toString(),r=this._partSets.getValue(s);r&&(r.dispose(),this._partSets.remove(s))}}append(e){if(!(!e||!e.sets))for(const t of e.sets)this._partSets.add(t.id.toString(),new F0(this._type,t))}getDefaultPartSet(e){for(const t of this._partSets.getValues())if(t&&t.clubLevel===0&&(t.gender===e||t.gender==="U"))return t;return null}getPartSet(e){return this._partSets.getValue(e.toString())}get type(){return this._type}get paletteID(){return this._paletteId}isMandatory(e,t){return this._isMandatory[e.toUpperCase()][Math.min(t,1)]}optionalFromClubLevel(e){return this._isMandatory[e.toUpperCase()].indexOf(!1)}get partSets(){return this._partSets}}class w0{constructor(){this._palettes=new Map,this._setTypes=new Map}dispose(){}parse(e){if(!e)return!1;for(const t of e.palettes){const s=new yp(t);s&&this._palettes.set(s.id.toString(),s)}for(const t of e.setTypes){const s=new y_(t);s&&this._setTypes.set(s.type,s)}return!0}injectJSON(e){for(const t of e.setTypes){const s=this._setTypes.get(t.type);s?s.cleanUp(t):this._setTypes.set(t.type,new y_(t))}this.appendJSON(e)}appendJSON(e){if(!e)return!1;for(const t of e.palettes){const s=t.id.toString(),r=this._palettes.get(s);r?r.append(t):this._palettes.set(s,new yp(t))}for(const t of e.setTypes){const s=t.type,r=this._setTypes.get(s);r?r.append(t):this._setTypes.set(s,new y_(t))}return!1}getMandatorySetTypeIds(e,t){const s=[];for(const r of this._setTypes.values())!r||!r.isMandatory(e,t)||s.push(r.type);return s}getDefaultPartSet(e,t){const s=this._setTypes.get(e);return s?s.getDefaultPartSet(t):null}getSetType(e){return this._setTypes.get(e)||null}getPalette(e){return this._palettes.get(e.toString())||null}getFigurePartSet(e){for(const t of this._setTypes.values()){const s=t.getPartSet(e);if(s)return s}return null}}class Mp{constructor(e){if(this._id=e.id,this._parts=[],e.activeParts&&e.activeParts.length>0)for(const t of e.activeParts)t&&this._parts.push(t.setType)}get parts(){return this._parts}}class M_{constructor(e){if(!e)throw new Error("invalid_data");this._setType=e.setType,this._flippedSetType=e.flippedSetType||null,this._removeSetType=e.removeSetType||null,this._appendToFigure=!1,this._staticId=-1}hasStaticId(){return this._staticId>=0}get staticId(){return this._staticId}set staticId(e){this._staticId=e}get setType(){return this._setType}get flippedSetType(){return this._flippedSetType}set flippedSetType(e){this._flippedSetType=e}get removeSetType(){return this._removeSetType}get appendToFigure(){return this._appendToFigure}set appendToFigure(e){this._appendToFigure=e}}class G0{constructor(){this._parts=new Map,this._activePartSets=new Map}parse(e){if(e.partSet&&e.partSet.length>0)for(const t of e.partSet)t&&this._parts.set(t.setType,new M_(t));if(e.activePartSets&&e.activePartSets.length>0)for(const t of e.activePartSets)t&&this._activePartSets.set(t.id,new Mp(t));return!0}appendJSON(e){if(e.partSet&&e.partSet.length>0)for(const t of e.partSet)t&&this._parts.set(t.setType,new M_(t));if(e.activePartSets&&e.activePartSets.length>0)for(const t of e.activePartSets)t&&this._activePartSets.set(t.id,new Mp(t));return!1}getActiveParts(e){const t=this._activePartSets.get(e.activePartSet);return t?t.parts:[]}getPartDefinition(e){const t=this._parts.get(e);return t||null}addPartDefinition(e){const t=e.setType;let s=this._parts.get(t);return s||(s=new M_(e),this._parts.set(t,s)),s}getActivePartSet(e){const t=this._activePartSets.get(e.activePartSet);return t||null}get parts(){return this._parts}get activePartSets(){return this._activePartSets}}class D_{constructor(e,t,s,r,i,a,l,c,u="",h=!1,d=1){this._bodyPartId=e,this._partType=t,this._partId=s,this._color=r,this._frames=i,this._action=a,this._isColorable=l,this._paletteMapId=c,this._flippedPartType=u,this._isBlendable=h,this._blendTransform=null,this._partType==="ey"&&(this._isColorable=!1)}getFrameIndex(e){if(!this._frames||!this._frames.length)return 0;const t=e%this._frames.length;return this._frames[t]instanceof ch?this._frames[t].number:t}getFrameDefinition(e){const t=e%this._frames.length;return this._frames&&this._frames.length>t&&this._frames[t]instanceof ch?this._frames[t]:null}getCacheableKey(e){const t=e%this._frames.length;if(this._frames&&this._frames.length>t&&this._frames[t]instanceof ch){const s=this._frames[t];return this.partId+":"+s.assetPartDefinition+":"+s.number}return this.partId+":"+t}get bodyPartId(){return this._bodyPartId}get partType(){return this._partType}get partId(){return this._partId}get color(){return this._color}get action(){return this._action}get isColorable(){return this._isColorable}set isColorable(e){this._isColorable=e}get paletteMapId(){return this._paletteMapId}get flippedPartType(){return this._flippedPartType}get isBlendable(){return this._isBlendable}toString(){return[this._bodyPartId,this._partType,this._partId].join(":")}}const Os=class Ht{constructor(){this._gender="M",this._avatarEffectType=-1}loadAvatarData(e,t){this._data=new Map,this._colors=new Map,this._gender=t,this.parseFigureString(e)}dispose(){this._data=null,this._colors=null,this._isDisposed=!0}get disposed(){return this._isDisposed}parseFigureString(e){if(e)for(const t of e.split(".")){const s=t.split("-");if(s.length>0){const r=s[0],i=parseInt(s[1]),a=[];let l=2;for(;l<s.length;)a.push(parseInt(s[l])),l++;a.length||a.push(0),this.savePartSetId(r,i,!1),this.savePartSetColourId(r,a,!1)}}}hasSetType(e){return!!this._data.get(e)}getPartSetId(e){return this.hasSetType(e)?this._data.get(e):-1}getColourIds(e){return this._colors.get(e)?this._colors.get(e):[]}getFigureString(){let e="";const t=[];for(const[r,i]of this._data.entries()){let a=r+"-"+i;const l=this._colors.get(r);if(l)for(const c of l)a=a+("-"+c);t.push(a)}let s=0;for(;s<t.length;)e=e+t[s],s<t.length-1&&(e=e+"."),s++;return e}savePartData(e,t,s,r=!1){this.savePartSetId(e,t,r),this.savePartSetColourId(e,s,r)}savePartSetId(e,t,s=!0){switch(e){case Ht.HD:case Ht.HAIR:case Ht.HAT:case Ht.HEAD_ACCESSORIES:case Ht.EYE_ACCESSORIES:case Ht.FACE_ACCESSORIES:case Ht.SHIRT:case Ht.JACKET:case Ht.CHEST_ACCESSORIES:case Ht.CHEST_PRINTS:case Ht.TROUSERS:case Ht.SHOES:case Ht.TROUSER_ACCESSORIES:t>=0?this._data.set(e,t):this._data.delete(e)}}savePartSetColourId(e,t,s=!0){switch(e){case Ht.HD:case Ht.HAIR:case Ht.HAT:case Ht.HEAD_ACCESSORIES:case Ht.EYE_ACCESSORIES:case Ht.FACE_ACCESSORIES:case Ht.SHIRT:case Ht.JACKET:case Ht.CHEST_ACCESSORIES:case Ht.CHEST_PRINTS:case Ht.TROUSERS:case Ht.SHOES:case Ht.TROUSER_ACCESSORIES:this._colors.set(e,t);return}}getFigureStringWithFace(e){const t=[Ht.HD];let s="";const r=[];for(const a of t){const l=this._colors.get(a);if(l){let c=this._data.get(a);a===Ht.HD&&(c=e);let u=a+"-"+c;if(c>=0){let h=0;for(;h<l.length;)u=u+("-"+l[h]),h++}r.push(u)}}let i=0;for(;i<r.length;)s=s+r[i],i<r.length-1&&(s=s+"."),i++;return s}get gender(){return this._gender}};Os.MALE="M";Os.FEMALE="F";Os.UNISEX="U";Os.SCALE="h";Os.STD="std";Os.DEFAULT_FRAME="0";Os.HD="hd";Os.HAIR="hr";Os.HAT="ha";Os.HEAD_ACCESSORIES="he";Os.EYE_ACCESSORIES="ea";Os.FACE_ACCESSORIES="fa";Os.JACKET="cc";Os.SHIRT="ch";Os.CHEST_ACCESSORIES="ca";Os.CHEST_PRINTS="cp";Os.TROUSERS="lg";Os.SHOES="sh";Os.TROUSER_ACCESSORIES="wa";Os.BLOCKED_FX_TYPES=[28,29,30,33,34,35,36,37,38,39,40,41,42,43,68];let B0=Os;class k0{constructor(e){this._data=[],this._maxSize=e,this._index=0}reset(){this._data=[],this._index=0}addValue(e){this._data.length<this._maxSize?this._data.push(e):this._data[this._index]=e,this._index=(this._index+1)%this._maxSize}getMax(){let e=Number.MIN_VALUE,t=0;for(;t<this._maxSize;)this._data[t]>e&&(e=this._data[t]),t++;return e}getMin(){let e=Number.MAX_VALUE,t=0;for(;t<this._maxSize;)this._data[t]<e&&(e=this._data[t]),t++;return e}}class Rs{constructor(e,t){this._location=e,this._direction=t}get location(){return this._location}get direction(){return this._direction}}class Rd extends Hr{constructor(){super(),this._object=null,this._events=null,this._time=0}initialize(e){}onDispose(){this._object=null}update(e){this._time=e}processUpdateMessage(e){!e||!this._object||(this._object.setLocation(e.location),this._object.setDirection(e.direction))}getEventTypes(){return[]}mergeTypes(e,t){const s=e.concat();for(const r of t)!r||s.indexOf(r)>=0||s.push(r);return s}mouseEvent(e,t){}useObject(){}setObject(e){if(this._object!==e){if(this._object&&this._object.setLogic(null),!e){this.dispose(),this._object=null;return}this._object=e,this._object.setLogic(this)}}tearDown(){}get object(){return this._object}get eventDispatcher(){return this._events}set eventDispatcher(e){this._events=e}get widget(){return null}get contextMenu(){return null}get time(){return this._time}}class cO{constructor(){this._map=new Map,this._updateCounter=0}dispose(){this._map.clear(),this._updateCounter=0}getValue(e){return this._map.get(e)}setValue(e,t){this._map.has(e)&&this._map.get(e)===t||(this._map.set(e,t),this._updateCounter++)}removeKey(e){e&&(this._map.delete(e),this._updateCounter++)}get updateCounter(){return this._updateCounter}}const uO=class hO extends Hr{constructor(e,t,s){super(),this._id=e,this._instanceId=hO.OBJECT_COUNTER++,this._type=s,this._model=new cO,this._location=new F,this._direction=new F,this._states=[],this._visualization=null,this._logic=null,this._pendingLogicMessages=[],this._updateCounter=0,this._isReady=!1;let r=t-1;for(;r>=0;)this._states[r]=0,r--}onDispose(){this._pendingLogicMessages=[],this.setVisualization(null),this.setLogic(null),this._model&&this._model.dispose(),super.onDispose()}getLocation(){return this._location}setLocation(e){e&&(e.x===this._location.x&&e.y===this._location.y&&e.z===this._location.z||(this._location.x=e.x,this._location.y=e.y,this._location.z=e.z,this._updateCounter++))}getDirection(){return this._direction}setDirection(e){e&&(e.x===this._direction.x&&e.y===this._direction.y&&e.z===this._direction.z||(this._direction.x=(e.x%360+360)%360,this._direction.y=(e.y%360+360)%360,this._direction.z=(e.z%360+360)%360,this._updateCounter++))}getState(e=0){return e>=0&&e<this._states.length?this._states[e]:-1}setState(e,t=0){return t>=0&&t<this._states.length?(this._states[t]!==e&&(this._states[t]=e,this._updateCounter++),!0):!1}setVisualization(e){this._visualization!==e&&(this._visualization&&this._visualization.dispose(),this._visualization=e,this._visualization&&(this._visualization.object=this))}setLogic(e){if(this._logic===e)return;const t=this._logic;if(t&&(this._logic=null,t.setObject(null)),this._logic=e,this._logic)for(this._logic.setObject(this);this._pendingLogicMessages.length;){const s=this._pendingLogicMessages.shift();this._logic.processUpdateMessage(s)}}processUpdateMessage(e){if(this._logic)return this._logic.processUpdateMessage(e);this._pendingLogicMessages.push(e)}tearDown(){this._logic&&this._logic.tearDown()}get id(){return this._id}get instanceId(){return this._instanceId}get type(){return this._type}get model(){return this._model}get visualization(){return this._visualization}get mouseHandler(){return this._logic}get logic(){return this._logic}get location(){return this._location}get direction(){return this._direction}get updateCounter(){return this._updateCounter}set updateCounter(e){this._updateCounter=e}get isReady(){return this._isReady}set isReady(e){this._isReady=e}};uO.OBJECT_COUNTER=0;let V0=uO;const dO=class _O{constructor(){this._id=_O.SPRITE_COUNTER++,this._name="",this._type="",this._spriteType=Rr.DEFAULT,this._texture=null,this._container=null,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._flipH=!1,this._flipV=!1,this._direction=0,this._alpha=255,this._blendMode=jn.NORMAL,this._color=16777215,this._relativeDepth=0,this._varyingDepth=!1,this._libraryAssetName="",this._clickHandling=!1,this._visible=!0,this._tag="",this._posture=null,this._alphaTolerance=Ti.MATCH_OPAQUE_PIXELS,this._filters=[],this._updateCounter=0,this._updateContainer=!1}dispose(){this._texture=null,this._width=0,this._height=0}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name!==e&&(this._name=e,this._updateCounter++)}get type(){return this._type}set type(e){this._type=e}get spriteType(){return this._spriteType}set spriteType(e){this._spriteType=e}get texture(){return this._texture}set texture(e){this._texture!==e&&(e&&(this._width=e.width,this._height=e.height),this._texture=e,this._updateCounter++)}get container(){return this._container}set container(e){this._container!==e&&(this.texture=ts.EMPTY,e&&(this._width=e.width,this._height=e.height),this._container=e,this._updateCounter++,this._updateContainer=!0)}get width(){return this._width}get height(){return this._height}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX!==e&&(this._offsetX=e,this._updateCounter++)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY!==e&&(this._offsetY=e,this._updateCounter++)}get flipH(){return this._flipH}set flipH(e){this._flipH!==e&&(this._flipH=e,this._updateCounter++)}get flipV(){return this._flipV}set flipV(e){this._flipV!==e&&(this._flipV=e,this._updateCounter++)}get direction(){return this._direction}set direction(e){this._direction=e}get alpha(){return this._alpha}set alpha(e){e=e&255,this._alpha!==e&&(this._alpha=e,this._updateCounter++)}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode!==e&&(this._blendMode=e,this._updateCounter++)}get color(){return this._color}set color(e){e=e&16777215,this._color!==e&&(this._color=e,this._updateCounter++)}get relativeDepth(){return this._relativeDepth}set relativeDepth(e){this._relativeDepth!==e&&(this._relativeDepth=e,this._updateCounter++)}get varyingDepth(){return this._varyingDepth}set varyingDepth(e){e!==this._varyingDepth&&(this._varyingDepth=e,this._updateCounter++)}get libraryAssetName(){return this._libraryAssetName}set libraryAssetName(e){this._libraryAssetName=e}get clickHandling(){return this._clickHandling}set clickHandling(e){this._clickHandling=e}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._updateCounter++)}get tag(){return this._tag}set tag(e){this._tag!==e&&(this._tag=e,this._updateCounter++)}get posture(){return this._posture}set posture(e){this._posture!==e&&(this._posture=e,this._updateCounter++)}get alphaTolerance(){return this._alphaTolerance}set alphaTolerance(e){this._alphaTolerance!==e&&(this._alphaTolerance=e,this._updateCounter++)}get filters(){return this._filters}set filters(e){this._filters=e,this._updateCounter++}get updateCounter(){return this._updateCounter}get updateContainer(){return this._updateContainer}set updateContainer(e){this._updateContainer=e}};dO.SPRITE_COUNTER=0;let Dp=dO;const gO=class fO{constructor(){this._id=fO.VISUALIZATION_COUNTER++,this._object=null,this._asset=null,this._sprites=[],this._scale=-1,this._updateObjectCounter=-1,this._updateModelCounter=-1,this._updateSpriteCounter=-1}initialize(e){return!1}update(e,t,s,r){}reset(){this._scale=-1}dispose(){if(this._sprites){for(;this._sprites.length;){const e=this._sprites[0];e&&e.dispose(),this._sprites.pop()}this._sprites=null}this._object=null,this._asset=null}getSprite(e){return e>=0&&e<this._sprites.length?this._sprites[e]:null}getSpriteList(){return null}createSprite(){return this.createSpriteAtIndex(this._sprites.length)}createSpriteAtIndex(e){const t=new Dp;return e>=this._sprites.length?this._sprites.push(t):this._sprites.splice(e,0,t),t}createSprites(e){for(;this._sprites.length>e;){const t=this._sprites[this._sprites.length-1];t&&t.dispose(),this._sprites.pop()}for(;this._sprites.length<e;)this._sprites.push(new Dp)}get image(){return this.getImage(0,-1)}getImage(e,t){const s=this.getBoundingRectangle();if(s.width*s.height===0)return null;const r=this.totalSprites,i=[];let a=0;for(;a<r;){const u=this.getSprite(a);u&&u.visible&&u.texture&&i.push(u),a++}i.sort((u,h)=>h.relativeDepth-u.relativeDepth);const l=new di;for(a=0;a<i.length;){const u=i[a],h=u.texture;if(h){const d=new jt(h);d.alpha=u.alpha/255,d.tint=u.color,d.x=u.offsetX,d.y=u.offsetY,d.blendMode=u.blendMode,d.filters=u.filters,u.flipH&&(d.scale.x=-1),u.flipV&&(d.scale.y=-1),l.addChild(d)}a++}const c=ht.generateTexture(l);return c||null}getBoundingRectangle(){const e=this.totalSprites,t=new Gr;let s=0;for(;s<e;){const r=this.getSprite(s);if(r&&r.texture&&r.visible){const i=r.flipH?-r.width+r.offsetX:r.offsetX,a=r.flipV?-r.height+r.offsetY:r.offsetY,l=new Fe(i,a);s===0?(t.x=l.x,t.y=l.y,t.width=r.width,t.height=r.height):(l.x<t.x&&(t.x=l.x),l.y<t.y&&(t.y=l.y),l.x+r.width>t.right&&(t.width=l.x+r.width-t.x),l.y+r.height>t.bottom&&(t.height=l.y+r.height-t.y))}s++}return t}get instanceId(){return this._id}get object(){return this._object}set object(e){this._object=e}get asset(){return this._asset}set asset(e){this._asset&&this._asset.removeReference(),this._asset=e,this._asset&&this._asset.addReference()}get sprites(){return this._sprites}get totalSprites(){return this._sprites.length}get updateObjectCounter(){return this._updateObjectCounter}set updateObjectCounter(e){this._updateObjectCounter=e}get updateModelCounter(){return this._updateModelCounter}set updateModelCounter(e){this._updateModelCounter=e}get updateSpriteCounter(){return this._updateSpriteCounter}set updateSpriteCounter(e){this._updateSpriteCounter=e}get spriteCount(){return this._sprites.length}};gO.VISUALIZATION_COUNTER=0;let Od=gO;class H0{constructor(e){this._roomObjectVariableAccurateZ=e||"",this._location=new F,this._screenLocation=new F,this._locationChanged=!1,this._geometryUpdateId=-1,this._objectUpdateId=-1}dispose(){this._screenLocation=null}updateLocation(e,t){if(!e||!t)return null;let s=!1;const r=e.getLocation();if((t.updateId!==this._geometryUpdateId||e.updateCounter!==this._objectUpdateId)&&(this._objectUpdateId=e.updateCounter,(t.updateId!==this._geometryUpdateId||r.x!==this._location.x||r.y!==this._location.y||r.z!==this._location.z)&&(this._geometryUpdateId=t.updateId,this._location.assign(r),s=!0)),this._locationChanged=s,this._locationChanged){const i=t.getScreenPosition(r);if(!i)return null;const a=e.model.getValue(this._roomObjectVariableAccurateZ);if(isNaN(a)||a===0){const l=new F(Math.round(r.x),Math.round(r.y),r.z);if(l.x!==r.x||l.y!==r.y){const c=t.getScreenPosition(l);this._screenLocation.assign(i),c&&(this._screenLocation.z=c.z)}else this._screenLocation.assign(i)}else this._screenLocation.assign(i);this._screenLocation.x=Math.round(this._screenLocation.x),this._screenLocation.y=Math.round(this._screenLocation.y)}return this._screenLocation}get locationChanged(){return this._locationChanged}}class j0{constructor(){this._sprites=[],this._updateId1=-1,this._updateId2=-1,this._isEmpty=!1}get spriteCount(){return this._sprites.length}get isEmpty(){return this._isEmpty}dispose(){this.setSpriteCount(0)}addSprite(e){this._sprites.push(e)}getSprite(e){return this._sprites[e]}get sprites(){return this._sprites}needsUpdate(e,t){return e===this._updateId1&&t===this._updateId2?!1:(this._updateId1=e,this._updateId2=t,!0)}setSpriteCount(e){if(e<this._sprites.length){let t=e;for(;t<this._sprites.length;){const s=this._sprites[t];s&&s.dispose(),t++}this._sprites.splice(e,this._sprites.length-e)}this._isEmpty=!this._sprites.length}}class W0{constructor(e){this._location=new H0(e),this._sprites=new j0}get location(){return this._location}get sprites(){return this._sprites}dispose(){this._location&&(this._location.dispose(),this._location=null),this._sprites&&(this._sprites.dispose(),this._sprites=null)}get objectId(){return this._objectId}set objectId(e){this._objectId=e}}const mO=class Ag{constructor(e){this._data=new Map,this._roomObjectVariableAccurateZ=e}dispose(){if(this._data){for(const[e,t]of this._data.entries())t&&(this._data.delete(e),t.dispose());this._data=null}}getObjectCache(e){let t=this._data.get(e);return t||(t=new W0(this._roomObjectVariableAccurateZ),this._data.set(e,t)),t}removeObjectCache(e){const t=this._data.get(e);t&&(this._data.delete(e),t.dispose())}getSortableSpriteList(){const e=[];for(const t of this._data.values()){if(!t)continue;const s=t.sprites&&t.sprites.sprites;if(!(!s||!s.length)){for(const r of s)if(r&&r.sprite.spriteType!==Rr.ROOM_PLANE&&r.sprite.name!==""){const i=new WT;i.objectId=t.objectId,i.x=r.x,i.y=r.y,i.z=r.z,i.name=r.sprite.name||"",i.flipH=r.sprite.flipH,i.alpha=r.sprite.alpha,i.color=r.sprite.color.toString(),i.blendMode=r.sprite.blendMode.toString(),i.width=r.sprite.width,i.height=r.sprite.height,i.type=r.sprite.type,i.posture=r.sprite.posture;const a=this.isSkewedSprite(r.sprite);a&&(i.skew=r.sprite.direction%4===0?-.5:.5),(a||r.name.indexOf("%image.library.url%")>=0||r.name.indexOf("%group.badge.url%")>=0)&&i.width<=Ag.MAX_SIZE_FOR_AVG_COLOR&&i.height<=Ag.MAX_SIZE_FOR_AVG_COLOR&&r.sprite.name.indexOf("external_image_wallitem")===0&&(i.frame=!0),e.push(i)}}}return!e||!e.length?null:e}isSkewedSprite(e){return e.type?e.type.indexOf("external_image_wallitem")===0&&e.tag==="THUMBNAIL"||e.type.indexOf("guild_forum")===0&&e.tag==="THUMBNAIL":!1}getPlaneSortableSprites(){const e=[];for(const t of this._data.values())for(const s of t.sprites.sprites)s.sprite.spriteType===Rr.ROOM_PLANE&&e.push(s);return e}};mO.MAX_SIZE_FOR_AVG_COLOR=200;let Y0=mO;const EO=class ga{static hex2rgb(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}static hex2rgba(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t[3]=e&255,t}static rgb2hex(e){return(e[0]*255<<16)+(e[1]*255<<8)+(e[2]*255|0)}static rgba2hex(e){return(e[0]*255<<16)+(e[1]*255<<8)+(e[2]*255|0)+(e[3]|0)}static rgbStringToHex(e){const t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+ga.getHex(t[1])+ga.getHex(t[2])+ga.getHex(t[3])}static getHex(e){return isNaN(e)?"00":ga.HEX_DIGITS[(e-e%16)/16]+ga.HEX_DIGITS[e%16]}static int2rgb(e){e>>>=0;const t=e&255,s=(e&65280)>>>8;return"rgba("+[(e&16711680)>>>16,s,t,1].join(",")+")"}static rgbToHSL(e){const t=(e>>16&255)/255,s=(e>>8&255)/255,r=(e&255)/255,i=Math.max(t,s,r),a=Math.min(t,s,r),l=i-a;let c=0,u=0,h=0;l==0?c=0:i==t?s>r?c=60*(s-r)/l:c=60*(s-r)/l+360:i==s?c=60*(r-t)/l+120:i==r&&(c=60*(t-s)/l+240),u=.5*(i+a),l==0?h=0:u<=.5?h=l/u*.5:h=l/(1-u)*.5;const d=Math.round(c/360*255),f=Math.round(h*255),E=Math.round(u*255);return(d<<16)+(f<<8)+E}static hslToRGB(e){let t,s,r,i,a;const l=(e>>16&255)/255,c=(e>>8&255)/255,u=(e&255)/255;let h=0,d=0,f=0;c>0?(t=0,s=0,u<.5?t=u*(1+c):t=u+c-u*c,s=2*u-t,r=l+1/3,i=l,a=l-1/3,r<0?r=r+1:r>1&&r--,i<0?i=i+1:i>1&&i--,a<0?a=a+1:a>1&&a--,r*6<1?h=s+(t-s)*6*r:r*2<1?h=t:r*3<2?h=s+(t-s)*6*(2/3-r):h=s,i*6<1?d=s+(t-s)*6*i:i*2<1?d=t:i*3<2?d=s+(t-s)*6*(2/3-i):d=s,a*6<1?f=s+(t-s)*6*a:a*2<1?f=t:a*3<2?f=s+(t-s)*6*(2/3-a):f=s):(h=u,d=u,f=u);const E=Math.round(h*255),m=Math.round(d*255),R=Math.round(f*255);return(E<<16)+(m<<8)+R}static rgb2xyz(e){let t=(e>>16&255)/255,s=(e>>8&255)/255,r=(e>>0&255)/255;return t>.04045?t=Math.pow((t+.055)/1.055,2.4):t=t/12.92,s>.04045?s=Math.pow((s+.055)/1.055,2.4):s=s/12.92,r>.04045?r=Math.pow((r+.055)/1.055,2.4):r=r/12.92,t=t*100,s=s*100,r=r*100,new F(t*.4124+s*.3576+r*.1805,t*.2126+s*.7152+r*.0722,t*.0193+s*.1192+r*.9505)}static xyz2CieLab(e){let t=e.x/95.047,s=e.y/100,r=e.z/108.883;return t>.008856?t=Math.pow(t,1/3):t=7.787*t+16/116,s>.008856?s=Math.pow(s,1/3):s=7.787*s+16/116,r>.008856?r=Math.pow(r,1/3):r=7.787*r+16/116,new F(116*s-16,500*(t-s),200*(s-r))}static rgb2CieLab(e){return ga.xyz2CieLab(ga.rgb2xyz(e))}static colorize(e,t){if(t===4294967295)return e;let s=t>>16&255,r=t>>8&255,i=t&255;return s=(e>>16&255)*s/255,r=(e>>8&255)*r/255,i=(e&255)*i/255,(e&&4278190080)|s<<16|r<<8|i}};EO.HEX_DIGITS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];let sr=EO;class vp{constructor(e){e<0&&(e=0),this._reservedNumbers=[],this._freeNumbers=[];let t=0;for(;t<e;)this._freeNumbers.push(t),t++}dispose(){this._reservedNumbers=null,this._freeNumbers=null}reserveNumber(){if(this._freeNumbers.length>0){const e=this._freeNumbers.pop();return this._reservedNumbers.push(e),e}return-1}freeNumber(e){const t=this._reservedNumbers.indexOf(e);t>=0&&(this._reservedNumbers.splice(t,1),this._freeNumbers.push(e))}}class z0{static getFlipHBitmapData(e){if(!e)return null;const t=ht.createRenderTexture(e.width,e.height),s=new Or;return s.scale(-1,1),s.translate(e.width,0),Us.instance.renderer.render(new es(e),{renderTexture:t,clear:!0,transform:s}),t}static getFlipVBitmapData(e){if(!e)return null;const t=new Or;t.scale(1,-1),t.translate(0,e.height);const s=new lg;return s.beginTextureFill({texture:e,matrix:t}).drawRect(0,0,e.width,e.height).endFill(),ht.generateTexture(s)}static getFlipHVBitmapData(e){if(!e)return null;const t=new Or;t.scale(-1,-1),t.translate(e.width,e.height);const s=new lg;return s.beginTextureFill({texture:e,matrix:t}).drawRect(0,0,e.width,e.height).endFill(),ht.generateTexture(s)}}const Oi=class mt{static init(e,t){mt._currentDelta=0,mt._startDelayMs=e,mt._effectDurationMs=t,mt._initializationTimeMs=ve(),mt._state=mt.STATE_START_DELAY}static turnVisualizationOn(){if(mt._state===mt.STATE_NOT_INITIALIZED||mt._state===mt.STATE_OVER)return;const e=ve()-mt._initializationTimeMs;if(e>mt._startDelayMs+mt._effectDurationMs){mt._state=mt.STATE_OVER;return}if(mt._visualizationOn=!0,e<mt._startDelayMs){mt._state=mt.STATE_START_DELAY;return}mt._state=mt.STATE_RUNNING,mt._currentDelta=(e-mt._startDelayMs)/mt._effectDurationMs}static turnVisualizationOff(){mt._visualizationOn=!1}static isVisualizationOn(){return mt._visualizationOn&&mt.isRunning()}static isRunning(){return mt._state===mt.STATE_START_DELAY||mt._state===mt.STATE_RUNNING}static getDelta(e=0,t=1){return Math.min(Math.max(mt._currentDelta,e),t)}static get totalRunningTime(){return mt._startDelayMs+mt._effectDurationMs}};Oi.STATE_NOT_INITIALIZED=0;Oi.STATE_START_DELAY=1;Oi.STATE_RUNNING=2;Oi.STATE_OVER=3;Oi._state=Oi.STATE_NOT_INITIALIZED;Oi._visualizationOn=!1;Oi._currentDelta=0;Oi._initializationTimeMs=0;Oi._startDelayMs=20*1e3;Oi._effectDurationMs=2e3;let xi=Oi;const _m=class io{constructor(e,t,s,r=null){this._updateId=0,this._scale=1,this._x_scale=1,this._y_scale=1,this._z_scale=1,this._x_scale_internal=1,this._y_scale_internal=1,this._z_scale_internal=1,this._clipNear=-500,this._clipFar=500,this._displacements=null,this.scale=e,this._x=new F,this._y=new F,this._z=new F,this._directionAxis=new F,this._location=new F,this._direction=new F,this._depth=new F,this._x_scale_internal=1,this._y_scale_internal=1,this.x_scale=1,this.y_scale=1,this._z_scale_internal=Math.sqrt(1/2)/Math.sqrt(3/4),this.z_scale=1,this.location=new F(s.x,s.y,s.z),this.direction=new F(t.x,t.y,t.z),r!=null?this.setDepthVector(r):this.setDepthVector(t),this._displacements=new Map}static getIntersectionVector(e,t,s,r){const i=F.dotProduct(t,r);if(Math.abs(i)<1e-5)return null;const a=F.dif(e,s),l=-F.dotProduct(r,a)/i;return F.sum(e,F.product(t,l))}get updateId(){return this._updateId}get scale(){return this._scale/Math.sqrt(.5)}set scale(e){e<=1&&(e=1),e=e*Math.sqrt(.5),e!=this._scale&&(this._scale=e,this._updateId++)}get directionAxis(){return this._directionAxis}get location(){return this._location.assign(this._loc),this._location.x=this._location.x*this._x_scale,this._location.y=this._location.y*this._y_scale,this._location.z=this._location.z*this._z_scale,this._location}set location(e){if(e==null)return;this._loc==null&&(this._loc=new F);const t=this._loc.x,s=this._loc.y,r=this._loc.z;this._loc.assign(e),this._loc.x=this._loc.x/this._x_scale,this._loc.y=this._loc.y/this._y_scale,this._loc.z=this._loc.z/this._z_scale,(this._loc.x!=t||this._loc.y!=s||this._loc.z!=r)&&this._updateId++}get direction(){return this._direction}set direction(e){let t,s,r,i,a;if(e==null)return;this._dir==null&&(this._dir=new F);const l=this._dir.x,c=this._dir.y,u=this._dir.z;this._dir.assign(e),this._direction.assign(e),(this._dir.x!=l||this._dir.y!=c||this._dir.z!=u)&&this._updateId++;const h=new F(0,1,0),d=new F(0,0,1),f=new F(1,0,0),E=e.x/180*Math.PI,m=e.y/180*Math.PI,R=e.z/180*Math.PI,I=Math.cos(E),S=Math.sin(E),A=F.sum(F.product(h,I),F.product(f,-S)),N=new F(d.x,d.y,d.z),L=F.sum(F.product(h,S),F.product(f,I)),M=Math.cos(m),b=Math.sin(m),B=new F(A.x,A.y,A.z),w=F.sum(F.product(N,M),F.product(L,b)),x=F.sum(F.product(N,-b),F.product(L,M));R!=0?(t=Math.cos(R),s=Math.sin(R),r=F.sum(F.product(B,t),F.product(w,s)),i=F.sum(F.product(B,-s),F.product(w,t)),a=new F(x.x,x.y,x.z),this._x.assign(r),this._y.assign(i),this._z.assign(a),this._directionAxis.assign(this._z)):(this._x.assign(B),this._y.assign(w),this._z.assign(x),this._directionAxis.assign(this._z))}set x_scale(e){this._x_scale!=e*this._x_scale_internal&&(this._x_scale=e*this._x_scale_internal,this._updateId++)}set y_scale(e){this._y_scale!=e*this._y_scale_internal&&(this._y_scale=e*this._y_scale_internal,this._updateId++)}set z_scale(e){this._z_scale!=e*this._z_scale_internal&&(this._z_scale=e*this._z_scale_internal,this._updateId++)}dispose(){this._x=null,this._y=null,this._z=null,this._loc=null,this._dir=null,this._directionAxis=null,this._location=null,this._displacements!=null&&(this._displacements.clear(),this._displacements=null)}setDisplacement(e,t){let s,r;e==null||t==null||this._displacements!=null&&(s=Math.trunc(Math.round(e.x))+"_"+Math.trunc(Math.round(e.y))+"_"+Math.trunc(Math.round(e.z)),this._displacements.delete(s),r=new F,r.assign(t),this._displacements.set(s,r),this._updateId++)}getDisplacenent(e){let t;return this._displacements!=null?(t=Math.trunc(Math.round(e.x))+"_"+Math.trunc(Math.round(e.y))+"_"+Math.trunc(Math.round(e.z)),this._displacements.get(t)):null}setDepthVector(e){let t,s,r;const i=new F(0,1,0),a=new F(0,0,1),l=new F(1,0,0),c=e.x/180*Math.PI,u=e.y/180*Math.PI,h=e.z/180*Math.PI,d=Math.cos(c),f=Math.sin(c),E=F.sum(F.product(i,d),F.product(l,-f)),m=new F(a.x,a.y,a.z),R=F.sum(F.product(i,f),F.product(l,d)),I=Math.cos(u),S=Math.sin(u),A=new F(E.x,E.y,E.z),N=F.sum(F.product(m,I),F.product(R,S)),L=F.sum(F.product(m,-S),F.product(R,I));h!=0?(t=Math.cos(h),s=Math.sin(h),F.sum(F.product(A,t),F.product(N,s)),F.sum(F.product(A,-s),F.product(N,t)),r=new F(L.x,L.y,L.z),this._depth.assign(r)):this._depth.assign(L),this._updateId++}adjustLocation(e,t){if(e==null||this._z==null)return;const s=F.product(this._z,-t),r=new F(e.x+s.x,e.y+s.y,e.z+s.z);this.location=r}getCoordinatePosition(e){if(e==null)return null;const t=F.scalarProjection(e,this._x),s=F.scalarProjection(e,this._y),r=F.scalarProjection(e,this._z);return new F(t,s,r)}getScreenPosition(e){let t=F.dif(e,this._loc);t.x=t.x*this._x_scale,t.y=t.y*this._y_scale,t.z=t.z*this._z_scale;let s=F.scalarProjection(t,this._depth);if(s<this._clipNear||s>this._clipFar)return null;let r=F.scalarProjection(t,this._x),i=-F.scalarProjection(t,this._y);r=r*this._scale,i=i*this._scale;const a=this.getDisplacenent(e);return a!=null&&(t=F.dif(e,this._loc),t.add(a),t.x=t.x*this._x_scale,t.y=t.y*this._y_scale,t.z=t.z*this._z_scale,s=F.scalarProjection(t,this._depth)),t.x=r,t.y=i,t.z=s,t}getScreenPoint(e){const t=this.getScreenPosition(e);return t==null?null:new Fe(t.x,t.y)}getPlanePosition(e,t,s,r){let i,a;const l=e.x/this._scale,c=-e.y/this._scale,u=F.product(this._x,l);u.add(F.product(this._y,c));const h=new F(this._loc.x*this._x_scale,this._loc.y*this._y_scale,this._loc.z*this._z_scale);h.add(u);const d=this._z,f=new F(t.x*this._x_scale,t.y*this._y_scale,t.z*this._z_scale),E=new F(s.x*this._x_scale,s.y*this._y_scale,s.z*this._z_scale),m=new F(r.x*this._x_scale,r.y*this._y_scale,r.z*this._z_scale),R=F.crossProduct(E,m),I=new F;return I.assign(io.getIntersectionVector(h,d,f,R)),I!=null?(I.subtract(f),i=F.scalarProjection(I,s)/E.length*s.length,a=F.scalarProjection(I,r)/m.length*r.length,new Fe(i,a)):null}performZoom(){this.isZoomedIn()?this.scale=io.SCALE_ZOOMED_OUT:this.scale=io.SCALE_ZOOMED_IN}isZoomedIn(){return this.scale==io.SCALE_ZOOMED_IN}performZoomOut(){this.scale=io.SCALE_ZOOMED_OUT}performZoomIn(){this.scale=io.SCALE_ZOOMED_IN}};_m.SCALE_ZOOMED_IN=64;_m.SCALE_ZOOMED_OUT=32;let Cl=_m;const pO=class Ng{static makeRoomPreviewerId(e){return(e&65535)+Ng.PREVIEW_ROOM_ID_BASE}static isRoomPreviewerId(e){return e>=Ng.PREVIEW_ROOM_ID_BASE}};pO.PREVIEW_ROOM_ID_BASE=2147418112;let Yn=pO;class Zr{static init(e,t){this._SafeStr_4513=0,this._SafeStr_4515=e,this._SafeStr_4516=t,this._SafeStr_4514=ve(),this._SafeStr_448=1}static turnVisualizationOn(){if(this._SafeStr_448===0||this._SafeStr_448===3)return;this._SafeStr_4524||(this._SafeStr_4524=setTimeout(()=>this.turnVisualizationOff(),this._SafeStr_4516));const e=ve()-this._SafeStr_4514;if(e>this._SafeStr_4515+this._SafeStr_4516){this._SafeStr_448=3;return}if(this._SafeStr_4512=!0,e<this._SafeStr_4515){this._SafeStr_448=1;return}this._SafeStr_448=2,this._SafeStr_4513=(e-this._SafeStr_4515)/this._SafeStr_4516}static turnVisualizationOff(){this._SafeStr_4512=!1,clearTimeout(this._SafeStr_4524),this._SafeStr_4524=null}static isVisualizationOn(){return this._SafeStr_4512&&this.isRunning()}static isRunning(){return this._SafeStr_448===1||this._SafeStr_448===2}}Zr.STATE_NOT_INITIALIZED=0;Zr.STATE_START_DELAY=1;Zr.STATE_RUNNING=2;Zr.STATE_OVER=3;Zr._SafeStr_448=0;Zr._SafeStr_4512=!1;Zr._SafeStr_4513=0;Zr._SafeStr_4514=0;Zr._SafeStr_4515=2e4;Zr._SafeStr_4516=5e3;class $r{static init(e,t){this._SafeStr_4513=0,this._SafeStr_4515=e,this._SafeStr_4516=t,this._SafeStr_4514=ve(),this._SafeStr_448=1}static turnVisualizationOn(){if(this._SafeStr_448===0||this._SafeStr_448===3)return;this._SafeStr_4524||(this._SafeStr_4524=setTimeout(()=>this.turnVisualizationOff(),this._SafeStr_4516));const e=ve()-this._SafeStr_4514;if(e>this._SafeStr_4515+this._SafeStr_4516){this._SafeStr_448=3;return}if(this._SafeStr_4512=!0,e<this._SafeStr_4515){this._SafeStr_448=1;return}this._SafeStr_448=2,this._SafeStr_4513=(e-this._SafeStr_4515)/this._SafeStr_4516}static turnVisualizationOff(){this._SafeStr_4512=!1,clearTimeout(this._SafeStr_4524),this._SafeStr_4524=null}static isVisualizationOn(){return this._SafeStr_4512&&this.isRunning()}static isRunning(){return this._SafeStr_448===1||this._SafeStr_448===2}}$r.STATE_NOT_INITIALIZED=0;$r.STATE_START_DELAY=1;$r.STATE_RUNNING=2;$r.STATE_OVER=3;$r._SafeStr_448=0;$r._SafeStr_4512=!1;$r._SafeStr_4514=0;$r._SafeStr_4515=2e4;$r._SafeStr_4516=5e3;class K0{static hex2int(e){return parseInt(e,16)}static inkToBlendMode(e){return e=="ADD"||e==33?jn.ADD:e=="SUBTRACT"?jn.SUBTRACT:e=="DARKEN"?jn.DARKEN:jn.NORMAL}}class vh extends es{constructor(e=null){super(e),this._offsetX=0,this._offsetY=0,this._tag="",this._alphaTolerance=128,this._varyingDepth=!1,this._clickHandling=!1,this._pairedSpriteId=-1,this._pairedSpriteUpdateCounter=-1}needsUpdate(e,t){return this._pairedSpriteId===e&&this._pairedSpriteUpdateCounter===t?!1:(this._pairedSpriteId=e,this._pairedSpriteUpdateCounter=t,!0)}calculateVertices(){this.texture.orig&&super.calculateVertices()}setTexture(e){e||(e=ts.EMPTY),e!==this.texture&&(e===ts.EMPTY&&(this._pairedSpriteId=-1,this._pairedSpriteUpdateCounter=-1),this.texture=e)}containsPoint(e){return vh.containsPoint(this,e)}static containsPoint(e,t){if(!e||!t||e.alphaTolerance>255||!(e instanceof es))return!1;if(e.texture===ts.EMPTY||e.blendMode!==jn.NORMAL)return;const s=e.texture,r=s.baseTexture;if(!s||!r||!r.valid)return!1;const i=t.x*e.scale.x,a=t.y*e.scale.y;if(!e.getLocalBounds().contains(i,a)||!r.hitMap&&!vh.generateHitMap(r))return!1;const l=r.hitMap;let c=i+s.frame.x,u=a+s.frame.y;s.trim&&(c-=s.trim.x,u-=s.trim.y),c=Math.round(c)*r.resolution,u=Math.round(u)*r.resolution;const h=c+u*r.realWidth,d=h%32,f=h/32|0;return(l[f]&1<<d)!==0}static generateHitMap(e){if(!e)return!1;const t=new ts(e),s=new es(t),r=ht.getPixels(s),i=e.width,a=e.height,l=new Uint32Array(Math.ceil(i*a/32)),c=Ti.MATCH_OPAQUE_PIXELS;for(let u=0;u<i*a;u++){const h=u%32,d=u/32|0;r[u*4+3]>=c&&(l[d]=l[d]|1<<h)}return e.hitMap=l,s.destroy(),t.destroy(),!0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get tag(){return this._tag}set tag(e){this._tag=e}get alphaTolerance(){return this._alphaTolerance}set alphaTolerance(e){this._alphaTolerance=e}get varyingDepth(){return this._varyingDepth}set varyingDepth(e){this._varyingDepth=e}get clickHandling(){return this._clickHandling}set clickHandling(e){this._clickHandling=e}}class X0{constructor(){this._objectId="",this._spriteTag=""}get objectId(){return this._objectId}set objectId(e){this._objectId=e}get spriteTag(){return this._spriteTag}set spriteTag(e){this._spriteTag=e}}const IO=class TO{constructor(){this._name="",this._sprite=null,this._x=0,this._y=0,this._z=0}dispose(){this._z=-TO.Z_INFINITY,this._sprite=null}get name(){return this._name}set name(e){this._name=e}get sprite(){return this._sprite}set sprite(e){this._sprite=e}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get z(){return this._z}set z(e){this._z=e}};IO.Z_INFINITY=1e8;let q0=IO;class Q0{constructor(e,t,s,r,i){this._SafeStr_4507=!1,this._rotation=0,this._rotationOrigin=null,this._rotationRodLength=0,this._SafeStr_795=0,this._id=t,this._container=e,this._geometry=new Cl(i,new F(-135,30,0),new F(11,11,5),new F(-135,.5,0)),this._animationFPS=pe.instance.getConfiguration("system.fps.animation",24),this._renderTimestamp=0,this._totalTimeRunning=0,this._lastFrame=0,this._master=null,this._display=null,this._mask=null,this._sortableSprites=[],this._spriteCount=0,this._activeSpriteCount=0,this._spritePool=[],this._skipObjectUpdate=!1,this._runningSlow=!1,this._width=0,this._height=0,this._renderedWidth=0,this._renderedHeight=0,this._screenOffsetX=0,this._screenOffsetY=0,this._mouseLocation=new Fe,this._mouseOldX=0,this._mouseOldY=0,this._mouseCheckCount=0,this._mouseSpriteWasHit=!1,this._mouseActiveObjects=new Map,this._eventCache=new Map,this._eventId=0,this._scale=1,this._restrictsScaling=!1,this._noSpriteVisibilityChecking=!1,this._usesExclusionRectangles=!1,this._usesMask=!0,this._canvasUpdated=!1,this._objectCache=new Y0(this._container.roomObjectVariableAccurateZ),this._mouseListener=null,this.setupCanvas(),this.initialize(s,r)}setupCanvas(){if(this._master||(this._master=new jt,this._master.interactiveChildren=!1),!this._display){const e=new di;this._master.addChild(e),this._display=e}}dispose(){if(this.cleanSprites(0,!0),this._geometry&&(this._geometry.dispose(),this._geometry=null),this._mask&&(this._mask=null),this._objectCache&&(this._objectCache.dispose(),this._objectCache=null),this._master){for(;this._master.children.length;)this._master.removeChildAt(0).destroy();this._master.parent&&this._master.parent.removeChild(this._master),this._master.destroy(),this._master=null}if(this._display=null,this._sortableSprites=[],this._mouseActiveObjects&&(this._mouseActiveObjects.clear(),this._mouseActiveObjects=null),this._spritePool){for(const e of this._spritePool)this.cleanSprite(e,!0);this._spritePool=[]}this._eventCache&&(this._eventCache.clear(),this._eventCache=null),this._mouseListener=null}initialize(e,t){if(e=e<1?1:e,t=t<1?1:t,this._usesMask&&(this._mask?this._mask.clear().beginFill(16711680).drawRect(0,0,e,t).endFill():(this._mask=new lg().beginFill(16711680).drawRect(0,0,e,t).endFill(),this._master&&(this._master.addChild(this._mask),this._display&&(this._display.mask=this._mask)))),this._master){if(this._master.hitArea){const s=this._master.hitArea;s.width=e,s.height=t}else this._master.hitArea=new Gr(0,0,e,t);if(this._master.filterArea){const s=this._master.filterArea;s.width=e,s.height=t}else this._master.filterArea=new Gr(0,0,e,t)}this._width=e,this._height=t}setMask(e){e&&!this._usesMask?(this._usesMask=!0,this._mask&&this._mask.parent!==this._master&&(this._master.addChild(this._mask),this._display.mask=this._mask)):!e&&this._usesMask&&(this._usesMask=!1,this._mask&&this._mask.parent===this._master&&(this._master.removeChild(this._mask),this._display.mask=null))}setScale(e,t=null,s=null,r=!1,i=!1){!this._master||!this._display||this._restrictsScaling&&!r||(t||(t=new Fe(this._width/2,this._height/2)),s||(s=t),t=this._display.toLocal(t),i?this._scale*=e:this._scale=e,this.screenOffsetX=s.x-t.x*this._scale,this.screenOffsetY=s.y-t.y*this._scale)}render(e,t=!1){if(this._canvasUpdated=!1,this._totalTimeRunning+=qs().deltaTime,this._totalTimeRunning===this._renderTimestamp||(e===-1&&(e=this._renderTimestamp+1),!this._container||!this._geometry))return;(this._width!==this._renderedWidth||this._height!==this._renderedHeight)&&(t=!0),(this._display.x!==this._screenOffsetX||this._display.y!==this._screenOffsetY)&&(this._display.position.set(this._screenOffsetX,this._screenOffsetY),t=!0),this._display.scale.x!==this._scale&&(this._display.scale.set(this._scale),t=!0),this.doMagic();const s=Math.round(this._totalTimeRunning/(60/this._animationFPS));let r=!1;s!==this._lastFrame&&(this._lastFrame=s,r=!0);let i=0;const a=this._container.objects;if(a.size)for(const c of a.values())c&&(i=i+this.renderObject(c,c.instanceId.toString(),e,t,r,i));this._sortableSprites.sort((c,u)=>u.z-c.z),i<this._sortableSprites.length&&this._sortableSprites.splice(i);let l=0;for(;l<i;){const c=this._sortableSprites[l];c&&c.sprite&&this.renderSprite(l,c),l++}this.cleanSprites(i),(t||r)&&(this._canvasUpdated=!0),this._renderTimestamp=this._totalTimeRunning,this._renderedWidth=this._width,this._renderedHeight=this._height}skipSpriteVisibilityChecking(){this._noSpriteVisibilityChecking=!0,this.render(-1,!0)}resumeSpriteVisibilityChecking(){this._noSpriteVisibilityChecking=!1}getSortableSpriteList(){return this._objectCache.getSortableSpriteList()}getPlaneSortableSprites(){return this._objectCache.getPlaneSortableSprites()}removeFromCache(e){this._objectCache.removeObjectCache(e)}renderObject(e,t,s,r,i,a){if(!e)return 0;const l=e.visualization;if(!l)return this.removeFromCache(t),0;const c=this.getCacheItem(t);c.objectId=e.instanceId;const u=c.location,h=c.sprites,d=u.updateLocation(e,this._geometry);if(!d)return this.removeFromCache(t),0;if(i&&l.update(this._geometry,s,!h.isEmpty||r,this._skipObjectUpdate&&this._runningSlow),u.locationChanged&&(r=!0),!h.needsUpdate(l.instanceId,l.updateSpriteCounter)&&!r)return h.spriteCount;let f=d.x,E=d.y,m=d.z;f>0?m=m+f*12e-8:m=m+-f*12e-8,f=f+Math.trunc(this._width/2),E=E+Math.trunc(this._height/2);let R=0;for(const I of l.sprites.values()){if(!I||!I.visible)continue;const S=I.texture,A=S&&S.baseTexture;if(!S||!A)continue;const N=f+I.offsetX+this._screenOffsetX,L=E+I.offsetY+this._screenOffsetY;if(I.flipH){const b=f+-(S.width+-I.offsetX)+this._screenOffsetX;if(!this.isSpriteVisible(b,L,S.width,S.height))continue}else if(I.flipV){const b=E+-(S.height+-I.offsetY)+this._screenOffsetY;if(!this.isSpriteVisible(N,b,S.width,S.height))continue}else if(!this.isSpriteVisible(N,L,S.width,S.height))continue;let M=h.getSprite(R);M||(M=new q0,h.addSprite(M),this._sortableSprites.push(M),M.name=t),M.sprite=I,(I.spriteType===Rr.AVATAR||I.spriteType===Rr.AVATAR_OWN)&&(M.sprite.libraryAssetName="avatar_"+e.id),M.x=N-this._screenOffsetX,M.y=L-this._screenOffsetY,M.z=m+I.relativeDepth+37e-12*a,R++,a++}return h.setSpriteCount(R),this._canvasUpdated=!0,R}getExtendedSprite(e){if(e<0||e>=this._spriteCount)return null;const t=this._display.getChildAt(e);return t||null}getExtendedSpriteIdentifier(e){return e?e.name:""}renderSprite(e,t){if(e>=this._spriteCount)return this.createAndAddSprite(t),!0;if(!t)return!1;const s=t.sprite,r=this.getExtendedSprite(e);if(!s||!r)return!1;if(r.varyingDepth!==s.varyingDepth)return r.varyingDepth&&!s.varyingDepth?(this._display.removeChildAt(e),this._spritePool.push(r),this.renderSprite(e,t)):(this.createAndAddSprite(t,e),!0);if(r.needsUpdate(s.id,s.updateCounter)||xi.isVisualizationOn()){r.tag=s.tag,r.alphaTolerance=s.alphaTolerance,r.name=t.name,r.varyingDepth=s.varyingDepth,r.clickHandling=s.clickHandling,r.filters=s.filters;const i=s.alpha/255;r.alpha!==i&&(r.alpha=i),r.tint!==s.color&&(r.tint=s.color),r.blendMode!==s.blendMode&&(r.blendMode=s.blendMode),r.texture!==s.texture&&r.setTexture(s.texture),s.updateContainer&&(r.children.length===1&&r.removeChildAt(0),r.addChild(s.container),s.updateContainer=!1),s.flipH?r.scale.x!==-1&&(r.scale.x=-1):r.scale.x!==1&&(r.scale.x=1),s.flipV?r.scale.y!==-1&&(r.scale.y=-1):r.scale.y!==1&&(r.scale.y=1),this.updateEnterRoomEffect(r,s)}return r.x!==t.x&&(r.x=t.x),r.y!==t.y&&(r.y=t.y),r.offsetX=s.offsetX,r.offsetY=s.offsetY,!0}createAndAddSprite(e,t=-1){const s=e.sprite;if(!s)return;let r=null;this._spritePool.length>0&&(r=this._spritePool.pop()),r||(r=new vh),r.children.length&&r.removeChildren(),r.tag=s.tag,r.alphaTolerance=s.alphaTolerance,r.alpha=s.alpha/255,r.tint=s.color,r.x=e.x,r.y=e.y,r.offsetX=s.offsetX,r.offsetY=s.offsetY,r.name=s.name,r.varyingDepth=s.varyingDepth,r.clickHandling=s.clickHandling,r.blendMode=s.blendMode,r.filters=s.filters,r.setTexture(s.texture),s.updateContainer&&(r.addChild(s.container),s.updateContainer=!1),s.flipH&&(r.scale.x=-1),s.flipV&&(r.scale.y=-1),this.updateEnterRoomEffect(r,s),t<0||t>=this._spriteCount?(this._display.addChild(r),this._spriteCount++):this._display.addChildAt(r,t),this._activeSpriteCount++}cleanSprites(e,t=!1){if(this._display){if(e<0&&(e=0),e<this._activeSpriteCount||!this._activeSpriteCount){let s=this._spriteCount-1;for(;s>=e;)this.cleanSprite(this.getExtendedSprite(s),t),s--}this._activeSpriteCount=e}}updateEnterRoomEffect(e,t){if(!(!xi.isVisualizationOn()||!t))switch(t.spriteType){case Rr.AVATAR_OWN:return;case Rr.ROOM_PLANE:e.alpha=xi.getDelta(.9);return;case Rr.AVATAR:e.alpha=xi.getDelta(.5);return;default:e.alpha=xi.getDelta(.1)}}cleanSprite(e,t){e&&(t?(e.parent&&e.parent.removeChild(e),e.destroy({children:!0})):e.setTexture(null))}update(){this._mouseCheckCount,this._mouseCheckCount=0,this._eventId++}setMouseListener(e){this._mouseListener=e}getCacheItem(e){return this._objectCache.getObjectCache(e)}isSpriteVisible(e,t,s,r){return!!(this._noSpriteVisibilityChecking||(e=(e-this._screenOffsetX)*this._scale+this._screenOffsetX,t=(t-this._screenOffsetY)*this._scale+this._screenOffsetY,s=s*this._scale,r=r*this._scale,e<this._width&&e+s>=0&&t<this._height&&t+r>=0&&!this._usesExclusionRectangles))}handleMouseEvent(e,t,s,r,i,a,l){return e=e-this._screenOffsetX,t=t-this._screenOffsetY,this._mouseLocation.x=e/this._scale,this._mouseLocation.y=t/this._scale,this._mouseCheckCount>0&&s==ie.MOUSE_MOVE?this._mouseSpriteWasHit:(this._mouseSpriteWasHit=this.checkMouseHits(Math.trunc(e/this._scale),Math.trunc(t/this._scale),s,r,i,a,l),this._mouseCheckCount++,this._mouseSpriteWasHit)}checkMouseHits(e,t,s,r=!1,i=!1,a=!1,l=!1){const c=[];let u=!1,h=null,d=this._activeSpriteCount-1;for(;d>=0;){const m=this.getExtendedSprite(d);if(m&&m.containsPoint(new Fe(e-m.x,t-m.y))&&!(m.clickHandling&&(s===ie.MOUSE_CLICK||s===ie.DOUBLE_CLICK))){const R=this.getExtendedSpriteIdentifier(m);if(c.indexOf(R)===-1){const I=m.tag;let S=this._mouseActiveObjects.get(R);S&&S.spriteTag!==I&&(h=this.createMouseEvent(0,0,0,0,ie.ROLL_OUT,S.spriteTag,r,i,a,l),this.bufferMouseEvent(h,R)),s===ie.MOUSE_MOVE&&(!S||S.spriteTag!==I)?h=this.createMouseEvent(e,t,e-m.x,t-m.y,ie.ROLL_OVER,I,r,i,a,l):(h=this.createMouseEvent(e,t,e-m.x,t-m.y,s,I,r,i,a,l),h.spriteOffsetX=m.offsetX,h.spriteOffsetY=m.offsetY),S||(S=new X0,S.objectId=R,this._mouseActiveObjects.set(R,S)),S.spriteTag=I,(s!==ie.MOUSE_MOVE||e!==this._mouseOldX||t!==this._mouseOldY)&&this.bufferMouseEvent(h,R),c.push(R)}u=!0}d--}const f=[];for(const m of this._mouseActiveObjects.keys())m&&f.push(m);let E=0;for(;E<f.length;){const m=f[E];c.indexOf(m)>=0&&(f[E]=null),E++}for(E=0;E<f.length;){const m=f[E];if(m!==null){const R=this._mouseActiveObjects.get(m);R&&this._mouseActiveObjects.delete(m);const I=this.createMouseEvent(0,0,0,0,ie.ROLL_OUT,R.spriteTag,r,i,a,l);this.bufferMouseEvent(I,m)}E++}return this.processMouseEvents(),this._mouseOldX=e,this._mouseOldY=t,u}createMouseEvent(e,t,s,r,i,a,l,c,u,h){const d=e-this._width/2,f=t-this._height/2,E=`canvas_${this._id}`;return new QU(i,E+"_"+this._eventId,E,a,d,f,s,r,c,l,u,h)}bufferMouseEvent(e,t){!e||!this._eventCache||(this._eventCache.delete(t),this._eventCache.set(t,e))}processMouseEvents(){if(!(!this._container||!this._eventCache)){for(const[e,t]of this._eventCache.entries()){if(!this._eventCache)return;if(!t)continue;const s=this._container.getRoomObject(parseInt(e));if(s)if(this._mouseListener)this._mouseListener.processRoomCanvasMouseEvent(t,s,this._geometry);else{const r=s.mouseHandler;r&&r.mouseEvent(t,this._geometry)}}this._eventCache&&this._eventCache.clear()}}getDisplayAsTexture(){this._noSpriteVisibilityChecking=!0;const e=this._scale,t=this._screenOffsetX,s=this._screenOffsetY;this.setScale(1,null,null,!0),this._screenOffsetX=0,this._screenOffsetY=0,this.render(-1,!0),this._display.mask=null;const r=this._display.getBounds(),i=Hi.create({width:this._display.width,height:this._display.height});return Us.instance.renderer.render(this._display,{renderTexture:i,clear:!0,transform:new Or(1,0,0,1,-r.x,-r.y)}),this._display.mask=this._mask,this._noSpriteVisibilityChecking=!1,this.setScale(e,null,null,!0),this._screenOffsetX=t,this._screenOffsetY=s,i}doMagic(){const e=this.geometry;if(this._rotation!==0){let t=this._effectDirection;e.direction=new F(t.x+this._rotation,t.y,t.z),t=e.direction,e.setDepthVector(new F(t.x,t.y,5));const s=new F;s.assign(this._rotationOrigin),s.x=s.x+this._rotationRodLength*Math.cos((t.x+180)/180*3.14159265358979)*Math.cos(t.y/180*3.14159265358979),s.y=s.y+this._rotationRodLength*Math.sin((t.x+180)/180*3.14159265358979)*Math.cos(t.y/180*3.14159265358979),s.z=s.z+this._rotationRodLength*Math.sin(t.y/180*3.14159265358979),e.location=s,this._effectLocation=new F,this._effectLocation.assign(s),this._effectDirection=new F,this._effectDirection.assign(e.direction)}if($r.isVisualizationOn()&&!this._SafeStr_4507?this.changeShaking():!$r.isVisualizationOn()&&this._SafeStr_4507&&this.changeShaking(),Zr.isVisualizationOn()&&this.changeRotation(),this._SafeStr_4507){this._SafeStr_795++;const t=this._effectDirection,s=F.sum(t,new F(Math.sin(this._SafeStr_795*5/180*3.14159265358979)*2,Math.sin(this._SafeStr_795/180*3.14159265358979)*5,Math.sin(this._SafeStr_795*10/180*3.14159265358979)*2));e.direction=s}else this._SafeStr_795=0,e.direction=this._effectDirection}changeShaking(){if(this._SafeStr_4507=!this._SafeStr_4507,this._SafeStr_4507){const e=this.geometry.direction;this._effectDirection=new F(e.x,e.y,e.z)}}changeRotation(){if(this._SafeStr_4507)return;const e=this.geometry;if(e){if(this._rotation===0){const t=e.location,s=e.directionAxis;this._effectLocation=new F,this._effectLocation.assign(t),this._effectDirection=new F,this._effectDirection.assign(e.direction);const r=Cl.getIntersectionVector(t,s,new F(0,0,0),new F(0,0,1));r!==null&&(this._rotationOrigin=new F(r.x,r.y,r.z),this._rotationRodLength=F.dif(r,t).length,this._rotation=1);return}this._rotation=0,e.location=this._effectLocation,e.direction=this._effectDirection,e.setDepthVector(new F(this._effectDirection.x,this._effectDirection.y,5))}}moveLeft(){if(this._rotation!==0){this._rotation===1?this._rotation=-1:this._rotation=this._rotation-1;return}const e=this.geometry,t=(e.direction.x-90)/180*3.14159265358979;e.location=F.sum(e.location,new F(Math.cos(t)*Math.sqrt(2),Math.sin(t)*Math.sqrt(2)))}moveRight(){if(this._rotation!==0){this._rotation===-1?this._rotation=1:this._rotation=this._rotation+1;return}const e=this.geometry,t=(e.direction.x+90)/180*3.14159265358979;e.location=F.sum(e.location,new F(Math.cos(t)*Math.sqrt(2),Math.sin(t)*Math.sqrt(2)))}moveUp(){if(this._rotation!==0)return;const e=this.geometry,t=e.direction.x/180*3.14159265358979;e.location=F.sum(e.location,new F(Math.cos(t)*Math.sqrt(2),Math.sin(t)*Math.sqrt(2)))}moveDown(){if(this._rotation!==0)return;const e=this.geometry,t=(e.direction.x+180)/180*3.14159265358979;e.location=F.sum(e.location,new F(Math.cos(t)*Math.sqrt(2),Math.sin(t)*Math.sqrt(2)))}get id(){return this._id}get geometry(){return this._geometry}get master(){return this._master}get display(){return this._display}get screenOffsetX(){return this._screenOffsetX}set screenOffsetX(e){e=Math.trunc(e),this._mouseLocation.x=this._mouseLocation.x-(e-this._screenOffsetX),this._screenOffsetX=e}get screenOffsetY(){return this._screenOffsetY}set screenOffsetY(e){e=Math.trunc(e),this._mouseLocation.y=this._mouseLocation.y-(e-this._screenOffsetY),this._screenOffsetY=e}get scale(){return this._scale}get width(){return this._width*this._scale}get height(){return this._height*this._scale}get restrictsScaling(){return this._restrictsScaling}set restrictsScaling(e){this._restrictsScaling=e}get canvasUpdated(){return this._canvasUpdated}set canvasUpdated(e){this._canvasUpdated=e}}class J0{constructor(){this._objects=new Map,this._canvases=new Map,this._disposed=!1,this._roomObjectVariableAccurateZ=null}dispose(){if(!this._disposed){if(this._canvases){for(const[e,t]of this._canvases.entries())this._canvases.delete(e),t&&t.dispose();this._canvases=null}this._objects&&(this._objects=null),this._disposed=!0}}reset(){this._objects.clear()}getInstanceId(e){return e?e.instanceId:-1}getRoomObject(e){return this._objects.get(e)}addObject(e){e&&this._objects.set(this.getInstanceId(e),e)}removeObject(e){const t=this.getInstanceId(e);this._objects.delete(t);for(const s of this._canvases.values()){if(!s)continue;s.removeFromCache(t.toString())}}render(e,t=!1){if(!(!this._canvases||!this._canvases.size))for(const s of this._canvases.values())s&&s.render(e,t)}update(e,t=!1){if(!(!this._canvases||!this._canvases.size)){this.render(e,t);for(const s of this._canvases.values())s&&s.update()}}getCanvas(e){const t=this._canvases.get(e);return t||null}createCanvas(e,t,s,r){const i=this._canvases.get(e);if(i)return i.initialize(t,s),i.geometry&&(i.geometry.scale=r),i;const a=this.createSpriteCanvas(e,t,s,r);if(a)return this._canvases.set(e,a),a}createSpriteCanvas(e,t,s,r){return new Q0(this,e,t,s,r)}removeCanvas(e){const t=this._canvases.get(e);t&&(this._canvases.delete(e),t.dispose())}get objects(){return this._objects}get disposed(){return this._disposed}get roomObjectVariableAccurateZ(){return this._roomObjectVariableAccurateZ}set roomObjectVariableAccurateZ(e){this._roomObjectVariableAccurateZ=e}}class Z0{createRenderer(){return new J0}}class $0 extends Hr{constructor(e,t){super(),this._id=e,this._container=t,this._renderer=null,this._managers=new Map,this._updateCategories=[],this._model=new cO}onDispose(){this.removeAllManagers(),this.destroyRenderer(),this._container=null,this._model.dispose()}setRenderer(e){if(e!==this._renderer&&(this._renderer&&this.destroyRenderer(),this._renderer=e,!!this._renderer&&(this._renderer.reset(),this._managers.size)))for(const t of this._managers.values()){if(!t)continue;const s=t.objects;if(s.length)for(const r of s.getValues())r&&this._renderer.addObject(r)}}destroyRenderer(){this._renderer&&(this._renderer.dispose(),this._renderer=null)}getManager(e){const t=this._managers.get(e);return t||null}getManagerOrCreate(e){let t=this.getManager(e);return t||(t=this._container.createRoomObjectManager(e),t?(this._managers.set(e,t),t):null)}getTotalObjectsForManager(e){const t=this.getManager(e);return t?t.totalObjects:0}getRoomObject(e,t){const s=this.getManager(t);if(!s)return null;const r=s.getObject(e);return r||null}getRoomObjectsForCategory(e){const t=this.getManager(e);return t?t.objects.getValues():[]}getRoomObjectByIndex(e,t){const s=this.getManager(t);if(!s)return null;const r=s.getObjectByIndex(e);return r||null}createRoomObject(e,t,s,r){const i=this.getManagerOrCreate(r);if(!i)return null;const a=i.createObject(e,t,s);return a?(this._renderer&&this._renderer.addObject(a),a):null}createRoomObjectAndInitalize(e,t,s){return this._container?this._container.createRoomObjectAndInitalize(this._id,e,t,s):null}removeRoomObject(e,t){const s=this.getManager(t);if(!s)return;const r=s.getObject(e);r&&(r.tearDown(),this._renderer&&this._renderer.removeObject(r),s.removeObject(e))}removeAllManagers(){for(const e of this._managers.values())if(e){if(this._renderer){const t=e.objects;if(t.length)for(const s of t.getValues())s&&this._renderer.removeObject(s)}e.dispose()}this._managers.clear()}addUpdateCategory(e){this._updateCategories.indexOf(e)>=0||this._updateCategories.push(e)}removeUpdateCategory(e){const t=this._updateCategories.indexOf(e);t!==-1&&this._updateCategories.splice(t,1)}update(e,t=!1){for(const s of this._updateCategories){const r=this.getManager(s);if(!r)continue;const i=r.objects;if(i.length)for(const a of i.getValues()){if(!a)continue;const l=a.logic;l&&l.update(e)}}this._renderer&&this._renderer.update(e,t)}hasUninitializedObjects(){for(const e of this._managers.values())if(e){for(const t of e.objects.getValues())if(t&&!t.isReady)return!0}return!1}get id(){return this._id}get container(){return this._container}get renderer(){return this._renderer}get managers(){return this._managers}get model(){return this._model}}const RO=class yg{constructor(e,t,s,r,i,a,l){this._layerTags=[],this._primaryColor=e&16777215,this._secondaryColor=t&16777215,this._breed=s,this._tag=r>-1&&r<yg.COLOR_TAGS.length?yg.COLOR_TAGS[r]:"",this._id=i,this._isMaster=a,this._layerTags=l}get primaryColor(){return this._primaryColor}get secondaryColor(){return this._secondaryColor}get breed(){return this._breed}get tag(){return this._tag}get id(){return this._id}get isMaster(){return this._isMaster}get layerTags(){return this._layerTags}};RO.COLOR_TAGS=["Null","Black","White","Grey","Red","Orange","Pink","Green","Lime","Blue","Light-Blue","Dark-Blue","Yellow","Brown","Dark-Brown","Beige","Cyan","Purple","Gold"];let eF=RO;const er=class Bs{constructor(){this._stateEvents=null,this._sessionDataManager=null,this._waitingForSessionDataManager=!1,this._iconListener=null,this._collections=new Map,this._gifCollections=new Map,this._images=new Map,this._events=new Map,this._activeObjects={},this._activeObjectTypes=new Map,this._activeObjectTypeIds=new Map,this._objectTypeAdUrls=new Map,this._wallItems={},this._wallItemTypes=new Map,this._wallItemTypeIds=new Map,this._furniRevisions=new Map,this._pets={},this._petColors=new Map,this._objectAliases=new Map,this._objectOriginalNames=new Map,this._pendingContentTypes=[],this._dataInitialized=!1}initialize(e){this._stateEvents=e,this.setFurnitureData();for(const[t,s]of Ue.getValue("pet.types").entries())this._pets[s]=t}dispose(){}setSessionDataManager(e){this._sessionDataManager=e,this._waitingForSessionDataManager&&(this._waitingForSessionDataManager=!1,this.setFurnitureData())}loadFurnitureData(){this.setFurnitureData()}setFurnitureData(){if(!this._sessionDataManager){this._waitingForSessionDataManager=!0;return}const e=this._sessionDataManager.getAllFurnitureData(this);e&&(this._sessionDataManager.removePendingFurniDataListener(this),this.processFurnitureData(e),this._stateEvents.dispatchEvent(new He(Bs.LOADER_READY)))}processFurnitureData(e){if(e)for(const t of e){if(!t)continue;const s=t.id;let r=t.className;t.hasIndexedColor&&(r=r+"*"+t.colorIndex);const i=t.revision,a=t.adUrl;a&&a.length>0&&this._objectTypeAdUrls.set(r,a);let l=t.className;t.type===go.FLOOR?(this._activeObjectTypes.set(s,r),this._activeObjectTypeIds.set(r,s),this._activeObjects[l]||(this._activeObjects[l]=1)):t.type===go.WALL&&(l==="post.it"&&(r="post_it",l="post_it"),l==="post.it.vd"&&(r="post_it_vd",l="post_id_vd"),this._wallItemTypes.set(s,r),this._wallItemTypeIds.set(r,s),this._wallItems[l]||(this._wallItems[l]=1));const c=this._furniRevisions.get(l);i>c&&(this._furniRevisions.delete(l),this._furniRevisions.set(l,i))}}getFurnitureFloorNameForTypeId(e){const t=this._activeObjectTypes.get(e);return this.removeColorIndex(t)}getFurnitureWallNameForTypeId(e,t=null){let s=this._wallItemTypes.get(e);return s==="poster"&&t!==null&&(s=s+t),this.removeColorIndex(s)}getFurnitureFloorColorIndex(e){const t=this._activeObjectTypes.get(e);return t?this.getColorIndexFromName(t):-1}getFurnitureWallColorIndex(e){const t=this._wallItemTypes.get(e);return t?this.getColorIndexFromName(t):-1}getColorIndexFromName(e){if(!e)return-1;const t=e.indexOf("*");return t===-1?0:parseInt(e.substr(t+1))}removeColorIndex(e){if(!e)return null;const t=e.indexOf("*");return t===-1?e:e.substr(0,t)}getRoomObjectAdUrl(e){const t=this._objectTypeAdUrls.get(e);return t||""}getPetColorResult(e,t){const s=this._petColors.get(e);return s?s.get(t):null}getPetColorResultsForTag(e,t){const s=this._petColors.get(e),r=[];if(s)for(const i of s.values())i.tag===t&&r.push(i);return r}getCollection(e){if(!e)return null;const t=this._collections.get(e);if(!t){const s=Fr().getCollection(e);return s?(this._collections.set(e,s),s):null}return t}getGifCollection(e){return e&&this._gifCollections.get(e)||null}getImage(e){if(!e)return null;const t=this._images.get(e);if(!t)return null;const s=new Image;return s.src=t.src,s}addAssetToCollection(e,t,s,r=!0){const i=this.getCollection(e);return i?i.addAsset(t,s,r,0,0,!1,!1):!1}createGifCollection(e,t,s){if(!e||!t||!s)return null;const r=new WU(e,t,s);return this._gifCollections.set(e,r),r}createCollection(e,t){if(!e||!t)return null;const s=new PT(e,t);this._collections.set(s.name,s);const r=this._pets[s.name];if(r!==void 0){const i=s.getPaletteNames(),a=new Map;for(const l of i){const c=s.getPalette(l),u=e.palettes[l],h=c.primaryColor,d=c.secondaryColor,f=u.breed!==void 0?u.breed:0,E=u.colorTag!==void 0?u.colorTag:-1,m=u.master!==void 0?u.master:!1,R=u.tags!==void 0?u.tags:[];a.set(parseInt(l),new eF(h,d,f,E,l,m,R))}this._petColors.set(r,a)}}getPlaceholderName(e){switch(this.getCategoryForType(e)){case k.FLOOR:return Bs.PLACE_HOLDER;case k.WALL:return Bs.PLACE_HOLDER_WALL;default:return this._pets[e]!==void 0?Bs.PLACE_HOLDER_PET:Bs.PLACE_HOLDER_DEFAULT}}getCategoryForType(e){return e?this._activeObjects[e]!==void 0?k.FLOOR:this._wallItems[e]!==void 0?k.WALL:this._pets[e]!==void 0?k.UNIT:e.indexOf("poster")===0?k.WALL:e==="room"?k.ROOM:e===ft.USER||e===ft.PET||e===ft.BOT||e===ft.RENTABLE_BOT?k.UNIT:e===Bs.TILE_CURSOR||e===Bs.SELECTION_ARROW?k.CURSOR:k.MINIMUM:k.MINIMUM}getPetNameForType(e){return Ue.getValue("pet.types")[e]||null}isLoaderType(e){return e=ft.getRealType(e),e!==re.USER}downloadImage(e,t,s,r=null){let i=null,a=[];if(t&&t.indexOf(",")>=0&&(i=t,t=i.split(",")[0]),i?a=this.getAssetUrls(i,s,!0):a=this.getAssetUrls(t,s,!0),a&&a.length){const l=a[0],c=new Image;return c.src=l,c.onload=()=>{c.onerror=null,this._images.set([t,s].join("_"),c),this._iconListener.onRoomContentLoaded(e,[t,s].join("_"),!0)},c.onerror=()=>{c.onload=null,me.error("Failed to download asset",l),this._iconListener.onRoomContentLoaded(e,[t,s].join("_"),!1)},!0}return!1}async downloadAsset(e,t){var r;const s=(r=this.getAssetUrls(e))==null?void 0:r[0];if(!(!s||!s.length)&&!(this._pendingContentTypes.indexOf(e)>=0||this.getOrRemoveEventDispatcher(e))){this._pendingContentTypes.push(e),this._events.set(e,t);try{const i=await fetch(s);let a="application/octet-stream";switch(i.headers.has("Content-Type")&&(a=i.headers.get("Content-Type")),a){case"application/octet-stream":{const l=new ST(await i.arrayBuffer());await this.processAsset(l.baseTexture,l.jsonFile);const c=this._events.get(e);if(!c)return;c.dispatchEvent(new hn(hn.RCLE_SUCCESS,e));break}default:throw new Error}}catch{t.dispatchEvent(new hn(hn.RCLE_FAILURE,e))}}}async processAsset(e,t){const s=t.spritesheet;if(!e||!s||!Object.keys(s).length){this.createCollection(t,null);return}const r=async()=>{const i=new hT(e,s);await i.parse(),this.createCollection(t,i)};e.valid?await r():await new Promise((i,a)=>{e.once("update",async()=>(await r(),i()))})}setAssetAliasName(e,t){this._objectAliases.set(e,t),this._objectOriginalNames.set(t,e)}getAssetAliasName(e){const t=this._objectAliases.get(e);return t||e}getAssetOriginalName(e){const t=this._objectOriginalNames.get(e);return t||e}getAssetUrls(e,t=null,s=!1){switch(e){case Bs.PLACE_HOLDER:return[this.getAssetUrlWithGenericBase(Bs.PLACE_HOLDER)];case Bs.PLACE_HOLDER_WALL:return[this.getAssetUrlWithGenericBase(Bs.PLACE_HOLDER_WALL)];case Bs.PLACE_HOLDER_PET:return[this.getAssetUrlWithGenericBase(Bs.PLACE_HOLDER_PET)];case Bs.ROOM:return[this.getAssetUrlWithGenericBase("room")];case Bs.TILE_CURSOR:return[this.getAssetUrlWithGenericBase(Bs.TILE_CURSOR)];case Bs.SELECTION_ARROW:return[this.getAssetUrlWithGenericBase(Bs.SELECTION_ARROW)];default:{const r=this.getCategoryForType(e);if(r===k.FLOOR||r===k.WALL){const i=this.getAssetAliasName(e);let a=s?this.getAssetUrlWithFurniIconBase(i):this.getAssetUrlWithFurniBase(e);if(s){const l=t&&t!==""&&this._activeObjectTypeIds.has(i+"*"+t);a=a.replace(/%param%/gi,l?"_"+t:"")}return[a]}return r===k.UNIT?[this.getAssetUrlWithPetBase(e)]:null}}}getAssetIconUrl(e,t){let s=null,r=[];return e&&e.indexOf(",")>=0&&(s=e,e=s.split(",")[0]),s?r=this.getAssetUrls(s,t,!0):r=this.getAssetUrls(e,t,!0),r&&r.length?r[0]:null}getAssetUrlWithGenericBase(e){return Ue.getValue("generic.asset.url").replace(/%libname%/gi,e)}getAssetUrlWithFurniBase(e){return Ue.getValue("furni.asset.url").replace(/%libname%/gi,e)}getAssetUrlWithFurniIconBase(e){return Ue.getValue("furni.asset.icon.url").replace(/%libname%/gi,e)}getAssetUrlWithPetBase(e){return Ue.getValue("pet.asset.url").replace(/%libname%/gi,e)}setRoomObjectRoomId(e,t){const s=e&&e.model;s&&s.setValue(C.OBJECT_ROOM_ID,t)}getOrRemoveEventDispatcher(e,t=!1){const s=this._events.get(e);return t&&this._events.delete(e),s}setIconListener(e){this._iconListener=e}};er.PLACE_HOLDER="place_holder";er.PLACE_HOLDER_WALL="place_holder_wall";er.PLACE_HOLDER_PET="place_holder_pet";er.PLACE_HOLDER_DEFAULT=er.PLACE_HOLDER;er.ROOM="room";er.TILE_CURSOR="tile_cursor";er.SELECTION_ARROW="selection_arrow";er.LOADER_READY="RCL_LOADER_READY";er.MANDATORY_LIBRARIES=[er.PLACE_HOLDER,er.PLACE_HOLDER_WALL,er.PLACE_HOLDER_PET,er.ROOM,er.TILE_CURSOR,er.SELECTION_ARROW];let hh=er;class tF{constructor(){this._objects=new Zt,this._objectsPerType=new Zt}dispose(){this.removeAllObjects()}getObject(e){const t=this._objects.getValue(e);return t||null}getObjectByIndex(e){const t=this._objects.getWithIndex(e);return t||null}createObject(e,t,s){const r=new V0(e,t,s);return this.addObject(e,s,r)}addObject(e,t,s){if(this._objects.getValue(e))return s.dispose(),null;this._objects.add(e,s);const r=this.getTypeMap(t);return r&&r.add(e,s),s}removeObject(e){const t=this._objects.remove(e);if(t){const s=this.getTypeMap(t.type);s&&s.remove(t.id),t.dispose()}}removeAllObjects(){let e=0;for(;e<this._objects.length;){const t=this._objects.getWithIndex(e);t&&t.dispose(),e++}for(this._objects.reset(),e=0;e<this._objectsPerType.length;){const t=this._objectsPerType.getWithIndex(e);t&&t.dispose(),e++}this._objectsPerType.reset()}getTypeMap(e,t=!0){let s=this._objectsPerType.getValue(e);return!s&&t&&(s=new Zt,this._objectsPerType.add(e,s)),s}get objects(){return this._objects}get totalObjects(){return this._objects.length}}const Do=class fa extends En{constructor(e,t,s){super(),this._state=fa.ROOM_MANAGER_LOADED,this._rooms=new Map,this._contentLoader=null,this._updateCategories=[],this._listener=e,this._visualizationFactory=t,this._logicFactory=s,this._initialLoadList=[],this._pendingContentTypes=[],this._skipContentProcessing=!1,this._disposed=!1,this.onRoomContentLoadedEvent=this.onRoomContentLoadedEvent.bind(this),this.events.addEventListener(hn.RCLE_SUCCESS,this.onRoomContentLoadedEvent),this.events.addEventListener(hn.RCLE_FAILURE,this.onRoomContentLoadedEvent),this.events.addEventListener(hn.RCLE_CANCEL,this.onRoomContentLoadedEvent)}onInit(){if(this._state>=fa.ROOM_MANAGER_INITIALIZING||!this._contentLoader)return;const e=hh.MANDATORY_LIBRARIES;for(const t of e)t&&this._initialLoadList.indexOf(t)===-1&&(this._contentLoader.downloadAsset(t,this.events),this._initialLoadList.push(t));this._state=fa.ROOM_MANAGER_INITIALIZING}getRoomInstance(e){const t=this._rooms.get(e);return t||null}createRoomInstance(e){if(this._rooms.get(e))return null;const t=new $0(e,this);if(this._rooms.set(t.id,t),this._updateCategories.length)for(const s of this._updateCategories)t.addUpdateCategory(s);return t}removeRoomInstance(e){const t=this._rooms.get(e);return t?(this._rooms.delete(e),t.dispose(),!0):!1}createRoomObjectAndInitalize(e,t,s,r){const i=this.getRoomInstance(e);if(!i)return null;let a=s,l=s,c=s,u=null,h=!1;if(this._contentLoader.isLoaderType(s)){if(u=this._contentLoader.getCollection(s),!u&&(h=!0,this._contentLoader.downloadAsset(s,this.events),c=this._contentLoader.getPlaceholderName(s),u=this._contentLoader.getCollection(c),!u))return null;a=u.data.visualizationType,l=u.data.logicType}const d=i.createRoomObject(t,1,s,r);if(!d)return null;if(this._visualizationFactory){const f=this._visualizationFactory.getVisualization(a);if(!f)return i.removeRoomObject(t,r),null;f.asset=u;const E=this._visualizationFactory.getVisualizationData(c,a,u&&u.data||null);if(!E||!f.initialize(E))return i.removeRoomObject(t,r),null;d.setVisualization(f)}if(this._logicFactory){const f=this._logicFactory.getLogic(l);d.setLogic(f),f&&f.initialize(u&&u.data||null)}return h||(d.isReady=!0),this._contentLoader.setRoomObjectRoomId(d,e),d}reinitializeRoomObjectsByType(e){if(!e||!this._contentLoader||!this._visualizationFactory||!this._logicFactory)return;const t=this._contentLoader.getCollection(e);if(!t)return;const s=t.data.visualizationType,r=t.data.logicType,i=this._visualizationFactory.getVisualizationData(e,s,t.data);for(const a of this._rooms.values())if(a){for(const[l,c]of a.managers.entries())if(c)for(const u of c.objects.getValues()){if(!u||u.type!==e)continue;const h=this._visualizationFactory.getVisualization(s);if(h)if(h.asset=t,!i||!h.initialize(i))c.removeObject(u.id);else{u.setVisualization(h);const d=this._logicFactory.getLogic(r);u.setLogic(d),d&&d.initialize(t.data),u.isReady=!0,this._listener&&this._listener.objectInitialized(a.id,u.id,l)}else c.removeObject(u.id)}}}addUpdateCategory(e){if(!(this._updateCategories.indexOf(e)>=0)&&(this._updateCategories.push(e),!!this._rooms.size))for(const s of this._rooms.values())s&&s.addUpdateCategory(e)}removeUpdateCategory(e){const t=this._updateCategories.indexOf(e);if(t!==-1&&(this._updateCategories.splice(t,1),!!this._rooms.size))for(const s of this._rooms.values())s&&s.removeUpdateCategory(e)}setContentLoader(e){this._contentLoader&&this._contentLoader.dispose(),this._contentLoader=e}processPendingContentTypes(e){if(this._skipContentProcessing){this._skipContentProcessing=!1;return}for(;this._pendingContentTypes.length;){const t=this._pendingContentTypes.shift();if(!this._contentLoader.getCollection(t)){this._listener&&this._listener.initalizeTemporaryObjectsByType(t,!1),me.log("Invalid Collection",t);continue}this.reinitializeRoomObjectsByType(t),this._listener&&this._listener.initalizeTemporaryObjectsByType(t,!0),this._initialLoadList.length>0&&this.removeFromInitialLoad(t)}}removeFromInitialLoad(e){if(!(!e||this._state===fa.ROOM_MANAGER_ERROR))if(this._contentLoader||(this._state=fa.ROOM_MANAGER_ERROR),this._contentLoader.getCollection(e)){const t=this._initialLoadList.indexOf(e);t>=0&&this._initialLoadList.splice(t,1),this._initialLoadList.length||(this._state=fa.ROOM_MANAGER_INITIALIZED,this._listener&&this._listener.onRoomEngineInitalized(!0))}else this._state=fa.ROOM_MANAGER_ERROR,this._listener&&this._listener.onRoomEngineInitalized(!1)}onRoomContentLoadedEvent(e){if(!this._contentLoader)return;const t=e.contentType;this._pendingContentTypes.indexOf(t)>=0||this._pendingContentTypes.push(t)}update(e,t=!1){if(this.processPendingContentTypes(e),!!this._rooms.size)for(const s of this._rooms.values())s&&s.update(e,t)}createRoomObjectManager(e){return new tF}get rooms(){return this._rooms}get disposed(){return this._disposed}};Do.ROOM_MANAGER_ERROR=-1;Do.ROOM_MANAGER_LOADING=0;Do.ROOM_MANAGER_LOADED=1;Do.ROOM_MANAGER_INITIALIZING=2;Do.ROOM_MANAGER_INITIALIZED=3;Do.CONTENT_PROCESSING_TIME_LIMIT_MILLISECONDS=40;let sF=Do;class rF{constructor(e,t=-1,s=null,r=null,i=null){this._minLevel=-1,this._texture=null,this._colorMatrix=null,this._blendMode=null,this._name=e,this._minLevel=t,this._texture=s,this._colorMatrix=r,this._blendMode=i}get name(){return this._name}get texture(){return this._texture}set texture(e){this._texture=e}get colorMatrix(){return this._colorMatrix}set colorMatrix(e){this._colorMatrix=e}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e}get minLevel(){return this._minLevel}}class iF{constructor(){this._effects=new Map,this._events=new jr,this._isLoaded=!1}init(){if(this._isLoaded)return;this._isLoaded=!0;const e=Ue.getValue("image.library.url")+"Habbo-Stories/",t=Ue.getValue("camera.available.effects");for(const s of t){if(!s.enabled)continue;const r=new rF(s.name,s.minLevel);s.colorMatrix.length?r.colorMatrix=s.colorMatrix:(r.texture=ts.from(e+s.name+".png"),r.blendMode=s.blendMode),this._effects.set(r.name,r)}this.events.dispatchEvent(new Nh(Nh.INITIALIZED))}applyEffects(e,t,s){const r=new di,i=new jt(e);r.addChild(i),s&&i.scale.set(2);for(const a of t){const l=a.effect;if(l)if(l.colorMatrix){const c=new dT;c.matrix=l.colorMatrix,c.alpha=a.alpha,i.filters||(i.filters=[]),i.filters.push(c)}else{const c=new jt(l.texture);c.alpha=a.alpha,c.blendMode=l.blendMode,r.addChild(c)}}return ht.generateImage(r)}get effects(){return this._effects}get events(){return this._events}get isLoaded(){return this._isLoaded}}class v_{constructor(e,t){this._effect=e,this._alpha=t}get effect(){return this._effect}get alpha(){return this._alpha}}class nF{flush(){return this._canShowInterstitial=!1,!0}parse(e){return e?(this._canShowInterstitial=e.readBoolean(),!0):!1}get canShowInterstitial(){return this._canShowInterstitial}}class aF{flush(){return this._errorCode=0,this._filteredText=null,!0}parse(e){return e?(this._errorCode=e.readInt(),this._filteredText=e.readString(),!0):!1}get errorCode(){return this._errorCode}get filteredText(){return this._filteredText}}class oF{flush(){return this._isOpen=!1,this._onShutdown=!1,this._isAuthenticUser=!1,!0}parse(e){return e?(this._isOpen=e.readBoolean(),this._onShutdown=e.readBoolean(),e.bytesAvailable&&(this._isAuthenticUser=e.readBoolean()),!0):!1}get isOpen(){return this._isOpen}get onShutdown(){return this._onShutdown}get isAuthenticUser(){return this._isAuthenticUser}}class lF{flush(){return this._isOpen=!1,this._minutesUntilChange=0,!0}parse(e){return e?(this._isOpen=e.readInt()>0,this._minutesUntilChange=e.readInt(),!0):!1}get isOpen(){return this._isOpen}get minutesUntilChange(){return this._minutesUntilChange}}class cF{flush(){return this._openHour=0,this._openMinute=0,!0}parse(e){return e?(this._openHour=e.readInt(),this._openMinute=e.readInt(),!0):!1}get openHour(){return this._openHour}get openMinute(){return this._openMinute}}class uF{flush(){return this._openHour=0,this._openMinute=0,this._userThrownOutAtClose=!1,!0}parse(e){return e?(this._openHour=e.readInt(),this._openMinute=e.readInt(),this._userThrownOutAtClose=e.readBoolean(),!0):!1}get openHour(){return this._openHour}get openMinute(){return this._openMinute}get userThrowOutAtClose(){return this._userThrownOutAtClose}}class hF{flush(){return this._minutes=0,!0}parse(e){return e?(this._minutes=e.readInt(),!0):!1}get openMinute(){return this._minutes}}class dF{flush(){return this._isInMaintenance=!1,this._minutesUntilMaintenance=0,this._duration=15,!0}parse(e){return e?(this._isInMaintenance=e.readBoolean(),this._minutesUntilMaintenance=e.readInt(),e.bytesAvailable&&(this._duration=e.readInt()),!0):!1}get isInMaintenance(){return this._isInMaintenance}get minutesUntilMaintenance(){return this._minutesUntilMaintenance}get duration(){return this._duration}}class _F{flush(){return this._resultCode=-1,this._name="",this._nameSuggestions=[],!0}parse(e){if(!e)return!1;this._resultCode=e.readInt(),this._name=e.readString();let t=e.readInt();for(;t>0;)this._nameSuggestions.push(e.readString()),t--;return!0}get resultCode(){return this._resultCode}get name(){return this._name}get nameSuggestions(){return this._nameSuggestions}}class gF{flush(){return this._resultCode=-1,this._name="",this._nameSuggestions=[],!0}parse(e){if(!e)return!1;this._resultCode=e.readInt(),this._name=e.readString();let t=e.readInt();for(;t>0;)this._nameSuggestions.push(e.readString()),t--;return!0}get resultCode(){return this._resultCode}get name(){return this._name}get nameSuggestions(){return this._nameSuggestions}}class fF{flush(){return this._figure="",this._gender="",!0}parse(e){return e?(this._figure=e.readString(),this._gender=e.readString(),this._gender&&(this._gender=this._gender.toUpperCase()),!0):!1}get figure(){return this._figure}get gender(){return this._gender}}class mF{constructor(e){this._slotId=e.readInt(),this._figureString=e.readString(),this._gender=e.readString()}get slotId(){return this._slotId}get figureString(){return this._figureString}get gender(){return this._gender}}class EF{flush(){return this._state=0,this._outfits=[],!0}parse(e){if(!e)return!1;this._state=e.readInt();let t=e.readInt();for(;t>0;)this._outfits.push(new mF(e)),t--;return!0}get state(){return this._state}get outfits(){return this._outfits}}class gm{constructor(e){if(!e)throw new Error("invalid_parser");this._id=e.readInt(),this._name=e.readString(),this._motto=e.readString(),this._gender=e.readString(),this._figure=e.readString()}get id(){return this._id}get name(){return this._name}get motto(){return this._motto}get figure(){return this._figure}get gender(){return this._gender}}class pF{flush(){return this._item=null,this._openInventory=!1,!0}parse(e){return e?(this._item=new gm(e),this._openInventory=e.readBoolean(),!0):!1}get item(){return this._item}openInventory(){return this._openInventory}}class IF{flush(){return this._items=null,!0}parse(e){this._items=new Map;let t=e.readInt();for(;t>0;){const s=new gm(e);this._items.set(s.id,s),t--}return!0}get items(){return this._items}}class TF{flush(){return this._boughtAsGift=!1,this._item=null,!0}parse(e){return e?(this._boughtAsGift=e.readBoolean(),this._item=new gm(e),!0):!1}get boughtAsGift(){return this._boughtAsGift}get item(){return this._item}}class RF{flush(){return this._itemId=0,!0}parse(e){return e?(this._itemId=e.readInt(),!0):!1}get itemId(){return this._itemId}}class OF{constructor(e){this._name=e.readString(),this._id=e.readInt(),this._consequence=e.readString()}get name(){return this._name}get id(){return this._id}get consequence(){return this._consequence}}class SF{constructor(e){this._topics=[],this._name=e.readString();let t=e.readInt();for(;t>0;)this._topics.push(new OF(e)),t--}dispose(){this._disposed||(this._disposed=!0,this._topics=null)}get disposed(){return this._disposed}get name(){return this._name}get topics(){return this._topics}}class CF{constructor(e){this._tradeLockInfo="",this._machineBanInfo="",this._name=e.readString(),this._sanctionLengthInHours=e.readInt(),this._probationDays=e.readInt(),this._avatarOnly=e.readBoolean(),e.bytesAvailable&&(this._tradeLockInfo=e.readString()),e.bytesAvailable&&(this._machineBanInfo=e.readString())}get name(){return this._name}get sanctionLengthInHours(){return this._sanctionLengthInHours}get avatarOnly(){return this._avatarOnly}get tradeLockInfo(){return this._tradeLockInfo}get machineBanInfo(){return this._machineBanInfo}}class AF{flush(){return this._issueId=-1,this._accountId=1,this._sanctionType=null,!0}parse(e){return e?(this._issueId=e.readInt(),this._accountId=e.readInt(),this._sanctionType=new CF(e),!0):!1}get issueId(){return this._issueId}get accountId(){return this._accountId}get sanctionType(){return this._sanctionType}}class NF{flush(){return this._callForHelpCategories=null,!0}parse(e){if(!e)return!1;this._callForHelpCategories=[];let t=e.readInt();for(;t>0;)this._callForHelpCategories.push(new SF(e)),t--;return!0}get callForHelpCategories(){return this._callForHelpCategories}}class yF{flush(){return this._isSanctionNew=!1,this._isSanctionActive=!1,this._sanctionName=null,this._sanctionLengthHours=0,this._sanctionReason=null,this._sanctionCreationTime=null,this._probationHoursLeft=0,this._nextSanctionName=null,this._nextSanctionLengthHours=0,this._hasCustomMute=!1,this._tradeLockExpiryTime=null,!0}parse(e){return e?(this._isSanctionNew=e.readBoolean(),this._isSanctionActive=e.readBoolean(),this._sanctionName=e.readString(),this._sanctionLengthHours=e.readInt(),e.readInt(),this._sanctionReason=e.readString(),this._sanctionCreationTime=e.readString(),this._probationHoursLeft=e.readInt(),this._nextSanctionName=e.readString(),this._nextSanctionLengthHours=e.readInt(),e.readInt(),this._hasCustomMute=e.readBoolean(),e.bytesAvailable&&(this._tradeLockExpiryTime=e.readString()),!0):!1}get isSanctionNew(){return this._isSanctionNew}get isSanctionActive(){return this._isSanctionActive}get sanctionName(){return this._sanctionName}get sanctionLengthHours(){return this._sanctionLengthHours}get sanctionReason(){return this._sanctionReason}get sanctionCreationTime(){return this._sanctionCreationTime}get probationHoursLeft(){return this._probationHoursLeft}get nextSanctionName(){return this._nextSanctionName}get nextSanctionLengthHours(){return this._nextSanctionLengthHours}get hasCustomMute(){return this._hasCustomMute}get tradeLockExpiryTime(){return this._tradeLockExpiryTime}}class MF{constructor(){this._ok=!1,this._secondsToWait=0}flush(){return this._ok=!1,this._secondsToWait=0,this._extraDataId=null,!0}parse(e){return e?(this._ok=e.readBoolean(),this._secondsToWait=e.readInt(),this._ok&&e.bytesAvailable&&(this._extraDataId=e.readString()),!0):!1}get ok(){return this._ok}get secondsToWait(){return this._secondsToWait}get extraDataId(){return this._extraDataId}}class DF{flush(){return!0}parse(e){return!!e}}class vF{flush(){return this._roomType=null,this._roomId=-1,!0}parse(e){return e?(this._roomType=e.readString(),this._roomId=e.readInt(),!0):!1}get roomType(){return this._roomType}get roomId(){return this._roomId}}class bF{flush(){return this._url="",!0}parse(e){return e?(this._url=e.readString(),!0):!1}get url(){return this._url}}class PF{constructor(){this._ok=!1,this._errorReason=null}flush(){return this._ok=!1,this._errorReason=null,!0}parse(e){return e?(this._ok=e.readBoolean(),this._errorReason=e.readString(),!0):!1}get ok(){return this._ok}get errorReason(){return this._errorReason}}class LF{constructor(){this._creditPrice=0,this._ducketPrice=0,this._publishDucketPrice=0}flush(){return this._creditPrice=0,this._ducketPrice=0,this._publishDucketPrice=0,!0}parse(e){return e?(this._creditPrice=e.readInt(),this._ducketPrice=e.readInt(),e.bytesAvailable&&(this._publishDucketPrice=e.readInt()),!0):!1}get creditPrice(){return this._creditPrice}get ducketPrice(){return this._ducketPrice}get publishDucketPrice(){return this._publishDucketPrice}}class UF{constructor(){this._ok=!0,this._renderLimitHit=!1}flush(){return this._ok=!0,this._renderLimitHit=!1,!0}parse(e){return e?(e.bytesAvailable&&(this._ok=e.readBoolean(),this._renderLimitHit=e.readBoolean()),!0):!1}get ok(){return this._ok}get isRenderLimitHit(){return this._renderLimitHit}}class fm{parse(e){if(!e)return!1;this._campaignName=e.readString(),this._campaignImage=e.readString(),this._currentDay=e.readInt(),this._campaignDays=e.readInt(),this._openedDays=[];let t=e.readInt();for(let s=0;s<t;s++)this._openedDays.push(e.readInt());this._missedDays=[],t=e.readInt();for(let s=0;s<t;s++)this._missedDays.push(e.readInt());return!0}clone(){const e=new fm;return e.campaignDays=this._campaignDays,e.campaignImage=this._campaignImage,e.campaignName=this._campaignName,e.currentDay=this._currentDay,e.missedDays=this._missedDays,e.openedDays=this._openedDays,e}get campaignName(){return this._campaignName}set campaignName(e){this._campaignName=e}get campaignImage(){return this._campaignImage}set campaignImage(e){this._campaignImage=e}get currentDay(){return this._currentDay}set currentDay(e){this._currentDay=e}get campaignDays(){return this._campaignDays}set campaignDays(e){this._campaignDays=e}get openedDays(){return this._openedDays}set openedDays(e){this._openedDays=e}get missedDays(){return this._missedDays}set missedDays(e){this._missedDays=e}}class FF{flush(){return this._calendarData=null,!0}parse(e){return e?(this._calendarData=new fm,this._calendarData.parse(e),!0):!1}get calendarData(){return this._calendarData}}class xF{flush(){return this._doorOpened=!1,this._productName=null,this._customImage=null,this._furnitureClassName=null,!0}parse(e){return e?(this._doorOpened=e.readBoolean(),this._productName=e.readString(),this._customImage=e.readString(),this._furnitureClassName=e.readString(),!0):!1}get doorOpened(){return this._doorOpened}get productName(){return this._productName}get customImage(){return this._customImage}get furnitureClassName(){return this._furnitureClassName}}class wF{flush(){return this._totalCoinsForBonus=-1,this._coinsStillRequiredToBuy=-1,this._productType="",this._productClassId=-1,!0}parse(e){return e?(this._productType=e.readString(),this._productClassId=e.readInt(),this._totalCoinsForBonus=e.readInt(),this._coinsStillRequiredToBuy=e.readInt(),!0):!1}get totalCoinsForBonus(){return this._totalCoinsForBonus}get coinsStillRequiredToBuy(){return this._coinsStillRequiredToBuy}get productType(){return this._productType}get productClassId(){return this._productClassId}}class GF{flush(){return this._furniCount=0,!0}parse(e){return e?(this._furniCount=e.readInt(),!0):!1}get furniCount(){return this._furniCount}}class BF{flush(){return this._secondsLeft=0,this._furniLimit=0,this._maxFurniLimit=0,this._secondsLeftWithGrace=0,!0}parse(e){return e?(this._secondsLeft=e.readInt(),this._furniLimit=e.readInt(),this._maxFurniLimit=e.readInt(),e.bytesAvailable?this._secondsLeftWithGrace=e.readInt():this._secondsLeftWithGrace=this._secondsLeft,!0):!1}get secondsLeft(){return this._secondsLeft}get furniLimit(){return this._furniLimit}get maxFurniLimit(){return this._maxFurniLimit}get secondsLeftWithGrace(){return this._secondsLeftWithGrace}}class kF{constructor(e){this._maxPurchaseSize=e.readInt(),this._bundleSize=e.readInt(),this._bundleDiscountSize=e.readInt(),this._bonusThreshold=e.readInt(),this._additionalBonusDiscountThresholdQuantities=[];let t=e.readInt();for(;t>0;)this._additionalBonusDiscountThresholdQuantities.push(e.readInt()),t--}get maxPurchaseSize(){return this._maxPurchaseSize}get bundleSize(){return this._bundleSize}get bundleDiscountSize(){return this._bundleDiscountSize}get bonusThreshold(){return this._bonusThreshold}get additionalBonusDiscountThresholdQuantities(){return this._additionalBonusDiscountThresholdQuantities}}class VF{flush(){return this._bundleDiscountRuleset=null,!0}parse(e){return e?(this._bundleDiscountRuleset=new kF(e),!0):!1}get bundleDiscountRuleset(){return this._bundleDiscountRuleset}}class mm{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._visible=!1,this._icon=0,this._pageId=-1,this._pageName=null,this._localization=null,this._children=[],this._offerIds=[],!0}parse(e){if(!e)return!1;this._visible=e.readBoolean(),this._icon=e.readInt(),this._pageId=e.readInt(),this._pageName=e.readString(),this._localization=e.readString();let t=e.readInt();for(;t>0;)this._offerIds.push(e.readInt()),t--;let s=e.readInt();for(;s>0;)this._children.push(new mm(e)),s--;return!0}get visible(){return this._visible}get icon(){return this._icon}get pageId(){return this._pageId}get pageName(){return this._pageName}get localization(){return this._localization}get children(){return this._children}get offerIds(){return this._offerIds}}class HF{flush(){return this._root=null,!0}parse(e){return e?(this._root=new mm(e),this._newAdditionsAvailable=e.readBoolean(),this._catalogType=e.readString(),!0):!1}get root(){return this._root}get newAdditionsAvailable(){return this._newAdditionsAvailable}get catalogType(){return this._catalogType}}class jF{constructor(e){this._images=[],this._texts=[];let t=e.readInt();for(;t>0;)this._images.push(e.readString()),t--;let s=e.readInt();for(;s>0;)this._texts.push(e.readString()),s--}get images(){return this._images}get texts(){return this._texts}}class WF{flush(){return this._pageName=null,this._pageId=0,this._secondsToExpiry=0,this._image=null,!0}parse(e){return e?(this._pageId=e.readInt(),this._pageName=e.readString(),this._secondsToExpiry=e.readInt(),this._image=e.readString(),!0):!1}get pageName(){return this._pageName}get pageId(){return this._pageId}get secondsToExpiry(){return this._secondsToExpiry}get image(){return this._image}}const eu=class OO{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._productType=null,this._furniClassId=-1,this._extraParam=null,this._productCount=0,this._uniqueLimitedItem=!1,this._uniqueLimitedItemSeriesSize=0,this._uniqueLimitedItemsLeft=0,!0}parse(e){switch(this._productType=e.readString(),this._productType){case OO.B:return this._extraParam=e.readString(),this._productCount=1,!0;default:return this._furniClassId=e.readInt(),this._extraParam=e.readString(),this._productCount=e.readInt(),this._uniqueLimitedItem=e.readBoolean(),this._uniqueLimitedItem&&(this._uniqueLimitedItemSeriesSize=e.readInt(),this._uniqueLimitedItemsLeft=e.readInt()),!0}}get productType(){return this._productType}get furniClassId(){return this._furniClassId}get extraParam(){return this._extraParam}get productCount(){return this._productCount}get uniqueLimitedItem(){return this._uniqueLimitedItem}get uniqueLimitedSeriesSize(){return this._uniqueLimitedItemSeriesSize}get uniqueLimitedItemsLeft(){return this._uniqueLimitedItemsLeft}};eu.I="i";eu.S="s";eu.E="e";eu.B="b";let Hn=eu;class Sd{constructor(e){this._offerId=e.readInt(),this._localizationId=e.readString(),this._rent=e.readBoolean(),this._priceCredits=e.readInt(),this._priceActivityPoints=e.readInt(),this._priceActivityPointsType=e.readInt(),this._giftable=e.readBoolean(),this._products=[];let t=e.readInt();for(;t>0;)this._products.push(new Hn(e)),t--;this._clubLevel=e.readInt(),this._bundlePurchaseAllowed=e.readBoolean(),this._isPet=e.readBoolean(),this._previewImage=e.readString()}get offerId(){return this._offerId}get localizationId(){return this._localizationId}get rent(){return this._rent}get priceCredits(){return this._priceCredits}get priceActivityPoints(){return this._priceActivityPoints}get priceActivityPointsType(){return this._priceActivityPointsType}get clubLevel(){return this._clubLevel}get giftable(){return this._giftable}get bundlePurchaseAllowed(){return this._bundlePurchaseAllowed}get isPet(){return this._isPet}get previewImage(){return this._previewImage}get products(){return this._products}}const Cd=class dh{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._type=-1,this._position=null,this._itemName=null,this._itemPromoImage=null,this._catalogPageLocation=null,this._productCode=null,this._productOfferId=0,this._expirationTime=0,!0}parse(e){if(!e)return!1;switch(this._position=e.readInt(),this._itemName=e.readString(),this._itemPromoImage=e.readString(),this._type=e.readInt(),this._type){case dh.ITEM_CATALOGUE_PAGE:this._catalogPageLocation=e.readString();break;case dh.ITEM_PRODUCT_OFFER:this._productOfferId=e.readInt();break;case dh.ITEM_IAP:this._productCode=e.readString();break}const t=e.readInt();return this._expirationTime=t>0?t*1e3+ve():0,!0}get type(){return this._type}get position(){return this._position}get itemName(){return this._itemName}get itemPromoImage(){return this._itemPromoImage}get catalogPageLocation(){return this._catalogPageLocation}get productCode(){return this._productCode}get productOfferId(){return this._productOfferId}get expirationTime(){return this._expirationTime}};Cd.ITEM_CATALOGUE_PAGE=0;Cd.ITEM_PRODUCT_OFFER=1;Cd.ITEM_IAP=2;let Mg=Cd;class YF{flush(){return this._pageId=-1,this._catalogType=null,this._layoutCode=null,this._localization=null,this._offers=[],this._offerId=-1,this._acceptSeasonCurrencyAsCredits=!1,this._frontPageItems=[],!0}parse(e){if(!e)return!1;this._pageId=e.readInt(),this._catalogType=e.readString(),this._layoutCode=e.readString(),this._localization=new jF(e);let t=e.readInt();for(;t>0;)this._offers.push(new Sd(e)),t--;if(this._offerId=e.readInt(),this._acceptSeasonCurrencyAsCredits=e.readBoolean(),e.bytesAvailable){let s=e.readInt();for(;s>0;)this._frontPageItems.push(new Mg(e)),s--}return!0}get pageId(){return this._pageId}get catalogType(){return this._catalogType}get layoutCode(){return this._layoutCode}get localization(){return this._localization}get offers(){return this._offers}get offerId(){return this._offerId}get acceptSeasonCurrencyAsCredits(){return this._acceptSeasonCurrencyAsCredits}get frontPageItems(){return this._frontPageItems}}class zF{flush(){return this._pageName=null,this._secondsToExpiry=0,this._image=null,!0}parse(e){return e?(this._pageName=e.readString(),this._secondsToExpiry=e.readInt(),this._image=e.readString(),!0):!1}get pageName(){return this._pageName}get secondsToExpiry(){return this._secondsToExpiry}get image(){return this._image}}class KF{flush(){return this._instantlyRefreshCatalogue=!1,this._newFurniDataHash=null,!0}parse(e){return e?(this._instantlyRefreshCatalogue=e.readBoolean(),e.bytesAvailable&&(this._newFurniDataHash=e.readString()),!0):!1}get instantlyRefreshCatalogue(){return this._instantlyRefreshCatalogue}get newFurniDataHash(){return this._newFurniDataHash}}class XF{constructor(e){this._offerId=e.readInt(),this._isVip=e.readBoolean(),this._daysRequired=e.readInt(),this._isSelectable=e.readBoolean()}get offerId(){return this._offerId}get isVip(){return this._isVip}get isSelectable(){return this._isSelectable}get daysRequired(){return this._daysRequired}}class qF{flush(){return!0}parse(e){if(!e)return!1;this._offers=[],this._giftData=new Map,this._daysUntilNextGift=e.readInt(),this._giftsAvailable=e.readInt();const t=e.readInt();for(let r=0;r<t;r++)this._offers.push(new Sd(e));const s=e.readInt();for(let r=0;r<s;r++){const i=new XF(e);this._giftData.set(i.offerId,i)}return!0}get offers(){return this._offers}get daysUntilNextGift(){return this._daysUntilNextGift}get giftsAvailable(){return this._giftsAvailable}set giftsAvailable(e){this._giftsAvailable=e}getOfferExtraData(e){return e?this._giftData.get(e):null}get giftData(){return this._giftData}}class QF{flush(){return this._productCode=null,this._products=[],!0}parse(e){if(!e)return!1;this._productCode=e.readString();let t=e.readInt();for(;t>0;)this._products.push(new Hn(e)),t--;return!0}get productCode(){return this._productCode}get products(){return this._products}}class SO{constructor(e){if(!e)throw new Error("invalid_wrapper");this._offerId=e.readInt(),this._productCode=e.readString(),e.readBoolean(),this._priceCredits=e.readInt(),this._priceActivityPoints=e.readInt(),this._priceActivityPointsType=e.readInt(),this._vip=e.readBoolean(),this._months=e.readInt(),this._extraDays=e.readInt(),this._giftable=e.readBoolean(),this._daysLeftAfterPurchase=e.readInt(),this._year=e.readInt(),this._month=e.readInt(),this._day=e.readInt()}get offerId(){return this._offerId}get productCode(){return this._productCode}get priceCredits(){return this._priceCredits}get priceActivityPoints(){return this._priceActivityPoints}get priceActivityPointsType(){return this._priceActivityPointsType}get vip(){return this._vip}get months(){return this._months}get extraDays(){return this._extraDays}get daysLeftAfterPurchase(){return this._daysLeftAfterPurchase}get year(){return this._year}get month(){return this._month}get day(){return this._day}get giftable(){return this._giftable}}class JF extends SO{constructor(e){super(e),this._originalPrice=e.readInt(),this._originalActivityPointPrice=e.readInt(),this._originalActivityPointType=e.readInt(),this._subscriptionDaysLeft=e.readInt()}get originalPrice(){return this._originalPrice*this.months}get originalActivityPointPrice(){return this._originalActivityPointPrice*this.months}get originalActivityPointType(){return this._originalActivityPointType}get discountCreditAmount(){return this._originalPrice*this.months-this.priceCredits}get discountActivityPointAmount(){return this.originalActivityPointPrice*this.months-this.priceActivityPoints}get subscriptionDaysLeft(){return this._subscriptionDaysLeft}}class ZF{flush(){return this._available=!1,this._pricePointUrl=null,this._market=null,this._lengthInDays=0,!0}parse(e){return e?(this._pricePointUrl=e.readString(),this._pricePointUrl!==""&&(this._available=!0),this._market=e.readString(),this._lengthInDays=e.readInt(),!0):!1}get available(){return this._available}get pricePointUrl(){return this._pricePointUrl}get market(){return this._market}get lengthInDays(){return this._lengthInDays}}class $F{constructor(e){this._stuffId=e.readInt(),this._charges=e.readInt(),this._SafeStr_6935=e.readInt(),this._SafeStr_6936=e.readInt(),this._SafeStr_6518=e.readInt(),this._SafeStr_7875=e.readInt()}get stuffId(){return this._stuffId}get charges(){return this._charges}get _SafeStr_5946(){return this._SafeStr_6935}get _SafeStr_5944(){return this._SafeStr_6936}get _SafeStr_7876(){return this._SafeStr_7875}get _SafeStr_5945(){return this._SafeStr_6518}}class e1{flush(){return this._fireworkChargeData=null,!0}parse(e){return e?(this._fireworkChargeData=new $F(e),!0):!1}get fireworkChargeData(){return this._fireworkChargeData}}class t1{flush(){return!0}parse(e){return!!e}}class s1{constructor(){this._isEnabled=!1,this._price=null,this._giftWrappers=null,this._boxTypes=null,this._ribbonTypes=null,this._giftFurnis=null}flush(){return this._boxTypes=null,this._giftFurnis=null,this._giftWrappers=null,this._ribbonTypes=null,this._isEnabled=null,this._price=null,!0}parse(e){if(!e)return!1;const t=[],s=[],r=[],i=[];this._isEnabled=e.readBoolean(),this._price=e.readInt();let a=e.readInt(),l=0;for(;l<a;)t.push(e.readInt()),l++;for(a=e.readInt(),l=0;l<a;)s.push(e.readInt()),l++;for(a=e.readInt(),l=0;l<a;)r.push(e.readInt()),l++;for(a=e.readInt(),l=0;l<a;)i.push(e.readInt()),l++;return this._giftWrappers=t,this._ribbonTypes=r,this._giftFurnis=i,this._boxTypes=s,!0}get giftWrappers(){return this._giftWrappers}get ribbonTypes(){return this._ribbonTypes}get giftFurnis(){return this._giftFurnis}get boxTypes(){return this._boxTypes}get isEnabled(){return this._isEnabled}get price(){return this._price}}class r1{flush(){return this._offer=null,!0}parse(e){return e?(this._offer=new JF(e),!0):!1}get offer(){return this._offer}}class i1{flush(){return this._offers=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._offers.push(new SO(e)),t--;return!0}get offers(){return this._offers}}class n1{flush(){return this._offerId=0,this._isGiftable=!1,!0}parse(e){return e?(this._offerId=e.readInt(),this._isGiftable=e.readBoolean(),!0):!1}get offerId(){return this._offerId}get isGiftable(){return this._isGiftable}}class a1{flush(){return!0}parse(e){return!!e}}class o1{flush(){return this._appearsInSeconds=-1,this._pageId=-1,this._offerId=-1,this._productType="",!0}parse(e){return e?(this._appearsInSeconds=e.readInt(),this._pageId=e.readInt(),this._offerId=e.readInt(),this._productType=e.readString(),!0):!1}get appearsInSeconds(){return this._appearsInSeconds}get pageId(){return this._pageId}get offerId(){return this._offerId}get productType(){return this._productType}}class l1{constructor(){this._notEnoughCredits=!1,this._notEnoughActivityPoints=!1,this._activityPointType=0}flush(){return this._notEnoughCredits=!1,this._notEnoughActivityPoints=!1,this._activityPointType=0,!0}parse(e){return e?(this._notEnoughCredits=e.readBoolean(),this._notEnoughActivityPoints=e.readBoolean(),e.bytesAvailable&&(this._activityPointType=e.readInt()),!0):!1}get notEnoughCredits(){return this._notEnoughCredits}get notEnoughActivityPoints(){return this._notEnoughActivityPoints}get activityPointType(){return this._activityPointType}}class c1{flush(){return this._offer=null,!0}parse(e){return e?(this._offer=new Sd(e),!0):!1}get offer(){return this._offer}}class u1{flush(){return this._code=0,!0}parse(e){return e?(this._code=e.readInt(),!0):!1}get code(){return this._code}}class h1{flush(){return this._code=0,!0}parse(e){return e?(this._code=e.readInt(),!0):!1}get code(){return this._code}}class d1{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._offerId=-1,this._localizationId=null,this._rent=!1,this._priceCredits=0,this._priceActivityPoints=0,this._priceActivityPointsType=0,this._clubLevel=0,this._giftable=!1,this._bundlePurchaseAllowed=!1,this._products=[],!0}parse(e){if(!e)return!1;this._offerId=e.readInt(),this._localizationId=e.readString(),this._rent=e.readBoolean(),this._priceCredits=e.readInt(),this._priceActivityPoints=e.readInt(),this._priceActivityPointsType=e.readInt(),this._giftable=e.readBoolean();let t=e.readInt();for(;t>0;)this._products.push(new Hn(e)),t--;return this._clubLevel=e.readInt(),this._bundlePurchaseAllowed=e.readBoolean(),!0}get offerId(){return this._offerId}get localizationId(){return this._localizationId}get rent(){return this._rent}get priceCredits(){return this._priceCredits}get priceActivityPoints(){return this._priceActivityPoints}get priceActivityPointsType(){return this._priceActivityPointsType}get clubLevel(){return this._clubLevel}get giftable(){return this._giftable}get bundlePurchaseAllowed(){return this._bundlePurchaseAllowed}get products(){return this._products}}class _1{flush(){return this._offer=null,!0}parse(e){return e?(this._offer=new d1(e),!0):!1}get offer(){return this._offer}}class g1{flush(){return this._clubLevel=0,this._securityLevel=0,this._isAmbassador=!1,!0}parse(e){return e?(this._clubLevel=e.readInt(),this._securityLevel=e.readInt(),this._isAmbassador=e.readBoolean(),!0):!1}get clubLevel(){return this._clubLevel}get securityLevel(){return this._securityLevel}get isAmbassador(){return this._isAmbassador}}class Ad{flush(){return!0}parse(e){return e?(this._status=e.readInt(),!0):!1}get status(){return this._status}}Ad.SAFETY_LOCK_STATUS_LOCKED=0;Ad.SAFETY_LOCK_STATUS_UNLOCKED=1;class f1{flush(){return this._result=-1,this._validationInfo="",!0}parse(e){return e?(this._result=e.readInt(),this._validationInfo=e.readString(),!0):!1}get result(){return this._result}get validationInfo(){return this._validationInfo}}class CO{flush(){return this._result=-1,!0}parse(e){return e?(this._result=e.readInt(),!0):!1}get result(){return this._result}}CO.EMAIL_STATUS_OK=0;class m1{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._relationshipStatusType=Xs.NONE,this._friendCount=0,this._randomFriendId=0,this._randomFriendFigure=null,this._randomFriendName=null,!0}parse(e){return e?(this._relationshipStatusType=e.readInt(),this._friendCount=e.readInt(),this._randomFriendId=e.readInt(),this._randomFriendName=e.readString(),this._randomFriendFigure=e.readString(),!0):!1}get relationshipStatusType(){return this._relationshipStatusType}get friendCount(){return this._friendCount}get randomFriendId(){return this._randomFriendId}get randomFriendName(){return this._randomFriendName}get randomFriendFigure(){return this._randomFriendFigure}}class E1{flush(){return this._userId=0,this._relationshipStatusMap=null,!0}parse(e){if(!e)return!1;this._userId=e.readInt(),this._relationshipStatusMap=new Zt;const t=e.readInt();for(let s=0;s<t;s++){const r=new m1(e);this._relationshipStatusMap.add(r.relationshipStatusType,r)}return!0}get userId(){return this._userId}get relationshipStatusMap(){return this._relationshipStatusMap}}class p1{flush(){return this._userId=null,this._badges=[],!0}parse(e){if(!e)return!1;this._userId=e.readInt();let t=e.readInt();for(;t>0;){e.readInt();const s=e.readString();this._badges.push(s),t--}return!0}get userId(){return this._userId}get badges(){return this._badges}}class I1{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._userId=0,this._username=null,this._figure=null,this._gender=null,this._motto=null,this._realName=null,this._directMail=!1,this._respectsReceived=0,this._respectsRemaining=0,this._respectsPetRemaining=0,this._streamPublishingAllowed=!1,this._lastAccessDate=null,this._canChangeName=!1,this._safetyLocked=!1,!0}parse(e){return e?(this._userId=e.readInt(),this._username=e.readString(),this._figure=e.readString(),this._gender=e.readString(),this._motto=e.readString(),this._realName=e.readString(),this._directMail=e.readBoolean(),this._respectsReceived=e.readInt(),this._respectsRemaining=e.readInt(),this._respectsPetRemaining=e.readInt(),this._streamPublishingAllowed=e.readBoolean(),this._lastAccessDate=e.readString(),this._canChangeName=e.readBoolean(),this._safetyLocked=e.readBoolean(),!0):!1}get userId(){return this._userId}get username(){return this._username}get figure(){return this._figure}get gender(){return this._gender}get motto(){return this._motto}get realName(){return this._realName}get directMail(){return this._directMail}get respectsReceived(){return this._respectsReceived}get respectsRemaining(){return this._respectsRemaining}get respectsPetRemaining(){return this._respectsPetRemaining}get streamPublishingAllowed(){return this._streamPublishingAllowed}get lastAccessedDate(){return this._lastAccessDate}get canChangeName(){return this._canChangeName}get safetyLocked(){return this._safetyLocked}}class T1{flush(){return this._userInfo=null,!0}parse(e){return!(!e||(this._userInfo=new I1(e),!this._userInfo))}get userInfo(){return this._userInfo}}class R1{flush(){return this._webId=-1,this._id=-1,this._newName="",!0}parse(e){return e?(this._webId=e.readInt(),this._id=e.readInt(),this._newName=e.readString(),!0):!1}get webId(){return this._webId}get id(){return this._id}get newName(){return this._newName}}class AO{constructor(e){this._groupId=e.readInt(),this._groupName=e.readString(),this._badgeCode=e.readString(),this._colorA=e.readString(),this._colorB=e.readString(),this._favourite=e.readBoolean(),this._ownerId=e.readInt(),this._hasForum=e.readBoolean()}get groupId(){return this._groupId}get groupName(){return this._groupName}get badgeCode(){return this._badgeCode}get colorA(){return this._colorA}get colorB(){return this._colorB}get favourite(){return this._favourite}get ownerId(){return this._ownerId}get hasForum(){return this._hasForum}}class O1{flush(){return this._id=0,this._username=null,this._figure=null,this._motto=null,this._registration=null,this._achievementPoints=0,this._friendsCount=0,this._isMyFriend=!1,this._requestSent=!1,this._isOnline=!1,this._groups=[],this._secondsSinceLastVisit=0,this._openProfileWindow=!1,!0}parse(e){if(!e)return!1;this._id=e.readInt(),this._username=e.readString(),this._figure=e.readString(),this._motto=e.readString(),this._registration=e.readString(),this._achievementPoints=e.readInt(),this._friendsCount=e.readInt(),this._isMyFriend=e.readBoolean(),this._requestSent=e.readBoolean(),this._isOnline=e.readBoolean();const t=e.readInt();for(let s=0;s<t;s++)this._groups.push(new AO(e));return this._secondsSinceLastVisit=e.readInt(),this._openProfileWindow=e.readBoolean(),!0}get id(){return this._id}get username(){return this._username}get figure(){return this._figure}get motto(){return this._motto}get registration(){return this._registration}get achievementPoints(){return this._achievementPoints}get friendsCount(){return this._friendsCount}get isMyFriend(){return this._isMyFriend}get requestSent(){return this._requestSent}get isOnline(){return this._isOnline}get groups(){return this._groups}get secondsSinceLastVisit(){return this._secondsSinceLastVisit}get openProfileWindow(){return this._openProfileWindow}}class S1{flush(){return this._volumeSystem=0,this._volumeFurni=0,this._volumeTrax=0,this._oldChat=!1,this._roomInvites=!1,this._cameraFollow=!1,this._flags=0,this._chatType=0,!0}parse(e){return e?(this._volumeSystem=e.readInt(),this._volumeFurni=e.readInt(),this._volumeTrax=e.readInt(),this._oldChat=e.readBoolean(),this._roomInvites=e.readBoolean(),this._cameraFollow=e.readBoolean(),this._flags=e.readInt(),this._chatType=e.readInt(),!0):!1}get volumeSystem(){return this._volumeSystem}get volumeFurni(){return this._volumeFurni}get volumeTrax(){return this._volumeTrax}get oldChat(){return this._oldChat}get roomInvites(){return this._roomInvites}get cameraFollow(){return this._cameraFollow}get flags(){return this._flags}get chatType(){return this._chatType}}class C1{flush(){return this._roomUnitId=-1,this._tags=[],!0}parse(e){if(!e)return!1;this._roomUnitId=e.readInt();let t=e.readInt();for(;t>0;)this._tags.push(e.readString()),t--;return!0}get roomUnitId(){return this._roomUnitId}get tags(){return this._tags}}class A1{flush(){return this._email=null,this._isVerified=!1,this._allowChange=!1,!0}parse(e){return e?(this._email=e.readString(),this._isVerified=e.readBoolean(),this._allowChange=e.readBoolean(),!0):!1}get email(){return this._email}get isVerified(){return this._isVerified}get allowChange(){return this._allowChange}}class N1{flush(){return this._userId=-1,!0}parse(e){return e?(this._userId=e.readInt(),!0):!1}get userId(){return this._userId}}class y1{flush(){return this._groupId=-1,!0}parse(e){return e?(this._groupId=e.readInt(),!0):!1}get groupId(){return this._groupId}}class M1{flush(){return this._groupId=-1,this._requester=null,!0}parse(e){return e?(this._groupId=e.readInt(),this._requester=new pY(e),!0):!1}get groupId(){return this._groupId}get requester(){return this._requester}}class NO{flush(){return this._reason=-1,!0}parse(e){return e?(this._reason=e.readInt(),!0):!1}get reason(){return this._reason}}NO.INSUFFICIENT_SUBSCRIPTION_LEVEL=2;class D1{flush(){return this._guildId=-1,this._reason=-1,!0}parse(e){return e?(this._guildId=e.readInt(),this._reason=e.readInt(),!0):!1}get guildId(){return this._guildId}get reason(){return this._reason}}class v1{flush(){return this._groups=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._groups.push(new AO(e)),t--;return!0}get groups(){return this._groups}}class b1{flush(){return this._badges=new Map,!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=e.readInt(),r=e.readString();this._badges.set(s,r),t--}return!0}get badges(){return this._badges}}class yO{flush(){return this._reason=-1,!0}parse(e){return e?(this._reason=e.readInt(),!0):!1}get reason(){return this._reason}}yO.INSUFFICIENT_SUBSCRIPTION_LEVEL=4;class P1{flush(){return this._ignoredUsers=[],!0}parse(e){if(!e)return!1;this._ignoredUsers=[];let t=e.readInt();for(;t>0;)this._ignoredUsers.push(e.readString()),t--;return!0}get ignoredUsers(){return this._ignoredUsers}}class L1{flush(){return this._result=-1,this._name=null,!0}parse(e){return e?(this._result=e.readInt(),this._name=e.readString(),!0):!1}get result(){return this._result}get name(){return this._name}}class U1{flush(){return this._link=null,!0}parse(e){return e?(this._link=e.readString(),!0):!1}get link(){return this._link}}class F1{flush(){return this._credits=null,!0}parse(e){return e?(this._credits=e.readString(),!0):!1}get credits(){return this._credits}}class x1{flush(){return this._currencies=new Map,!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._currencies.set(e.readInt(),e.readInt()),t--;return!0}get currencies(){return this._currencies}}class kl{flush(){return this._productName=null,this._daysToPeriodEnd=0,this._memberPeriods=0,this._periodsSubscribedAhead=0,this._responseType=0,this._hasEverBeenMember=!1,this._isVip=!1,this._pastClubDays=0,this._pastVipDays=0,this._minutesUntilExpiration=0,this._minutesSinceLastModified=0,!0}parse(e){return e?(this._productName=e.readString(),this._daysToPeriodEnd=e.readInt(),this._memberPeriods=e.readInt(),this._periodsSubscribedAhead=e.readInt(),this._responseType=e.readInt(),this._hasEverBeenMember=e.readBoolean(),this._isVip=e.readBoolean(),this._pastClubDays=e.readInt(),this._pastVipDays=e.readInt(),this._minutesUntilExpiration=e.readInt(),e.bytesAvailable&&(this._minutesSinceLastModified=e.readInt()),!0):!1}get productName(){return this._productName}get daysToPeriodEnd(){return this._daysToPeriodEnd}get memberPeriods(){return this._memberPeriods}get periodsSubscribedAhead(){return this._periodsSubscribedAhead}get responseType(){return this._responseType}get hasEverBeenMember(){return this._hasEverBeenMember}get isVip(){return this._isVip}get pastClubDays(){return this._pastClubDays}get pastVipDays(){return this._pastVipDays}get minutesUntilExpiration(){return this._minutesUntilExpiration}get minutesSinceLastModified(){return this._minutesSinceLastModified}}kl.RESPONSE_TYPE_LOGIN=1;kl.RESPONSE_TYPE_PURCHASE=2;kl.RESPONSE_TYPE_DISCOUNT_AVAILABLE=3;kl.RESPONSE_TYPE_CITIZENSHIP_DISCOUNT=4;class Vl{constructor(e){if(this._unseen=0,!e)throw new Error("invalid_parser");this._achievementId=e.readInt(),this._level=e.readInt(),this._badgeId=e.readString(),this._scoreAtStartOfLevel=e.readInt(),this._scoreLimit=Math.max(1,e.readInt()),this._levelRewardPoints=e.readInt(),this._levelRewardPointType=e.readInt(),this._currentPoints=e.readInt(),this._finalLevel=e.readBoolean(),this._category=e.readString(),this._subCategory=e.readString(),this._levelCount=e.readInt(),this._displayMethod=e.readInt()}get achievementId(){return this._achievementId}get badgeId(){return this._badgeId}get level(){return this._level}get scoreAtStartOfLevel(){return this._scoreAtStartOfLevel}get scoreLimit(){return this._scoreLimit-this._scoreAtStartOfLevel}get levelRewardPoints(){return this._levelRewardPoints}get levelRewardPointType(){return this._levelRewardPointType}get currentPoints(){return this._currentPoints-this._scoreAtStartOfLevel}get finalLevel(){return this._finalLevel}get category(){return this._category}get subCategory(){return this._subCategory}get levelCount(){return this._levelCount}get firstLevelAchieved(){return this._level>1||this._finalLevel}setMaxProgress(){this._currentPoints=this._scoreLimit}get displayMethod(){return this._displayMethod}get progress(){return this._currentPoints}get toNextProgress(){return this._scoreLimit}set unseen(e){this._unseen=e}get unseen(){return this._unseen}reset(e){this._achievementId=e._achievementId,this._level=e._level,this._badgeId=e._badgeId,this._scoreAtStartOfLevel=e._scoreAtStartOfLevel,this._scoreLimit=e._scoreLimit,this._levelRewardPoints=e._levelRewardPoints,this._levelRewardPointType=e._levelRewardPointType,this._currentPoints=e._currentPoints,this._finalLevel=e._finalLevel,this._category=e.category,this._subCategory=e._subCategory,this._levelCount=e._levelCount,this._displayMethod=e._displayMethod}}Vl.DISPLAY_METHOD_OBSOLETE=-1;Vl.DISPLAY_METHOD_SHOW_LEVEL_PROGRESS=0;Vl.DISPLAY_METHOD_NEVER_SHOW_PROGRESS=1;Vl.DISPLAY_METHOD_SHOW_TOTAL_PROGRESS=2;class w1{flush(){return this._achievement=null,!0}parse(e){return e?(this._achievement=new Vl(e),!0):!1}get achievement(){return this._achievement}}const MO=class DO{constructor(e){this._achievementId=e.readInt(),this._level=e.readInt(),this._badgeId=e.readString(),this._requiredLevel=e.readInt(),this._state=e.readInt()}dispose(){this._achievementId=0,this._level=0,this._badgeId="",this._requiredLevel=0}get achievementId(){return this._achievementId}get level(){return this._level}get badgeId(){return this._badgeId}get requiredLevel(){return this._requiredLevel}get enabled(){return this._state===DO.STATE_SELECTABLE}get state(){return this._state}};MO.STATE_SELECTABLE=0;let G1=MO;class B1{flush(){return this._achievements=[],this._defaultCategory=null,!0}parse(e){if(!e)return!1;this._achievements=[];let t=e.readInt();for(;t>0;)this._achievements.push(new Vl(e)),t--;return this._defaultCategory=e.readString(),!0}get achievements(){return this._achievements}get defaultCategory(){return this._defaultCategory}}class k1{flush(){return this._score=0,!0}parse(e){return e?(this._score=e.readInt(),!0):!1}get score(){return this._score}}class V1{get type(){return this._type}set type(e){this._type=e}get subType(){return this._subType}set subType(e){this._subType=e}get duration(){return this._duration}set duration(e){this._duration=e}get inactiveEffectsInInventory(){return this._inactiveEffectsInInventory}set inactiveEffectsInInventory(e){this._inactiveEffectsInInventory=e}get secondsLeftIfActive(){return this._secondsLeftIfActive}set secondsLeftIfActive(e){this._secondsLeftIfActive=e}get isPermanent(){return this._permanent}set isPermanent(e){this._permanent=e}}class H1{flush(){return this._type=0,this._duration=0,this._isPermanent=!1,!0}parse(e){return e?(this._type=e.readInt(),this._duration=e.readInt(),this._isPermanent=e.readBoolean(),!0):!1}get type(){return this._type}get duration(){return this._duration}get isPermanent(){return this._isPermanent}}class j1{flush(){return this._type=0,this._subType=0,this._duration=0,this._permanent=!1,!0}parse(e){return e?(this._type=e.readInt(),this._subType=e.readInt(),this._duration=e.readInt(),this._permanent=e.readBoolean(),!0):!1}get type(){return this._type}get subType(){return this._subType}get duration(){return this._duration}get isPermanent(){return this._permanent}}class W1{flush(){return this._type=0,!0}parse(e){return e?(this._type=e.readInt(),!0):!1}get type(){return this._type}}class Y1{flush(){return this._type=0,!0}parse(e){return e?(this._type=e.readInt(),!0):!1}get type(){return this._type}}class z1{flush(){return this._effects=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=new V1;s.type=e.readInt(),s.subType=e.readInt(),s.duration=e.readInt(),s.inactiveEffectsInInventory=e.readInt(),s.secondsLeftIfActive=e.readInt(),s.isPermanent=e.readBoolean(),this._effects.push(s),t--}return!0}get effects(){return this._effects}}class K1{constructor(e,t){if(!t)throw new Error("invalid_parser");this._badgeId="ACH_"+e+t.readInt(),this._limit=t.readInt()}get badgeId(){return this._badgeId}get limit(){return this._limit}}class X1{flush(){return this._data=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=e.readString(),r=e.readInt();let i=0;for(;i<r;)this._data.push(new K1(s,e)),i++;t--}return!0}get data(){return this._data}}class q1{flush(){return this._badgeId=0,this._badgeCode=null,!0}parse(e){return e?(this._badgeId=e.readInt(),this._badgeCode=e.readString(),!0):!1}get badgeId(){return this._badgeId}get badgeCode(){return this._badgeCode}}class Q1{flush(){return this._allBadgeCodes=[],this._activeBadgeCodes=null,this._badgeIds=null,!0}parse(e){if(!e)return!1;this._allBadgeCodes=[],this._activeBadgeCodes=[],this._badgeIds=new Zt;let t=e.readInt();for(;t>0;){const s=e.readInt(),r=e.readString();this._badgeIds.add(r,s),this._allBadgeCodes.push(r),t--}for(t=e.readInt();t>0;){e.readInt();const s=e.readString();this._activeBadgeCodes.push(s),t--}return!0}getBadgeId(e){return this._badgeIds.getValue(e)}getAllBadgeCodes(){return this._allBadgeCodes}getActiveBadgeCodes(){return this._activeBadgeCodes}}class J1{flush(){return!0}parse(e){return e?(this._requestCode=e.readString(),this._fulfilled=e.readBoolean(),!0):!1}get requestCode(){return this._requestCode}get fulfilled(){return this._fulfilled}}class Z1{flush(){return this._figureSetIds=[],this._boundFurnitureNames=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._figureSetIds.push(e.readInt()),t--;let s=e.readInt();for(;s>0;)this._boundFurnitureNames.push(e.readString()),s--;return!0}get figureSetIds(){return this._figureSetIds}get boundsFurnitureNames(){return this._boundFurnitureNames}}class va{flush(){return this._reason=0,this._parameter="",!0}parse(e){return e?(this._reason=e.readInt(),this._parameter=e.readString(),!0):!1}get reason(){return this._reason}get parameter(){return this._parameter}}va.REASON_FULL=1;va.REASON_CLOSED=2;va.REASON_QUEUE_ERROR=3;va.REASON_BANNED=4;class $1{flush(){return this._userName=null,!0}parse(e){return e?(this._userName=e.readString(),!0):!1}get userName(){return this._userName}}class ex{flush(){return!0}parse(e){return!!e}}class tx{flush(){return!0}parse(e){return!!e}}class sx{flush(){return this._controllerLevel=ct.NONE,!0}parse(e){return e?(this._controllerLevel=e.readInt(),!0):!1}get controllerLevel(){return this._controllerLevel}}class rx{flush(){return!0}parse(e){return!!e}}class ix{flush(){return this._roomId=0,!0}parse(e){return e?(this._roomId=e.readInt(),!0):!1}get roomId(){return this._roomId}}class nx{flush(){return this._botId=-1,this._commandId=-1,this._data="",!0}parse(e){return e?(this._botId=e.readInt(),this._commandId=e.readInt(),this._data=e.readString(),!0):!1}get botId(){return this._botId}get commandId(){return this._commandId}get data(){return this._data}}class ax{flush(){return this._botId=-1,!0}parse(e){return e?(this._botId=e.readInt(),!0):!1}get botId(){return this._botId}}class ox{constructor(e){this._id=e.readInt(),this._data=e.readString()}get id(){return this._id}get data(){return this._data}}class lx{flush(){return this._botId=-1,this._skillList=[],!0}parse(e){if(!e)return!1;this._botId=e.readInt();let t=e.readInt();for(;t>0;)this._skillList.push(new ox(e)),t--;return!0}get botId(){return this._botId}get skillList(){return this._skillList}}class cx{constructor(e){this._userId=e.readInt(),this._userName=e.readString()}get userId(){return this._userId}get userName(){return this._userName}}class ux{flush(){return this._roomId=0,this._bannedUsers=[],!0}parse(e){if(!e)return!1;this._roomId=e.readInt();let t=e.readInt();for(;t>0;)this._bannedUsers.push(new cx(e)),t--;return!0}get roomId(){return this._roomId}get bannedUsers(){return this._bannedUsers}}class hx{constructor(e){this._userId=e.readInt(),this._userName=e.readString()}get userId(){return this._userId}get userName(){return this._userName}get selected(){return this._selected}set selected(e){this._selected=e}}class dx{flush(){return this._roomId=0,this._data=null,!0}parse(e){return e?(this._roomId=e.readInt(),this._data=new hx(e),!0):!1}get roomId(){return this._roomId}get data(){return this._data}}class _x{flush(){return this._roomId=0,this._userId=0,!0}parse(e){return e?(this._roomId=e.readInt(),this._userId=e.readInt(),!0):!1}get roomId(){return this._roomId}get userId(){return this._userId}}class gx{flush(){return this._roomId=0,this._users=new Map,!0}parse(e){if(!e)return!1;this._roomId=e.readInt();let t=e.readInt();for(;t>0;){const s=e.readInt(),r=e.readString();this._users.set(s,r),t--}return!0}get roomId(){return this._roomId}get users(){return this._users}}class fx{flush(){return!0}parse(e){return e?(this._isMuted=e.readBoolean(),!0):!1}get isMuted(){return this._isMuted}}class mx{flush(){return this._roomId=0,!0}parse(e){return e?(this._roomId=e.readInt(),!0):!1}get roomId(){return this._roomId}}class dt{constructor(e){if(!e)throw new Error("invalid_wrapper");this._mode=e.readInt(),this._weight=e.readInt(),this._speed=e.readInt(),this._distance=e.readInt(),this._protection=e.readInt()}get mode(){return this._mode}get weight(){return this._weight}get speed(){return this._speed}get distance(){return this._distance}get protection(){return this._protection}}dt.CHAT_MODE_FREE_FLOW=0;dt.CHAT_MODE_LINE_BY_LINE=1;dt.CHAT_BUBBLE_WIDTH_WIDE=0;dt.CHAT_BUBBLE_WIDTH_NORMAL=1;dt.CHAT_BUBBLE_WIDTH_THIN=2;dt.CHAT_SCROLL_SPEED_FAST=0;dt.CHAT_SCROLL_SPEED_NORMAL=1;dt.CHAT_SCROLL_SPEED_SLOW=2;dt.FLOOD_FILTER_STRICT=0;dt.FLOOD_FILTER_NORMAL=1;dt.FLOOD_FILTER_LOOSE=2;class ar{constructor(e){this._allowMute=e.readInt(),this._allowKick=e.readInt(),this._allowBan=e.readInt()}get allowMute(){return this._allowMute}get allowKick(){return this._allowKick}get allowBan(){return this._allowBan}}ar.MODERATION_LEVEL_NONE=0;ar.MODERATION_LEVEL_USER_WITH_RIGHTS=1;ar.MODERATION_LEVEL_ALL=2;const ia=class vn{constructor(){this._roomId=-1,this._name=null,this._description=null,this._doorMode=vn.DOORMODE_OPEN,this._categoryId=-1,this._maximumVisitors=0,this._maximumVisitorsLimit=0,this._tags=[],this._tradeMode=vn.TRADEMODE_NOT_ALLOWED,this._allowPets=!1,this._allowFoodConsume=!1,this._allowWalkThrough=!1,this._hideWalls=!1,this._wallThickness=0,this._floorThickness=0,this._controllersById=new Map,this._controllerList=null,this._highlightedUserId=-1,this._bannedUsersById=new Map,this._bannedUsersList=null,this._roomModerationSettings=null,this._chatSettings=null,this._allowNavigatorDynamicCats=!1}static from(e){const t=new vn;return t._roomId=e._roomId,t._name=e._name,t._description=e._description,t._doorMode=e._doorMode,t._categoryId=e._categoryId,t._maximumVisitors=e._maximumVisitors,t._maximumVisitorsLimit=e._maximumVisitorsLimit,t._tags=e._tags,t._tradeMode=e._tradeMode,t._allowPets=e._allowPets,t._allowFoodConsume=e._allowFoodConsume,t._allowWalkThrough=e._allowWalkThrough,t._hideWalls=e._hideWalls,t._wallThickness=e._wallThickness,t._floorThickness=e._floorThickness,t._controllersById=e._controllersById,t._controllerList=e._controllerList,t._highlightedUserId=e._highlightedUserId,t._bannedUsersById=e._bannedUsersById,t._bannedUsersList=e._bannedUsersList,t._roomModerationSettings=e._roomModerationSettings,t._chatSettings=e._chatSettings,t._allowNavigatorDynamicCats=e._allowNavigatorDynamicCats,t}static getDoorModeLocalizationKey(e){switch(e){case vn.DOORMODE_OPEN:return"${navigator.door.mode.open}";case vn.DOORMODE_CLOSED:return"${navigator.door.mode.closed}";case vn.DOORMODE_PASSWORD:return"${navigator.door.mode.password}";case vn.DOORMODE_INVISIBLE:return"${navigator.door.mode.invisible}";case vn.DOORMODE_NOOBS_ONLY:return"${navigator.door.mode.noobs_only}"}return""}get tradeMode(){return this._tradeMode}set tradeMode(e){this._tradeMode=e}get allowPets(){return this._allowPets}set allowPets(e){this._allowPets=e}get allowFoodConsume(){return this._allowFoodConsume}set allowFoodConsume(e){this._allowFoodConsume=e}get allowWalkThrough(){return this._allowWalkThrough}set allowWalkThrough(e){this._allowWalkThrough=e}get hideWalls(){return this._hideWalls}set hideWalls(e){this._hideWalls=e}get wallThickness(){return this._wallThickness}set wallThickness(e){this._wallThickness=e}get floorThickness(){return this._floorThickness}set floorThickness(e){this._floorThickness=e}get roomId(){return this._roomId}set roomId(e){this._roomId=e}get name(){return this._name}set name(e){this._name=e}get description(){return this._description}set description(e){this._description=e}get doorMode(){return this._doorMode}set doorMode(e){this._doorMode=e}get categoryId(){return this._categoryId}set categoryId(e){this._categoryId=e}get maximumVisitors(){return this._maximumVisitors}set maximumVisitors(e){this._maximumVisitors=e}get maximumVisitorsLimit(){return this._maximumVisitorsLimit}set maximumVisitorsLimit(e){this._maximumVisitorsLimit=e}get tags(){return this._tags}set tags(e){this._tags=e}setFlatController(e,t){this._controllersById.set(e,t),this._controllerList=null,this._highlightedUserId=e}get roomModerationSettings(){return this._roomModerationSettings}set roomModerationSettings(e){this._roomModerationSettings=e}get controllersById(){return this._controllersById}set controllersById(e){this._controllersById=e}get controllerList(){if(!this._controllerList){this._controllerList=[];for(const e of this._controllersById.values())this._controllerList.push(e);this._controllerList.sort((e,t)=>e.userName.localeCompare(t.userName))}return this._controllerList}get highlightedUserId(){return this._highlightedUserId}setBannedUser(e,t){this._bannedUsersById.set(e,t),this._bannedUsersList=null}get bannedUsersById(){return this._bannedUsersById}get bannedUsersList(){if(!this._bannedUsersList){this._bannedUsersList=[];for(const e of this._bannedUsersById.values())this._bannedUsersList.push(e);this._bannedUsersList.sort((e,t)=>e.userName.localeCompare(t.userName))}return this._bannedUsersList}get chatSettings(){return this._chatSettings}set chatSettings(e){this._chatSettings=e}get allowNavigatorDynamicCats(){return this._allowNavigatorDynamicCats}set allowNavigatorDynamicCats(e){this._allowNavigatorDynamicCats=e}};ia.DOORMODE_OPEN=0;ia.DOORMODE_CLOSED=1;ia.DOORMODE_PASSWORD=2;ia.DOORMODE_INVISIBLE=3;ia.DOORMODE_NOOBS_ONLY=4;ia.TRADEMODE_NOT_ALLOWED=0;ia.TRADEMODE_WITH_CONTROLLER=1;ia.TRADEMODE_ALLOWED=2;let Ex=ia;class px{flush(){return this._roomSettingsData=null,!0}parse(e){if(!e)return!1;this._roomSettingsData=new Ex,this._roomSettingsData.roomId=e.readInt(),this._roomSettingsData.name=e.readString(),this._roomSettingsData.description=e.readString(),this._roomSettingsData.doorMode=e.readInt(),this._roomSettingsData.categoryId=e.readInt(),this._roomSettingsData.maximumVisitors=e.readInt(),this._roomSettingsData.maximumVisitorsLimit=e.readInt(),this._roomSettingsData.tags=[];let t=e.readInt();for(;t>0;)this._roomSettingsData.tags.push(e.readString()),t--;return this._roomSettingsData.tradeMode=e.readInt(),this._roomSettingsData.allowPets=e.readInt()===1,this._roomSettingsData.allowFoodConsume=e.readInt()===1,this._roomSettingsData.allowWalkThrough=e.readInt()===1,this._roomSettingsData.hideWalls=e.readInt()===1,this._roomSettingsData.wallThickness=e.readInt(),this._roomSettingsData.floorThickness=e.readInt(),this._roomSettingsData.chatSettings=new dt(e),this._roomSettingsData.allowNavigatorDynamicCats=e.readBoolean(),this._roomSettingsData.roomModerationSettings=new ar(e),!0}get data(){return this._roomSettingsData}}class Ix{flush(){return this._roomId=0,this._code=0,!0}parse(e){return e?(this._roomId=e.readInt(),this._code=e.readInt(),!0):!1}get roomId(){return this._roomId}get code(){return this._code}}class Tx{flush(){return this._roomId=0,!0}parse(e){return e?(this._roomId=e.readInt(),!0):!1}get roomId(){return this._roomId}}class gr{flush(){return this._roomId=0,this._code=0,this._message=null,!0}parse(e){return e?(this._roomId=e.readInt(),this._code=e.readInt(),this._message=e.readString(),!0):!1}get roomId(){return this._roomId}get code(){return this._code}get message(){return this._message}}gr.ERROR_ROOM_NOT_FOUND=1;gr.ERROR_NOT_OWNER=2;gr.ERROR_INVALID_DOOR_MODE=3;gr.ERROR_INVALID_USER_LIMIT=4;gr.ERROR_INVALID_PASSWORD=5;gr.ERROR_INVALID_CATEGORY=6;gr.ERROR_INVALID_NAME=7;gr.ERROR_UNACCEPTABLE_NAME=8;gr.ERROR_INVALID_DESCRIPTION=9;gr.ERROR_UNACCEPTABLE_DESCRIPTION=10;gr.ERROR_INVALID_TAG=11;gr.ERROR_NON_USER_CHOOSABLE_TAG=12;gr.ERROR_TOO_MANY_CHARACTERS_IN_TAG=13;class Rx{flush(){return this._selectionType=0,!0}parse(e){return e?(this._selectionType=e.readInt(),!0):!1}get selectionType(){return this._selectionType}}class Ox{flush(){return this._roomId=0,this._userId=0,!0}parse(e){return e?(this._roomId=e.readInt(),this._userId=e.readInt(),!0):!1}get roomId(){return this._roomId}get userId(){return this._userId}}class Sx{flush(){return this._chat=null,!0}parse(e){return e?(this._chat=new dt(e),!0):!1}get chat(){return this._chat}}const Ni=class no{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._roomId=0,this._roomName=null,this._ownerId=0,this._ownerName=null,this._doorMode=0,this._userCount=0,this._maxUserCount=0,this._description=null,this._tradeMode=2,this._score=0,this._ranking=0,this._categoryId=0,this._totalStars=0,this._groupId=0,this._groupName=null,this._groupBadge=null,this._tags=[],this._bitMask=0,this._thumbnail=null,this._allowPets=!1,this._showOwner=!0,this._displayAd=!1,this._adName=null,this._adDescription=null,this._adExpiresIn=0,this._allInRoomMuted=!1,this._canMute=!1,this._officialRoomPicRef=null,!0}parse(e){return e?(this._roomId=e.readInt(),this._roomName=e.readString(),this._ownerId=e.readInt(),this._ownerName=e.readString(),this._doorMode=e.readInt(),this._userCount=e.readInt(),this._maxUserCount=e.readInt(),this._description=e.readString(),this._tradeMode=e.readInt(),this._score=e.readInt(),this._ranking=e.readInt(),this._categoryId=e.readInt(),this.parseTags(e),this.parseBitMask(e),!0):!1}parseTags(e){if(!e)return!1;this._tags=[];let t=e.readInt();for(;t>0;)this._tags.push(e.readString()),t--;return!0}parseBitMask(e){return e?(this._bitMask=e.readInt(),this._bitMask&no.THUMBNAIL_BITMASK&&(this._officialRoomPicRef=e.readString()),this._bitMask&no.GROUPDATA_BITMASK&&(this._groupId=e.readInt(),this._groupName=e.readString(),this._groupBadge=e.readString()),this._bitMask&no.ROOMAD_BITMASK&&(this._adName=e.readString(),this._adDescription=e.readString(),this._adExpiresIn=e.readInt()),this._showOwner=(this._bitMask&no.SHOWOWNER_BITMASK)>0,this._allowPets=(this._bitMask&no.ALLOW_PETS_BITMASK)>0,this._displayAd=(this._bitMask&no.DISPLAY_ROOMAD_BITMASK)>0,this._thumbnail=null,!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}set roomName(e){this._roomName=e}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get doorMode(){return this._doorMode}get userCount(){return this._userCount}get maxUserCount(){return this._maxUserCount}get description(){return this._description}get tradeMode(){return this._tradeMode}get score(){return this._score}get ranking(){return this._ranking}get categoryId(){return this._categoryId}get tags(){return this._tags}get officialRoomPicRef(){return this._officialRoomPicRef}get habboGroupId(){return this._groupId}get groupName(){return this._groupName}get groupBadgeCode(){return this._groupBadge}get roomAdName(){return this._adName}get roomAdDescription(){return this._adDescription}get roomAdExpiresInMin(){return this._adExpiresIn}get showOwner(){return this._showOwner}get allowPets(){return this._allowPets}get displayRoomEntryAd(){return this._displayAd}get canMute(){return this._canMute}set canMute(e){this._canMute=e}get allInRoomMuted(){return this._allInRoomMuted}set allInRoomMuted(e){this._allInRoomMuted=e}};Ni.THUMBNAIL_BITMASK=1;Ni.GROUPDATA_BITMASK=2;Ni.ROOMAD_BITMASK=4;Ni.SHOWOWNER_BITMASK=8;Ni.ALLOW_PETS_BITMASK=16;Ni.DISPLAY_ROOMAD_BITMASK=32;Ni.OPEN_STATE=0;Ni.DOORBELL_STATE=1;Ni.PASSWORD_STATE=2;Ni.INVISIBLE_STATE=3;Ni.NOOB_STATE=4;let Ft=Ni;class Cx{flush(){return this._roomId=0,this._isOwner=!1,!0}parse(e){return e?(this._roomId=e.readInt(),this._isOwner=e.readBoolean(),!0):!1}get roomId(){return this._roomId}get isOwner(){return this._isOwner}}class Ax{flush(){return this._totalLikes=0,this._canLike=!1,!0}parse(e){return e?(this._totalLikes=e.readInt(),this._canLike=e.readBoolean(),!0):!1}get totalLikes(){return this._totalLikes}get canLike(){return this._canLike}}class Nx{flush(){return this._roomIndex=-1,this._groupId=-1,this._status=0,this._groupName=null,!0}parse(e){return e?(this._roomIndex=e.readInt(),this._groupId=e.readInt(),this._status=e.readInt(),this._groupName=e.readString(),!0):!1}get roomIndex(){return this._roomIndex}get groupId(){return this._groupId}get status(){return this._status}get groupName(){return this._groupName}}class yx{constructor(e,t,s){this._id=0,this._state=0,this._id=e,this._state=t,this._data=s}get id(){return this._id}get state(){return this._state}get data(){return this._data}}class Mx{flush(){return this._code=0,!0}parse(e){return e?(this._code=e.readInt(),!0):!1}get count(){return this._code}}class Dx{flush(){return this._itemId=0,this._value=0,!0}parse(e){return e?(this._itemId=e.readInt(),this._value=e.readInt(),!0):!1}get itemId(){return this._itemId}get value(){return this._value}}class ka{flush(){return this._itemId=0,this._data=null,!0}parse(e){return e?(this._itemId=parseInt(e.readString()),this._data=ka.parseObjectData(e),!0):!1}static parseObjectData(e){if(!e)return null;const t=un.getData(e.readInt());return t?(t.parseWrapper(e),t):null}get furnitureId(){return this._itemId}get objectData(){return this._data}}class Em{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._itemId=0,this._spriteId=0,this._spriteName=null,this._x=0,this._y=0,this._direction=0,this._z=0,this._stackHeight=0,this._extra=0,this._data=null,this._state=0,this._expires=0,this._usagePolicy=0,this._userId=0,this._username=null,!0}parse(e){return e?(this._itemId=e.readInt(),this._spriteId=e.readInt(),this._x=e.readInt(),this._y=e.readInt(),this._direction=e.readInt()%8*45,this._z=parseFloat(e.readString()),this._stackHeight=parseFloat(e.readString()),this._extra=e.readInt(),this._data=ka.parseObjectData(e),this._state=parseFloat(this._data&&this._data.getLegacyString())||0,this._expires=e.readInt(),this._usagePolicy=e.readInt(),this._userId=e.readInt(),this._username=null,this._spriteId<0&&(this._spriteName=e.readString()),!0):!1}get itemId(){return this._itemId}get spriteId(){return this._spriteId}get x(){return this._x}get y(){return this._y}get direction(){return this._direction}get z(){return isNaN(this._z)?0:this._z}get stackHeight(){return isNaN(this._stackHeight)?0:this._stackHeight}get extra(){return this._extra}get data(){return this._data}get state(){return this._state}get expires(){return this._expires}get usagePolicy(){return this._usagePolicy}get userId(){return this._userId}get username(){return this._username}set username(e){this._username=e}get spriteName(){return this._spriteName}set spriteName(e){this._spriteName=e}}class vx{flush(){return this._item=null,!0}parse(e){return e?(this._item=new Em(e),this._item.username=e.readString(),!0):!1}get item(){return this._item}}class bx{flush(){return this._owners=new Map,this._items=[],!0}parse(e){if(!e||!this.parseOwners(e))return!1;let t=e.readInt();for(;t>0;){const s=new Em(e);if(!s)continue;const r=this._owners.get(s.userId);r&&(s.username=r),this._items.push(s),t--}return!0}parseOwners(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._owners.set(e.readInt(),e.readString()),t--;return!0}get owners(){return this._owners}get items(){return this._items}}class Px{flush(){return this._itemId=0,this._isExpired=!0,this._userId=0,this._delay=0,!0}parse(e){return e?(this._itemId=parseInt(e.readString()),this._isExpired=e.readBoolean(),this._userId=e.readInt(),this._delay=e.readInt(),!0):!1}get itemId(){return this._itemId}get isExpired(){return this._isExpired}get userId(){return this._userId}get delay(){return this._delay}}class Lx{flush(){return this._item=null,!0}parse(e){return e?(this._item=new Em(e),!0):!1}get item(){return this._item}}class Ux{flush(){return this._isWallItem=!1,this._furniTypeName=null,this._buyout=!1,this._priceInCredits=-1,this._priceInActivityPoints=-1,this._activityPointType=-1,!0}parse(e){return e?(this._isWallItem=e.readBoolean(),this._furniTypeName=e.readString(),this._buyout=e.readBoolean(),this._priceInCredits=e.readInt(),this._priceInActivityPoints=e.readInt(),this._activityPointType=e.readInt(),!0):!1}get isWallItem(){return this._isWallItem}get furniTypeName(){return this._furniTypeName}get buyout(){return this._buyout}get priceInCredits(){return this._priceInCredits}get priceInActivityPoints(){return this._priceInActivityPoints}get activityPointType(){return this._activityPointType}}class Fx{flush(){return this._aliases=new Map,!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._aliases.set(e.readString(),e.readString()),t--;return!0}get aliases(){return this._aliases}}class xx{flush(){return this._furniId=-1,this._height=0,!0}parse(e){return e?(this._furniId=e.readInt(),this._height=e.readInt()/100,!0):!1}get furniId(){return this._furniId}get height(){return this._height}}class wx{flush(){return this._objectId=0,this._guildId=0,this._guildName=null,this._guildHomeRoomId=0,this._userIsMember=!1,this._guildHasReadableForum=!1,!0}parse(e){return e?(this._objectId=e.readInt(),this._guildId=e.readInt(),this._guildName=e.readString(),this._guildHomeRoomId=e.readInt(),this._userIsMember=e.readBoolean(),this._guildHasReadableForum=e.readBoolean(),!0):!1}get objectId(){return this._objectId}get guildId(){return this._guildId}get guildName(){return this._guildName}get guildHomeRoomId(){return this._guildHomeRoomId}get userIsMember(){return this._userIsMember}get guildHasReadableForum(){return this._guildHasReadableForum}}class Gx{flush(){return this._itemId=0,this._data="",!0}parse(e){return e?(this._itemId=parseInt(e.readString()),this._data=e.readString(),!0):!1}get furnitureId(){return this._itemId}get data(){return this._data}}class Bx{get furniId(){return this._furniId}flush(){return this._furniId=-1,!0}parse(e){return this._furniId=e.readInt(),!0}}class kx{get furniId(){return this._furniId}flush(){return this._furniId=-1,!0}parse(e){return this._furniId=e.readInt(),!0}}class Vx{get furniId(){return this._furniId}get start(){return this._start}flush(){return this._furniId=-1,this._start=!1,!0}parse(e){return this._furniId=e.readInt(),this._start=e.readBoolean(),!0}}class Hx{flush(){return this._itemId=0,this._state=0,!0}parse(e){return e?(this._itemId=e.readInt(),this._state=e.readInt(),!0):!1}get itemId(){return this._itemId}get state(){return this._state}}class jx{flush(){return!0}parse(e){return e?(this._reason=e.readInt(),!0):!1}get reason(){return this._reason}}class Wx{flush(){return!0}parse(e){return e?(this._expiryTime=e.readInt(),!0):!1}get expiryTime(){return this._expiryTime}}class zi{flush(){return this._rented=!1,this._renterId=-1,this._renterName=null,this._canRent=!1,this._canRentErrorCode=-1,this._timeRemaining=-1,this._price=-1,!0}parse(e){return e?(this._rented=e.readBoolean(),this._canRentErrorCode=e.readInt(),this._canRent=this._canRentErrorCode===0,this._renterId=e.readInt(),this._renterName=e.readString(),this._timeRemaining=e.readInt(),this._price=e.readInt(),this._rented||(this._renterId=-1,this._renterName=""),!0):!1}get rented(){return this._rented}get renterId(){return this._renterId}get renterName(){return this._renterName}get canRent(){return this._canRent}get price(){return this._price}get timeRemaining(){return this._timeRemaining}get canRentErrorCode(){return this._canRentErrorCode}}zi.SPACE_ALREADY_RENTED=100;zi.SPACE_EXTEND_NOT_RENTED=101;zi.SPACE_EXTEND_NOT_RENTED_BY_YOU=102;zi.CAN_RENT_ONLY_ONE_SPACE=103;zi.NOT_ENOUGH_CREDITS=200;zi.NOT_ENOUGH_PIXELS=201;zi.CANT_RENT_NO_PERMISSION=202;zi.CANT_RENT_NO_HABBO_CLUB=203;zi.CANT_RENT=300;zi.CANT_RENT_GENERIC=400;class Yx{flush(){return this._itemId=-1,this._location="",!0}parse(e){return e?(this._itemId=e.readInt(),this._location=e.readString(),!0):!1}get itemId(){return this._itemId}get location(){return this._location}}class zx{constructor(e,t,s,r){this.id=e,this.type=t,this.color=s,this.brightness=r}}class Kx{constructor(){this._selectedPresetId=0,this._presets=[]}flush(){return this._presets=[],!0}parse(e){const t=e.readInt();this._selectedPresetId=e.readInt();for(let s=0;s<t;s++){const r=e.readInt(),i=e.readInt(),a=parseInt(e.readString().substr(1),16),l=e.readInt();this._presets.push(new zx(r,i,a,l))}return!0}getPreset(e){return e<0||e>=this.presetCount?null:this._presets[e]}get presetCount(){return this._presets.length}get selectedPresetId(){return this._selectedPresetId}}class Xx{flush(){return this._roomId=-1,this._roomName=null,this._messageCount=-1,!0}parse(e){return e?(this._roomId=e.readInt(),this._roomName=e.readString(),this._messageCount=e.readInt(),!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}get messageCount(){return this._messageCount}}class pm{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._itemId=0,this._spriteId=0,this._location=null,this._stuffData=null,this._state=0,this._secondsToExpiration=0,this._usagePolicy=-1,this._userId=0,this._username=null,this._width=0,this._height=0,this._localX=0,this._localY=0,this._y=0,this._z=0,this._direction=null,this._isOldFormat=!1,!0}parse(e){if(!e)return!1;this._itemId=parseInt(e.readString()),this._spriteId=e.readInt(),this._location=e.readString(),this._stuffData=e.readString(),this._secondsToExpiration=e.readInt(),this._usagePolicy=e.readInt(),this._userId=e.readInt(),this._username=null;const t=parseFloat(this._stuffData);if(isNaN(t)||(this._state=Math.trunc(t)),this._location.indexOf(":")===0){this._isOldFormat=!1;let s=this._location.split(" ");if(s.length>=3){let r=s[0],i=s[1];const a=s[2];if(r.length>3&&i.length>2&&(r=r.substr(3),i=i.substr(2),s=r.split(","),s.length>=2)){const l=parseInt(s[0]),c=parseInt(s[1]);if(s=i.split(","),s.length>=2){const u=parseInt(s[0]),h=parseInt(s[1]);this._width=l,this._height=c,this._localX=u,this._localY=h,this._direction=a}}}}else this._isOldFormat=!0;return!0}get itemId(){return this._itemId}get spriteId(){return this._spriteId}get wallPosition(){return this._location}get stuffData(){return this._stuffData}get state(){return this._state}get secondsToExpiration(){return this._secondsToExpiration}get usagePolicy(){return this._usagePolicy}get userId(){return this._userId}get username(){return this._username}set username(e){this._username=e}get width(){return this._width}get height(){return this._height}get localX(){return this._localX}get localY(){return this._localY}get direction(){return this._direction}get isOldFormat(){return this._isOldFormat}}class qx{flush(){return this._item=null,!0}parse(e){return e?(this._item=new pm(e),this._item.username=e.readString(),!0):!1}get item(){return this._item}}class Qx{flush(){return this._owners=new Map,this._items=[],!0}parse(e){if(!e||!this.parseOwners(e))return!1;let t=e.readInt();for(;t>0;){const s=new pm(e);if(!s)continue;const r=this._owners.get(s.userId);r&&(s.username=r),this._items.push(s),t--}return!0}parseOwners(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._owners.set(e.readInt(),e.readString()),t--;return!0}get owners(){return this._owners}get items(){return this._items}}class Jx{flush(){return this._itemId=0,this._userId=0,!0}parse(e){return e?(this._itemId=parseInt(e.readString()),this._userId=e.readInt(),!0):!1}get itemId(){return this._itemId}get userId(){return this._userId}}class Zx{flush(){return this._item=null,!0}parse(e){return e?(this._item=new pm(e),!0):!1}get item(){return this._item}}class $x{flush(){return this._email=null,this._isVerified=!1,this._allowChange=!1,this._furniId=-1,this._requestedByUser=!1,!0}parse(e){return e?(this._email=e.readString(),this._isVerified=e.readBoolean(),this._allowChange=e.readBoolean(),this._furniId=e.readInt(),this._requestedByUser=e.readBoolean(),!0):!1}get email(){return this._email}get isVerified(){return this._isVerified}get allowChange(){return this._allowChange}get furniId(){return this._furniId}get requestedByUser(){return this._requestedByUser}}class ew{parse(e){return this._furniId=e.readInt(),this._commandId=e.readInt(),!0}flush(){return this._furniId=-1,this._commandId=-1,!0}get furniId(){return this._furniId}get commandId(){return this._commandId}}class tw{constructor(e,t,s){this._video=e,this._title=t,this._description=s}get video(){return this._video}get title(){return this._title}get description(){return this._description}}class sw{flush(){return this._furniId=-1,this._playlists=null,this._selectedPlaylistId=null,!0}parse(e){this._furniId=e.readInt();const t=e.readInt();this._playlists=[];for(let s=0;s<t;s++)this._playlists.push(new tw(e.readString(),e.readString(),e.readString()));return this._selectedPlaylistId=e.readString(),!0}get furniId(){return this._furniId}get playlists(){return this._playlists}get selectedPlaylistId(){return this._selectedPlaylistId}}class rw{flush(){return!0}parse(e){return this._furniId=e.readInt(),this._videoId=e.readString(),this._startAtSeconds=e.readInt(),this._endAtSeconds=e.readInt(),this._state=e.readInt(),!0}get furniId(){return this._furniId}get videoId(){return this._videoId}get state(){return this._state}get startAtSeconds(){return this._startAtSeconds}get endAtSeconds(){return this._endAtSeconds}}class iw{flush(){return this._objects=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=e.readInt(),r=ka.parseObjectData(e),i=parseFloat(r.getLegacyString());this._objects.push(new yx(s,i,r)),t--}return!0}get objects(){return this._objects}}class nw{flush(){return this._rollerId=0,this._itemsRolling=[],this._unitRolling=null,!0}parse(e){if(!e)return!1;const t=e.readInt(),s=e.readInt(),r=e.readInt(),i=e.readInt();let a=e.readInt();for(;a>0;){const d=e.readInt(),f=parseFloat(e.readString()),E=parseFloat(e.readString()),m=new kn(d,new F(t,s,f),new F(r,i,E));this._itemsRolling.push(m),a--}if(this._rollerId=e.readInt(),!e.bytesAvailable)return!0;const l=e.readInt(),c=e.readInt(),u=parseFloat(e.readString()),h=parseFloat(e.readString());switch(l){case 0:break;case 1:this._unitRolling=new kn(c,new F(t,s,u),new F(r,i,h),kn.MOVE);break;case 2:this._unitRolling=new kn(c,new F(t,s,u),new F(r,i,h),kn.SLIDE);break}return!0}get rollerId(){return this._rollerId}get itemsRolling(){return this._itemsRolling}get unitRolling(){return this._unitRolling}}const vO=class Dg{flush(){return this._model=null,this._width=0,this._height=0,this._wallHeight=-1,this._heightMap=[],this._scale=64,this._model=null,!0}parse(e){if(!e)return!1;const t=e.readBoolean(),s=e.readInt(),r=e.readString();return this.parseExplicitly(r,s,t)}parseModel(e,t,s=!0){return this.parseExplicitly(e,t,s)}parseExplicitly(e,t,s=!0){this._scale=s?32:64,this._wallHeight=t,this._model=e;const r=this._model.split("\r"),i=r.length;let a=0,l=0;for(;l<i;){const c=r[l];c.length>a&&(a=c.length),l++}for(this._heightMap=[],l=0;l<i;){const c=[];let u=0;for(;u<a;)c.push(Dg.TILE_BLOCKED),u++;this._heightMap.push(c),l++}for(this._width=a,this._height=i,l=0;l<i;){const c=this._heightMap[l],u=r[l];if(u.length>0){let h=0;for(;h<u.length;){const d=u.charAt(h);let f=Dg.TILE_BLOCKED;d!=="x"&&d!=="X"&&(f=parseInt(d,36)),c[h]=f,h++}}l++}return!0}getHeight(e,t){if(e<0||e>=this._width||t<0||t>=this._height)return-110;const s=this._heightMap[t];if(s===void 0)return-110;const r=s[e];return r===void 0?-110:r}get model(){return this._model}get width(){return this._width}get height(){return this._height}get heightMap(){return this._heightMap}get wallHeight(){return this._wallHeight}get scale(){return this._scale}};vO.TILE_BLOCKED=-110;let bO=vO;class aw{flush(){return this._x=0,this._y=0,this._direction=0,!0}parse(e){return e?(this._x=e.readInt(),this._y=e.readInt(),this._direction=e.readInt(),!0):!1}get x(){return this._x}get y(){return this._y}get direction(){return this._direction}}class ba{static decodeTileHeight(e){return e<0?-1:(e&16383)/256}static decodeIsStackingBlocked(e){return!!(e&16384)}static decodeIsRoomTile(e){return e>=0}getTileHeight(e,t){return e<0||e>=this._width||t<0||t>=this._height?-1:ba.decodeTileHeight(this._heights[t*this._width+e])}getStackingBlocked(e,t){return e<0||e>=this._width||t<0||t>=this._height?!0:ba.decodeIsStackingBlocked(this._heights[t*this._width+e])}isRoomTile(e,t){return e<0||e>=this._width||t<0||t>=this._height?!1:ba.decodeIsRoomTile(this._heights[t*this._width+e])}flush(){return this._width=0,this._height=0,this._heights=[],!0}parse(e){if(!e)return!1;this._width=e.readInt();const t=e.readInt();this._height=t/this._width;let s=0;for(;s<t;)this._heights[s]=e.readShort(),s++;return!0}get width(){return this._width}get height(){return this._height}get heights(){return this._heights}}class ow{flush(){return this._wrapper=null,this._count=0,this._x=0,this._y=0,this._value=0,!0}tileHeight(){return ba.decodeTileHeight(this._value)}isStackingBlocked(){return ba.decodeIsStackingBlocked(this._value)}isRoomTile(){return ba.decodeIsRoomTile(this._value)}next(){return this._count?(this._count--,this._x=this._wrapper.readByte(),this._y=this._wrapper.readByte(),this._value=this._wrapper.readShort(),!0):!1}parse(e){return e?(this._wrapper=e,this._count=e.readByte(),!0):!1}get x(){return this._x}get y(){return this._y}get height(){return this._value}}class lw{flush(){return this._blockedTilesMap=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=e.readInt(),r=e.readInt();this._blockedTilesMap[r]||(this._blockedTilesMap[r]=[]),this._blockedTilesMap[r][s]=!0,t--}return!0}get blockedTilesMap(){return this._blockedTilesMap}}class cw{flush(){return this._floorType=null,this._wallType=null,this._landscapeType=null,this._landscapeAnimation=null,!0}parse(e){if(!e)return!1;const t=e.readString(),s=e.readString();switch(t){case"floor":this._floorType=s;break;case"wallpaper":this._wallType=s;break;case"landscape":this._landscapeType=s;break;case"landscapeanim":this._landscapeAnimation=s;break}return!0}get floorType(){return this._floorType}get wallType(){return this._wallType}get landscapeType(){return this._landscapeType}get landscapeAnimation(){return this._landscapeAnimation}}class uw{flush(){return this._name=null,this._roomId=0,!0}parse(e){return e?(this._name=e.readString(),this._roomId=e.readInt(),!0):!1}get name(){return this._name}get roomId(){return this._roomId}}class hw{flush(){return this._hideWalls=!1,this._thicknessWall=0,this._thicknessFloor=0,!0}parse(e){if(!e)return!1;this._hideWalls=e.readBoolean();let t=e.readInt(),s=e.readInt();return t=t<-2?-2:t>1?1:t,s=s<-2?-2:s>1?1:s,this._thicknessWall=Math.pow(2,t),this._thicknessFloor=Math.pow(2,s),!0}get hideWalls(){return this._hideWalls}get thicknessWall(){return this._thicknessWall}get thicknessFloor(){return this._thicknessFloor}}class bp{constructor(e){if(!e)throw new Error("invalid_wrapper");this._webId=e.readInt(),this._name=e.readString(),this._level=e.readInt(),this._figure=e.readString(),this._owner=e.readString()}dispose(){this._webId=0,this._name="",this._level=0,this._figure="",this._owner=""}get webId(){return this._webId}get name(){return this._name}get level(){return this._level}get figure(){return this._figure}get owner(){return this._owner}}class Pp{constructor(e){this._stuffId=e.readInt(),this._classId=e.readInt(),this._productCode=e.readString(),this._userId=e.readInt(),this._userName=e.readString(),this._rarityLevel=e.readInt(),this._hasMutation=e.readBoolean()}get stuffId(){return this._stuffId}get classId(){return this._classId}get productCode(){return this._productCode}get userId(){return this._userId}get userName(){return this._userName}get rarityLevel(){return this._rarityLevel}get hasMutation(){return this._hasMutation}}class dw{flush(){return this._resultData=null,this._otherResultData=null,!0}parse(e){return e?(this._resultData=new Pp(e),this._otherResultData=new Pp(e),!0):!1}get resultData(){return this._resultData}get otherResultData(){return this._otherResultData}}class _w{flush(){return this._petId=-1,this._roomIndex=-1,this._gainedExperience=0,!0}parse(e){return e?(this._petId=e.readInt(),this._roomIndex=e.readInt(),this._gainedExperience=e.readInt(),!0):!1}get petId(){return this._petId}get roomIndex(){return this._roomIndex}get gainedExperience(){return this._gainedExperience}}class gw{flush(){return!0}parse(e){return e?(this._roomIndex=e.readInt(),this._petId=e.readInt(),this._figureData=new Rm(e),this._hasSaddle=e.readBoolean(),this._isRiding=e.readBoolean(),!0):!1}get roomIndex(){return this._roomIndex}get petId(){return this._petId}get figureData(){return this._figureData}get hasSaddle(){return this._hasSaddle}get isRiding(){return this._isRiding}}class fw{flush(){return this._id=-1,this._skillThresholds=[],!0}parse(e){if(!e)return!1;this._id=e.readInt(),this._name=e.readString(),this._level=e.readInt(),this._maximumLevel=e.readInt(),this._experience=e.readInt(),this._levelExperienceGoal=e.readInt(),this._energy=e.readInt(),this._maximumEnergy=e.readInt(),this._happyness=e.readInt(),this._maximumHappyness=e.readInt(),this._respect=e.readInt(),this._ownerId=e.readInt(),this._age=e.readInt(),this._ownerName=e.readString(),this._rarityLevel=e.readInt(),this._saddle=e.readBoolean(),this._rider=e.readBoolean();let t=e.readInt();for(;t>0;)this._skillThresholds.push(e.readInt()),t--;return this._skillThresholds.sort(),this._publiclyRideable=e.readInt(),this._breedable=e.readBoolean(),this._fullyGrown=e.readBoolean(),this._dead=e.readBoolean(),this._unknownRarity=e.readInt(),this._maximumTimeToLive=e.readInt(),this._remainingTimeToLive=e.readInt(),this._remainingGrowTime=e.readInt(),this._publiclyBreedable=e.readBoolean(),!0}get id(){return this._id}get name(){return this._name}get level(){return this._level}get maximumLevel(){return this._maximumLevel}get experience(){return this._experience}get energy(){return this._energy}get happyness(){return this._happyness}get levelExperienceGoal(){return this._levelExperienceGoal}get maximumEnergy(){return this._maximumEnergy}get maximumHappyness(){return this._maximumHappyness}get respect(){return this._respect}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get age(){return this._age}get rarityLevel(){return this._rarityLevel}get saddle(){return this._saddle}get rider(){return this._rider}get breedable(){return this._breedable}get fullyGrown(){return this._fullyGrown}get dead(){return this._dead}get maximumTimeToLive(){return this._maximumTimeToLive}get remainingTimeToLive(){return this._remainingTimeToLive}get remainingGrowTime(){return this._remainingGrowTime}get skillTresholds(){return this._skillThresholds}get publiclyRideable(){return this._publiclyRideable}get unknownRarity(){return this._unknownRarity}get publiclyBreedable(){return this._publiclyBreedable}}class mw{flush(){return this._roomIndex=-1,this._petId=-1,this._canBreed=!1,this._canHarvest=!1,this._canRevive=!1,this._hasBreedingPermission=!1,!0}parse(e){return e?(this._roomIndex=e.readInt(),this._petId=e.readInt(),this._canBreed=e.readBoolean(),this._canHarvest=e.readBoolean(),this._canRevive=e.readBoolean(),this._hasBreedingPermission=e.readBoolean(),!0):!1}get roomIndex(){return this._roomIndex}get petId(){return this._petId}get canBreed(){return this._canBreed}get canHarvest(){return this._canHarvest}get canRevive(){return this._canRevive}get hasBreedingPermission(){return this._hasBreedingPermission}}class Ew{constructor(e){if(!e)throw new Error("invalid_wrapper");this._chance=e.readInt(),this._breeds=[];let t=e.readInt();for(;t>0;)this._breeds.push(e.readInt()),t--}dispose(){this._chance=-1,this._breeds=[]}get chance(){return this._chance}get breeds(){return this._breeds}}class pw{flush(){return this._isPlaying=!1,!0}parse(e){return e?(this._isPlaying=e.readBoolean(),!0):!1}get isPlaying(){return this._isPlaying}}class Iw{flush(){return!0}parse(e){return!0}}class Tw{flush(){return this._seconds=0,!0}parse(e){return e?(this._seconds=e.readInt(),!0):!1}get seconds(){return this._seconds}}class Rw{flush(){return this._seconds=0,!0}parse(e){return e?(this._seconds=e.readInt(),!0):!1}get seconds(){return this._seconds}}class Im{flush(){return this._roomIndex=null,this._message=null,this._gesture=0,this._bubble=0,this._urls=[],this._messageLength=0,!0}parse(e){return e?(this._roomIndex=e.readInt(),this._message=e.readString(),this._gesture=e.readInt(),this._bubble=e.readInt(),this.parseUrls(e),this._messageLength=e.readInt(),!0):!1}parseUrls(e){if(!e)return!1;this._urls=[];let t=e.readInt();for(;t>0;)this._urls.push(e.readString()),t--;return!0}get roomIndex(){return this._roomIndex}get message(){return this._message}get gesture(){return this._gesture}get bubble(){return this._bubble}get urls(){return this._urls}get messageLength(){return this._messageLength}}class Ow{flush(){return this._unitId=null,this._isTyping=!1,!0}parse(e){return e?(this._unitId=e.readInt(),this._isTyping=e.readInt()===1,!0):!1}get unitId(){return this._unitId}get isTyping(){return this._isTyping}}class Sw{flush(){return this._unitId=null,this._danceId=0,!0}parse(e){return e?(this._unitId=e.readInt(),this._danceId=e.readInt(),!0):!1}get unitId(){return this._unitId}get danceId(){return this._danceId}}class Cw{flush(){return this._unitId=null,this._effectId=0,this._delay=0,!0}parse(e){return e?(this._unitId=e.readInt(),this._effectId=e.readInt(),this._delay=e.readInt(),!0):!1}get unitId(){return this._unitId}get effectId(){return this._effectId}get delay(){return this._delay}}class Aw{flush(){return this._unitId=null,this._expression=0,!0}parse(e){return e?(this._unitId=e.readInt(),this._expression=e.readInt(),!0):!1}get unitId(){return this._unitId}get expression(){return this._expression}}class Nw{flush(){return this._unitId=null,this._handId=0,!0}parse(e){return e?(this._unitId=e.readInt(),this._handId=e.readInt(),!0):!1}get unitId(){return this._unitId}get handId(){return this._handId}}class yw{flush(){return this._giverUserId=-1,this._handItemType=-1,!0}parse(e){return e?(this._giverUserId=e.readInt(),this._handItemType=e.readInt(),!0):!1}get giverUserId(){return this._giverUserId}get handItemType(){return this._handItemType}}class Mw{flush(){return this._unitId=null,this._isIdle=!1,!0}parse(e){return e?(this._unitId=e.readInt(),this._isIdle=e.readBoolean(),!0):!1}get unitId(){return this._unitId}get isIdle(){return this._isIdle}}class Dw{flush(){return this._unitId=null,this._figure=null,this._gender="M",this._motto=null,this._achievementScore=0,!0}parse(e){return e?(this._unitId=e.readInt(),this._figure=e.readString(),this._gender=e.readString().toLocaleUpperCase(),this._motto=e.readString(),this._achievementScore=e.readInt(),!0):!1}get unitId(){return this._unitId}get figure(){return this._figure}get gender(){return this._gender}get motto(){return this._motto}get achievementScore(){return this._achievementScore}}class vw{flush(){return this._unitId=null,this._value=0,!0}parse(e){return e?(this._unitId=e.readInt(),this._value=e.readInt(),!0):!1}get unitId(){return this._unitId}get value(){return this._value}}class ul{constructor(e){this._roomIndex=0,this._x=0,this._y=0,this._z=0,this._dir=0,this._name="",this._userType=0,this._sex="",this._figure="",this._custom="",this._activityPoints=0,this._webID=0,this._groupID=0,this._groupStatus=0,this._groupName="",this._subType="",this._ownerId=0,this._ownerName="",this._rarityLevel=0,this._hasSaddle=!1,this._isRiding=!1,this._canBreed=!1,this._canHarvest=!1,this._canRevive=!1,this._hasBreedingPermission=!1,this._petLevel=0,this._petPosture="",this._botSkills=[],this._isModerator=!1,this._isReadOnly=!1,this._roomIndex=e}setReadOnly(){this._isReadOnly=!0}get roomIndex(){return this._roomIndex}get x(){return this._x}set x(e){this._isReadOnly||(this._x=e)}get y(){return this._y}set y(e){this._isReadOnly||(this._y=e)}get z(){return this._z}set z(e){this._isReadOnly||(this._z=e)}get dir(){return this._dir}set dir(e){this._isReadOnly||(this._dir=e)}get name(){return this._name}set name(e){this._isReadOnly||(this._name=e)}get userType(){return this._userType}set userType(e){this._isReadOnly||(this._userType=e)}get sex(){return this._sex}set sex(e){this._isReadOnly||(this._sex=e)}get figure(){return this._figure}set figure(e){this._isReadOnly||(this._figure=e)}get custom(){return this._custom}set custom(e){this._isReadOnly||(this._custom=e)}get activityPoints(){return this._activityPoints}set activityPoints(e){this._isReadOnly||(this._activityPoints=e)}get webID(){return this._webID}set webID(e){this._isReadOnly||(this._webID=e)}get groupID(){return this._groupID}set groupID(e){this._isReadOnly||(this._groupID=e)}get groupName(){return this._groupName}set groupName(e){this._isReadOnly||(this._groupName=e)}get groupStatus(){return this._groupStatus}set groupStatus(e){this._isReadOnly||(this._groupStatus=e)}get subType(){return this._subType}set subType(e){this._isReadOnly||(this._subType=e)}get ownerId(){return this._ownerId}set ownerId(e){this._isReadOnly||(this._ownerId=e)}get ownerName(){return this._ownerName}set ownerName(e){this._isReadOnly||(this._ownerName=e)}get rarityLevel(){return this._rarityLevel}set rarityLevel(e){this._isReadOnly||(this._rarityLevel=e)}get hasSaddle(){return this._hasSaddle}set hasSaddle(e){this._isReadOnly||(this._hasSaddle=e)}get isRiding(){return this._isRiding}set isRiding(e){this._isReadOnly||(this._isRiding=e)}get canBreed(){return this._canBreed}set canBreed(e){this._isReadOnly||(this._canBreed=e)}get canHarvest(){return this._canHarvest}set canHarvest(e){this._isReadOnly||(this._canHarvest=e)}get canRevive(){return this._canRevive}set canRevive(e){this._isReadOnly||(this._canRevive=e)}get hasBreedingPermission(){return this._hasBreedingPermission}set hasBreedingPermission(e){this._isReadOnly||(this._hasBreedingPermission=e)}get petLevel(){return this._petLevel}set petLevel(e){this._isReadOnly||(this._petLevel=e)}get petPosture(){return this._petPosture}set petPosture(e){this._isReadOnly||(this._petPosture=e)}get botSkills(){return this._botSkills}set botSkills(e){this._botSkills=e}get isModerator(){return this._isModerator}set isModerator(e){this._isReadOnly||(this._isModerator=e)}}ul.M="M";ul.F="F";class bw{flush(){return this._users=[],!0}parse(e){if(!e)return!1;this._users=[];const t=e.readInt();let s=0;for(;s<t;){const r=e.readInt(),i=e.readString(),a=e.readString();let l=e.readString();const c=e.readInt(),u=e.readInt(),h=e.readInt(),d=parseFloat(e.readString()),f=e.readInt(),E=e.readInt(),m=new ul(c);if(m.dir=f,m.name=i,m.custom=a,m.x=u,m.y=h,m.z=d,this._users.push(m),E===1){m.webID=r,m.userType=Rt.USER,m.sex=this.resolveSex(e.readString()),m.groupID=e.readInt(),m.groupStatus=e.readInt(),m.groupName=e.readString();const R=e.readString();R!==""&&(l=this.convertSwimFigure(R,l,m.sex)),m.figure=l,m.activityPoints=e.readInt(),m.isModerator=e.readBoolean()}else if(E===2)m.userType=Rt.PET,m.figure=l,m.webID=r,m.subType=e.readInt().toString(),m.ownerId=e.readInt(),m.ownerName=e.readString(),m.rarityLevel=e.readInt(),m.hasSaddle=e.readBoolean(),m.isRiding=e.readBoolean(),m.canBreed=e.readBoolean(),m.canHarvest=e.readBoolean(),m.canRevive=e.readBoolean(),m.hasBreedingPermission=e.readBoolean(),m.petLevel=e.readInt(),m.petPosture=e.readString();else if(E===3)m.userType=Rt.BOT,m.webID=c*-1,l.indexOf("/")===-1?m.figure=l:m.figure="hr-100-.hd-180-1.ch-876-66.lg-270-94.sh-300-64",m.sex=ul.M;else if(E===4){m.userType=Rt.RENTABLE_BOT,m.webID=r,m.sex=this.resolveSex(e.readString()),m.figure=l,m.ownerId=e.readInt(),m.ownerName=e.readString();const R=e.readInt();if(R){const I=[];let S=0;for(;S<R;)I.push(e.readShort()),S++;m.botSkills=I}}s++}return!0}resolveSex(e){return e.substr(0,1).toLowerCase()==="f"?ul.F:ul.M}convertSwimFigure(e,t,s){const r=t.split(".");let i=1,a=1,l=1;const c=1e4;let u=0;for(;u<r.length;){const E=r[u].split("-");E.length>2&&E[0]==="hd"&&(i=parseInt(E[2])),u++}const h=["238,238,238","250,56,49","253,146,160","42,199,210","53,51,44","239,255,146","198,255,152","255,146,90","157,89,126","182,243,255","109,255,51","51,120,201","255,182,49","223,161,233","249,251,50","202,175,143","197,198,197","71,98,61","138,131,97","255,140,51","84,198,39","30,108,153","152,79,136","119,200,255","255,192,142","60,75,135","124,44,71","215,255,227","143,63,28","255,99,147","31,155,121","253,255,51"],d=e.split("=");if(d.length>1){const f=d[1].split("/");f[0];const E=f[1];s==="F"?l=10010:l=10011;const m=h.indexOf(E);a=c+m+1}return t+(".bds-10001-"+i+".ss-"+l+"-"+a)}get users(){return this._users}}class Pw{flush(){return this._unitId=null,!0}parse(e){return e?(this._unitId=parseInt(e.readString()),!0):!1}get unitId(){return this._unitId}}class Lw{constructor(e,t){this._action=e,this._value=t}get action(){return this._action}get value(){return this._value}}class Uw{constructor(e,t,s,r,i,a,l,c=0,u=0,h=0,d,f,E){this._id=e,this._x=t,this._y=s,this._z=r,this._height=i,this._headDirection=a,this._direction=l,this._targetX=c,this._targetY=u,this._targetZ=h,this._didMove=d,this._canStandUp=f,this._actions=E||[]}get id(){return this._id}get x(){return this._x}get y(){return this._y}get z(){return this._z}get height(){return this._height}get headDirection(){return this._headDirection}get direction(){return this._direction}get targetX(){return this._targetX}get targetY(){return this._targetY}get targetZ(){return this._targetZ}get didMove(){return this._didMove}get canStandUp(){return this._canStandUp}get actions(){return this._actions}}class Fw{flush(){return this._statuses=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=this.parseStatus(e);if(!s){t--;continue}this._statuses.push(s),t--}return!0}parseStatus(e){if(!e)return null;const t=e.readInt(),s=e.readInt(),r=e.readInt(),i=parseFloat(e.readString()),a=e.readInt()%8*45,l=e.readInt()%8*45,c=e.readString();let u=0,h=0,d=0,f=0,E=!1,m=!1;if(c){const R=c.split("/"),I=[];for(const S of R){const A=S.split(" ");if(A[0]!==""&&A.length>=2){switch(A[0]){case"mv":{const N=A[1].split(",");N.length>=3&&(u=parseInt(N[0]),h=parseInt(N[1]),d=parseFloat(N[2]),m=!0);break}case"sit":{const N=parseFloat(A[1]);A.length>=3&&(E=A[2]==="1"),f=N;break}case"lay":{const N=parseFloat(A[1]);f=Math.abs(N);break}}I.push(new Lw(A[0],A[1]))}}this._statuses.push(new Uw(t,s,r,i,f,a,l,u,h,d,m,E,I))}}get statuses(){return this._statuses}}const Tm=class vg{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._rentable=!1,this._itemId=0,this._furniType=null,this._ref=0,this._spriteId=0,this._category=0,this._stuffData=null,this._isGroupable=!1,this._isRecyclable=!1,this._tradable=!1,this._sellable=!1,this._secondsToExpiration=0,this._extra=0,this._flatId=0,this._isWallItem=!1,this._hasRentPeriodStarted=!1,this._expirationTimeStamp=0,this._slotId="",this._songId=-1,!0}parse(e){return e?(this._itemId=e.readInt(),this._furniType=e.readString(),this._ref=e.readInt(),this._spriteId=e.readInt(),this._category=e.readInt(),this._stuffData=ka.parseObjectData(e),this._isRecyclable=e.readBoolean(),this._tradable=e.readBoolean(),this._isGroupable=e.readBoolean(),this._sellable=e.readBoolean(),this._secondsToExpiration=e.readInt(),this._expirationTimeStamp=ve(),this.secondsToExpiration>-1?this._rentable=!0:(this._rentable=!1,this._secondsToExpiration=-1),this._hasRentPeriodStarted=e.readBoolean(),this._flatId=e.readInt(),this._isWallItem=this._furniType===vg.WALL_ITEM,this._furniType===vg.FLOOR_ITEM&&(this._slotId=e.readString(),this._extra=e.readInt()),!0):!1}get itemId(){return this._itemId}get furniType(){return this._furniType}get ref(){return this._ref}get spriteId(){return this._spriteId}get category(){return this._category}get stuffData(){return this._stuffData}get isGroupable(){return this._isGroupable}get isRecycleable(){return this._isRecyclable}get tradable(){return this._tradable}get sellable(){return this._sellable}get secondsToExpiration(){return this._secondsToExpiration}get flatId(){return this._flatId}get slotId(){return this._slotId}get songId(){return this._songId}get extra(){return this._extra}get rentable(){return this._rentable}get isWallItem(){return this._isWallItem}get hasRentPeriodStarted(){return this._hasRentPeriodStarted}get expirationTimeStamp(){return this._expirationTimeStamp}get creationDay(){return 0}get creationMonth(){return 0}get creationYear(){return 0}get isExternalImageFurni(){return this._furniType.indexOf("external_image")!==-1}};Tm.WALL_ITEM="I";Tm.FLOOR_ITEM="S";let PO=Tm;class xw{flush(){return this._items=[],!0}parse(e){return e?(this._items.push(new PO(e)),!0):!1}get items(){return this._items}}class ww{flush(){return!0}parse(e){return!!e}}class Gw{flush(){return this._totalFragments=0,this._fragmentNumber=0,this._fragment=new Map,!0}parse(e){if(!e)return!1;this._totalFragments=e.readInt(),this._fragmentNumber=e.readInt();let t=e.readInt();for(;t>0;){const s=new PO(e);s&&this._fragment.set(s.itemId,s),t--}return!0}get totalFragments(){return this._totalFragments}get fragmentNumber(){return this._fragmentNumber}get fragment(){return this._fragment}}class Bw{flush(){return this._itemId=0,!0}parse(e){return e?(this._itemId=e.readInt(),!0):!1}get itemId(){return this._itemId}}class kw{flush(){return this._itemId=0,this._itemsLeft=0,!0}parse(e){return e?(this._itemId=e.readInt(),this._itemsLeft=e.readInt(),!0):!1}get itemId(){return this._itemId}get itemsLeft(){return this._itemsLeft}}class Vw{flush(){return this._itemType="",this._classId=0,this._productCode="",!0}parse(e){return e?(this._itemType=e.readString(),this._classId=e.readInt(),this._productCode=e.readString(),this._placedItemId=e.readInt(),this._placedItemType=e.readString(),this._placedInRoom=e.readBoolean(),this._petFigureString=e.readString(),!0):!1}get itemType(){return this._itemType}get classId(){return this._classId}get productCode(){return this._productCode}get placedItemId(){return this._placedItemId}get placedItemType(){return this._placedItemType}get placedInRoom(){return this._placedInRoom}get petFigureString(){return this._petFigureString}}class Hw{flush(){this._nestId=0,this._pet1&&(this._pet1.dispose(),this._pet1=null),this._pet2&&(this._pet2.dispose(),this._pet2=null);for(const e of this._rarityCategories)e&&e.dispose();return this._rarityCategories=[],!0}parse(e){if(!e)return!1;this._nestId=e.readInt(),this._pet1=new bp(e),this._pet2=new bp(e);let t=e.readInt();for(;t>0;)this._rarityCategories.push(new Ew(e)),t--;return this._resultPetType=e.readInt(),!0}get nestId(){return this._nestId}get pet1(){return this._pet1}get pet2(){return this._pet2}get rarityCategories(){return this._rarityCategories}get resultPetType(){return this._resultPetType}}class jw{flush(){return this._breedingNestStuffId=0,this._result=0,!0}parse(e){return e?(this._breedingNestStuffId=e.readInt(),this._result=e.readInt(),!0):!1}get breedingNestStuffId(){return this._breedingNestStuffId}get result(){return this._result}}class Ww{flush(){return this._petId=-1,this._rarityCategory=-1,!0}parse(e){return this._petId=e.readInt(),this._rarityCategory=e.readInt(),!0}get rarityCategory(){return this._rarityCategory}get petId(){return this._petId}}class Rm{constructor(e){this._typeId=e.readInt(),this._paletteId=e.readInt(),this._color=e.readString(),this._breedId=e.readInt(),this._customParts=[],this._customPartCount=e.readInt();let t=0;for(;t<this._customPartCount;)this._customParts.push(e.readInt()),this._customParts.push(e.readInt()),this._customParts.push(e.readInt()),t++}get typeId(){return this._typeId}get paletteId(){return this._paletteId}get color(){return this._color}get breedId(){return this._breedId}get figuredata(){let e=this.typeId+" "+this.paletteId+" "+this.color;e=e+(" "+this.custompartCount);for(const t of this.customParts)e=e+(" "+t);return e}get customParts(){return this._customParts}get custompartCount(){return this._customPartCount}}class Nd{constructor(e){if(!e)throw new Error("invalid_wrapper");this._id=e.readInt(),this._name=e.readString(),this._figureData=new Rm(e),this._level=e.readInt()}get id(){return this._id}get name(){return this._name}get typeId(){return this._figureData.typeId}get paletteId(){return this._figureData.paletteId}get color(){return this._figureData.color}get breedId(){return this._figureData.breedId}get customPartCount(){return this._figureData.custompartCount}get figureString(){return this._figureData.figuredata}get figureData(){return this._figureData}get level(){return this._level}}class Yw{flush(){return this._pet=null,this._boughtAsGift=!1,!0}parse(e){return this._pet=new Nd(e),this._boughtAsGift=e.readBoolean(),!0}get pet(){return this._pet}get boughtAsGift(){return this._boughtAsGift}}class yd{flush(){return this._state=0,this._ownPetId=0,this._otherPetId=0,!0}parse(e){return e?(this._state=e.readInt(),this._ownPetId=e.readInt(),this._otherPetId=e.readInt(),!0):!1}get state(){return this._state}get ownPetId(){return this._ownPetId}get otherPetId(){return this._otherPetId}}yd.STATE_CANCEL=1;yd.STATE_ACCEPT=2;yd.STATE_REQUEST=3;class zw{flush(){return this._fragment=null,!0}parse(e){this._totalFragments=e.readInt(),this._fragmentNumber=e.readInt();let t=e.readInt();for(this._fragment=new Map;t>0;){const s=new Nd(e);this._fragment.set(s.id,s),t--}return!0}get totalFragments(){return this._totalFragments}get fragmentNumber(){return this._fragmentNumber}get fragment(){return this._fragment}}class Kw{flush(){return this._boughtAsGift=!1,this._pet=null,!0}parse(e){return this._boughtAsGift=e.readBoolean(),this._pet=new Nd(e),!0}get boughtAsGift(){return this._boughtAsGift}get pet(){return this._pet}}class Xw{flush(){return!0}parse(e){return e?(this._petId=e.readInt(),!0):!1}get petId(){return this._petId}}class qw{constructor(e){this._itemId=e.readInt(),this._furniType=e.readString().toUpperCase(),this._ref=e.readInt(),this._spriteId=e.readInt(),this._category=e.readInt(),this._isGroupable=e.readBoolean(),this._stuffData=ka.parseObjectData(e),this._secondsToExpiration=-1,this._expirationTimeStamp=ve(),this._hasRentPeriodStarted=!1,this._creationDay=e.readInt(),this._creationMonth=e.readInt(),this._creationYear=e.readInt(),this._extra=this.furniType==="S"?e.readInt():-1,this._flatId=-1,this._rentable=!1,this._isWallItem=this._furniType==="I"}get itemId(){return this._itemId}get furniType(){return this._furniType}get ref(){return this._ref}get spriteId(){return this._spriteId}get category(){return this._category}get stuffData(){return this._stuffData}get extra(){return this._extra}get secondsToExpiration(){return this._secondsToExpiration}get creationDay(){return this._creationDay}get creationMonth(){return this._creationMonth}get creationYear(){return this._creationYear}get isGroupable(){return this._isGroupable}get songId(){return this._extra}get flatId(){return this._flatId}get rentable(){return this._rentable}get isWallItem(){return this._isWallItem}get hasRentPeriodStarted(){return this._hasRentPeriodStarted}get expirationTimeStamp(){return this._expirationTimeStamp}get isRecycleable(){return!0}get tradable(){return!0}get sellable(){return!0}get slotId(){return null}get isExternalImageFurni(){return this._furniType.indexOf("external_image")!==-1}}class Qw{flush(){return this._userID=-1,this._userAccepts=!1,!0}parse(e){return e?(this._userID=e.readInt(),this._userAccepts=e.readInt()>0,!0):!1}get userID(){return this._userID}get userAccepts(){return this._userAccepts}}class Om{flush(){return!0}parse(e){return e?(this._userId=e.readInt(),this._reason=e.readInt(),!0):!1}get userID(){return this._userId}get reason(){return this._reason}}Om.ERROR_WHILE_COMMIT=1;class Jw{flush(){return!0}parse(e){return!!e}}class Zw{flush(){return!0}parse(e){return!!e}}class $w{flush(){return this._firstUserID=-1,this._firstUserItemArray=null,this._firstUserNumItems=0,this._firstUserNumCredits=0,this._secondUserID=-1,this._secondUserItemArray=null,this._secondUserNumItems=0,this._secondUserNumCredits=0,!0}parse(e){return!e||(this._firstUserID=e.readInt(),this._firstUserItemArray=[],!this.parseItems(e,this._firstUserItemArray))||(this._firstUserNumItems=e.readInt(),this._firstUserNumCredits=e.readInt(),this._secondUserID=e.readInt(),this._secondUserItemArray=[],!this.parseItems(e,this._secondUserItemArray))?!1:(this._secondUserNumItems=e.readInt(),this._secondUserNumCredits=e.readInt(),!0)}parseItems(e,t){let s=e.readInt();for(;s>0;)t.push(new qw(e)),s--;return!0}get firstUserID(){return this._firstUserID}get firstUserItemArray(){return this._firstUserItemArray}get firstUserNumItems(){return this._firstUserNumItems}get firstUserNumCredits(){return this._firstUserNumCredits}get secondUserID(){return this._secondUserID}get secondUserItemArray(){return this._secondUserItemArray}get secondUserNumItems(){return this._secondUserNumItems}get secondUserNumCredits(){return this._secondUserNumCredits}}class eG{flush(){return!0}parse(e){return!!e}}class tG{flush(){return!0}parse(e){return!!e}}class Sm{flush(){return!0}parse(e){return e?(this._reason=e.readInt(),this._otherUserName=e.readString(),!0):!1}get reason(){return this._reason}get otherUserName(){return this._otherUserName}}Sm.REASON_YOU_ARE_ALREADY_TRADING=7;Sm.REASON_OTHER_USER_ALREADY_TRADING=8;class sG{flush(){return this._userId=-1,this._userCanTrade=!1,this._otherUserId=-1,this._otherUserCanTrade=!1,!0}parse(e){return e?(this._userId=e.readInt(),this._userCanTrade=e.readInt()===1,this._otherUserId=e.readInt(),this._otherUserCanTrade=e.readInt()===1,!0):!1}get userID(){return this._userId}get userCanTrade(){return this._userCanTrade}get otherUserID(){return this._otherUserId}get otherUserCanTrade(){return this._otherUserCanTrade}}class rG{flush(){return!0}parse(e){return!!e}}class iG{flush(){return!0}parse(e){return!!e}}class nG{flush(){return this._respect=0,this._petOwnerId=0,this._petData=null,!0}parse(e){return e?(this._respect=e.readInt(),this._petOwnerId=e.readInt(),this._petData=new Nd(e),!0):!1}get respect(){return this._respect}get petOwnerId(){return this._petOwnerId}get petData(){return this._petData}get isTreat(){return this._petData.typeId===be.MONSTERPLANT}}class aG{flush(){return this._petId=0,this._userId=0,this._supplementType=0,!0}parse(e){return e?(this._petId=e.readInt(),this._userId=e.readInt(),this._supplementType=e.readInt(),!0):!1}get petId(){return this._petId}get userId(){return this._userId}get supplementType(){return this._supplementType}}class Pa{}Pa.WATER=0;Pa.LIGHT=1;Pa.REVIVE=2;Pa.REBREED_FERTILIZER=3;Pa.SPEED_FERTILIZER=4;class oG{flush(){return this._userId=0,this._respectsReceived=0,!0}parse(e){return e?(this._userId=e.readInt(),this._respectsReceived=e.readInt(),!0):!1}get userId(){return this._userId}get respectsReceived(){return this._respectsReceived}}class lG{constructor(e,t,s){this._hasControllers=!1,this._roomId=e,this._roomName=t,this._hasControllers=s}get roomId(){return this._roomId}get roomName(){return this._roomName}get hasControllers(){return this._hasControllers}}class cG{constructor(e){this._currentHcStreak=e.readInt(),this._firstSubscriptionDate=e.readString(),this._kickbackPercentage=e.readDouble(),this._totalCreditsMissed=e.readInt(),this._totalCreditsRewarded=e.readInt(),this._totalCreditsSpent=e.readInt(),this._creditRewardForStreakBonus=e.readInt(),this._creditRewardForMonthlySpent=e.readInt(),this._timeUntilPayday=e.readInt()}get currentHcStreak(){return this._currentHcStreak}get firstSubscriptionDate(){return this._firstSubscriptionDate}get kickbackPercentage(){return this._kickbackPercentage}get totalCreditsMissed(){return this._totalCreditsMissed}get totalCreditsRewarded(){return this._totalCreditsRewarded}get totalCreditsSpent(){return this._totalCreditsSpent}get creditRewardForStreakBonus(){return this._creditRewardForStreakBonus}get creditRewardForMonthlySpent(){return this._creditRewardForMonthlySpent}get timeUntilPayday(){return this._timeUntilPayday}}class uG{flush(){return this._data=null,!0}parse(e){return this._data=new cG(e),!0}get data(){return this._data}}class hG{flush(){return this._looks=new Map,!0}parse(e){if(!e)return!1;e.readInt();let t=e.readInt();for(;t>0;){const s=e.readInt(),r=e.readString(),i=e.readString();this._looks.set(s,[r,i]),t--}return!0}get looks(){return this._looks}}class dG{flush(){return this._result=-1,!0}parse(e){return e?(this._result=e.readInt(),!0):!1}get result(){return this._result}}class _G{flush(){return this._isVip=!1,this._rooms=[],!0}parse(e){if(!e)return!1;this._isVip=e.readBoolean();let t=e.readInt();for(;t>0;)this._rooms.push(new lG(e.readInt(),e.readString(),e.readBoolean())),t--;return!0}get isVip(){return this._isVip}get rooms(){return this._rooms}}class gG{flush(){return this._pageId=-1,this._data=null,!0}parse(e){return e?(this._pageId=e.readInt(),this._data=new Sd(e),!0):!1}get pageId(){return this._pageId}get data(){return this._data}}class fG{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._type=-1,this._breedId=-1,this._paletteId=-1,this._sellable=!1,this._rare=!1,!0}parse(e){return e?(this._type=e.readInt(),this._breedId=e.readInt(),this._paletteId=e.readInt(),this._sellable=e.readBoolean(),this._rare=e.readBoolean(),!0):!1}get type(){return this._type}get breedId(){return this._breedId}get paletteId(){return this._paletteId}get sellable(){return this._sellable}get rare(){return this._rare}}class mG{flush(){return this._productCode="",this._palettes=[],!0}parse(e){if(!e)return!1;this._productCode=e.readString();let t=e.readInt();for(;t>0;)this._palettes.push(new fG(e)),t--;return!0}get productCode(){return this._productCode}get palettes(){return this._palettes}}class EG{constructor(e){this._trackingState=e.readInt(),this._id=e.readInt(),this._identifier=e.readString(),this._productCode=e.readString(),this._priceInCredits=e.readInt(),this._priceInActivityPoints=e.readInt(),this._activityPointType=e.readInt(),this._purchaseLimit=e.readInt();const t=e.readInt();this._expirationTime=t>0?t*1e3+Date.now():0,this._title=e.readString(),this._description=e.readString(),this._imageUrl=e.readString(),this._iconImageUrl=e.readString(),this._type=e.readInt(),this._subProductCodes=[];let s=e.readInt();for(;s>0;)this._subProductCodes.push(e.readString()),s--;return this}populate(e){e&&(this._id=e.id,this._identifier=e.identifier,this._type=e.type,this._title=e.title,this._description=e.description,this._imageUrl=e.imageUrl,this._iconImageUrl=e.iconImageUrl,this._productCode=e.productCode,this._purchaseLimit=e.purchaseLimit,this._expirationTime=e.expirationTime,this._priceInCredits=e.priceInCredits,this._priceInActivityPoints=e.priceInActivityPoints,this._activityPointType=e.activityPointType,this._subProductCodes=e.subProductCodes,this._trackingState=e.trackingState)}purchase(e){this._purchaseLimit=this._purchaseLimit-e}get id(){return this._id}get identifier(){return this._identifier}get type(){return this._type}get title(){return this._title}get description(){return this._description}get imageUrl(){return this._imageUrl}get iconImageUrl(){return this._iconImageUrl}get productCode(){return this._productCode}get purchaseLimit(){return this._purchaseLimit}get expirationTime(){return this._expirationTime}get priceInCredits(){return this._priceInCredits}get priceInActivityPoints(){return this._priceInActivityPoints}get activityPointType(){return this._activityPointType}get subProductCodes(){return this._subProductCodes}get trackingState(){return this._trackingState}}class pG{flush(){return!0}parse(e){return!!e}}class IG{flush(){return this._data=null,!0}parse(e){return e?(this._data=new EG(e),!0):!1}get data(){return this._data}}class TG{constructor(){this._errorCode=""}flush(){return this._errorCode="",!0}parse(e){return e?(this._errorCode=e.readString(),!0):!1}get errorCode(){return this._errorCode}}class RG{constructor(){this._productName="",this._productDescription=""}flush(){return this._productDescription="",this._productName="",!0}parse(e){return e?(this._productDescription=e.readString(),this._productName=e.readString(),!0):!1}get productName(){return this._productName}get productDescription(){return this._productDescription}}class OG{flush(){return!0}parse(e){return!!e}}class Va{flush(){return this._goalId=0,this._goalCode=null,this._result=0,this._requiredFurnis=null,this._missingFurnis=null,!0}parse(e){this._goalId=e.readInt(),this._goalCode=e.readString(),this._result=e.readInt(),this._requiredFurnis=[];let t=e.readInt();for(;t>0;)this._requiredFurnis.push(e.readString()),t--;for(t=e.readInt();t>0;)this._missingFurnis[e.readString()]="",t--;return!0}get goalId(){return this._goalId}get goalCode(){return this._goalCode}get result(){return this._result}get requiredFurnis(){return this._requiredFurnis}isMissing(e){return!!this._missingFurnis[e]}}Va.SUBMITTED=0;Va.ASK_FOR_SUBMIT=1;Va.ASK_FOR_CONFIRM=2;Va.PREREQUISITES_NOT_MET=3;Va.ROOM_DOOR_NOT_OPEN=4;Va.ROOM_TOO_OLD=5;Va.ASK_FOR_ACCEPT_RULES=6;class Md{}Md.ALLOWED=0;Md.REQUIRED_PERK_MISSING=1;Md.REQUIRED_BADGE_MISSING=2;class SG{flush(){return this._goalId=0,this._goalCode=null,this._resultCode=0,this._votesRemaining=0,!0}parse(e){return this._goalId=e.readInt(),this._goalCode=e.readString(),this._resultCode=e.readInt(),this._votesRemaining=e.readInt(),!0}get goalId(){return this._goalId}get goalCode(){return this._goalCode}get isVotingAllowedForUser(){return this._resultCode===Md.ALLOWED}get votesRemaining(){return this._votesRemaining}get resultCode(){return this._resultCode}}class CG{flush(){return this._schedulingStr=null,this._code=null,!0}parse(e){return this._schedulingStr=e.readString(),this._code=e.readString(),!0}get schedulingStr(){return this._schedulingStr}get code(){return this._code}}class AG{flush(){return this._isPartOf=!1,this._targetId=0,!0}parse(e){return this._isPartOf=e.readBoolean(),this._targetId=e.readInt(),!0}get isPartOf(){return this._isPartOf}get targetId(){return this._targetId}}class NG{flush(){return!0}parse(e){return!0}}class yG{flush(){return this._timeStr=null,this._secondsUntil=0,!0}parse(e){return this._timeStr=e.readString(),this._secondsUntil=e.readInt(),!0}get timeStr(){return this._timeStr}get secondsUntil(){return this._secondsUntil}}class LO{constructor(e){this._recipeName=e.readString(),this._itemName=e.readString()}get recipeName(){return this._recipeName}get itemName(){return this._itemName}}class MG{constructor(){this._recipes=[],this._ingredients=[]}flush(){return this._recipes=[],this._ingredients=[],!0}parse(e){if(!e)return!1;const t=e.readInt();for(let r=0;r<t;r++)this._recipes.push(new LO(e));const s=e.readInt();for(let r=0;r<s;r++)this._ingredients.push(e.readString());return!0}get recipes(){return this._recipes}get ingredients(){return this._ingredients}isActive(){return this._recipes.length>0||this._ingredients.length>0}}class DG{constructor(e){this._count=e.readInt(),this._itemName=e.readString()}get count(){return this._count}get itemName(){return this._itemName}}class vG{constructor(){this._ingredients=[]}parse(e){if(!e)return!1;const t=e.readInt();for(let s=0;s<t;s++)this._ingredients.push(new DG(e));return!0}flush(){return this._ingredients=[],!0}get ingredients(){return this._ingredients}}class bG{parse(e){return e?(this._count=e.readInt(),this._hasRecipes=e.readBoolean(),!0):!1}flush(){return this._count=0,this._hasRecipes=!1,!0}get count(){return this._count}get hasRecipes(){return this._hasRecipes}}class PG{parse(e){return e?(this._success=e.readBoolean(),this._success&&(this._result=new LO(e)),!0):!1}flush(){return this._success=!1,!0}get success(){return this._success}get result(){return this._result}}class LG{flush(){return!0}parse(e){return!!e}}class UG{constructor(e){if(!e)throw new Error("invalid_wrapper");this._senderId=e.readInt(),this._errorCode=e.readInt()}get senderId(){return this._senderId}get errorCode(){return this._errorCode}}class FG{flush(){return this._failuers=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._failuers.push(new UG(e)),t--;return!0}get failures(){return this._failuers}}class xG{flush(){return this._success=!1,!0}parse(e){return e?(this._success=e.readBoolean(),!0):!1}get success(){return this._success}}class wG{flush(){return this._errorCode=0,!0}parse(e){return e?(this._errorCode=e.readInt(),!0):!1}get errorCode(){return this._errorCode}}class UO{constructor(e){if(!e)throw new Error("invalid_wrapper");this._id=e.readInt(),this._name=e.readString()}get id(){return this._id}get name(){return this._name}}class bg{constructor(e){if(!e)throw new Error("invalid_wrapper");this._id=e.readInt(),this._name=e.readString(),this._gender=e.readInt(),this._online=e.readBoolean(),this._followingAllowed=e.readBoolean(),this._figure=e.readString(),this._categoryId=e.readInt(),this._motto=e.readString(),this._realName=e.readString(),this._lastAccess=e.readString(),this._persistedMessageUser=e.readBoolean(),this._vipMember=e.readBoolean(),this._pocketHabboUser=e.readBoolean(),this._relationshipStatus=e.readShort()}get id(){return this._id}get name(){return this._name}get gender(){return this._gender}get online(){return this._online}get followingAllowed(){return this._followingAllowed}get figure(){return this._figure}get categoryId(){return this._categoryId}get motto(){return this._motto}get lastAccess(){return this._lastAccess}get realName(){return this._realName}get persistedMessageUser(){return this._persistedMessageUser}get vipMember(){return this._vipMember}get pocketHabboUser(){return this._pocketHabboUser}get relationshipStatus(){return this._relationshipStatus}}class GG{flush(){return this._totalFragments=0,this._fragmentNumber=0,this._fragment=[],!0}parse(e){if(!e)return!1;this._totalFragments=e.readInt(),this._fragmentNumber=e.readInt();let t=e.readInt();for(;t>0;)this._fragment.push(new bg(e)),t--;return!0}get totalFragments(){return this._totalFragments}get fragmentNumber(){return this._fragmentNumber}get fragment(){return this._fragment}}class BG{flush(){return this._categories=[],this._removedFriendIds=[],this._addedFriends=[],this._updatedFriends=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._categories.push(new UO(e)),t--;let s=e.readInt();for(;s>0;){const r=e.readInt();r===-1?this._removedFriendIds.push(e.readInt()):r===0?this._updatedFriends.push(new bg(e)):r===1&&this._addedFriends.push(new bg(e)),s--}return!0}get categories(){return this._categories}get removedFriendIds(){return this._removedFriendIds}get addedFriends(){return this._addedFriends}get updatedFriends(){return this._updatedFriends}}class kG{flush(){return this._typeCode=-1,this._avatarId=0,this._message=null,!0}parse(e){return e?(this._typeCode=e.readInt(),this._avatarId=e.readInt(),this._message=e.readString(),!0):!1}get typeCode(){return this._typeCode}get avatarId(){return this._avatarId}get message(){return this._message}}class FO{constructor(e){if(!e)throw new Error("invalid_wrapper");this._requestId=e.readInt(),this._requesterName=e.readString(),this._figureString=e.readString(),this._requesterUserId=this._requestId}get requestId(){return this._requestId}get requesterName(){return this._requesterName}get requesterUserId(){return this._requesterUserId}get figureString(){return this._figureString}}class VG{flush(){return this._totalRequests=0,this._requests=[],!0}parse(e){if(!e)return!1;this._totalRequests=e.readInt();let t=e.readInt();for(;t>0;)this._requests.push(new FO(e)),t--;return!0}get totalRequests(){return this._totalRequests}get requests(){return this._requests}}class Lp{constructor(e){if(!e)throw new Error("invalid_wrapper");this._avatarId=e.readInt(),this._avatarName=e.readString(),this._avatarMotto=e.readString(),this._isAvatarOnline=e.readBoolean(),this._canFollow=e.readBoolean(),this._lastOnlineData=e.readString(),this._avatarGender=e.readInt(),this._avatarFigure=e.readString(),this._realName=e.readString()}get avatarId(){return this._avatarId}get avatarName(){return this._avatarName}get avatarMotto(){return this._avatarMotto}get isAvatarOnline(){return this._isAvatarOnline}get canFollow(){return this._canFollow}get avatarGender(){return this._avatarGender}get avatarFigure(){return this._avatarFigure}get lastOnlineData(){return this._lastOnlineData}get realName(){return this._realName}}class HG{flush(){return this._friends=[],this._others=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._friends.push(new Lp(e)),t--;let s=e.readInt();for(;s>0;)this._others.push(new Lp(e)),s--;return!0}get friends(){return this._friends}get others(){return this._others}}class jG{flush(){return this._errorCode=0,this._userId=0,this._message=null,!0}parse(e){return e?(this._errorCode=e.readInt(),this._userId=e.readInt(),this._message=e.readString(),!0):!1}get errorCode(){return this._errorCode}get userId(){return this._userId}get message(){return this._message}}class WG{flush(){return this._clientMessageId=0,this._errorCode=0,!0}parse(e){return e?(this._clientMessageId=e.readInt(),this._errorCode=e.readInt(),!0):!1}get clientMessageId(){return this._clientMessageId}get errorCode(){return this._errorCode}}class YG{flush(){return this._userFriendLimit=0,this._normalFriendLimit=0,this._extendedFriendLimit=0,this._categories=[],!0}parse(e){if(!e)return!1;this._userFriendLimit=e.readInt(),this._normalFriendLimit=e.readInt(),this._extendedFriendLimit=e.readInt();let t=e.readInt();for(;t>0;)this._categories.push(new UO(e)),t--;return!0}get userFriendLimit(){return this._userFriendLimit}get normalFriendLimit(){return this._normalFriendLimit}get extendedFriendLimit(){return this._extendedFriendLimit}get categories(){return this._categories}}class zG{flush(){return!0}parse(e){return!!e}}class KG{flush(){return this._count=0,!0}parse(e){return e?(this._count=e.readInt(),!0):!1}get count(){return this._count}}class XG{flush(){return this._senderId=0,this._messageText=null,this._secondsSinceSent=0,this._extraData=null,!0}parse(e){return e?(this._senderId=e.readInt(),this._messageText=e.readString(),this._secondsSinceSent=e.readInt(),e.bytesAvailable&&(this._extraData=e.readString()),!0):!1}get senderId(){return this._senderId}get messageText(){return this._messageText}get secondsSinceSent(){return this._secondsSinceSent}get extraData(){return this._extraData}}class qG{flush(){return this._request=null,!0}parse(e){return e?(this._request=new FO(e),!0):!1}get request(){return this._request}}class QG{flush(){return this._errorCode=0,this._failedRecipients=[],!0}parse(e){if(!e)return!1;this._errorCode=e.readInt();let t=e.readInt();for(;t>0;)this._failedRecipients.push(e.readInt()),t--;return!0}get errorCode(){return this._errorCode}get failedRecipients(){return this._failedRecipients}}class JG{flush(){return this._senderId=0,this._messageText=null,!0}parse(e){return e?(this._senderId=e.readInt(),this._messageText=e.readString(),!0):!1}get senderId(){return this._senderId}get messageText(){return this._messageText}}class ZG{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),this._freeGamesLeft=e.readInt(),this._gamesPlayedTotal=e.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get freeGamesLeft(){return this._freeGamesLeft}get gamesPlayedTotal(){return this._gamesPlayedTotal}get hasUnlimitedGames(){return this._freeGamesLeft==-1}}class tu{flush(){return this._status=-1,this._blockLength=-1,this._gamesPlayed=-1,this._freeGamesLeft=-1,!0}parse(e){return e?(this._status=e.readInt(),this._blockLength=e.readInt(),this._gamesPlayed=e.readInt(),this._freeGamesLeft=e.readInt(),!0):!1}get status(){return this._status}get blockLength(){return this._blockLength}get gamesPlayed(){return this._gamesPlayed}get freeGamesLeft(){return this._freeGamesLeft}get hasUnlimitedGames(){return this._freeGamesLeft==-1}}tu.STATUS_OK=0;tu.STATUS_FAILED_REASON_UNKNOWN=1;tu.STATUS_FAILED_REASON_GAME_DIRECTORY_IS_NOT_AVAILABLE=2;tu.STATUS_FAILED_REASON_HOTEL_IS_CLOSED=3;class $G{flush(){return this._position=-1,!0}parse(e){return e?(this._position=e.readInt(),!0):!1}get position(){return this._position}}class na{flush(){return this._reason=-1,!0}parse(e){return e?(this._reason=e.readInt(),!0):!1}get reason(){return this._reason}}na.KICKED=1;na.DUPLICATE_MACHINEID=2;na.INVITATION_REQUIRED=3;na.NO_SPACE_IN_TEAM=4;na.TEAM_NOT_FOUND=5;na.USER_HAS_ACTIVE_INSTANCE=6;na.USER_HAS_PENDING_INSTANCE_REQUEST=7;na.USER_HAS_NO_FREE_GAMES_LEFT=8;class Cm{flush(){return this._reason=-1,!0}parse(e){return e?(this._reason=e.readInt(),!0):!1}get reason(){return this._reason}}Cm.NOT_ENOUGH_PLAYERS=1;Cm.GAME_HAS_NO_OWNER=2;class eB{flush(){return!0}parse(e){return!!e}}class tB{flush(){return this._userId=-1,!0}parse(e){return e?(this._userId=e.readInt(),!0):!1}get userId(){return this._userId}}class sB{flush(){return!0}parse(e){return e?(this._stuffCode=e.readString(),this._badgeCode=e.readString(),!0):!1}get stuffCode(){return this._stuffCode}get badgeCode(){return this._badgeCode}}class rB{flush(){return this._stuffId=-1,this._achievementId=0,this._requiredLevelBadgeCode="",this._userProgress=0,this._totalProgress=0,this._endTime=0,!0}parse(e){return e?(this._stuffId=e.readInt(),this._achievementId=e.readInt(),this._requiredLevelBadgeCode=e.readString(),this._userProgress=e.readInt(),this._totalProgress=e.readInt(),this._endTime=e.readInt(),!0):!1}get stuffId(){return this._stuffId}get achievementId(){return this._achievementId}get requiredLevelBadgeCode(){return this._requiredLevelBadgeCode}get userProgress(){return this._userProgress}get totalProgress(){return this._totalProgress}get endTime(){return this._endTime}}class iB{flush(){return!0}parse(e){if(!e)return!1;this._stuffId=e.readInt();const t=e.readInt();let s=0;for(;s<t;)this._achievements.push(new G1(e)),s++;return this._endTime=e.readInt(),!0}get stuffId(){return this._stuffId}get achievements(){return this._achievements}get endTime(){return this._endTime}}class nB{constructor(e,t,s,r){this._gameTypeId=e,this._achievementId=t,this._achievementName=s,this._levels=r}get gameTypeId(){return this._gameTypeId}get achievementId(){return this._achievementId}get achievementName(){return this._achievementName}get levels(){return this._levels}}class aB{flush(){return!0}parse(e){if(!e)return!1;this._achievements=[];const t=e.readInt();let s=0;for(;s<t;){const r=e.readInt(),i=e.readInt();let a=0;for(;a<i;){const l=e.readInt(),c=e.readString(),u=e.readInt();this._achievements.push(new nB(r,l,c,u)),a++}s++}return!0}get achievements(){return this._achievements}}class oB{constructor(e,t,s,r,i,a){this._gameId=e,this._gameNameId=t,this._bgColor=s,this._textColor=r,this._assetUrl=i,this._supportUrl=a}get gameId(){return this._gameId}get gameNameId(){return this._gameNameId}get bgColor(){return this._bgColor}get textColor(){return this._textColor}get assetUrl(){return this._assetUrl}get supportUrl(){return this._supportUrl}}class lB{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),this._inviterId=e.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get inviterId(){return this._inviterId}}class cB{flush(){return!0}parse(e){if(!e)return!1;this._games=[];const t=e.readInt();for(let s=0;s<t;s++){const r=e.readInt(),i=e.readString(),a=e.readString();let l=parseInt(a,16);l=l|4278190080;const c=e.readString();let u=parseInt(c,16);u=u|4278190080;const h=e.readString(),d=e.readString();this._games.push(new oB(r,i,l,u,h,d))}return!0}get games(){return this._games}}const Am=class Pg{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),this._status=e.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get isOk(){return this._status==Pg.OK}get isInMaintenance(){return this._status==Pg.MAINTENANCE}};Am.OK=0;Am.MAINTENANCE=1;let uB=Am;class hB{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}}class xO{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),this._reason=e.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}get reason(){return this._reason}}xO.DUPLICATE_MACHINEID=1;class dB{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),!0):!1}get gameTypeId(){return this._gameTypeId}}class _B{flush(){return!0}parse(e){if(!e)return!1;this._gameTypeId=e.readInt(),this._gameClientId=e.readString(),this._url=e.readString(),this._quality=e.readString(),this._scaleMode=e.readString(),this._frameRate=e.readInt(),this._minMajorVersion=e.readInt(),this._minMinorVersion=e.readInt(),this._params=new Map;const t=e.readInt();let s=0;for(;s<t;)this._params.set(e.readString(),e.readString()),s++;return!0}get gameTypeId(){return this._gameTypeId}get url(){return this._url}get quality(){return this._quality}get scaleMode(){return this._scaleMode}get frameRate(){return this._frameRate}get minMajorVersion(){return this._minMajorVersion}get minMinorVersion(){return this._minMinorVersion}get params(){return this._params}get gameClientId(){return this._gameClientId}}class gB{flush(){return this._gameTypeId=0,this._url=null,this._gameClientId=null,!0}parse(e){return e?(this._gameTypeId=e.readInt(),this._gameClientId=e.readString(),this._url=e.readString(),!0):!1}get gameTypeId(){return this._gameTypeId}get url(){return this._url}get gameClientId(){return this._gameClientId}}class fB{flush(){return!0}parse(e){return e?(this._gameTypeId=e.readInt(),this._gameClientId=e.readString(),!0):!1}get gameTypeId(){return this._gameTypeId}get gameClientId(){return this._gameClientId}}class mB{flush(){return!0}parse(e){return!!e}}class Dd{flush(){return this._year=-1,this._week=-1,this._maxOffset=-1,this._currentOffset=-1,this._minutesUntilReset=-1,!0}parse(e){return e?(this._year=e.readInt(),this._week=e.readInt(),this._maxOffset=e.readInt(),this._currentOffset=e.readInt(),this._minutesUntilReset=e.readInt(),!0):!1}get year(){return this._year}get week(){return this._week}get maxOffset(){return this._maxOffset}get currentOffset(){return this._currentOffset}get minutesUntilReset(){return this._minutesUntilReset}}class EB{constructor(e){this._name=e.readString(),this._figure=e.readString(),this._gender=e.readString(),this._rank=e.readInt(),this._score=e.readInt()}get name(){return this._name}get figure(){return this._figure}get gender(){return this._gender}get rank(){return this._rank}get score(){return this._score}}class pB{flush(){return this._gameTypeId=-1,this._products=[],this._minutesUntilNextWeek=0,this._rewardingOn=!0,!0}parse(e){if(!e)return!1;this._gameTypeId=e.readInt();let t=e.readInt();for(;t>0;)this._products.push(new Hn(e)),t--;return this._minutesUntilNextWeek=e.readInt(),this._rewardingOn=e.readBoolean(),!0}get gameTypeId(){return this._gameTypeId}get products(){return this._products}get minutesUntilNextWeek(){return this._minutesUntilNextWeek}get rewardingOn(){return this._rewardingOn}}class IB{flush(){return this._gameTypeId=-1,this._winners=[],!0}parse(e){if(!e)return!1;this._gameTypeId=e.readInt();let t=e.readInt();for(;t>0;)this._winners.push(new EB(e)),t--;return!0}get gameTypeId(){return this._gameTypeId}get winners(){return this._winners}}class TB{flush(){return this._errorCode=0,!0}parse(e){return e?(this._errorCode=e.readInt(),!0):!1}get errorCode(){return this._errorCode}}class RB{flush(){return this._phoneStatusCode=-1,this._millisecondsToAllowProcessReset=-1,!0}parse(e){return e?(this._phoneStatusCode=e.readInt(),this._collectionStatusCode=e.readInt(),this._millisecondsToAllowProcessReset=e.readInt(),!0):!1}get phoneStatusCode(){return this._phoneStatusCode}get collectionStatusCode(){return this._collectionStatusCode}get millisecondsToAllowProcessReset(){return this._millisecondsToAllowProcessReset}}class OB{flush(){return this._resultCode=-1,!0}parse(e){return e?(this._resultCode=e.readInt(),this._millisToAllowProcessReset=e.readInt(),!0):!1}get resultCode(){return this._resultCode}get millisToAllowProcessReset(){return this._millisToAllowProcessReset}}class SB{flush(){return this._resultCode=-1,this._millisecondsToAllowProcessReset=-1,!0}parse(e){return e?(this._resultCode=e.readInt(),this._millisecondsToAllowProcessReset=e.readInt(),!0):!1}get resultCode(){return this._resultCode}get millisToAllowProcessReset(){return this._millisecondsToAllowProcessReset}}class CB{flush(){return this._bases=new Map,this._symbols=new Map,this._partColors=new Map,this._colorsA=new Map,this._colorsB=new Map,!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const l=e.readInt(),c=e.readString(),u=e.readString();this._bases.set(l,[c,u]),t--}let s=e.readInt();for(;s>0;){const l=e.readInt(),c=e.readString(),u=e.readString();this._symbols.set(l,[c,u]),s--}let r=e.readInt();for(;r>0;){const l=e.readInt(),c=e.readString();this._partColors.set(l,c),r--}let i=e.readInt();for(;i>0;){const l=e.readInt(),c=e.readString();this._colorsA.set(l,c),i--}let a=e.readInt();for(;a>0;){const l=e.readInt(),c=e.readString();this._colorsB.set(l,c),a--}return!0}get bases(){return this._bases}get symbols(){return this._symbols}get partColors(){return this._partColors}get colorsA(){return this._colorsA}get colorsB(){return this._colorsB}}class AB{flush(){return this._groupCost=0,this._availableRooms=new Map,!0}parse(e){if(!e)return!1;this._groupCost=e.readInt();let t=e.readInt();for(;t>0;){const s=e.readInt(),r=e.readString();e.readBoolean(),this._availableRooms.set(s,r),t--}return!0}get groupCost(){return this._groupCost}get availableRooms(){return this._availableRooms}}class NB{flush(){return this._userId=0,this._furnitureCount=0,!0}parse(e){return e?(this._userId=e.readInt(),this._furnitureCount=e.readInt(),!0):!1}get userId(){return this._userId}get furnitureCount(){return this._furnitureCount}}class yB{flush(){return this._id=0,this._type=0,this._title=null,this._description=null,this._badge=null,this._roomId=0,this._roomName=null,this._membershipType=0,this._membersCount=0,this._isFavorite=!1,this._createdAt=null,this._isOwner=!1,this._isAdmin=!1,this._ownerName=null,this._flag=!1,this._canMembersDecorate=!1,this._pendingRequestsCount=0,!0}parse(e){return e?(this._id=e.readInt(),e.readBoolean(),this._type=e.readInt(),this._title=e.readString(),this._description=e.readString(),this._badge=e.readString(),this._roomId=e.readInt(),this._roomName=e.readString(),this._membershipType=e.readInt(),this._membersCount=e.readInt(),this._isFavorite=e.readBoolean(),this._createdAt=e.readString(),this._isOwner=e.readBoolean(),this._isAdmin=e.readBoolean(),this._ownerName=e.readString(),this._flag=e.readBoolean(),this._canMembersDecorate=e.readBoolean(),this._pendingRequestsCount=e.readInt(),!0):!1}get id(){return this._id}get type(){return this._type}get title(){return this._title}get description(){return this._description}get badge(){return this._badge}get roomId(){return this._roomId}get roomName(){return this._roomName}get membershipType(){return this._membershipType}get membersCount(){return this._membersCount}get isFavorite(){return this._isFavorite}get createdAt(){return this._createdAt}get isOwner(){return this._isOwner}get isAdmin(){return this._isAdmin}get ownerName(){return this._ownerName}get flag(){return this._flag}get canMembersDecorate(){return this._canMembersDecorate}get pendingRequestsCount(){return this._pendingRequestsCount}}class MB{constructor(e){this.isBase=e,this.key=0,this.color=0,this.position=4}get code(){return this.key===0?null:(this.isBase?"b":"s")+(this.key<100?"0":"")+(this.key<10?"0":"")+this.key+(this.color<10?"0":"")+this.color+this.position}}class Ms{}Ms.OWNER=0;Ms.ADMIN=1;Ms.MEMBER=2;Ms.REQUESTED=3;Ms.DELETED=4;class DB{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._rank=-1,this._id=0,this._name=null,this._figure=null,this._joinedAt=null,!0}parse(e){return e?(this._rank=e.readInt(),this._id=e.readInt(),this._name=e.readString(),this._figure=e.readString(),this._joinedAt=e.readString(),!0):!1}get id(){return this._id}get name(){return this._name}get figure(){return this._figure}get rank(){return this._rank}get joinedAt(){return this._joinedAt}}class vB{flush(){return this._groupId=0,this._groupTitle=null,this._roomId=0,this._badge=null,this._totalMembersCount=0,this._result=[],this._admin=!1,this._pageSize=0,this._pageIndex=0,this._level=0,this._query=null,!0}parse(e){if(!e)return!1;this._groupId=e.readInt(),this._groupTitle=e.readString(),this._roomId=e.readInt(),this._badge=e.readString(),this._totalMembersCount=e.readInt();let t=e.readInt();for(;t>0;)this._result.push(new DB(e)),t--;return this._admin=e.readBoolean(),this._pageSize=e.readInt(),this._pageIndex=e.readInt(),this._level=e.readInt(),this._query=e.readString(),!0}get groupId(){return this._groupId}get groupTitle(){return this._groupTitle}get roomId(){return this._roomId}get badge(){return this._badge}get totalMembersCount(){return this._totalMembersCount}get result(){return this._result}get admin(){return this._admin}get pageSize(){return this._pageSize}get pageIndex(){return this._pageIndex}get level(){return this._level}get query(){return this._query}}class bB{flush(){return this._roomId=0,this._groupId=0,!0}parse(e){return e?(this._roomId=e.readInt(),this._groupId=e.readInt(),!0):!1}get roomId(){return this._roomId}get guildId(){return this._groupId}}class PB{flush(){return this._roomId=0,this._roomName=null,this._id=0,this._title=null,this._description=null,this._colorA=0,this._colorB=0,this._state=0,this._canMembersDecorate=!1,this._badgeParts=new Map,this._badgeCode=null,this._membersCount=0,!0}parse(e){if(!e)return!1;e.readInt()===1&&(this._roomId=e.readInt(),this._roomName=e.readString(),e.readBoolean()),e.readBoolean(),this._id=e.readInt(),this._title=e.readString(),this._description=e.readString(),e.readInt(),this._colorA=e.readInt(),this._colorB=e.readInt(),this._state=e.readInt(),this._canMembersDecorate=e.readInt()===0,e.readBoolean(),e.readString();const s=e.readInt();for(let r=0;r<s;r++){const i=new MB(r===0);i.key=e.readInt(),i.color=e.readInt(),i.position=e.readInt(),i.key===0&&(i.position=4),this._badgeParts.set(r,i)}return this._badgeCode=e.readString(),this._membersCount=e.readInt(),!0}get roomId(){return this._roomId}get roomName(){return this._roomName}get id(){return this._id}get title(){return this._title}get description(){return this._description}get colorA(){return this._colorA}get colorB(){return this._colorB}get state(){return this._state}get canMembersDecorate(){return this._canMembersDecorate}get badgeParts(){return this._badgeParts}get badgeCode(){return this._badgeCode}get membersCount(){return this._membersCount}}class LB{flush(){return!0}parse(e){return this._groupId=e.readInt(),!0}get groupId(){return this._groupId}}class wc{static parse(e){return this.fillFromMessage(new wc,e)}static fillFromMessage(e,t){return e._groupId=t.readInt(),e._name=t.readString(),e._description=t.readString(),e._icon=t.readString(),e._totalThreads=t.readInt(),e._leaderboardScore=t.readInt(),e._totalMessages=t.readInt(),e._unreadMessages=t.readInt(),e._lastMessageId=t.readInt(),e._lastMessageAuthorId=t.readInt(),e._lastMessageAuthorName=t.readString(),e._lastMessageTimeAsSecondsAgo=t.readInt(),e}get groupId(){return this._groupId}get name(){return this._name}get description(){return this._description}get icon(){return this._icon}get totalThreads(){return this._totalThreads}get leaderboardScore(){return this._leaderboardScore}get totalMessages(){return this._totalMessages}get unreadMessages(){return this._unreadMessages}get lastMessageId(){return this._lastMessageId}get lastMessageAuthorId(){return this._lastMessageAuthorId}get lastMessageAuthorName(){return this._lastMessageAuthorName}get lastMessageTimeAsSecondsAgo(){return this._lastMessageTimeAsSecondsAgo}updateFrom(e){this._totalThreads=e._totalThreads,this._totalMessages=e._totalMessages,this._unreadMessages=e._unreadMessages,this._lastMessageAuthorId=e._lastMessageAuthorId,this._lastMessageAuthorName=e._lastMessageAuthorName,this._lastMessageId=e._lastMessageId,this._lastMessageTimeAsSecondsAgo=e._lastMessageTimeAsSecondsAgo}get lastReadMessageId(){return this._totalMessages-this._unreadMessages}set lastReadMessageId(e){this._unreadMessages=this._totalMessages-e,this._unreadMessages<0&&(this._unreadMessages=0)}addNewThread(e){this._lastMessageAuthorId=e.lastUserId,this._lastMessageAuthorName=e.lastUserName,this._lastMessageId=e.lastMessageId,this._lastMessageTimeAsSecondsAgo=e.lastCommentTime,this._totalThreads++,this._totalMessages++,this._unreadMessages=0}}class Nm extends wc{static parse(e){const t=new Nm;return wc.fillFromMessage(t,e),t._readPermissions=e.readInt(),t._postMessagePermissions=e.readInt(),t._postThreadPermissions=e.readInt(),t._moderatePermissions=e.readInt(),t._readPermissionError=e.readString(),t._postMessagePermissionError=e.readString(),t._postThreadPermissionError=e.readString(),t._moderatePermissionError=e.readString(),t._reportPermissionError=e.readString(),t._canChangeSettings=e.readBoolean(),t._isStaff=e.readBoolean(),t}get readPermissions(){return this._readPermissions}get postMessagePermissions(){return this._postMessagePermissions}get postThreadPermissions(){return this._postThreadPermissions}get moderatePermissions(){return this._moderatePermissions}get hasReadPermissionError(){return this._readPermissionError.length===0}get canReport(){return!0}get hasPostMessagePermissionError(){return this._postMessagePermissionError.length===0}get hasPostThreadPermissionError(){return this._postThreadPermissionError.length===0}get hasModeratePermissionError(){return this._moderatePermissionError.length===0}get canChangeSettings(){return this._canChangeSettings}get isStaf(){return this._isStaff}get readPermissionError(){return this._readPermissionError}get postMessagePermissionError(){return this._postMessagePermissionError}get postThreadPermissionError(){return this._postThreadPermissionError}get moderatePermissionError(){return this._moderatePermissionError}get reportPermissionError(){return this._reportPermissionError}}class UB{flush(){return this._extendedForumData=null,!0}parse(e){return e?(this._extendedForumData=Nm.parse(e),!0):!1}get extendedForumData(){return this._extendedForumData}}class FB{flush(){return this._listCode=-1,this._totalAmount=0,this._startIndex=-1,this._amount=0,this._forums=[],!0}parse(e){if(!e)return!1;this._listCode=e.readInt(),this._totalAmount=e.readInt(),this._startIndex=e.readInt(),this._amount=e.readInt(),this._forums=[];let t=0;for(;t<this._amount;)this._forums.push(wc.parse(e)),t++;return!0}get listCode(){return this._listCode}get totalAmount(){return this._totalAmount}get startIndex(){return this._startIndex}get amount(){return this._amount}get forums(){return this._forums}}class su{static parse(e){const t=new su;return t._threadId=e.readInt(),t._authorId=e.readInt(),t._authorName=e.readString(),t._header=e.readString(),t._isPinned=e.readBoolean(),t._isLocked=e.readBoolean(),t._creationTimeAsSecondsAgo=e.readInt(),t._totalMessages=e.readInt(),t._unreadMessagesCount=e.readInt(),t._lastMessageId=e.readInt(),t._lastUserId=e.readInt(),t._lastUserName=e.readString(),t._lastCommentTime=e.readInt(),t._state=e.readByte(),t._adminId=e.readInt(),t._adminName=e.readString(),t._adminOperationTimeAsSecondsAgo=e.readInt(),t}get adminOperationTimeAsSecondsAgo(){return this._adminOperationTimeAsSecondsAgo}set adminOperationTimeAsSecondsAgo(e){this._adminOperationTimeAsSecondsAgo=e}get lastCommentTime(){return this._lastCommentTime}set lastCommentTime(e){this._lastCommentTime=e}get threadId(){return this._threadId}set threadId(e){this._threadId=e}get authorId(){return this._authorId}set authorId(e){this._authorId=e}get authorName(){return this._authorName}set authorName(e){this._authorName=e}get creationTimeAsSecondsAgo(){return this._creationTimeAsSecondsAgo}set creationTimeAsSecondsAgo(e){this._creationTimeAsSecondsAgo=e}get header(){return this._header}set header(e){this._header=e}get lastMessageId(){return this._lastMessageId}set lastMessageId(e){this._lastMessageId=e}get lastUserId(){return this._lastUserId}set lastUserId(e){this._lastUserId=e}get lastUserName(){return this._lastUserName}set lastUserName(e){this._lastUserName=e}get totalMessages(){return this._totalMessages}set totalMessages(e){this._totalMessages=e}get unreadMessagesCount(){return this._unreadMessagesCount}set unreadMessagesCount(e){this._unreadMessagesCount=e}get state(){return this._state}set state(e){this._state=e}get adminId(){return this._adminId}set adminId(e){this._adminId=e}get adminName(){return this._adminName}set adminName(e){this._adminName=e}get isPinned(){return this._isPinned}set isPinned(e){this._isPinned=e}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}}class xB{flush(){return this._groupId=-1,this._startIndex=-1,this._amount=0,this._threads=[],!0}parse(e){if(!e)return!1;this._groupId=e.readInt(),this._startIndex=e.readInt(),this._amount=e.readInt(),this._threads=[];let t=0;for(;t<this._amount;)this._threads.push(su.parse(e)),t++;return!0}get groupId(){return this._groupId}get startIndex(){return this._startIndex}get amount(){return this._amount}get threads(){return this._threads}}class ru{static parse(e){const t=new ru;return t._messageId=e.readInt(),t._messageIndex=e.readInt(),t._authorId=e.readInt(),t._authorName=e.readString(),t._authorFigure=e.readString(),t._creationTime=e.readInt(),t._messageText=e.readString(),t._state=e.readByte(),t._adminId=e.readInt(),t._adminName=e.readString(),t._adminOperationTimeAsSeccondsAgo=e.readInt(),t._authorPostCount=e.readInt(),t}get state(){return this._state}set state(e){this._state=e}get adminId(){return this._adminId}set adminId(e){this._adminId=e}get adminName(){return this._adminName}set adminName(e){this._adminName=e}get adminOperationTimeAsSeccondsAgo(){return this._adminOperationTimeAsSeccondsAgo}set adminOperationTimeAsSeccondsAgo(e){this._adminOperationTimeAsSeccondsAgo=e}get messageId(){return this._messageId}set messageId(e){this._messageId=e}get creationTime(){return this._creationTime}set creationTime(e){this._creationTime=e}get authorName(){return this._authorName}set authorName(e){this._authorName=e}get authorFigure(){return this._authorFigure}set authorFigure(e){this._authorFigure=e}get threadId(){return this._threadId}set threadId(e){this._threadId=e}get messageIndex(){return this._messageIndex}set messageIndex(e){this._messageIndex=e}set groupID(e){this._groupId=e}get groupId(){return this._groupId}get authorId(){return this._authorId}set authorId(e){this._authorId=e}get messageText(){return this._messageText}set messageText(e){this._messageText=e}get authorPostCount(){return this._authorPostCount}set authorPostCount(e){this._authorPostCount=e}}class wB{flush(){return this._groupId=-1,this._threadId=-1,this._message=null,!0}parse(e){return e?(this._groupId=e.readInt(),this._threadId=e.readInt(),this._message=ru.parse(e),!0):!1}get groupId(){return this._groupId}get threadId(){return this._threadId}get message(){return this._message}}class GB{flush(){return this._groupId=-1,this._thread=null,!0}parse(e){return e?(this._groupId=e.readInt(),this._thread=su.parse(e),!0):!1}get groupId(){return this._groupId}get thread(){return this._thread}}class BB{flush(){return this._groupId=-1,this._threadId=-1,this._startIndex=-1,this._amount=0,this._messages=[],!0}parse(e){if(!e)return!1;this._groupId=e.readInt(),this._threadId=e.readInt(),this._startIndex=e.readInt(),this._amount=e.readInt(),this._messages=[];let t=0;for(;t<this._amount;){const s=ru.parse(e);s.groupID=this._groupId,s.threadId=this._threadId,this._messages.push(s),t++}return!0}get groupId(){return this._groupId}get threadId(){return this._threadId}get startIndex(){return this._startIndex}get amount(){return this._amount}get messages(){return this._messages}}class kB{flush(){return this._count=0,!0}parse(e){return e?(this._count=e.readInt(),!0):!1}get count(){return this._count}}class VB{flush(){return this._groupId=-1,this._threadId=-1,this._message=null,!0}parse(e){return e?(this._groupId=e.readInt(),this._threadId=e.readInt(),this._message=ru.parse(e),!0):!1}get groupId(){return this._groupId}get threadId(){return this._threadId}get message(){return this._message}}class HB{flush(){return this._groupId=-1,this._thread=null,!0}parse(e){return e?(this._groupId=e.readInt(),this._thread=su.parse(e),!0):!1}get groupId(){return this._groupId}get thread(){return this._thread}}class jB{constructor(){this._encryptedPublicKey=null,this._serverClientEncryption=!1}flush(){return!0}parse(e){return e?(this._encryptedPublicKey=e.readString(),e.bytesAvailable&&(this._serverClientEncryption=e.readBoolean()),!0):!1}get encryptedPublicKey(){return this._encryptedPublicKey}get serverClientEncryption(){return this._serverClientEncryption}}class WB{flush(){return this._reason=-1,!0}parse(e){return e?(this._reason=0,e.bytesAvailable&&(this._reason=e.readInt()),!0):!1}get reason(){return this._reason}}class YB{flush(){return this._accounts&&(this._accounts=new Map),!0}parse(e){if(!e)return!1;this._accounts=new Map;let t=e.readInt();for(;t>0;)this._accounts.set(e.readInt(),e.readString()),t--;return!0}get accounts(){return this._accounts}}class zB{flush(){return!0}parse(e){return e?(this._encryptedPrime=e.readString(),this._encryptedGenerator=e.readString(),!0):!1}get encryptedPrime(){return this._encryptedPrime}get encryptedGenerator(){return this._encryptedGenerator}}class KB{flush(){return this._noobnessLevel=0,!0}parse(e){return e?(this._noobnessLevel=e.readInt(),!0):!1}get noobnessLevel(){return this._noobnessLevel}}class XB{flush(){return!0}parse(e){return e?(this._infoUrl=e.readString(),!0):!1}get infoUrl(){return this._infoUrl}}class qB{flush(){return!0}parse(e){return!0}}class QB{flush(){return this._calls=[],!0}parse(e){this._calls=[];const t=e.readInt();for(let s=0;s<t;s++){const r=e.readString(),i=e.readString(),a=e.readString();this._calls.push({callId:r,timeStamp:i,message:a})}return!0}get pendingCalls(){return this._calls}get count(){return this._calls.length}}class JB{flush(){return this._message=null,!0}parse(e){return this._message=e.readString(),!0}get message(){return this._message}}class ZB{flush(){return this._resultType=0,this._messageText=null,!0}parse(e){return e?(this._resultType=e.readInt(),this._messageText=e.readString(),!0):!1}get resultType(){return this._resultType}get messageText(){return this._messageText}}class $B{flush(){return!0}parse(e){return!0}}class ek{flush(){return this._acceptanceTimeout=-1,!0}parse(e){return this._acceptanceTimeout=e.readInt(),!0}get acceptanceTimeout(){return this._acceptanceTimeout}}class tk{flush(){return this._winningVoteCode=-1,this._ownVoteCode=-1,this._finalStatus=null,!0}parse(e){this._finalStatus=[],this._winningVoteCode=e.readInt(),this._ownVoteCode=e.readInt();const t=e.readInt();for(let s=0;s<t;s++)this._finalStatus.push(e.readInt());return!0}get winningVoteCode(){return this._winningVoteCode}get ownVoteCode(){return this._ownVoteCode}get finalStatus(){return this._finalStatus}}class sk{flush(){return!0}parse(e){return this._votingTimeout=e.readInt(),this._chatRecord=e.readString(),!0}get votingTimeout(){return this._votingTimeout}get chatRecord(){return this._chatRecord}}class vo{flush(){return this._status=null,!0}parse(e){this._status=[];const t=e.readInt();for(let s=0;s<t;s++)this._status.push(e.readInt());return!0}get status(){return this._status}}vo.AWAITING_VOTE=0;vo.VOTED_OK=1;vo.VOTED_BAD=2;vo.VOTED_VERY_BAD=3;vo.NO_VOTE=4;vo.FINDING_NEW_VOTER=5;class rk{flush(){return this._onDuty=!1,this._guidesOnDuty=0,this._helpersOnDuty=0,this._guardiansOnDuty=0,!0}parse(e){return e?(this._onDuty=e.readBoolean(),this._guidesOnDuty=e.readInt(),this._helpersOnDuty=e.readInt(),this._guardiansOnDuty=e.readInt(),!0):!1}get onDuty(){return this._onDuty}get guidesOnDuty(){return this._guidesOnDuty}get helpersOnDuty(){return this._helpersOnDuty}get guardiansOnDuty(){return this._guardiansOnDuty}}class ik{constructor(e,t,s,r,i,a,l){this._type=e,this._secondsAgo=t,this._isGuide=s,this._otherPartyName=r,this._otherPartyFigure=i,this._description=a,this._roomName=l}get type(){return this._type}set type(e){this._type=e}get secondsAgo(){return this._secondsAgo}set secondsAgo(e){this._secondsAgo=e}get isGuide(){return this._isGuide}set isGuide(e){this._isGuide=e}get otherPartyName(){return this._otherPartyName}set otherPartyName(e){this._otherPartyName=e}get otherPartyFigure(){return this._otherPartyFigure}set otherPartyFigure(e){this._otherPartyFigure=e}get description(){return this._description}set description(e){this._description=e}get roomName(){return this._roomName}set roomName(e){this._roomName=e}}class iu{flush(){return this._statusCode=0,this._pendingTicket=null,!0}parse(e){return e?(this._statusCode=e.readInt(),this._pendingTicket=new ik(e.readInt(),e.readInt(),e.readBoolean(),e.readString(),e.readString(),e.readString(),e.readString()),!0):!1}get statusCode(){return this._statusCode}get pendingTicket(){return this._pendingTicket}}iu.GUIDE_REPORTING_STATUS_OK=0;iu.GUIDE_REPORTING_STATUS_PENDING_TICKET=1;iu.GUIDE_REPORTING_STATUS_ABUSIVE=2;iu.GUIDE_REPORTING_STATUS_REPORTING_TOO_QUICKLY=3;class nk{flush(){return this._asGuide=!1,this._helpRequestType=0,this._helpRequestDescription=null,this._roleSpecificWaitTime=0,!0}parse(e){return e?(this._asGuide=e.readBoolean(),this._helpRequestType=e.readInt(),this._helpRequestDescription=e.readString(),this._roleSpecificWaitTime=e.readInt(),!0):!1}get asGuide(){return this._asGuide}get helpRequestType(){return this._helpRequestType}get helpRequestDescription(){return this._helpRequestDescription}get roleSpecificWaitTime(){return this._roleSpecificWaitTime}}class ak{flush(){return!0}parse(e){return!!e}}class ok{flush(){return this._endReason=0,!0}parse(e){return e?(this._endReason=e.readInt(),!0):!1}get endReason(){return this._endReason}}class Hl{flush(){return this._errorCode=0,!0}parse(e){return e?(this._errorCode=e.readInt(),!0):!1}get errorCode(){return this._errorCode}}Hl.ERROR_GENERIC=0;Hl.ERROR_GUIDES_REJECT=1;Hl.ERROR_NOT_ENOUGH_GUIDES=2;Hl.ERROR_NOT_ENOUGH_VOTES=3;Hl.ERROR_NO_CHATLOG_FOUND=4;class lk{flush(){return this._roomId=0,this._roomName=null,!0}parse(e){return e?(this._roomId=e.readInt(),this._roomName=e.readString(),!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}}class ck{flush(){return this._chatMessage=null,this._senderId=0,!0}parse(e){return e?(this._chatMessage=e.readString(),this._senderId=e.readInt(),!0):!1}get chatMessage(){return this._chatMessage}get senderId(){return this._senderId}}class uk{flush(){return this._isTyping=!1,!0}parse(e){return e?(this._isTyping=e.readBoolean(),!0):!1}get isTyping(){return this._isTyping}}class hk{flush(){return this._requesterRoomId=0,!0}parse(e){return e?(this._requesterRoomId=e.readInt(),!0):!1}get requesterRoomId(){return this._requesterRoomId}}class dk{flush(){return this._requesterUserId=0,this._requesterName=null,this._requesterFigure=null,this._guideUserId=0,this._guideName=null,this._guideFigure=null,!0}parse(e){return e?(this._requesterUserId=e.readInt(),this._requesterName=e.readString(),this._requesterFigure=e.readString(),this._guideUserId=e.readInt(),this._guideName=e.readString(),this._guideFigure=e.readString(),!0):!1}get requesterUserId(){return this._requesterUserId}get requesterName(){return this._requesterName}get requesterFigure(){return this._requesterFigure}get guideUserId(){return this._guideUserId}get guideName(){return this._guideName}get guideFigure(){return this._guideFigure}}class nu{flush(){return this._result=0,!0}parse(e){return e?(this._result=e.readInt(),!0):!1}get result(){return this._result}}nu.CREATION_RESULT_OK=0;nu.CREATION_RESULT_UNABLE_TO_REPORT=1;nu.CREATION_RESULT_NO_CHATLOG_FOUND=2;nu.CREATION_RESULT_BULLY_ALREADY_REPORTED=3;class vd{flush(){return this._resolution=0,!0}parse(e){return e?(this._resolution=e.readInt(),!0):!1}get resolution(){return this._resolution}}vd.RESOLUTION_GUARDIANS_TOOK_ACTION=0;vd.RESOLUTION_FORWARDED_TO_MODERATORS=1;vd.RESOLUTION_REPORTER_IS_ABUSIVE=2;class _k{flush(){return!0}parse(e){return!!e}}class gk{flush(){return this._closeReason=0,this._messageText="",!0}parse(e){return e?(this._closeReason=e.readInt(),this._messageText=e.readString(),!0):!1}get closeReason(){return this._closeReason}get messageText(){return this._messageText}}class fk{flush(){return this._quizCode=null,this._questionIds=[],!0}parse(e){if(!e)return!1;this._quizCode=e.readString();const t=e.readInt();this._questionIds=[];for(let s=0;s<t;s++)this._questionIds.push(e.readInt());return!0}get quizCode(){return this._quizCode}get questionIds(){return this._questionIds}}class mk{flush(){return this._quizCode=null,this._questionIdsForWrongAnswers=[],!0}parse(e){if(!e)return!1;this._quizCode=e.readString();const t=e.readInt();this._questionIdsForWrongAnswers=[];for(let s=0;s<t;s++)this._questionIdsForWrongAnswers.push(e.readInt());return!0}get quizCode(){return this._quizCode}get questionIdsForWrongAnswers(){return this._questionIdsForWrongAnswers}}class bd{constructor(e){this._id=e.readInt(),this._title=e.readString(),this._bodyText=e.readString(),this._buttonText=e.readString(),this._linkType=e.readInt(),this._linkContent=e.readString(),this._imageUrl=e.readString()}get id(){return this._id}get title(){return this._title}get bodyText(){return this._bodyText}get buttonText(){return this._buttonText}get linkType(){return this._linkType}get linkContent(){return this._linkContent}get imageUrl(){return this._imageUrl}}bd.LINK_TYPE_URL=0;bd.LINK_TYPE_INTERNAL=1;bd.LINK_TYPE_NO_LINK=2;class Ek{flush(){return this._articles=[],!0}parse(e){if(!e)return!1;const t=e.readInt();for(let s=0;s<t;s++)this._articles.push(new bd(e));return!0}get articles(){return this._articles}}class pk{flush(){return!0}parse(e){return e?(this._acknowledged=e.readBoolean(),!0):!1}get acknowledged(){return this._acknowledged}}class Ik{flush(){return this._newOfferId=-1,this._newPrice=0,this._requestedOfferId=-1,!0}parse(e){return e?(this._result=e.readInt(),this._newOfferId=e.readInt(),this._newPrice=e.readInt(),this._requestedOfferId=e.readInt(),!0):!1}get result(){return this._result}get offerId(){return this._newOfferId}get newPrice(){return this._newPrice}get requestedOfferId(){return this._requestedOfferId}}class Tk{flush(){return this._offerId=0,this._success=!1,!0}parse(e){return e?(this._offerId=e.readInt(),this._success=e.readBoolean(),!0):!1}get offerId(){return this._offerId}get success(){return this._success}}class Rk{flush(){return this._tokenCount=0,this._result=0,!0}parse(e){return e?(this._result=e.readInt(),this._tokenCount=e.readInt(),!0):!1}get tokenCount(){return this._tokenCount}get resultCode(){return this._result}}class Ok{flush(){return this._enabled=!1,this._commission=0,this._credits=0,this._advertisements=0,this._maximumPrice=0,this._minimumPrice=0,this._offerTime=0,this._displayTime=0,!0}parse(e){return e?(this._enabled=e.readBoolean(),this._commission=e.readInt(),this._credits=e.readInt(),this._advertisements=e.readInt(),this._minimumPrice=e.readInt(),this._maximumPrice=e.readInt(),this._offerTime=e.readInt(),this._displayTime=e.readInt(),!0):!1}get enabled(){return this._enabled}get commission(){return this._commission}get credits(){return this._credits}get advertisements(){return this._advertisements}get minimumPrice(){return this._minimumPrice}get maximumPrice(){return this._maximumPrice}get offerTime(){return this._offerTime}get displayTime(){return this._displayTime}}class Sk{flush(){return this._result=0,!0}parse(e){return e?(this._result=e.readInt(),!0):!1}get result(){return this._result}}class Ck{flush(){return this._averagePrice=0,this._currentOfferCount=0,this._historyLength=0,this._dayOffsets=[],this._averagePrices=[],this._soldAmounts=[],this._furniTypeId=0,this._furniCategoryId=0,!0}parse(e){if(!e)return!1;this._averagePrice=e.readInt(),this._currentOfferCount=e.readInt(),this._historyLength=e.readInt();let t=e.readInt();for(;t>0;)this._dayOffsets.push(e.readInt()),this._averagePrices.push(e.readInt()),this._soldAmounts.push(e.readInt()),t--;return this._furniCategoryId=e.readInt(),this._furniTypeId=e.readInt(),!0}get averagePrice(){return this._averagePrice}get offerCount(){return this._currentOfferCount}get historyLength(){return this._historyLength}get dayOffsets(){return this._dayOffsets}get averagePrices(){return this._averagePrices}get soldAmounts(){return this._soldAmounts}get furniTypeId(){return this._furniTypeId}get furniCategoryId(){return this._furniCategoryId}}class wO{constructor(e,t,s,r,i,a,l,c,u,h=-1){this._timeLeftMinutes=-1,this._offerId=e,this._furniId=t,this._furniType=s,this._extraData=r,this._stuffData=i,this._price=a,this._status=l,this._timeLeftMinutes=c,this._averagePrice=u,this._offerCount=h}get offerId(){return this._offerId}get furniId(){return this._furniId}get furniType(){return this._furniType}get extraData(){return this._extraData}get stuffData(){return this._stuffData}get price(){return this._price}get status(){return this._status}get timeLeftMinutes(){return this._timeLeftMinutes}get averagePrice(){return this._averagePrice}get offerCount(){return this._offerCount}get isUniqueLimitedItem(){return this.stuffData!=null&&this.stuffData.uniqueSeries>0}}const Pd=class _c{constructor(){this.MAX_LIST_LENGTH=500}flush(){return this._offers=[],this._totalItemsFound=0,!0}parse(e){if(!e)return!1;const t=e.readInt();let s=0;for(;s<t;){const r=e.readInt(),i=e.readInt();let a=e.readInt(),l=-1,c="",u=null;a===_c.FURNITYPE_STUFF?(l=e.readInt(),u=ka.parseObjectData(e)):a===_c.FURNITYPE_WALL?(l=e.readInt(),c=e.readString()):a==_c.FAKE_FURNITYPE_UNIQUE&&(l=e.readInt(),u=un.getData(Br.FORMAT_KEY),u.uniqueNumber=e.readInt(),u.uniqueSeries=e.readInt(),a=_c.FURNITYPE_STUFF);const h=e.readInt(),d=e.readInt(),f=e.readInt(),E=e.readInt(),m=new wO(r,l,a,c,u,h,i,d,f,E);s<this.MAX_LIST_LENGTH&&this._offers.push(m),s++}return this._totalItemsFound=e.readInt(),!0}get offers(){return this._offers}get totalItemsFound(){return this._totalItemsFound}};Pd.FURNITYPE_STUFF=1;Pd.FURNITYPE_WALL=2;Pd.FAKE_FURNITYPE_UNIQUE=3;let Ak=Pd;const GO=class BO{flush(){return this._offers=[],!0}parse(e){if(!e)return!1;this._offers=[],this._creditsWaiting=e.readInt();const t=e.readInt();for(let s=0;s<t;s++){const r=e.readInt(),i=e.readInt();let a=e.readInt(),l,c,u;a==1?(l=e.readInt(),u=this.getStuffData(e)):a==2?(l=e.readInt(),c=e.readString()):a==3&&(l=e.readInt(),u=un.getData(Br.FORMAT_KEY),u.uniqueNumber=e.readInt(),u.uniqueSeries=e.readInt(),a=1);const h=e.readInt(),d=e.readInt(),f=e.readInt(),E=new wO(r,l,a,c,u,h,i,d,f);s<BO.MAX_LIST_LENGTH&&this._offers.push(E)}return!0}get offers(){return this._offers}get creditsWaiting(){return this._creditsWaiting}getStuffData(e){const t=e.readInt(),s=un.getData(t);return s.parseWrapper(e),s}};GO.MAX_LIST_LENGTH=500;let Nk=GO;class yk{constructor(e,t,s,r,i){this._timestamp=e,this._habboId=t,this._username=s,this._message=r,this._hasHighlighting=i}get timestamp(){return this._timestamp}get userId(){return this._habboId}get userName(){return this._username}get message(){return this._message}get hasHighlighting(){return this._hasHighlighting}}class In{constructor(e){this._context=new Map,this._chatlog=[],this._recordType=e.readByte();const t=e.readShort();for(let r=0;r<t;r++){const i=e.readString(),a=e.readByte();switch(a){case 0:this._context.set(i,e.readBoolean());break;case 1:this._context.set(i,e.readInt());break;case 2:this._context.set(i,e.readString());break;default:throw new Error("Unknown data type "+a)}}const s=e.readShort();for(let r=0;r<s;r++){const i=e.readString(),a=e.readInt(),l=e.readString(),c=e.readString(),u=e.readBoolean();this._chatlog.push(new yk(i,a,l,c,u))}}get recordType(){return this._recordType}get context(){return this._context}get chatlog(){return this._chatlog}get roomId(){return this.getInt("roomId")}get roomName(){return this._context.get("roomName")}get groupId(){return this.getInt("groupId")}get threadId(){return this.getInt("threadId")}get messageId(){return this.getInt("messageId")}getInt(e){const t=this._context.get(e);return t||0}}In.TYPE_SIMPLE=0;In.TYPE_ROOM_CHAT=1;In.TYPE_IM_SESSION=2;In.TYPE_DISCUSSION_THREAD=3;In.TYPE_DISCUSSION_MESSAGE=4;In.TYPE_SELFIE=5;In.TYPE_PHOTO=6;class Mk{constructor(e){this._issueId=e.readInt(),this._callerUserId=e.readInt(),this._reportedUserId=e.readInt(),this._chatRecordId=e.readInt(),this._chatRecord=new In(e)}get issueId(){return this._issueId}get callerUserId(){return this._callerUserId}get reportedUserId(){return this._reportedUserId}get chatRecordId(){return this._chatRecordId}get chatRecord(){return this._chatRecord}}class Dk{flush(){return this._data=null,!0}parse(e){return e?(this._data=new Mk(e),!0):!1}get data(){return this._data}}class vk{flush(){return!0}parse(e){return this._issueId=parseInt(e.readString()),!0}get issueId(){return this._issueId}}class La{constructor(e,t,s,r,i,a,l,c,u,h,d,f,E,m,R,I){this._disposed=!1,this._issueId=e,this._state=t,this._categoryId=s,this._reportedCategoryId=r,this._issueAgeInMilliseconds=i,this._priority=a,this._groupingId=l,this._reporterUserId=c,this._reporterUserName=u,this._reportedUserId=h,this._reportedUserName=d,this._pickerUserId=f,this._pickerUserName=E,this._message=m,this._chatRecordId=R,this._patterns=I,this._creationTimeInMilliseconds=ve()}get issueId(){return this._issueId}get state(){return this._state}get categoryId(){return this._categoryId}get reportedCategoryId(){return this._reportedCategoryId}get issueAgeInMilliseconds(){return this._issueAgeInMilliseconds}get priority(){return this._priority}get groupingId(){return this._groupingId}get reporterUserId(){return this._reporterUserId}get reporterUserName(){return this._reporterUserName}get reportedUserId(){return this._reportedUserId}get reportedUserName(){return this._reportedUserName}get pickerUserId(){return this._pickerUserId}get pickerUserName(){return this._pickerUserName}get message(){return this._message}get chatRecordId(){return this._chatRecordId}get patterns(){return this._patterns}dispose(){if(!this.disposed){for(const e of this._patterns)e.dispose();this._patterns=[],this._disposed=!0}}get disposed(){return this._disposed}getOpenTime(e){const s=(this._issueAgeInMilliseconds+e-this._creationTimeInMilliseconds)/1e3/60,r=s%60,i=s/60,a=(r<10?"0":"")+r;return(i<10?"0":"")+i+":"+a}}La.STATE_OPEN=1;La.STATE_PICKED=2;La.STATE_CLOSED=3;class bk{constructor(e){this._disposed=!1,this._pattern=e.readString(),this._startIndex=e.readInt(),this._endIndex=e.readInt()}dispose(){this._disposed=!0,this._pattern="",this._startIndex=-1,this._endIndex=-1}get disposed(){return this._disposed}get pattern(){return this._pattern}get startIndex(){return this._startIndex}get endIndex(){return this._endIndex}}class kO{get issueData(){return this._issueData}flush(){return this._issueData=null,!0}parse(e){const t=e.readInt(),s=e.readInt(),r=e.readInt(),i=e.readInt(),a=e.readInt(),l=e.readInt(),c=e.readInt(),u=e.readInt(),h=e.readString(),d=e.readInt(),f=e.readString(),E=e.readInt(),m=e.readString(),R=e.readString(),I=e.readInt(),S=e.readInt(),A=[];for(let N=0;N<S;N++)A.push(new bk(e));return this._issueData=new La(t,s,r,i,a,l,c,u,h,d,f,E,m,R,I,A),!0}}class Pk{flush(){return this._issues=null,!0}parse(e){this._issues=[];const t=e.readInt();for(let s=0;s<t;s++){const r=e.readInt(),i=e.readInt(),a=e.readString(),l=new La(r,0,0,0,0,0,0,0,null,0,null,i,a,null,0,[]);this._issues.push(l)}return this._retryEnabled=e.readBoolean(),this._retryCount=e.readInt(),!0}get issues(){return this._issues}get retryEnabled(){return this._retryEnabled}get retryCount(){return this._retryCount}}class Lk{flush(){return this._message="",this._url=null,!0}parse(e){return e?(this._message=e.readString(),this._url=e.readString(),!0):!1}get message(){return this._message}get url(){return this._url}}class Uk{flush(){return this._userId=-1,this._success=!1,!0}parse(e){return this._userId=e.readInt(),this._success=e.readBoolean(),!0}get userId(){return this._userId}get success(){return this._success}}class Fk{constructor(e){this._disposed=!1;const t=new kO;this._issues=[],this._messageTemplates=[],this._roomMessageTemplates=[];let s=e.readInt(),r=0;for(;r<s;)t.parse(e)&&this._issues.push(t.issueData),r++;for(s=e.readInt(),r=0;r<s;)this._messageTemplates.push(e.readString()),r++;for(s=e.readInt(),r=0;r<s;)e.readString(),r++;for(this._cfhPermission=e.readBoolean(),this._chatlogsPermission=e.readBoolean(),this._alertPermission=e.readBoolean(),this._kickPermission=e.readBoolean(),this._banPermission=e.readBoolean(),this._roomAlertPermission=e.readBoolean(),this._roomKickPermission=e.readBoolean(),s=e.readInt(),r=0;r<s;)this._roomMessageTemplates.push(e.readString()),r++}dispose(){this._disposed||(this._disposed=!0,this._messageTemplates=null,this._roomMessageTemplates=null,this._issues=null)}get disposed(){return this._disposed}get messageTemplates(){return this._messageTemplates}get roomMessageTemplates(){return this._roomMessageTemplates}get issues(){return this._issues}get cfhPermission(){return this._cfhPermission}get chatlogsPermission(){return this._chatlogsPermission}get alertPermission(){return this._alertPermission}get kickPermission(){return this._kickPermission}get banPermission(){return this._banPermission}get roomAlertPermission(){return this._roomAlertPermission}get roomKickPermission(){return this._roomKickPermission}}class xk{constructor(){this._data=null}flush(){return this._data=null,!0}parse(e){return this._data=new Fk(e),!0}get data(){return this._data}}class wk{flush(){return this._message="",this._url="",!0}parse(e){return e?(this._message=e.readString(),this._url=e.readString(),!0):!1}get message(){return this._message}get url(){return this._url}}class Gk{constructor(e){if(this._tags=[],this._exists=e.readBoolean(),!this.exists)return;this._name=e.readString(),this._desc=e.readString();const t=e.readInt();for(let s=0;s<t;s++)this._tags.push(e.readString())}get name(){return this._name}get desc(){return this._desc}get tags(){return this._tags}get exists(){return this._exists}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._tags=null)}}class Bk{constructor(e){this._flatId=e.readInt(),this._userCount=e.readInt(),this._ownerInRoom=e.readBoolean(),this._ownerId=e.readInt(),this._ownerName=e.readString(),this._room=new Gk(e)}get flatId(){return this._flatId}get userCount(){return this._userCount}get ownerInRoom(){return this._ownerInRoom}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get room(){return this._room}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this._room!=null&&(this._room.dispose(),this._room=null))}}class kk{flush(){return this._data=null,!0}parse(e){return e?(this._data=new Bk(e),!0):!1}get data(){return this._data}}class Vk{flush(){return this._windowX=0,this._windowY=0,this._windowWidth=0,this._windowHeight=0,!0}parse(e){return this._windowX=e.readInt(),this._windowY=e.readInt(),this._windowWidth=e.readInt(),this._windowHeight=e.readInt(),!0}get windowX(){return this._windowX}get windowY(){return this._windowY}get windowWidth(){return this._windowWidth}get windowHeight(){return this._windowHeight}}class Hk{constructor(e){this._lastSanctionTime="",this._sanctionAgeHours=0,this._userId=e.readInt(),this._userName=e.readString(),this._figure=e.readString(),this._registrationAgeInMinutes=e.readInt(),this._minutesSinceLastLogin=e.readInt(),this._online=e.readBoolean(),this._cfhCount=e.readInt(),this._abusiveCfhCount=e.readInt(),this._cautionCount=e.readInt(),this._banCount=e.readInt(),this._tradingLockCount=e.readInt(),this._tradingExpiryDate=e.readString(),this._lastPurchaseDate=e.readString(),this._identityId=e.readInt(),this._identityRelatedBanCount=e.readInt(),this._primaryEmailAddress=e.readString(),this._userClassification=e.readString(),e.bytesAvailable&&(this._lastSanctionTime=e.readString(),this._sanctionAgeHours=e.readInt())}get userId(){return this._userId}get userName(){return this._userName}get figure(){return this._figure}get registrationAgeInMinutes(){return this._registrationAgeInMinutes}get minutesSinceLastLogin(){return this._minutesSinceLastLogin}get online(){return this._online}get cfhCount(){return this._cfhCount}get abusiveCfhCount(){return this._abusiveCfhCount}get cautionCount(){return this._cautionCount}get banCount(){return this._banCount}get tradingLockCount(){return this._tradingLockCount}get tradingExpiryDate(){return this._tradingExpiryDate}get lastPurchaseDate(){return this._lastPurchaseDate}get identityId(){return this._identityId}get identityRelatedBanCount(){return this._identityRelatedBanCount}get primaryEmailAddress(){return this._primaryEmailAddress}get userClassification(){return this._userClassification}get lastSanctionTime(){return this._lastSanctionTime}get sanctionAgeHours(){return this._sanctionAgeHours}}class jk{flush(){return this._data=null,!0}parse(e){return e?(this._data=new Hk(e),!0):!1}get data(){return this._data}}class Wk{flush(){return this._data=null,!0}parse(e){return e?(this._data=new In(e),!0):!1}get data(){return this._data}}class Yk{constructor(e){this._roomId=e.readInt(),this._roomName=e.readString(),this._enterHour=e.readInt(),this._enterMinute=e.readInt()}get roomId(){return this._roomId}get roomName(){return this._roomName}get enterHour(){return this._enterHour}get enterMinute(){return this._enterMinute}}class zk{constructor(e){this._rooms=[],this._userId=e.readInt(),this._userName=e.readString();const t=e.readInt();let s=0;for(;s<t;)this._rooms.push(new Yk(e)),s++}get userId(){return this._userId}get userName(){return this._userName}get rooms(){return this._rooms}}class Kk{flush(){return!0}parse(e){return this._data=new zk(e),!0}get data(){return this._data}}class Xk{flush(){return this._message="",!0}parse(e){return e?(this._message=e.readString(),!0):!1}get message(){return this._message}}class qk{constructor(e){this._roomChatlogs=[],this._userId=e.readInt(),this._username=e.readString();const t=e.readInt();for(let s=0;s<t;s++)this._roomChatlogs.push(new In(e))}get userId(){return this._userId}get username(){return this._username}get roomChatlogs(){return this._roomChatlogs}}class Qk{flush(){return this._data=null,!0}parse(e){return e?(this._data=new qk(e),!0):!1}get data(){return this._data}}class Jk{flush(){return!0}parse(e){return!!e}}class Zk{flush(){return!0}parse(e){return e?(this._contentType=e.readString(),this._classId=e.readInt(),!0):!1}get contentType(){return this._contentType}get classId(){return this._classId}}class $k{flush(){return this._boxColor=null,this._keyColor=null,!0}parse(e){return e?(this._boxColor=e.readString(),this._keyColor=e.readString(),!0):!1}get boxColor(){return this._boxColor}get keyColor(){return this._keyColor}}class eV{flush(){return!0}parse(e){return!!e}}class tV{flush(){return this._canCreate=!1,this._errorCode=0,!0}parse(e){return e?(this._canCreate=e.readBoolean(),this._errorCode=e.readInt(),!0):!1}get canCreate(){return this._canCreate}get errorCode(){return this._errorCode}}class ym{flush(){return!0}parse(e){return e?(this._resultCode=e.readInt(),this._roomLimit=e.readInt(),!0):!1}get resultCode(){return this._resultCode}get roomLimit(){return this._roomLimit}}ym.CREATION_ALLOWED=0;ym.ROOM_LIMIT_REACHED=1;class sV{constructor(e){this._categoryToCurrentUserCountMap=new Map,this._categoryToMaxUserCountMap=new Map;const t=e.readInt();for(let s=0;s<t;s++){const r=e.readInt(),i=e.readInt(),a=e.readInt();this._categoryToCurrentUserCountMap.set(r,i),this._categoryToMaxUserCountMap.set(r,a)}}get categoryToCurrentUserCountMap(){return this._categoryToCurrentUserCountMap}get categoryToMaxUserCountMap(){return this._categoryToMaxUserCountMap}}class rV{constructor(e,t=0,s=0){this._goalId=t,this._pageIndex=s,e&&(this._goalId=e.readInt(),this._pageIndex=e.readInt(),this._pageCount=e.readInt())}get goalId(){return this._goalId}get pageIndex(){return this._pageIndex}get pageCount(){return this._pageCount}}const Ld=class gc{constructor(e){this._index=e.readInt(),this._popupCaption=e.readString(),this._popupDesc=e.readString(),this._showDetails=e.readInt()==1,this._picText=e.readString(),this._picRef=e.readString(),this._folderId=e.readInt(),this._userCount=e.readInt(),this._type=e.readInt(),this._type==gc.TYPE_TAG?this._tag=e.readString():this._type==gc.TYPE_GUEST_ROOM?this._guestRoomData=new Ft(e):this._open=e.readBoolean()}dispose(){this._disposed||(this._disposed=!0,this._guestRoomData!=null&&(this._guestRoomData.flush(),this._guestRoomData=null))}get disposed(){return this._disposed}get type(){return this._type}get index(){return this._index}get popupCaption(){return this._popupCaption}get popupDesc(){return this._popupDesc}get showDetails(){return this._showDetails}get picText(){return this._picText}get picRef(){return this._picRef}get folderId(){return this._folderId}get tag(){return this._tag}get userCount(){return this._userCount}get guestRoomData(){return this._guestRoomData}get open(){return this._open}toggleOpen(){this._open=!this._open}get maxUsers(){return this.type==gc.TYPE_TAG?0:this.type==gc.TYPE_GUEST_ROOM?this._guestRoomData.maxUserCount:0}};Ld.TYPE_TAG=1;Ld.TYPE_GUEST_ROOM=2;Ld.TYPE_FOLDER=4;let iV=Ld;class nV{constructor(e){this._rooms=[],this._searchType=e.readInt(),this._searchParam=e.readString();const t=e.readInt();for(let r=0;r<t;r++)this._rooms.push(new Ft(e));e.readBoolean()&&(this._ad=new iV(e))}dispose(){if(!this._disposed){if(this._disposed=!0,this._rooms!=null)for(const e of this._rooms)e.flush();this._ad!=null&&(this._ad.dispose(),this._ad=null),this._rooms=null}}get disposed(){return this._disposed}get searchType(){return this._searchType}get searchParam(){return this._searchParam}get rooms(){return this._rooms}get ad(){return this._ad}}class VO{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._id=-1,this._code=null,this._filter=null,this._localization=null,!0}parse(e){return e?(this._id=e.readInt(),this._code=e.readString(),this._filter=e.readString(),this._localization=e.readString(),!0):!1}get id(){return this._id}get code(){return this._code}get filter(){return this._filter}get localization(){return this._localization}}class aV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._code=null,this._data=null,this._action=-1,this._closed=!1,this._mode=-1,this._rooms=[],!0}parse(e){if(!e)return!1;this._code=e.readString(),this._data=e.readString(),this._action=e.readInt(),this._closed=e.readBoolean(),this._mode=e.readInt();let t=e.readInt();for(;t>0;)this._rooms.push(new Ft(e)),t--;return!0}get code(){return this._code}get data(){return this._data}get action(){return this._action}get closed(){return this._closed}get mode(){return this._mode}get rooms(){return this._rooms}}class oV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._code=null,this._data=null,this._results=[],!0}parse(e){if(!e)return!1;this._code=e.readString(),this._data=e.readString();let t=e.readInt();for(;t>0;)this._results.push(new aV(e)),t--;return!0}get code(){return this._code}get data(){return this._data}get results(){return this._results}}class lV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._code=null,this._savedSearches=[],!0}parse(e){if(!e)return!1;this._code=e.readString();let t=e.readInt();for(;t>0;)this._savedSearches.push(new VO(e)),t--;return!0}get code(){return this._code}get savedSearches(){return this._savedSearches}}class cV{constructor(e){this._adId=e.readInt(),this._ownerAvatarId=e.readInt(),this._ownerAvatarName=e.readString(),this._flatId=e.readInt(),this._eventType=e.readInt(),this._eventName=e.readString(),this._eventDescription=e.readString();const t=e.readInt(),s=e.readInt(),r=new Date;let i=r.getTime();const a=t*60*1e3;i=i-a;const l=new Date(i);this._creationTime=l.getDate()+"-"+l.getMonth()+"-"+l.getFullYear()+" "+l.getHours()+":"+l.getMinutes();let c=r.getTime();const u=s*60*1e3;c=c+u,this._expirationDate=new Date(c),this._categoryId=e.readInt()}dispose(){this._disposed||(this._disposed=!0)}get disposed(){return this._disposed}get adId(){return this._adId}get ownerAvatarId(){return this._ownerAvatarId}get ownerAvatarName(){return this._ownerAvatarName}get flatId(){return this._flatId}get categoryId(){return this._categoryId}get eventType(){return this._eventType}get eventName(){return this._eventName}get eventDescription(){return this._eventDescription}get creationTime(){return this._creationTime}get expirationDate(){return this._expirationDate}}class uV{flush(){return!0}parse(e){return e?(this._data=new sV(e),!0):!1}get data(){return this._data}}class hV{flush(){return!0}parse(e){return e?(this._data=new rV(e),!0):!1}get data(){return this._data}}class dV{flush(){return!0}parse(e){return e?(this._globalId=e.readString(),this._convertedId=e.readInt(),!0):!1}get globalId(){return this._globalId}get convertedId(){return this._convertedId}}class _V{flush(){return this._userName=null,!0}parse(e){return e?(this._userName=e.readString(),!0):!1}get userName(){return this._userName}}class gV{flush(){return!0}parse(e){return e?(this._flatId=e.readInt(),this._added=e.readBoolean(),!0):!1}get flatId(){return this._flatId}get added(){return this._added}}class fV{flush(){return!0}parse(e){if(!e)return!1;this._favouriteRoomIds=[],this._limit=e.readInt();const t=e.readInt();for(let s=0;s<t;s++)this._favouriteRoomIds.push(e.readInt());return!0}get limit(){return this._limit}get favoriteRoomIds(){return this._favouriteRoomIds}}class mV{flush(){return this._userName=null,!0}parse(e){return e?(this._userName=e.readString(),!0):!1}get userName(){return this._userName}}class EV{flush(){return this._roomId=-1,this._roomName=null,!0}parse(e){return e?(this._roomId=e.readInt(),this._roomName=e.readString(),!0):!1}get roomId(){return this._roomId}get roomName(){return this._roomName}}class pV{flush(){return this._roomEnter=!1,this._roomForward=!1,this._data=null,this._staffPick=!1,this._isGroupMember=!1,this._moderation=null,this._chat=null,!0}parse(e){return e?(this._roomEnter=e.readBoolean(),this._data=new Ft(e),this._roomForward=e.readBoolean(),this._staffPick=e.readBoolean(),this._isGroupMember=e.readBoolean(),this.data.allInRoomMuted=e.readBoolean(),this._moderation=new ar(e),this.data.canMute=e.readBoolean(),this._chat=new dt(e),!0):!1}get roomEnter(){return this._roomEnter}get roomForward(){return this._roomForward}get data(){return this._data}get staffPick(){return this._staffPick}get isGroupMember(){return this._isGroupMember}get moderation(){return this._moderation}get chat(){return this._chat}}class IV{flush(){return!0}parse(e){return e?(this._data=new nV(e),!0):!1}get data(){return this._data}}class TV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._id=-1,this._name=null,this._visible=!1,this._automatic=!1,this._automaticCategoryKey=null,this._globalCategoryKey=null,this._staffOnly=!1,!0}parse(e){return e?(this._id=e.readInt(),this._name=e.readString(),this._visible=e.readBoolean(),this._automatic=e.readBoolean(),this._automaticCategoryKey=e.readString(),this._globalCategoryKey=e.readString(),this._staffOnly=e.readBoolean(),!0):!1}get id(){return this._id}get name(){return this._name}get visible(){return this._visible}get automatic(){return this._automatic}get automaticCategoryKey(){return this._automaticCategoryKey}get globalCategoryKey(){return this._globalCategoryKey}get staffOnly(){return this._staffOnly}}class RV{flush(){return this._categories=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._categories.push(e.readString()),t--;return!0}get categories(){return this._categories}}class OV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._id=-1,this._name=null,this._visible=!1,!0}parse(e){return e?(this._id=e.readInt(),this._name=e.readString(),this._visible=e.readBoolean(),!0):!1}get id(){return this._id}get name(){return this._name}get visible(){return this._visible}}class SV{flush(){return this._homeRoomId=-1,this._roomIdToEnter=-1,!0}parse(e){return e?(this._homeRoomId=e.readInt(),this._roomIdToEnter=e.readInt(),!0):!1}get homeRoomId(){return this._homeRoomId}get roomIdToEnter(){return this._roomIdToEnter}}class CV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._roomId=-1,this._areaId=-1,this._image=null,this._caption=null,!0}parse(e){return e?(this._roomId=e.readInt(),this._areaId=e.readInt(),this._image=e.readString(),this._caption=e.readString(),!0):!1}get roomId(){return this._roomId}get areaId(){return this._areaId}get image(){return this._image}get caption(){return this._caption}}class AV{flush(){return this._rooms=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._rooms.push(new CV(e)),t--;return!0}get rooms(){return this._rooms}}class NV{flush(){return this._topLevelContexts=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._topLevelContexts.push(new lV(e)),t--;return!0}get topLevelContexts(){return this._topLevelContexts}}class yV{flush(){return!0}parse(e){return!!e}}class MV{flush(){return this._searches=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._searches.push(new VO(e)),t--;return!0}get searches(){return this._searches}}class DV{flush(){return this._result=null,!0}parse(e){return e?(this._result=new oV(e),!0):!1}get result(){return this._result}}class vV{flush(){return this._windowX=0,this._windowY=0,this._windowWidth=0,this._windowHeight=0,this._leftPanelHidden=!1,this._resultsMode=0,!0}parse(e){return e?(this._windowX=e.readInt(),this._windowY=e.readInt(),this._windowWidth=e.readInt(),this._windowHeight=e.readInt(),this._leftPanelHidden=e.readBoolean(),this._resultsMode=e.readInt(),!0):!1}get windowX(){return this._windowX}get windowY(){return this._windowY}get windowWidth(){return this._windowWidth}get windowHeight(){return this._windowHeight}get leftPanelHidden(){return this._leftPanelHidden}get resultsMode(){return this._resultsMode}}class bV{constructor(e){this._tagName=e.readString(),this._userCount=e.readInt()}get tagName(){return this._tagName}get userCount(){return this._userCount}}class PV{constructor(e){if(!e)throw new Error("invalid_wrapper");this.flush(),this.parse(e)}flush(){return this._tags=[],!0}parse(e){if(!e)return!1;this._tags=[];const t=e.readInt();let s=0;for(;s<t;)this._tags.push(new bV(e)),s++;return!0}get tags(){return this._tags}}class LV{flush(){return this._data=null,!0}parse(e){return e?(this._data=new PV(e),!0):!1}get data(){return this._data}}class UV{flush(){return!0}parse(e){return!0}}class FV{flush(){return!0}parse(e){return this._data=new cV(e),!0}get data(){return this._data}}class xV{flush(){return this._words=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._words.push(e.readString()),t--;return!0}get words(){return this._words}}class wV{flush(){return this._roomId=0,!0}parse(e){return e?(this._roomId=e.readInt(),!0):!1}get roomId(){return this._roomId}}class GV{flush(){return!0}parse(e){return this._flatId=e.readInt(),this._resultCode=e.readInt(),!0}get flatId(){return this._flatId}get resultCode(){return this._resultCode}}class BV{flush(){return this._categories=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._categories.push(new OV(e)),t--;return!0}get categories(){return this._categories}}class kV{flush(){return this._categories=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._categories.push(new TV(e)),t--;return!0}get categories(){return this._categories}}class VV{constructor(e){this._badgeCode="",this._removedBadgeCode="",this._type=e.readInt(),this._level=e.readInt(),this._badgeId=e.readInt(),this._badgeCode=e.readString(),this._points=e.readInt(),this._levelRewardPoints=e.readInt(),this._levelRewardPointType=e.readInt(),this._bonusPoints=e.readInt(),this._achievementID=e.readInt(),this._removedBadgeCode=e.readString(),this._category=e.readString(),this._showDialogToUser=e.readBoolean()}get type(){return this._type}get level(){return this._level}get points(){return this._points}get levelRewardPoints(){return this._levelRewardPoints}get levelRewardPointType(){return this._levelRewardPointType}get bonusPoints(){return this._bonusPoints}get badgeId(){return this._badgeId}get badgeCode(){return this._badgeCode}get removedBadgeCode(){return this._removedBadgeCode}get achievementID(){return this._achievementID}get category(){return this._category}get showDialogToUser(){return this._showDialogToUser}}class HV{flush(){return this._data=null,!0}parse(e){return e?(this._data=new VV(e),!0):!1}get data(){return this._data}}class jV{flush(){return this._amount=0,this._amountChanged=0,this._type=-1,!0}parse(e){return e?(this._amount=e.readInt(),this._amountChanged=e.readInt(),this._type=e.readInt(),!0):!1}get amount(){return this._amount}get amountChanged(){return this._amountChanged}get type(){return this._type}}class WV{flush(){return this._errorCode=-1,!0}parse(e){return e?(this._errorCode=e.readInt(),!0):!1}get errorCode(){return this._errorCode}}class YV{flush(){return this._numGifts=0,!0}parse(e){return e?(this._numGifts=e.readInt(),!0):!1}get numGifts(){return this._numGifts}}class zV{flush(){return this._errorCode=0,this._messageId=0,this._timestamp=null,!0}parse(e){return e?(this._messageId=e.readInt(),this._errorCode=e.readInt(),this._timestamp=e.readString(),!0):!1}get errorCode(){return this._errorCode}get messageId(){return this._messageId}get timestamp(){return this._timestamp}}class KV{flush(){return this._key=null,!0}parse(e){return e?(this._key=e.readString(),!0):!1}get key(){return this._key}}class XV{flush(){return this._message=null,!0}parse(e){return e?(this._message=e.readString(),!0):!1}get message(){return this._message}}class qV{flush(){return this._enabled=!1,!0}parse(e){return e?(this._enabled=e.readBoolean(),!0):!1}get enabled(){return this._enabled}}class QV{flush(){return this._messages=[],!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;)this._messages.push(e.readString()),t--;return!0}get messages(){return this._messages}}class JV{flush(){return this._type=null,this._parameters=new Map,!0}parse(e){if(!e)return!1;this._type=e.readString();let t=e.readInt();for(;t>0;)this._parameters.set(e.readString(),e.readString()),t--;return!0}get type(){return this._type}get parameters(){return this._parameters}}class ZV{flush(){return this._contentType=null,this._classId=0,this._name=null,this._description=null,!0}parse(e){return e?(this._contentType=e.readString(),this._classId=e.readInt(),this._name=e.readString(),this._description=e.readString(),!0):!1}get contentType(){return this._contentType}get classId(){return this._classId}get name(){return this._name}get description(){return this._description}}class $V{flush(){return this._petId=-1,this._petName=null,this._level=0,this._figureData=null,!0}parse(e){return e?(this._petId=e.readInt(),this._petName=e.readString(),this._level=e.readInt(),this._figureData=new Rm(e),!0):!1}get petId(){return this._petId}get petName(){return this._petName}get level(){return this._level}get figureData(){return this._figureData}}class eH{flush(){return this._errorCode=-1,!0}parse(e){return e?(this._errorCode=e.readInt(),!0):!1}get errorCode(){return this._errorCode}}class tH{flush(){return!0}parse(e){return!0}}class sH{flush(){return this._alertMessage=null,!0}parse(e){return e?(this._alertMessage=e.readString(),e.bytesAvailable&&(this._titleMessage=e.readString()),!0):!1}get alertMessage(){return this._alertMessage}get titleMessage(){return this._titleMessage}}class rH{flush(){return this._items=new Zt,!0}parse(e){if(!e)return!1;let t=e.readInt();for(;t>0;){const s=e.readInt();let r=e.readInt();const i=[];for(;r>0;)i.push(e.readInt()),r--;this._items.add(s,i),t--}return!0}getItemsByCategory(e){return this._items.getValue(e)}get categories(){return this._items.getKeys()}}class iH{constructor(e,t,s){this._code=e,this._errorMessage=t,this._isAllowed=s}get code(){return this._code}get errorMessage(){return this._errorMessage}get isAllowed(){return this._isAllowed}}class nH{flush(){return this._perks=[],!0}parse(e){if(!e)return!1;this._perks=[];const t=e.readInt();for(let s=0;s<t;s++)this._perks.push(new iH(e.readString(),e.readString(),e.readBoolean()));return!0}isAllowed(e){let t=!1;for(const s of this._perks)if(s.code===e){t=s.isAllowed;break}return t}get perks(){return this._perks}}class aH{flush(){return this._objectId=-1,this._figureData=null,!0}parse(e){return this._objectId=e.readInt(),e.bytesAvailable&&(this._figureData=new gn(e.readString())),!0}get objectId(){return this._objectId}get figureData(){return this._figureData}}class oH{flush(){return this._objectId=0,this._nameValidationStatus=0,this._nameValidationInfo=null,!0}parse(e){return this._objectId=e.readInt(),this._nameValidationStatus=e.readInt(),this._nameValidationInfo=e.readString(),!0}get objectId(){return this._objectId}get nameValidationStatus(){return this._nameValidationStatus}get nameValidationInfo(){return this._nameValidationInfo}}class lH{flush(){return this._roomIndex=-1,this._petId=-1,this._level=-1,!0}parse(e){return this._roomIndex=e.readInt(),this._petId=e.readInt(),this._level=e.readInt(),!0}get roomIndex(){return this._roomIndex}get petId(){return this._petId}get level(){return this._level}}class cH{flush(){return this._currentAge=-1,this._requiredAge=-1,!0}parse(e){return this._currentAge=e.readInt(),this._requiredAge=e.readInt(),!0}get currentAge(){return this._currentAge}get requiredAge(){return this._requiredAge}}class uH{flush(){return this._petId=-1,this._commands=[],this._enabledCommands=[],!0}parse(e){this._petId=e.readInt();let t=e.readInt();for(;t>0;)this._commands.push(e.readInt()),t--;let s=e.readInt();for(;s>0;)this._enabledCommands.push(e.readInt()),s--;return!0}get petId(){return this._petId}get commands(){return this._commands}get enabledCommands(){return this._enabledCommands}}class hH{constructor(e,t,s){this._value=e,this._choiceText=t,this._choiceType=s}get value(){return this._value}set value(e){this._value=e}get choiceText(){return this._choiceText}set choiceText(e){this._choiceText=e}get choiceType(){return this._choiceType}set choiceType(e){this._choiceType=e}}class dH{constructor(){this._children=[],this._questionChoices=[]}get questionId(){return this._questionId}set questionId(e){this._questionId=e}get questionType(){return this._questionType}set questionType(e){this._questionType=e}get sortOrder(){return this._sortOrder}set sortOrder(e){this._sortOrder=e}get questionText(){return this._questionText}set questionText(e){this._questionText=e}get questionCategory(){return this._questionCategory}set questionCategory(e){this._questionCategory=e}get questionAnswerType(){return this._questionAnswerType}set questionAnswerType(e){this._questionAnswerType=e}get questionAnswerCount(){return this._questionAnswerCount}set questionAnswerCount(e){this._questionAnswerCount=e}get children(){return this._children}set children(e){this._children=e}get questionChoices(){return this._questionChoices}set questionChoices(e){this._questionChoices=e}}class _H{constructor(){this._id=-1,this._startMessage="",this._endMessage="",this._numQuestions=0,this._questionArray=[],this._npsPoll=!1}flush(){return this._id=-1,this._startMessage="",this._endMessage="",this._numQuestions=0,this._questionArray=[],!0}parse(e){this._id=e.readInt(),this._startMessage=e.readString(),this._endMessage=e.readString(),this._numQuestions=e.readInt();for(let t=0;t<this._numQuestions;t++){const s=this.parsePollQuestion(e),r=e.readInt();for(let i=0;i<r;i++)s.children.push(this.parsePollQuestion(e));this._questionArray.push(s)}return this._npsPoll=e.readBoolean(),!0}parsePollQuestion(e){const t=new dH;if(t.questionId=e.readInt(),t.sortOrder=e.readInt(),t.questionType=e.readInt(),t.questionText=e.readString(),t.questionCategory=e.readInt(),t.questionAnswerType=e.readInt(),t.questionAnswerCount=e.readInt(),t.questionType==1||t.questionType==2)for(let s=0;s<t.questionAnswerCount;s++)t.questionChoices.push(new hH(e.readString(),e.readString(),e.readInt()));return t}get id(){return this._id}get startMessage(){return this._startMessage}get endMessage(){return this._endMessage}get numQuestions(){return this._numQuestions}get questionArray(){return this._questionArray}get npsPoll(){return this._npsPoll}}class gH{flush(){throw!0}parse(e){return!0}}class fH{constructor(){this._id=-1,this._type="",this._headline="",this._summary=""}flush(){return this._id=-1,this._type="",this._summary="",!0}parse(e){return this._id=e.readInt(),this._type=e.readString(),this._headline=e.readString(),this._summary=e.readString(),!0}get id(){return this._id}get type(){return this._type}get headline(){return this._headline}get summary(){return this._summary}}class mH{flush(){return this._userId=-1,this._value="",this._answerCounts=null,!0}parse(e){this._userId=e.readInt(),this._value=e.readString(),this._answerCounts=new Map;const t=e.readInt();for(let s=0;s<t;s++){const r=e.readString(),i=e.readInt();this._answerCounts.set(r,i)}return!0}get userId(){return this._userId}get value(){return this._value}get answerCounts(){return this._answerCounts}}class EH{flush(){return this._questionId=-1,this._answerCounts=null,!0}parse(e){this._questionId=e.readInt(),this._answerCounts=new Map;const t=e.readInt();for(let s=0;s<t;s++){const r=e.readString(),i=e.readInt();this._answerCounts.set(r,i)}return!0}get questionId(){return this._questionId}get answerCounts(){return this._answerCounts}}class pH{constructor(){this._pollType=null,this._pollId=-1,this._questionId=-1,this._duration=-1,this._question=null}flush(){return this._pollType=null,this._pollId=-1,this._questionId=-1,this._duration=-1,this._question=null,!0}parse(e){this._pollType=e.readString(),this._pollId=e.readInt(),this._questionId=e.readInt(),this._duration=e.readInt();const t=e.readInt(),s=e.readInt(),r=e.readInt(),i=e.readString();if(this._question={id:t,number:s,type:r,content:i},this._question.type==1||this._question.type==2){this._question.selection_min=e.readInt();const a=e.readInt();this._question.selections=[],this._question.selection_values=[],this._question.selection_count=a,this._question.selection_max=a;for(let l=0;l<a;l++)this._question.selection_values.push(e.readString()),this._question.selections.push(e.readString())}return!0}get pollType(){return this._pollType}get pollId(){return this._pollId}get questionId(){return this._questionId}get duration(){return this._duration}get question(){return this._question}}class IH{flush(){return this._question=null,this._choices=[],this._SafeStr_7651=[],this._SafeStr_7654=-1,!0}parse(e){this._question=e.readString(),this._choices=[],this._SafeStr_7651=[];let t=e.readInt();for(;t>0;)this._choices.push(e.readString()),this._SafeStr_7651.push(e.readInt()),t--;return this._SafeStr_7654=e.readInt(),!0}get question(){return this._question}get choices(){return this._choices}get SafeStr_7651(){return this._SafeStr_7651}get SafeStr_7654(){return this._SafeStr_7654}}class TH{flush(){return this._question=null,this._choices=[],!0}parse(e){this._question=e.readString(),this._choices=[];const t=e.readInt();let s=0;for(;s<t;)this._choices.push(e.readString()),s++;return!0}get question(){return this._question}get choices(){return this._choices.slice()}}class RH{constructor(e){this._rewardUserLimits=[],this._hasGoalExpired=e.readBoolean(),this._personalContributionScore=e.readInt(),this._personalContributionRank=e.readInt(),this._communityTotalScore=e.readInt(),this._communityHighestAchievedLevel=e.readInt(),this._scoreRemainingUntilNextLevel=e.readInt(),this._percentCompletionTowardsNextLevel=e.readInt(),this._goalCode=e.readString(),this._timeRemainingInSeconds=e.readInt();const t=e.readInt();for(let s=0;s<t;s++)this._rewardUserLimits.push(e.readInt())}dispose(){this._rewardUserLimits=null}get disposed(){return this._rewardUserLimits==null}get hasGoalExpired(){return this._hasGoalExpired}get personalContributionScore(){return this._personalContributionScore}get personalContributionRank(){return this._personalContributionRank}get communityTotalScore(){return this._communityTotalScore}get communityHighestAchievedLevel(){return this._communityHighestAchievedLevel}get scoreRemainingUntilNextLevel(){return this._scoreRemainingUntilNextLevel}get percentCompletionTowardsNextLevel(){return this._percentCompletionTowardsNextLevel}get timeRemainingInSeconds(){return this._timeRemainingInSeconds}get rewardUserLimits(){return this._rewardUserLimits}get goalCode(){return this._goalCode}}class OH{constructor(e){this._communityGoalId=e.readInt(),this._communityGoalCode=e.readString(),this._userRank=e.readInt(),this._rewardCode=e.readString(),this._badge=e.readBoolean(),this._localizedName=e.readString()}get communityGoalId(){return this._communityGoalId}get communityGoalCode(){return this._communityGoalCode}get userRank(){return this._userRank}get rewardCode(){return this._rewardCode}get badge(){return this._badge}get localizedName(){return this._localizedName}}class SH{flush(){return this._prizes=[],!0}parse(e){if(!e)return!1;const t=e.readInt();for(let s=0;s<t;s++)this._prizes.push(new OH(e));return!0}get prizes(){return this._prizes}}class CH{constructor(e){this._userId=e.readInt(),this._userName=e.readString(),this._figure=e.readString(),this._rank=e.readInt(),this._currentScore=e.readInt()}get userId(){return this._userId}get userName(){return this._userName}get figure(){return this._figure}get rank(){return this._rank}get currentScore(){return this._currentScore}}class AH{constructor(e){this._hof=[],this._goalCode=e.readString();const t=e.readInt();for(let s=0;s<t;s++)this._hof.push(new CH(e))}dispose(){this._hof=null}get disposed(){return this._hof==null}get hof(){return this._hof}get goalCode(){return this._goalCode}}class NH{flush(){return this._data=null,!0}parse(e){return e?(this._data=new AH(e),!0):!1}get data(){return this._data}}class yH{flush(){return this._data=null,!0}parse(e){return e?(this._data=new RH(e),!0):!1}get data(){return this._data}}class MH{flush(){return this._state=-1,this._userCount=-1,this._userCountGoal=-1,!0}parse(e){return e?(this._state=e.readInt(),this._userCount=e.readInt(),this._userCountGoal=e.readInt(),!0):!1}get state(){return this._state}get userCount(){return this._userCount}get userCountGoal(){return this._userCountGoal}}class DH{flush(){return this._imageUri="",!0}parse(e){return e?(this._imageUri=e.readString(),!0):!1}get imageUri(){return this._imageUri}}class vH{flush(){return!0}parse(e){return e?(this._expired=e.readBoolean(),!0):!1}get expired(){return this._expired}}class bo{constructor(e){this._receiveTime=new Date,this._campaignCode=e.readString(),this._completedQuestsInCampaign=e.readInt(),this._questCountInCampaign=e.readInt(),this._activityPointType=e.readInt(),this._id=e.readInt(),this._accepted=e.readBoolean(),this._type=e.readString(),this._imageVersion=e.readString(),this._rewardCurrencyAmount=e.readInt(),this._localizationCode=e.readString(),this._completedSteps=e.readInt(),this._totalSteps=e.readInt(),this._sortOrder=e.readInt(),this._catalogPageName=e.readString(),this._chainCode=e.readString(),this._easy=e.readBoolean()}static getCampaignLocalizationKeyForCode(e){return"quests."+e}get campaignCode(){return this._campaignCode}get localizationCode(){return this._localizationCode}get completedQuestsInCampaign(){return this._completedQuestsInCampaign}get questCountInCampaign(){return this._questCountInCampaign}get activityPointType(){return this._activityPointType}set accepted(e){this._accepted=e}get accepted(){return this._accepted}set id(e){this._id=e}get id(){return this._id}get type(){return this._type}get imageVersion(){return this._imageVersion}get rewardCurrencyAmount(){return this._rewardCurrencyAmount}get completedSteps(){return this._completedSteps}get totalSteps(){return this._totalSteps}get isCompleted(){return this._completedSteps==this._totalSteps}set waitPeriodSeconds(e){this._waitPeriodSeconds=e}get waitPeriodSeconds(){if(this._waitPeriodSeconds<1)return 0;const t=new Date().getTime()-this._receiveTime.getTime();return Math.max(0,this._waitPeriodSeconds-Math.floor(t/1e3))}getCampaignLocalizationKey(){return bo.getCampaignLocalizationKeyForCode(this.campaignCode)}getQuestLocalizationKey(){return this.getCampaignLocalizationKey()+"."+this._localizationCode}get completedCampaign(){return this._id<1}get lastQuestInCampaign(){return this._completedQuestsInCampaign>=this._questCountInCampaign}get receiveTime(){return this._receiveTime}get sortOrder(){return this._sortOrder}get catalogPageName(){return this._catalogPageName}get chainCode(){return this._chainCode}get easy(){return this._easy}}class bH{flush(){return this._questData=null,!0}parse(e){return e?(this._questData=new bo(e),this._showDialog=e.readBoolean(),!0):!1}get questData(){return this._questData}get showDialog(){return this._showDialog}}class PH{flush(){return this._quest=null,!0}parse(e){return e?(e.readBoolean()&&(this._quest=new bo(e),this._easyQuestCount=e.readInt(),this._hardQuestCount=e.readInt()),!0):!1}get quest(){return this._quest}get easyQuestCount(){return this._easyQuestCount}get hardQuestCount(){return this._hardQuestCount}}class LH{flush(){return this._quest=null,!0}parse(e){return e?(this._quest=new bo(e),!0):!1}get quest(){return this._quest}}class UH{flush(){return this._quests=[],!0}parse(e){if(!e)return!1;const t=e.readInt();for(let s=0;s<t;s++)this._quests.push(new bo(e));return this._openWindow=e.readBoolean(),!0}get quests(){return this._quests}get openWindow(){return this._openWindow}}class FH{flush(){return this._quests=[],!0}parse(e){if(!e)return!1;const t=e.readInt();for(let s=0;s<t;s++)this._quests.push(new bo(e));return!0}get quests(){return this._quests}}class xH{flush(){return this._recyclerFinishedStatus=-1,this._prizeId=0,!0}parse(e){return e?(this._recyclerFinishedStatus=e.readInt(),this._prizeId=e.readInt(),!0):!1}get recyclerFinishedStatus(){return this._recyclerFinishedStatus}get prizeId(){return this._prizeId}}class wH{flush(){return this._recyclerStatus=-1,this._recyclerTimeoutSeconds=0,!0}parse(e){return e?(this._recyclerStatus=e.readInt(),this._recyclerTimeoutSeconds=e.readInt(),!0):!1}get recyclerStatus(){return this._recyclerStatus}get recyclerTimeoutSeconds(){return this._recyclerTimeoutSeconds}}class Mm{constructor(e){this._stuffIds=[],this._intParams=[],this._stuffTypeSelectionEnabled=e.readBoolean(),this._furniLimit=e.readInt();let t=e.readInt();for(;t>0;)this._stuffIds.push(e.readInt()),t--;for(this._stuffTypeId=e.readInt(),this._id=e.readInt(),this._stringParam=e.readString(),t=e.readInt();t>0;)this._intParams.push(e.readInt()),t--;this._stuffTypeSelectionCode=e.readInt()}getBoolean(e){return this._intParams[e]===1}get stuffTypeSelectionEnabled(){return this._stuffTypeSelectionEnabled}get stuffTypeSelectionCode(){return this._stuffTypeSelectionCode}set stuffTypeSelectionCode(e){this._stuffTypeSelectionCode=e}get maximumItemSelectionCount(){return this._furniLimit}get selectedItems(){return this._stuffIds}get id(){return this._id}get stringData(){return this._stringParam}get intData(){return this._intParams}get code(){return 0}get spriteId(){return this._stuffTypeId}}class Dm extends Mm{constructor(e){super(e),this._type=e.readInt()}get type(){return this._type}get code(){return this._type}}class vm extends Mm{constructor(e){super(e),this._conflictingActions=[],this._triggerConf=e.readInt();let t=e.readInt();for(;t>0;)this._conflictingActions.push(e.readInt()),t--}get code(){return this._triggerConf}get conflictingActions(){return this._conflictingActions}}class bm extends Mm{constructor(e){super(e),this._conflictingTriggers=[],this._type=e.readInt(),this._delayInPulses=e.readInt();let t=e.readInt();for(;t>0;)this._conflictingTriggers.push(e.readInt()),t--}get type(){return this._type}get code(){return this._type}get delayInPulses(){return this._delayInPulses}get conflictingTriggers(){return this._conflictingTriggers}}class GH{flush(){return this._definition=null,!0}parse(e){return e?(this._definition=new bm(e),!0):!1}get definition(){return this._definition}}class BH{flush(){return this._definition=null,!0}parse(e){return e?(this._definition=new Dm(e),!0):!1}get definition(){return this._definition}}class kH{flush(){return this._definition=null,!0}parse(e){return e?(this._definition=new vm(e),!0):!1}get definition(){return this._definition}}class VH{flush(){return this._stuffId=0,!0}parse(e){return e?(this._stuffId=e.readInt(),!0):!1}get stuffId(){return this._stuffId}}class HH{flush(){return this._reason=0,!0}parse(e){return e?(this._reason=e.readInt(),!0):!1}get reason(){return this._reason}}class jH{flush(){return!0}parse(e){return!!e}}class WH{flush(){return this._info=null,!0}parse(e){return e?(this._info=e.readString(),!0):!1}get info(){return this._info}}class YH{flush(){return!0}parse(e){return!!e}}class zH{flush(){return!0}parse(e){return!0}}class KH{constructor(){this._songDisks=new Zt}flush(){return this._songDisks.reset(),this._maxLength=0,!0}parse(e){this._maxLength=e.readInt();const t=e.readInt();for(let s=0;s<t;s++)this._songDisks.add(e.readInt(),e.readInt());return!0}get songDisks(){return this._songDisks}get maxLength(){return this._maxLength}}class XH{flush(){return this._currentSongId=-1,this._currentPosition=-1,this._nextSongId=-1,this._nextPosition=-1,this._syncCount=-1,!0}parse(e){return this._currentSongId=e.readInt(),this._currentPosition=e.readInt(),this._nextSongId=e.readInt(),this._nextPosition=e.readInt(),this._syncCount=e.readInt(),!0}get currentSongId(){return this._currentSongId}get currentPosition(){return this._currentPosition}get nextSongId(){return this._nextSongId}get nextPosition(){return this._nextPosition}get syncCount(){return this._syncCount}}class qH{flush(){return this._songId=0,this._officialSongId="",!0}parse(e){return this._officialSongId=e.readString(),this._songId=e.readInt(),!0}get songId(){return this._songId}get officialSongId(){return this._officialSongId}}class Ud{constructor(e,t,s,r){this._startPlayHead=0,this._id=e,this._length=t,this._name=s,this._creator=r}get id(){return this._id}get length(){return this._length}get name(){return this._name}get creator(){return this._creator}get startPlayHeadPos(){return this._startPlayHead}set startPlayHeadPos(e){this._startPlayHead=e}}class QH{flush(){return this._synchronizationCount=-1,this._playlist=[],!0}parse(e){this._synchronizationCount=e.readInt();const t=e.readInt();for(let s=0;s<t;s++)this._playlist.push(new Ud(e.readInt(),e.readInt(),e.readString(),e.readString()));return!0}get synchronizationCount(){return this._synchronizationCount}get playList(){return this._playlist}}class JH{flush(){return this._entry=null,!0}parse(e){return this._entry=new Ud(e.readInt(),e.readInt(),e.readString(),e.readString()),!0}get entry(){return this._entry}}class ZH extends Ud{constructor(e,t,s,r,i){super(e,t,s,r),this._data="",this._data=i}get data(){return this._data}}class $H{flush(){return this._songs=[],!0}parse(e){const t=e.readInt();for(let s=0;s<t;s++){const r=e.readInt();e.readString();const i=e.readString(),a=e.readString(),l=e.readInt(),c=e.readString(),u=new ZH(r,l,i,c,a);this._songs.push(u)}return!0}get songs(){return this._songs}}class e2{constructor(){this._songDiskInventory=new Zt}flush(){return this._songDiskInventory.reset(),!0}parse(e){const t=e.readInt();for(let s=0;s<t;s++)this._songDiskInventory.add(e.readInt(),e.readInt());return!0}getDiskId(e){return e>=0&&e<this._songDiskInventory.length?this._songDiskInventory.getKey(e):-1}getSongId(e){return e>=0&&e<this._songDiskInventory.length?this._songDiskInventory.getWithIndex(e):-1}get songDiskCount(){return this._songDiskInventory.length}}class t2{flush(){return this._talentTrackName=null,this._level=-1,this._rewardPerks=[],this._rewardProducts=[],!0}parse(e){if(!e)return!1;let t=0;this._talentTrackName=e.readString(),this._level=e.readInt();const s=e.readInt();for(;t<s;)this._rewardPerks.push(new a2(e)),t++;const r=e.readInt();if(t<r)for(let i=0;i<r;i++){const a=e.readString(),l=e.readInt();this._rewardProducts.push(new HO(a,l)),t++}return!0}get talentTrackName(){return this._talentTrackName}get level(){return this._level}get rewardPerks(){return this._rewardPerks}get rewardProducts(){return this._rewardProducts}}class s2{constructor(e,t,s,r,i){this._level=e,this._state=t,this._tasks=s,this._rewardPerks=r,this._rewardProducts=i}get level(){return this._level}get state(){return this._state}get tasks(){return this._tasks}get perks(){return this._rewardPerks}get items(){return this._rewardProducts}}class r2{flush(){return this._talentTrackName=null,this._level=-1,this._maxLevel=-1,!0}parse(e){return e?(this._talentTrackName=e.readString(),this._level=e.readInt(),this._maxLevel=e.readInt(),!0):!1}get talentTrackName(){return this._talentTrackName}get level(){return this._level}get maxLevel(){return this._maxLevel}}class HO{constructor(e,t){this._productCode=e,this._vipDays=t}get productCode(){return this._productCode}get vipDays(){return this._vipDays}}class i2{constructor(e,t,s,r,i,a){this._id=e,this._requiredLevel=t,this._badgeCode=s,this._state=r,this._currentScore=i,this._totalScore=a}get id(){return this._id}get requiredLevel(){return this._requiredLevel}get badgeCode(){return this._badgeCode}get state(){return this._state}get currentScore(){return this._currentScore}get totalScore(){return this._totalScore}}class n2{flush(){return this._type=null,this._levels=null,!0}parse(e){if(!e)return!1;this._type=e.readString(),this._levels=[];const t=e.readInt();for(let s=0;s<t;s++){const r=e.readInt(),i=e.readInt(),a=[],l=e.readInt();for(let f=0;f<l;f++){const E=e.readInt(),m=e.readInt(),R=e.readString(),I=e.readInt(),S=e.readInt(),A=e.readInt();a.push(new i2(E,m,R,I,S,A))}const c=[],u=e.readInt();for(let f=0;f<u;f++)c.push(e.readString());const h=[],d=e.readInt();for(let f=0;f<d;f++){const E=e.readString(),m=e.readInt();h.push(new HO(E,m))}this._levels.push(new s2(r,i,a,c,h))}return!0}get type(){return this._type}get levels(){return this._levels}}class a2{constructor(e){this._perkId=e.readInt()}get perkId(){return this._perkId}}class o2{flush(){return this._classifiedUsersNames&&(this._classifiedUsersNames=new Map),this._classifiedUsersClass&&(this._classifiedUsersClass=new Map),!0}parse(e){if(!e)return!1;let t,s,r,i=e.readInt();for(this._classifiedUsersNames=new Map,this._classifiedUsersClass=new Map;i>0;)t=e.readInt(),s=e.readString(),r=e.readString(),this._classifiedUsersNames.set(t,s),this._classifiedUsersClass.set(t,r),i--;return!0}get classifiedUsernameMap(){return this._classifiedUsersNames}get classifiedUserTypeMap(){return this._classifiedUsersClass}}class l2 extends v{constructor(e){super(e,nF)}getParser(){return this.parser}}class c2 extends v{constructor(e){super(e,aF)}getParser(){return this.parser}}class jO extends v{constructor(e){super(e,oF)}getParser(){return this.parser}}class u2 extends v{constructor(e){super(e,lF)}getParser(){return this.parser}}class WO extends v{constructor(e){super(e,cF)}getParser(){return this.parser}}class YO extends v{constructor(e){super(e,uF)}getParser(){return this.parser}}class zO extends v{constructor(e){super(e,hF)}getParser(){return this.parser}}class KO extends v{constructor(e){super(e,dF)}getParser(){return this.parser}}class ji extends v{constructor(e){super(e,_F)}getParser(){return this.parser}}ji.NAME_OK=0;ji.ERROR_NAME_REQUIRED=1;ji.ERROR_NAME_TOO_SHORT=2;ji.ERROR_NAME_TOO_LONG=3;ji.ERROR_NAME_NOT_VALID=4;ji.ERROR_NAME_IN_USE=5;ji.ERROR_NAME_CHANGE_NOT_ALLOWED=6;ji.ERROR_MERGE_HOTEL_DOWN=7;class XO extends v{constructor(e){super(e,gF)}getParser(){return this.parser}}class Pm extends v{constructor(e){super(e,fF)}getParser(){return this.parser}}class h2 extends v{constructor(e){super(e,EF)}getParser(){return this.parser}}class qO extends v{constructor(e){super(e,pF)}getParser(){return this.parser}}class QO extends v{constructor(e){super(e,IF)}getParser(){return this.parser}}class d2 extends v{constructor(e){super(e,TF)}getParser(){return this.parser}}class JO extends v{constructor(e){super(e,RF)}getParser(){return this.parser}}class ZO extends v{constructor(e){super(e,AF)}getParser(){return this.parser}}class $O extends v{constructor(e){super(e,NF)}getParser(){return this.parser}}class eS extends v{constructor(e){super(e,yF)}getParser(){return this.parser}}class tS extends v{constructor(e){super(e,MF)}getParser(){return this.parser}}class sS extends v{constructor(e){super(e,DF)}getParser(){return this.parser}}class _2 extends v{constructor(e){super(e,vF)}getParser(){return this.parser}}class rS extends v{constructor(e){super(e,bF)}getParser(){return this.parser}}class g2 extends v{constructor(e){super(e,PF)}getParser(){return this.parser}}class iS extends v{constructor(e){super(e,LF)}getParser(){return this.parser}}class f2 extends v{constructor(e){super(e,UF)}getParser(){return this.parser}}class nS extends v{constructor(e){super(e,FF)}getParser(){return this.parser}}class aS extends v{constructor(e){super(e,xF)}getParser(){return this.parser}}class m2 extends v{constructor(e){super(e,wF)}getParser(){return this.parser}}class oS extends v{constructor(e){super(e,GF)}getParser(){return this.parser}}class lS extends v{constructor(e){super(e,BF)}getParser(){return this.parser}}class E2 extends v{constructor(e){super(e,VF)}getParser(){return this.parser}}class p2 extends v{constructor(e){super(e,WF)}getParser(){return this.parser}}class cS extends v{constructor(e){super(e,YF)}getParser(){return this.parser}}class uS extends v{constructor(e){super(e,HF)}getParser(){return this.parser}}class I2 extends v{constructor(e){super(e,zF)}getParser(){return this.parser}}class hS extends v{constructor(e){super(e,KF)}getParser(){return this.parser}}class Lm extends v{constructor(e){super(e,qF)}getParser(){return this.parser}}class dS extends v{constructor(e){super(e,QF)}getParser(){return this.parser}}class T2 extends v{constructor(e){super(e,ZF)}getParser(){return this.parser}}class R2 extends v{constructor(e){super(e,e1)}getParser(){return this.parser}}class _S extends v{constructor(e){super(e,t1)}getParser(){return this.parser}}class gS extends v{constructor(e){super(e,s1)}getParser(){return this.parser}}class O2 extends v{constructor(e){super(e,r1)}getParser(){return this.parser}}class fS extends v{constructor(e){super(e,i1)}getParser(){return this.parser}}class S2 extends v{constructor(e){super(e,n1)}getParser(){return this.parser}}class mS extends v{constructor(e){super(e,a1)}getParser(){return this.parser}}class C2 extends v{constructor(e){super(e,o1)}getParser(){return this.parser}}class A2 extends v{constructor(e){super(e,l1)}getParser(){return this.parser}}class ES extends v{constructor(e){super(e,c1)}getParser(){return this.parser}}class pS extends v{constructor(e){super(e,u1)}getParser(){return this.parser}}class IS extends v{constructor(e){super(e,h1)}getParser(){return this.parser}}class TS extends v{constructor(e){super(e,_1)}getParser(){return this.parser}}class RS extends v{constructor(e){super(e,_G)}getParser(){return this.parser}}class N2 extends v{constructor(e){super(e,gG)}getParser(){return this.parser}}class OS extends v{constructor(e){super(e,mG)}getParser(){return this.parser}}class SS extends v{constructor(e){super(e,IG)}getParser(){return this.parser}}class y2 extends v{constructor(e){super(e,pG)}getParser(){return this.parser}}class CS extends v{constructor(e){super(e,TG)}getParser(){return this.parser}}class AS extends v{constructor(e){super(e,RG)}getParser(){return this.parser}}class NS extends v{constructor(e){super(e,OG)}getParser(){return this.parser}}class M2 extends v{constructor(e){super(e,Va)}getParser(){return this.parser}}class D2 extends v{constructor(e){super(e,SG)}getParser(){return this.parser}}class v2 extends v{constructor(e){super(e,CG)}getParser(){return this.parser}}class b2 extends v{constructor(e){super(e,AG)}getParser(){return this.parser}}class P2 extends v{constructor(e){super(e,NG)}getParser(){return this.parser}}class L2 extends v{constructor(e){super(e,yG)}getParser(){return this.parser}}class yS extends v{constructor(e){super(e,MG)}getParser(){return this.parser}}class MS extends v{constructor(e){super(e,vG)}getParser(){return this.parser}}class DS extends v{constructor(e){super(e,bG)}getParser(){return this.parser}}class vS extends v{constructor(e){super(e,PG)}getParser(){return this.parser}}class Gc extends v{constructor(e){super(e,LG)}getParser(){return this.parser}}class U2 extends v{constructor(e){super(e,FG)}getParser(){return this.parser}}class F2 extends v{constructor(e){super(e,xG)}getParser(){return this.parser}}class x2 extends v{constructor(e){super(e,wG)}getParser(){return this.parser}}class bS extends v{constructor(e){super(e,GG)}getParser(){return this.parser}}class PS extends v{constructor(e){super(e,BG)}getParser(){return this.parser}}class w2 extends v{constructor(e){super(e,kG)}getParser(){return this.parser}}class LS extends v{constructor(e){super(e,VG)}getParser(){return this.parser}}class US extends v{constructor(e){super(e,HG)}getParser(){return this.parser}}class G2 extends v{constructor(e){super(e,jG)}getParser(){return this.parser}}class B2 extends v{constructor(e){super(e,WG)}getParser(){return this.parser}}class FS extends v{constructor(e){super(e,YG)}getParser(){return this.parser}}class k2 extends v{constructor(e){super(e,zG)}getParser(){return this.parser}}class V2 extends v{constructor(e){super(e,KG)}getParser(){return this.parser}}class Um extends v{constructor(e){super(e,XG)}getParser(){return this.parser}}class Fm extends v{constructor(e){super(e,qG)}getParser(){return this.parser}}class xS extends v{constructor(e){super(e,QG)}getParser(){return this.parser}}class xm extends v{constructor(e){super(e,JG)}getParser(){return this.parser}}class H2 extends v{constructor(e){super(e,ZG)}getParser(){return this.parser}}class j2 extends v{constructor(e){super(e,tu)}getParser(){return this.parser}}class W2 extends v{constructor(e){super(e,$G)}getParser(){return this.parser}}class Y2 extends v{constructor(e){super(e,na)}getParser(){return this.parser}}class z2 extends v{constructor(e){super(e,Cm)}getParser(){return this.parser}}class K2 extends v{constructor(e){super(e,eB)}getParser(){return this.parser}}class X2 extends v{constructor(e){super(e,tB)}getParser(){return this.parser}}class q2 extends v{constructor(e){super(e,sB)}getParser(){return this.parser}}class Q2 extends v{constructor(e){super(e,rB)}getParser(){return this.parser}}class J2 extends v{constructor(e){super(e,iB)}getParser(){return this.parser}}class Z2 extends v{constructor(e){super(e,aB)}getParser(){return this.parser}}class $2 extends v{constructor(e){super(e,lB)}getParser(){return this.parser}}class ej extends v{constructor(e){super(e,cB)}getParser(){return this.parser}}class tj extends v{constructor(e){super(e,uB)}getParser(){return this.parser}}class sj extends v{constructor(e){super(e,hB)}getParser(){return this.parser}}class rj extends v{constructor(e){super(e,xO)}getParser(){return this.parser}}class ij extends v{constructor(e){super(e,dB)}getParser(){return this.parser}}class nj extends v{constructor(e){super(e,_B)}getParser(){return this.parser}}class wS extends v{constructor(e){super(e,gB)}getParser(){return this.parser}}class aj extends v{constructor(e){super(e,fB)}getParser(){return this.parser}}class oj extends v{constructor(e){super(e,mB)}getParser(){return this.parser}}class lj extends v{constructor(e){super(e,Dd)}getParser(){return this.parser}}class cj extends v{constructor(e){super(e,Dd)}getParser(){return this.parser}}class uj extends v{constructor(e){super(e,Dd)}getParser(){return this.parser}}class hj extends v{constructor(e){super(e,Dd)}getParser(){return this.parser}}class dj extends v{constructor(e){super(e,pB)}getParser(){return this.parser}}class _j extends v{constructor(e){super(e,IB)}getParser(){return this.parser}}class bh extends v{constructor(e){super(e,TB)}getParser(){return this.parser}}class gj extends v{constructor(e){super(e,RB)}getParser(){return this.parser}}class fj extends v{constructor(e){super(e,OB)}getParser(){return this.parser}}class mj extends v{constructor(e){super(e,SB)}getParser(){return this.parser}}class wm extends v{constructor(e){super(e,CB)}getParser(){return this.parser}}class GS extends v{constructor(e){super(e,AB)}getParser(){return this.parser}}class BS extends v{constructor(e){super(e,NB)}getParser(){return this.parser}}class jl extends v{constructor(e){super(e,yB)}getParser(){return this.parser}}class kS extends v{constructor(e){super(e,vB)}getParser(){return this.parser}}class VS extends v{constructor(e){super(e,bB)}getParser(){return this.parser}}class HS extends v{constructor(e){super(e,PB)}getParser(){return this.parser}}class jS extends v{constructor(e){super(e,LB)}getParser(){return this.parser}}class Ej extends v{constructor(e){super(e,UB)}getParser(){return this.parser}}class pj extends v{constructor(e){super(e,FB)}getParser(){return this.parser}}class Ij extends v{constructor(e){super(e,xB)}getParser(){return this.parser}}class Tj extends v{constructor(e){super(e,wB)}getParser(){return this.parser}}class Rj extends v{constructor(e){super(e,GB)}getParser(){return this.parser}}class Oj extends v{constructor(e){super(e,BB)}getParser(){return this.parser}}class Sj extends v{constructor(e){super(e,kB)}getParser(){return this.parser}}class Cj extends v{constructor(e){super(e,VB)}getParser(){return this.parser}}class Aj extends v{constructor(e){super(e,HB)}getParser(){return this.parser}}class Nj extends v{constructor(e){super(e,jB)}getParser(){return this.parser}}class Ye{}Ye.LOGOUT=0;Ye.JUST_BANNED=1;Ye.CONCURRENT_LOGIN=2;Ye.CONNECTION_LOST_TO_PEER=3;Ye.AVATAR_IDENTITY_CHANGE=4;Ye.REMOVE_FURNITURE_TOOL=5;Ye.STILL_BANNED=10;Ye.DUAL_LOGIN_BY_USERID=11;Ye.HOTEL_CLOSED=12;Ye.DUAL_LOGIN_BY_IP=13;Ye.PEER_CONNECTION_MISSING=16;Ye.NO_LOGIN_PERMISSION=17;Ye.DUPLICATE_CONNECTION=18;Ye.HOTEL_CLOSING=19;Ye.INCORRECT_PASSWORD=20;Ye.INVALID_LOGIN_TICKET=22;Ye.VERSION_CHECK_URL=23;Ye.VERSION_CHECK_PROPERTY=24;Ye.VERSION_CHECK_MACHINE_ID=25;Ye.NO_MESSENGER_SESSION=26;Ye.USER_NOT_FOUND=27;Ye.CRYPTO_NOT_INITIALIZED=28;Ye.DEV_CRYPTO_NOT_ALLOWED=29;Ye.DUPLICATE_UUID_DETECTED=100;Ye.OLD_SESSION_IN_PROXY=101;Ye.PUBLIC_KEY_NOT_NUMERIC=102;Ye.PUBLIC_KEY_TOO_SHORT=103;Ye.SOCKET_READ_GENERIC=104;Ye.SOCKET_READ_FIRST_BYTE=105;Ye.SOCKET_READ_LENGTH=106;Ye.SOCKET_READ_BODY=107;Ye.SOCKET_READ_POLICY=108;Ye.SOCKET_IO_EXCEPTION=109;Ye.SOCKET_WRONG_CRYPTO=110;Ye.PROXY_RUNTIME_EXCEPTION=111;Ye.IDLE_CONNECTION=112;Ye.PONG_TIMEOUT=113;Ye.IDLE_CONNECTION_NOT_AUTH=114;Ye.IDLE_CONNECTION_NO_USER_ID=115;Ye.WRITE_CLOSED_CHANNEL=116;Ye.SOCKET_WRITE_EXCEPTION_1=117;Ye.SOCKET_WRITE_EXCEPTION_2=118;Ye.SOCKET_WRITE_EXCEPTION_3=119;class yj extends v{constructor(e){super(e,WB)}getParser(){return this.parser}get reasonString(){switch(this.getParser().reason){case Ye.JUST_BANNED:case Ye.STILL_BANNED:return"banned";case Ye.CONCURRENT_LOGIN:return"concurrentlogin";case Ye.INCORRECT_PASSWORD:return"incorrectpassword";default:return"logout"}}}class Mj extends v{constructor(e){super(e,YB)}getParser(){return this.parser}}class Dj extends v{constructor(e){super(e,zB)}getParser(){return this.parser}}class WS extends v{constructor(e){super(e,KB)}getParser(){return this.parser}}class YS extends v{constructor(e){super(e,XB)}getParser(){return this.parser}}class zS extends v{constructor(e){super(e,qB)}getParser(){return this.parser}}class KS extends v{constructor(e){super(e,QB)}getParser(){return this.parser}}class XS extends v{constructor(e){super(e,JB)}getParser(){return this.parser}}class qS extends v{constructor(e){super(e,ZB)}getParser(){return this.parser}}class vj extends v{constructor(e){super(e,$B)}getParser(){return this.parser}}class bj extends v{constructor(e){super(e,ek)}getParser(){return this.parser}}class Pj extends v{constructor(e){super(e,tk)}getParser(){return this.parser}}class Lj extends v{constructor(e){super(e,sk)}getParser(){return this.parser}}class Uj extends v{constructor(e){super(e,vo)}getParser(){return this.parser}}class Fj extends v{constructor(e){super(e,rk)}getParser(){return this.parser}}class xj extends v{constructor(e){super(e,iu)}getParser(){return this.parser}}class wj extends v{constructor(e){super(e,nk)}getParser(){return this.parser}}class Gj extends v{constructor(e){super(e,ak)}getParser(){return this.parser}}class QS extends v{constructor(e){super(e,ok)}getParser(){return this.parser}}class JS extends v{constructor(e){super(e,Hl)}getParser(){return this.parser}}class Bj extends v{constructor(e){super(e,lk)}getParser(){return this.parser}}class kj extends v{constructor(e){super(e,ck)}getParser(){return this.parser}}class Vj extends v{constructor(e){super(e,uk)}getParser(){return this.parser}}class Hj extends v{constructor(e){super(e,hk)}getParser(){return this.parser}}class ZS extends v{constructor(e){super(e,dk)}getParser(){return this.parser}}class jj extends v{constructor(e){super(e,nu)}getParser(){return this.parser}}class Wj extends v{constructor(e){super(e,vd)}getParser(){return this.parser}}class Yj extends v{constructor(e){super(e,_k)}getParser(){return this.parser}}class $S extends v{constructor(e){super(e,gk)}getParser(){return this.parser}}class zj extends v{constructor(e){super(e,fk)}getParser(){return this.parser}}class Kj extends v{constructor(e){super(e,mk)}getParser(){return this.parser}}class O{}O.ACHIEVEMENT_LIST=305;O.AUTHENTICATED=2491;O.AUTHENTICATION=-1;O.AVAILABILITY_STATUS=2033;O.BUILDERS_CLUB_EXPIRED=1452;O.CLUB_OFFERS=2405;O.CATALOG_PAGE=804;O.CATALOG_PAGE_LIST=1032;O.CATALOG_PURCHASE_OK=869;O.CATALOG_PURCHASE_ERROR=1404;O.CATALOG_PURCHASE_NOT_ALLOWED=3770;O.PRODUCT_OFFER=3388;O.LIMITED_SOLD_OUT=377;O.CATALOG_PUBLISHED=1866;O.CFH_RESULT_MESSAGE=3635;O.CLIENT_LATENCY=10;O.CLIENT_PING=3928;O.DESKTOP_CAMPAIGN=1745;O.DESKTOP_NEWS=286;O.DESKTOP_VIEW=122;O.BUNDLE_DISCOUNT_RULESET=2347;O.FIRST_LOGIN_OF_DAY=793;O.FURNITURE_ALIASES=1723;O.FURNITURE_DATA=2547;O.FURNITURE_FLOOR=1778;O.FURNITURE_FLOOR_ADD=1534;O.FURNITURE_FLOOR_REMOVE=2703;O.FURNITURE_FLOOR_UPDATE=3776;O.FURNITURE_ITEMDATA=2202;O.FURNITURE_STATE=2376;O.FURNITURE_GROUP_CONTEXT_MENU_INFO=3293;O.FURNITURE_POSTIT_STICKY_POLE_OPEN=2366;O.GAME_CENTER_ACHIEVEMENTS=2265;O.GAME_CENTER_GAME_LIST=222;O.GAME_CENTER_STATUS=2893;O.GAME_CENTER_IN_ARENA_QUEUE=872;O.GAME_CENTER_STOP_COUNTER=3191;O.GAME_CENTER_USER_LEFT_GAME=3138;O.GAME_CENTER_DIRECTORY_STATUS=2246;O.GAME_CENTER_STARTING_GAME_FAILED=2142;O.GAME_CENTER_JOINING_FAILED=1730;O.GAMESTATUSMESSAGE=3805;O.GAMEACHIEVEMENTS=1689;O.GAMEINVITE=904;O.JOININGQUEUEFAILED=3035;O.JOINEDQUEUEMESSAGE=2260;O.LEFTQUEUE=1477;O.LOAD_GAME_URL=2624;O.LOADGAME=3654;O.UNLOADGAME=1715;O.ACHIEVEMENTRESOLUTIONCOMPLETED=740;O.ACHIEVEMENTRESOLUTIONPROGRESS=3370;O.ACHIEVEMENTRESOLUTIONS=66;O.GENERIC_ALERT=3801;O.MODERATOR_MESSAGE=2030;O.GENERIC_ERROR=1600;O.GIFT_WRAPPER_CONFIG=2234;O.GROUP_BADGES=2402;O.GROUP_CREATE_OPTIONS=2159;O.GROUP_FORUM_DATA=3011;O.GROUP_FORUM_LIST=3001;O.GROUP_FORUM_THREADS=1073;O.GROUP_FORUM_POST=2049;O.GROUP_FORUM_POST_THREAD=1862;O.GROUP_FORUM_THREAD_MESSAGES=509;O.GROUP_FORUM_UNREAD_COUNT=2379;O.GROUP_FORUM_UPDATE_MESSAGE=324;O.GROUP_FORUM_UPDATE_THREAD=2528;O.GROUP_INFO=1702;O.GROUP_LIST=420;O.GROUP_MEMBER=265;O.GROUP_MEMBERS=1200;O.GROUP_MEMBERS_REFRESH=2445;O.GROUP_MEMBER_REMOVE_CONFIRM=1876;O.GROUP_PURCHASED=2808;O.GROUP_SETTINGS=3965;O.GROUP_BADGE_PARTS=2238;O.GROUP_MEMBERSHIP_REQUESTED=1180;O.GROUP_DETAILS_CHANGED=1459;O.GROUP_HABBO_JOIN_FAILED=762;O.GUILD_EDIT_FAILED=3988;O.GUILD_MEMBER_MGMT_FAILED=818;O.ITEM_DIMMER_SETTINGS=2710;O.ITEM_STACK_HELPER=2816;O.ITEM_WALL=1369;O.ITEM_WALL_ADD=2187;O.ITEM_WALL_REMOVE=3208;O.ITEM_WALL_UPDATE=2009;O.MARKETPLACE_CONFIG=1823;O.MESSENGER_ACCEPT_FRIENDS=896;O.MESSENGER_CHAT=1587;O.MESSENGER_FIND_FRIENDS=1210;O.MESSENGER_FOLLOW_FAILED=3048;O.MESSENGER_FRIEND_NOTIFICATION=3082;O.MESSENGER_FRIENDS=3130;O.MESSENGER_INIT=1605;O.MESSENGER_INSTANCE_MESSAGE_ERROR=3359;O.MESSENGER_INVITE=3870;O.MESSENGER_INVITE_ERROR=462;O.MESSENGER_MESSAGE_ERROR=892;O.MESSENGER_MINIMAIL_COUNT=2803;O.MESSENGER_MINIMAIL_NEW=1911;O.MESSENGER_RELATIONSHIPS=2016;O.MESSENGER_REQUEST=2219;O.MESSENGER_REQUEST_ERROR=892;O.MESSENGER_REQUESTS=280;O.MESSENGER_SEARCH=973;O.MESSENGER_UPDATE=2800;O.MODERATION_REPORT_DISABLED=1651;O.MODERATION_TOOL=2696;O.MODERATION_USER_INFO=2866;O.MOTD_MESSAGES=2035;O.NAVIGATOR_CATEGORIES=1562;O.NAVIGATOR_COLLAPSED=1543;O.NAVIGATOR_EVENT_CATEGORIES=3244;O.NAVIGATOR_LIFTED=3104;O.NAVIGATOR_METADATA=3052;O.NAVIGATOR_OPEN_ROOM_CREATOR=2064;O.NAVIGATOR_SEARCH=2690;O.NAVIGATOR_SEARCHES=3984;O.NAVIGATOR_SETTINGS=518;O.THUMBNAIL_UPDATE_RESULT=1927;O.CAN_CREATE_ROOM=378;O.CATEGORIES_WITH_VISITOR_COUNT=1455;O.COMPETITION_ROOMS_DATA=3954;O.CONVERTED_ROOM_ID=1331;O.GUEST_ROOM_SEARCH_RESULT=52;O.NOTIFICATION_LIST=1992;O.NOTIFICATION_OFFER_REWARD_DELIVERED=2125;O.NOTIFICATION_SIMPLE_ALERT=5100;O.NOTIFICATION_ELEMENT_POINTER=1787;O.PET_FIGURE_UPDATE=1924;O.PET_INFO=2901;O.PET_TRAINING_PANEL=1164;O.PET_LEVEL_UPDATE=2824;O.PET_SCRATCH_FAILED=1130;O.PET_OPEN_PACKAGE_REQUESTED=2380;O.PET_OPEN_PACKAGE_RESULT=546;O.PET_BREEDING=1746;O.PET_CONFIRM_BREEDING_RESULT=1625;O.PET_GO_TO_BREEDING_NEST_FAILURE=2621;O.PET_NEST_BREEDING_SUCCESS=2527;O.PET_CONFIRM_BREEDING_REQUEST=634;O.PET_BREEDING_RESULT=1553;O.RECYCLER_PRIZES=3164;O.RECYCLER_STATUS=3433;O.RECYCLER_FINISHED=468;O.ROOM_BAN_LIST=1869;O.ROOM_BAN_REMOVE=3429;O.ROOM_CREATED=1304;O.ROOM_DOORBELL=2309;O.ROOM_DOORBELL_ACCEPTED=3783;O.ROOM_DOORBELL_REJECTED=878;O.ROOM_ENTER=758;O.ROOM_ENTER_ERROR=899;O.ROOM_FORWARD=160;O.ROOM_HEIGHT_MAP=2753;O.ROOM_HEIGHT_MAP_UPDATE=558;O.ROOM_INFO=687;O.ROOM_INFO_OWNER=749;O.ROOM_MODEL=1301;O.ROOM_MODEL_BLOCKED_TILES=3990;O.ROOM_MODEL_DOOR=1664;O.ROOM_MODEL_NAME=2031;O.ROOM_MUTED=2533;O.ROOM_MUTE_USER=826;O.ROOM_PAINT=2454;O.ROOM_PROMOTION=2274;O.ROOM_QUEUE_STATUS=2208;O.ROOM_RIGHTS=780;O.ROOM_RIGHTS_CLEAR=2392;O.ROOM_RIGHTS_LIST=1284;O.ROOM_RIGHTS_LIST_ADD=2088;O.ROOM_RIGHTS_LIST_REMOVE=1327;O.ROOM_RIGHTS_OWNER=339;O.ROOM_ROLLING=3207;O.ROOM_SCORE=482;O.ROOM_SETTINGS=1498;O.ROOM_SETTINGS_CHAT=1191;O.ROOM_SETTINGS_SAVE=948;O.ROOM_SETTINGS_SAVE_ERROR=1555;O.ROOM_INFO_UPDATED=3297;O.ROOM_SPECTATOR=1033;O.ROOM_THICKNESS=3547;O.ROOM_GET_FILTER_WORDS=2937;O.ROOM_MESSAGE_NOTIFICATION=1634;O.ROOM_POPULAR_TAGS_RESULT=2012;O.INFO_FEED_ENABLE=3284;O.SECURITY_MACHINE=1488;O.MYSTERY_BOX_KEYS=2833;O.GOTMYSTERYBOXPRIZEMESSAGE=3712;O.CANCELMYSTERYBOXWAITMESSAGE=596;O.SHOWMYSTERYBOXWAITMESSAGE=3201;O.TRADE_ACCEPTED=2568;O.TRADE_CLOSED=1373;O.TRADE_COMPLETED=1001;O.TRADE_CONFIRMATION=2720;O.TRADE_LIST_ITEM=2024;O.TRADE_NOT_OPEN=3128;O.TRADE_OPEN=2505;O.TRADE_OPEN_FAILED=217;O.TRADE_OTHER_NOT_ALLOWED=1254;O.TRADE_YOU_NOT_ALLOWED=3058;O.TRADE_NO_SUCH_ITEM=2873;O.UNIT=374;O.UNIT_CHANGE_NAME=2182;O.UNIT_CHAT=1446;O.UNIT_CHAT_SHOUT=1036;O.UNIT_CHAT_WHISPER=2704;O.UNIT_DANCE=2233;O.UNIT_EFFECT=1167;O.UNIT_EXPRESSION=1631;O.UNIT_HAND_ITEM=1474;O.UNIT_IDLE=1797;O.UNIT_INFO=3920;O.UNIT_NUMBER=2324;O.UNIT_REMOVE=2661;O.UNIT_STATUS=1640;O.UNIT_TYPING=1717;O.UNSEEN_ITEMS=2103;O.USER_ACHIEVEMENT_SCORE=1968;O.USER_BADGES=717;O.USER_BADGES_ADD=2493;O.USER_BADGES_CURRENT=1087;O.USER_BOT_REMOVE=233;O.USER_BOTS=3086;O.USER_CHANGE_NAME=118;O.USER_CLOTHING=1450;O.USER_CREDITS=3475;O.USER_CURRENCY=2018;O.ACTIVITY_POINT_NOTIFICATION=2275;O.USER_EFFECTS=340;O.USER_FAVORITE_ROOM=2524;O.USER_FAVORITE_ROOM_COUNT=151;O.USER_FIGURE=2429;O.USER_FURNITURE=994;O.USER_FURNITURE_ADD=104;O.USER_FURNITURE_POSTIT_PLACED=1501;O.USER_FURNITURE_REFRESH=3151;O.USER_FURNITURE_REMOVE=159;O.USER_HOME_ROOM=2875;O.ROOM_EVENT_CANCEL=3479;O.ROOM_EVENT=1840;O.USER_IGNORED=126;O.USER_IGNORED_RESULT=207;O.USER_INFO=2725;O.USER_OUTFITS=3315;O.USER_PERKS=2586;O.USER_PERMISSIONS=411;O.USER_PET_ADD=2101;O.USER_PET_REMOVE=3253;O.USER_PETS=3522;O.USER_PROFILE=3898;O.USER_RESPECT=2815;O.USER_SANCTION_STATUS=3679;O.USER_SETTINGS=513;O.USER_SUBSCRIPTION=954;O.USER_WARDROBE_PAGE=3315;O.USER_CLASSIFICATION=966;O.GET_USER_TAGS=1255;O.WIRED_ACTION=1434;O.WIRED_CONDITION=1108;O.WIRED_ERROR=156;O.WIRED_OPEN=1830;O.WIRED_REWARD=178;O.WIRED_SAVE=1155;O.WIRED_TRIGGER=383;O.PLAYING_GAME=448;O.FURNITURE_STATE_2=3431;O.REMOVE_BOT_FROM_INVENTORY=233;O.ADD_BOT_TO_INVENTORY=1352;O.ACHIEVEMENT_PROGRESSED=2107;O.MODTOOL_ROOM_INFO=1333;O.MODTOOL_USER_CHATLOG=3377;O.MODTOOL_ROOM_CHATLOG=3434;O.MODTOOL_VISITED_ROOMS_USER=1752;O.MODERATOR_ACTION_RESULT=2335;O.ISSUE_DELETED=3192;O.ISSUE_INFO=3609;O.ISSUE_PICK_FAILED=3150;O.CFH_CHATLOG=607;O.MODERATOR_TOOL_PREFERENCES=1576;O.LOVELOCK_FURNI_START=3753;O.LOVELOCK_FURNI_FRIEND_COMFIRMED=382;O.LOVELOCK_FURNI_FINISHED=770;O.GIFT_RECEIVER_NOT_FOUND=1517;O.GIFT_OPENED=56;O.FLOOD_CONTROL=566;O.REMAINING_MUTE=826;O.USER_EFFECT_LIST=340;O.USER_EFFECT_LIST_ADD=2867;O.USER_EFFECT_LIST_REMOVE=2228;O.USER_EFFECT_ACTIVATE=1959;O.AVATAR_EFFECT_SELECTED=3473;O.CLUB_GIFT_INFO=619;O.REDEEM_VOUCHER_ERROR=714;O.REDEEM_VOUCHER_OK=3336;O.IN_CLIENT_LINK=2023;O.BOT_COMMAND_CONFIGURATION=1618;O.BOT_SKILL_LIST_UPDATE=69;O.BOT_FORCE_OPEN_CONTEXT_MENU=296;O.HAND_ITEM_RECEIVED=354;O.PET_PLACING_ERROR=2913;O.BOT_ERROR=639;O.MARKETPLACE_SELL_ITEM=54;O.MARKETPLACE_ITEM_STATS=725;O.MARKETPLACE_OWN_ITEMS=3884;O.MARKETPLACE_CANCEL_SALE=3264;O.MARKETPLACE_ITEM_POSTED=1359;O.MARKETPLACE_ITEMS_SEARCHED=680;O.MARKETPLACE_AFTER_ORDER_STATUS=2032;O.CATALOG_RECEIVE_PET_BREEDS=3331;O.CATALOG_APPROVE_NAME_RESULT=1503;O.OBJECTS_DATA_UPDATE=1453;O.PET_EXPERIENCE=2156;O.COMMUNITY_GOAL_VOTE_EVENT=1435;O.PROMO_ARTICLES=286;O.COMMUNITY_GOAL_EARNED_PRIZES=3319;O.COMMUNITY_GOAL_PROGRESS=2525;O.CONCURRENT_USERS_GOAL_PROGRESS=2737;O.QUEST_DAILY=1878;O.QUEST_CANCELLED=3027;O.QUEST_COMPLETED=949;O.COMMUNITY_GOAL_HALL_OF_FAME=3005;O.EPIC_POPUP=3945;O.SEASONAL_QUESTS=1122;O.QUESTS=3625;O.QUEST=230;O.BONUS_RARE_INFO=1533;O.CRAFTABLE_PRODUCTS=1e3;O.CRAFTING_RECIPE=2774;O.CRAFTING_RECIPES_AVAILABLE=2124;O.CRAFTING_RESULT=618;O.CAMERA_PUBLISH_STATUS=2057;O.CAMERA_PURCHASE_OK=2783;O.CAMERA_STORAGE_URL=3696;O.CAMERA_SNAPSHOT=463;O.COMPETITION_STATUS=133;O.INIT_CAMERA=3878;O.THUMBNAIL_STATUS=3595;O.ACHIEVEMENT_NOTIFICATION=806;O.CLUB_GIFT_NOTIFICATION=2188;O.INTERSTITIAL_MESSAGE=1808;O.ROOM_AD_ERROR=1759;O.AVAILABILITY_TIME=600;O.HOTEL_CLOSED_AND_OPENS=3728;O.HOTEL_CLOSES_AND_OPENS_AT=2771;O.HOTEL_WILL_CLOSE_MINUTES=1050;O.HOTEL_MAINTENANCE=1350;O.JUKEBOX_PLAYLIST_FULL=105;O.JUKEBOX_SONG_DISKS=34;O.NOW_PLAYING=469;O.OFFICIAL_SONG_ID=1381;O.PLAYLIST=1748;O.PLAYLIST_SONG_ADDED=1140;O.TRAX_SONG_INFO=3365;O.USER_SONG_DISKS_INVENTORY=2602;O.CHECK_USER_NAME=563;O.CFH_SANCTION=2782;O.CFH_TOPICS=325;O.CFH_SANCTION_STATUS=2221;O.CAMPAIGN_CALENDAR_DATA=2531;O.CAMPAIGN_CALENDAR_DOOR_OPENED=2551;O.BUILDERS_CLUB_FURNI_COUNT=3828;O.BUILDERS_CLUB_SUBSCRIPTION=1452;O.CATALOG_PAGE_EXPIRATION=2668;O.CATALOG_EARLIEST_EXPIRY=2515;O.CLUB_GIFT_SELECTED=659;O.TARGET_OFFER_NOT_FOUND=1237;O.TARGET_OFFER=119;O.DIRECT_SMS_CLUB_BUY=195;O.ROOM_AD_PURCHASE=2468;O.NOT_ENOUGH_BALANCE=3914;O.LIMITED_OFFER_APPEARING_NEXT=44;O.IS_OFFER_GIFTABLE=761;O.CLUB_EXTENDED_OFFER=3964;O.SEASONAL_CALENDAR_OFFER=1889;O.COMPETITION_ENTRY_SUBMIT=1177;O.COMPETITION_VOTING_INFO=3506;O.COMPETITION_TIMING_CODE=1745;O.COMPETITION_USER_PART_OF=3841;O.COMPETITION_NO_OWNED_ROOMS=2064;O.COMPETITION_SECONDS_UNTIL=3926;O.BADGE_POINT_LIMITS=2501;O.BADGE_REQUEST_FULFILLED=2998;O.HELPER_TALENT_TRACK=3406;O.TALENT_TRACK_LEVEL=1203;O.TALENT_TRACK_LEVEL_UP=638;O.USER_BANNED=1683;O.BOT_RECEIVED=3684;O.PET_LEVEL_NOTIFICATION=859;O.PET_RECEIVED=1111;O.MODERATION_CAUTION=1890;O.YOUTUBE_CONTROL_VIDEO=1554;O.YOUTUBE_DISPLAY_PLAYLISTS=1112;O.YOUTUBE_DISPLAY_VIDEO=1411;O.CFH_DISABLED_NOTIFY=1651;O.QUESTION=2665;O.POLL_CONTENTS=2997;O.POLL_ERROR=662;O.POLL_OFFER=3785;O.POLL_ROOM_RESULT=5201;O.POLL_START_ROOM=5200;O.QUESTION_ANSWERED=2589;O.QUESTION_FINISHED=1066;O.CFH_PENDING_CALLS=1121;O.GUIDE_ON_DUTY_STATUS=1548;O.GUIDE_SESSION_ATTACHED=1591;O.GUIDE_SESSION_DETACHED=138;O.GUIDE_SESSION_ENDED=1456;O.GUIDE_SESSION_ERROR=673;O.GUIDE_SESSION_INVITED_TO_GUIDE_ROOM=219;O.GUIDE_SESSION_MESSAGE=841;O.GUIDE_SESSION_PARTNER_IS_TYPING=1016;O.GUIDE_SESSION_REQUESTER_ROOM=1847;O.GUIDE_SESSION_STARTED=3209;O.GUIDE_TICKET_CREATION_RESULT=3285;O.GUIDE_TICKET_RESOLUTION=2674;O.GUIDE_REPORTING_STATUS=3463;O.HOTEL_MERGE_NAME_CHANGE=1663;O.ISSUE_CLOSE_NOTIFICATION=934;O.QUIZ_DATA=2927;O.QUIZ_RESULTS=2772;O.CFH_PENDING_CALLS_DELETED=77;O.CFH_REPLY=3796;O.CHAT_REVIEW_SESSION_DETACHED=30;O.CHAT_REVIEW_SESSION_OFFERED_TO_GUIDE=735;O.CHAT_REVIEW_SESSION_RESULTS=3276;O.CHAT_REVIEW_SESSION_STARTED=143;O.CHAT_REVIEW_SESSION_VOTING_STATUS=1829;O.SCR_SEND_KICKBACK_INFO=3277;O.PET_STATUS=1907;O.GROUP_DEACTIVATE=3129;O.PET_RESPECTED=2788;O.PET_SUPPLEMENT=3441;O.NOOBNESS_LEVEL=3738;O.DISCONNECT_REASON=4e3;O.CAN_CREATE_ROOM_EVENT=2599;O.FAVORITE_GROUP_UDPATE=3403;O.NO_SUCH_FLAT=84;O.ROOM_SETTINGS_ERROR=2897;O.SHOW_ENFORCE_ROOM_CATEGORY=3896;O.CUSTOM_USER_NOTIFICATION=909;O.NEW_USER_EXPERIENCE_GIFT_OFFER=3575;O.RESTORE_CLIENT=426;O.FIREWORK_CHARGE_DATA=5210;O.NEW_USER_EXPERIENCE_NOT_COMPLETE=3639;O.CONNECTION_ERROR=1004;O.ACCOUNT_SAFETY_LOCK_STATUS_CHANGE=1243;O.PHONE_COLLECTION_STATE=2890;O.PHONE_TRY_NUMBER_RESULT=800;O.PHONE_TRY_VERIFICATION_CODE_RESULT=91;O.EXTENDED_PROFILE_CHANGED=876;O.WELCOME_GIFT_CHANGE_EMAIL_RESULT=2293;O.WELCOME_GIFT_STATUS=2707;O.HANDSHAKE_INIT_DIFFIE=1347;O.HANDSHAKE_COMPLETE_DIFFIE=3885;O.RENTABLE_SPACE_RENT_OK=2046;O.RENTABLE_SPACE_STATUS=3559;O.RENTABLE_SPACE_RENT_FAILED=1868;O.EMAIL_STATUS=612;O.CHANGE_EMAIL_RESULT=1815;O.WEEKLY_GAME_REWARD=2641;O.WEEKLY_GAME_REWARD_WINNERS=3097;O.WEEKLY_COMPETITIVE_LEADERBOARD=3512;O.WEEKLY_COMPETITIVE_FRIENDS_LEADERBOARD=3560;O.WEEKLY_GAME2_FRIENDS_LEADERBOARD=2270;O.WEEKLY_GAME2_LEADERBOARD=2196;O.RENTABLE_FURNI_RENT_OR_BUYOUT_OFFER=35;O.HANDSHAKE_IDENTITY_ACCOUNT=3523;class eC extends v{constructor(e){super(e,w1)}getParser(){return this.parser}}class tC extends v{constructor(e){super(e,B1)}getParser(){return this.parser}}class sC extends v{constructor(e){super(e,k1)}getParser(){return this.parser}}class Xj extends v{constructor(e){super(e,H1)}getParser(){return this.parser}}class qj extends v{constructor(e){super(e,j1)}getParser(){return this.parser}}class Qj extends v{constructor(e){super(e,W1)}getParser(){return this.parser}}class Jj extends v{constructor(e){super(e,Y1)}getParser(){return this.parser}}class Zj extends v{constructor(e){super(e,z1)}getParser(){return this.parser}}class Gm extends v{constructor(e){super(e,X1)}getParser(){return this.parser}}class rC extends v{constructor(e){super(e,q1)}getParser(){return this.parser}}class iC extends v{constructor(e){super(e,Q1)}getParser(){return this.parser}}class $j extends v{constructor(e){super(e,J1)}getParser(){return this.parser}}class nC extends v{constructor(e){super(e,Z1)}getParser(){return this.parser}}class Bm extends v{constructor(e){super(e,xw)}getParser(){return this.parser}}class Ph extends v{constructor(e){super(e,Gw)}getParser(){return this.parser}}class aC extends v{constructor(e){super(e,ww)}getParser(){return this.parser}}class km extends v{constructor(e){super(e,Bw)}getParser(){return this.parser}}class oC extends v{constructor(e){super(e,kw)}getParser(){return this.parser}}class lC extends v{constructor(e){super(e,Vw)}getParser(){return this.parser}}class eW extends v{constructor(e){super(e,Hw)}getParser(){return this.parser}}class tW extends v{constructor(e){super(e,jw)}getParser(){return this.parser}}class sW extends v{constructor(e){super(e,Ww)}getParser(){return this.parser}}class cC extends v{constructor(e){super(e,Yw)}getParser(){return this.parser}}class uC extends v{constructor(e){super(e,zw)}getParser(){return this.parser}}class hC extends v{constructor(e){super(e,Kw)}getParser(){return this.parser}}class dC extends v{constructor(e){super(e,Xw)}getParser(){return this.parser}}class _C extends v{constructor(e){super(e,Qw)}get userID(){return this.getParser().userID}get userAccepts(){return this.getParser().userAccepts}getParser(){return this.parser}}class gC extends v{constructor(e){super(e,Om)}get userID(){return this.getParser().userID}getParser(){return this.parser}}class fC extends v{constructor(e){super(e,Jw)}getParser(){return this.parser}}class mC extends v{constructor(e){super(e,Zw)}getParser(){return this.parser}}class EC extends v{constructor(e){super(e,$w)}get firstUserID(){return this.getParser().firstUserID}get secondUserID(){return this.getParser().secondUserID}get firstUserNumItems(){return this.getParser().firstUserNumItems}get secondUserNumItems(){return this.getParser().secondUserNumItems}get firstUserNumCredits(){return this.getParser().firstUserNumCredits}get secondUserNumCredits(){return this.getParser().secondUserNumCredits}get firstUserItemArray(){return this.getParser().firstUserItemArray}get secondUserItemArray(){return this.getParser().secondUserItemArray}getParser(){return this.parser}}class rW extends v{constructor(e){super(e,eG)}getParser(){return this.parser}}class pC extends v{constructor(e){super(e,tG)}getParser(){return this.parser}}class IC extends v{constructor(e){super(e,sG)}get userID(){return this.getParser().userID}get userCanTrade(){return this.getParser().userCanTrade}get otherUserID(){return this.getParser().otherUserID}get otherUserCanTrade(){return this.getParser().otherUserCanTrade}getParser(){return this.parser}}class TC extends v{constructor(e){super(e,Sm)}getParser(){return this.parser}}class RC extends v{constructor(e){super(e,rG)}getParser(){return this.parser}}class OC extends v{constructor(e){super(e,iG)}getParser(){return this.parser}}class iW extends v{constructor(e){super(e,Ek)}getParser(){return this.parser}}class nW extends v{constructor(e){super(e,pk)}getParser(){return this.parser}}class SC extends v{constructor(e){super(e,Ik)}getParser(){return this.parser}}class CC extends v{constructor(e){super(e,Tk)}getParser(){return this.parser}}class aW extends v{constructor(e){super(e,Rk)}getParser(){return this.parser}}class AC extends v{constructor(e){super(e,Ok)}getParser(){return this.parser}}class oW extends v{constructor(e){super(e,Ck)}getParser(){return this.parser}}class NC extends v{constructor(e){super(e,Sk)}getParser(){return this.parser}}class yC extends v{constructor(e){super(e,Ak)}getParser(){return this.parser}}class MC extends v{constructor(e){super(e,Nk)}getParser(){return this.parser}}class DC extends v{constructor(e){super(e,Dk)}getParser(){return this.parser}}class vC extends v{constructor(e){super(e,vk)}getParser(){return this.parser}}class bC extends v{constructor(e){super(e,kO)}getParser(){return this.parser}}class PC extends v{constructor(e){super(e,Pk)}getParser(){return this.parser}}class LC extends v{constructor(e){super(e,Uk)}getParser(){return this.parser}}class UC extends v{constructor(e){super(e,Lk)}getParser(){return this.parser}}class FC extends v{constructor(e){super(e,xk)}getParser(){return this.parser}}class xC extends v{constructor(e){super(e,wk)}getParser(){return this.parser}}class wC extends v{constructor(e){super(e,kk)}getParser(){return this.parser}}class GC extends v{constructor(e){super(e,Vk)}getParser(){return this.parser}}class BC extends v{constructor(e){super(e,jk)}getParser(){return this.parser}}class kC extends v{constructor(e){super(e,Wk)}getParser(){return this.parser}}class VC extends v{constructor(e){super(e,Kk)}getParser(){return this.parser}}class HC extends v{constructor(e){super(e,Xk)}getParser(){return this.parser}}class jC extends v{constructor(e){super(e,Qk)}getParser(){return this.parser}}class WC extends v{constructor(e){super(e,Jk)}getParser(){return this.parser}}class YC extends v{constructor(e){super(e,Zk)}getParser(){return this.parser}}class zC extends v{constructor(e){super(e,$k)}getParser(){return this.parser}}class KC extends v{constructor(e){super(e,eV)}getParser(){return this.parser}}class lW extends v{constructor(e){super(e,ym)}getParser(){return this.parser}}class XC extends v{constructor(e){super(e,tV)}getParser(){return this.parser}}class cW extends v{constructor(e){super(e,uV)}getParser(){return this.parser}}class uW extends v{constructor(e){super(e,hV)}getParser(){return this.parser}}class hW extends v{constructor(e){super(e,dV)}getParser(){return this.parser}}class Vm extends v{constructor(e){super(e,_V)}getParser(){return this.parser}get userName(){return this.getParser().userName}}class dW extends v{constructor(e){super(e,gV)}getParser(){return this.parser}}class _W extends v{constructor(e){super(e,fV)}getParser(){return this.parser}}class Lh extends v{constructor(e){super(e,mV)}getParser(){return this.parser}}class qC extends v{constructor(e){super(e,EV)}getParser(){return this.parser}}class sa extends v{constructor(e){super(e,pV)}getParser(){return this.parser}}class gW extends v{constructor(e){super(e,IV)}getParser(){return this.parser}}class fW extends v{constructor(e){super(e,RV)}getParser(){return this.parser}}class QC extends v{constructor(e){super(e,SV)}getParser(){return this.parser}}class mW extends v{constructor(e){super(e,AV)}getParser(){return this.parser}}class JC extends v{constructor(e){super(e,NV)}getParser(){return this.parser}}class ZC extends v{constructor(e){super(e,yV)}getParser(){return this.parser}}class EW extends v{constructor(e){super(e,MV)}getParser(){return this.parser}}class $C extends v{constructor(e){super(e,DV)}getParser(){return this.parser}}class pW extends v{constructor(e){super(e,vV)}getParser(){return this.parser}}class IW extends v{constructor(e){super(e,LV)}getParser(){return this.parser}}class TW extends v{constructor(e){super(e,UV)}getParser(){return this.parser}}class eA extends v{constructor(e){super(e,FV)}getParser(){return this.parser}}class tA extends v{constructor(e){super(e,xV)}getParser(){return this.parser}}class sA extends v{constructor(e){super(e,wV)}getParser(){return this.parser}}class RW extends v{constructor(e){super(e,GV)}getParser(){return this.parser}}class rA extends v{constructor(e){super(e,BV)}getParser(){return this.parser}}class iA extends v{constructor(e){super(e,kV)}getParser(){return this.parser}}class nA extends v{constructor(e){super(e,HV)}getParser(){return this.parser}}class Hm extends v{constructor(e){super(e,jV)}getParser(){return this.parser}}class aA extends v{constructor(e){super(e,WV)}getParser(){return this.parser}}class oA extends v{constructor(e){super(e,YV)}getParser(){return this.parser}}class lA extends v{constructor(e){super(e,zV)}getParser(){return this.parser}}class OW extends v{constructor(e){super(e,KV)}getParser(){return this.parser}}class cA extends v{constructor(e){super(e,XV)}getParser(){return this.parser}}class uA extends v{constructor(e){super(e,qV)}getParser(){return this.parser}}class hA extends v{constructor(e){super(e,QV)}getParser(){return this.parser}}class dA extends v{constructor(e){super(e,JV)}getParser(){return this.parser}}class SW extends v{constructor(e){super(e,ZV)}getParser(){return this.parser}}class _A extends v{constructor(e){super(e,$V)}getParser(){return this.parser}}class gA extends v{constructor(e){super(e,eH)}getParser(){return this.parser}}class CW extends v{constructor(e){super(e,tH)}getParser(){return this.parser}}class fA extends v{constructor(e){super(e,sH)}getParser(){return this.parser}}class mA extends v{constructor(e){super(e,rH)}getParser(){return this.parser}}class AW{constructor(e){this._itemName=e.readString(),this._extraInfo=e.readString(),this._extraInfo==""&&(this._extraInfo=null)}get itemName(){return this._itemName}get extraInfo(){return this._extraInfo}}class NW{constructor(e){this._thumbnailUrl=e.readString(),this._thumbnailUrl==""&&(this._thumbnailUrl=null),this._productOfferList=[];const t=e.readInt();let s=0;for(;s<t;)this._productOfferList.push(new AW(e)),s++}get productOfferList(){return this._productOfferList}get thumbnailUrl(){return this._thumbnailUrl}}class yW{flush(){return!0}parse(e){if(!e)return!1;const t=e.readInt();this._giftOptions=[];let s=0;for(;s<t;)this._giftOptions.push(new vW(e)),s++;return!0}get giftOptions(){return this._giftOptions}}class MW{flush(){return!0}parse(e){return!!e}}class DW extends v{constructor(e){super(e,yW)}getParser(){return this.parser}}class vW{constructor(e){this._dayIndex=e.readInt(),this._stepIndex=e.readInt(),this._options=[];const t=e.readInt();let s=0;for(;s<t;)this._options.push(new NW(e)),s++}get dayIndex(){return this._dayIndex}get stepIndex(){return this._stepIndex}get options(){return this._options}}class bW extends v{constructor(e){super(e,MW)}getParser(){return this.parser}}class PW extends v{constructor(e){super(e,nH)}getParser(){return this.parser}}class LW extends v{constructor(e){super(e,yd)}getParser(){return this.parser}}class EA extends v{constructor(e){super(e,aH)}getParser(){return this.parser}}class pA extends v{constructor(e){super(e,oH)}getParser(){return this.parser}}class IA extends v{constructor(e){super(e,lH)}getParser(){return this.parser}}class TA extends v{constructor(e){super(e,cH)}getParser(){return this.parser}}class RA extends v{constructor(e){super(e,uH)}getParser(){return this.parser}}class OA extends v{constructor(e){super(e,_H)}getParser(){return this.parser}}class SA extends v{constructor(e){super(e,gH)}getParser(){return this.parser}}class CA extends v{constructor(e){super(e,fH)}getParser(){return this.parser}}class AA extends v{constructor(e){super(e,mH)}getParser(){return this.parser}}class NA extends v{constructor(e){super(e,pH)}getParser(){return this.parser}}class yA extends v{constructor(e){super(e,EH)}getParser(){return this.parser}}class MA extends v{constructor(e){super(e,IH)}getParser(){return this.parser}}class DA extends v{constructor(e){super(e,TH)}getParser(){return this.parser}}class UW extends v{constructor(e){super(e,SH)}getParser(){return this.parser}}class FW extends v{constructor(e){super(e,NH)}getParser(){return this.parser}}class xW extends v{constructor(e){super(e,yH)}getParser(){return this.parser}}class wW extends v{constructor(e){super(e,MH)}getParser(){return this.parser}}class GW extends v{constructor(e){super(e,DH)}getParser(){return this.parser}}class BW extends v{constructor(e){super(e,vH)}getParser(){return this.parser}}class kW extends v{constructor(e){super(e,bH)}getParser(){return this.parser}}class VW extends v{constructor(e){super(e,PH)}getParser(){return this.parser}}class HW extends v{constructor(e){super(e,LH)}getParser(){return this.parser}}class jW extends v{constructor(e){super(e,UH)}getParser(){return this.parser}}class WW extends v{constructor(e){super(e,FH)}getParser(){return this.parser}}class jm extends v{constructor(e){super(e,xH)}getParser(){return this.parser}}jm.FINISHED_OK=1;jm.FINISHED_FAIL=2;class Fd extends v{constructor(e){super(e,wH)}getParser(){return this.parser}}Fd.SYSTEM_STATUS_ENABLED=1;Fd.SYSTEM_STATUS_DISABLED=2;Fd.SYSTEM_STATUS_TIMEOUT=3;class Uh extends v{constructor(e){super(e,$1)}getParser(){return this.parser}}class Lg extends v{constructor(e){super(e,ex)}getParser(){return this.parser}}class Ug extends v{constructor(e){super(e,sx)}getParser(){return this.parser}}class Fg extends v{constructor(e){super(e,tx)}getParser(){return this.parser}}class vA extends v{constructor(e){super(e,va)}getParser(){return this.parser}}class Fh extends v{constructor(e){super(e,rx)}getParser(){return this.parser}}class bA extends v{constructor(e){super(e,ix)}getParser(){return this.parser}}class PA extends v{constructor(e){super(e,nx)}getParser(){return this.parser}}class YW extends v{constructor(e){super(e,ax)}getParser(){return this.parser}}class zW extends v{constructor(e){super(e,lx)}getParser(){return this.parser}}class LA extends v{constructor(e){super(e,Sx)}getParser(){return this.parser}}class Wm extends v{constructor(e){super(e,Cx)}getParser(){return this.parser}}class UA extends v{constructor(e){super(e,Ax)}getParser(){return this.parser}}class FA extends v{constructor(e){super(e,Nx)}getParser(){return this.parser}}class xg extends v{constructor(e){super(e,iw)}getParser(){return this.parser}}class wg extends v{constructor(e){super(e,nw)}getParser(){return this.parser}}class xA extends v{constructor(e){super(e,Mx)}getParser(){return this.parser}}class Gg extends v{constructor(e){super(e,Dx)}getParser(){return this.parser}}class Bg extends v{constructor(e){super(e,vx)}getParser(){return this.parser}}class kg extends v{constructor(e){super(e,bx)}getParser(){return this.parser}}class Vg extends v{constructor(e){super(e,Px)}getParser(){return this.parser}}class Hg extends v{constructor(e){super(e,Lx)}getParser(){return this.parser}}class KW extends v{constructor(e){super(e,Ux)}getParser(){return this.parser}}class jg extends v{constructor(e){super(e,Fx)}getParser(){return this.parser}}class Wg extends v{constructor(e){super(e,ka)}getParser(){return this.parser}}class wA extends v{constructor(e){super(e,xx)}getParser(){return this.parser}}class GA extends v{constructor(e){super(e,wx)}getParser(){return this.parser}}class Yg extends v{constructor(e){super(e,Gx)}getParser(){return this.parser}}class BA extends v{constructor(e){super(e,Bx)}getParser(){return this.parser}}class kA extends v{constructor(e){super(e,kx)}getParser(){return this.parser}}class VA extends v{constructor(e){super(e,Vx)}getParser(){return this.parser}}class zg extends v{constructor(e){super(e,Hx)}getParser(){return this.parser}}class XW extends v{constructor(e){super(e,jx)}getParser(){return this.parser}}class qW extends v{constructor(e){super(e,Wx)}getParser(){return this.parser}}class QW extends v{constructor(e){super(e,zi)}getParser(){return this.parser}}class HA extends v{constructor(e){super(e,Yx)}getParser(){return this.parser}}class jA extends v{constructor(e){super(e,Kx)}getParser(){return this.parser}}class JW extends v{constructor(e){super(e,Xx)}getParser(){return this.parser}}class Kg extends v{constructor(e){super(e,qx)}getParser(){return this.parser}}class Xg extends v{constructor(e){super(e,Qx)}getParser(){return this.parser}}class qg extends v{constructor(e){super(e,Jx)}getParser(){return this.parser}}class Qg extends v{constructor(e){super(e,Zx)}getParser(){return this.parser}}class ZW extends v{constructor(e){super(e,$x)}getParser(){return this.parser}}class WA extends v{constructor(e){super(e,ew)}getParser(){return this.parser}}class YA extends v{constructor(e){super(e,sw)}getParser(){return this.parser}}class zA extends v{constructor(e){super(e,rw)}getParser(){return this.parser}}class xh extends v{constructor(e){super(e,bO)}getParser(){return this.parser}}class wh extends v{constructor(e){super(e,aw)}getParser(){return this.parser}}class Jg extends v{constructor(e){super(e,ba)}getParser(){return this.parser}}class Zg extends v{constructor(e){super(e,ow)}getParser(){return this.parser}}class KA extends v{constructor(e){super(e,lw)}getParser(){return this.parser}}class $g extends v{constructor(e){super(e,cw)}getParser(){return this.parser}}class Al extends v{constructor(e){super(e,uw)}getParser(){return this.parser}}class Gh extends v{constructor(e){super(e,hw)}getParser(){return this.parser}}class XA extends v{constructor(e){super(e,dw)}getParser(){return this.parser}}class qA extends v{constructor(e){super(e,_w)}getParser(){return this.parser}}class Bh extends v{constructor(e){super(e,gw)}getParser(){return this.parser}}class QA extends v{constructor(e){super(e,fw)}getParser(){return this.parser}}class JA extends v{constructor(e){super(e,mw)}getParser(){return this.parser}}class ZA extends v{constructor(e){super(e,pw)}getParser(){return this.parser}}class $A extends v{constructor(e){super(e,Iw)}getParser(){return this.parser}}class eN extends v{constructor(e){super(e,Tw)}getParser(){return this.parser}}class tN extends v{constructor(e){super(e,Rw)}getParser(){return this.parser}}class Ym extends v{constructor(e){super(e,Im)}getParser(){return this.parser}}class kh extends v{constructor(e){super(e,Im)}getParser(){return this.parser}}class Vh extends v{constructor(e){super(e,Im)}getParser(){return this.parser}}class ef extends v{constructor(e){super(e,Ow)}getParser(){return this.parser}}class Hh extends v{constructor(e){super(e,Sw)}getParser(){return this.parser}}class tf extends v{constructor(e){super(e,Cw)}getParser(){return this.parser}}class jh extends v{constructor(e){super(e,bw)}getParser(){return this.parser}}class sf extends v{constructor(e){super(e,Aw)}getParser(){return this.parser}}class rf extends v{constructor(e){super(e,Nw)}getParser(){return this.parser}}class sN extends v{constructor(e){super(e,yw)}getParser(){return this.parser}}class nf extends v{constructor(e){super(e,Mw)}getParser(){return this.parser}}class Wh extends v{constructor(e){super(e,Dw)}getParser(){return this.parser}}class af extends v{constructor(e){super(e,vw)}getParser(){return this.parser}}class Yh extends v{constructor(e){super(e,Pw)}getParser(){return this.parser}}class of extends v{constructor(e){super(e,Fw)}getParser(){return this.parser}}class rN extends v{constructor(e){super(e,GH)}getParser(){return this.parser}}class iN extends v{constructor(e){super(e,BH)}getParser(){return this.parser}}class nN extends v{constructor(e){super(e,kH)}getParser(){return this.parser}}class $W extends v{constructor(e){super(e,VH)}getParser(){return this.parser}}class zm extends v{constructor(e){super(e,HH)}getParser(){return this.parser}}zm.PRODUCT_DONATED_CODE=6;zm.BADGE_DONATED_CODE=7;class aN extends v{constructor(e){super(e,jH)}getParser(){return this.parser}}class eY extends v{constructor(e){super(e,WH)}getParser(){return this.parser}}class oN extends v{constructor(e){super(e,ux)}getParser(){return this.parser}}class lN extends v{constructor(e){super(e,dx)}getParser(){return this.parser}}class cN extends v{constructor(e){super(e,_x)}getParser(){return this.parser}}class uN extends v{constructor(e){super(e,gx)}getParser(){return this.parser}}class tY extends v{constructor(e){super(e,fx)}getParser(){return this.parser}}class sY extends v{constructor(e){super(e,mx)}getParser(){return this.parser}}class hN extends v{constructor(e){super(e,px)}getParser(){return this.parser}}class rY extends v{constructor(e){super(e,Ix)}getParser(){return this.parser}}class iY extends v{constructor(e){super(e,Tx)}getParser(){return this.parser}}class dN extends v{constructor(e){super(e,gr)}getParser(){return this.parser}}class nY extends v{constructor(e){super(e,Rx)}getParser(){return this.parser}}class aY extends v{constructor(e){super(e,Ox)}getParser(){return this.parser}}class _N extends v{constructor(e){super(e,YH)}getParser(){return this.parser}}class gN extends v{constructor(e){super(e,zH)}getParser(){return this.parser}}class fN extends v{constructor(e){super(e,KH)}getParser(){return this.parser}}class mN extends v{constructor(e){super(e,XH)}getParser(){return this.parser}}class EN extends v{constructor(e){super(e,qH)}getParser(){return this.parser}}class oY extends v{constructor(e){super(e,QH)}getParser(){return this.parser}}class lY extends v{constructor(e){super(e,JH)}getParser(){return this.parser}}class pN extends v{constructor(e){super(e,$H)}getParser(){return this.parser}}class IN extends v{constructor(e){super(e,e2)}getParser(){return this.parser}}class cY extends v{constructor(e){super(e,t2)}getParser(){return this.parser}}class uY extends v{constructor(e){super(e,r2)}getParser(){return this.parser}}class hY extends v{constructor(e){super(e,n2)}getParser(){return this.parser}}class Km extends v{constructor(e){super(e,g1)}getParser(){return this.parser}}class TN extends v{constructor(e){super(e,Ad)}getParser(){return this.parser}}class RN extends v{constructor(e){super(e,f1)}getParser(){return this.parser}}class dY extends v{constructor(e){super(e,CO)}getParser(){return this.parser}}class Xm extends v{constructor(e){super(e,E1)}getParser(){return this.parser}}class qm extends v{constructor(e){super(e,p1)}getParser(){return this.parser}}class Nl extends v{constructor(e){super(e,T1)}getParser(){return this.parser}}class xd extends v{constructor(e){super(e,R1)}getParser(){return this.parser}}class ON extends v{constructor(e){super(e,O1)}getParser(){return this.parser}}class Qm extends v{constructor(e){super(e,S1)}getParser(){return this.parser}}class SN extends v{constructor(e){super(e,C1)}getParser(){return this.parser}}class CN extends v{constructor(e){super(e,A1)}getParser(){return this.parser}}class AN extends v{constructor(e){super(e,N1)}getParser(){return this.parser}}class _Y extends v{constructor(e){super(e,y1)}getParser(){return this.parser}}class gY extends v{constructor(e){super(e,M1)}getParser(){return this.parser}}class fY extends v{constructor(e){super(e,NO)}getParser(){return this.parser}}class mY extends v{constructor(e){super(e,D1)}getParser(){return this.parser}}class NN extends v{constructor(e){super(e,v1)}getParser(){return this.parser}}class yN extends v{constructor(e){super(e,b1)}getParser(){return this.parser}}class EY extends v{constructor(e){super(e,yO)}getParser(){return this.parser}}class MN extends v{constructor(e){super(e,P1)}getParser(){return this.parser}}class Jm extends v{constructor(e){super(e,L1)}getParser(){return this.parser}}class DN extends v{constructor(e){super(e,U1)}getParser(){return this.parser}}class vN extends v{constructor(e){super(e,F1)}getParser(){return this.parser}}class bN extends v{constructor(e){super(e,x1)}getParser(){return this.parser}}class PN extends v{constructor(e){super(e,kl)}getParser(){return this.parser}}const Wl=class Qo{constructor(e){this._type=e.readInt(),this._userId=e.readInt(),this._userName=e.readString(),this._figure=e.readString(),this._memberSince=e.readString()}get userId(){return this._userId}get userName(){return this._userName}get admin(){return this._type==Qo.TYPE_ADMIN}get owner(){return this._type==Qo.TYPE_OWNER}get pending(){return this._type==Qo.TYPE_PENDING}get member(){return this._type!=Qo.TYPE_MEMBER}get blocked(){return this._type==Qo.TYPE_BLOCKED}get figure(){return this._figure}get memberSince(){return this._memberSince}};Wl.TYPE_OWNER=0;Wl.TYPE_ADMIN=1;Wl.TYPE_PENDING=2;Wl.TYPE_MEMBER=3;Wl.TYPE_BLOCKED=4;let pY=Wl;class LN extends v{constructor(e){super(e,nG)}getParser(){return this.parser}}class UN extends v{constructor(e){super(e,aG)}getParser(){return this.parser}}class Zm extends v{constructor(e){super(e,oG)}getParser(){return this.parser}}class FN extends v{constructor(e){super(e,uG)}getParser(){return this.parser}}class xN extends v{constructor(e){super(e,hG)}getParser(){return this.parser}}class IY extends v{constructor(e){super(e,dG)}getParser(){return this.parser}}class TY extends v{constructor(e){super(e,o2)}getParser(){return this.parser}}class RY{constructor(){this._data=[]}dispose(){}getMessageArray(){return this._data}}class OY{constructor(){this._data=[]}dispose(){}getMessageArray(){return this._data}}class wN{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class GN{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class BN{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class kN{constructor(e=0){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class VN{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class SY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class HN{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class jN{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class zh{constructor(e="",t="",s="",r=-1,i=-1){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=[]}assignBitmap(e){const t=ht.generateImageUrl(e);if(!t)return;const s=t.split(",")[1],r=Uint8Array.from(atob(s),i=>i.charCodeAt(0));this._data.push(r.byteLength,r.buffer)}assignBase64(e){const t=e.split(",")[1],s=Uint8Array.from(atob(t),r=>r.charCodeAt(0));this._data.push(s.byteLength,s.buffer)}}class lf extends zh{constructor(e="",t="",s="",r=-1,i=-1){super(e,t,s,r,i)}}class WN{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class YN{constructor(e,t){this._data=[e,t]}dispose(){this._data=null}getMessageArray(){return this._data}}class zN{constructor(e,t){this._data=[e,t]}dispose(){this._data=null}getMessageArray(){return this._data}}class KN{constructor(e,t,s,r,i,a){this._data=[e,t,s,r,i,a]}dispose(){this._data=null}getMessageArray(){return this._data}}class XN{constructor(e,t,s,r){this._data=[e,t,s,r]}dispose(){this._data=null}getMessageArray(){return this._data}}class qN{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class CY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class AY{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class QN{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class JN{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class NY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class yY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class $m{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class ZN{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class MY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class $N{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class DY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class vY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class bY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class PY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class LY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class ey{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class ty{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class UY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class sy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class eE{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class FY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class xY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class ry{constructor(e,t,s,r,i,a,l,c,u){this._data=[e,t,s,r,i,a,l,c,u]}getMessageArray(){return this._data}dispose(){}}class au{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class iy{constructor(e,t,s,r,i,a,l){this._data=[e,t,s,r,i,a,l]}getMessageArray(){return this._data}dispose(){}}class ny{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class wY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class ay{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class GY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class oy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class BY{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class kY{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class VY{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class HY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class jY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class WY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class YY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class zY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class KY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class ou{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}ou.CONFIRM_LEVEL_NOT_ACCEPTED=0;ou.CONFIRM_LEVEL_NOT_SUBMITTED=1;ou.CONFIRM_LEVEL_NOT_CONFIRMED=2;ou.CONFIRM_LEVEL_COMMIT=3;class XY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class ly{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class qY{constructor(e,t){this._data=[e,t.length].concat(t)}getMessageArray(){return this._data}dispose(){}}class cy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class uy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class QY{constructor(e,t){this._data=[e,t.length].concat(t)}getMessageArray(){return this._data}dispose(){}}class hy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class dy{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class _y{constructor(...e){this._data=[e.length,...e]}getMessageArray(){return this._data}dispose(){}}class cf{constructor(e,...t){this._data=[e,t.length,...t]}getMessageArray(){return this._data}dispose(){}}class JY{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class wd{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class gy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class fy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class my{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Ey{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class py{constructor(...e){this._data=[e.length,...e]}getMessageArray(){return this._data}dispose(){}}class tE{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}let Iy=class{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}};class Ty{constructor(e,t){this._data=[t.length,...t,e]}getMessageArray(){return this._data}dispose(){}}class Ry{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class ZY{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class $Y{constructor(e=!0){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class ez{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class tz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class sz{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class rz{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class iz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class nz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class az{constructor(e,t){this._data=[e,t]}dispose(){this._data=null}getMessageArray(){return this._data}}class oz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class lz{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class cz{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class uz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class Oy{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class hz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class dz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class _z{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class gz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class fz{constructor(e,t,s,r,i,a){this._data=[e,t,s,r,i,a]}dispose(){this._data=null}getMessageArray(){return this._data}}class mz{constructor(e,t,s,r,i,a){this._data=[e,t,s,r,i,a]}dispose(){this._data=null}getMessageArray(){return this._data}}class Ez{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class pz{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class Sy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}Sy.NO_ISSUE_ID=-1;class Iz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Cy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}Cy.NO_ISSUE_ID=-1;class Tz{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Rz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Oz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Ay{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Ny{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class yy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class My{constructor(e,t,s,r,i,a){this._data=[e,t,s,r,i,a.length,...a]}getMessageArray(){return this._data}dispose(){}}class Dy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class vy{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class by{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Py{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class yl{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Ly{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class uf{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class Uy{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Fy{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Gd{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class xy{constructor(e,t){this._data=[e,t.length,...t]}getMessageArray(){return this._data}dispose(){}}class wy{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class Gy{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class By{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class ky{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Vy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Sz{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class Cz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Az{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class Nz{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class yz{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class Mz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Dz{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class vz{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class bz{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class Pz{constructor(...e){this._data=[e.length],e.forEach(t=>{this._data.push(t.k),this._data.push(t._arg_2),this._data.push(t._arg_3)})}getMessageArray(){return this._data}dispose(){}}class Lz{constructor(e,t,s,r,i){this._data=[e,t,s,r,i]}getMessageArray(){return this._data}dispose(){}}class Uz{constructor(e,t,s,r){this._data=[e,t,r,s]}getMessageArray(){return this._data}dispose(){}}class Fz{constructor(e,t,s){if(this._type=e,t.length===s.length){this._data=[];for(let r=0;r<t.length;r++)this._data.push(t[r]),this._data.push(s[r])}}getMessageArray(){return this._data}dispose(){}}class Hy{constructor(e,t,s,r){this._data=[`NITRO-${Id.RENDERER_VERSION.replaceAll(".","-")}`,"HTML5",fd.HTML5,om.BROWSER]}getMessageArray(){return this._data}dispose(){}}class xz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class wz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class jy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Gz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Wy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Yy{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Bz{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class kz{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class zy{constructor(e,t,s,r,i){this._data=[e,t,s,r,i]}getMessageArray(){return this._data}dispose(){}}class Ky{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class Xy{constructor(e,t,s,r){this._data=[e,t,s,r.length/2,...r]}getMessageArray(){return this._data}dispose(){}}class qy{constructor(e,t,s,r,i){this._data=[e,t,s,r,i]}getMessageArray(){return this._data}dispose(){}}class Vz{constructor(e,t,s,r,i){this._data=[e,t,s,r,i]}getMessageArray(){return this._data}dispose(){}}class Qy{constructor(e,t,s,r,i){this._data=[e,t,s,r,i.length/2,...i]}getMessageArray(){return this._data}dispose(){}}class Hz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class jz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Wz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Yz{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Jy{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Zy{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class zz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Kz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Xz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class $y{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class qz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Qz{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Jz{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Zz{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class $z{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class e5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class t5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class s5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class r5{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class i5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class n5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class a5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class o5{constructor(e,t){this._data=[e,t.length,...t]}getMessageArray(){return this._data}dispose(){}}class l5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class c5{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class u5{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class h5{constructor(){this._data=[]}dispose(){this._data=null}getMessageArray(){return this._data}}class d5{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class _5{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class eM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class tM{constructor(){this._badges=[]}getMessageArray(){const e=[];for(let t=1;t<=this._badges.length;t++)e.push(t),e.push(this._badges[t-1]);return e}dispose(){}addActivatedBadge(e){this._badges.push(e)}}class hf{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class sM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class g5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class f5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class m5{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class df{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class rM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class iM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class nM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class aM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class _f{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class oM{constructor(...e){this._data=[e.length,...e]}getMessageArray(){return this._data}dispose(){}}class lM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class cM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class uM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class hM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class dM{constructor(e,...t){this._data=[e,t.length,...t]}getMessageArray(){return this._data}dispose(){}}class E5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class p5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class gf{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class I5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class _M{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){this._data=null}}class T5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class gM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class R5{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){this._data=null}}class fM{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){this._data=null}}class mM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class EM{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class pM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){this._data=null}}class O5{constructor(e,t,s){this._data=[e,t.length,...t,s]}getMessageArray(){return this._data}dispose(){}}class Na{constructor(e,t){this._data=[t,e.length,...e]}getMessageArray(){return this._data}dispose(){}}Na.RESOLUTION_USELESS=1;Na.RESOLUTION_ABUSIVE=2;Na.RESOLUTION_RESOLVED=3;const IM=class TM{constructor(e,t,s,r,i,a=-1){this._data=[e,t,s,r,i],a!=TM.NO_ISSUE_ID&&this._data.push(a)}getMessageArray(){return this._data}dispose(){}};IM.NO_ISSUE_ID=-1;let Ha=IM;class RM{constructor(e,t,s,r=-1){this._data=[e,t,s],r!=Ha.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class OM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class SM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class CM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class AM{constructor(e,t=0){this._data=[t,e]}getMessageArray(){return this._data}dispose(){}}class NM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class yM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class MM{constructor(e,t,s,r=-1){this._data=[e,t,s],r!=Ha.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class ff{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class zn{constructor(e,t,s){this._data=[],this._data.push(e),this._data.push(t),this._data.push(s)}getMessageArray(){return this._data}dispose(){}}zn.ACTION_ALERT=0;zn.ACTION_KICK=1;zn.ACTION_MESSAGE=3;zn.ACTION_MESSAGE_AND_SOFT_KICK=4;class DM{constructor(e,t,s,r=-1){this._data=[e,t,s],r!=Ha.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class sE{constructor(e,t,s,r=-1){this._data=[],this._data.push(e),this._data.push(t),this._data.push(""),this._data.push(""),this._data.push(s),r!=Ha.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class vM{constructor(e,t,s,r=-1){this._data=[e,t,s],r!=Ha.NO_ISSUE_ID&&this._data.push(r)}getMessageArray(){return this._data}dispose(){}}class S5{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class C5{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class bM{constructor(e,t,s,r,i=-1){this._data=[e,t,s,r],i!=Ha.NO_ISSUE_ID&&this._data.push(i)}getMessageArray(){return this._data}dispose(){}}class PM{constructor(e,t,s,r){this._data=[e.length,...e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class rE{constructor(e){this._data=[e.length,...e]}getMessageArray(){return this._data}dispose(){}}class LM{constructor(e){this._data=[e]}dispose(){this._data=null}getMessageArray(){return this._data}}class A5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class N5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class y5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class M5{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class UM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class FM{constructor(e,t,s,r,i,a){this._data=[e,t,s,r,i,a]}getMessageArray(){return this._data}dispose(){}}class D5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class xM{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class v5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class b5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class P5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class wM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Bc{constructor(e,t,s){this._data=[e,t?1:0,s?1:0]}getMessageArray(){return this._data}dispose(){}}class L5{constructor(e=0){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class U5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class iE{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class GM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class F5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class x5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class w5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class G5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class B5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class k5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class V5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class H5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class j5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class W5{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Y5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class BM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class z5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Co{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class K5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class X5{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class q5{constructor(e,t,s,r,i,a){this._data=[e,t,s,r,i,a]}getMessageArray(){return this._data}dispose(){}}class Q5{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class kM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class J5{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Z5{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class $5{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class e3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class t3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class s3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class r3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class i3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class VM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class HM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class jM{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class n3{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class a3{constructor(...e){this._data=[e.length*3],e.forEach(t=>{this._data.push(t.dayIndex),this._data.push(t.stepIndex),this._data.push(t.giftIndex)})}dispose(){this._data=null}getMessageArray(){return this._data}}class WM{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class T{}T.ACHIEVEMENT_LIST=219;T.AUTHENTICATION=-1;T.BOT_CONFIGURATION=1986;T.BOT_PICKUP=3323;T.BOT_PLACE=1592;T.BOT_SKILL_SAVE=2624;T.GET_CLUB_OFFERS=3285;T.GET_CLUB_GIFT_INFO=487;T.GET_CATALOG_INDEX=1195;T.GET_CATALOG_PAGE=412;T.CATALOG_PURCHASE=3492;T.CATALOG_PURCHASE_GIFT=1411;T.GET_PRODUCT_OFFER=2594;T.CLIENT_LATENCY=295;T.CLIENT_LATENCY_MEASURE=96;T.CLIENT_POLICY=26979;T.CLIENT_PONG=2596;T.CLIENT_TOOLBAR_TOGGLE=2313;T.CLIENT_VARIABLES=1053;T.GET_CURRENT_TIMING_CODE=2912;T.DESKTOP_NEWS=1827;T.DESKTOP_VIEW=105;T.GET_BUNDLE_DISCOUNT_RULESET=223;T.EVENT_TRACKER=3457;T.FIND_NEW_FRIENDS=516;T.FURNITURE_ALIASES=3898;T.FURNITURE_FLOOR_UPDATE=248;T.FURNITURE_MULTISTATE=99;T.FURNITURE_PICKUP=3456;T.FURNITURE_PLACE=1258;T.FURNITURE_POSTIT_PLACE=2248;T.FURNITURE_POSTIT_SAVE_STICKY_POLE=3283;T.FURNITURE_RANDOMSTATE=3617;T.FURNITURE_WALL_MULTISTATE=210;T.FURNITURE_WALL_UPDATE=168;T.GAMES_INIT=2914;T.GAMES_LIST=741;T.ACCEPTGAMEINVITE=3802;T.GAMEUNLOADEDMESSAGE=3207;T.GETGAMEACHIEVEMENTSMESSAGE=2399;T.GETGAMESTATUSMESSAGE=3171;T.GETUSERGAMEACHIEVEMENTSMESSAGE=389;T.JOINQUEUEMESSAGE=1458;T.LEAVEQUEUEMESSAGE=2384;T.RESETRESOLUTIONACHIEVEMENTMESSAGE=3144;T.GETWEEKLYGAMEREWARDWINNERS=1054;T.GAME2GETACCOUNTGAMESTATUSMESSAGE=11;T.GAME2CHECKGAMEDIRECTORYSTATUSMESSAGE=3259;T.GAME2EXITGAMEMESSAGE=1445;T.GAME2GAMECHATMESSAGE=2502;T.GAME2LOADSTAGEREADYMESSAGE=2415;T.GAME2PLAYAGAINMESSAGE=3196;T.GAME2REQUESTFULLSTATUSUPDATEMESSAGE=1598;T.GAME2GETWEEKLYFRIENDSLEADERBOARD=1232;T.GAME2GETWEEKLYLEADERBOARD=2565;T.GET_GIFT_WRAPPING_CONFIG=418;T.GROUP_ADMIN_ADD=2894;T.GROUP_ADMIN_REMOVE=722;T.GROUP_CREATE_OPTIONS=798;T.GROUP_FAVORITE=3549;T.GET_FORUM_STATS=3149;T.GET_FORUM_THREADS=873;T.GET_FORUMS_LIST=436;T.GET_FORUM_MESSAGES=232;T.GET_FORUM_THREAD=3900;T.GET_UNREAD_FORUMS_COUNT=2908;T.FORUM_MODERATE_MESSAGE=286;T.FORUM_MODERATE_THREAD=1397;T.FORUM_POST_MESSAGE=3529;T.UPDATE_FORUM_READ_MARKER=1855;T.UPDATE_FORUM_SETTINGS=2214;T.FORUM_UPDATE_THREAD=3045;T.GROUP_INFO=2991;T.GROUP_DELETE=1134;T.GROUP_MEMBER_REMOVE_CONFIRM=3593;T.GROUP_MEMBER_REMOVE=593;T.GROUP_MEMBERS=312;T.GROUP_MEMBERSHIPS=367;T.GROUP_REQUEST=998;T.GROUP_REQUEST_ACCEPT=3386;T.GROUP_REQUEST_DECLINE=1894;T.GROUP_SETTINGS=1004;T.GROUP_PARTS=813;T.GROUP_BUY=230;T.GROUP_SAVE_INFORMATION=3137;T.GROUP_SAVE_BADGE=1991;T.GROUP_SAVE_COLORS=1764;T.GROUP_SAVE_PREFERENCES=3435;T.GROUP_BADGES=21;T.GROUP_UNBLOCK_MEMBER=2864;T.GET_BADGE_POINTS_LIMITS=1371;T.REQUESTABADGE=3077;T.GETISBADGEREQUESTFULFILLED=1364;T.ITEM_CLOTHING_REDEEM=3374;T.ITEM_COLOR_WHEEL_CLICK=2144;T.ITEM_DICE_CLICK=1990;T.ITEM_DICE_CLOSE=1533;T.ITEM_DIMMER_SAVE=1648;T.ITEM_DIMMER_SETTINGS=2813;T.ITEM_DIMMER_TOGGLE=2296;T.ITEM_EXCHANGE_REDEEM=3115;T.ITEM_PAINT=711;T.SET_OBJECT_DATA=3608;T.ITEM_STACK_HELPER=3839;T.ITEM_WALL_CLICK=210;T.ITEM_WALL_UPDATE=168;T.MARKETPLACE_CONFIG=2597;T.ACCEPT_FRIEND=137;T.MESSENGER_CHAT=3567;T.DECLINE_FRIEND=2890;T.FOLLOW_FRIEND=3997;T.MESSENGER_FRIENDS=1523;T.MESSENGER_INIT=2781;T.MESSENGER_RELATIONSHIPS=2138;T.SET_RELATIONSHIP_STATUS=3768;T.REMOVE_FRIEND=1689;T.REQUEST_FRIEND=3157;T.GET_FRIEND_REQUESTS=2448;T.SEND_ROOM_INVITE=1276;T.HABBO_SEARCH=1210;T.FRIEND_LIST_UPDATE=1419;T.MOD_TOOL_USER_INFO=3295;T.GET_USER_FLAT_CATS=3027;T.NAVIGATOR_INIT=2110;T.NAVIGATOR_SEARCH=249;T.NAVIGATOR_SEARCH_CLOSE=1834;T.NAVIGATOR_SEARCH_OPEN=637;T.NAVIGATOR_SEARCH_SAVE=2226;T.GET_USER_EVENT_CATS=1782;T.NAVIGATOR_SETTINGS_SAVE=3159;T.NAVIGATOR_CATEGORY_LIST_MODE=1202;T.NAVIGATOR_DELETE_SAVED_SEARCH=1954;T.PET_INFO=2934;T.PET_PICKUP=1581;T.PET_PLACE=2647;T.PET_RESPECT=3202;T.PET_RIDE=1036;T.PET_MOVE=3449;T.PET_OPEN_PACKAGE=3698;T.PET_SELECTED=549;T.PETS_BREED=1638;T.PET_CANCEL_BREEDING=2713;T.PET_CONFIRM_BREEDING=3382;T.GET_PET_TRAINING_PANEL=2161;T.RECYCLER_PRIZES=398;T.RECYCLER_STATUS=1342;T.RECYCLER_ITEMS=2771;T.RELEASE_VERSION=4e3;T.CALL_FOR_HELP=1691;T.ROOM_AMBASSADOR_ALERT=2996;T.ROOM_BAN_GIVE=1477;T.ROOM_BAN_LIST=2267;T.ROOM_BAN_REMOVE=992;T.ROOM_CREATE=2752;T.ROOM_DELETE=532;T.ROOM_DOORBELL=1644;T.ROOM_ENTER=2312;T.ROOM_FAVORITE=3817;T.ROOM_FAVORITE_REMOVE=309;T.CAN_CREATE_ROOM=2128;T.CANCEL_ROOM_EVENT=2725;T.EDIT_ROOM_EVENT=3991;T.COMPETITION_ROOM_SEARCH=433;T.FORWARD_TO_RANDOM_PROMOTED_ROOM=10;T.FORWARD_TO_SOME_ROOM=1703;T.GET_CATEGORIES_WITH_USER_COUNT=3782;T.GET_GUEST_ROOM=2230;T.GET_OFFICIAL_ROOMS=1229;T.GET_POPULAR_ROOM_TAGS=826;T.GUILD_BASE_SEARCH=2930;T.MY_FAVOURITE_ROOMS_SEARCH=2578;T.MY_FREQUENT_ROOM_HISTORY_SEARCH=1002;T.MY_FRIENDS_ROOM_SEARCH=2266;T.MY_GUILD_BASES_SEARCH=39;T.MY_RECOMMENDED_ROOMS=2537;T.MY_ROOM_HISTORY_SEARCH=2264;T.MY_ROOM_RIGHTS_SEARCH=272;T.MY_ROOMS_SEARCH=2277;T.POPULAR_ROOMS_SEARCH=2758;T.ROOM_AD_EVENT_TAB_CLICKED=2412;T.ROOM_AD_EVENT_TAB_VIEWED=2668;T.ROOM_AD_SEARCH=2809;T.ROOM_TEXT_SEARCH=3943;T.ROOMS_WHERE_MY_FRIENDS_ARE=1786;T.ROOMS_WITH_HIGHEST_SCORE_SEARCH=2939;T.SET_ROOM_SESSION_TAGS=3305;T.UPDATE_ROOM_THUMBNAIL=2468;T.ROOM_KICK=1320;T.ROOM_LIKE=3582;T.ROOM_MODEL=2300;T.GET_OCCUPIED_TILES=1687;T.GET_ROOM_ENTRY_TILE=3559;T.ROOM_MODEL_SAVE=875;T.ROOM_MUTE=3637;T.ROOM_MUTE_USER=3485;T.ROOM_RIGHTS_GIVE=808;T.ROOM_RIGHTS_LIST=3385;T.ROOM_RIGHTS_REMOVE=2064;T.ROOM_RIGHTS_REMOVE_ALL=2683;T.ROOM_RIGHTS_REMOVE_OWN=3182;T.ROOM_SETTINGS=3129;T.ROOM_SETTINGS_SAVE=1969;T.ROOM_SETTINGS_UPDATE_ROOM_CATEGORY_AND_TRADE=1265;T.ROOM_STAFF_PICK=1918;T.ROOM_FILTER_WORDS=1911;T.ROOM_FILTER_WORDS_MODIFY=3001;T.MYSTERYBOXWAITINGCANCELEDMESSAGE=2012;T.MYSTERYBOX_OPEN_TROPHY=3074;T.SECURITY_MACHINE=2490;T.SECURITY_TICKET=2419;T.TRADE=1481;T.TRADE_ACCEPT=3863;T.TRADE_CANCEL=2341;T.TRADE_CLOSE=2551;T.TRADE_CONFIRM=2760;T.TRADE_ITEM=3107;T.TRADE_ITEM_REMOVE=3845;T.TRADE_ITEMS=1263;T.TRADE_UNACCEPT=1444;T.UNIT_ACTION=2456;T.UNIT_CHAT=1314;T.UNIT_CHAT_SHOUT=2085;T.UNIT_CHAT_WHISPER=1543;T.UNIT_DANCE=2080;T.UNIT_DROP_HAND_ITEM=2814;T.UNIT_GIVE_HANDITEM=2941;T.UNIT_LOOK=3301;T.UNIT_POSTURE=2235;T.UNIT_SIGN=1975;T.UNIT_TYPING=1597;T.UNIT_TYPING_STOP=1474;T.UNIT_WALK=3320;T.USER_BADGES=2769;T.USER_BADGES_CURRENT=2091;T.USER_BADGES_CURRENT_UPDATE=644;T.USER_BOTS=3848;T.USER_CURRENCY=273;T.USER_EFFECT_ACTIVATE=2959;T.USER_EFFECT_ENABLE=1752;T.USER_FIGURE=2730;T.USER_FURNITURE=3150;T.REQUESTFURNIINVENTORYWHENNOTINROOM=3500;T.USER_HOME_ROOM=1740;T.USER_INFO=357;T.USER_MOTTO=2228;T.USER_IGNORED=3878;T.USER_PETS=3095;T.USER_PROFILE=3265;T.USER_PROFILE_BY_NAME=2249;T.USER_RESPECT=2694;T.GET_SOUND_SETTINGS=2388;T.USER_SETTINGS_CAMERA=1461;T.USER_SETTINGS_CHAT_STYLE=1030;T.USER_SETTINGS_INVITES=1086;T.USER_SETTINGS_OLD_CHAT=1262;T.USER_SETTINGS_VOLUME=1367;T.USER_SUBSCRIPTION=3166;T.GET_WARDROBE=2742;T.SAVE_WARDROBE_OUTFIT=800;T.USER_TAGS=17;T.PEER_USERS_CLASSIFICATION=1160;T.USER_CLASSIFICATION=2285;T.VISIT_USER=2970;T.WIRED_ACTION_SAVE=2281;T.WIRED_APPLY_SNAPSHOT=3373;T.WIRED_CONDITION_SAVE=3203;T.WIRED_OPEN=768;T.WIRED_TRIGGER_SAVE=1520;T.GET_ITEM_DATA=3964;T.ONE_WAY_DOOR_CLICK=2765;T.REMOVE_WALL_ITEM=3336;T.SET_ITEM_DATA=3666;T.CATALOG_REDEEM_VOUCHER=339;T.ROOM_TONER_APPLY=2880;T.FRIEND_FURNI_CONFIRM_LOCK=3775;T.MANNEQUIN_SAVE_NAME=2850;T.MANNEQUIN_SAVE_LOOK=2209;T.PRESENT_OPEN_PRESENT=3558;T.CATALOG_SELECT_VIP_GIFT=2276;T.USER_IGNORE_ID=3314;T.USER_IGNORE=1117;T.USER_UNIGNORE=2061;T.MODTOOL_REQUEST_ROOM_INFO=707;T.MODTOOL_CHANGE_ROOM_SETTINGS=3260;T.MODTOOL_REQUEST_USER_CHATLOG=1391;T.MODTOOL_REQUEST_ROOM_CHATLOG=2587;T.MODTOOL_SANCTION_ALERT=229;T.MODTOOL_SANCTION_BAN=2766;T.MODTOOL_SANCTION_KICK=2582;T.MODTOOL_SANCTION_TRADELOCK=3742;T.MODTOOL_ALERTEVENT=1840;T.MODTOOL_SANCTION_MUTE=1945;T.MODTOOL_REQUEST_USER_ROOMS=3526;T.MODTOOL_ROOM_ALERT=3842;T.MODTOOL_PREFERENCES=31;T.CLOSE_ISSUE_DEFAULT_ACTION=2717;T.CLOSE_ISSUES=2067;T.DEFAULT_SANCTION=1681;T.GET_CFH_CHATLOG=211;T.MODTOOL_SANCTION=1392;T.PICK_ISSUES=15;T.RELEASE_ISSUES=1572;T.CONVERT_GLOBAL_ROOM_ID=314;T.REQUEST_SELL_ITEM=848;T.REQUEST_MARKETPLACE_ITEM_STATS=3288;T.MARKETPLACE_SELL_ITEM=3447;T.MARKETPLACE_REQUEST_OWN_ITEMS=2105;T.MARKETPLACE_TAKE_BACK_ITEM=434;T.MARKETPLACE_REDEEM_CREDITS=2650;T.MARKETPLACE_REQUEST_OFFERS=2407;T.MARKETPLACE_BUY_OFFER=1603;T.MARKETPLACE_BUY_TOKENS=1866;T.CATALOG_REQUESET_PET_BREEDS=1756;T.APPROVE_NAME=2109;T.UNIT_GIVE_HANDITEM_PET=2768;T.PET_MOUNT=1036;T.PET_SUPPLEMENT=749;T.FURNITURE_GROUP_INFO=2651;T.ACHIEVEMENT_RESOLUTION_OPEN=359;T.USE_PET_PRODUCT=1328;T.REMOVE_PET_SADDLE=186;T.TOGGLE_PET_RIDING=1472;T.TOGGLE_PET_BREEDING=3379;T.UNSEEN_RESET_CATEGORY=3493;T.UNSEEN_RESET_ITEMS=2343;T.COMMUNITY_GOAL_VOTE_COMPOSER=3536;T.GET_PROMO_ARTICLES=1827;T.ACCEPT_QUEST=3604;T.ACTIVATE_QUEST=793;T.CANCEL_QUEST=3133;T.FRIEND_REQUEST_QUEST_COMPLETE=1148;T.GET_COMMUNITY_GOAL_EARNED_PRIZES=2688;T.GET_COMMUNITY_GOAL_HALL_OF_FAME=2167;T.GET_COMMUNITY_GOAL_PROGRESS=1145;T.GET_CONCURRENT_USERS_GOAL_PROGRESS=1343;T.GET_CONCURRENT_USERS_REWARD=3872;T.GET_DAILY_QUEST=2486;T.GET_QUESTS=3333;T.GET_SEASONAL_QUESTS_ONLY=1190;T.OPEN_QUEST_TRACKER=2750;T.REDEEM_COMMUNITY_GOAL_PRIZE=90;T.REJECT_QUEST=2397;T.START_CAMPAIGN=1697;T.GET_BONUS_RARE_INFO=957;T.CRAFT=3591;T.CRAFT_SECRET=1251;T.GET_CRAFTABLE_PRODUCTS=633;T.GET_CRAFTING_RECIPE=1173;T.GET_CRAFTING_RECIPES_AVAILABLE=3086;T.PHOTO_COMPETITION=3959;T.PUBLISH_PHOTO=2068;T.PURCHASE_PHOTO=2408;T.RENDER_ROOM=3226;T.RENDER_ROOM_THUMBNAIL=1982;T.REQUEST_CAMERA_CONFIGURATION=796;T.ADD_JUKEBOX_DISK=753;T.GET_JUKEBOX_PLAYLIST=1435;T.GET_NOW_PLAYING=1325;T.GET_OFFICIAL_SONG_ID=3189;T.GET_SONG_INFO=3082;T.GET_SOUND_MACHINE_PLAYLIST=3498;T.GET_USER_SONG_DISKS=2304;T.REMOVE_JUKEBOX_DISK=3050;T.INTERSTITIAL_SHOWN=1109;T.GET_INTERSTITIAL=2519;T.CHANGE_USERNAME=2977;T.CHECK_USERNAME=3950;T.OPEN_CAMPAIGN_CALENDAR_DOOR_STAFF=3889;T.OPEN_CAMPAIGN_CALENDAR_DOOR=2257;T.BUILDERS_CLUB_PLACE_ROOM_ITEM=1051;T.BUILDERS_CLUB_PLACE_WALL_ITEM=462;T.BUILDERS_CLUB_QUERY_FURNI_COUNT=2529;T.GET_CATALOG_PAGE_EXPIRATION=742;T.GET_CATALOG_PAGE_WITH_EARLIEST_EXP=3135;T.GET_DIRECT_CLUB_BUY_AVAILABLE=801;T.GET_HABBO_BASIC_MEMBERSHIP_EXTEND_OFFER=603;T.GET_HABBO_CLUB_EXTEND_OFFER=2462;T.GET_IS_OFFER_GIFTABLE=1347;T.GET_LIMITED_OFFER_APPEARING_NEXT=410;T.GET_NEXT_TARGETED_OFFER=596;T.GET_ROOM_AD_PURCHASE_INFO=1075;T.GET_SEASONAL_CALENDAR_DAILY_OFFER=3257;T.GET_TARGETED_OFFER=2487;T.MARK_CATALOG_NEW_ADDITIONS_PAGE_OPENED=2150;T.PURCHASE_BASIC_MEMBERSHIP_EXTENSION=2735;T.PURCHASE_ROOM_AD=777;T.PURCHASE_TARGETED_OFFER=1826;T.PURCHASE_VIP_MEMBERSHIP_EXTENSION=3407;T.ROOM_AD_PURCHASE_INITIATED=2283;T.SET_TARGETTED_OFFER_STATE=2041;T.SHOP_TARGETED_OFFER_VIEWED=3483;T.HELPER_TALENT_TRACK=196;T.TALENT_TRACK_GET_LEVEL=2127;T.FORWARD_TO_A_COMPETITION_ROOM=172;T.FORWARD_TO_A_SUBMITTABLE_ROOM=1450;T.FORWARD_TO_RANDOM_COMPETITION_ROOM=865;T.GET_IS_USER_PART_OF_COMPETITION=2077;T.GET_SECONDS_UNTIL=271;T.ROOM_COMPETITION_INIT=1334;T.SUBMIT_ROOM_TO_COMPETITION=2595;T.VOTE_FOR_ROOM=143;T.GET_GIFT=2436;T.RESET_PHONE_NUMBER_STATE=2741;T.SET_PHONE_NUMBER_VERIFICATION_STATUS=1379;T.TRY_PHONE_NUMBER=790;T.VERIFY_CODE=2721;T.CONTROL_YOUTUBE_DISPLAY_PLAYBACK=3005;T.GET_YOUTUBE_DISPLAY_STATUS=336;T.SET_YOUTUBE_DISPLAY_PLAYLIST=2069;T.GO_TO_FLAT=685;T.CHANGE_QUEUE=3093;T.CALL_FOR_HELP_FROM_FORUM_MESSAGE=1412;T.CALL_FOR_HELP_FROM_FORUM_THREAD=534;T.CALL_FOR_HELP_FROM_IM=2950;T.CALL_FOR_HELP_FROM_PHOTO=2492;T.CALL_FOR_HELP_FROM_SELFIE=2755;T.CHAT_REVIEW_GUIDE_DECIDES=3365;T.CHAT_REVIEW_GUIDE_DETACHED=2501;T.CHAT_REVIEW_GUIDE_VOTE=3961;T.CHAT_REVIEW_SESSION_CREATE=3060;T.DELETE_PENDING_CALLS_FOR_HELP=3605;T.GET_CFH_STATUS=2746;T.GET_FAQ_CATEGORY=3445;T.GET_FAQ_TEXT=1849;T.GET_GUIDE_REPORTING_STATUS=3786;T.GET_PENDING_CALLS_FOR_HELP=3267;T.GET_QUIZ_QUESTIONS=1296;T.GUIDE_SESSION_CREATE=3338;T.GUIDE_SESSION_FEEDBACK=477;T.GUIDE_SESSION_GET_REQUESTER_ROOM=1052;T.GUIDE_SESSION_GUIDE_DECIDES=1424;T.GUIDE_SESSION_INVITE_REQUESTER=234;T.GUIDE_SESSION_IS_TYPING=519;T.GUIDE_SESSION_MESSAGE=3899;T.GUIDE_SESSION_ON_DUTY_UPDATE=1922;T.GUIDE_SESSION_REPORT=3969;T.GUIDE_SESSION_REQUESTER_CANCELS=291;T.GUIDE_SESSION_RESOLVED=887;T.POST_QUIZ_ANSWERS=3720;T.SEARCH_FAQS=2031;T.POLL_ANSWER=3505;T.POLL_REJECT=1773;T.POLL_START=109;T.POLL_VOTE_COUNTER=6200;T.DISCONNECT=2445;T.SCR_GET_KICKBACK_INFO=869;T.COMPOST_PLANT=3835;T.HARVEST_PET=1521;T.SET_CLOTHING_CHANGE_DATA=924;T.GROUP_UNFAVORITE=1820;T.NEW_USER_EXPERIENCE_GET_GIFTS=1822;T.NEW_USER_EXPERIENCE_SCRIPT_PROCEED=1299;T.HANDSHAKE_INIT_DIFFIE=3110;T.HANDSHAKE_COMPLETE_DIFFIE=773;T.WELCOME_OPEN_GIFT=2638;T.WELCOME_GIFT_CHANGE_EMAIL=66;T.EMAIL_GET_STATUS=2557;T.EMAIL_CHANGE=3965;T.APPROVE_ALL_MEMBERSHIP_REQUESTS=882;T.RENTABLE_SPACE_CANCEL_RENT=1667;T.RENTABLE_SPACE_RENT=2946;T.RENTABLE_SPACE_STATUS=872;T.TRACKING_PERFORMANCE_LOG=3230;T.TRACKING_LAG_WARNING_REPORT=3847;T.ROOM_DIRECTORY_ROOM_NETWORK_OPEN_CONNECTION=3736;T.RENTABLE_EXTEND_RENT_OR_BUYOUT_STRIP_ITEM=2115;T.RENTABLE_EXTEND_RENT_OR_BUYOUT_FURNI=1071;T.RENTABLE_GET_RENT_OR_BUYOUT_OFFER=2518;class YM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class mf{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class lu{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class o3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class zM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class KM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class XM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class qM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class QM{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class JM{constructor(e,t,s){this._data=[e,t,s.length,...s]}getMessageArray(){return this._data}dispose(){}}class ZM{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class $M{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class eD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class l3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class c3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class u3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class h3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class d3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class _3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class g3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class f3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class m3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class E3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class p3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class I3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class T3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class R3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class O3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class S3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class C3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class A3{constructor(...e){this._data=[e.length],e.forEach(t=>{this._data.push(t.itemId)})}getMessageArray(){return this._data}dispose(){}}class tD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class sD{constructor(e,t=null){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class rD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class iD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class nD{constructor(e,t=0,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class aD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class oD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class lD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class cD{constructor(e,t,s=0){this._data=[e,s,t]}getMessageArray(){return this._data}dispose(){}}class nE{constructor(...e){this._data=[e.length,...e]}getMessageArray(){return this._data}dispose(){}}class uD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class hD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class aE{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class oE{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class dD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class _D{constructor(e,t,s,r,i,a,l,c,u,h,d,f,E,m,R,I,S,A,N,L,M,b,B,w){this._data=[],this._data.push(e,t,s,r,i,a,l),this._data.push(u.length,...u),this._data.push(h,d,f,E,m,R,I,S,A,N,L,M,b,B,w)}getMessageArray(){return this._data}dispose(){}}class gD{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class Bd{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class an{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class fD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class mD extends fD{constructor(e){super(e)}}class ED{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class pD extends fD{constructor(e){super(e)}}class Ef{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class ID{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class TD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class RD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class OD{constructor(e,t,s=""){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class SD{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class lE{constructor(e,t){this._data=[e,t.size*2];for(const[s,r]of t.entries())this._data.push(s,r)}getMessageArray(){return this._data}dispose(){}}class CD{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class AD{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class ND{constructor(e,t,s,r,i){this._data=[e,t,s,r,i]}getMessageArray(){return this._data}dispose(){}}class yD{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class N3{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class y3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class pf{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class MD{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class DD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class vD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class cE{constructor(e,t,s,r,i,a){this._itemId=e,this._category=t,this._wallLocation=s,this._x=r,this._y=i,this._direction=a}getMessageArray(){switch(this._category){case k.FLOOR:return[`${this._itemId} ${this._x} ${this._y} ${this._direction}`];case k.WALL:return[`${this._itemId} ${this._wallLocation} `];default:return[]}}dispose(){}}class Dc{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class bD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class M3{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class PD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class LD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class UD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class FD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Ml{constructor(e,t=0){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class xD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class wD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class Kh{constructor(e,t=-100){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class GD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class BD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class kD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class VD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class uE{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class D3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class HD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class v3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class b3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class P3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class jD{constructor(e,t,s,r){this._data=[e,t,s,r]}getMessageArray(){return this._data}dispose(){}}class WD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class fc{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class YD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class If{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class zD{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Tf{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class KD{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class hE{constructor(e,t,s,r,i,a,l){this._data=[e,t,s,r,i,a,l]}getMessageArray(){return this._data}dispose(){}}class XD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class qD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class QD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class dE{constructor(e,t=0){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class JD{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class ZD{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class $D{constructor(e,t,s){this._data=[e+" "+t,s]}getMessageArray(){return this._data}dispose(){}}class ev{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class tv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class sv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class rv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class iv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class nv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class _E{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class av{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class ov{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class lv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class cv{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class kd{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}kd.STATE_START=0;kd.STATE_CANCEL=1;kd.STATE_ACCEPT=2;class L3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class U3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class F3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class x3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class uv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class hv{constructor(e,t,s,r,i,a){this._data=[e,t.length,...t,s,r.length,...r,i,a]}getMessageArray(){return this._data}dispose(){}}class dv{constructor(e,t,s,r,i){this._data=[e,t.length,...t,s,r.length,...r,i]}getMessageArray(){return this._data}dispose(){}}class _v{constructor(e,t,s,r,i){this._data=[e,t.length,...t,s,r.length,...r,i]}getMessageArray(){return this._data}dispose(){}}class w3{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class gv{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class fv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class mv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Ev{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class pv{constructor(...e){this._data=[e.length].concat(e)}getMessageArray(){return this._data}dispose(){}}class G3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class B3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Iv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Tv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class k3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class V3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class H3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class j3{constructor(e,t,s,r,i,a,l,c,u,h,d){this._data=[e,t,s,r,i,a,l,c,u,h,d]}getMessageArray(){return this._data}dispose(){}}class Rv{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class gE{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class W3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Y3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Ov{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Sv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Cv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Av{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Nv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class fE{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class mE{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class yv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Mv{constructor(e,t=!0){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class EE{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class z3{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Dv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class vv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Rf{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class bv{constructor(){this._data=[]}getMessageArray(){return this._data}dispose(){}}class Pv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Lv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Uv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Fv{constructor(e,t,s){this._data=[e,t,s]}getMessageArray(){return this._data}dispose(){}}class K3{constructor(e,t){this._data=[e,t]}getMessageArray(){return this._data}dispose(){}}class xv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class X3{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class wv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class Gv{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}class q3 extends En{constructor(e){super(),this._communication=e,this._handShaking=!1,this._didConnect=!1,this._pongInterval=null,this.onConnectionOpenedEvent=this.onConnectionOpenedEvent.bind(this),this.onConnectionClosedEvent=this.onConnectionClosedEvent.bind(this),this.onConnectionErrorEvent=this.onConnectionErrorEvent.bind(this),this.sendPong=this.sendPong.bind(this)}onInit(){const e=this._communication.connection;e&&(e.addEventListener(Ps.CONNECTION_OPENED,this.onConnectionOpenedEvent),e.addEventListener(Ps.CONNECTION_CLOSED,this.onConnectionClosedEvent),e.addEventListener(Ps.CONNECTION_ERROR,this.onConnectionErrorEvent)),this._communication.registerMessageEvent(new NS(this.onClientPingEvent.bind(this))),this._communication.registerMessageEvent(new _N(this.onAuthenticatedEvent.bind(this)))}onDispose(){const e=this._communication.connection;e&&(e.removeEventListener(Ps.CONNECTION_OPENED,this.onConnectionOpenedEvent),e.removeEventListener(Ps.CONNECTION_CLOSED,this.onConnectionClosedEvent),e.removeEventListener(Ps.CONNECTION_ERROR,this.onConnectionErrorEvent)),this._handShaking=!1,this.stopPonging(),super.onDispose()}onConnectionOpenedEvent(e){const t=this._communication.connection;t&&(this._didConnect=!0,this.dispatchCommunicationDemoEvent(Qt.CONNECTION_ESTABLISHED,t),Ue.getValue("system.pong.manually",!1)&&this.startPonging(),this.startHandshake(t),t.send(new Hy(null,null,null,null)),this.tryAuthentication(t))}onConnectionClosedEvent(e){const t=this._communication.connection;t&&(this.stopPonging(),this._didConnect&&this.dispatchCommunicationDemoEvent(Qt.CONNECTION_CLOSED,t))}onConnectionErrorEvent(e){const t=this._communication.connection;t&&(this.stopPonging(),this.dispatchCommunicationDemoEvent(Qt.CONNECTION_ERROR,t))}tryAuthentication(e){if(!e||!this.getSSO()){this.getSSO()||me.error("Login without an SSO ticket is not supported"),this.dispatchCommunicationDemoEvent(Qt.CONNECTION_HANDSHAKE_FAILED,e);return}e.send(new Yy(this.getSSO(),ve()))}onClientPingEvent(e){!e||!e.connection||this.sendPong(e.connection)}onAuthenticatedEvent(e){!e||!e.connection||(this.completeHandshake(e.connection),this.dispatchCommunicationDemoEvent(Qt.CONNECTION_AUTHENTICATED,e.connection),e.connection.send(new jy))}startHandshake(e){this.dispatchCommunicationDemoEvent(Qt.CONNECTION_HANDSHAKING,e),this._handShaking=!0}completeHandshake(e){this.dispatchCommunicationDemoEvent(Qt.CONNECTION_HANDSHAKED,e),this._handShaking=!1}startPonging(){this.stopPonging(),this._pongInterval=setInterval(this.sendPong,Ue.getValue("system.pong.interval.ms",2e4))}stopPonging(){this._pongInterval&&(clearInterval(this._pongInterval),this._pongInterval=null)}sendPong(e=null){e=e||this._communication.connection||null,e&&e.send(new Wy)}dispatchCommunicationDemoEvent(e,t){pe.instance.events.dispatchEvent(new Qt(e,t))}getSSO(){return Ue.getValue("sso.ticket",null)}}class Q3{constructor(){this._events=new Map,this._composers=new Map,this.registerEvents(),this.registerComposers()}registerEvents(){this._events.set(O.INTERSTITIAL_MESSAGE,l2),this._events.set(O.ROOM_AD_ERROR,c2),this._events.set(O.AVAILABILITY_STATUS,jO),this._events.set(O.AVAILABILITY_TIME,u2),this._events.set(O.HOTEL_CLOSED_AND_OPENS,WO),this._events.set(O.HOTEL_CLOSES_AND_OPENS_AT,YO),this._events.set(O.HOTEL_WILL_CLOSE_MINUTES,zO),this._events.set(O.HOTEL_MAINTENANCE,KO),this._events.set(O.USER_CHANGE_NAME,ji),this._events.set(O.CHECK_USER_NAME,XO),this._events.set(O.USER_FIGURE,Pm),this._events.set(O.USER_OUTFITS,h2),this._events.set(O.ADD_BOT_TO_INVENTORY,qO),this._events.set(O.USER_BOTS,QO),this._events.set(O.BOT_RECEIVED,d2),this._events.set(O.REMOVE_BOT_FROM_INVENTORY,JO),this._events.set(O.CFH_SANCTION,ZO),this._events.set(O.CFH_TOPICS,$O),this._events.set(O.CFH_SANCTION_STATUS,eS),this._events.set(O.CAMERA_PUBLISH_STATUS,tS),this._events.set(O.CAMERA_PURCHASE_OK,sS),this._events.set(O.CAMERA_STORAGE_URL,rS),this._events.set(O.COMPETITION_STATUS,g2),this._events.set(O.INIT_CAMERA,iS),this._events.set(O.THUMBNAIL_STATUS,f2),this._events.set(O.CAMERA_SNAPSHOT,_2),this._events.set(O.CAMPAIGN_CALENDAR_DATA,nS),this._events.set(O.CAMPAIGN_CALENDAR_DOOR_OPENED,aS),this._events.set(O.BONUS_RARE_INFO,m2),this._events.set(O.BUILDERS_CLUB_FURNI_COUNT,oS),this._events.set(O.BUILDERS_CLUB_SUBSCRIPTION,lS),this._events.set(O.BUNDLE_DISCOUNT_RULESET,E2),this._events.set(O.CATALOG_PAGE_EXPIRATION,p2),this._events.set(O.CATALOG_PAGE,cS),this._events.set(O.CATALOG_PAGE_LIST,uS),this._events.set(O.CATALOG_EARLIEST_EXPIRY,I2),this._events.set(O.CATALOG_PUBLISHED,hS),this._events.set(O.CLUB_GIFT_INFO,Lm),this._events.set(O.CLUB_GIFT_SELECTED,dS),this._events.set(O.DIRECT_SMS_CLUB_BUY,T2),this._events.set(O.GIFT_RECEIVER_NOT_FOUND,_S),this._events.set(O.GIFT_WRAPPER_CONFIG,gS),this._events.set(O.CLUB_EXTENDED_OFFER,O2),this._events.set(O.CLUB_OFFERS,fS),this._events.set(O.IS_OFFER_GIFTABLE,S2),this._events.set(O.LIMITED_SOLD_OUT,mS),this._events.set(O.LIMITED_OFFER_APPEARING_NEXT,C2),this._events.set(O.NOT_ENOUGH_BALANCE,A2),this._events.set(O.PRODUCT_OFFER,ES),this._events.set(O.CATALOG_PURCHASE_ERROR,pS),this._events.set(O.CATALOG_PURCHASE_NOT_ALLOWED,IS),this._events.set(O.CATALOG_PURCHASE_OK,TS),this._events.set(O.ROOM_AD_PURCHASE,RS),this._events.set(O.SEASONAL_CALENDAR_OFFER,N2),this._events.set(O.CATALOG_RECEIVE_PET_BREEDS,OS),this._events.set(O.TARGET_OFFER,SS),this._events.set(O.TARGET_OFFER_NOT_FOUND,y2),this._events.set(O.REDEEM_VOUCHER_ERROR,CS),this._events.set(O.REDEEM_VOUCHER_OK,AS),this._events.set(O.CLIENT_PING,NS),this._events.set(O.COMPETITION_ENTRY_SUBMIT,M2),this._events.set(O.COMPETITION_VOTING_INFO,D2),this._events.set(O.COMPETITION_TIMING_CODE,v2),this._events.set(O.COMPETITION_USER_PART_OF,b2),this._events.set(O.COMPETITION_NO_OWNED_ROOMS,P2),this._events.set(O.COMPETITION_SECONDS_UNTIL,L2),this._events.set(O.CRAFTABLE_PRODUCTS,yS),this._events.set(O.CRAFTING_RECIPE,MS),this._events.set(O.CRAFTING_RECIPES_AVAILABLE,DS),this._events.set(O.CRAFTING_RESULT,vS),this._events.set(O.DESKTOP_VIEW,Gc),this._events.set(O.MESSENGER_ACCEPT_FRIENDS,U2),this._events.set(O.MESSENGER_FIND_FRIENDS,F2),this._events.set(O.MESSENGER_FOLLOW_FAILED,x2),this._events.set(O.MESSENGER_FRIENDS,bS),this._events.set(O.MESSENGER_UPDATE,PS),this._events.set(O.MESSENGER_FRIEND_NOTIFICATION,w2),this._events.set(O.MESSENGER_REQUESTS,LS),this._events.set(O.MESSENGER_SEARCH,US),this._events.set(O.MESSENGER_INSTANCE_MESSAGE_ERROR,G2),this._events.set(O.MESSENGER_MESSAGE_ERROR,B2),this._events.set(O.MESSENGER_INIT,FS),this._events.set(O.MESSENGER_MINIMAIL_NEW,k2),this._events.set(O.MESSENGER_MINIMAIL_COUNT,V2),this._events.set(O.MESSENGER_CHAT,Um),this._events.set(O.MESSENGER_REQUEST,Fm),this._events.set(O.MESSENGER_INVITE_ERROR,xS),this._events.set(O.MESSENGER_INVITE,xm),this._events.set(O.ACHIEVEMENTRESOLUTIONCOMPLETED,q2),this._events.set(O.ACHIEVEMENTRESOLUTIONPROGRESS,Q2),this._events.set(O.ACHIEVEMENTRESOLUTIONS,J2),this._events.set(O.LOAD_GAME_URL,wS),this._events.set(O.LOADGAME,nj),this._events.set(O.UNLOADGAME,aj),this._events.set(O.GAME_CENTER_GAME_LIST,ej),this._events.set(O.GAMESTATUSMESSAGE,tj),this._events.set(O.GAME_CENTER_ACHIEVEMENTS,oj),this._events.set(O.GAME_CENTER_STATUS,H2),this._events.set(O.GAME_CENTER_IN_ARENA_QUEUE,W2),this._events.set(O.GAME_CENTER_STOP_COUNTER,K2),this._events.set(O.GAME_CENTER_USER_LEFT_GAME,X2),this._events.set(O.GAME_CENTER_DIRECTORY_STATUS,j2),this._events.set(O.GAME_CENTER_STARTING_GAME_FAILED,z2),this._events.set(O.GAME_CENTER_JOINING_FAILED,Y2),this._events.set(O.GAMEACHIEVEMENTS,Z2),this._events.set(O.GAMEINVITE,$2),this._events.set(O.JOINEDQUEUEMESSAGE,sj),this._events.set(O.JOININGQUEUEFAILED,rj),this._events.set(O.LEFTQUEUE,ij),this._events.set(O.WEEKLY_GAME_REWARD,dj),this._events.set(O.WEEKLY_GAME_REWARD_WINNERS,_j),this._events.set(O.WEEKLY_COMPETITIVE_LEADERBOARD,hj),this._events.set(O.WEEKLY_COMPETITIVE_FRIENDS_LEADERBOARD,uj),this._events.set(O.WEEKLY_GAME2_FRIENDS_LEADERBOARD,lj),this._events.set(O.WEEKLY_GAME2_LEADERBOARD,cj),this._events.set(O.GROUP_INFO,jl),this._events.set(O.GROUP_MEMBER_REMOVE_CONFIRM,BS),this._events.set(O.GROUP_MEMBERS,kS),this._events.set(O.GROUP_CREATE_OPTIONS,GS),this._events.set(O.GROUP_BADGE_PARTS,wm),this._events.set(O.GROUP_SETTINGS,HS),this._events.set(O.GROUP_PURCHASED,VS),this._events.set(O.GROUP_BADGES,yN),this._events.set(O.GROUP_DEACTIVATE,jS),this._events.set(O.GROUP_MEMBERSHIP_REQUESTED,gY),this._events.set(O.GROUP_DETAILS_CHANGED,_Y),this._events.set(O.GROUP_HABBO_JOIN_FAILED,EY),this._events.set(O.GROUP_FORUM_DATA,Ej),this._events.set(O.GROUP_FORUM_LIST,pj),this._events.set(O.GROUP_FORUM_THREADS,Ij),this._events.set(O.GROUP_FORUM_POST,Tj),this._events.set(O.GROUP_FORUM_POST_THREAD,Rj),this._events.set(O.GROUP_FORUM_THREAD_MESSAGES,Oj),this._events.set(O.GROUP_FORUM_UNREAD_COUNT,Sj),this._events.set(O.GROUP_FORUM_UPDATE_MESSAGE,Cj),this._events.set(O.GROUP_FORUM_UPDATE_THREAD,Aj),this._events.set(O.CFH_DISABLED_NOTIFY,YS),this._events.set(O.CFH_PENDING_CALLS_DELETED,zS),this._events.set(O.CFH_PENDING_CALLS,KS),this._events.set(O.CFH_REPLY,XS),this._events.set(O.CFH_RESULT_MESSAGE,qS),this._events.set(O.GUIDE_ON_DUTY_STATUS,Fj),this._events.set(O.GUIDE_SESSION_ATTACHED,wj),this._events.set(O.GUIDE_SESSION_DETACHED,Gj),this._events.set(O.GUIDE_SESSION_ENDED,QS),this._events.set(O.GUIDE_SESSION_ERROR,JS),this._events.set(O.GUIDE_SESSION_INVITED_TO_GUIDE_ROOM,Bj),this._events.set(O.GUIDE_SESSION_MESSAGE,kj),this._events.set(O.GUIDE_SESSION_PARTNER_IS_TYPING,Vj),this._events.set(O.GUIDE_SESSION_REQUESTER_ROOM,Hj),this._events.set(O.GUIDE_SESSION_STARTED,ZS),this._events.set(O.GUIDE_TICKET_CREATION_RESULT,jj),this._events.set(O.GUIDE_TICKET_RESOLUTION,Wj),this._events.set(O.GUIDE_REPORTING_STATUS,xj),this._events.set(O.HOTEL_MERGE_NAME_CHANGE,Yj),this._events.set(O.ISSUE_CLOSE_NOTIFICATION,$S),this._events.set(O.QUIZ_DATA,zj),this._events.set(O.QUIZ_RESULTS,Kj),this._events.set(O.CHAT_REVIEW_SESSION_DETACHED,vj),this._events.set(O.CHAT_REVIEW_SESSION_OFFERED_TO_GUIDE,bj),this._events.set(O.CHAT_REVIEW_SESSION_RESULTS,Pj),this._events.set(O.CHAT_REVIEW_SESSION_STARTED,Lj),this._events.set(O.CHAT_REVIEW_SESSION_VOTING_STATUS,Uj),this._events.set(O.ACHIEVEMENT_PROGRESSED,eC),this._events.set(O.ACHIEVEMENT_LIST,tC),this._events.set(O.USER_ACHIEVEMENT_SCORE,sC),this._events.set(O.USER_EFFECT_ACTIVATE,Xj),this._events.set(O.USER_EFFECT_LIST_ADD,qj),this._events.set(O.USER_EFFECT_LIST_REMOVE,Qj),this._events.set(O.USER_EFFECT_LIST,Zj),this._events.set(O.AVATAR_EFFECT_SELECTED,Jj),this._events.set(O.USER_BADGES,iC),this._events.set(O.USER_BADGES_ADD,rC),this._events.set(O.BADGE_POINT_LIMITS,Gm),this._events.set(O.BADGE_REQUEST_FULFILLED,$j),this._events.set(O.USER_CLOTHING,nC),this._events.set(O.USER_FURNITURE_ADD,Bm),this._events.set(O.USER_FURNITURE,Ph),this._events.set(O.USER_FURNITURE_REFRESH,aC),this._events.set(O.USER_FURNITURE_REMOVE,km),this._events.set(O.USER_FURNITURE_POSTIT_PLACED,oC),this._events.set(O.USER_PETS,uC),this._events.set(O.USER_PET_REMOVE,dC),this._events.set(O.USER_PET_ADD,cC),this._events.set(O.PET_RECEIVED,hC),this._events.set(O.PET_PLACING_ERROR,gA),this._events.set(O.YOUTUBE_CONTROL_VIDEO,WA),this._events.set(O.YOUTUBE_DISPLAY_PLAYLISTS,YA),this._events.set(O.YOUTUBE_DISPLAY_VIDEO,zA),this._events.set(O.TRADE_ACCEPTED,_C),this._events.set(O.TRADE_CLOSED,gC),this._events.set(O.TRADE_COMPLETED,fC),this._events.set(O.TRADE_CONFIRMATION,mC),this._events.set(O.TRADE_LIST_ITEM,EC),this._events.set(O.TRADE_NOT_OPEN,pC),this._events.set(O.TRADE_OPEN_FAILED,TC),this._events.set(O.TRADE_OPEN,IC),this._events.set(O.TRADE_OTHER_NOT_ALLOWED,RC),this._events.set(O.TRADE_YOU_NOT_ALLOWED,OC),this._events.set(O.TRADE_NO_SUCH_ITEM,rW),this._events.set(O.COMMUNITY_GOAL_VOTE_EVENT,nW),this._events.set(O.PROMO_ARTICLES,iW),this._events.set(O.MARKETPLACE_AFTER_ORDER_STATUS,SC),this._events.set(O.MARKETPLACE_CANCEL_SALE,CC),this._events.set(O.MARKETPLACE_SELL_ITEM,aW),this._events.set(O.MARKETPLACE_CONFIG,AC),this._events.set(O.MARKETPLACE_ITEM_STATS,oW),this._events.set(O.MARKETPLACE_ITEM_POSTED,NC),this._events.set(O.MARKETPLACE_ITEMS_SEARCHED,yC),this._events.set(O.MARKETPLACE_OWN_ITEMS,MC),this._events.set(O.USER_BANNED,HC),this._events.set(O.MODERATION_CAUTION,UC),this._events.set(O.MODTOOL_ROOM_INFO,wC),this._events.set(O.MODTOOL_USER_CHATLOG,jC),this._events.set(O.MODTOOL_ROOM_CHATLOG,kC),this._events.set(O.MODERATION_USER_INFO,BC),this._events.set(O.MODERATION_TOOL,FC),this._events.set(O.MODTOOL_VISITED_ROOMS_USER,VC),this._events.set(O.CFH_CHATLOG,DC),this._events.set(O.ISSUE_DELETED,vC),this._events.set(O.ISSUE_INFO,bC),this._events.set(O.ISSUE_PICK_FAILED,PC),this._events.set(O.MODERATOR_ACTION_RESULT,LC),this._events.set(O.MODERATOR_MESSAGE,xC),this._events.set(O.MODERATOR_TOOL_PREFERENCES,GC),this._events.set(O.MYSTERY_BOX_KEYS,zC),this._events.set(O.GOTMYSTERYBOXPRIZEMESSAGE,YC),this._events.set(O.CANCELMYSTERYBOXWAITMESSAGE,WC),this._events.set(O.SHOWMYSTERYBOXWAITMESSAGE,KC),this._events.set(O.CAN_CREATE_ROOM,lW),this._events.set(O.CAN_CREATE_ROOM_EVENT,XC),this._events.set(O.CATEGORIES_WITH_VISITOR_COUNT,cW),this._events.set(O.COMPETITION_ROOMS_DATA,uW),this._events.set(O.CONVERTED_ROOM_ID,hW),this._events.set(O.ROOM_DOORBELL,Vm),this._events.set(O.USER_FAVORITE_ROOM,dW),this._events.set(O.USER_FAVORITE_ROOM_COUNT,_W),this._events.set(O.ROOM_DOORBELL_REJECTED,Lh),this._events.set(O.ROOM_CREATED,qC),this._events.set(O.ROOM_INFO,sa),this._events.set(O.GUEST_ROOM_SEARCH_RESULT,gW),this._events.set(O.USER_HOME_ROOM,QC),this._events.set(O.ROOM_EVENT_CANCEL,TW),this._events.set(O.ROOM_EVENT,eA),this._events.set(O.ROOM_INFO_UPDATED,sA),this._events.set(O.THUMBNAIL_UPDATE_RESULT,RW),this._events.set(O.NAVIGATOR_EVENT_CATEGORIES,rA),this._events.set(O.NAVIGATOR_CATEGORIES,iA),this._events.set(O.NAVIGATOR_COLLAPSED,fW),this._events.set(O.NAVIGATOR_LIFTED,mW),this._events.set(O.NAVIGATOR_METADATA,JC),this._events.set(O.NAVIGATOR_OPEN_ROOM_CREATOR,ZC),this._events.set(O.NAVIGATOR_SEARCHES,EW),this._events.set(O.NAVIGATOR_SEARCH,$C),this._events.set(O.NAVIGATOR_SETTINGS,pW),this._events.set(O.GENERIC_ALERT,cA),this._events.set(O.MOTD_MESSAGES,hA),this._events.set(O.NOTIFICATION_LIST,dA),this._events.set(O.UNSEEN_ITEMS,mA),this._events.set(O.ACHIEVEMENT_NOTIFICATION,nA),this._events.set(O.INFO_FEED_ENABLE,uA),this._events.set(O.CLUB_GIFT_NOTIFICATION,oA),this._events.set(O.ACTIVITY_POINT_NOTIFICATION,Hm),this._events.set(O.BOT_ERROR,aA),this._events.set(O.PET_LEVEL_NOTIFICATION,_A),this._events.set(O.NOTIFICATION_OFFER_REWARD_DELIVERED,SW),this._events.set(O.NOTIFICATION_SIMPLE_ALERT,fA),this._events.set(O.NOTIFICATION_ELEMENT_POINTER,OW),this._events.set(O.USER_PERKS,PW),this._events.set(O.PET_TRAINING_PANEL,RA),this._events.set(O.PET_LEVEL_UPDATE,IA),this._events.set(O.PET_SCRATCH_FAILED,TA),this._events.set(O.PET_OPEN_PACKAGE_REQUESTED,EA),this._events.set(O.PET_OPEN_PACKAGE_RESULT,pA),this._events.set(O.PET_BREEDING_RESULT,XA),this._events.set(O.QUESTION,NA),this._events.set(O.POLL_CONTENTS,OA),this._events.set(O.POLL_ERROR,SA),this._events.set(O.POLL_OFFER,CA),this._events.set(O.POLL_START_ROOM,DA),this._events.set(O.QUESTION_ANSWERED,AA),this._events.set(O.QUESTION_FINISHED,yA),this._events.set(O.POLL_ROOM_RESULT,MA),this._events.set(O.COMMUNITY_GOAL_EARNED_PRIZES,UW),this._events.set(O.COMMUNITY_GOAL_PROGRESS,xW),this._events.set(O.CONCURRENT_USERS_GOAL_PROGRESS,wW),this._events.set(O.QUEST_DAILY,VW),this._events.set(O.QUEST_CANCELLED,BW),this._events.set(O.QUEST_COMPLETED,kW),this._events.set(O.COMMUNITY_GOAL_HALL_OF_FAME,FW),this._events.set(O.EPIC_POPUP,GW),this._events.set(O.SEASONAL_QUESTS,WW),this._events.set(O.QUESTS,jW),this._events.set(O.QUEST,HW),this._events.set(O.ROOM_ENTER_ERROR,vA),this._events.set(O.ROOM_ENTER,Fh),this._events.set(O.ROOM_FORWARD,bA),this._events.set(O.ROOM_DOORBELL_ACCEPTED,Uh),this._events.set(O.ROOM_RIGHTS_CLEAR,Lg),this._events.set(O.ROOM_RIGHTS_OWNER,Fg),this._events.set(O.ROOM_RIGHTS,Ug),this._events.set(O.BOT_COMMAND_CONFIGURATION,PA),this._events.set(O.BOT_SKILL_LIST_UPDATE,zW),this._events.set(O.BOT_FORCE_OPEN_CONTEXT_MENU,YW),this._events.set(O.ROOM_SETTINGS_CHAT,LA),this._events.set(O.ROOM_INFO_OWNER,Wm),this._events.set(O.ROOM_SCORE,UA),this._events.set(O.ROOM_ROLLING,wg),this._events.set(O.FURNITURE_FLOOR_ADD,Bg),this._events.set(O.FURNITURE_FLOOR,kg),this._events.set(O.FURNITURE_FLOOR_REMOVE,Vg),this._events.set(O.FURNITURE_FLOOR_UPDATE,Hg),this._events.set(O.ITEM_WALL_ADD,Kg),this._events.set(O.ITEM_WALL,Xg),this._events.set(O.ITEM_WALL_REMOVE,qg),this._events.set(O.ITEM_WALL_UPDATE,Qg),this._events.set(O.FURNITURE_ALIASES,jg),this._events.set(O.FURNITURE_DATA,Wg),this._events.set(O.FURNITURE_ITEMDATA,Yg),this._events.set(O.ITEM_STACK_HELPER,wA),this._events.set(O.FURNITURE_STATE,zg),this._events.set(O.ITEM_DIMMER_SETTINGS,jA),this._events.set(O.FURNITURE_STATE_2,Gg),this._events.set(O.LOVELOCK_FURNI_FINISHED,BA),this._events.set(O.LOVELOCK_FURNI_FRIEND_COMFIRMED,kA),this._events.set(O.LOVELOCK_FURNI_START,VA),this._events.set(O.OBJECTS_DATA_UPDATE,xg),this._events.set(O.FURNITURE_GROUP_CONTEXT_MENU_INFO,GA),this._events.set(O.FURNITURE_POSTIT_STICKY_POLE_OPEN,HA),this._events.set(O.ROOM_SPECTATOR,$A),this._events.set(O.CUSTOM_USER_NOTIFICATION,xA),this._events.set(O.ROOM_MESSAGE_NOTIFICATION,JW),this._events.set(O.ROOM_POPULAR_TAGS_RESULT,IW),this._events.set(O.ROOM_RIGHTS_LIST,uN),this._events.set(O.ROOM_RIGHTS_LIST_ADD,lN),this._events.set(O.ROOM_RIGHTS_LIST_REMOVE,cN),this._events.set(O.ROOM_BAN_LIST,oN),this._events.set(O.ROOM_SETTINGS_SAVE_ERROR,dN),this._events.set(O.ROOM_SETTINGS,hN),this._events.set(O.ROOM_SETTINGS_SAVE,iY),this._events.set(O.ROOM_SETTINGS_ERROR,rY),this._events.set(O.SHOW_ENFORCE_ROOM_CATEGORY,nY),this._events.set(O.ROOM_BAN_REMOVE,aY),this._events.set(O.ROOM_MUTED,tY),this._events.set(O.NO_SUCH_FLAT,sY),this._events.set(O.FAVORITE_GROUP_UDPATE,FA),this._events.set(O.ROOM_MODEL_DOOR,wh),this._events.set(O.ROOM_HEIGHT_MAP,Jg),this._events.set(O.ROOM_HEIGHT_MAP_UPDATE,Zg),this._events.set(O.ROOM_MODEL,xh),this._events.set(O.ROOM_MODEL_NAME,Al),this._events.set(O.ROOM_PAINT,$g),this._events.set(O.ROOM_THICKNESS,Gh),this._events.set(O.ROOM_GET_FILTER_WORDS,tA),this._events.set(O.ROOM_MODEL_BLOCKED_TILES,KA),this._events.set(O.PET_FIGURE_UPDATE,Bh),this._events.set(O.PET_INFO,QA),this._events.set(O.PET_STATUS,JA),this._events.set(O.PET_EXPERIENCE,qA),this._events.set(O.PLAYING_GAME,ZA),this._events.set(O.UNIT_DANCE,Hh),this._events.set(O.UNIT_EFFECT,tf),this._events.set(O.UNIT,jh),this._events.set(O.UNIT_EXPRESSION,sf),this._events.set(O.UNIT_HAND_ITEM,rf),this._events.set(O.UNIT_IDLE,nf),this._events.set(O.UNIT_INFO,Wh),this._events.set(O.UNIT_NUMBER,af),this._events.set(O.UNIT_REMOVE,Yh),this._events.set(O.UNIT_STATUS,of),this._events.set(O.HAND_ITEM_RECEIVED,sN),this._events.set(O.FLOOD_CONTROL,eN),this._events.set(O.REMAINING_MUTE,tN),this._events.set(O.UNIT_CHAT,Ym),this._events.set(O.UNIT_CHAT_SHOUT,kh),this._events.set(O.UNIT_CHAT_WHISPER,Vh),this._events.set(O.UNIT_TYPING,ef),this._events.set(O.WIRED_ACTION,rN),this._events.set(O.WIRED_CONDITION,iN),this._events.set(O.WIRED_TRIGGER,nN),this._events.set(O.WIRED_OPEN,$W),this._events.set(O.WIRED_REWARD,zm),this._events.set(O.WIRED_SAVE,aN),this._events.set(O.WIRED_ERROR,eY),this._events.set(O.AUTHENTICATED,_N),this._events.set(O.JUKEBOX_PLAYLIST_FULL,gN),this._events.set(O.JUKEBOX_SONG_DISKS,fN),this._events.set(O.NOW_PLAYING,mN),this._events.set(O.OFFICIAL_SONG_ID,EN),this._events.set(O.PLAYLIST,oY),this._events.set(O.PLAYLIST_SONG_ADDED,lY),this._events.set(O.TRAX_SONG_INFO,pN),this._events.set(O.USER_SONG_DISKS_INVENTORY,IN),this._events.set(O.HELPER_TALENT_TRACK,hY),this._events.set(O.TALENT_TRACK_LEVEL,uY),this._events.set(O.TALENT_TRACK_LEVEL_UP,cY),this._events.set(O.IN_CLIENT_LINK,DN),this._events.set(O.USER_IGNORED,MN),this._events.set(O.USER_IGNORED_RESULT,Jm),this._events.set(O.USER_RESPECT,Zm),this._events.set(O.USER_PERMISSIONS,Km),this._events.set(O.USER_BADGES_CURRENT,qm),this._events.set(O.USER_INFO,Nl),this._events.set(O.UNIT_CHANGE_NAME,xd),this._events.set(O.USER_SETTINGS,Qm),this._events.set(O.USER_PROFILE,ON),this._events.set(O.MESSENGER_RELATIONSHIPS,Xm),this._events.set(O.GIFT_OPENED,lC),this._events.set(O.USER_CREDITS,vN),this._events.set(O.USER_CURRENCY,bN),this._events.set(O.USER_SUBSCRIPTION,PN),this._events.set(O.USER_WARDROBE_PAGE,xN),this._events.set(O.USER_CLASSIFICATION,TY),this._events.set(O.GET_USER_TAGS,SN),this._events.set(O.SCR_SEND_KICKBACK_INFO,FN),this._events.set(O.PET_RESPECTED,LN),this._events.set(O.PET_SUPPLEMENT,UN),this._events.set(O.ACCOUNT_SAFETY_LOCK_STATUS_CHANGE,TN),this._events.set(O.GENERIC_ERROR,bh),this._events.set(O.GROUP_LIST,NN),this._events.set(O.CATALOG_APPROVE_NAME_RESULT,RN),this._events.set(O.CONNECTION_ERROR,lA),this._events.set(O.GUILD_EDIT_FAILED,fY),this._events.set(O.GUILD_MEMBER_MGMT_FAILED,mY),this._events.set(O.EXTENDED_PROFILE_CHANGED,AN),this._events.set(O.NOOBNESS_LEVEL,WS),this._events.set(O.DISCONNECT_REASON,yj),this._events.set(O.HANDSHAKE_INIT_DIFFIE,Dj),this._events.set(O.HANDSHAKE_COMPLETE_DIFFIE,Nj),this._events.set(O.HANDSHAKE_IDENTITY_ACCOUNT,Mj),this._events.set(O.NEW_USER_EXPERIENCE_GIFT_OFFER,DW),this._events.set(O.NEW_USER_EXPERIENCE_NOT_COMPLETE,bW),this._events.set(O.RESTORE_CLIENT,CW),this._events.set(O.FIREWORK_CHARGE_DATA,R2),this._events.set(O.PHONE_COLLECTION_STATE,gj),this._events.set(O.PHONE_TRY_NUMBER_RESULT,fj),this._events.set(O.PHONE_TRY_VERIFICATION_CODE_RESULT,mj),this._events.set(O.WELCOME_GIFT_CHANGE_EMAIL_RESULT,IY),this._events.set(O.WELCOME_GIFT_STATUS,ZW),this._events.set(O.RENTABLE_SPACE_RENT_OK,qW),this._events.set(O.RENTABLE_SPACE_STATUS,QW),this._events.set(O.RENTABLE_SPACE_RENT_FAILED,XW),this._events.set(O.RECYCLER_STATUS,Fd),this._events.set(O.RECYCLER_FINISHED,jm),this._events.set(O.EMAIL_STATUS,CN),this._events.set(O.CHANGE_EMAIL_RESULT,dY),this._events.set(O.RENTABLE_FURNI_RENT_OR_BUYOUT_OFFER,KW)}registerComposers(){this._composers.set(T.AUTHENTICATION,Fz),this._composers.set(T.INTERSTITIAL_SHOWN,OY),this._composers.set(T.GET_INTERSTITIAL,RY),this._composers.set(T.GET_WARDROBE,kN),this._composers.set(T.SAVE_WARDROBE_OUTFIT,VN),this._composers.set(T.CHANGE_USERNAME,GN),this._composers.set(T.CHECK_USERNAME,BN),this._composers.set(T.REQUEST_CAMERA_CONFIGURATION,WN),this._composers.set(T.RENDER_ROOM,zh),this._composers.set(T.RENDER_ROOM_THUMBNAIL,lf),this._composers.set(T.PURCHASE_PHOTO,jN),this._composers.set(T.PUBLISH_PHOTO,HN),this._composers.set(T.PHOTO_COMPETITION,SY),this._composers.set(T.OPEN_CAMPAIGN_CALENDAR_DOOR,zN),this._composers.set(T.OPEN_CAMPAIGN_CALENDAR_DOOR_STAFF,YN),this._composers.set(T.BUILDERS_CLUB_PLACE_ROOM_ITEM,KN),this._composers.set(T.BUILDERS_CLUB_PLACE_WALL_ITEM,XN),this._composers.set(T.BUILDERS_CLUB_QUERY_FURNI_COUNT,qN),this._composers.set(T.GET_CATALOG_INDEX,QN),this._composers.set(T.GET_CATALOG_PAGE,JN),this._composers.set(T.CATALOG_PURCHASE,au),this._composers.set(T.CATALOG_PURCHASE_GIFT,ry),this._composers.set(T.GET_PRODUCT_OFFER,ey),this._composers.set(T.GET_CLUB_OFFERS,ZN),this._composers.set(T.GET_CLUB_GIFT_INFO,$m),this._composers.set(T.CATALOG_REDEEM_VOUCHER,ay),this._composers.set(T.GROUP_MEMBERSHIPS,gE),this._composers.set(T.GET_GIFT_WRAPPING_CONFIG,$N),this._composers.set(T.CATALOG_SELECT_VIP_GIFT,oy),this._composers.set(T.CATALOG_REQUESET_PET_BREEDS,sy),this._composers.set(T.GET_BONUS_RARE_INFO,CY),this._composers.set(T.GET_BUNDLE_DISCOUNT_RULESET,AY),this._composers.set(T.GET_CATALOG_PAGE_EXPIRATION,NY),this._composers.set(T.GET_CATALOG_PAGE_WITH_EARLIEST_EXP,yY),this._composers.set(T.GET_DIRECT_CLUB_BUY_AVAILABLE,MY),this._composers.set(T.GET_HABBO_BASIC_MEMBERSHIP_EXTEND_OFFER,DY),this._composers.set(T.GET_HABBO_CLUB_EXTEND_OFFER,vY),this._composers.set(T.GET_IS_OFFER_GIFTABLE,bY),this._composers.set(T.GET_LIMITED_OFFER_APPEARING_NEXT,PY),this._composers.set(T.GET_NEXT_TARGETED_OFFER,LY),this._composers.set(T.GET_ROOM_AD_PURCHASE_INFO,ty),this._composers.set(T.GET_SEASONAL_CALENDAR_DAILY_OFFER,UY),this._composers.set(T.GET_TARGETED_OFFER,eE),this._composers.set(T.MARK_CATALOG_NEW_ADDITIONS_PAGE_OPENED,FY),this._composers.set(T.PURCHASE_BASIC_MEMBERSHIP_EXTENSION,xY),this._composers.set(T.PURCHASE_ROOM_AD,iy),this._composers.set(T.PURCHASE_TARGETED_OFFER,ny),this._composers.set(T.PURCHASE_VIP_MEMBERSHIP_EXTENSION,wY),this._composers.set(T.ROOM_AD_PURCHASE_INITIATED,GY),this._composers.set(T.SET_TARGETTED_OFFER_STATE,BY),this._composers.set(T.SHOP_TARGETED_OFFER_VIEWED,kY),this._composers.set(T.FORWARD_TO_A_COMPETITION_ROOM,VY),this._composers.set(T.FORWARD_TO_A_SUBMITTABLE_ROOM,HY),this._composers.set(T.FORWARD_TO_RANDOM_COMPETITION_ROOM,jY),this._composers.set(T.GET_CURRENT_TIMING_CODE,WY),this._composers.set(T.GET_IS_USER_PART_OF_COMPETITION,YY),this._composers.set(T.GET_SECONDS_UNTIL,zY),this._composers.set(T.ROOM_COMPETITION_INIT,KY),this._composers.set(T.SUBMIT_ROOM_TO_COMPETITION,ou),this._composers.set(T.VOTE_FOR_ROOM,XY),this._composers.set(T.CRAFT,ly),this._composers.set(T.CRAFT_SECRET,qY),this._composers.set(T.GET_CRAFTABLE_PRODUCTS,uy),this._composers.set(T.GET_CRAFTING_RECIPE,cy),this._composers.set(T.GET_CRAFTING_RECIPES_AVAILABLE,QY),this._composers.set(T.FRIEND_FURNI_CONFIRM_LOCK,dy),this._composers.set(T.ACCEPT_FRIEND,_y),this._composers.set(T.DECLINE_FRIEND,cf),this._composers.set(T.FIND_NEW_FRIENDS,JY),this._composers.set(T.FOLLOW_FRIEND,wd),this._composers.set(T.FRIEND_LIST_UPDATE,gy),this._composers.set(T.GET_FRIEND_REQUESTS,fy),this._composers.set(T.HABBO_SEARCH,my),this._composers.set(T.MESSENGER_INIT,Ey),this._composers.set(T.REMOVE_FRIEND,py),this._composers.set(T.REQUEST_FRIEND,tE),this._composers.set(T.MESSENGER_CHAT,Iy),this._composers.set(T.SEND_ROOM_INVITE,Ty),this._composers.set(T.SET_RELATIONSHIP_STATUS,Ry),this._composers.set(T.VISIT_USER,ZY),this._composers.set(T.ACHIEVEMENT_RESOLUTION_OPEN,Oy),this._composers.set(T.ACCEPTGAMEINVITE,az),this._composers.set(T.GAMEUNLOADEDMESSAGE,oz),this._composers.set(T.GETGAMEACHIEVEMENTSMESSAGE,lz),this._composers.set(T.GAMES_LIST,cz),this._composers.set(T.GETGAMESTATUSMESSAGE,uz),this._composers.set(T.GETUSERGAMEACHIEVEMENTSMESSAGE,hz),this._composers.set(T.JOINQUEUEMESSAGE,dz),this._composers.set(T.LEAVEQUEUEMESSAGE,_z),this._composers.set(T.RESETRESOLUTIONACHIEVEMENTMESSAGE,gz),this._composers.set(T.GAMES_INIT,Ez),this._composers.set(T.GETWEEKLYGAMEREWARDWINNERS,pz),this._composers.set(T.GAME2GETACCOUNTGAMESTATUSMESSAGE,iz),this._composers.set(T.GAME2CHECKGAMEDIRECTORYSTATUSMESSAGE,rz),this._composers.set(T.GAME2EXITGAMEMESSAGE,$Y),this._composers.set(T.GAME2GAMECHATMESSAGE,ez),this._composers.set(T.GAME2LOADSTAGEREADYMESSAGE,tz),this._composers.set(T.GAME2PLAYAGAINMESSAGE,sz),this._composers.set(T.GAME2REQUESTFULLSTATUSUPDATEMESSAGE,nz),this._composers.set(T.GAME2GETWEEKLYFRIENDSLEADERBOARD,fz),this._composers.set(T.GAME2GETWEEKLYLEADERBOARD,mz),this._composers.set(T.GET_GIFT,Sy),this._composers.set(T.RESET_PHONE_NUMBER_STATE,Iz),this._composers.set(T.SET_PHONE_NUMBER_VERIFICATION_STATUS,Cy),this._composers.set(T.TRY_PHONE_NUMBER,Tz),this._composers.set(T.VERIFY_CODE,Rz),this._composers.set(T.GET_FORUM_STATS,Cz),this._composers.set(T.GET_FORUMS_LIST,Sz),this._composers.set(T.GET_FORUM_MESSAGES,Az),this._composers.set(T.GET_FORUM_THREAD,Nz),this._composers.set(T.GET_FORUM_THREADS,yz),this._composers.set(T.GET_UNREAD_FORUMS_COUNT,Mz),this._composers.set(T.FORUM_MODERATE_MESSAGE,Dz),this._composers.set(T.FORUM_MODERATE_THREAD,vz),this._composers.set(T.FORUM_POST_MESSAGE,bz),this._composers.set(T.UPDATE_FORUM_READ_MARKER,Pz),this._composers.set(T.UPDATE_FORUM_SETTINGS,Lz),this._composers.set(T.FORUM_UPDATE_THREAD,Uz),this._composers.set(T.CLIENT_PONG,Wy),this._composers.set(T.RELEASE_VERSION,Hy),this._composers.set(T.SECURITY_TICKET,Yy),this._composers.set(T.USER_INFO,jy),this._composers.set(T.DISCONNECT,wz),this._composers.set(T.SECURITY_MACHINE,Bz),this._composers.set(T.CLIENT_VARIABLES,kz),this._composers.set(T.HANDSHAKE_INIT_DIFFIE,Gz),this._composers.set(T.HANDSHAKE_COMPLETE_DIFFIE,xz),this._composers.set(T.CALL_FOR_HELP_FROM_FORUM_MESSAGE,zy),this._composers.set(T.CALL_FOR_HELP_FROM_FORUM_THREAD,Ky),this._composers.set(T.CALL_FOR_HELP_FROM_IM,Xy),this._composers.set(T.CALL_FOR_HELP_FROM_PHOTO,qy),this._composers.set(T.CALL_FOR_HELP_FROM_SELFIE,Vz),this._composers.set(T.CALL_FOR_HELP,Qy),this._composers.set(T.CHAT_REVIEW_GUIDE_DECIDES,Hz),this._composers.set(T.CHAT_REVIEW_GUIDE_DETACHED,jz),this._composers.set(T.CHAT_REVIEW_GUIDE_VOTE,Wz),this._composers.set(T.CHAT_REVIEW_SESSION_CREATE,Yz),this._composers.set(T.DELETE_PENDING_CALLS_FOR_HELP,Jy),this._composers.set(T.GET_CFH_STATUS,Zy),this._composers.set(T.GET_FAQ_CATEGORY,zz),this._composers.set(T.GET_FAQ_TEXT,Kz),this._composers.set(T.GET_GUIDE_REPORTING_STATUS,Xz),this._composers.set(T.GET_PENDING_CALLS_FOR_HELP,$y),this._composers.set(T.GET_QUIZ_QUESTIONS,qz),this._composers.set(T.GUIDE_SESSION_CREATE,Qz),this._composers.set(T.GUIDE_SESSION_FEEDBACK,Jz),this._composers.set(T.GUIDE_SESSION_GET_REQUESTER_ROOM,Zz),this._composers.set(T.GUIDE_SESSION_GUIDE_DECIDES,$z),this._composers.set(T.GUIDE_SESSION_INVITE_REQUESTER,e5),this._composers.set(T.GUIDE_SESSION_IS_TYPING,t5),this._composers.set(T.GUIDE_SESSION_MESSAGE,s5),this._composers.set(T.GUIDE_SESSION_ON_DUTY_UPDATE,r5),this._composers.set(T.GUIDE_SESSION_REPORT,i5),this._composers.set(T.GUIDE_SESSION_REQUESTER_CANCELS,n5),this._composers.set(T.GUIDE_SESSION_RESOLVED,a5),this._composers.set(T.POST_QUIZ_ANSWERS,o5),this._composers.set(T.SEARCH_FAQS,l5),this._composers.set(T.DESKTOP_VIEW,hy),this._composers.set(T.GROUP_INFO,yl),this._composers.set(T.GROUP_REQUEST,Ly),this._composers.set(T.GROUP_MEMBER_REMOVE_CONFIRM,vy),this._composers.set(T.GROUP_MEMBER_REMOVE,Gd),this._composers.set(T.GROUP_MEMBERS,uf),this._composers.set(T.GROUP_ADMIN_ADD,Ay),this._composers.set(T.GROUP_ADMIN_REMOVE,Ny),this._composers.set(T.GROUP_REQUEST_ACCEPT,Uy),this._composers.set(T.GROUP_REQUEST_DECLINE,Fy),this._composers.set(T.GROUP_DELETE,by),this._composers.set(T.GROUP_CREATE_OPTIONS,Dy),this._composers.set(T.GROUP_PARTS,yy),this._composers.set(T.GROUP_BUY,My),this._composers.set(T.GROUP_SETTINGS,ky),this._composers.set(T.GROUP_SAVE_BADGE,xy),this._composers.set(T.GROUP_SAVE_COLORS,wy),this._composers.set(T.GROUP_SAVE_INFORMATION,Gy),this._composers.set(T.GROUP_SAVE_PREFERENCES,By),this._composers.set(T.GROUP_FAVORITE,Py),this._composers.set(T.GROUP_UNFAVORITE,Vy),this._composers.set(T.GROUP_BADGES,Dv),this._composers.set(T.APPROVE_ALL_MEMBERSHIP_REQUESTS,Oz),this._composers.set(T.GROUP_UNBLOCK_MEMBER,K3),this._composers.set(T.ROOM_FAVORITE,A5),this._composers.set(T.CAN_CREATE_ROOM,y5),this._composers.set(T.CANCEL_ROOM_EVENT,N5),this._composers.set(T.CONVERT_GLOBAL_ROOM_ID,UM),this._composers.set(T.COMPETITION_ROOM_SEARCH,M5),this._composers.set(T.ROOM_CREATE,FM),this._composers.set(T.GET_USER_FLAT_CATS,GM),this._composers.set(T.GET_USER_EVENT_CATS,iE),this._composers.set(T.ROOM_FAVORITE_REMOVE,D5),this._composers.set(T.EDIT_ROOM_EVENT,xM),this._composers.set(T.FORWARD_TO_RANDOM_PROMOTED_ROOM,v5),this._composers.set(T.FORWARD_TO_SOME_ROOM,b5),this._composers.set(T.GET_CATEGORIES_WITH_USER_COUNT,P5),this._composers.set(T.GET_GUEST_ROOM,Bc),this._composers.set(T.GET_OFFICIAL_ROOMS,L5),this._composers.set(T.GET_POPULAR_ROOM_TAGS,U5),this._composers.set(T.GUILD_BASE_SEARCH,F5),this._composers.set(T.MY_FAVOURITE_ROOMS_SEARCH,x5),this._composers.set(T.MY_FREQUENT_ROOM_HISTORY_SEARCH,w5),this._composers.set(T.MY_FRIENDS_ROOM_SEARCH,G5),this._composers.set(T.MY_GUILD_BASES_SEARCH,B5),this._composers.set(T.MY_RECOMMENDED_ROOMS,k5),this._composers.set(T.MY_ROOM_HISTORY_SEARCH,V5),this._composers.set(T.MY_ROOM_RIGHTS_SEARCH,H5),this._composers.set(T.MY_ROOMS_SEARCH,j5),this._composers.set(T.POPULAR_ROOMS_SEARCH,Q5),this._composers.set(T.ROOM_LIKE,kM),this._composers.set(T.ROOM_RIGHTS_REMOVE_OWN,J5),this._composers.set(T.ROOM_AD_EVENT_TAB_CLICKED,Z5),this._composers.set(T.ROOM_AD_EVENT_TAB_VIEWED,$5),this._composers.set(T.ROOM_AD_SEARCH,e3),this._composers.set(T.ROOM_TEXT_SEARCH,r3),this._composers.set(T.ROOMS_WHERE_MY_FRIENDS_ARE,t3),this._composers.set(T.ROOMS_WITH_HIGHEST_SCORE_SEARCH,s3),this._composers.set(T.SET_ROOM_SESSION_TAGS,i3),this._composers.set(T.ROOM_STAFF_PICK,VM),this._composers.set(T.ROOM_FILTER_WORDS,wM),this._composers.set(T.ROOM_FILTER_WORDS_MODIFY,jM),this._composers.set(T.USER_HOME_ROOM,HM),this._composers.set(T.UPDATE_ROOM_THUMBNAIL,n3),this._composers.set(T.NAVIGATOR_INIT,BM),this._composers.set(T.NAVIGATOR_SEARCH_CLOSE,z5),this._composers.set(T.NAVIGATOR_SEARCH,Co),this._composers.set(T.NAVIGATOR_SEARCH_OPEN,K5),this._composers.set(T.NAVIGATOR_SEARCH_SAVE,X5),this._composers.set(T.NAVIGATOR_SETTINGS_SAVE,q5),this._composers.set(T.NAVIGATOR_CATEGORY_LIST_MODE,W5),this._composers.set(T.NAVIGATOR_DELETE_SAVED_SEARCH,Y5),this._composers.set(T.POLL_ANSWER,JM),this._composers.set(T.POLL_REJECT,ZM),this._composers.set(T.POLL_START,$M),this._composers.set(T.POLL_VOTE_COUNTER,eD),this._composers.set(T.USER_EFFECT_ACTIVATE,c5),this._composers.set(T.USER_EFFECT_ENABLE,u5),this._composers.set(T.USER_BADGES,eM),this._composers.set(T.USER_BADGES_CURRENT_UPDATE,tM),this._composers.set(T.GET_BADGE_POINTS_LIMITS,h5),this._composers.set(T.REQUESTABADGE,_5),this._composers.set(T.GETISBADGEREQUESTFULFILLED,d5),this._composers.set(T.USER_BOTS,hf),this._composers.set(T.USER_FURNITURE,sM),this._composers.set(T.REQUESTFURNIINVENTORYWHENNOTINROOM,g5),this._composers.set(T.USER_PETS,df),this._composers.set(T.TRADE_ACCEPT,rM),this._composers.set(T.TRADE_CANCEL,iM),this._composers.set(T.TRADE_CLOSE,nM),this._composers.set(T.TRADE_CONFIRM,aM),this._composers.set(T.TRADE_ITEM,_f),this._composers.set(T.TRADE_ITEMS,oM),this._composers.set(T.TRADE_ITEM_REMOVE,lM),this._composers.set(T.TRADE,cM),this._composers.set(T.TRADE_UNACCEPT,uM),this._composers.set(T.UNSEEN_RESET_CATEGORY,hM),this._composers.set(T.UNSEEN_RESET_ITEMS,dM),this._composers.set(T.ACHIEVEMENT_LIST,wN),this._composers.set(T.PET_MOUNT,mf),this._composers.set(T.PET_RESPECT,lu),this._composers.set(T.PET_SUPPLEMENT,o3),this._composers.set(T.REMOVE_PET_SADDLE,zM),this._composers.set(T.PET_INFO,KM),this._composers.set(T.TOGGLE_PET_BREEDING,XM),this._composers.set(T.TOGGLE_PET_RIDING,qM),this._composers.set(T.USE_PET_PRODUCT,QM),this._composers.set(T.GET_PET_TRAINING_PANEL,YM),this._composers.set(T.PET_OPEN_PACKAGE,uE),this._composers.set(T.PET_SELECTED,L3),this._composers.set(T.PETS_BREED,kd),this._composers.set(T.PET_CANCEL_BREEDING,f5),this._composers.set(T.PET_CONFIRM_BREEDING,m5),this._composers.set(T.ROOM_ENTER,sD),this._composers.set(T.ROOM_DOORBELL,tD),this._composers.set(T.GO_TO_FLAT,QD),this._composers.set(T.CHANGE_QUEUE,qD),this._composers.set(T.ROOM_AMBASSADOR_ALERT,iD),this._composers.set(T.ROOM_BAN_GIVE,nD),this._composers.set(T.ROOM_BAN_REMOVE,uD),this._composers.set(T.ROOM_RIGHTS_GIVE,oD),this._composers.set(T.ROOM_KICK,lD),this._composers.set(T.ROOM_MUTE_USER,cD),this._composers.set(T.ROOM_RIGHTS_REMOVE,nE),this._composers.set(T.ROOM_RIGHTS_REMOVE_ALL,rD),this._composers.set(T.ROOM_DELETE,aD),this._composers.set(T.ROOM_SETTINGS,oE),this._composers.set(T.ROOM_SETTINGS_SAVE,_D),this._composers.set(T.ROOM_RIGHTS_LIST,dD),this._composers.set(T.ROOM_BAN_LIST,aE),this._composers.set(T.ROOM_SETTINGS_UPDATE_ROOM_CATEGORY_AND_TRADE,w3),this._composers.set(T.BOT_CONFIGURATION,hD),this._composers.set(T.GET_ITEM_DATA,ED),this._composers.set(T.REMOVE_WALL_ITEM,RD),this._composers.set(T.BOT_PLACE,gD),this._composers.set(T.BOT_PICKUP,Bd),this._composers.set(T.BOT_SKILL_SAVE,an),this._composers.set(T.PET_PLACE,ID),this._composers.set(T.PET_MOVE,Ef),this._composers.set(T.PET_PICKUP,TD),this._composers.set(T.SET_ITEM_DATA,SD),this._composers.set(T.SET_OBJECT_DATA,lE),this._composers.set(T.COMPOST_PLANT,mD),this._composers.set(T.HARVEST_PET,pD),this._composers.set(T.SET_CLOTHING_CHANGE_DATA,OD),this._composers.set(T.FURNITURE_ALIASES,MD),this._composers.set(T.FURNITURE_GROUP_INFO,DD),this._composers.set(T.FURNITURE_PICKUP,vD),this._composers.set(T.FURNITURE_PLACE,cE),this._composers.set(T.ITEM_PAINT,Dc),this._composers.set(T.FURNITURE_POSTIT_PLACE,bD),this._composers.set(T.FURNITURE_POSTIT_SAVE_STICKY_POLE,CD),this._composers.set(T.CONTROL_YOUTUBE_DISPLAY_PLAYBACK,fc),this._composers.set(T.GET_YOUTUBE_DISPLAY_STATUS,YD),this._composers.set(T.SET_YOUTUBE_DISPLAY_PLAYLIST,If),this._composers.set(T.FURNITURE_FLOOR_UPDATE,pf),this._composers.set(T.FURNITURE_WALL_UPDATE,WD),this._composers.set(T.ITEM_DIMMER_SETTINGS,AD),this._composers.set(T.ITEM_DIMMER_SAVE,ND),this._composers.set(T.ITEM_DIMMER_TOGGLE,yD),this._composers.set(T.ROOM_TONER_APPLY,jD),this._composers.set(T.ITEM_COLOR_WHEEL_CLICK,PD),this._composers.set(T.ITEM_DICE_CLICK,LD),this._composers.set(T.ITEM_DICE_CLOSE,UD),this._composers.set(T.FURNITURE_MULTISTATE,Ml),this._composers.set(T.FURNITURE_RANDOMSTATE,wD),this._composers.set(T.ITEM_STACK_HELPER,Kh),this._composers.set(T.FURNITURE_WALL_MULTISTATE,GD),this._composers.set(T.ONE_WAY_DOOR_CLICK,xD),this._composers.set(T.ITEM_EXCHANGE_REDEEM,FD),this._composers.set(T.ITEM_CLOTHING_REDEEM,XD),this._composers.set(T.ROOM_MODEL,Tf),this._composers.set(T.GET_OCCUPIED_TILES,zD),this._composers.set(T.GET_ROOM_ENTRY_TILE,KD),this._composers.set(T.ROOM_MODEL_SAVE,hE),this._composers.set(T.UNIT_ACTION,sv),this._composers.set(T.UNIT_DANCE,rv),this._composers.set(T.UNIT_DROP_HAND_ITEM,iv),this._composers.set(T.UNIT_GIVE_HANDITEM,nv),this._composers.set(T.UNIT_GIVE_HANDITEM_PET,_E),this._composers.set(T.UNIT_LOOK,av),this._composers.set(T.UNIT_SIGN,lv),this._composers.set(T.UNIT_POSTURE,ov),this._composers.set(T.UNIT_WALK,cv),this._composers.set(T.UNIT_CHAT,dE),this._composers.set(T.UNIT_CHAT_SHOUT,JD),this._composers.set(T.USER_SETTINGS_CHAT_STYLE,ZD),this._composers.set(T.UNIT_CHAT_WHISPER,$D),this._composers.set(T.UNIT_TYPING,ev),this._composers.set(T.UNIT_TYPING_STOP,tv),this._composers.set(T.WIRED_APPLY_SNAPSHOT,F3),this._composers.set(T.WIRED_OPEN,x3),this._composers.set(T.WIRED_ACTION_SAVE,hv),this._composers.set(T.WIRED_CONDITION_SAVE,dv),this._composers.set(T.WIRED_TRIGGER_SAVE,_v),this._composers.set(T.ROOM_MUTE,uv),this._composers.set(T.APPROVE_NAME,Rv),this._composers.set(T.USER_RESPECT,xv),this._composers.set(T.SCR_GET_KICKBACK_INFO,bv),this._composers.set(T.PEER_USERS_CLASSIFICATION,wv),this._composers.set(T.USER_CLASSIFICATION,Gv),this._composers.set(T.USER_IGNORED,Ov),this._composers.set(T.USER_IGNORE,Cv),this._composers.set(T.USER_IGNORE_ID,Av),this._composers.set(T.USER_UNIGNORE,Nv),this._composers.set(T.USER_BADGES_CURRENT,fE),this._composers.set(T.USER_FIGURE,mE),this._composers.set(T.USER_MOTTO,yv),this._composers.set(T.USER_PROFILE,Mv),this._composers.set(T.USER_PROFILE_BY_NAME,Y3),this._composers.set(T.USER_TAGS,Sv),this._composers.set(T.MESSENGER_RELATIONSHIPS,EE),this._composers.set(T.MANNEQUIN_SAVE_NAME,kD),this._composers.set(T.MANNEQUIN_SAVE_LOOK,BD),this._composers.set(T.PRESENT_OPEN_PRESENT,HD),this._composers.set(T.MARKETPLACE_CONFIG,gM),this._composers.set(T.MARKETPLACE_SELL_ITEM,EM),this._composers.set(T.MARKETPLACE_REQUEST_OWN_ITEMS,mM),this._composers.set(T.MARKETPLACE_TAKE_BACK_ITEM,_M),this._composers.set(T.MARKETPLACE_REQUEST_OFFERS,fM),this._composers.set(T.MARKETPLACE_BUY_OFFER,gf),this._composers.set(T.MARKETPLACE_REDEEM_CREDITS,pM),this._composers.set(T.MARKETPLACE_BUY_TOKENS,I5),this._composers.set(T.REQUEST_SELL_ITEM,T5),this._composers.set(T.REQUEST_MARKETPLACE_ITEM_STATS,R5),this._composers.set(T.USER_BOTS,hf),this._composers.set(T.USER_PETS,df),this._composers.set(T.USER_CURRENCY,vv),this._composers.set(T.USER_SUBSCRIPTION,Rf),this._composers.set(T.MODTOOL_REQUEST_ROOM_INFO,SM),this._composers.set(T.MODTOOL_CHANGE_ROOM_SETTINGS,ff),this._composers.set(T.MODTOOL_REQUEST_USER_CHATLOG,yM),this._composers.set(T.MODTOOL_REQUEST_ROOM_CHATLOG,AM),this._composers.set(T.MOD_TOOL_USER_INFO,CM),this._composers.set(T.MODTOOL_SANCTION_ALERT,MM),this._composers.set(T.MODTOOL_SANCTION_BAN,Ha),this._composers.set(T.MODTOOL_SANCTION_KICK,DM),this._composers.set(T.MODTOOL_SANCTION_TRADELOCK,bM),this._composers.set(T.MODTOOL_ALERTEVENT,sE),this._composers.set(T.MODTOOL_SANCTION_MUTE,vM),this._composers.set(T.MODTOOL_REQUEST_USER_ROOMS,NM),this._composers.set(T.MODTOOL_ROOM_ALERT,zn),this._composers.set(T.CLOSE_ISSUE_DEFAULT_ACTION,O5),this._composers.set(T.CLOSE_ISSUES,Na),this._composers.set(T.DEFAULT_SANCTION,RM),this._composers.set(T.GET_CFH_CHATLOG,OM),this._composers.set(T.MODTOOL_PREFERENCES,S5),this._composers.set(T.MODTOOL_SANCTION,C5),this._composers.set(T.PICK_ISSUES,PM),this._composers.set(T.RELEASE_ISSUES,rE),this._composers.set(T.MYSTERYBOXWAITINGCANCELEDMESSAGE,LM),this._composers.set(T.MYSTERYBOX_OPEN_TROPHY,VD),this._composers.set(T.USER_SETTINGS_CAMERA,Pv),this._composers.set(T.USER_SETTINGS_OLD_CHAT,Lv),this._composers.set(T.USER_SETTINGS_INVITES,Uv),this._composers.set(T.USER_SETTINGS_VOLUME,Fv),this._composers.set(T.COMMUNITY_GOAL_VOTE_COMPOSER,p5),this._composers.set(T.GET_PROMO_ARTICLES,E5),this._composers.set(T.ACCEPT_QUEST,l3),this._composers.set(T.ACTIVATE_QUEST,c3),this._composers.set(T.CANCEL_QUEST,u3),this._composers.set(T.FRIEND_REQUEST_QUEST_COMPLETE,h3),this._composers.set(T.GET_COMMUNITY_GOAL_EARNED_PRIZES,d3),this._composers.set(T.GET_COMMUNITY_GOAL_HALL_OF_FAME,_3),this._composers.set(T.GET_COMMUNITY_GOAL_PROGRESS,g3),this._composers.set(T.GET_CONCURRENT_USERS_GOAL_PROGRESS,f3),this._composers.set(T.GET_CONCURRENT_USERS_REWARD,m3),this._composers.set(T.GET_DAILY_QUEST,E3),this._composers.set(T.GET_QUESTS,p3),this._composers.set(T.GET_SEASONAL_QUESTS_ONLY,I3),this._composers.set(T.OPEN_QUEST_TRACKER,T3),this._composers.set(T.REDEEM_COMMUNITY_GOAL_PRIZE,R3),this._composers.set(T.REJECT_QUEST,O3),this._composers.set(T.START_CAMPAIGN,S3),this._composers.set(T.GET_SOUND_SETTINGS,B3),this._composers.set(T.ADD_JUKEBOX_DISK,gv),this._composers.set(T.GET_JUKEBOX_PLAYLIST,fv),this._composers.set(T.GET_NOW_PLAYING,mv),this._composers.set(T.GET_OFFICIAL_SONG_ID,Ev),this._composers.set(T.GET_SONG_INFO,pv),this._composers.set(T.GET_SOUND_MACHINE_PLAYLIST,G3),this._composers.set(T.GET_USER_SONG_DISKS,Iv),this._composers.set(T.REMOVE_JUKEBOX_DISK,Tv),this._composers.set(T.HELPER_TALENT_TRACK,V3),this._composers.set(T.TALENT_TRACK_GET_LEVEL,k3),this._composers.set(T.NEW_USER_EXPERIENCE_GET_GIFTS,a3),this._composers.set(T.NEW_USER_EXPERIENCE_SCRIPT_PROCEED,WM),this._composers.set(T.WELCOME_OPEN_GIFT,D3),this._composers.set(T.WELCOME_GIFT_CHANGE_EMAIL,X3),this._composers.set(T.EMAIL_GET_STATUS,z3),this._composers.set(T.EMAIL_CHANGE,W3),this._composers.set(T.RENTABLE_SPACE_CANCEL_RENT,v3),this._composers.set(T.RENTABLE_SPACE_RENT,b3),this._composers.set(T.RENTABLE_SPACE_STATUS,P3),this._composers.set(T.RECYCLER_STATUS,C3),this._composers.set(T.RECYCLER_ITEMS,A3),this._composers.set(T.TRACKING_PERFORMANCE_LOG,j3),this._composers.set(T.TRACKING_LAG_WARNING_REPORT,H3),this._composers.set(T.ROOM_DIRECTORY_ROOM_NETWORK_OPEN_CONNECTION,U3),this._composers.set(T.RENTABLE_EXTEND_RENT_OR_BUYOUT_STRIP_ITEM,y3),this._composers.set(T.RENTABLE_EXTEND_RENT_OR_BUYOUT_FURNI,N3),this._composers.set(T.RENTABLE_GET_RENT_OR_BUYOUT_OFFER,M3)}get events(){return this._events}get composers(){return this._composers}}class J3 extends En{constructor(e){super(),this._communication=e,this._connection=null,this._messages=new Q3,this._demo=new q3(this),this.onConnectionOpenedEvent=this.onConnectionOpenedEvent.bind(this),this.onConnectionClosedEvent=this.onConnectionClosedEvent.bind(this),this.onConnectionErrorEvent=this.onConnectionErrorEvent.bind(this),this.onConnectionAuthenticatedEvent=this.onConnectionAuthenticatedEvent.bind(this)}onInit(){this._connection||(pe.instance.events.addEventListener(Qt.CONNECTION_AUTHENTICATED,this.onConnectionAuthenticatedEvent),this._connection=this._communication.createConnection(this),this._connection.registerMessages(this._messages),this._connection.addEventListener(Ps.CONNECTION_OPENED,this.onConnectionOpenedEvent),this._connection.addEventListener(Ps.CONNECTION_CLOSED,this.onConnectionClosedEvent),this._connection.addEventListener(Ps.CONNECTION_ERROR,this.onConnectionErrorEvent),this._demo&&this._demo.init(),this._connection.init(Ue.getValue("socket.url")))}onDispose(){this._demo&&this._demo.dispose(),this._connection&&(this._connection.removeEventListener(Ps.CONNECTION_OPENED,this.onConnectionOpenedEvent),this._connection.removeEventListener(Ps.CONNECTION_CLOSED,this.onConnectionClosedEvent),this._connection.removeEventListener(Ps.CONNECTION_ERROR,this.onConnectionErrorEvent)),pe.instance.events.removeEventListener(Qt.CONNECTION_AUTHENTICATED,this.onConnectionAuthenticatedEvent),super.onDispose()}onConnectionOpenedEvent(e){me.log("Connection Initialized")}onConnectionClosedEvent(e){me.log("Connection Closed")}onConnectionErrorEvent(e){me.log("Connection Error")}onConnectionAuthenticatedEvent(e){me.log("Connection Authenticated"),this._connection&&this._connection.authenticated()}connectionInit(e){me.log("Initializing Connection",e)}registerMessageEvent(e){return this._connection&&this._connection.addMessageEvent(e),e}removeMessageEvent(e){this._connection&&this._connection.removeMessageEvent(e)}get demo(){return this._demo}get connection(){return this._connection}}const pE=class _h{static get available(){return this._isListeningForPostMessages||(this._isListeningForPostMessages=!0,window.addEventListener("message",e=>{if(typeof e.data=="string"&&e.data.startsWith(_h.MESSAGE_KEY)){const{method:t,params:s}=JSON.parse(e.data.substr(_h.MESSAGE_KEY.length)),r=window[t];if(!r)return;r(...s);return}})),!0}static call(e,...t){if(window.top!==window&&window.top.postMessage(_h.MESSAGE_KEY+JSON.stringify({method:e,params:t}),"*"),!("FlashExternalInterface"in window))return;const s=window.FlashExternalInterface[e];return typeof s<"u"?s(...t):void 0}static callGame(e,...t){if(window.top!==window&&window.top.postMessage("Nitro_LegacyExternalGameInterface"+JSON.stringify({method:e,params:t}),"*"),!("FlashExternalGameInterface"in window))return;const s=window.FlashExternalGameInterface[e];return typeof s<"u"?s(...t):void 0}static addCallback(e,t){window[e]=t}};pE.MESSAGE_KEY="Nitro_LegacyExternalInterface";pE._isListeningForPostMessages=!1;let Je=pE;class Z3{constructor(e){e.addMessageEvent(new wS(this.onLoadGameUrl.bind(this)))}onLoadGameUrl(e){if(!e)return;const t=e.getParser();t&&Je.callGame("showGame",t.url)}}class b_{constructor(e){this._badgeId="",this._level=1,this._base="",this._badgeId=e,this.parseText()}parseText(){let e=this._badgeId.length-1;for(;e>0&&this.isNumber(this._badgeId.charAt(e));)e--;this._base=this._badgeId.substr(0,e+1);const t=this._badgeId.substr(e+1,this._badgeId.length);t&&t!==""&&(this._level=Number.parseInt(t))}isNumber(e){const t=e.charCodeAt(0);return t>=48&&t<=57}get level(){return this._level}set level(e){this._level=Math.max(1,e)}get getBadgeId(){return this._base+this._level}get base(){return this._base}}class $3 extends En{constructor(e){super(),this._communication=e,this._definitions=new Map,this._parameters=new Map,this._badgePointLimits=new Map,this._romanNumerals=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX","XXI","XXII","XXIII","XXIV","XXV","XXVI","XXVII","XXVIII","XXIX","XXX"],this._pendingUrls=[]}onInit(){this._communication.registerMessageEvent(new Gm(this.onBadgePointLimitsEvent.bind(this)));let e=Ue.getValue("external.texts.url");Array.isArray(e)||(e=[Ue.getValue("external.texts.url")]);for(let t=0;t<e.length;t++)e[t]=Ue.interpolate(e[t]);this._pendingUrls=e,this.loadNextLocalization()}loadNextLocalization(){if(!this._pendingUrls.length){this.events&&this.events.dispatchEvent(new Ca(Ca.LOADED));return}this.loadLocalizationFromURL(this._pendingUrls[0])}loadLocalizationFromURL(e){fetch(e).then(t=>t.json()).then(t=>this.onLocalizationLoaded(t,e)).catch(t=>this.onLocalizationFailed(t))}onLocalizationLoaded(e,t){if(!e)return;if(!this.parseLocalization(e))throw new Error(`Invalid json data for file ${t}`);const s=this._pendingUrls.indexOf(t);s>=0&&this._pendingUrls.splice(s,1),this.loadNextLocalization()}onLocalizationFailed(e){this.events&&this.events.dispatchEvent(new Ca(Ca.FAILED))}parseLocalization(e){if(!e)return!1;for(const t in e)this._definitions.set(t,e[t]);return!0}onBadgePointLimitsEvent(e){const t=e.getParser();for(const s of t.data)this.setBadgePointLimit(s.badgeId,s.limit)}getBadgePointLimit(e){return this._badgePointLimits.get(e)||-1}setBadgePointLimit(e,t){this._badgePointLimits.set(e,t)}getRomanNumeral(e){return this._romanNumerals[Math.max(0,e-1)]}getPreviousLevelBadgeId(e){const t=new b_(e);return t.level--,t.getBadgeId}hasValue(e){return this._definitions.has(e)}getValue(e,t=!0){if(!e||!e.length)return null;const s=e.match(/\$\{.[^}]*\}/g);if(s&&s.length)for(const i of s)e=e.replace(i,this.getValue(i.slice(2,-1),t));let r=this._definitions.get(e)||null;if(!r&&(r=Ue.definitions.get(e),r))return r;if(r&&t){const i=this._parameters.get(e);if(i)for(const[a,l]of i)r=r.replace("%"+a+"%",l)}return r||e}getValueWithParameter(e,t,s){const r=this.getValue(e,!1),i=r.replace("%"+t+"%",s);if(r.startsWith("%{")){const a=new RegExp("%{"+t.toUpperCase()+"\\|([^|]*)\\|([^|]*)\\|([^|]*)}"),l=r.match(a);if(!l)return i;let c=-1;switch(Number.parseInt(s)){case 0:c=1;break;case 1:c=2;break;default:case 2:c=3;break}if(c==-1||typeof l[c]>"u")return i;const h=l[c];if(h)return h.replace("%%",s)}return i}getValueWithParameters(e,t,s){let r=this.getValue(e,!1);if(t)for(let i=0;i<t.length;i++){const a=t[i],l=s[i];if(l!==void 0&&(r=r.replace("%"+a+"%",l),r.startsWith("%{"))){const c=new RegExp("%{"+a.toUpperCase()+"\\|([^|]*)\\|([^|]*)\\|([^|]*)}"),u=r.match(c);if(!u)continue;const h=parseInt(l);let d=-1;switch(h){case 0:d=1;break;case 1:d=2;break;case 2:default:d=3;break}if(d===-1||typeof u[d]>"u")continue;const f=u[d];f&&(r=f.replace("%%",l))}}return r}setValue(e,t){this._definitions.set(e,t)}registerParameter(e,t,s){if(!e||e.length===0||!t||t.length===0)return;let r=this._parameters.get(e);r||(r=new Map,this._parameters.set(e,r)),r.set(t,s)}getBadgeName(e){const t=new b_(e),s=["badge_name_"+e,"badge_name_"+t.base];let r=this.fixBadLocalization(this.getExistingKey(s));return r=r.replace("%roman%",this.getRomanNumeral(t.level)),r}getBadgeDesc(e){const t=new b_(e),s=["badge_desc_"+e,"badge_desc_"+t.base];let r=this.fixBadLocalization(this.getExistingKey(s));const i=this.getBadgePointLimit(e);return i>-1&&(r=r.replace("%limit%",i.toString())),r=r.replace("%roman%",this.getRomanNumeral(t.level)),r}getExistingKey(e){for(const t of e){const s=this.getValue(t);if(s!=t)return s}return""}fixBadLocalization(e){return e.replace("${","$").replace("{","$").replace("}","$")}}XL.add(qL,QL,JL,ZL,$L,eU,tU);class Up{constructor(){this.id=0,this.data=null,this.image=null}getImage(){return this.image?this.image:this.data?ht.generateImage(this.data):null}}class Ir extends Rs{constructor(e){super(null,null),this._type=e}get type(){return this._type}}Ir.IMAGE_LOADED="ROAUM_IMAGE_LOADED";Ir.IMAGE_LOADING_FAILED="ROAUM_IMAGE_FAILED";class Es extends Rs{constructor(){super(null,null)}}class Bv extends Es{constructor(e,t){super(),this._itemType=e,this._itemName=t}get itemType(){return this._itemType}get itemName(){return this._itemName}}class IE extends Es{constructor(e=0){super(),this._numberOfWords=e}get numberOfWords(){return this._numberOfWords}}class kv extends Es{constructor(e=0){super(),this._danceStyle=e}get danceStyle(){return this._danceStyle}}class Vv extends Es{constructor(e,t=0){super(),this._effect=e,this._delayMilliseconds=t}get effect(){return this._effect}get delayMilliseconds(){return this._delayMilliseconds}}class Hv extends Es{constructor(e){super(),this._gainedExperience=e}get gainedExperience(){return this._gainedExperience}}class jv extends Es{constructor(e=0){super(),this._expressionType=e}get expressionType(){return this._expressionType}}class Xh extends Es{constructor(e,t=null,s=null,r=!1){super(),this._figure=e,this._gender=t,this._subType=s,this._isRiding=r}get figure(){return this._figure}get gender(){return this._gender}get subType(){return this._subType}get isRiding(){return this._isRiding}}class Wv extends Es{constructor(e=0){super(),this._level=e}get level(){return this._level}}class Yv extends Es{constructor(e=0){super(),this._gesture=e}get gesture(){return this._gesture}}class eK extends Es{constructor(e){super(),this._guideStatus=e}get guideStatus(){return this._guideStatus}}class zv extends Es{constructor(e=!1){super(),this._isMuted=e}get isMuted(){return this._isMuted}}class Kv extends Es{}class Xv extends Es{constructor(e){super(),this._gesture=e}get gesture(){return this._gesture}}class qv extends Es{constructor(e){super(),this._value=e}get value(){return this._value}}class Qv extends Es{constructor(e){super(),this._isPlayingGame=e}get isPlayingGame(){return this._isPlayingGame}}class TE extends Es{constructor(e,t=""){super(),this._postureType=e,this._parameter=t}get postureType(){return this._postureType}get parameter(){return this._parameter}}class qh extends Es{constructor(e){super(),this._selected=e}get selected(){return this._selected}}class Jv extends Es{constructor(e=0){super(),this._signType=e}get signType(){return this._signType}}class RE extends Es{constructor(e=!1){super(),this._isSleeping=e}get isSleeping(){return this._isSleeping}}class Zv extends Es{constructor(e=!1){super(),this._isTyping=e}get isTyping(){return this._isTyping}}class Ua extends Rs{constructor(e,t,s,r=!1){super(e,s),this._targetLocation=t,this._isSlide=r}get targetLocation(){return this._targetLocation?this._targetLocation:this.location}get isSlide(){return this._isSlide}}class Qh extends Ua{constructor(e,t,s,r,i,a){super(e,t,s),this._headDirection=r,this._canStandUp=i,this._baseY=a}get headDirection(){return this._headDirection}get canStandUp(){return this._canStandUp}get baseY(){return this._baseY}}class $v extends Es{constructor(e){super(),this._itemType=e}get itemType(){return this._itemType}}class Pt extends Rs{constructor(e,t,s=null){super(null,null),this._state=e,this._data=t,this._extra=s}get state(){return this._state}get data(){return this._data}get extra(){return this._extra}}class Dl extends Rs{constructor(e,t){super(null,null),this._badgeId=e,this._assetName=t}get badgeId(){return this._badgeId}get assetName(){return this._assetName}}Dl.BADGE_LOADED="ROGBUM_BADGE_LOADED";class eb extends Rs{constructor(e,t,s){super(e,t),this._height=s}get height(){return this._height}}class OE extends Rs{constructor(e){super(null,null),this._data=e}get data(){return this._data}}class tb extends Rs{constructor(e,t){super(null,null),this._numberKey=e,this._numberValue=t}get numberKey(){return this._numberKey}get numberValue(){return this._numberValue}}class Jh extends Rs{constructor(e,t,s,r){super(null,null),this._type=e,this._color=t,this._light=s,this._backgroundOnly=r}get type(){return this._type}get color(){return this._color}get light(){return this._light}get backgroundOnly(){return this._backgroundOnly}}Jh.BACKGROUND_COLOR="RORCUM_BACKGROUND_COLOR";class Kn extends Rs{constructor(e,t,s=0,r=0,i=0,a=0){super(null,null),this._type=e,this._id=t,this._x=s,this._y=r,this._width=i,this._height=a}get type(){return this._type}get id(){return this._id}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}}Kn.ADD="ORPFHUM_ADD";Kn.REMOVE="ORPFHUM_REMOVE";const sb=class rb extends Rs{constructor(e){super(null,null),this._type=rb.UPDATE_MAP,this._mapData=e}get type(){return this._type}get mapData(){return this._mapData}};sb.UPDATE_MAP="RORMUM_UPDATE_MAP";let ib=sb;class Vs extends Rs{constructor(e,t,s=null,r=null,i="window"){super(null,null),this._type=e,this._maskId=t,this._maskType=s,this._maskLocation=r?new F(r.x,r.y,r.z):null,this._maskCategory=i}get type(){return this._type}get maskId(){return this._maskId}get maskType(){return this._maskType}get maskLocation(){return this._maskLocation}get maskCategory(){return this._maskCategory}}Vs.ADD_MASK="RORMUM_ADD_MASK";Vs.REMOVE_MASK="RORMUM_ADD_MASK";Vs.DOOR="door";Vs.WINDOW="window";Vs.HOLE="hole";class Xn extends Rs{constructor(e,t){super(null,null),this._type=e,this._value=t}get type(){return this._type}get value(){return this._value}}Xn.WALL_THICKNESS="RORPPUM_WALL_THICKNESS";Xn.FLOOR_THICKNESS="RORPVUM_FLOOR_THICKNESS";class qn extends Rs{constructor(e,t){super(null,null),this._type=e,this._visible=t}get type(){return this._type}get visible(){return this._visible}}qn.WALL_VISIBILITY="RORPVUM_WALL_VISIBILITY";qn.FLOOR_VISIBILITY="RORPVUM_FLOOR_VISIBILITY";class ks extends Rs{constructor(e,t){super(null,null),this._type=e,this._value=t}get type(){return this._type}get value(){return this._value}}ks.ROOM_WALL_UPDATE="RORUM_ROOM_WALL_UPDATE";ks.ROOM_FLOOR_UPDATE="RORUM_ROOM_FLOOR_UPDATE";ks.ROOM_LANDSCAPE_UPDATE="RORUM_ROOM_LANDSCAPE_UPDATE";class kc extends Es{constructor(e){super(),this._selected=e}get selected(){return this._selected}}class Jo extends Rs{constructor(e,t,s,r,i=!1){super(e,null),this._height=t,this._visible=s,this._sourceEventId=r,this._toggleVisibility=i}get height(){return this._height}get visible(){return this._visible}get sourceEventId(){return this._sourceEventId}get toggleVisibility(){return this._toggleVisibility}}class Qn extends Rs{constructor(e){super(null,null),this._type=e}get type(){return this._type}}Qn.ENABLED="ROVUM_ENABLED";Qn.DISABLED="ROVUM_DISABLED";const SE=class Of extends Rd{constructor(){super(),this._liftAmount=0,this._location=new F,this._locationDelta=new F,this._lastUpdateTime=0,this._changeTime=0,this._updateInterval=Of.DEFAULT_UPDATE_INTERVAL}onDispose(){this._liftAmount=0,super.onDispose()}update(e){super.update(e);const t=this.getLocationOffset(),s=this.object&&this.object.model;if(s&&(t?this._liftAmount!==t.z&&(this._liftAmount=t.z,s.setValue(C.FURNITURE_LIFT_AMOUNT,this._liftAmount)):this._liftAmount!==0&&(this._liftAmount=0,s.setValue(C.FURNITURE_LIFT_AMOUNT,this._liftAmount))),this._locationDelta.length>0||t){const r=Of.TEMP_VECTOR;let i=this.time-this._changeTime;i===this._updateInterval>>1&&i++,i>this._updateInterval&&(i=this._updateInterval),this._locationDelta.length>0?(r.assign(this._locationDelta),r.multiply(i/this._updateInterval),r.add(this._location)):r.assign(this._location),t&&r.add(t),this.object.setLocation(r),i===this._updateInterval&&(this._locationDelta.x=0,this._locationDelta.y=0,this._locationDelta.z=0)}this._lastUpdateTime=this.time}setObject(e){super.setObject(e),e&&this._location.assign(e.getLocation())}processUpdateMessage(e){if(e&&(super.processUpdateMessage(e),e.location&&this._location.assign(e.location),e instanceof Ua))return this.processMoveMessage(e)}processMoveMessage(e){!e||!this.object||!e.location||(this._changeTime=this._lastUpdateTime,this._locationDelta.assign(e.targetLocation),this._locationDelta.subtract(this._location))}getLocationOffset(){return null}get lastUpdateTime(){return this._lastUpdateTime}set updateInterval(e){e<=0&&(e=1),this._updateInterval=e}};SE.DEFAULT_UPDATE_INTERVAL=500;SE.TEMP_VECTOR=new F;let El=SE;const ja=class pr extends El{constructor(){super(),this._selected=!1,this._reportedLocation=null,this._effectChangeTimeStamp=0,this._newEffect=0,this._blinkingStartTimestamp=ve()+this.randomBlinkStartTimestamp(),this._blinkingEndTimestamp=0,this._talkingEndTimestamp=0,this._talkingPauseStartTimestamp=0,this._talkingPauseEndTimestamp=0,this._carryObjectStartTimestamp=0,this._carryObjectEndTimestamp=0,this._allowUseCarryObject=!1,this._animationEndTimestamp=0,this._signEndTimestamp=0,this._gestureEndTimestamp=0,this._numberValueEndTimestamp=0}getEventTypes(){const e=[Me.CLICK,Me.DOUBLE_CLICK,hr.POSITION_CHANGED,Me.MOUSE_ENTER,Me.MOUSE_LEAVE,oe.MOUSE_BUTTON,oe.MOUSE_ARROW];return this.mergeTypes(super.getEventTypes(),e)}dispose(){this._selected&&this.object&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new hr(hr.OBJECT_REMOVED,this.object)),super.dispose(),this._reportedLocation=null}update(e){if(super.update(e),this._selected&&this.object&&this.eventDispatcher){const s=this.object.getLocation();(!this._reportedLocation||this._reportedLocation.x!==s.x||this._reportedLocation.y!==s.y||this._reportedLocation.z!==s.z)&&(this._reportedLocation||(this._reportedLocation=new F),this._reportedLocation.assign(s),this.eventDispatcher.dispatchEvent(new hr(hr.POSITION_CHANGED,this.object)))}const t=this.object&&this.object.model;t&&this.updateModel(this.time,t)}updateModel(e,t){this._talkingEndTimestamp>0&&(e>this._talkingEndTimestamp?(t.setValue(C.FIGURE_TALK,0),this._talkingEndTimestamp=0,this._talkingPauseStartTimestamp=0,this._talkingPauseEndTimestamp=0):!this._talkingPauseEndTimestamp&&!this._talkingPauseStartTimestamp?(this._talkingPauseStartTimestamp=e+this.randomTalkingPauseStartTimestamp(),this._talkingPauseEndTimestamp=this._talkingPauseStartTimestamp+this.randomTalkingPauseEndTimestamp()):this._talkingPauseStartTimestamp>0&&e>this._talkingPauseStartTimestamp?(t.setValue(C.FIGURE_TALK,0),this._talkingPauseStartTimestamp=0):this._talkingPauseEndTimestamp>0&&e>this._talkingPauseEndTimestamp&&(t.setValue(C.FIGURE_TALK,1),this._talkingPauseEndTimestamp=0)),this._animationEndTimestamp>0&&e>this._animationEndTimestamp&&(t.setValue(C.FIGURE_EXPRESSION,0),this._animationEndTimestamp=0),this._gestureEndTimestamp>0&&e>this._gestureEndTimestamp&&(t.setValue(C.FIGURE_GESTURE,0),this._gestureEndTimestamp=0),this._signEndTimestamp>0&&e>this._signEndTimestamp&&(t.setValue(C.FIGURE_SIGN,-1),this._signEndTimestamp=0),this._carryObjectEndTimestamp>0&&e>this._carryObjectEndTimestamp&&(t.setValue(C.FIGURE_CARRY_OBJECT,0),t.setValue(C.FIGURE_USE_OBJECT,0),this._carryObjectStartTimestamp=0,this._carryObjectEndTimestamp=0,this._allowUseCarryObject=!1),this._allowUseCarryObject&&e-this._carryObjectStartTimestamp>5e3&&((e-this._carryObjectStartTimestamp)%1e4<1e3?t.setValue(C.FIGURE_USE_OBJECT,1):t.setValue(C.FIGURE_USE_OBJECT,0)),this._blinkingStartTimestamp>-1&&e>this._blinkingStartTimestamp&&(t.setValue(C.FIGURE_BLINK,1),this._blinkingStartTimestamp=e+this.randomBlinkStartTimestamp(),this._blinkingEndTimestamp=e+this.randomBlinkEndTimestamp()),this._blinkingEndTimestamp>0&&e>this._blinkingEndTimestamp&&(t.setValue(C.FIGURE_BLINK,0),this._blinkingEndTimestamp=0),this._effectChangeTimeStamp>0&&e>this._effectChangeTimeStamp&&(t.setValue(C.FIGURE_EFFECT,this._newEffect),this._effectChangeTimeStamp=0),this._numberValueEndTimestamp>0&&e>this._numberValueEndTimestamp&&(t.setValue(C.FIGURE_NUMBER_VALUE,0),this._numberValueEndTimestamp=0)}processUpdateMessage(e){if(!e||!this.object)return;super.processUpdateMessage(e);const t=this.object&&this.object.model;if(t){if(e instanceof TE){t.setValue(C.FIGURE_POSTURE,e.postureType),t.setValue(C.FIGURE_POSTURE_PARAMETER,e.parameter);return}if(e instanceof IE){t.setValue(C.FIGURE_TALK,1),this._talkingEndTimestamp=this.time+e.numberOfWords*1e3;return}if(e instanceof Zv){t.setValue(C.FIGURE_IS_TYPING,e.isTyping?1:0);return}if(e instanceof zv){t.setValue(C.FIGURE_IS_MUTED,e.isMuted?1:0);return}if(e instanceof Qv){t.setValue(C.FIGURE_IS_PLAYING_GAME,e.isPlayingGame?1:0);return}if(e instanceof Qh){t.setValue(C.HEAD_DIRECTION,e.headDirection),t.setValue(C.FIGURE_CAN_STAND_UP,e.canStandUp),t.setValue(C.FIGURE_VERTICAL_OFFSET,e.baseY);return}if(e instanceof Yv){t.setValue(C.FIGURE_GESTURE,e.gesture),this._gestureEndTimestamp=this.time+3e3;return}if(e instanceof jv){t.setValue(C.FIGURE_EXPRESSION,e.expressionType),this._animationEndTimestamp=fe.getExpressionTimeout(t.getValue(C.FIGURE_EXPRESSION)),this._animationEndTimestamp>-1&&(this._animationEndTimestamp+=this.time);return}if(e instanceof kv){t.setValue(C.FIGURE_DANCE,e.danceStyle);return}if(e instanceof RE){t.setValue(C.FIGURE_SLEEP,e.isSleeping?1:0),e.isSleeping?this._blinkingStartTimestamp=-1:this._blinkingStartTimestamp=this.time+this.randomBlinkStartTimestamp();return}if(e instanceof qv){t.setValue(C.FIGURE_NUMBER_VALUE,e.value),this._numberValueEndTimestamp=this.time+3e3;return}if(e instanceof Vv){this.updateAvatarEffect(e.effect,e.delayMilliseconds,t);return}if(e instanceof Bv){t.setValue(C.FIGURE_CARRY_OBJECT,e.itemType),t.setValue(C.FIGURE_USE_OBJECT,0),e.itemType===0?(this._carryObjectStartTimestamp=0,this._carryObjectEndTimestamp=0,this._allowUseCarryObject=!1):(this._carryObjectStartTimestamp=this.time,e.itemType<pr.MAX_HAND_ID?(this._carryObjectEndTimestamp=0,this._allowUseCarryObject=e.itemType<=pr.MAX_HAND_USE_ID):(this._carryObjectEndTimestamp=this._carryObjectStartTimestamp+1500,this._allowUseCarryObject=!1));return}if(e instanceof $v){t.setValue(C.FIGURE_USE_OBJECT,e.itemType);return}if(e instanceof Jv){t.setValue(C.FIGURE_SIGN,e.signType),this._signEndTimestamp=this.time+5e3;return}if(e instanceof Wv){t.setValue(C.FIGURE_FLAT_CONTROL,e.level);return}if(e instanceof Xh){t.setValue(C.FIGURE,e.figure),t.setValue(C.GENDER,e.gender);return}if(e instanceof qh){this._selected=e.selected,this._reportedLocation=null;return}if(e instanceof Kv){t.setValue(C.OWN_USER,1);return}}}updateAvatarEffect(e,t,s){if(e===pr.EFFECT_TYPE_SPLASH)this._effectChangeTimeStamp=ve()+pr.EFFECT_SPLASH_LENGTH,this._newEffect=pr.EFFECT_TYPE_SWIM;else if(e===pr.EFFECT_TYPE_SPLASH_DARK)this._effectChangeTimeStamp=ve()+pr.EFFECT_SPLASH_LENGTH,this._newEffect=pr.EFFECT_TYPE_SWIM_DARK;else if(s.getValue(C.FIGURE_EFFECT)===pr.EFFECT_TYPE_SWIM)this._effectChangeTimeStamp=ve()+pr.EFFECT_SPLASH_LENGTH,this._newEffect=e,e=pr.EFFECT_TYPE_SPLASH;else if(s.getValue(C.FIGURE_EFFECT)===pr.EFFECT_TYPE_SWIM_DARK)this._effectChangeTimeStamp=ve()+pr.EFFECT_SPLASH_LENGTH,this._newEffect=e,e=pr.EFFECT_TYPE_SPLASH_DARK;else if(t===0)this._effectChangeTimeStamp=0;else{this._effectChangeTimeStamp=ve()+t,this._newEffect=e;return}s.setValue(C.FIGURE_EFFECT,e)}mouseEvent(e,t){let s=null;switch(e.type){case ie.MOUSE_CLICK:s=Me.CLICK;break;case ie.DOUBLE_CLICK:s=Me.DOUBLE_CLICK;break;case ie.ROLL_OVER:s=Me.MOUSE_ENTER,this.object.model&&this.object.model.setValue(C.FIGURE_HIGHLIGHT,1),this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new oe(oe.MOUSE_BUTTON,this.object));break;case ie.ROLL_OUT:s=Me.MOUSE_LEAVE,this.object.model&&this.object.model.setValue(C.FIGURE_HIGHLIGHT,0),this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new oe(oe.MOUSE_ARROW,this.object));break}s&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Me(s,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown))}randomTalkingPauseStartTimestamp(){return 100+Math.random()*200}randomTalkingPauseEndTimestamp(){return 75+Math.random()*75}randomBlinkStartTimestamp(){return 4500+Math.random()*1e3}randomBlinkEndTimestamp(){return 50+Math.random()*200}};ja.MAX_HAND_ID=999999999;ja.MAX_HAND_USE_ID=999;ja.EFFECT_TYPE_SPLASH=28;ja.EFFECT_SPLASH_LENGTH=500;ja.EFFECT_TYPE_SWIM=29;ja.EFFECT_TYPE_SPLASH_DARK=184;ja.EFFECT_TYPE_SWIM_DARK=185;let tK=ja;const CE=class Di extends El{constructor(){super(),this._sizeX=0,this._sizeY=0,this._sizeZ=0,this._centerX=0,this._centerY=0,this._centerZ=0,this._directions=[],this._mouseOver=!1,this._locationOffset=new F,this._bouncingStep=0,this._storedRotateMessage=null,this._directionInitialized=!1,Di.BOUNCING_STEPS===-1&&(Di.BOUNCING_STEPS=Ue.getValue("furni.rotation.bounce.steps",8)),Di.BOUNCING_Z===-1&&(Di.BOUNCING_Z=Ue.getValue("furni.rotation.bounce.height",.0625))}getEventTypes(){const e=[it.STATE_CHANGE,Me.CLICK,Me.MOUSE_DOWN,Me.MOUSE_DOWN_LONG,Ut.ROOM_AD_TOOLTIP_SHOW,Ut.ROOM_AD_TOOLTIP_HIDE,Ut.ROOM_AD_FURNI_DOUBLE_CLICK,Ut.ROOM_AD_FURNI_CLICK];return this.widget&&e.push(W.OPEN_WIDGET,W.CLOSE_WIDGET),this.contextMenu&&e.push(W.OPEN_FURNI_CONTEXT_MENU,W.CLOSE_FURNI_CONTEXT_MENU),this.mergeTypes(super.getEventTypes(),e)}initialize(e){if(!e)return;const t=this.object&&this.object.model;if(t){if(e.logic){if(e.logic.model){const s=e.logic.model.dimensions;s&&(this._sizeX=s.x,this._sizeY=s.y,this._sizeZ=s.z,this._centerX=this._sizeX/2,this._centerY=this._sizeY/2,this._centerZ=this._sizeZ/2);const r=e.logic.model.directions;if(r&&r.length){for(const i of r)this._directions.push(i);this._directions.sort((i,a)=>i-a)}}if(e.logic.customVars){const s=e.logic.customVars.variables;s&&s.length&&t.setValue(C.FURNITURE_CUSTOM_VARIABLES,s)}}t.setValue(C.FURNITURE_SIZE_X,this._sizeX),t.setValue(C.FURNITURE_SIZE_Y,this._sizeY),t.setValue(C.FURNITURE_SIZE_Z,this._sizeZ),t.setValue(C.FURNITURE_CENTER_X,this._centerX),t.setValue(C.FURNITURE_CENTER_Y,this._centerY),t.setValue(C.FURNITURE_CENTER_Z,this._centerZ),t.setValue(C.FURNITURE_ALLOWED_DIRECTIONS,this._directions),t.setValue(C.FURNITURE_ALPHA_MULTIPLIER,1)}}onDispose(){this._storedRotateMessage=null,this._directions=null,super.onDispose()}setObject(e){super.setObject(e),e&&e.getLocation().length&&(this._directionInitialized=!0)}getAdClickUrl(e){return e.getValue(C.FURNITURE_AD_URL)}handleAdClick(e,t,s){this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Ut(Ut.ROOM_AD_FURNI_CLICK,this.object))}update(e){super.update(e),this._bouncingStep>0&&(this._bouncingStep++,this._bouncingStep>Di.BOUNCING_STEPS&&(this._bouncingStep=0))}processUpdateMessage(e){if(e instanceof Pt){this.processDataUpdateMessage(e);return}if(e instanceof eb){this.processObjectHeightUpdateMessage(e);return}if(e instanceof OE){this.processItemDataUpdateMessage(e);return}if(this._mouseOver=!1,e.location&&e.direction){if(!(e instanceof Ua)){const t=this.object.getDirection(),s=this.object.getLocation();t.x!==e.direction.x&&this._directionInitialized&&s.x===e.location.x&&s.y===e.location.y&&s.z===e.location.z&&(this._bouncingStep=1,this._storedRotateMessage=new Rs(e.location,e.direction),e=null)}this._directionInitialized=!0}if(e instanceof kc&&this.contextMenu&&this.eventDispatcher&&this.object){const t=e.selected?W.OPEN_FURNI_CONTEXT_MENU:W.CLOSE_FURNI_CONTEXT_MENU;this.eventDispatcher.dispatchEvent(new W(t,this.object))}super.processUpdateMessage(e)}processDataUpdateMessage(e){e&&(this.object.setState(e.state,0),e.data&&e.data.writeRoomObjectModel(this.object.model),e.extra!==null&&this.object.model.setValue(C.FURNITURE_EXTRAS,e.extra.toString()),this.object.model.setValue(C.FURNITURE_STATE_UPDATE_TIME,this.lastUpdateTime))}processObjectHeightUpdateMessage(e){e&&this.object.model.setValue(C.FURNITURE_SIZE_Z,e.height)}processItemDataUpdateMessage(e){e&&this.object.model.setValue(C.FURNITURE_ITEMDATA,e.data)}mouseEvent(e,t){const s=this.getAdClickUrl(this.object.model);switch(e.type){case ie.MOUSE_MOVE:if(this.eventDispatcher){const r=new Me(Me.MOUSE_MOVE,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);r.localX=e.localX,r.localY=e.localY,r.spriteOffsetX=e.spriteOffsetX,r.spriteOffsetY=e.spriteOffsetY,this.eventDispatcher.dispatchEvent(r)}return;case ie.ROLL_OVER:if(!this._mouseOver){if(this.eventDispatcher){s&&s.indexOf("http")===0&&this.eventDispatcher.dispatchEvent(new Ut(Ut.ROOM_AD_TOOLTIP_SHOW,this.object));const r=new Me(Me.MOUSE_ENTER,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);r.localX=e.localX,r.localY=e.localY,r.spriteOffsetX=e.spriteOffsetX,r.spriteOffsetY=e.spriteOffsetY,this.eventDispatcher.dispatchEvent(r)}this._mouseOver=!0}return;case ie.ROLL_OUT:if(this._mouseOver){if(this.eventDispatcher){s&&s.indexOf("http")===0&&this.eventDispatcher.dispatchEvent(new Ut(Ut.ROOM_AD_TOOLTIP_HIDE,this.object));const r=new Me(Me.MOUSE_LEAVE,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);r.localX=e.localX,r.localY=e.localY,r.spriteOffsetX=e.spriteOffsetX,r.spriteOffsetY=e.spriteOffsetY,this.eventDispatcher.dispatchEvent(r)}this._mouseOver=!1}return;case ie.DOUBLE_CLICK:this.useObject();return;case ie.MOUSE_CLICK:if(this.eventDispatcher){const r=new Me(Me.CLICK,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);r.localX=e.localX,r.localY=e.localY,r.spriteOffsetX=e.spriteOffsetX,r.spriteOffsetY=e.spriteOffsetY,this.eventDispatcher.dispatchEvent(r),s&&s.indexOf("http")===0&&this.eventDispatcher.dispatchEvent(new Ut(Ut.ROOM_AD_TOOLTIP_HIDE,this.object)),s&&s.length&&this.handleAdClick(this.object.id,this.object.type,s)}return;case ie.MOUSE_DOWN:if(this.eventDispatcher){const r=new Me(Me.MOUSE_DOWN,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);this.eventDispatcher.dispatchEvent(r)}return;case ie.MOUSE_DOWN_LONG:if(this.eventDispatcher){const r=new Me(Me.MOUSE_DOWN_LONG,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);this.eventDispatcher.dispatchEvent(r)}return}}getLocationOffset(){return this._bouncingStep<=0?null:(this._locationOffset.x=0,this._locationOffset.y=0,this._bouncingStep<=Di.BOUNCING_STEPS/2?this._locationOffset.z=Di.BOUNCING_Z*this._bouncingStep:this._bouncingStep<=Di.BOUNCING_STEPS&&(this._storedRotateMessage&&(super.processUpdateMessage(this._storedRotateMessage),this._storedRotateMessage=null),this._locationOffset.z=Di.BOUNCING_Z*(Di.BOUNCING_STEPS-this._bouncingStep)),this._locationOffset)}useObject(){if(!this.object||!this.eventDispatcher)return;const e=this.getAdClickUrl(this.object.model);e&&e.length&&this.eventDispatcher.dispatchEvent(new Ut(Ut.ROOM_AD_FURNI_DOUBLE_CLICK,this.object,null,e)),this.widget&&this.eventDispatcher.dispatchEvent(new W(W.OPEN_WIDGET,this.object)),this.eventDispatcher.dispatchEvent(new it(it.STATE_CHANGE,this.object))}tearDown(){this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&(this.widget&&this.eventDispatcher.dispatchEvent(new W(W.CLOSE_WIDGET,this.object)),this.contextMenu&&this.eventDispatcher.dispatchEvent(new W(W.CLOSE_FURNI_CONTEXT_MENU,this.object))),super.tearDown()}};CE.BOUNCING_STEPS=-1;CE.BOUNCING_Z=-1;let St=CE;class nb extends St{getEventTypes(){const e=[W.BADGE_DISPLAY_ENGRAVING,_n.LOAD_BADGE];return this.mergeTypes(super.getEventTypes(),e)}processUpdateMessage(e){if(super.processUpdateMessage(e),!!this.object){if(e instanceof Pt){const t=e.data;t instanceof ta&&this.updateBadge(t.getValue(1));return}if(e instanceof Dl){e.assetName!=="loading_icon"&&(this.object.model.setValue(C.FURNITURE_BADGE_ASSET_NAME,e.assetName),this.object.model.setValue(C.FURNITURE_BADGE_IMAGE_STATUS,1),this.update(ve()));return}}}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.BADGE_DISPLAY_ENGRAVING,this.object))}updateBadge(e){e!==""&&this.eventDispatcher&&(this.object.model.setValue(C.FURNITURE_BADGE_IMAGE_STATUS,-1),this.eventDispatcher.dispatchEvent(new _n(_n.LOAD_BADGE,this.object,e,!1)))}}const Po=class ao extends nb{getEventTypes(){const e=[W.ACHIEVEMENT_RESOLUTION_OPEN,W.ACHIEVEMENT_RESOLUTION_ENGRAVING,W.ACHIEVEMENT_RESOLUTION_FAILED,_n.LOAD_BADGE];return this.mergeTypes(super.getEventTypes(),e)}processUpdateMessage(e){if(super.processUpdateMessage(e),e instanceof Dl&&e.assetName!=="loading_icon"&&this.object.model.setValue(C.FURNITURE_BADGE_VISIBLE_IN_STATE,ao.BADGE_VISIBLE_IN_STATE),e instanceof kc){if(!this.eventDispatcher||!this.object)return;this.eventDispatcher.dispatchEvent(new W(W.CLOSE_FURNI_CONTEXT_MENU,this.object))}}useObject(){if(!this.object||!this.eventDispatcher)return;let e=null;switch(this.object.getState(0)){case ao.STATE_RESOLUTION_NOT_STARTED:case ao.STATE_RESOLUTION_IN_PROGRESS:e=new W(W.ACHIEVEMENT_RESOLUTION_OPEN,this.object);break;case ao.STATE_RESOLUTION_ACHIEVED:e=new W(W.ACHIEVEMENT_RESOLUTION_ENGRAVING,this.object);break;case ao.STATE_RESOLUTION_FAILED:e=new W(W.ACHIEVEMENT_RESOLUTION_FAILED,this.object);break}e&&this.eventDispatcher.dispatchEvent(e)}updateBadge(e){e!==ao.ACH_NOT_SET&&super.updateBadge(e)}};Po.STATE_RESOLUTION_NOT_STARTED=0;Po.STATE_RESOLUTION_IN_PROGRESS=1;Po.STATE_RESOLUTION_ACHIEVED=2;Po.STATE_RESOLUTION_FAILED=3;Po.ACH_NOT_SET="ach_0";Po.BADGE_VISIBLE_IN_STATE=2;let sK=Po;class rK extends St{constructor(){super(),this.onRoomToObjectOwnAvatarMoveEvent=this.onRoomToObjectOwnAvatarMoveEvent.bind(this)}initialize(e){super.initialize(e),this.eventDispatcher&&this.eventDispatcher.addEventListener(xc.ROAME_MOVE_TO,this.onRoomToObjectOwnAvatarMoveEvent)}tearDown(){this.eventDispatcher&&this.eventDispatcher.removeEventListener(xc.ROAME_MOVE_TO,this.onRoomToObjectOwnAvatarMoveEvent),super.tearDown()}onRoomToObjectOwnAvatarMoveEvent(e){if(!e||!this.object)return;const t=this.object.getLocation(),s=e.targetLocation;if(!s)return;let r=this.object.model.getValue(C.FURNITURE_SIZE_X),i=this.object.model.getValue(C.FURNITURE_SIZE_Y);const a=(Math.floor(this.object.getDirection().x)+45)%360/90;(a===1||a===3)&&([r,i]=[i,r]),s.x>=t.x&&s.x<t.x+r&&s.y>=t.y&&s.y<t.y+i?this.object.setState(1,0):this.object.setState(0,0)}}class iK extends St{getEventTypes(){const e=[W.CLOTHING_CHANGE];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e);const t=this.object.model.getValue(C.FURNITURE_DATA);this.updateClothingData(t)}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&e.data&&this.updateClothingData(e.data.getLegacyString())}updateClothingData(e){if(!e||!e.length)return;const[t,s]=e.split(",");t&&t.length&&this.object.model.setValue(C.FURNITURE_CLOTHING_BOY,t),s&&s.length&&this.object.model.setValue(C.FURNITURE_CLOTHING_GIRL,s)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.CLOTHING_CHANGE,this.object))}}class nK extends St{getEventTypes(){const e=[it.STATE_CHANGE];return this.mergeTypes(super.getEventTypes(),e)}mouseEvent(e,t){if(!e||!t||!this.object)return;let s=null;switch(e.type){case ie.DOUBLE_CLICK:switch(e.spriteTag){case"start_stop":s=new it(it.STATE_CHANGE,this.object,1);break;case"reset":s=new it(it.STATE_CHANGE,this.object,2);break}if(this.eventDispatcher&&s){this.eventDispatcher.dispatchEvent(s);return}break}super.mouseEvent(e,t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new it(it.STATE_CHANGE,this.object,1))}}class aK extends St{processUpdateMessage(e){super.processUpdateMessage(e),this.object&&this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this.object.model.setValue(Kt.INFOSTAND_EXTRA_PARAM,Kt.CRACKABLE_FURNI)}}class oK extends St{get widget(){return De.CRAFTING}}class lK extends St{getEventTypes(){const e=[W.CREDITFURNI];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e);let t=0;e.logic&&e.logic.credits&&e.logic.credits!==""&&e.logic.credits.length>0&&(t=parseInt(e.logic.credits)),this.object.model.setValue(C.FURNITURE_CREDIT_VALUE,t)}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new W(W.CREDITFURNI,this.object)),super.useObject())}}class hs extends St{getEventTypes(){const e=[oe.MOUSE_BUTTON,oe.MOUSE_ARROW];return this.mergeTypes(super.getEventTypes(),e)}mouseEvent(e,t){if(!(!e||!t||!this.object)){switch(e.type){case ie.ROLL_OVER:this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new oe(oe.MOUSE_BUTTON,this.object));break;case ie.ROLL_OUT:this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new oe(oe.MOUSE_ARROW,this.object));break}super.mouseEvent(e,t)}}}class cK extends hs{constructor(){super(...arguments),this._state=1}getEventTypes(){const e=[Wn.PLAY_SOUND_AT_PITCH];return this.mergeTypes(super.getEventTypes(),e)}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&(this._state!==-1&&e.state!==this._state&&this.dispatchSoundEvent(this.object.location.z),this._state=e.state)}dispatchSoundEvent(e){const t=Math.pow(2,e-1.2);this.eventDispatcher.dispatchEvent(new Wn(Wn.PLAY_SOUND_AT_PITCH,this.object,"FURNITURE_cuckoo_clock",t))}}class uK extends hs{getEventTypes(){const e=[W.STACK_HEIGHT];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),this.object&&this.object.model&&this.object.model.setValue(C.FURNITURE_ALWAYS_STACKABLE,1)}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new W(W.STACK_HEIGHT,this.object)),super.useObject())}}class hK extends St{constructor(){super(),this._noTags=!1,this._noTagsLastStateActivate=!1}getEventTypes(){const e=[oe.DICE_ACTIVATE,oe.DICE_OFF];return this.mergeTypes(super.getEventTypes(),e)}mouseEvent(e,t){if(!e||!t||!this.object)return;let s=null;switch(e.type){case ie.DOUBLE_CLICK:this._noTags?!this._noTagsLastStateActivate||this.object.getState(0)===0||this.object.getState(0)===100?(s=new oe(oe.DICE_ACTIVATE,this.object),this._noTagsLastStateActivate=!0):(s=new oe(oe.DICE_OFF,this.object),this._noTagsLastStateActivate=!1):e.spriteTag==="activate"||this.object.getState(0)===0||this.object.getState(0)===100?s=new oe(oe.DICE_ACTIVATE,this.object):e.spriteTag==="deactivate"&&(s=new oe(oe.DICE_OFF,this.object)),s&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(s);return}super.mouseEvent(e,t)}}class dK extends St{getEventTypes(){const e=[W.ECOTRONBOX];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.ECOTRONBOX,this.object))}}class _K extends St{constructor(){super(),this._showStateOnceRendered=!1,this._updateCount=0}getEventTypes(){const e=[W.INERNAL_LINK];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),e.logic&&e.logic.action&&e.logic.action.startState===1&&(this._showStateOnceRendered=!0)}update(e){super.update(e),this._showStateOnceRendered&&(this._updateCount++,this._showStateOnceRendered&&this._updateCount>20&&(this.setAutomaticStateIndex(1),this._showStateOnceRendered=!1))}setAutomaticStateIndex(e){this.object&&this.object.model&&this.object.model.setValue(C.FURNITURE_AUTOMATIC_STATE_INDEX,e)}mouseEvent(e,t){!e||!t||(e.type===ie.DOUBLE_CLICK&&this.setAutomaticStateIndex(0),super.mouseEvent(e,t))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.INERNAL_LINK,this.object))}}class gK extends St{getEventTypes(){const e=[W.ROOM_LINK];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),e.logic&&e.logic.action&&e.logic.action.link&&e.logic.action.link!==""&&e.logic.action.link.length>0&&this.object&&this.object.model&&this.object.model.setValue(C.FURNITURE_INTERNAL_LINK,e.logic.action.link)}onDispose(){this._timer&&(clearTimeout(this._timer),this._timer=null),super.onDispose()}setAutomaticStateIndex(e){this.object&&this.object.model&&this.object.model.setValue(C.FURNITURE_AUTOMATIC_STATE_INDEX,e)}useObject(){this.setAutomaticStateIndex(1),this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout(()=>{this.setAutomaticStateIndex(0),this._timer=null},2500),!(!this.object||!this.eventDispatcher)&&this.eventDispatcher.dispatchEvent(new W(W.ROOM_LINK,this.object))}}class fK extends St{getEventTypes(){const e=[W.EFFECTBOX_OPEN_DIALOG];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.EFFECTBOX_OPEN_DIALOG,this.object))}get contextMenu(){return Tt.EFFECT_BOX}}class mK extends hs{getEventTypes(){const e=[W.EXTERNAL_IMAGE];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){if(super.initialize(e),!!e&&this.object&&this.object.model){let t="";e.logic&&e.logic.maskType&&e.logic.maskType!==""&&e.logic.maskType.length>0&&(t=e.logic.maskType),this.object.model.setValue(C.FURNITURE_USES_PLANE_MASK,0),this.object.model.setValue(C.FURNITURE_PLANE_MASK_TYPE,t)}}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new W(W.EXTERNAL_IMAGE,this.object)),super.useObject())}}class EK extends St{getEventTypes(){const e=[it.STATE_CHANGE];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),e.logic&&e.logic.particleSystems&&e.logic.particleSystems.length&&this.object.model.setValue(C.FURNITURE_FIREWORKS_DATA,e.logic.particleSystems)}mouseEvent(e,t){if(!e||!t||!this.object)return;let s=null;switch(e.type){case ie.DOUBLE_CLICK:switch(e.spriteTag){case"start_stop":s=new it(it.STATE_CHANGE,this.object,1);break;case"reset":s=new it(it.STATE_CHANGE,this.object,2);break}if(this.eventDispatcher&&s){this.eventDispatcher.dispatchEvent(s);return}break}super.mouseEvent(e,t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new it(it.STATE_CHANGE,this.object,0))}}const ab=class mc extends hs{constructor(){super(),this._currentState=-1,this._currentLocation=null}getEventTypes(){const e=[nr.ADD_HOLE,nr.REMOVE_HOLE];return this.mergeTypes(super.getEventTypes(),e)}onDispose(){this._currentState===mc.STATE_HOLE&&this.eventDispatcher.dispatchEvent(new nr(nr.REMOVE_HOLE,this.object)),super.onDispose()}update(e){super.update(e),this.handleAutomaticStateUpdate()}processUpdateMessage(e){if(super.processUpdateMessage(e),!this.object)return;e instanceof Pt&&this.handleStateUpdate(this.object.getState(0));const t=this.object.getLocation();this._currentLocation?(t.x!==this._currentLocation.x||t.y!==this._currentLocation.y)&&this._currentState===mc.STATE_HOLE&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new nr(nr.ADD_HOLE,this.object)):this._currentLocation=new F,this._currentLocation.assign(t)}handleStateUpdate(e){e!==this._currentState&&(this.eventDispatcher&&(e===mc.STATE_HOLE?this.eventDispatcher.dispatchEvent(new nr(nr.ADD_HOLE,this.object)):this._currentState===mc.STATE_HOLE&&this.eventDispatcher.dispatchEvent(new nr(nr.REMOVE_HOLE,this.object))),this._currentState=e)}handleAutomaticStateUpdate(){if(!this.object)return;const e=this.object.model;if(!e)return;const t=e.getValue(C.FURNITURE_AUTOMATIC_STATE_INDEX);isNaN(t)||this.handleStateUpdate(t%2)}};ab.STATE_HOLE=0;let pK=ab;const Vd=class Sf extends hs{constructor(){super(...arguments),this._state=-1}initialize(e){super.initialize(e),this.object&&this.object.model.setValue(C.FURNITURE_FRIENDFURNI_ENGRAVING,this.engravingDialogType)}processUpdateMessage(e){if(e instanceof Pt){const t=e.data;t?this._state=t.state:this._state=e.state}super.processUpdateMessage(e)}getEventTypes(){const e=[W.FRIEND_FURNITURE_ENGRAVING];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||(this._state===Sf.STATE_LOCKED?this.eventDispatcher.dispatchEvent(new W(W.FRIEND_FURNITURE_ENGRAVING,this.object)):super.useObject())}get engravingDialogType(){return 0}get contextMenu(){return this._state===Sf.STATE_UNLOCKED?Tt.FRIEND_FURNITURE:Tt.DUMMY}};Vd.STATE_UNINITIALIZED=-1;Vd.STATE_UNLOCKED=0;Vd.STATE_LOCKED=1;let ob=Vd;const cu=class Ec extends hs{getEventTypes(){const e=[_n.LOAD_BADGE,W.GUILD_FURNI_CONTEXT_MENU,W.CLOSE_FURNI_CONTEXT_MENU];return this.mergeTypes(super.getEventTypes(),e)}processUpdateMessage(e){if(super.processUpdateMessage(e),e instanceof Pt){const t=e.data;t instanceof ta&&(this.updateGroupId(t.getValue(Ec.GROUPID_KEY)),this.updateBadge(t.getValue(Ec.BADGE_KEY)),this.updateColors(t.getValue(Ec.COLOR1_KEY),t.getValue(Ec.COLOR2_KEY)))}else e instanceof Dl?e.assetName!=="loading_icon"&&(this.object.model.setValue(C.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME,e.assetName),this.update(ve())):e instanceof kc&&(e.selected||this.eventDispatcher.dispatchEvent(new W(W.CLOSE_FURNI_CONTEXT_MENU,this.object)))}updateGroupId(e){this.object.model.setValue(C.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID,parseInt(e))}updateBadge(e){this.eventDispatcher.dispatchEvent(new _n(_n.LOAD_BADGE,this.object,e,!0))}updateColors(e,t){this.object.model.setValue(C.FURNITURE_GUILD_CUSTOMIZED_COLOR_1,parseInt(e,16)),this.object.model.setValue(C.FURNITURE_GUILD_CUSTOMIZED_COLOR_2,parseInt(t,16))}mouseEvent(e,t){if(!(!e||!t||!this.object)){switch(e.type){case ie.MOUSE_CLICK:this.openContextMenu()}super.mouseEvent(e,t)}}openContextMenu(){this.eventDispatcher.dispatchEvent(new W(W.GUILD_FURNI_CONTEXT_MENU,this.object))}};cu.GROUPID_KEY=1;cu.BADGE_KEY=2;cu.COLOR1_KEY=3;cu.COLOR2_KEY=4;let lb=cu;class IK extends lb{getEventTypes(){const e=[W.INERNAL_LINK];return this.mergeTypes(super.getEventTypes(),e)}updateGroupId(e){super.updateGroupId(e),this.object.model.setValue(C.FURNITURE_INTERNAL_LINK,`groupforum/${e}`)}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new W(W.INERNAL_LINK,this.object)),super.useObject())}}class TK extends St{getEventTypes(){const e=[oe.USE_HABBOWHEEL];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.USE_HABBOWHEEL,this.object))}}const cb=class ub extends St{constructor(){super(...arguments),this._state=-1}getEventTypes(){return[W.HIGH_SCORE_DISPLAY,W.HIDE_HIGH_SCORE_DISPLAY]}tearDown(){this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this.eventDispatcher.dispatchEvent(new W(W.HIDE_HIGH_SCORE_DISPLAY,this.object)),super.tearDown()}processUpdateMessage(e){super.processUpdateMessage(e),this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&e instanceof Pt&&(e.state===ub.SHOW_WIDGET_IN_STATE?this.eventDispatcher.dispatchEvent(new W(W.HIGH_SCORE_DISPLAY,this.object)):this.eventDispatcher.dispatchEvent(new W(W.HIDE_HIGH_SCORE_DISPLAY,this.object)),this._state=e.state)}};cb.SHOW_WIDGET_IN_STATE=1;let RK=cb;class OK extends St{getEventTypes(){const e=[it.STATE_CHANGE];return this.mergeTypes(super.getEventTypes(),e)}mouseEvent(e,t){if(!e||!t||!this.object)return;let s=null;switch(e.type){case ie.DOUBLE_CLICK:switch(e.spriteTag){case"off":s=new it(it.STATE_CHANGE,this.object,3);break}break;case ie.MOUSE_CLICK:switch(e.spriteTag){case"inc":s=new it(it.STATE_CHANGE,this.object,2);break;case"dec":s=new it(it.STATE_CHANGE,this.object,1);break}break}if(this.eventDispatcher&&s){this.eventDispatcher.dispatchEvent(s);return}super.mouseEvent(e,t)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new it(it.STATE_CHANGE,this.object,3))}}class SK extends ob{get engravingDialogType(){return yo.HABBOWEEN}}class CK extends hs{constructor(){super(),this._nextState=0,this._nextStateTimestamp=0}update(e){if(this._nextStateTimestamp>0&&e>=this._nextStateTimestamp){this._nextStateTimestamp=0;const t=new Br;t.setString(this._nextState.toString()),super.processUpdateMessage(new Pt(this._nextState,t,this._nextStateExtra))}super.update(e)}processUpdateMessage(e){if(e instanceof Pt){this.processUpdate(e);return}super.processUpdateMessage(e)}processUpdate(e){if(!e)return;const t=~~(e.state/1e3),s=~~(e.state%1e3);if(s)this._nextState=t,this._nextStateExtra=e.extra,this._nextStateTimestamp=this.time+s;else{this._nextStateTimestamp=0;const r=new Br;r.setString(t.toString()),super.processUpdateMessage(new Pt(t,r,e.extra))}}}class AK extends St{constructor(){super(...arguments),this._showStateOnceRendered=!1,this._updateCount=0}getEventTypes(){const e=[W.INERNAL_LINK];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),e.logic&&e.logic.action&&(this.object.model.setValue(C.FURNITURE_INTERNAL_LINK,e.logic.action.link),e.logic.action.startState===1&&(this._showStateOnceRendered=!0))}update(e){super.update(e),this._showStateOnceRendered&&(this._updateCount++,this._showStateOnceRendered&&this._updateCount===20&&(this.setAutomaticStateIndex(1),this._showStateOnceRendered=!1))}setAutomaticStateIndex(e){this.object&&this.object.model&&this.object.model.setValue(C.FURNITURE_AUTOMATIC_STATE_INDEX,e)}mouseEvent(e,t){!e||!t||(e.type===ie.DOUBLE_CLICK&&this._showStateOnceRendered&&this.setAutomaticStateIndex(0),super.mouseEvent(e,t))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.INERNAL_LINK,this.object))}}class NK extends hs{constructor(){super(...arguments),this._disposeEventsAllowed=!1,this._isInitialized=!1,this._currentState=-1}getEventTypes(){const e=[oe.JUKEBOX_START,oe.JUKEBOX_MACHINE_STOP,oe.JUKEBOX_DISPOSE,oe.JUKEBOX_INIT,W.JUKEBOX_PLAYLIST_EDITOR];return this.mergeTypes(super.getEventTypes(),e)}onDispose(){this.requestDispose(),super.onDispose()}processUpdateMessage(e){if(super.processUpdateMessage(e),this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&(this._isInitialized||this.requestInit(),this.object.model.setValue(Kt.INFOSTAND_EXTRA_PARAM,Kt.JUKEBOX),e instanceof Pt)){const t=this.object.getState(0);t!==this._currentState&&(this._currentState=t,t===1?this.requestPlayList():t===0&&this.requestStopPlaying())}}requestInit(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new oe(oe.JUKEBOX_INIT,this.object)),this._isInitialized=!0)}requestPlayList(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new oe(oe.JUKEBOX_START,this.object)))}requestStopPlaying(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.JUKEBOX_MACHINE_STOP,this.object))}requestDispose(){!this._disposeEventsAllowed||!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.JUKEBOX_DISPOSE,this.object))}useObject(){!this.object||!this.eventDispatcher||(this.eventDispatcher.dispatchEvent(new W(W.JUKEBOX_PLAYLIST_EDITOR,this.object)),this.eventDispatcher.dispatchEvent(new it(it.STATE_CHANGE,this.object,-1)))}}class yK extends ob{get engravingDialogType(){return yo.LOVE_LOCK}}const Hd=class gh extends St{getEventTypes(){const e=[W.MANNEQUIN];return this.mergeTypes(super.getEventTypes(),e)}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&(e.data.writeRoomObjectModel(this.object.model),this.processObjectData())}processObjectData(){if(!this.object||!this.object.model)return;const e=new Uc;e.initializeFromRoomObjectModel(this.object.model),this.object.model.setValue(C.FURNITURE_MANNEQUIN_GENDER,e.getValue(gh.GENDER)),this.object.model.setValue(C.FURNITURE_MANNEQUIN_FIGURE,e.getValue(gh.FIGURE)),this.object.model.setValue(C.FURNITURE_MANNEQUIN_NAME,e.getValue(gh.OUTFIT_NAME))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.MANNEQUIN,this.object))}};Hd.GENDER="GENDER";Hd.FIGURE="FIGURE";Hd.OUTFIT_NAME="OUTFIT_NAME";let MK=Hd;class DK extends hs{getEventTypes(){const e=[W.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG,this.object))}get contextMenu(){return Tt.MONSTERPLANT_SEED}}class vK extends hs{initialize(e){super.initialize(e),this.object&&this.object.model&&this.object.model.setValue(C.FURNITURE_IS_VARIABLE_HEIGHT,1)}}class bK extends hs{getEventTypes(){const e=[W.MYSTERYBOX_OPEN_DIALOG];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.MYSTERYBOX_OPEN_DIALOG,this.object))}get contextMenu(){return Tt.MYSTERY_BOX}}class PK extends hs{getEventTypes(){const e=[W.MYSTERYTROPHY_OPEN_DIALOG];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.MYSTERYTROPHY_OPEN_DIALOG,this.object))}get contextMenu(){return Tt.MYSTERY_TROPHY}}class LK extends St{getEventTypes(){const e=[oe.ENTER_ONEWAYDOOR];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.ENTER_ONEWAYDOOR,this.object))}}class UK extends St{getEventTypes(){const e=[W.PET_PRODUCT_MENU];return this.mergeTypes(super.getEventTypes(),e)}processUpdateMessage(e){super.processUpdateMessage(e),this.object&&this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this.object.model.setValue(Kt.INFOSTAND_EXTRA_PARAM,Kt.USABLE_PRODUCT)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.PET_PRODUCT_MENU,this.object))}}class FK extends St{getEventTypes(){const e=[W.PLACEHOLDER];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.PLACEHOLDER,this.object))}}class xK extends St{initialize(e){super.initialize(e),e.logic&&e.logic.planetSystems&&this.object.model.setValue(C.FURNITURE_PLANETSYSTEM_DATA,e.logic.planetSystems)}}const Yl=class Zo extends St{getEventTypes(){const e=[W.PRESENT];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),e.logic&&e.logic.particleSystems&&e.logic.particleSystems.length&&this.object.model.setValue(C.FURNITURE_FIREWORKS_DATA,e.logic.particleSystems)}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&(e.data.writeRoomObjectModel(this.object.model),this.updateStuffData()),e instanceof tb&&e.numberKey===C.FURNITURE_DISABLE_PICKING_ANIMATION&&this.object.model.setValue(C.FURNITURE_DISABLE_PICKING_ANIMATION,e.numberValue)}updateStuffData(){if(!this.object||!this.object.model)return;const e=new Uc;e.initializeFromRoomObjectModel(this.object.model);const t=e.getValue(Zo.MESSAGE),s=this.object.model.getValue(C.FURNITURE_DATA);!t&&typeof s=="string"?this.object.model.setValue(C.FURNITURE_DATA,s.substr(1)):this.object.model.setValue(C.FURNITURE_DATA,e.getValue(Zo.MESSAGE)),this.writeToModel(C.FURNITURE_TYPE_ID,e.getValue(Zo.PRODUCT_CODE)),this.writeToModel(C.FURNITURE_PURCHASER_NAME,e.getValue(Zo.PURCHASER_NAME)),this.writeToModel(C.FURNITURE_PURCHASER_FIGURE,e.getValue(Zo.PURCHASER_FIGURE))}writeToModel(e,t){t&&this.object.model.setValue(e,t)}mouseEvent(e,t){if(!(!e||!t||!this.object)){switch(e.type){case ie.ROLL_OVER:this.eventDispatcher.dispatchEvent(new oe(oe.MOUSE_BUTTON,this.object));break;case ie.ROLL_OUT:this.eventDispatcher.dispatchEvent(new oe(oe.MOUSE_ARROW,this.object));break}super.mouseEvent(e,t)}}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.PRESENT,this.object))}};Yl.MESSAGE="MESSAGE";Yl.PRODUCT_CODE="PRODUCT_CODE";Yl.EXTRA_PARAM="EXTRA_PARAM";Yl.PURCHASER_NAME="PURCHASER_NAME";Yl.PURCHASER_FIGURE="PURCHASER_FIGURE";let wK=Yl;class GK extends hs{getEventTypes(){const e=[W.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG,this.object))}get contextMenu(){return Tt.PURCHASABLE_CLOTHING}}const jd=class pc extends hs{constructor(){super(),this.updateInterval=El.DEFAULT_UPDATE_INTERVAL,this._oldLocation=new F}processUpdateMessage(e){if(!e)return;const t=e instanceof Ua;if(this.object&&!t&&e.location){const s=this.object.getLocation(),r=F.dif(e.location,s);if(r&&Math.abs(r.x)<2&&Math.abs(r.y)<2){let i=s;(Math.abs(r.x)>1||Math.abs(r.y)>1)&&(i=F.sum(s,F.product(r,.5))),super.processUpdateMessage(new Ua(i,e.location,e.direction));return}}if(e.location&&!t&&super.processUpdateMessage(new Ua(e.location,e.location,e.direction)),e instanceof Pt){e.state>0?this.updateInterval=El.DEFAULT_UPDATE_INTERVAL/this.getUpdateIntervalValue(e.state):this.updateInterval=1,this.handleDataUpdate(e);return}t&&e.isSlide&&(this.updateInterval=El.DEFAULT_UPDATE_INTERVAL),super.processUpdateMessage(e)}getUpdateIntervalValue(e){return e/pc.MAX_ANIMATION_COUNT}getAnimationValue(e){return e%pc.MAX_ANIMATION_COUNT}handleDataUpdate(e){const t=this.getAnimationValue(e.state);if(t!==e.state){const s=new Br;s.setString(t.toString()),e=new Pt(t,s,e.extra)}super.processUpdateMessage(e)}update(e){this.object&&(this._oldLocation.assign(this.object.getLocation()),super.update(e),F.dif(this.object.getLocation(),this._oldLocation).length===0&&this.object.getState(0)!==pc.ANIMATION_NOT_MOVING&&this.object.setState(pc.ANIMATION_NOT_MOVING,0))}};jd.ANIMATION_NOT_MOVING=0;jd.ANIMATION_MOVING=1;jd.MAX_ANIMATION_COUNT=10;let BK=jd;class kK extends St{getEventTypes(){const e=[it.STATE_RANDOM];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new it(it.STATE_RANDOM,this.object))}}class VK extends hs{get contextMenu(){return Tt.RANDOM_TELEPORT}}class HK extends St{getEventTypes(){const e=[fi.RODRE_CURRENT_USER_ID];return this.mergeTypes(super.getEventTypes(),e)}update(e){if(super.update(e),this.object&&this.object.model){this.object.model.getValue(C.SESSION_CURRENT_USER_ID)||this.eventDispatcher.dispatchEvent(new fi(fi.RODRE_CURRENT_USER_ID,this.object));const t=this.object.model.getValue(C.FURNITURE_DATA).renterId,s=this.object.model.getValue(C.SESSION_CURRENT_USER_ID);t?parseInt(t)===s?this.object.setState(2,0):this.object.setState(1,0):this.object.setState(0,0)}}get widget(){return De.RENTABLESPACE}}class jK extends hs{constructor(){super(),this._roomColorUpdated=!1}getEventTypes(){const e=[W.BACKGROUND_COLOR,Sa.ROOM_BACKGROUND_COLOR];return this.mergeTypes(super.getEventTypes(),e)}onDispose(){this._roomColorUpdated&&(this.eventDispatcher&&this.object&&this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this.eventDispatcher.dispatchEvent(new Sa(Sa.ROOM_BACKGROUND_COLOR,this.object,!1,0,0,0)),this._roomColorUpdated=!1),super.onDispose()}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&(e.data.writeRoomObjectModel(this.object.model),this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this.processColorUpdate())}processColorUpdate(){if(!this.object||!this.object.model)return;const e=new gg;e.initializeFromRoomObjectModel(this.object.model);const t=e.getValue(0),s=e.getValue(1),r=e.getValue(2),i=e.getValue(3);t>-1&&s>-1&&r>-1&&i>-1&&(this.object.model.setValue(C.FURNITURE_ROOM_BACKGROUND_COLOR_HUE,s),this.object.model.setValue(C.FURNITURE_ROOM_BACKGROUND_COLOR_SATURATION,r),this.object.model.setValue(C.FURNITURE_ROOM_BACKGROUND_COLOR_LIGHTNESS,i),this.object.setState(t,0),this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Sa(Sa.ROOM_BACKGROUND_COLOR,this.object,t===1,s,r,i)),this._roomColorUpdated=!0)}mouseEvent(e,t){if(!(!e||!t||!this.object)){switch(e.type){case ie.DOUBLE_CLICK:this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new W(W.BACKGROUND_COLOR,this.object));return}super.mouseEvent(e,t)}}}const Lo=class ai extends St{constructor(){super(),this._disableFurnitureSelection=!0,this._hasClickUrl=!1}getEventTypes(){const e=[Ut.ROOM_AD_LOAD_IMAGE];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),this._disableFurnitureSelection&&this.object.model.setValue(C.FURNITURE_SELECTION_DISABLED,1)}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&this.processAdDataUpdateMessage(e),e instanceof Ir&&this.processAdUpdate(e)}processAdDataUpdateMessage(e){if(!e)return;const t=new Uc;t.initializeFromRoomObjectModel(this.object.model);const s=parseInt(t.getValue(ai.STATE));!isNaN(s)&&this.object.getState(0)!==s&&this.object.setState(s,0);const r=t.getValue(ai.IMAGEURL_KEY),i=this.object.model.getValue(C.FURNITURE_BRANDING_IMAGE_URL);(!i||i!==r)&&(this.object.model.setValue(C.FURNITURE_BRANDING_IMAGE_URL,r),this.object.model.setValue(C.FURNITURE_BRANDING_IMAGE_STATUS,0),this.downloadBackground());const a=t.getValue(ai.CLICKURL_KEY);if(a){const d=this.object.model.getValue(C.FURNITURE_BRANDING_URL);(!d||d!==a)&&this.object.model&&this.object.model.setValue(C.FURNITURE_BRANDING_URL,a)}const l=parseInt(t.getValue(ai.OFFSETX_KEY)),c=parseInt(t.getValue(ai.OFFSETY_KEY)),u=parseInt(t.getValue(ai.OFFSETZ_KEY));isNaN(l)||this.object.model.setValue(C.FURNITURE_BRANDING_OFFSET_X,l),isNaN(c)||this.object.model.setValue(C.FURNITURE_BRANDING_OFFSET_Y,c),isNaN(u)||this.object.model.setValue(C.FURNITURE_BRANDING_OFFSET_Z,u);let h=ai.IMAGEURL_KEY+"="+(r!==null?r:"")+"	";this._hasClickUrl&&(h=h+(ai.CLICKURL_KEY+"="+(a!==null?a:"")+"	")),h=h+(ai.OFFSETX_KEY+"="+l+"	"),h=h+(ai.OFFSETY_KEY+"="+c+"	"),h=h+(ai.OFFSETZ_KEY+"="+u+"	"),this.object.model.setValue(Kt.INFOSTAND_EXTRA_PARAM,Kt.BRANDING_OPTIONS+h)}processAdUpdate(e){if(!(!e||!this.object))switch(e.type){case Ir.IMAGE_LOADED:this.object.model.setValue(C.FURNITURE_BRANDING_IMAGE_STATUS,1);break;case Ir.IMAGE_LOADING_FAILED:this.object.model.setValue(C.FURNITURE_BRANDING_IMAGE_STATUS,-1);break}}mouseEvent(e,t){!e||!t||e.type===ie.MOUSE_MOVE||e.type===ie.DOUBLE_CLICK||super.mouseEvent(e,t)}async downloadBackground(){const e=this.object&&this.object.model;if(!e)return;const t=e.getValue(C.FURNITURE_BRANDING_IMAGE_URL),s=e.getValue(C.FURNITURE_BRANDING_IMAGE_STATUS);if(!(!t||t===""||s===1))if(t.endsWith(".gif"))this.object.model.setValue(C.FURNITURE_BRANDING_IS_ANIMATED,!0),fetch(t).then(r=>r.arrayBuffer()).then(r=>sU(r)).then(r=>{const i=r.lsd.width,a=r.lsd.height,l=i*a,c=rU(r,!1),u=[],h=[];let d=new Uint8Array(l*4);for(let f=0;f<c.length;f++){f>0&&(d=d.slice(0));const E=c[f].pixels,m=c[f].colorTable,R=c[f].transparentIndex,I=c[f].dims;for(let A=0;A<I.height;A++)for(let N=0;N<I.width;N++){const L=E[A*I.width+N],M=(A+I.top)*i+(N+I.left);if(R!==L){const b=m[L];d[4*M]=b[0],d[4*M+1]=b[1],d[4*M+2]=b[2],d[4*M+3]=255}}const S=hd.fromBuffer(d,i,a);u.push(new ts(S)),h.push(c[f].delay)}pe.instance.roomEngine.roomContentLoader.createGifCollection(t,u,h),this.processUpdateMessage(new Ir(Ir.IMAGE_LOADED))}).catch(r=>{this.processUpdateMessage(new Ir(Ir.IMAGE_LOADING_FAILED))});else{const r=Fr();if(!r)return;if(!r.getTexture(t)){await r.downloadAsset(t)?this.processUpdateMessage(new Ir(Ir.IMAGE_LOADED)):this.processUpdateMessage(new Ir(Ir.IMAGE_LOADING_FAILED));return}this.processUpdateMessage(new Ir(Ir.IMAGE_LOADED))}}};Lo.STATE="state";Lo.IMAGEURL_KEY="imageUrl";Lo.CLICKURL_KEY="clickUrl";Lo.OFFSETX_KEY="offsetX";Lo.OFFSETY_KEY="offsetY";Lo.OFFSETZ_KEY="offsetZ";let hb=Lo;class WK extends hb{getAdClickUrl(e){return null}}class YK extends hb{constructor(){super(),this._hasClickUrl=!0}getAdClickUrl(e){return e.getValue(C.FURNITURE_BRANDING_URL)}handleAdClick(e,t,s){if(s.indexOf("http")===0){ra.openWebPage(s);return}this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Ut(Ut.ROOM_AD_FURNI_CLICK,this.object,"",s))}}class zK extends St{constructor(){super(),this._roomColorUpdated=!1}getEventTypes(){const e=[W.DIMMER,W.WIDGET_REMOVE_DIMMER,yc.DIMMER_STATE];return this.mergeTypes(super.getEventTypes(),e)}onDispose(){this._roomColorUpdated&&this.eventDispatcher&&this.object&&(this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&(this.eventDispatcher.dispatchEvent(new yc(this.object,0,1,1,16777215,255)),this.eventDispatcher.dispatchEvent(new W(W.WIDGET_REMOVE_DIMMER,this.object))),this._roomColorUpdated=!1),super.onDispose()}processUpdateMessage(e){if(e instanceof Pt){if(e.data){const t=e.data.getLegacyString();this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this.processDimmerData(t),super.processUpdateMessage(new Pt(this.getStateFromDimmerData(t),e.data))}return}super.processUpdateMessage(e)}getStateFromDimmerData(e){if(!e)return 0;const t=e.split(",");return t.length>=5?parseInt(t[0])-1:0}processDimmerData(e){if(!e)return;const t=e.split(",");if(t.length>=5){const s=this.getStateFromDimmerData(e),r=parseInt(t[1]),i=parseInt(t[2]),a=t[3];let l=parseInt(a.substr(1),16),c=parseInt(t[4]);s||(l=16777215,c=255),this.eventDispatcher&&this.object&&(this.eventDispatcher.dispatchEvent(new yc(this.object,s,r,i,l,c)),this._roomColorUpdated=!0)}}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.DIMMER,this.object))}update(e){super.update(e)}}const AE=class Ic extends St{constructor(){super(),this._score=0,this._scoreIncreaser=50,this._scoreTimer=0}processUpdateMessage(e){if(e instanceof Pt)return this.updateScore(e.state);super.processUpdateMessage(e)}updateScore(e){this._score=e;const t=this.object.getState(0);if(this._score!==t){let s=this._score-t;s<0&&(s=-s),s*Ic.UPDATE_INTERVAL>Ic.MAX_UPDATE_TIME?this._scoreIncreaser=Ic.MAX_UPDATE_TIME/s:this._scoreIncreaser=Ic.UPDATE_INTERVAL,this._scoreTimer=ve()}}update(e){super.update(e);const t=this.object.getState(0);if(t!==this._score&&e>=this._scoreTimer+this._scoreIncreaser){const s=e-this._scoreTimer;let r=s/this._scoreIncreaser,i=1;this._score<t&&(i=-1),r>i*(this._score-t)&&(r=i*(this._score-t)),this.object.setState(t+i*r,0),this._scoreTimer=e-(s-r*this._scoreIncreaser)}}};AE.UPDATE_INTERVAL=50;AE.MAX_UPDATE_TIME=3e3;let KK=AE;class XK extends St{processUpdateMessage(e){if(super.processUpdateMessage(e),this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1){const t=this.object.model.getValue(C.FURNITURE_EXTRAS),s=parseInt(t);this.object.model.setValue(Kt.INFOSTAND_EXTRA_PARAM,Kt.SONGDISK+s)}}}const Wd=class ma extends hs{constructor(){super(...arguments),this._state=-1,this._sampleId=-1,this._noPitch=!1,this._lastLocZ=0}getEventTypes(){const e=[is.ROOM_OBJECT_INITIALIZED,is.ROOM_OBJECT_DISPOSED,is.PLAY_SAMPLE,is.CHANGE_PITCH];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),e.logic&&e.logic.soundSample&&(this._sampleId=e.logic.soundSample.id,this._noPitch=e.logic.soundSample.noPitch),this.object.model.setValue(C.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED,1)}onDispose(){this._state!==ma.STATE_UNINITIALIZED&&this.eventDispatcher.dispatchEvent(new is(is.ROOM_OBJECT_DISPOSED,this.object,this._sampleId)),super.onDispose()}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof Pt&&this.updateSoundBlockMessage(e)}updateSoundBlockMessage(e){if(!e)return;const t=this.object&&this.object.model,s=this.object&&this.object.location;!t||!s||(this._state===ma.STATE_UNINITIALIZED&&t.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&(this._lastLocZ=s.z,this.eventDispatcher.dispatchEvent(new is(is.ROOM_OBJECT_INITIALIZED,this.object,this._sampleId,this.getPitchForHeight(s.z)))),this._state!==ma.STATE_UNINITIALIZED&&t.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&this._lastLocZ!==s.z&&(this._lastLocZ=s.z,this.eventDispatcher.dispatchEvent(new is(is.CHANGE_PITCH,this.object,this._sampleId,this.getPitchForHeight(s.z)))),this._state!==ma.STATE_UNINITIALIZED&&e.state!==this._state&&this.playSoundAt(s.z),this._state=e.state)}playSoundAt(e){if(!this.object)return;const t=this.getPitchForHeight(e);this.object.model.setValue(C.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED,t),this.eventDispatcher.dispatchEvent(new is(is.PLAY_SAMPLE,this.object,this._sampleId,t))}getPitchForHeight(e){if(this._noPitch)return 1;let t=e*2;return t>ma.HIGHEST_SEMITONE&&(t=Math.min(0,ma.LOWEST_SEMITONE+(t-ma.HIGHEST_SEMITONE-1))),Math.pow(2,t/12)}};Wd.HIGHEST_SEMITONE=12;Wd.LOWEST_SEMITONE=-12;Wd.STATE_UNINITIALIZED=-1;let qK=Wd;class QK extends hs{constructor(){super(...arguments),this._disposeEventsAllowed=!1,this._isInitialized=!1,this._currentState=-1}getEventTypes(){const e=[oe.SOUND_MACHINE_START,oe.SOUND_MACHINE_STOP,oe.SOUND_MACHINE_DISPOSE,oe.SOUND_MACHINE_INIT];return this.mergeTypes(super.getEventTypes(),e)}onDispose(){this.requestDispose(),super.onDispose()}processUpdateMessage(e){if(super.processUpdateMessage(e),this.object.model.getValue(C.FURNITURE_REAL_ROOM_OBJECT)===1&&(this._isInitialized||this.requestInit(),this.object.model.setValue(Kt.INFOSTAND_EXTRA_PARAM,Kt.JUKEBOX),e instanceof Pt)){const t=this.object.getState(0);t!==this._currentState&&(this._currentState=t,t===1?this.requestPlayList():t===0&&this.requestStopPlaying())}}requestInit(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new oe(oe.SOUND_MACHINE_INIT,this.object)),this._isInitialized=!0)}requestPlayList(){!this.object||!this.eventDispatcher||(this._disposeEventsAllowed=!0,this.eventDispatcher.dispatchEvent(new oe(oe.SOUND_MACHINE_START,this.object)))}requestStopPlaying(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.SOUND_MACHINE_STOP,this.object))}requestDispose(){!this._disposeEventsAllowed||!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.SOUND_MACHINE_DISPOSE,this.object))}}const db=class _b extends St{getEventTypes(){const e=[W.STICKIE,oe.STICKIE];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){super.initialize(e),this.updateColor(),this.object&&this.object.model.setValue(C.FURNITURE_IS_STICKIE,"")}processUpdateMessage(e){super.processUpdateMessage(e),e instanceof OE&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new W(W.STICKIE,this.object)),this.updateColor()}updateColor(){if(!this.object)return;const e=this.object.model.getValue(C.FURNITURE_DATA);let t=_b.STICKIE_COLORS.indexOf(e);t<0&&(t=3),this.object.model.setValue(C.FURNITURE_COLOR,t+1)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new oe(oe.STICKIE,this.object))}};db.STICKIE_COLORS=["9CCEFF","FF9CFF","9CFF9C","FFFF33"];let JK=db;class ZK extends St{getEventTypes(){const e=[W.TROPHY];return this.mergeTypes(super.getEventTypes(),e)}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.TROPHY,this.object))}}const NE=class Tc extends hs{constructor(){super(),this._total=0,this._lastUpdate=0,this._interval=33}processUpdateMessage(e){if(super.processUpdateMessage(e),e instanceof Pt){const t=e.data;if(!t)return;this.updateTotal(t.result)}}updateTotal(e){if(this._total=e,!this._lastUpdate){this.object.model.setValue(C.FURNITURE_VOTE_COUNTER_COUNT,e),this._lastUpdate=ve();return}if(this._total!==this.currentTotal){const t=Math.abs(this._total-this.currentTotal);t*Tc.UPDATE_INTERVAL>Tc.MAX_UPDATE_TIME?this._interval=Tc.MAX_UPDATE_TIME/t:this._interval=Tc.UPDATE_INTERVAL,this._lastUpdate=ve()}}update(e){if(super.update(e),this.object&&this.currentTotal!==this._total&&e>=this._lastUpdate+this._interval){const t=e-this._lastUpdate;let s=t/this._interval,r=1;this._total<this.currentTotal&&(r=-1),s>r*(this._total-this.currentTotal)&&(s=r*(this._total-this.currentTotal)),this.object.model.setValue(C.FURNITURE_VOTE_COUNTER_COUNT,this.currentTotal+r*s),this._lastUpdate=e-(t-s*this._interval)}}get currentTotal(){return this.object.model.getValue(C.FURNITURE_VOTE_COUNTER_COUNT)}};NE.UPDATE_INTERVAL=33;NE.MAX_UPDATE_TIME=1e3;let $K=NE;class e4 extends hs{processUpdateMessage(e){if(super.processUpdateMessage(e),!!this.object&&e instanceof Pt){const t=e.data;t instanceof fg&&this.object.model.setValue(C.FURNITURE_VOTE_MAJORITY_RESULT,t.result)}}}class t4 extends hs{mouseEvent(e,t){!e||!t||(e.type===ie.DOUBLE_CLICK&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new it(it.STATE_CHANGE,this.object)),super.mouseEvent(e,t))}}class s4 extends hs{initialize(e){super.initialize(e);let t="";e.logic&&e.logic.maskType&&e.logic.maskType!==""&&e.logic.maskType.length>0&&(t=e.logic.maskType),this.object.model.setValue(C.FURNITURE_USES_PLANE_MASK,1),this.object.model.setValue(C.FURNITURE_PLANE_MASK_TYPE,t)}}class r4 extends St{getEventTypes(){const e=[W.YOUTUBE,fi.RODRE_URL_PREFIX];return this.mergeTypes(super.getEventTypes(),e)}update(e){super.update(e),this.object.model.getValue(C.SESSION_URL_PREFIX)||this.eventDispatcher.dispatchEvent(new fi(fi.RODRE_URL_PREFIX,this.object))}useObject(){!this.object||!this.eventDispatcher||this.eventDispatcher.dispatchEvent(new W(W.YOUTUBE,this.object))}}class i4 extends El{constructor(){super(),this._selected=!1,this._reportedLocation=null,this._postureIndex=0,this._gestureIndex=0,this._headDirectionDelta=0,this._directions=[],this._talkingEndTimestamp=0,this._gestureEndTimestamp=0,this._expressionEndTimestamp=0}getEventTypes(){const e=[Me.CLICK,hr.POSITION_CHANGED];return this.mergeTypes(super.getEventTypes(),e)}initialize(e){if(!e)return;const t=this.object&&this.object.model;if(t){if(e.logic&&e.logic.model){const s=e.logic.model.directions;if(s&&s.length){for(const r of s)this._directions.push(r);this._directions.sort()}}t.setValue(C.PET_ALLOWED_DIRECTIONS,this._directions)}}dispose(){this._selected&&this.object&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new hr(hr.OBJECT_REMOVED,this.object)),this._directions=null,this._reportedLocation=null}update(e){if(super.update(e),this._selected&&this.object&&this.eventDispatcher){const t=this.object.getLocation();(!this._reportedLocation||this._reportedLocation.x!==t.x||this._reportedLocation.y!==t.y||this._reportedLocation.z!==t.z)&&(this._reportedLocation||(this._reportedLocation=new F),this._reportedLocation.assign(t),this.eventDispatcher.dispatchEvent(new hr(hr.POSITION_CHANGED,this.object)))}this.object&&this.object.model&&this.updateModel(e,this.object.model)}updateModel(e,t){this._gestureEndTimestamp>0&&e>this._gestureEndTimestamp&&(t.setValue(C.FIGURE_GESTURE,null),this._gestureEndTimestamp=0),this._talkingEndTimestamp>0&&e>this._talkingEndTimestamp&&(t.setValue(C.FIGURE_TALK,0),this._talkingEndTimestamp=0),this._expressionEndTimestamp>0&&e>this._expressionEndTimestamp&&(t.setValue(C.FIGURE_EXPRESSION,0),this._expressionEndTimestamp=0)}processUpdateMessage(e){if(!e||!this.object)return;super.processUpdateMessage(e);const t=this.object&&this.object.model;if(t){if(e instanceof Qh){t.setValue(C.HEAD_DIRECTION,e.headDirection);return}if(e instanceof Xh){const s=new gn(e.figure);t.setValue(C.FIGURE,e.figure),t.setValue(C.RACE,e.subType),t.setValue(C.PET_PALETTE_INDEX,s.paletteId),t.setValue(C.PET_COLOR,s.color),t.setValue(C.PET_TYPE,s.typeId),t.setValue(C.PET_CUSTOM_LAYER_IDS,s.customLayerIds),t.setValue(C.PET_CUSTOM_PARTS_IDS,s.customPartIds),t.setValue(C.PET_CUSTOM_PALETTE_IDS,s.customPaletteIds),t.setValue(C.PET_IS_RIDING,e.isRiding?1:0);return}if(e instanceof TE){t.setValue(C.FIGURE_POSTURE,e.postureType);return}if(e instanceof IE){t.setValue(C.FIGURE_TALK,1),this._talkingEndTimestamp=this.time+e.numberOfWords*1e3;return}if(e instanceof RE){t.setValue(C.FIGURE_SLEEP,e.isSleeping?1:0);return}if(e instanceof Xv){t.setValue(C.FIGURE_GESTURE,e.gesture),this._gestureEndTimestamp=this.time+3e3;return}if(e instanceof qh){this._selected=e.selected,this._reportedLocation=null;return}if(e instanceof Hv){t.setValue(C.FIGURE_EXPERIENCE_TIMESTAMP,this.time),t.setValue(C.FIGURE_GAINED_EXPERIENCE,e.gainedExperience);return}}}mouseEvent(e,t){let s=null;switch(e.type){case ie.MOUSE_CLICK:s=Me.CLICK;break;case ie.DOUBLE_CLICK:break;case ie.MOUSE_DOWN:{this.object.model.getValue(C.PET_TYPE)===be.MONSTERPLANT&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Me(Me.MOUSE_DOWN,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown));break}}s&&this.eventDispatcher&&this.eventDispatcher.dispatchEvent(new Me(s,this.object,e.eventId,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown))}}class gb{constructor(){this._width=0,this._height=0,this._wallHeight=0,this._fixedWallsHeight=0,this._tileMap=[],this._holeMap=[],this._doors=[],this._dimensions={minX:0,maxX:0,minY:0,maxY:0},this._restrictsDragging=!1,this._restrictedScale=1,this._restrictsScaling=!1}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get wallHeight(){return this._wallHeight}set wallHeight(e){this._wallHeight=e}get fixedWallsHeight(){return this._fixedWallsHeight}set fixedWallsHeight(e){this._fixedWallsHeight=e}get tileMap(){return this._tileMap}get holeMap(){return this._holeMap}get doors(){return this._doors}get dimensions(){return this._dimensions}get restrictsDragging(){return this._restrictsDragging}set restrictsDragging(e){this._restrictsDragging=e}get restrictsScaling(){return this._restrictsScaling}set restrictsScaling(e){this._restrictsScaling=e}get restrictedScale(){return this._restrictedScale}set restrictedScale(e){this._restrictedScale=e}}class Ao{constructor(e,t,s){this.type=e,this.loc=t,this.category=s}get loc(){return this._loc}set loc(e){this._loc||(this._loc=new F),this._loc.assign(e)}get type(){return this._type}set type(e){this._type=e}get category(){return this._category}set category(e){this._category=e}dispose(){this._loc=null}}Ao.WINDOW="window";Ao.HOLE="hole";class n4{constructor(){this._masks=[]}get masks(){return this._masks}}class fb{constructor(){this._masks=new Map}get maskCount(){return this._masks.size}dispose(){this._masks&&(this.reset(),this._masks=null)}initialize(e){if(!e)return!1;if(this._masks.clear(),e.masks.length)for(const t of e.masks){if(!t)continue;const s=t.locations.length?t.locations[0]:null;s&&this._masks.set(t.id,new Ao(t.type,s,t.category))}return!0}reset(){for(const e of this._masks.values())e&&e.dispose();this._masks.clear()}addMask(e,t,s,r){const i=new Ao(t,s,r);this._masks.delete(e),this._masks.set(e,i)}removeMask(e){const t=this._masks.get(e);return t?(this._masks.delete(e),t.dispose(),!0):!1}getXML(){const e=new n4;for(const[t,s]of this._masks.entries()){if(!s)continue;const r=this.getMaskType(s),i=this.getMaskCategory(s),a=this.getMaskLocation(s);if(r&&i&&a){const l={id:t,type:r,category:i,locations:[{x:a.x,y:a.y,z:a.z}]};e.masks.push(l)}}return e}getMaskLocation(e){return e?e.loc:null}getMaskType(e){return e?e.type:null}getMaskCategory(e){return e?e.category:null}get masks(){return this._masks}}class a4{constructor(e,t,s,r){this._leftSideLoc=0,this._rightSideLoc=0,this._leftSideLength=0,this._rightSideLength=0,this._leftSideLoc=e,this._rightSideLoc=t,this._leftSideLength=s,this._rightSideLength=r}get leftSideLoc(){return this._leftSideLoc}get rightSideLoc(){return this._rightSideLoc}get leftSideLength(){return this._leftSideLength}get rightSideLength(){return this._rightSideLength}}class Yt{constructor(e,t,s,r,i){this._type=0,this._loc=null,this._leftSide=null,this._rightSide=null,this._normal=null,this._normalDirection=null;let a,l,c,u,h,d,f,E;if(this._secondaryNormals=[],this._masks=[],this._loc=new F,this._loc.assign(t),this._leftSide=new F,this._leftSide.assign(s),this._rightSide=new F,this._rightSide.assign(r),this._type=e,s!=null&&r!=null&&(this._normal=F.crossProduct(s,r),a=0,l=0,c=0,u=0,h=0,this.normal.x!=0||this.normal.y!=0?(u=this.normal.x,h=this.normal.y,a=360+Math.atan2(h,u)/Math.PI*180,a>=360&&(a=a-360),u=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y),h=this.normal.z,l=360+Math.atan2(h,u)/Math.PI*180,l>=360&&(l=l-360)):this.normal.z<0?l=90:l=270,this._normalDirection=new F(a,l,c)),i!=null&&i.length>0)for(d=0;d<i.length;)f=i[d],f!=null&&f.length>0&&(E=new F,E.assign(f),E.multiply(1/E.length),this._secondaryNormals.push(E)),d++}get type(){return this._type}get loc(){return this._loc}get leftSide(){return this._leftSide}get rightSide(){return this._rightSide}get normal(){return this._normal}get normalDirection(){return this._normalDirection}get secondaryNormalCount(){return this._secondaryNormals.length}get maskCount(){return this._masks.length}getSecondaryNormal(e){if(e<0||e>=this.secondaryNormalCount)return null;const t=new F;return t.assign(this._secondaryNormals[e]),t}addMask(e,t,s,r){const i=new a4(e,t,s,r);this._masks.push(i)}getMask(e){return e<0||e>=this.maskCount?null:this._masks[e]}getMaskLeftSideLoc(e){const t=this.getMask(e);return t!=null?t.leftSideLoc:-1}getMaskRightSideLoc(e){const t=this.getMask(e);return t!=null?t.rightSideLoc:-1}getMaskLeftSideLength(e){const t=this.getMask(e);return t!=null?t.leftSideLength:-1}getMaskRightSideLength(e){const t=this.getMask(e);return t!=null?t.rightSideLength:-1}}Yt.PLANE_UNDEFINED=0;Yt.PLANE_FLOOR=1;Yt.PLANE_WALL=2;Yt.PLANE_LANDSCAPE=3;Yt.PLANE_BILLBOARD=4;class o4{constructor(e,t,s,r){this._x=e,this._y=t,this._width=s,this._height=r}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}}const yE=class Cf{constructor(){this._corners=[],this._endPoints=[],this._directions=[],this._lengths=[],this._leftTurns=[],this._borders=[],this._hideWalls=[],this._manuallyLeftCut=[],this._manuallyRightCut=[],this._addDuplicates=!1,this._count=0}addWall(e,t,s,r,i){(this._addDuplicates||this.checkIsNotDuplicate(e,t,s,r,i))&&(this._corners.push(e),this._directions.push(t),this._lengths.push(s),this._borders.push(r),this._leftTurns.push(i),this._hideWalls.push(!1),this._manuallyLeftCut.push(!1),this._manuallyRightCut.push(!1),this._count++)}checkIsNotDuplicate(e,t,s,r,i){let a=0;for(;a<this._count;){if(this._corners[a].x==e.x&&this._corners[a].y==e.y&&this._directions[a]==t&&this._lengths[a]==s&&this._borders[a]==r&&this._leftTurns[a]==i)return!1;a++}return!0}get count(){return this._count}getCorner(e){return this._corners[e]}getEndPoint(e){return this.calculateWallEndPoints(),this._endPoints[e]}getLength(e){return this._lengths[e]}getDirection(e){return this._directions[e]}getBorder(e){return this._borders[e]}getHideWall(e){return this._hideWalls[e]}getLeftTurn(e){return this._leftTurns[e]}getManuallyLeftCut(e){return this._manuallyLeftCut[e]}getManuallyRightCut(e){return this._manuallyRightCut[e]}setHideWall(e,t){this._hideWalls[e]=t}setLength(e,t){t<this._lengths[e]&&(this._lengths[e]=t,this._manuallyRightCut[e]=!0)}moveCorner(e,t){let s;if(t>0&&t<this._lengths[e]){const r=this._corners[e];s=Cf.WALL_DIRECTION_VECTORS[this.getDirection(e)],this._corners[e]=new Fe(r.x+t*s.x,r.y+t*s.y),this._lengths[e]=this._lengths[e]-t,this._manuallyLeftCut[e]=!0}}calculateWallEndPoints(){let e,t,s,r,i;if(this._endPoints.length!=this.count)for(this._endPoints=[],e=0;e<this.count;)t=this.getCorner(e),s=new Fe(t.x,t.y),r=Cf.WALL_DIRECTION_VECTORS[this.getDirection(e)],i=this.getLength(e),s.x=s.x+r.x*i,s.y=s.y+r.y*i,this._endPoints.push(s),e++}};yE.WALL_DIRECTION_VECTORS=[new F(1,0,0),new F(0,1,0),new F(-1,0,0),new F(0,-1,0)];yE.WALL_NORMAL_VECTORS=[new F(0,1,0),new F(-1,0,0),new F(0,-1,0),new F(1,0,0)];let da=yE;const zl=class Et{constructor(){this._width=0,this._height=0,this._minX=0,this._maxX=0,this._minY=0,this._maxY=0,this._fixedWallHeight=-1,this._floorHeight=0,this._restrictsScaling=!1,this._restrictedScale=1,this._tileMatrix=[],this._tileMatrixOriginal=[],this._planes=[],this._floorHoleMatrix=[],this._wallHeight=3.6,this._wallThicknessMultiplier=1,this._floorThicknessMultiplier=1,this._floorHoles=new Map}static getFloorHeight(e){const t=e.length;if(!t)return 0;let s=0,r=0;for(;r<t;){const i=e[r];let a=0;for(;a<i.length;){const l=i[a];l>s&&(s=l),a++}r++}return s}static findEntranceTile(e){if(!e)return null;const t=e.length;if(!t)return null;const s=[];let r=0;for(;r<t;){const i=e[r];if(!i||!i.length)return null;let a=0;for(;a<i.length;){if(i[a]>=0){s.push(a);break}a++}s.length<r+1&&s.push(i.length+1),r++}for(r=1;r<s.length-1;){if(Math.trunc(s[r])<=Math.trunc(s[r-1])-1&&Math.trunc(s[r])<=Math.trunc(s[r+1])-1)return new Fe(Math.trunc(s[r]|0),r);r++}return null}static expandFloorTiles(e){let t,s,r,i,a,l,c,u,h,d,f,E;const m=e.length,R=e[0].length,I=[];for(s=0;s<m*4;)I[s]=[],s++;let S=0;for(s=0;s<m;){for(a=0,t=0;t<R;){if(l=e[s][t],l<0||l<=255)for(i=0;i<4;){for(r=0;r<4;)I[S+i]===void 0&&(I[S+i]=[]),I[S+i][a+r]=l<0?l:l*4,r++;i++}else{for(c=(l&255)*4,u=c+(l>>11&1)*3,h=c+(l>>10&1)*3,d=c+(l>>9&1)*3,f=c+(l>>8&1)*3,r=0;r<3;)E=r+1,I[S][a+r]=(u*(3-r)+h*r)/3,I[S+3][a+E]=(d*(3-E)+f*E)/3,I[S+E][a]=(u*(3-E)+d*E)/3,I[S+r][a+3]=(h*(3-r)+f*r)/3,r++;I[S+1][a+1]=u>c?c+2:c+1,I[S+1][a+2]=h>c?c+2:c+1,I[S+2][a+1]=d>c?c+2:c+1,I[S+2][a+2]=f>c?c+2:c+1}a=a+4,t++}S=S+4,s++}return I}static addTileTypes(e){let t,s,r,i,a,l,c,u,h,d,f,E,m;const R=e.length-1,I=e[0].length-1;for(s=1;s<R;){for(t=1;t<I;)r=e[s][t],r<0||(i=e[s-1][t-1]&255,a=e[s-1][t]&255,l=e[s-1][t+1]&255,c=e[s][t-1]&255,u=e[s][t+1]&255,h=e[s+1][t-1]&255,d=e[s+1][t]&255,f=e[s+1][t+1]&255,E=r+1,m=(i==E||a==E||c==E?8:0)|(l==E||a==E||u==E?4:0)|(h==E||d==E||c==E?2:0)|(f==E||d==E||u==E?1:0),m==15&&(m=0),e[s][t]=r|m<<8),t++;s++}}static unpadHeightMap(e){e.shift(),e.pop();for(const t of e)t.shift(),t.pop()}static padHeightMap(e){const t=[],s=[];for(const r of e)r.push(Et.TILE_BLOCKED),r.unshift(Et.TILE_BLOCKED);for(const r of e[0])t.push(Et.TILE_BLOCKED),s.push(Et.TILE_BLOCKED);e.push(s),e.unshift(t)}get minX(){return this._minX}get maxX(){return this._maxX}get minY(){return this._minY}get maxY(){return this._maxY}get tileMapWidth(){return this._width}get tileMapHeight(){return this._height}get planeCount(){return this._planes.length}get floorHeight(){return this._fixedWallHeight!=-1?this._fixedWallHeight:this._floorHeight}get wallHeight(){return this._fixedWallHeight!=-1?this._fixedWallHeight+3.6:this._wallHeight}set wallHeight(e){e<0&&(e=0),this._wallHeight=e}get wallThicknessMultiplier(){return this._wallThicknessMultiplier}set wallThicknessMultiplier(e){e<0&&(e=0),this._wallThicknessMultiplier=e}get floorThicknessMultiplier(){return this._floorThicknessMultiplier}set floorThicknessMultiplier(e){e<0&&(e=0),this._floorThicknessMultiplier=e}dispose(){this._planes=null,this._tileMatrix=null,this._tileMatrixOriginal=null,this._floorHoleMatrix=null,this._floorHoles!=null&&(this._floorHoles.clear(),this._floorHoles=null)}reset(){this._planes=[],this._tileMatrix=[],this._tileMatrixOriginal=[],this._width=0,this._height=0,this._minX=0,this._maxX=0,this._minY=0,this._maxY=0,this._floorHeight=0,this._floorHoleMatrix=[]}initializeTileMap(e,t){e<0&&(e=0),t<0&&(t=0),this._tileMatrix=[],this._tileMatrixOriginal=[],this._floorHoleMatrix=[];let s=0;for(;s<t;){const r=[],i=[],a=[];let l=0;for(;l<e;)r[l]=Et.TILE_BLOCKED,i[l]=Et.TILE_BLOCKED,a[l]=!1,l++;this._tileMatrix.push(r),this._tileMatrixOriginal.push(i),this._floorHoleMatrix.push(a),s++}return this._width=e,this._height=t,this._minX=this._width,this._maxX=-1,this._minY=this._height,this._maxY=-1,!0}setTileHeight(e,t,s){let r,i,a,l,c;if(e>=0&&e<this._width&&t>=0&&t<this._height){if(r=this._tileMatrix[t],r[e]=s,s>=0)e<this._minX&&(this._minX=e),e>this._maxX&&(this._maxX=e),t<this._minY&&(this._minY=t),t>this._maxY&&(this._maxY=t);else{if(e==this._minX||e==this._maxX){for(i=!1,a=this._minY;a<this._maxY;){if(this.getTileHeightInternal(e,a)>=0){i=!0;break}a++}i||(e==this._minX&&this._minX++,e==this._maxX&&this._maxX--)}if(t==this._minY||t==this._maxY){for(l=!1,c=this._minX;c<this._maxX;){if(this.getTileHeight(c,t)>=0){l=!0;break}c++}l||(t==this._minY&&this._minY++,t==this._maxY&&this._maxY--)}}return!0}return!1}getTileHeight(e,t){if(e<0||e>=this._width||t<0||t>=this._height)return Et.TILE_BLOCKED;const s=this._tileMatrix[t];return s[e]===void 0?0:Math.abs(s[e])}getTileHeightOriginal(e,t){return e<0||e>=this._width||t<0||t>=this._height?Et.TILE_BLOCKED:this._floorHoleMatrix[t][e]?Et.TILE_HOLE:this._tileMatrixOriginal[t][e]}getTileHeightInternal(e,t){return e<0||e>=this._width||t<0||t>=this._height?Et.TILE_BLOCKED:this._tileMatrix[t][e]}initializeFromTileData(e=-1){let t,s;for(this._fixedWallHeight=e,s=0;s<this._height;){for(t=0;t<this._width;)this._tileMatrixOriginal[s]===void 0&&(this._tileMatrixOriginal[s]=[]),this._tileMatrixOriginal[s][t]=this._tileMatrix[s][t],t++;s++}const r=Et.findEntranceTile(this._tileMatrix);for(s=0;s<this._height;){for(t=0;t<this._width;)this._floorHoleMatrix[s]===void 0&&(this._floorHoleMatrix[s]=[]),this._floorHoleMatrix[s][t]&&this.setTileHeight(t,s,Et.TILE_HOLE),t++;s++}return this.initialize(r)}initialize(e){let t=0;e!=null&&(t=this.getTileHeight(e.x,e.y),this.setTileHeight(e.x,e.y,Et.TILE_BLOCKED)),this._floorHeight=Et.getFloorHeight(this._tileMatrix),this.createWallPlanes();const s=[];for(const i of this._tileMatrix)s.push(i.concat());Et.padHeightMap(s),Et.addTileTypes(s),Et.unpadHeightMap(s);const r=Et.expandFloorTiles(s);return this.extractPlanes(r),e!=null&&(this.setTileHeight(e.x,e.y,t),this.addFloor(new F(e.x+.5,e.y+.5,t),new F(-1,0,0),new F(0,-1,0),!1,!1,!1,!1)),!0}generateWallData(e,t){let s,r,i,a,l;const c=new da,u=[this.extractTopWall.bind(this),this.extractRightWall.bind(this),this.extractBottomWall.bind(this),this.extractLeftWall.bind(this)];let h=0,d=new Fe(e.x,e.y),f=0;for(;f++<1e3;){if(s=!1,r=!1,i=h,(d.x<this.minX||d.x>this.maxX||d.y<this.minY||d.y>this.maxY)&&(s=!0),a=u[h](d,t),a==null)return null;if(l=Math.abs(a.x-d.x)+Math.abs(a.y-d.y),d.x==a.x||d.y==a.y?(h=(h-1+u.length)%u.length,l=l+1,r=!0):(h=(h+1)%u.length,l--),c.addWall(d,i,l,s,r),a.x==e.x&&a.y==e.y&&(a.x!=d.x||a.y!=d.y))break;d=a}return c.count==0?null:c}hidePeninsulaWallChains(e){let t,s,r,i,a=0;const l=e.count;for(;a<l;){const c=a;for(t=a,s=0,r=!1;!e.getBorder(a)&&a<l;)e.getLeftTurn(a)?s++:s>0&&s--,s>1&&(r=!0),t=a,a++;if(r)for(i=c;i<=t;)e.setHideWall(i,!0),i++;a++}}updateWallsNextToHoles(e){let t,s,r,i,a,l,c;const u=e.count;let h=0;for(;h<u;){if(!e.getHideWall(h)){for(t=e.getCorner(h),s=e.getDirection(h),r=e.getLength(h),i=da.WALL_DIRECTION_VECTORS[s],a=da.WALL_NORMAL_VECTORS[s],l=0,c=0;c<r;){if(this.getTileHeightInternal(t.x+c*i.x-a.x,t.y+c*i.y-a.y)==Et.TILE_HOLE){if(c>0&&l==0){e.setLength(h,c);break}l++}else if(l>0){e.moveCorner(h,l);break}c++}l==r&&e.setHideWall(h,!0)}h++}}resolveOriginalWallIndex(e,t,s){let r,i,a,l,c,u;const h=Math.min(e.y,t.y),d=Math.max(e.y,t.y),f=Math.min(e.x,t.x),E=Math.max(e.x,t.x),m=s.count;let R=0;for(;R<m;){if(r=s.getCorner(R),i=s.getEndPoint(R),e.x==t.x){if(r.x==e.x&&i.x==e.x&&(a=Math.min(r.y,i.y),l=Math.max(r.y,i.y),a<=h&&d<=l))return R}else if(e.y==t.y&&r.y==e.y&&i.y==e.y&&(c=Math.min(r.x,i.x),u=Math.max(r.x,i.x),c<=f&&E<=u))return R;R++}return-1}hideOriginallyHiddenWalls(e,t){let s,r,i,a,l;const c=e.count;let u=0;for(;u<c;)e.getHideWall(u)||(s=e.getCorner(u),r=new Fe(s.x,s.y),i=da.WALL_DIRECTION_VECTORS[e.getDirection(u)],a=e.getLength(u),r.x=r.x+i.x*a,r.y=r.y+i.y*a,l=this.resolveOriginalWallIndex(s,r,t),l>=0?t.getHideWall(l)&&e.setHideWall(u,!0):e.setHideWall(u,!0)),u++}checkWallHiding(e,t){this.hidePeninsulaWallChains(t),this.updateWallsNextToHoles(e),this.hideOriginallyHiddenWalls(e,t)}addWalls(e,t){const s=e.count,r=t.count;let i=0;for(;i<s;){if(!e.getHideWall(i)){const a=e.getCorner(i),l=e.getDirection(i),c=e.getLength(i),u=da.WALL_DIRECTION_VECTORS[l],h=da.WALL_NORMAL_VECTORS[l];let d=-1,f=0;for(;f<c;){const G=this.getTileHeightInternal(a.x+f*u.x+h.x,a.y+f*u.y+h.y);G>=0&&(G<d||d<0)&&(d=G),f++}const E=d;let m=new F(a.x,a.y,E);m=F.sum(m,F.product(h,.5)),m=F.sum(m,F.product(u,-.5));const R=this.wallHeight+Math.min(Et.MAX_WALL_ADDITIONAL_HEIGHT,this.floorHeight)-d,I=F.product(u,-c),S=new F(0,0,R);m=F.dif(m,I);const A=this.resolveOriginalWallIndex(a,e.getEndPoint(i),t);let N=0,L=0;A>=0?(N=t.getDirection((A+1)%r),L=t.getDirection((A-1+r)%r)):(N=e.getDirection((i+1)%s),L=e.getDirection((i-1+s)%s));let M=null;(N-l+4)%4==3?M=da.WALL_NORMAL_VECTORS[N]:(l-L+4)%4==3&&(M=da.WALL_NORMAL_VECTORS[L]);const b=e.getLeftTurn(i),B=e.getLeftTurn((i-1+s)%s),w=e.getHideWall((i+1)%s),x=e.getManuallyLeftCut(i),U=e.getManuallyRightCut(i);this.addWall(m,I,S,M,!B||x,!b||U,!w)}i++}}createWallPlanes(){const e=this._tileMatrix;if(e==null)return!1;let t,s,r;const i=e.length;let a=0;if(i==0)return!1;for(t=0;t<i;){if(r=e[t],r==null||r.length==0)return!1;a>0?a=Math.min(a,r.length):a=r.length,t++}const l=Math.min(Et.MAX_WALL_ADDITIONAL_HEIGHT,this._fixedWallHeight!=-1?this._fixedWallHeight:Et.getFloorHeight(e)),c=this.minX;let u=this.minY;for(u=this.minY;u<=this.maxY;){if(this.getTileHeightInternal(c,u)>Et.TILE_HOLE){u--;break}u++}if(u>this.maxY)return!1;const h=new Fe(c,u),d=this.generateWallData(h,!0),f=this.generateWallData(h,!1);for(d!=null&&(d.count,f.count,this.checkWallHiding(d,f),this.addWalls(d,f)),s=0;s<this.tileMapHeight;){for(t=0;t<this.tileMapWidth;)this.getTileHeightInternal(t,s)<0&&this.setTileHeight(t,s,-(l+this.wallHeight)),t++;s++}return!0}extractTopWall(e,t){if(e==null)return null;let s=1,r=Et.TILE_HOLE;for(t||(r=Et.TILE_BLOCKED);s<1e3;){if(this.getTileHeightInternal(e.x+s,e.y)>r)return new Fe(e.x+s-1,e.y);if(this.getTileHeightInternal(e.x+s,e.y+1)<=r)return new Fe(e.x+s,e.y+1);s++}return null}extractRightWall(e,t){if(e==null)return null;let s=1,r=Et.TILE_HOLE;for(t||(r=Et.TILE_BLOCKED);s<1e3;){if(this.getTileHeightInternal(e.x,e.y+s)>r)return new Fe(e.x,e.y+(s-1));if(this.getTileHeightInternal(e.x-1,e.y+s)<=r)return new Fe(e.x-1,e.y+s);s++}return null}extractBottomWall(e,t){if(e==null)return null;let s=1,r=Et.TILE_HOLE;for(t||(r=Et.TILE_BLOCKED);s<1e3;){if(this.getTileHeightInternal(e.x-s,e.y)>r)return new Fe(e.x-(s-1),e.y);if(this.getTileHeightInternal(e.x-s,e.y-1)<=r)return new Fe(e.x-s,e.y-1);s++}return null}extractLeftWall(e,t){if(e==null)return null;let s=1,r=Et.TILE_HOLE;for(t||(r=Et.TILE_BLOCKED);s<1e3;){if(this.getTileHeightInternal(e.x,e.y-s)>r)return new Fe(e.x,e.y-(s-1));if(this.getTileHeightInternal(e.x+1,e.y-s)<=r)return new Fe(e.x+1,e.y-s);s++}return null}addWall(e,t,s,r,i,a,l){this.addPlane(Yt.PLANE_WALL,e,t,s,[r]),this.addPlane(Yt.PLANE_LANDSCAPE,e,t,s,[r]);const c=Et.WALL_THICKNESS*this._wallThicknessMultiplier,u=Et.FLOOR_THICKNESS*this._floorThicknessMultiplier,h=F.crossProduct(t,s),d=F.product(h,1/h.length*-c);if(this.addPlane(Yt.PLANE_WALL,F.sum(e,s),t,d,[h,r]),i&&this.addPlane(Yt.PLANE_WALL,F.sum(F.sum(e,t),s),F.product(s,-(s.length+u)/s.length),d,[h,r]),a&&(this.addPlane(Yt.PLANE_WALL,F.sum(e,F.product(s,-u/s.length)),F.product(s,(s.length+u)/s.length),d,[h,r]),l)){const f=F.product(t,c/t.length);this.addPlane(Yt.PLANE_WALL,F.sum(F.sum(e,s),F.product(f,-1)),f,d,[h,t,r])}}addFloor(e,t,s,r,i,a,l){let c,u,h;this.addPlane(Yt.PLANE_FLOOR,e,t,s)!=null&&(c=Et.FLOOR_THICKNESS*this._floorThicknessMultiplier,u=new F(0,0,c),h=F.dif(e,u),a&&this.addPlane(Yt.PLANE_FLOOR,h,t,u),l&&this.addPlane(Yt.PLANE_FLOOR,F.sum(h,F.sum(t,s)),F.product(t,-1),u),r&&this.addPlane(Yt.PLANE_FLOOR,F.sum(h,s),F.product(s,-1),u),i&&this.addPlane(Yt.PLANE_FLOOR,F.sum(h,t),s,u))}initializeFromMapData(e){if(!e)return!1;this.reset(),this.resetFloorHoles();const t=e.width,s=e.height,r=e.wallHeight,i=e.fixedWallsHeight;if(this.initializeTileMap(t,s),e.tileMap){let a=0;for(;a<e.tileMap.length;){const l=e.tileMap[a];if(l){let c=0;for(;c<l.length;){const u=l[c];u&&this.setTileHeight(c,a,u.height),c++}}a++}}if(e.holeMap&&e.holeMap.length){let a=0;for(;a<e.holeMap.length;){const l=e.holeMap[a];l&&(this.addFloorHole(l.id,l.x,l.y,l.width,l.height),a++)}this.initializeHoleMap()}return this.wallHeight=r,this.restrictsDragging=e.restrictsDragging,this.restrictsScaling=e.restrictsScaling,this.restrictedScale=e.restrictedScale,this.initializeFromTileData(i),!0}addPlane(e,t,s,r,i=null){if(s.length==0||r.length==0)return null;const a=new Yt(e,t,s,r,i);return this._planes.push(a),a}getMapData(){const e=new gb;e.width=this._width,e.height=this._height,e.wallHeight=this._wallHeight,e.fixedWallsHeight=this._fixedWallHeight,e.dimensions.minX=this.minX,e.dimensions.maxX=this.maxX,e.dimensions.minY=this.minY,e.dimensions.maxY=this.maxY,e.restrictsDragging=this.restrictsDragging,e.restrictsScaling=this.restrictsScaling,e.restrictedScale=this.restrictedScale;let t=0;for(;t<this._height;){const s=[],r=this._tileMatrixOriginal[t];let i=0;for(;i<this._width;){const a=r[i];s.push({height:a}),i++}e.tileMap.push(s),t++}for(const[s,r]of this._floorHoles.entries())r&&e.holeMap.push({id:s,x:r.x,y:r.y,width:r.width,height:r.height});return e}getPlaneLocation(e){if(e<0||e>=this.planeCount)return null;const t=this._planes[e];return t?t.loc:null}getPlaneNormal(e){if(e<0||e>=this.planeCount)return null;const t=this._planes[e];return t?t.normal:null}getPlaneLeftSide(e){if(e<0||e>=this.planeCount)return null;const t=this._planes[e];return t?t.leftSide:null}getPlaneRightSide(e){if(e<0||e>=this.planeCount)return null;const t=this._planes[e];return t?t.rightSide:null}getPlaneNormalDirection(e){if(e<0||e>=this.planeCount)return null;const t=this._planes[e];return t?t.normalDirection:null}getPlaneSecondaryNormals(e){let t,s;if(e<0||e>=this.planeCount)return null;const r=this._planes[e];if(r!=null){for(t=[],s=0;s<r.secondaryNormalCount;)t.push(r.getSecondaryNormal(s)),s++;return t}return null}getPlaneType(e){if(e<0||e>=this.planeCount)return Yt.PLANE_UNDEFINED;const t=this._planes[e];return t?t.type:Yt.PLANE_UNDEFINED}getPlaneMaskCount(e){if(e<0||e>=this.planeCount)return 0;const t=this._planes[e];return t?t.maskCount:0}getPlaneMaskLeftSideLoc(e,t){if(e<0||e>=this.planeCount)return-1;const s=this._planes[e];return s?s.getMaskLeftSideLoc(t):-1}getPlaneMaskRightSideLoc(e,t){if(e<0||e>=this.planeCount)return-1;const s=this._planes[e];return s?s.getMaskRightSideLoc(t):-1}getPlaneMaskLeftSideLength(e,t){if(e<0||e>=this.planeCount)return-1;const s=this._planes[e];return s?s.getMaskLeftSideLength(t):-1}getPlaneMaskRightSideLength(e,t){if(e<0||e>=this.planeCount)return-1;const s=this._planes[e];return s?s.getMaskRightSideLength(t):-1}addFloorHole(e,t,s,r,i){this.removeFloorHole(e),this._floorHoles.set(e,new o4(t,s,r,i))}removeFloorHole(e){this._floorHoles.delete(e)}resetFloorHoles(){this._floorHoles.clear()}initializeHoleMap(){let e,t,s,r,i,a,l,c;for(t=0;t<this._height;){for(s=this._floorHoleMatrix[t],e=0;e<this._width;)s[e]=!1,e++;t++}for(const u of this._floorHoles.values())if(r=u,r!=null)for(i=r.x,a=r.x+r.width-1,l=r.y,c=r.y+r.height-1,i=i<0?0:i,a=a>=this._width?this._width-1:a,l=l<0?0:l,c=c>=this._height?this._height-1:c,t=l;t<=c;){for(s=this._floorHoleMatrix[t],e=i;e<=a;)s[e]=!0,e++;t++}}extractPlanes(e){let t,s,r,i,a,l,c,u,h,d,f,E,m,R,I;const S=e.length,A=e[0].length,N=[];let L=0;for(;L<S;)N[L]=[],L++;let M=0;for(;M<S;){for(t=0;t<A;){if(s=e[M][t],!(s<0||N[M][t])){for(a=t==0||e[M][t-1]!=s,l=M==0||e[M-1][t]!=s,r=t+1;r<A&&!(e[M][r]!=s||N[M][r]||M>0&&e[M-1][r]==s==l);)r++;for(c=r==A||e[M][r]!=s,f=!1,i=M+1;i<S&&!f;){for(u=e[i][t]!=s,f=u||t>0&&e[i][t-1]==s==a||r<A&&e[i][r]==s==c,h=t;h<r;){if(e[i][h]==s==u){f=!0,r=h;break}h++}if(f)break;i++}for(u=u||i==S,c=r==A||e[M][r]!=s,d=M;d<i;){for(h=t;h<r;)N[d][h]=!0,h++;d++}E=t/4-.5,m=M/4-.5,R=(r-t)/4,I=(i-M)/4,this.addFloor(new F(E+R,m+I,s/4),new F(-R,0,0),new F(0,-I,0),c,a,u,l)}t++}M++}}get restrictsDragging(){return this._restrictsDragging}set restrictsDragging(e){this._restrictsDragging=e}get restrictsScaling(){return this._restrictsScaling}set restrictsScaling(e){this._restrictsScaling=e}get restrictedScale(){return this._restrictedScale}set restrictedScale(e){this._restrictedScale=e}};zl.FLOOR_THICKNESS=.25;zl.WALL_THICKNESS=.25;zl.MAX_WALL_ADDITIONAL_HEIGHT=20;zl.TILE_BLOCKED=-110;zl.TILE_HOLE=-100;let Hs=zl;class l4 extends Rd{constructor(){super(),this._planeParser=new Hs,this._planeBitmapMaskParser=new fb,this._color=16777215,this._light=255,this._originalColor=16777215,this._originalLight=255,this._targetColor=16777215,this._targetLight=255,this._colorChangedTime=0,this._colorTransitionLength=1500,this._lastHoleUpdate=0,this._needsMapUpdate=!1,this._skipColorTransition=!1}getEventTypes(){const e=[Me.MOUSE_MOVE,Me.CLICK];return this.mergeTypes(super.getEventTypes(),e)}dispose(){super.dispose(),this._planeParser&&(this._planeParser.dispose(),this._planeParser=null),this._planeBitmapMaskParser&&(this._planeBitmapMaskParser.dispose(),this._planeBitmapMaskParser=null)}initialize(e){!e||!this.object||e instanceof gb&&this._planeParser.initializeFromMapData(e)&&(this.object.model.setValue(C.ROOM_MAP_DATA,e),this.object.model.setValue(C.ROOM_BACKGROUND_COLOR,16777215),this.object.model.setValue(C.ROOM_FLOOR_VISIBILITY,1),this.object.model.setValue(C.ROOM_WALL_VISIBILITY,1),this.object.model.setValue(C.ROOM_LANDSCAPE_VISIBILITY,1),this._skipColorTransition=Ue.getValue("room.color.skip.transition")===!0)}update(e){if(super.update(e),this.updateBackgroundColor(e),this._needsMapUpdate){if(this._lastHoleUpdate&&e-this._lastHoleUpdate<5)return;const t=this.object&&this.object.model;if(t){const s=this._planeParser.getMapData();t.setValue(C.ROOM_MAP_DATA,s),t.setValue(C.ROOM_FLOOR_HOLE_UPDATE_TIME,e),this._planeParser.initializeFromMapData(s)}this._lastHoleUpdate=0,this._needsMapUpdate=!1}}updateBackgroundColor(e){if(!this.object||!this._colorChangedTime)return;let t=this._color,s=this._light;if(e-this._colorChangedTime>=this._colorTransitionLength)t=this._targetColor,s=this._targetLight,this._colorChangedTime=0;else{let i=this._originalColor>>16&255,a=this._originalColor>>8&255,l=this._originalColor&255;const c=this._targetColor>>16&255,u=this._targetColor>>8&255,h=this._targetColor&255,d=(e-this._colorChangedTime)/this._colorTransitionLength;i=i+(c-i)*d,a=a+(u-a)*d,l=l+(h-l)*d,t=(i<<16)+(a<<8)+l,s=this._originalLight+(this._targetLight-this._originalLight)*d,this._color=t,this._light=s}let r=sr.rgbToHSL(t);r=(r&16776960)+s,t=sr.hslToRGB(r),this.object.model&&this.object.model.setValue(C.ROOM_BACKGROUND_COLOR,t)}processUpdateMessage(e){if(!e||!this.object)return;const t=this.object.model;if(t){if(e instanceof ks){this.onObjectRoomUpdateMessage(e,t);return}if(e instanceof Vs){this.onObjectRoomMaskUpdateMessage(e,t);return}if(e instanceof qn){this.onObjectRoomPlaneVisibilityUpdateMessage(e,t);return}if(e instanceof Xn){this.onObjectRoomPlanePropertyUpdateMessage(e,t);return}if(e instanceof Kn){this.onObjectRoomFloorHoleUpdateMessage(e,t);return}if(e instanceof Jh){this.onObjectRoomColorUpdateMessage(e,t);return}e instanceof ib&&this.onObjectRoomMapUpdateMessage(e)}}onObjectRoomUpdateMessage(e,t){switch(e.type){case ks.ROOM_FLOOR_UPDATE:t.setValue(C.ROOM_FLOOR_TYPE,e.value);return;case ks.ROOM_WALL_UPDATE:t.setValue(C.ROOM_WALL_TYPE,e.value);return;case ks.ROOM_LANDSCAPE_UPDATE:t.setValue(C.ROOM_LANDSCAPE_TYPE,e.value);return}}onObjectRoomMaskUpdateMessage(e,t){let s=null,r=!1;switch(e.type){case Vs.ADD_MASK:s=Ao.WINDOW,e.maskCategory===Vs.HOLE&&(s=Ao.HOLE),this._planeBitmapMaskParser.addMask(e.maskId,e.maskType,e.maskLocation,s),r=!0;break;case Vs.REMOVE_MASK:r=this._planeBitmapMaskParser.removeMask(e.maskId);break}r&&t.setValue(C.ROOM_PLANE_MASK_XML,this._planeBitmapMaskParser.getXML())}onObjectRoomPlaneVisibilityUpdateMessage(e,t){let s=0;switch(e.visible&&(s=1),e.type){case qn.FLOOR_VISIBILITY:t.setValue(C.ROOM_FLOOR_VISIBILITY,s);return;case qn.WALL_VISIBILITY:t.setValue(C.ROOM_WALL_VISIBILITY,s),t.setValue(C.ROOM_LANDSCAPE_VISIBILITY,s);return}}onObjectRoomPlanePropertyUpdateMessage(e,t){switch(e.type){case Xn.FLOOR_THICKNESS:t.setValue(C.ROOM_FLOOR_THICKNESS,e.value);return;case Xn.WALL_THICKNESS:t.setValue(C.ROOM_WALL_THICKNESS,e.value);return}}onObjectRoomFloorHoleUpdateMessage(e,t){switch(e.type){case Kn.ADD:this._planeParser.addFloorHole(e.id,e.x,e.y,e.width,e.height),this._needsMapUpdate=!0;return;case Kn.REMOVE:this._planeParser.removeFloorHole(e.id),this._needsMapUpdate=!0;return}this._lastHoleUpdate=this.time}onObjectRoomColorUpdateMessage(e,t){!e||!t||(this._originalColor=this._color,this._originalLight=this._light,this._targetColor=e.color,this._targetLight=e.light,this._colorChangedTime=this.time,this._skipColorTransition?this._colorTransitionLength=0:this._colorTransitionLength=1500,t.setValue(C.ROOM_COLORIZE_BG_ONLY,e.backgroundOnly))}onObjectRoomMapUpdateMessage(e){!e||!e.mapData||(this.object.model.setValue(C.ROOM_MAP_DATA,e.mapData),this.object.model.setValue(C.ROOM_FLOOR_HOLE_UPDATE_TIME,this.time),this._planeParser.initializeFromMapData(e.mapData))}mouseEvent(e,t){if(!e||!t||!this.object||!this.object.model)return;const s=e.spriteTag;let r=0;if(s&&s.indexOf("@")>=0&&(r=parseInt(s.substr(s.indexOf("@")+1))),r<1||r>this._planeParser.planeCount){e.type===ie.ROLL_OUT&&this.object.model.setValue(C.ROOM_SELECTED_PLANE,0);return}r--;let i=null;const a=this._planeParser.getPlaneLocation(r),l=this._planeParser.getPlaneLeftSide(r),c=this._planeParser.getPlaneRightSide(r),u=this._planeParser.getPlaneNormalDirection(r),h=this._planeParser.getPlaneType(r);if(a==null||l==null||c==null||u==null)return;const d=l.length,f=c.length;if(d==0||f==0)return;const E=e.screenX,m=e.screenY,R=new Fe(E,m);if(i=t.getPlanePosition(R,a,l,c),!i){this.object.model.setValue(C.ROOM_SELECTED_PLANE,0);return}const I=F.product(l,i.x/d);I.add(F.product(c,i.y/f)),I.add(a);const S=I.x,A=I.y,N=I.z;if(i.x>=0&&i.x<d&&i.y>=0&&i.y<f)this.object.model.setValue(C.ROOM_SELECTED_X,S),this.object.model.setValue(C.ROOM_SELECTED_Y,A),this.object.model.setValue(C.ROOM_SELECTED_Z,N),this.object.model.setValue(C.ROOM_SELECTED_PLANE,r+1);else{this.object.model.setValue(C.ROOM_SELECTED_PLANE,0);return}let L=null;switch(e.type===ie.MOUSE_MOVE||e.type===ie.ROLL_OVER?L=Me.MOUSE_MOVE:e.type===ie.MOUSE_CLICK&&(L=Me.CLICK),e.type){case ie.MOUSE_MOVE:case ie.ROLL_OVER:case ie.MOUSE_CLICK:{let M=null;if(h===Yt.PLANE_FLOOR)M=new yn(L,this.object,e.eventId,S,A,N,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown);else if(h===Yt.PLANE_WALL||h===Yt.PLANE_LANDSCAPE){let b=90;u&&(b=u.x+90,b>360&&(b-=360));const B=l.length*i.x/d,w=c.length*i.y/f;M=new qo(L,this.object,e.eventId,a,l,c,B,w,b,e.altKey,e.ctrlKey,e.shiftKey,e.buttonDown)}this.eventDispatcher&&this.eventDispatcher.dispatchEvent(M);return}}}}class c4 extends Rd{initialize(e){this.object&&(this.object.model.setValue(C.FURNITURE_ALPHA_MULTIPLIER,1),this.object.setState(1,0))}processUpdateMessage(e){if(super.processUpdateMessage(e),e instanceof Qn&&this.object)switch(e.type){case Qn.ENABLED:this.object.setState(0,0);return;case Qn.DISABLED:this.object.setState(1,0);return}}}const Yd=class $o extends Rd{constructor(){super(),this._lastEventId=null,this._isHidden=!1}initialize(e){this.object&&(this.object.model.setValue(C.FURNITURE_ALPHA_MULTIPLIER,1),this.object.setState($o.CURSOR_HIDDEN_STATE,0))}processUpdateMessage(e){e instanceof Jo&&(this._lastEventId&&this._lastEventId===e.sourceEventId||(e.toggleVisibility&&(this._isHidden=!this._isHidden),super.processUpdateMessage(e),this.object&&(this._isHidden?this.object.setState($o.CURSOR_HIDDEN_STATE,0):e.visible?(this.object.model.setValue(C.TILE_CURSOR_HEIGHT,e.height),this.object.setState(e.height>.8?$o.CURSOR_HEIGHT_STATE:$o.CURSOR_VISIBLE_STATE)):this.object.setState($o.CURSOR_HIDDEN_STATE,0)),this._lastEventId=e.sourceEventId))}};Yd.CURSOR_VISIBLE_STATE=0;Yd.CURSOR_HIDDEN_STATE=1;Yd.CURSOR_HEIGHT_STATE=6;let u4=Yd;class mb{constructor(e,t,s){this._id=e,this._type=t,this._visualization=s}dispose(){this._visualization=null}update(e,t){}animate(e){return!1}get id(){return this._id}get type(){return this._type}get visualization(){return this._visualization}}const Kl=class Ea extends mb{constructor(e,t,s){super(e,t,s),this._asset=null,this._startTime=ve(),this._delta=0,this._offsetY=0,this._scale=0,this._state=0}update(e,t){if(!e)return;this._scale=t;let s=64,r=0;if(t<48?(this._asset=this.visualization.getAvatarRenderAsset("avatar_addition_user_blowkiss_small"),this.visualization.angle===90||this.visualization.angle===270?r=0:this.visualization.angle===135||this.visualization.angle===180||this.visualization.angle===225?r=6:r=-6,this._offsetY=-38,s=32):(this._asset=this.visualization.getAvatarRenderAsset("avatar_addition_user_blowkiss"),this.visualization.angle===90||this.visualization.angle===270?r=-3:this.visualization.angle===135||this.visualization.angle===180||this.visualization.angle===225?r=22:r=-30,this._offsetY=-70),this.visualization.posture===fe.POSTURE_SIT?this._offsetY+=s/2:this.visualization.posture===fe.POSTURE_LAY&&(this._offsetY+=s),this._asset){e.texture=this._asset,e.offsetX=r,e.offsetY=this._offsetY,e.relativeDepth=-.02,e.alpha=0;const i=this._delta;this.animate(e),this._delta=i}}animate(e){if(!e)return!1;if(this._asset&&(e.texture=this._asset),this._state===Ea.STATE_DELAY)return ve()-this._startTime<Ea.DELAY_BEFORE_ANIMATION?!1:(this._state=Ea.STATE_FADE_IN,e.alpha=0,e.visible=!0,this._delta=0,!0);if(this._state===Ea.STATE_FADE_IN)return this._delta+=.1,e.offsetY=this._offsetY,e.alpha=Math.pow(this._delta,.9)*255,this._delta>=1&&(e.alpha=255,this._delta=0,this._state=Ea.STATE_FLOAT),!0;if(this._state===Ea.STATE_FLOAT){const t=Math.pow(this._delta,.9);this._delta+=.05;const s=this._scale<48?-30:-40;return e.offsetY=this._offsetY+(this._delta<1?t:1)*s,e.alpha=(1-t)*255,e.alpha<=0&&(e.visible=!1,this._state=Ea.STATE_COMPLETE),!0}return!1}};Kl.DELAY_BEFORE_ANIMATION=300;Kl.STATE_DELAY=0;Kl.STATE_FADE_IN=1;Kl.STATE_FLOAT=2;Kl.STATE_COMPLETE=3;let h4=Kl;class Xl{static getExpressionAddition(e,t,s){switch(t){case this.BLOW:return new h4(e,this.BLOW,s);default:return new mb(e,t,s)}}}Xl.WAVE=1;Xl.BLOW=2;Xl.LAUGH=3;Xl.CRY=4;Xl.IDLE=5;const ql=class vi{constructor(e,t){this._id=e,this._visualization=t,this._asset=null,this._startTime=ve(),this._offsetY=0,this._scale=0,this._state=0}dispose(){this._visualization=null,this._asset=null}getSpriteAssetName(e){let t="left";return(this._visualization.angle===135||this._visualization.angle===180||this._visualization.angle===225||this._visualization.angle===270)&&(t="right"),"avatar_addition_user_idle_"+t+"_"+e+(this._scale<48?"_small":"")}update(e,t){if(!e)return;this._scale=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(this._state===vi.STATE_FRAME_A?1:2));let s=64,r=0;t<48?(this._visualization.angle===135||this._visualization.angle===180||this._visualization.angle===225||this._visualization.angle===270?r=10:r=-16,this._offsetY=-38,s=32):(this._visualization.angle===135||this._visualization.angle===180||this._visualization.angle===225||this._visualization.angle===270?r=22:r=-30,this._offsetY=-70),this._visualization.posture===fe.POSTURE_SIT?this._offsetY+=s/2:this._visualization.posture===fe.POSTURE_LAY&&(this._offsetY+=s-.3*s),this._asset&&(e.texture=this._asset,e.offsetX=r,e.offsetY=this._offsetY,e.relativeDepth=-.02,e.alpha=0)}animate(e){if(!e)return!1;const t=ve();return this._state===vi.STATE_DELAY&&t-this._startTime>=vi.DELAY_BEFORE_ANIMATION&&(this._state=vi.STATE_FRAME_A,this._startTime=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(1))),this._state===vi.STATE_FRAME_A&&t-this._startTime>=vi.DELAY_PER_FRAME&&(this._state=vi.STATE_FRAME_B,this._startTime=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(2))),this._state===vi.STATE_FRAME_B&&t-this._startTime>=vi.DELAY_PER_FRAME&&(this._state=vi.STATE_FRAME_A,this._startTime=t,this._asset=this._visualization.getAvatarRenderAsset(this.getSpriteAssetName(1))),this._asset?(e.texture=this._asset,e.alpha=255,e.visible=!0):e.visible=!1,!1}get id(){return this._id}};ql.DELAY_BEFORE_ANIMATION=2e3;ql.DELAY_PER_FRAME=2e3;ql.STATE_DELAY=0;ql.STATE_FRAME_A=1;ql.STATE_FRAME_B=2;let d4=ql;const uu=class Rc{constructor(e){this._id=e,this._asset=null,this._disposed=!1}dispose(){this._asset=null}update(e,t){if(e){if(!this._asset){const s=new es(ts.WHITE);s.alpha=0,s.width=Rc.WIDTH,s.height=Rc.HEIGHT,this._asset=ht.generateTexture(s)}e.visible=!0,e.texture=this._asset,e.offsetX=Rc.OFFSET_X,e.offsetY=Rc.OFFSET_Y,e.alphaTolerance=Ti.MATCH_ALL_PIXELS}}animate(e){return!1}get id(){return this._id}};uu.WIDTH=46;uu.HEIGHT=60;uu.OFFSET_X=-23;uu.OFFSET_Y=-48;let _4=uu;class g4{constructor(e,t,s){this._id=e,this._visualization=t,this._asset=null,this._relativeDepth=0,this._status=s}dispose(){this._visualization=null,this._asset=null}update(e,t){if(!e)return;e.visible=!0,e.relativeDepth=this._relativeDepth,e.alpha=255;let s=64,r=0,i=0;this._asset=this._visualization.getAvatarRenderAsset(this._status===Li.GUIDE?"avatar_addition_user_guide_bubble":"avatar_addition_user_guide_requester_bubble"),t<48?(r=-19,i=-80,s=32):(r=-19,i=-120),this._visualization.posture===fe.POSTURE_SIT?i+=s/2:this._visualization.posture===fe.POSTURE_LAY&&(i+=t),this._asset&&(e.texture=this._asset,e.offsetX=r,e.offsetY=i,e.relativeDepth=-.02+0)}animate(e){return this._asset&&e&&(e.texture=this._asset),!1}get id(){return this._id}get relativeDepth(){return this._relativeDepth}set relativeDepth(e){this._relativeDepth=e}}class f4{constructor(e,t){this._id=e,this._visualization=t,this._asset=null}dispose(){this._visualization=null,this._asset=null}update(e,t){if(!e)return;let s=64,r=0,i=0;t<48?(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_muted_small"),s=32,r=-12,i=-66):(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_muted"),r=-15,i=-110),this._visualization.posture===fe.POSTURE_SIT?i+=s/2:this._visualization.posture===fe.POSTURE_LAY&&(i+=t),this._asset?(e.visible=!0,e.texture=this._asset,e.offsetX=r,e.offsetY=i,e.relativeDepth=-.02):e.visible=!1}animate(e){return this._asset&&e&&(e.texture=this._asset),!1}get id(){return this._id}}class m4{constructor(e,t,s){this._id=e,this._visualization=s,this._asset=null,this._scale=0,this._number=t,this._numberValueFadeDirection=0,this._numberValueMoving=!1,this._numberValueMoveCounter=0}dispose(){this._visualization=null,this._asset=null}update(e,t){if(!e)return;this._scale=t;let s=64,r=0,i=0;this._number>0?(t<48?(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_number_"+this._number+"_small"),s=32,r=-6,i=-52):(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_number_"+this._number),r=-8,i=-105),this._visualization.posture===fe.POSTURE_SIT?i+=s/2:this._visualization.posture===fe.POSTURE_LAY&&(i+=t),this._asset?(e.visible=!0,e.texture=this._asset,e.offsetX=r,e.offsetY=i,e.relativeDepth=-.01,e.alpha=0,this._numberValueFadeDirection=1,this._numberValueMoving=!0,this._numberValueMoveCounter=0):e.visible=!1):e.visible&&(this._numberValueFadeDirection=-1)}animate(e){if(!e)return!1;this._asset&&(e.texture=this._asset);let t=e.alpha,s=!1;if(this._numberValueMoving){if(this._numberValueMoveCounter++,this._numberValueMoveCounter<10)return!1;if(this._numberValueFadeDirection<0)this._scale<48?e.offsetY-=2:e.offsetY-=4;else{let r=4;this._scale<48&&(r=8),this._numberValueMoveCounter%r||(e.offsetY--,s=!0)}}return this._numberValueFadeDirection>0?(t<255&&(t+=32),t>=255&&(t=255,this._numberValueFadeDirection=0),e.alpha=t,!0):this._numberValueFadeDirection<0?(t>=0&&(t-=32),t<=0&&(this._numberValueFadeDirection=0,this._numberValueMoving=!1,t=0,e.visible=!1),e.alpha=t,!0):s}get id(){return this._id}}class E4{constructor(e,t){this._id=e,this._visualization=t,this._asset=null,this._relativeDepth=0}dispose(){this._visualization=null,this._asset=null}update(e,t){if(!e)return;e.visible=!0,e.relativeDepth=this._relativeDepth,e.alpha=255;let s=64,r=0,i=0;t<48?(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_typing_small"),r=3,i=-42,s=32):(this._asset=this._visualization.getAvatarRenderAsset("avatar_addition_user_typing"),r=14,i=-83),this._visualization.posture===fe.POSTURE_SIT?i+=s/2:this._visualization.posture===fe.POSTURE_LAY&&(i+=t),this._asset&&(e.texture=this._asset,e.offsetX=r,e.offsetY=i,e.relativeDepth=-.02+0)}animate(e){return this._asset&&e&&(e.texture=this._asset),!1}get id(){return this._id}get relativeDepth(){return this._relativeDepth}set relativeDepth(e){this._relativeDepth=e}}class Zh extends Hr{constructor(){super()}initialize(e){return!0}onDispose(){this._avatarRenderer=null}createAvatarImage(e,t,s=null,r=null,i=null){let a=null;return t>48?a=this._avatarRenderer.createAvatarImage(e,Xr.LARGE,s,r,i):a=this._avatarRenderer.createAvatarImage(e,Xr.SMALL,s,r,i),a}getAvatarRendererAsset(e){return this._avatarRenderer?this._avatarRenderer.assets.getTexture(e):null}get avatarManager(){return this._avatarRenderer}set avatarManager(e){this._avatarRenderer=e}get layerCount(){return 0}}const ds=class xe extends Od{constructor(){super(),this._data=null,this._avatarImage=null,this._cachedAvatars=new Zt,this._cachedAvatarEffects=new Zt,this._shadow=null,this._lastUpdate=-1e3,this._disposed=!1,this._figure=null,this._gender=null,this._direction=-1,this._headDirection=-1,this._posture="",this._postureParameter="",this._canStandUp=!1,this._postureOffset=0,this._verticalOffset=0,this._angle=-1,this._headAngle=-1,this._talk=!1,this._expression=0,this._sleep=!1,this._blink=!1,this._gesture=0,this._sign=-1,this._highlightEnabled=!1,this._highlight=!1,this._dance=0,this._effect=0,this._carryObject=0,this._useObject=0,this._ownUser=!1,this._isLaying=!1,this._layInside=!1,this._isAnimating=!1,this._extraSpritesStartIndex=2,this._forcedAnimFrames=0,this._updatesUntilFrameUpdate=0,this._isAvatarReady=!1,this._needsUpdate=!1,this._geometryUpdateCounter=-1,this._additions=new Map}initialize(e){return e instanceof Zh?(this._data=e,this.createSprites(xe.INITIAL_RESERVED_SPRITES),super.initialize(e),!0):!1}dispose(){this._disposed||(super.dispose(),this._avatarImage&&this._avatarImage.dispose(),this._shadow=null,this._disposed=!0)}update(e,t,s,r){if(!this.object||!e||!this._data||t<this._lastUpdate+xe.UPDATE_TIME_INCREASER)return;this._lastUpdate+=xe.UPDATE_TIME_INCREASER,this._lastUpdate+xe.UPDATE_TIME_INCREASER<t&&(this._lastUpdate=t-xe.UPDATE_TIME_INCREASER);const i=this.object.model,a=e.scale,l=this._effect;let c=!1,u=!1,h=!1,d=!1;const f=this.updateModel(i,a);if(f||a!==this._scale||!this._avatarImage){if(a!==this._scale&&(c=!0,this.updateScale(a)),l!==this._effect&&(u=!0),c||!this._avatarImage||u){if(this._avatarImage=this.createAvatarImage(a,this._effect),!this._avatarImage)return;h=!0;const R=this.getSprite(xe.AVATAR_LAYER_ID);R&&this._avatarImage&&this._avatarImage.isPlaceholder()?R.alpha=150:R&&(R.alpha=255)}if(!this._avatarImage)return;if(u&&this._avatarImage.animationHasResetOnToggle&&this._avatarImage.resetAnimationFrameCounter(),this.updateShadow(a),d=this.updateObject(this.object,e,s,!0),this.processActionsForAvatar(this._avatarImage),this._additions){let R=this._extraSpritesStartIndex;for(const I of this._additions.values())I.update(this.getSprite(R++),a)}this._scale=a}else d=this.updateObject(this.object,e,s);if(this._additions){let R=this._extraSpritesStartIndex;for(const I of this._additions.values())I.animate(this.getSprite(R++))&&this.updateSpriteCounter++}const E=d||f||c,m=(this._isAnimating||this._forcedAnimFrames>0)&&s;if(E&&(this._forcedAnimFrames=xe.ANIMATION_FRAME_UPDATE_INTERVAL),E||m){if(this.updateSpriteCounter++,this._forcedAnimFrames--,this._updatesUntilFrameUpdate--,this._updatesUntilFrameUpdate<=0||c||f||h)this._avatarImage.updateAnimationByFrames(1),this._updatesUntilFrameUpdate=xe.ANIMATION_FRAME_UPDATE_INTERVAL;else return;let R=this._avatarImage.getCanvasOffsets();(!R||R.length<3)&&(R=xe.DEFAULT_CANVAS_OFFSETS);const I=this.getSprite(xe.SPRITE_INDEX_AVATAR);if(I){const L=this.object.model.getValue(C.FIGURE_HIGHLIGHT_ENABLE)===1&&this.object.model.getValue(C.FIGURE_HIGHLIGHT)===1,M=this._avatarImage.getImage(bs.FULL,L);M&&(I.texture=M,L||(I.filters=[])),I.texture&&(I.offsetX=-1*a/2+R[0]-(I.texture.width-a)/2,I.offsetY=-I.texture.height+a/4+R[1]+this._postureOffset),this._isLaying?this._layInside?I.relativeDepth=-.5:I.relativeDepth=xe.AVATAR_SPRITE_LAYING_DEPTH+R[2]:I.relativeDepth=xe.AVATAR_SPRITE_DEFAULT_DEPTH+R[2],this._ownUser?(I.relativeDepth-=xe.AVATAR_OWN_DEPTH_ADJUST,I.spriteType=Rr.AVATAR_OWN):I.spriteType=Rr.AVATAR}const S=this.getAddition(xe.TYPING_BUBBLE_ID);S&&(this._isLaying?S.relativeDepth=xe.AVATAR_SPRITE_LAYING_DEPTH-.01+R[2]:S.relativeDepth=xe.AVATAR_SPRITE_DEFAULT_DEPTH-.01+R[2]),this._isAnimating=this._avatarImage.isAnimating();let A=xe.INITIAL_RESERVED_SPRITES;const N=this._avatarImage.getDirection();for(const L of this._avatarImage.getSprites())if(L.id===xe.AVATAR){const M=this.getSprite(xe.SPRITE_INDEX_AVATAR);if(M){const b=this._avatarImage.getLayerData(L);let B=L.getDirectionOffsetX(N),w=L.getDirectionOffsetY(N);b&&(B+=b.dx,w+=b.dy),a<48&&(B/=2,w/=2),this._canStandUp||(M.offsetX+=B,M.offsetY+=w)}}else{const M=this.getSprite(A);if(M){M.alphaTolerance=Ti.MATCH_NOTHING,M.visible=!0;const b=this._avatarImage.getLayerData(L);let B=0,w=L.getDirectionOffsetX(N),x=L.getDirectionOffsetY(N);const U=L.getDirectionOffsetZ(N);let G=0;L.hasDirections&&(G=N),b&&(B=b.animationFrame,w+=b.dx,x+=b.dy,G+=b.dd),a<48&&(w/=2,x/=2),G<0?G+=8:G>7&&(G-=8);const K=this._avatarImage.getScale()+"_"+L.member+"_"+G+"_"+B,Y=this._avatarImage.getAsset(K);if(!Y)continue;M.texture=Y.texture,M.offsetX=Y.offsetX-a/2+w,M.offsetY=Y.offsetY+x,M.flipH=Y.flipH,L.hasStaticY?M.offsetY+=this._verticalOffset*a/(2*xe.BASE_Y_SCALE):M.offsetY+=this._postureOffset,this._isLaying?M.relativeDepth=xe.AVATAR_SPRITE_LAYING_DEPTH-.001*this.totalSprites*U:M.relativeDepth=xe.AVATAR_SPRITE_DEFAULT_DEPTH-.001*this.totalSprites*U,L.ink===33?M.blendMode=jn.ADD:M.blendMode=jn.NORMAL}A++}}}createAvatarImage(e,t){let s=null,r="avatarImage"+e.toString();if(t?(r+="-"+t,s=this._cachedAvatarEffects.getValue(r)):s=this._cachedAvatars.getValue(r),!s&&(s=this._data.createAvatarImage(this._figure,e,this._gender,this,this),s))if(!t)this._cachedAvatars.add(r,s);else{if(this._cachedAvatarEffects.length>=xe.MAX_EFFECT_CACHE){const i=this._cachedAvatarEffects.remove(this._cachedAvatarEffects.getKey(0));i&&i.dispose()}this._cachedAvatarEffects.add(r,s)}return s}updateObject(e,t,s,r=!1){if(!r&&this.updateObjectCounter===e.updateCounter&&this._geometryUpdateCounter===t.updateId)return!1;let i=e.getDirection().x-t.direction.x,a=this._headDirection-t.direction.x;return this._posture==="float"&&(a=i),i=(i%360+360)%360,a=(a%360+360)%360,this._posture==="sit"&&this._canStandUp&&(i-=i%90-45,a-=a%90-45),(i!==this._angle||r)&&(s=!0,this._angle=i,i=i-(135-22.5),i=(i+360)%360,this._avatarImage.setDirectionAngle(bs.FULL,i)),(a!==this._headAngle||r)&&(s=!0,this._headAngle=a,this._headAngle!==this._angle&&(a=a-(135-22.5),a=(a+360)%360,this._avatarImage.setDirectionAngle(bs.HEAD,a))),this._geometryUpdateCounter=t.updateId,this.updateObjectCounter=this.object.updateCounter,s}updateModel(e,t){if(!e||this.updateModelCounter===e.updateCounter)return!1;let s=!1;const r=e.getValue(C.FIGURE_TALK)>0;r!==this._talk&&(this._talk=r,s=!0);const i=e.getValue(C.FIGURE_EXPRESSION);i!==this._expression&&(this._expression=i,s=!0);const a=e.getValue(C.FIGURE_SLEEP)>0;a!==this._sleep&&(this._sleep=a,s=!0);const l=e.getValue(C.FIGURE_BLINK)>0;l!==this._blink&&(this._blink=l,s=!0);const c=e.getValue(C.FIGURE_GESTURE)||0;c!==this._gesture&&(this._gesture=c,s=!0);const u=e.getValue(C.FIGURE_POSTURE);u!==this._posture&&(this._posture=u,s=!0);const h=e.getValue(C.FIGURE_POSTURE_PARAMETER);h!==this._postureParameter&&(this._postureParameter=h,s=!0);const d=e.getValue(C.FIGURE_CAN_STAND_UP);d!==this._canStandUp&&(this._canStandUp=d,s=!0);const f=e.getValue(C.FIGURE_VERTICAL_OFFSET)*xe.BASE_Y_SCALE;f!==this._verticalOffset&&(this._verticalOffset=f,s=!0);const E=e.getValue(C.FIGURE_DANCE)||0;E!==this._dance&&(this._dance=E,s=!0);const m=e.getValue(C.FIGURE_EFFECT)||0;m!==this._effect&&(this._effect=m,s=!0);const R=e.getValue(C.FIGURE_CARRY_OBJECT)||0;R!==this._carryObject&&(this._carryObject=R,s=!0);const I=e.getValue(C.FIGURE_USE_OBJECT)||0;I!==this._useObject&&(this._useObject=I,s=!0);const S=e.getValue(C.HEAD_DIRECTION);S!==this._headDirection&&(this._headDirection=S,s=!0),this._carryObject>0&&I>0?this._useObject!==this._carryObject&&(this._useObject=this._carryObject,s=!0):this._useObject!==0&&(this._useObject=0,s=!0);let A=this.getAddition(xe.FLOATING_IDLE_Z_ID);this._sleep?(A||(A=this.addAddition(new d4(xe.FLOATING_IDLE_Z_ID,this))),s=!0):A&&this.removeAddition(xe.FLOATING_IDLE_Z_ID);const N=e.getValue(C.FIGURE_IS_MUTED)>0;let L=this.getAddition(xe.MUTED_BUBBLE_ID);if(N)L||(L=this.addAddition(new f4(xe.MUTED_BUBBLE_ID,this))),s=!0;else{L&&(this.removeAddition(xe.MUTED_BUBBLE_ID),s=!0);const ne=e.getValue(C.FIGURE_IS_TYPING)>0;let J=this.getAddition(xe.TYPING_BUBBLE_ID);ne?(J||(J=this.addAddition(new E4(xe.TYPING_BUBBLE_ID,this))),s=!0):J&&(this.removeAddition(xe.TYPING_BUBBLE_ID),s=!0)}const M=e.getValue(C.FIGURE_GUIDE_STATUS)||0;M!==Li.NONE?(this.removeAddition(xe.GUIDE_BUBBLE_ID),this.addAddition(new g4(xe.GUIDE_BUBBLE_ID,this,M)),s=!0):this.getAddition(xe.GUIDE_BUBBLE_ID)&&(this.removeAddition(xe.GUIDE_BUBBLE_ID),s=!0);const b=e.getValue(C.FIGURE_IS_PLAYING_GAME)>0;let B=this.getAddition(xe.GAME_CLICK_TARGET_ID);b?(B||(B=this.addAddition(new _4(xe.GAME_CLICK_TARGET_ID))),s=!0):B&&this.removeAddition(xe.GAME_CLICK_TARGET_ID);const w=e.getValue(C.FIGURE_NUMBER_VALUE);let x=this.getAddition(xe.NUMBER_BUBBLE_ID);w>0?(x||(x=this.addAddition(new m4(xe.NUMBER_BUBBLE_ID,w,this))),s=!0):x&&this.removeAddition(xe.NUMBER_BUBBLE_ID);let U=this.getAddition(xe.EXPRESSION_ID);this._expression>0?U||(U=Xl.getExpressionAddition(xe.EXPRESSION_ID,this._expression,this),U&&this.addAddition(U)):U&&this.removeAddition(xe.EXPRESSION_ID),this.updateScale(t);const G=e.getValue(C.GENDER);G!==this._gender&&(this._gender=G,s=!0),this.updateFigure(e.getValue(C.FIGURE))&&(s=!0);let K=e.getValue(C.FIGURE_SIGN);K===null&&(K=-1),this._sign!==K&&(this._sign=K,s=!0);const Y=e.getValue(C.FIGURE_HIGHLIGHT_ENABLE)>0;if(Y!==this._highlightEnabled&&(this._highlightEnabled=Y,s=!0),this._highlightEnabled){const ne=e.getValue(C.FIGURE_HIGHLIGHT)>0;ne!==this._highlight&&(this._highlight=ne,s=!0)}const te=e.getValue(C.OWN_USER)>0;return te!==this._ownUser&&(this._ownUser=te,s=!0),this.updateModelCounter=e.updateCounter,s}setDirection(e){this._direction!==e&&(this._direction=e,this._needsUpdate=!0)}updateScale(e){e<48&&(this._blink=!1),this._posture==="sit"||this._posture==="lay"?this._postureOffset=e/2:this._postureOffset=0,this._layInside=!1,this._isLaying=!1,this._posture==="lay"&&(this._isLaying=!0,parseInt(this._postureParameter)<0&&(this._layInside=!0))}processActionsForAvatar(e){if(!e)return;if(e.initActionAppends(),e.appendAction(fe.POSTURE,this._posture,this._postureParameter),this._gesture>0&&this._avatarImage.appendAction(fe.GESTURE,fe.getGesture(this._gesture)),this._dance>0&&this._avatarImage.appendAction(fe.DANCE,this._dance),this._sign>-1&&this._avatarImage.appendAction(fe.SIGN,this._sign),this._carryObject>0&&this._avatarImage.appendAction(fe.CARRY_OBJECT,this._carryObject),this._useObject>0&&this._avatarImage.appendAction(fe.USE_OBJECT,this._useObject),this._talk&&this._avatarImage.appendAction(fe.TALK),(this._sleep||this._blink)&&this._avatarImage.appendAction(fe.SLEEP),this._expression>0){const s=fe.getExpression(this._expression);if(s!=="")switch(s){case fe.DANCE:this._avatarImage.appendAction(fe.DANCE,2);break;default:this._avatarImage.appendAction(s);break}}this._effect>0&&this._avatarImage.appendAction(fe.EFFECT,this._effect),e.endActionAppends(),this._isAnimating=e.isAnimating();let t=xe.INITIAL_RESERVED_SPRITES;for(const s of this._avatarImage.getSprites())s.id!==xe.AVATAR&&t++;if(t!==this.totalSprites&&this.createSprites(t),this._extraSpritesStartIndex=t,this._additions)for(const s of this._additions.values())this.createSprite()}updateFigure(e){return this._figure===e?!1:(this._figure=e,this.clearAvatar(),!0)}resetFigure(e){this.clearAvatar()}resetEffect(e){this.clearAvatar()}clearAvatar(){for(const t of this._cachedAvatars.getValues())t&&t.dispose();for(const t of this._cachedAvatarEffects.getValues())t&&t.dispose();this._cachedAvatars.reset(),this._cachedAvatarEffects.reset(),this._avatarImage=null;const e=this.getSprite(xe.AVATAR_LAYER_ID);e&&(e.texture=ts.EMPTY,e.alpha=255)}getAddition(e){if(!this._additions)return null;const t=this._additions.get(e);return t||null}addAddition(e){if(!this.getAddition(e.id))return this._additions.set(e.id,e),e}removeAddition(e){const t=this.getAddition(e);t&&(this._additions.delete(t.id),t.dispose())}updateShadow(e){this._shadow=null;const t=this.getSprite(xe.SHADOW_LAYER_ID);if(!t)return;let s=this._posture==="mv"||this._posture==="std"||this._posture==="sit"&&this._canStandUp;if(this._effect===xe.SNOWBOARDING_EFFECT&&(s=!1),s){if(t.visible=!0,!this._shadow||e!==this._scale){let r=0,i=0;e<48?(t.libraryAssetName="sh_std_sd_1_0_0",this._shadow=this._avatarImage.getAsset(t.libraryAssetName),r=-8,i=this._canStandUp?6:-3):(t.libraryAssetName="h_std_sd_1_0_0",this._shadow=this._avatarImage.getAsset(t.libraryAssetName),r=-17,i=this._canStandUp?10:-7),this._shadow?(t.texture=this._shadow.texture,t.offsetX=r,t.offsetY=i,t.alpha=50,t.relativeDepth=1):t.visible=!1}}else this._shadow=null,t.visible=!1}getAvatarRenderAsset(e){return this._data?this._data.getAvatarRendererAsset(e):null}get direction(){return this._direction}get posture(){return this._posture}get angle(){return this._angle}get disposed(){return this._disposed}};ds.AVATAR="avatar";ds.FLOATING_IDLE_Z_ID=1;ds.TYPING_BUBBLE_ID=2;ds.EXPRESSION_ID=3;ds.NUMBER_BUBBLE_ID=4;ds.GAME_CLICK_TARGET_ID=5;ds.MUTED_BUBBLE_ID=6;ds.GUIDE_BUBBLE_ID=7;ds.OWN_USER_ID=4;ds.UPDATE_TIME_INCREASER=41;ds.AVATAR_LAYER_ID=0;ds.SHADOW_LAYER_ID=1;ds.SNOWBOARDING_EFFECT=97;ds.INITIAL_RESERVED_SPRITES=2;ds.ANIMATION_FRAME_UPDATE_INTERVAL=2;ds.DEFAULT_CANVAS_OFFSETS=[0,0,0];ds.MAX_EFFECT_CACHE=2;ds.SPRITE_INDEX_AVATAR=0;ds.BASE_Y_SCALE=1e3;ds.AVATAR_SPRITE_DEFAULT_DEPTH=-.01;ds.AVATAR_OWN_DEPTH_ADJUST=.001;ds.AVATAR_SPRITE_LAYING_DEPTH=-.409;let p4=ds;const hu=class bn{static allocate(e,t,s,r,i,a,l=-1,c=0){const u=bn.POOL.length?bn.POOL.pop():new bn;return r<1&&(r=1),i<0&&(i=bn.FRAME_REPEAT_FOREVER),u._id=e,u._x=t||0,u._y=s||0,u._repeats=r,u._frameRepeats=i,u._remainingFrameRepeats=i,u._isLastFrame=a,u._isRecycled=!1,l>=0?(u._activeSequence=l,u._activeSequenceOffset=c):(u._activeSequence=-1,u._activeSequenceOffset=0),u}get id(){return this._id>=0?this._id:-this._id*Math.random()}get x(){return this._x}get y(){return this._y}get repeats(){return this._repeats}get frameRepeats(){return this._frameRepeats}get isLastFrame(){return this._isLastFrame}get remainingFrameRepeats(){return this._frameRepeats<0?bn.FRAME_REPEAT_FOREVER:this._remainingFrameRepeats}set remainingFrameRepeats(e){e<0&&(e=0),this._frameRepeats>0&&e>this._frameRepeats&&(e=this._frameRepeats),this._remainingFrameRepeats=e}get activeSequence(){return this._activeSequence}get activeSequenceOffset(){return this._activeSequenceOffset}recycle(){this._isRecycled||(this._isRecycled=!0,bn.POOL.length<bn.POOL_SIZE_LIMIT&&bn.POOL.push(this))}};hu.FRAME_REPEAT_FOREVER=-1;hu.SEQUENCE_NOT_DEFINED=-1;hu.POOL_SIZE_LIMIT=3e3;hu.POOL=[];let pl=hu;class Eb{constructor(e,t,s,r,i,a){this._id=0,this._x=0,this._y=0,this._randomX=0,this._randomY=0,this._repeats=1,this._id=e,this._x=t,this._y=s,this._randomX=r,this._randomY=i,this._repeats=a}get id(){return this._id}hasDirectionalOffsets(){return!1}getX(e){return this._x}getY(e){return this._y}get x(){return this._x}get y(){return this._x}get randomX(){return this._randomX}get randomY(){return this._randomY}get repeats(){return this._repeats}}class I4 extends Eb{constructor(e,t,s,r,i,a,l){super(e,t,s,r,i,l),this._directionalOffsets=a}hasDirectionalOffsets(){return this._directionalOffsets!==null}getX(e){return this._directionalOffsets?this._directionalOffsets.getXOffset(e,super.getX(e)):super.getX(e)}getY(e){return this._directionalOffsets?this._directionalOffsets.getYOffset(e,super.getY(e)):super.getY(e)}}class T4{constructor(e,t){this._frames=[],this._frameIndexes=[],this._frameRepeats=[],this._isRandom=t,this._loopCount=e<1?1:e}get isRandom(){return this._isRandom}get frameCount(){return this._frameIndexes.length*this._loopCount}dispose(){this._frames=[]}initialize(){let e=this._frameIndexes.length-1,t=-1,s=1;for(;e>=0;)this._frameIndexes[e]===t?s++:(t=this._frameIndexes[e],s=1),this._frameRepeats[e]=s,e--}addFrame(e,t,s,r,i,a){let l=1;if(this._frames.length>0){const u=this._frames[this._frames.length-1];u.id===e&&!u.hasDirectionalOffsets()&&u.x===t&&u.y===s&&u.randomX===r&&r===0&&u.randomY===i&&i===0&&(l+=u.repeats,this._frames.pop())}const c=a?new I4(e,t,s,r,i,a,l):new Eb(e,t,s,r,i,l);this._frames.push(c),this._frameIndexes.push(this._frames.length-1),this._frameRepeats.push(1)}getFrame(e){return!this._frames.length||e<0||e>=this.frameCount?null:this._frames[this._frameIndexes[e%this._frameIndexes.length]]}getFrameIndex(e){return e<0||e>=this.frameCount?-1:(this._isRandom&&(e=Math.round(Math.random()*this._frameIndexes.length),e===this._frameIndexes.length&&e--),e)}getRepeats(e){return e<0||e>=this.frameCount?0:this._frameRepeats[e%this._frameRepeats.length]}}class R4{constructor(e,t,s){this._frameSequences=[],this._frameCount=-1,this._loopCount=e<0?0:e,this._frameRepeat=t<1?1:t,this._isRandom=s}get frameCount(){return this._frameCount<0&&this.calculateLength(),this._frameCount}dispose(){if(!(!this._frameSequences||!this._frameSequences.length)){for(const e of this._frameSequences)e&&e.dispose();this._frameSequences=[]}}addFrameSequence(e,t){const s=new T4(e,t);return this._frameSequences.push(s),s}calculateLength(){this._frameCount=0;for(const e of this._frameSequences)e&&(this._frameCount+=e.frameCount)}getFrame(e,t){if(this._frameCount<1)return null;if(t=t/this._frameRepeat,!this._isRandom){const i=Math.floor(t/this._frameCount);t=Math.floor(t%this._frameCount);let a=!1,l=null;(this._loopCount>0&&i>=this._loopCount||this._loopCount<=0&&this._frameCount===1)&&(t=this._frameCount-1,a=!0);let c=0,u=0;for(;u<this._frameSequences.length;){if(l=this._frameSequences[u],l){if(t<c+l.frameCount)break;c+=l.frameCount}u++}return this.getFrameFromSpecificSequence(e,l,u,t-c,a)}const s=Math.trunc(this._frameSequences.length*Math.random()),r=this._frameSequences[s];return r.frameCount<1?null:this.getFrameFromSpecificSequence(e,r,s,0,!1)}getFrameFromSequence(e,t,s,r){if(t<0||t>=this._frameSequences.length)return null;const i=this._frameSequences[t];return i?s>=i.frameCount?this.getFrame(e,r):this.getFrameFromSpecificSequence(e,i,t,s,!1):null}getFrameFromSpecificSequence(e,t,s,r,i){if(!t)return null;const a=t.getFrameIndex(r),l=t.getFrame(a);if(!l)return null;let c=l.getX(e),u=l.getY(e);const h=l.randomX,d=l.randomY;let f=l.repeats,E=!1;h&&(c=Math.trunc(c+h*Math.random())),d&&(u=Math.trunc(u+d*Math.random())),f>1&&(f=t.getRepeats(a));let m=this._frameRepeat*f;return i&&(m=pl.FRAME_REPEAT_FOREVER),!this._isRandom&&!t.isRandom&&s===this._frameSequences.length-1&&r===t.frameCount-1&&(E=!0),pl.allocate(l.id,c,u,f,m,E,s,r)}}class pb{constructor(){this._offsetX=new Map,this._offsetY=new Map}getXOffset(e,t){const s=this._offsetX.get(e);return s??t}getYOffset(e,t){const s=this._offsetY.get(e);return s??t}setDirection(e,t,s){this._offsetX.set(e,t),this._offsetY.set(e,s)}}const zd=class el{constructor(){this._layers=new Map,this._frameCount=-1,this._randomStart=!1,this._immediateChanges=null}static getTransitionToAnimationId(e){return el.TRANSITION_TO_ANIMATION_OFFSET+e}static getTransitionFromAnimationId(e){return el.TRANSITION_FROM_ANIMATION_OFFSET+e}static isTransitionToAnimation(e){return e>=el.TRANSITION_TO_ANIMATION_OFFSET&&e<el.TRANSITION_FROM_ANIMATION_OFFSET}static isTransitionFromAnimation(e){return e>=el.TRANSITION_FROM_ANIMATION_OFFSET}dispose(){for(const e of this._layers.values())e&&e.dispose();this._layers.clear(),this._immediateChanges=null}setImmediateChanges(e){this._immediateChanges=e}isImmediateChange(e){return!(!this._immediateChanges||this._immediateChanges.indexOf(e)===-1)}getStartFrame(e){return this._randomStart?Math.random()*this._frameCount:0}initialize(e){if(e.randomStart&&(this._randomStart=!0),e.layers)for(const t in e.layers){const s=e.layers[t];if(!s)return!1;const r=parseInt(t),i=s.loopCount!==void 0?s.loopCount:1,a=s.frameRepeat!==void 0?s.frameRepeat:1,l=s.random!==void 0&&s.random!==0;if(!this.addLayer(r,i,a,l,s))return!1}return!0}addLayer(e,t,s,r,i){const a=new R4(t,s,r);if(i.frameSequences)for(const c in i.frameSequences){const u=i.frameSequences[c];if(!u)continue;const h=u.loopCount!==void 0?u.loopCount:1,d=u.random!==void 0&&u.random!==0,f=a.addFrameSequence(h,d);if(u.frames)for(const E in u.frames){const m=u.frames[E];if(!m)return a.dispose(),!1;f.addFrame(m.id,m.x||0,m.y||0,m.randomX||0,m.randomY||0,this.readDirectionalOffsets(m))}f.initialize()}a.calculateLength(),this._layers.set(e,a);const l=a.frameCount;return l>this._frameCount&&(this._frameCount=l),!0}readDirectionalOffsets(e){let t=null;if(e&&e.offsets)for(const s in e.offsets){const r=e.offsets[s];r&&(t||(t=new pb),t.setDirection(r.direction,r.x,r.y))}return t}getFrame(e,t,s){const r=this._layers.get(t);return r?r.getFrame(e,s):null}getFrameFromSequence(e,t,s,r,i){const a=this._layers.get(t);return a?a.getFrameFromSequence(e,s,r,i):null}};zd.TRANSITION_TO_ANIMATION_OFFSET=1e6;zd.TRANSITION_FROM_ANIMATION_OFFSET=2e6;zd.DEFAULT_FRAME_NUMBER=0;let Ws=zd;const Ib=class Af{constructor(e){this._colors=[],this.createColors(e)}createColors(e){if(e)for(let t=0;t<e;t++)this._colors.push(Af.DEFAULT_COLOR)}dispose(){this._colors=[]}getLayerColor(e){const t=this._colors[e];return t||Af.DEFAULT_COLOR}setColorLayer(e,t){this._colors[e]&&(this._colors[e]=t)}};Ib.DEFAULT_COLOR=16777215;let Vc=Ib;const Tn=class pa{constructor(){this._tag=pa.DEFAULT_TAG,this._ink=pa.DEFAULT_INK,this._alpha=pa.DEFAULT_ALPHA,this._ignoreMouse=pa.DEFAULT_IGNORE_MOUSE,this._xOffset=pa.DEFAULT_XOFFSET,this._yOffset=pa.DEFAULT_YOFFSET,this._zOffset=pa.DEFAULT_ZOFFSET}setFromLayer(e){e&&(this._tag=e.tag,this._ink=e.ink,this._alpha=e.alpha,this._ignoreMouse=e.ignoreMouse,this._xOffset=e.xOffset,this._yOffset=e.yOffset,this._zOffset=e.zOffset)}get tag(){return this._tag}set tag(e){this._tag=e}get ink(){return this._ink}set ink(e){this._ink=e}get alpha(){return this._alpha}set alpha(e){this._alpha=e}get ignoreMouse(){return this._ignoreMouse}set ignoreMouse(e){this._ignoreMouse=e}get xOffset(){return this._xOffset}set xOffset(e){this._xOffset=e}get yOffset(){return this._yOffset}set yOffset(e){this._yOffset=e}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset=e}};Tn.DEFAULT_COUNT=0;Tn.DEFAULT_DIRECTION=0;Tn.DEFAULT_TAG="";Tn.DEFAULT_INK=jn.NORMAL;Tn.DEFAULT_ALPHA=255;Tn.DEFAULT_IGNORE_MOUSE=!1;Tn.DEFAULT_XOFFSET=0;Tn.DEFAULT_YOFFSET=0;Tn.DEFAULT_ZOFFSET=0;let vt=Tn;class fo{constructor(e){this._layers=[],this.createLayers(e)}createLayers(e){if(e)for(let t=0;t<e;t++)this._layers.push(new vt)}dispose(){this._layers=[]}setFromDirection(e){if(!e)return;const t=this.layerCount;if(t===e.layerCount)for(let s=0;s<t;s++){const r=this.getLayer(s),i=e.getLayer(s);r&&r.setFromLayer(i)}}getLayer(e){const t=this._layers[e];return t||null}getLayerTag(e){const t=this.getLayer(e);return t?t.tag:vt.DEFAULT_TAG}setLayerTag(e,t){const s=this.getLayer(e);s&&(s.tag=t)}getLayerInk(e){const t=this.getLayer(e);return t?t.ink:vt.DEFAULT_INK}setLayerInk(e,t){const s=this.getLayer(e);s&&(isNaN(t)||(s.ink=t))}getLayerAlpha(e){const t=this.getLayer(e);return t?t.alpha:vt.DEFAULT_ALPHA}setLayerAlpha(e,t){const s=this.getLayer(e);s&&(isNaN(t)||(s.alpha=t))}getLayerIgnoreMouse(e){const t=this.getLayer(e);return t?t.ignoreMouse:vt.DEFAULT_IGNORE_MOUSE}setLayerIgnoreMouse(e,t){const s=this.getLayer(e);s&&(s.ignoreMouse=t||!1)}getLayerXOffset(e){const t=this.getLayer(e);return t?t.xOffset:vt.DEFAULT_XOFFSET}setLayerXOffset(e,t){const s=this.getLayer(e);s&&(isNaN(t)||(s.xOffset=t))}getLayerYOffset(e){const t=this.getLayer(e);return t?t.yOffset:vt.DEFAULT_YOFFSET}setLayerYOffset(e,t){const s=this.getLayer(e);s&&(isNaN(t)||(s.yOffset=t))}getLayerZOffset(e){const t=this.getLayer(e);return t?t.zOffset:vt.DEFAULT_ZOFFSET}setLayerZOffset(e,t){const s=this.getLayer(e);s&&(isNaN(t)||(s.zOffset=t))}get layerCount(){return this._layers.length}}fo.USE_DEFAULT_DIRECTION=-1;const Tb=class Nf{constructor(e,t){this._layerCount=e<0?0:e>Nf.MAX_LAYERS?Nf.MAX_LAYERS:e,this._angle=t<1?1:t>360?360:t,this._defaultDirection=new fo(this._layerCount),this._directions=new Map,this._colors=[],this._lastDirectionData=null,this._lastDirection=-1}dispose(){this._defaultDirection&&this._defaultDirection.dispose();for(const e of this._directions.values())e&&e.dispose();for(const e of this._colors)e&&e.dispose();this.reset()}reset(){this._defaultDirection=null,this._colors=[],this._lastDirectionData=null,this._lastDirection=-1,this._directions.clear()}processLayers(e){return e?this.setDirectionLayers(this._defaultDirection,e):!1}processDirections(e){if(!e)return!1;for(const t in e){const s=e[t];if(!s)continue;const r=parseInt(t);if(this._directions.get(r))return!1;const i=new fo(this._layerCount);i.setFromDirection(this._defaultDirection),this.setDirectionLayers(i,s.layers),this._directions.set(r,i),this._lastDirectionData=null,this._lastDirection=-1}return!0}processColors(e){if(!e)return!1;for(const t in e){const s=e[t];if(!s)continue;const r=parseInt(t);if(this._colors[r])return!1;const i=new Vc(this._layerCount);for(const a in s.layers){const l=s.layers[a];if(!l)continue;const c=parseInt(a),u=l.color;i.setColorLayer(c,u)}this._colors[r]=i}return!0}setDirectionLayers(e,t){if(!e||!t)return!1;for(const s in t){const r=t[s];if(!r)continue;const i=parseInt(s);if(i<0||i>=this._layerCount)return!1;r.ink!==void 0&&e.setLayerInk(i,K0.inkToBlendMode(r.ink)),r.tag!==void 0&&e.setLayerTag(i,r.tag),r.alpha!==void 0&&e.setLayerAlpha(i,r.alpha),r.ignoreMouse!==void 0&&e.setLayerIgnoreMouse(i,r.ignoreMouse),r.x!==void 0&&e.setLayerXOffset(i,r.x),r.y!==void 0&&e.setLayerYOffset(i,r.y),r.z!==void 0&&e.setLayerZOffset(i,r.z/-1e3)}return!0}getValidDirection(e){if(this._directions.get(e))return e;e=(e%360+360)%360;let s=-1,r=-1;for(const i of this._directions.keys()){let a=(i*this._angle-e+360)%360;a>180&&(a=360-a),(a<s||s<0)&&(s=a,r=i)}return r>=0?Math.trunc(r):0}getDirectionData(e){if(e===this._lastDirection&&this._lastDirectionData)return this._lastDirectionData;let t=this._directions.get(e);return t||(t=this._defaultDirection),this._lastDirection=e,this._lastDirectionData=t,this._lastDirectionData}getLayerTag(e,t){const s=this.getDirectionData(e);return s?s.getLayerTag(t):vt.DEFAULT_TAG}getLayerInk(e,t){const s=this.getDirectionData(e);return s?s.getLayerInk(t):vt.DEFAULT_INK}getLayerAlpha(e,t){const s=this.getDirectionData(e);return s?s.getLayerAlpha(t):vt.DEFAULT_ALPHA}getLayerColor(e,t){const s=this._colors[t];return s?s.getLayerColor(e):Vc.DEFAULT_COLOR}getLayerIgnoreMouse(e,t){const s=this.getDirectionData(e);return s?s.getLayerIgnoreMouse(t):vt.DEFAULT_IGNORE_MOUSE}getLayerXOffset(e,t){const s=this.getDirectionData(e);return s?s.getLayerXOffset(t):vt.DEFAULT_XOFFSET}getLayerYOffset(e,t){const s=this.getDirectionData(e);return s?s.getLayerYOffset(t):vt.DEFAULT_YOFFSET}getLayerZOffset(e,t){const s=this.getDirectionData(e);return s?s.getLayerZOffset(t):vt.DEFAULT_ZOFFSET}get layerCount(){return this._layerCount}};Tb.MAX_LAYERS=26;let Rb=Tb;class $h extends Rb{constructor(e,t){super(e,t),this._animations=new Map,this._animationIds=[]}dispose(){super.dispose();for(const e of this._animations.values())e&&e.dispose();this._animations.clear(),this._animationIds=[]}defineAnimations(e){if(!e)return!0;for(const t in e){const s=e[t];if(!s)return!1;let r=parseInt(t.split("_")[0]),i=!1;const a=s.transitionTo,l=s.transitionFrom;a!==void 0&&(r=Ws.getTransitionToAnimationId(a),i=!0),l!==void 0&&(r=Ws.getTransitionFromAnimationId(l),i=!0);const c=this.createAnimationData();if(!c.initialize(s))return c.dispose(),!1;const u=s.immediateChangeFrom;if(u!==void 0){const h=u.split(","),d=[];for(const f of h){const E=parseInt(f);d.indexOf(E)===-1&&d.push(E)}c.setImmediateChanges(d)}this._animations.set(r,c),i||this._animationIds.push(r)}return!0}createAnimationData(){return new Ws}hasAnimation(e){return!!this._animations.get(e)}getAnimationCount(){return this._animationIds.length||0}getAnimationId(e){const t=this.getAnimationCount();return e<0||t<=0?0:this._animationIds[e%t]}isImmediateChange(e,t){const s=this._animations.get(e);return s?s.isImmediateChange(t):!1}getStartFrame(e,t){const s=this._animations.get(e);return s?s.getStartFrame(t):0}getFrame(e,t,s,r){const i=this._animations.get(e);return i?i.getFrame(t,s,r):null}getFrameFromSequence(e,t,s,r,i,a){const l=this._animations.get(e);return l?l.getFrameFromSequence(t,s,r,i,a):null}}class Ob{constructor(){this._animationId=-1,this._animationAfterTransitionId=0,this._animationOver=!1,this._frameCounter=0,this._frames=[],this._lastFramePlayed=[],this._animationPlayed=[],this._layerCount=0}get animationOver(){return this._animationOver}set animationOver(e){this._animationOver=e}get frameCounter(){return this._frameCounter}set frameCounter(e){this._frameCounter=e}get animationId(){return this._animationId}set animationId(e){e!==this._animationId&&(this._animationId=e,this.resetAnimationFrames(!1))}get animationAfterTransitionId(){return this._animationAfterTransitionId}set animationAfterTransitionId(e){this._animationAfterTransitionId=e}dispose(){this.recycleFrames(),this._frames=null,this._lastFramePlayed=null,this._animationPlayed=null}setLayerCount(e){this._layerCount=e,this.resetAnimationFrames()}resetAnimationFrames(e=!0){(e||!this._frames)&&(this.recycleFrames(),this._frames=[]),this._lastFramePlayed=[],this._animationPlayed=[],this._animationOver=!1,this._frameCounter=0;let t=0;for(;t<this._layerCount;){if(e||this._frames.length<=t)this._frames[t]=null;else{const s=this._frames[t];s&&(s.recycle(),this._frames[t]=pl.allocate(s.id,s.x,s.y,s.repeats,0,s.isLastFrame))}this._lastFramePlayed[t]=!1,this._animationPlayed[t]=!1,t++}}recycleFrames(){if(!(!this._frames||!this._frames.length))for(const e of this._frames)e&&e.recycle()}getFrame(e){return e<0||e>=this._layerCount?null:this._frames[e]}setFrame(e,t){if(e<0||e>=this._layerCount)return;const s=this._frames[e];s&&s.recycle(),this._frames[e]=t}getAnimationPlayed(e){return e<0||e>=this._layerCount?!0:this._animationPlayed[e]}setAnimationPlayed(e,t){e<0||e>=this._layerCount||(this._animationPlayed[e]=t)}getLastFramePlayed(e){return e<0||e>=this._layerCount?!0:this._lastFramePlayed[e]}setLastFramePlayed(e,t){e<0||e>=this._layerCount||(this._lastFramePlayed[e]=t)}}const Sb=class Cb extends $h{constructor(e,t){super(e,t),this._posturesToAnimations=new Map,this._gesturesToAnimations=new Map,this._defaultPosture=null}processPostures(e){if(!e||(e.defaultPosture&&e.defaultPosture.length&&(this._defaultPosture=e.defaultPosture),!e.postures))return!1;for(const t of e.postures)this._posturesToAnimations.get(t.id)||(this._defaultPosture===null&&(this._defaultPosture=t.id),this._posturesToAnimations.set(t.id,t.animationId));return this._posturesToAnimations.get(this._defaultPosture)!==void 0}processGestures(e){if(!e)return!1;for(const t of e)this._gesturesToAnimations.get(t.id)||this._gesturesToAnimations.set(t.id,t.animationId);return!0}postureToAnimation(e){return this._posturesToAnimations.get(e)||(e=this._defaultPosture),this._posturesToAnimations.get(e)}getGestureDisabled(e){return e==="ded"}gestureToAnimation(e){return this._gesturesToAnimations.get(e)?this._gesturesToAnimations.get(e):Cb.DEFAULT}animationToPosture(e,t){if(e>=0&&e<this._posturesToAnimations.size){const s=this._posturesToAnimations.keys();for(;;){const r=s.next();if(r.done)return null;if(e<=0)return r.value;--e}}return t?this._defaultPosture:null}animationToGesture(e){if(e>=0&&e<this._gesturesToAnimations.size){const t=this._gesturesToAnimations.keys();for(;;){const s=t.next();if(s.done)return null;if(e<=0)return s.value;--e}}return null}getGestureForAnimationId(e){for(const t of this._gesturesToAnimations.keys())if(this._gesturesToAnimations.get(t)===e)return t;return null}get totalPostures(){return this._posturesToAnimations.size}get totalGestures(){return this._gesturesToAnimations.size}};Sb.DEFAULT=-1;let oc=Sb;class Zn{constructor(){this._type="",this._sizes=[],this._sizeDatas=new Map,this._lastSize=-1,this._lastSizeScale=-1,this._lastSizeData=null,this._lastSizeDataScale=-1}initialize(e){return this.reset(),e?(this._type=e.name,this.defineVisualizations(e.visualizations)?!0:(this.reset(),!1)):!1}dispose(){if(this._sizeDatas&&this._sizeDatas.size){for(const e of this._sizeDatas.values())e&&e.dispose();this._sizeDatas=null}this._lastSizeData=null,this._sizes=null}reset(){if(this._type="",this._sizeDatas&&this._sizeDatas.size)for(const e of this._sizeDatas.values())e&&e.dispose();this._sizeDatas.clear(),this._sizes=[],this._lastSizeData=null,this._lastSizeDataScale=-1}createSizeData(e,t,s){return new Rb(t,s)}defineVisualizations(e){if(!e)return!1;for(const t in e){const s=e[t],r=s.layerCount,i=s.angle;let a=s.size;if(a<1&&(a=1),this._sizeDatas.get(a))return!1;const l=this.createSizeData(a,r,i);if(!l)return!1;for(const c in s){const u=s[c];if(!this.processVisualElement(l,c,u))return l.dispose(),!1}this._sizeDatas.set(a,l),this._sizes.push(a)}return this._sizes.sort(),!0}processVisualElement(e,t,s){if(!e||!t||!s)return!1;switch(t){case"layers":if(!e.processLayers(s))return!1;break;case"directions":if(!e.processDirections(s))return!1;break;case"colors":if(!e.processColors(s))return!1;break}return!0}getValidSize(e){if(e===this._lastSizeScale)return this._lastSize;const t=this.getSizeIndex(e);let s=-1;return t<this._sizes.length&&(s=this._sizes[t]),this._lastSizeScale=e,this._lastSize=s,s}getSizeIndex(e){if(e<=0)return 0;let t=0,s=1;for(;s<this._sizes.length;){if(this._sizes[s]>e){this._sizes[s]/e<e/this._sizes[s-1]&&(t=s);break}t=s,s++}return t}getSizeData(e){if(e===this._lastSizeDataScale)return this._lastSizeData;const t=this.getSizeIndex(e);return t<this._sizes.length?this._lastSizeData=this._sizeDatas.get(this._sizes[t]):this._lastSizeData=null,this._lastSizeDataScale=e,this._lastSizeData}getLayerCount(e){const t=this.getSizeData(e);return t?t.layerCount:vt.DEFAULT_COUNT}getValidDirection(e,t){const s=this.getSizeData(e);return s?s.getValidDirection(t):vt.DEFAULT_DIRECTION}getLayerTag(e,t,s){const r=this.getSizeData(e);return r?r.getLayerTag(t,s):vt.DEFAULT_TAG}getLayerInk(e,t,s){const r=this.getSizeData(e);return r?r.getLayerInk(t,s):vt.DEFAULT_INK}getLayerAlpha(e,t,s){const r=this.getSizeData(e);return r?r.getLayerAlpha(t,s):vt.DEFAULT_ALPHA}getLayerColor(e,t,s){const r=this.getSizeData(e);return r?r.getLayerColor(t,s):Vc.DEFAULT_COLOR}getLayerIgnoreMouse(e,t,s){const r=this.getSizeData(e);return r?r.getLayerIgnoreMouse(t,s):vt.DEFAULT_IGNORE_MOUSE}getLayerXOffset(e,t,s){const r=this.getSizeData(e);return r?r.getLayerXOffset(t,s):vt.DEFAULT_XOFFSET}getLayerYOffset(e,t,s){const r=this.getSizeData(e);return r?r.getLayerYOffset(t,s):vt.DEFAULT_YOFFSET}getLayerZOffset(e,t,s){const r=this.getSizeData(e);return r?r.getLayerZOffset(t,s):vt.DEFAULT_ZOFFSET}get type(){return this._type}}Zn.LAYER_LETTERS=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];class ME extends Zn{createSizeData(e,t,s){return new $h(t,s)}processVisualElement(e,t,s){if(!e||!t||!s)return!1;switch(t){case"animations":if(!(e instanceof $h)||!e.defineAnimations(s))return!1;break;default:if(!super.processVisualElement(e,t,s))return!1;break}return!0}hasAnimation(e,t){const s=this.getSizeData(e);return s?s.hasAnimation(t):null}getAnimationCount(e){const t=this.getSizeData(e);return t?t.getAnimationCount():null}getAnimationId(e,t){const s=this.getSizeData(e);return s?s.getAnimationId(t):null}isImmediateChange(e,t,s){const r=this.getSizeData(e);return r?r.isImmediateChange(t,s):null}getStartFrame(e,t,s){const r=this.getSizeData(e);return r?r.getStartFrame(t,s):null}getFrame(e,t,s,r,i){const a=this.getSizeData(e);return a?a.getFrame(t,s,r,i):null}getFrameFromSequence(e,t,s,r,i,a,l){const c=this.getSizeData(e);return c?c.getFrameFromSequence(t,s,r,i,a,l):null}}const DE=class Ab extends Od{constructor(){super(),this._data=null,this._type=null,this._direction=0,this._lastCameraAngle=NaN,this._selectedColor=0,this._furnitureLift=0,this._alphaMultiplier=1,this._alphaChanged=!1,this._clickUrl=null,this._clickHandling=!1,this._cacheDirection=-1,this._cacheScale=0,this._cacheSize=-1,this._layerCount=0,this._shadowLayerIndex=-1,this._updatedLayers=[],this._assetNames=[],this._spriteTags=[],this._spriteInks=[],this._spriteAlphas=[],this._spriteColors=[],this._spriteMouseCaptures=[],this._spriteXOffsets=[],this._spriteYOffsets=[],this._spriteZOffsets=[],this._animationNumber=0}initialize(e){return this.reset(),e instanceof Zn?(this._type=e.type,this._data=e,!0):!1}dispose(){super.dispose(),this._data=null,this._updatedLayers=null,this._assetNames=null,this._spriteTags=null,this._spriteInks=null,this._spriteAlphas=null,this._spriteColors=null,this._spriteMouseCaptures=null,this._spriteXOffsets=null,this._spriteYOffsets=null,this._spriteZOffsets=null}reset(){super.reset(),this.setDirection(-1),this._data=null,this._updatedLayers=[],this._assetNames=[],this._spriteTags=[],this._spriteInks=[],this._spriteAlphas=[],this._spriteColors=[],this._spriteMouseCaptures=[],this._spriteXOffsets=[],this._spriteYOffsets=[],this._spriteZOffsets=[],this.createSprites(0)}resetLayers(e,t){this._cacheDirection===t&&this._cacheScale===e||(this._updatedLayers=[],this._assetNames=[],this._spriteTags=[],this._spriteInks=[],this._spriteAlphas=[],this._spriteColors=[],this._spriteMouseCaptures=[],this._spriteXOffsets=[],this._spriteYOffsets=[],this._spriteZOffsets=[],this._cacheDirection=t,this._cacheScale=e,this._cacheSize=this.getValidSize(e),this.setLayerCount((this._data&&this._data.getLayerCount(e)||0)+this.getAdditionalLayerCount()))}update(e,t,s,r){if(!e)return;const i=e.scale;let a=!1;this.updateObject(i,e.direction.x)&&(a=!0),this.updateModel(i)&&(a=!0);let l=0;r?this._animationNumber=this._animationNumber|this.updateAnimation(i):(l=this.updateAnimation(i)|this._animationNumber,this._animationNumber=0),(a||l!==0)&&(this.updateSprites(i,a,l),this._scale=i,this.updateSpriteCounter++)}updateObject(e,t){if(!this.object||this.updateObjectCounter===this.object.updateCounter&&e===this._scale&&this._lastCameraAngle===t)return!1;let s=this.object.getDirection().x-(t+135);if(s=(s%360+360)%360,this._data){const r=this._data.getValidDirection(e,s);this.setDirection(r)}return this._lastCameraAngle=t,this._scale=e,this.updateObjectCounter=this.object.updateCounter,this.resetLayers(e,this._direction),!0}updateModel(e){const t=this.object&&this.object.model;if(!t||this.updateModelCounter===t.updateCounter)return!1;this._selectedColor=t.getValue(C.FURNITURE_COLOR),this._clickUrl=t.getValue(C.FURNITURE_AD_URL),this._clickHandling=this._clickUrl&&this._clickUrl!==""&&this._clickUrl.indexOf("http")===0||!1,this._furnitureLift=t.getValue(C.FURNITURE_LIFT_AMOUNT)||0;let s=t.getValue(C.FURNITURE_ALPHA_MULTIPLIER);return isNaN(s)&&(s=1),this._alphaMultiplier!==s&&(this._alphaMultiplier=s,this._alphaChanged=!0),this.updateModelCounter=t.updateCounter,!0}updateSprites(e,t,s){if(this._layerCount!==this.totalSprites&&this.createSprites(this._layerCount),t){let r=this.totalSprites-1;for(;r>=0;)this.updateSprite(e,r),r--}else{let r=0;for(;s>0;)s&&this.updateSprite(e,r),r++,s=s>>1}this._alphaChanged=!1}updateSprite(e,t){const s=this.getSpriteAssetName(e,t),r=this.getSprite(t);if(s&&r){const i=this.getAsset(s,t);if(i&&i.texture){r.visible=!0,r.type=this._type,r.texture=i.texture,r.flipH=i.flipH,r.flipV=i.flipV,r.direction=this._direction;let a=0;t!==this._shadowLayerIndex?(r.tag=this.getLayerTag(e,this._direction,t),r.alpha=this.getLayerAlpha(e,this._direction,t),r.color=this.getLayerColor(e,t,this._selectedColor),r.offsetX=i.offsetX+this.getLayerXOffset(e,this._direction,t),r.offsetY=i.offsetY+this.getLayerYOffset(e,this._direction,t),r.blendMode=this.getLayerInk(e,this._direction,t),r.alphaTolerance=this.getLayerIgnoreMouse(e,this._direction,t)?Ti.MATCH_NOTHING:Ti.MATCH_OPAQUE_PIXELS,a=this.getLayerZOffset(e,this._direction,t),a=a-t*.001):(r.offsetX=i.offsetX,r.offsetY=i.offsetY+this.getLayerYOffset(e,this._direction,t),r.alpha=48*this._alphaMultiplier,r.alphaTolerance=Ti.MATCH_NOTHING,a=1),r.relativeDepth=a*Ab.DEPTH_MULTIPLIER,r.name=s,r.libraryAssetName=this.getLibraryAssetNameForSprite(i,r),r.posture=this.getPostureForAsset(e,i.source),r.clickHandling=this._clickHandling}else this.resetSprite(r)}else r&&this.resetSprite(r)}getLibraryAssetNameForSprite(e,t){return e.source}getPostureForAssetFile(e,t){return null}resetSprite(e){e&&(e.texture=null,e.libraryAssetName="",e.posture="",e.tag="",e.offsetX=0,e.offsetY=0,e.flipH=!1,e.flipV=!1,e.relativeDepth=0,e.clickHandling=!1)}getSpriteAssetName(e,t){if(!this._data||t>=Zn.LAYER_LETTERS.length)return"";let s=this._assetNames[t],r=this._updatedLayers[t];return(!s||!s.length)&&(s=this.cacheSpriteAssetName(e,t,!0),r=this._cacheSize!==1),r&&(s+=this.getFrameNumber(e,t)),s}cacheSpriteAssetName(e,t,s){this._type;const r=s?this._cacheSize:this.getValidSize(e);let i="";const a=r!==1;if(t!==this._shadowLayerIndex?i=Zn.LAYER_LETTERS[t]||"":i="sd",i==="")return null;const l=this._type+(a?"_"+r+"_"+i+"_"+this._direction+"_":"_icon_"+i);return s&&(this._assetNames[t]=l,this._updatedLayers[t]=a),l}getLayerTag(e,t,s){const r=this._spriteTags[s];if(r!==void 0)return r;if(!this._data)return vt.DEFAULT_TAG;const i=this._data.getLayerTag(e,t,s);return this._spriteTags[s]=i,i}getLayerInk(e,t,s){const r=this._spriteInks[s];if(r!==void 0)return r;if(!this._data)return vt.DEFAULT_INK;const i=this._data.getLayerInk(e,t,s);return this._spriteInks[s]=i,i}getLayerAlpha(e,t,s){if(!this._alphaChanged){const i=this._spriteAlphas[s];if(i!==void 0)return i}if(!this._data)return vt.DEFAULT_ALPHA;let r=this._data.getLayerAlpha(e,t,s);return this._alphaMultiplier!==null&&(r=r*this._alphaMultiplier),this._spriteAlphas[s]=r,r}getLayerColor(e,t,s){const r=this._spriteColors[t];if(r!==void 0)return r;if(!this._data)return Vc.DEFAULT_COLOR;const i=this._data.getLayerColor(e,t,s);return this._spriteColors[t]=i,i}getLayerIgnoreMouse(e,t,s){const r=this._spriteMouseCaptures[s];if(r!==void 0)return r;if(!this._data)return vt.DEFAULT_IGNORE_MOUSE;const i=this._data.getLayerIgnoreMouse(e,t,s);return this._spriteMouseCaptures[s]=i,i}getLayerXOffset(e,t,s){const r=this._spriteXOffsets[s];if(r!==void 0)return r;if(!this._data)return vt.DEFAULT_XOFFSET;const i=this._data.getLayerXOffset(e,t,s);return this._spriteXOffsets[s]=i,i}getLayerYOffset(e,t,s){if(s===this._shadowLayerIndex)return Math.ceil(this._furnitureLift*(e/2));const r=this._spriteYOffsets[s];if(r!==void 0)return r;if(!this._data)return vt.DEFAULT_YOFFSET;const i=this._data.getLayerYOffset(e,t,s);return this._spriteYOffsets[s]=i,i}getLayerZOffset(e,t,s){const r=this._spriteZOffsets[s];if(r!==void 0)return r;if(!this._data)return vt.DEFAULT_ZOFFSET;const i=this._data.getLayerZOffset(e,t,s);return this._spriteZOffsets[s]=i,i}getValidSize(e){return this._data?this._data.getValidSize(e):e}setLayerCount(e){this._layerCount=e,this._shadowLayerIndex=e-this.getAdditionalLayerCount()}setDirection(e){this._direction!==e&&(this._direction=e)}getAdditionalLayerCount(){return 1}updateAnimation(e){return 0}getFrameNumber(e,t){return 0}getPostureForAsset(e,t){return null}getAsset(e,t=-1){return this.asset?this.asset.getAsset(e):null}get direction(){return this._direction}get data(){return this._data}};DE.DEPTH_MULTIPLIER=Math.sqrt(.5);DE.TYPE=re.FURNITURE_STATIC;let Uo=DE;const vE=class yf extends Uo{constructor(){super(),this._state=-1,this._frameIncrease=1,this._animationData=new Ob,this._animationScale=0,this._animationChangeTime=0,this._animatedLayerCount=0,this._directionChanged=!1}initialize(e){return e instanceof ME?super.initialize(e):!1}dispose(){super.dispose(),this._animationData&&(this._animationData.dispose(),this._animationData=null)}get animatedLayerCount(){return this._animatedLayerCount}get animationId(){return this._animationData.animationId}getAnimationId(e){return this.animationId!==yf.DEFAULT_ANIMATION_ID&&this.data.hasAnimation(this._animationScale,this.animationId)?this.animationId:yf.DEFAULT_ANIMATION_ID}updateObject(e,t){if(super.updateObject(e,t)){const s=this.object.getState(0);return s!==this._state&&(this.setAnimation(s),this._state=s,this._animationChangeTime=this.object.model.getValue(C.FURNITURE_STATE_UPDATE_TIME)||0),!0}return!1}updateModel(e){if(super.updateModel(e)){if(this.usesAnimationResetting()){const s=this.object.model.getValue(C.FURNITURE_STATE_UPDATE_TIME);s>this._animationChangeTime&&(this._animationChangeTime=s,this.setAnimation(this._state))}const t=this.object.model.getValue(C.FURNITURE_AUTOMATIC_STATE_INDEX);if(!isNaN(t)){const s=this.data.getAnimationId(this._animationScale,t);this.setAnimation(s)}return!0}return!1}isPlayingTransition(e,t){return!(!Ws.isTransitionFromAnimation(e.animationId)&&!Ws.isTransitionToAnimation(e.animationId)||t!==e.animationAfterTransitionId||e.animationOver)}getCurrentState(e){const t=e.animationId;return!Ws.isTransitionFromAnimation(t)&&!Ws.isTransitionToAnimation(t)?t:e.animationAfterTransitionId}setAnimation(e){this.data&&this.setSubAnimation(this._animationData,e,this._state>=0)}setSubAnimation(e,t,s=!0){const r=e.animationId;if(s){if(this.isPlayingTransition(e,t))return!1;const i=this.getCurrentState(e);if(t!==i){if(!this.data.isImmediateChange(this._animationScale,t,i)){let a=Ws.getTransitionFromAnimationId(i);this.data.hasAnimation(this._animationScale,a)?(e.animationAfterTransitionId=t,t=a):(a=Ws.getTransitionToAnimationId(t),this.data.hasAnimation(this._animationScale,a)&&(e.animationAfterTransitionId=t,t=a))}}else if(Ws.isTransitionFromAnimation(e.animationId)){const a=Ws.getTransitionToAnimationId(t);this.data.hasAnimation(this._animationScale,a)&&(e.animationAfterTransitionId=t,t=a)}else if(!Ws.isTransitionToAnimation(e.animationId)&&this.usesAnimationResetting()){const a=Ws.getTransitionFromAnimationId(i);if(this.data.hasAnimation(this._animationScale,a))e.animationAfterTransitionId=t,t=a;else{const l=Ws.getTransitionToAnimationId(t);this.data.hasAnimation(this._animationScale,l)&&(e.animationAfterTransitionId=t,t=l)}}}return r!==t?(e.animationId=t,!0):!1}getLastFramePlayed(e){return this._animationData.getLastFramePlayed(e)}resetAllAnimationFrames(){this._animationData&&this._animationData.setLayerCount(this._animatedLayerCount)}updateAnimation(e){if(!this.data)return 0;e!==this._animationScale&&(this._animationScale=e,this._animatedLayerCount=this.data.getLayerCount(e),this.resetAllAnimationFrames());const t=this.updateAnimations(e);return this._directionChanged=!1,t}updateAnimations(e){if(this._animationData.animationOver&&!this._directionChanged)return 0;const t=this.updateFramesForAnimation(this._animationData,e);return this._animationData.animationOver&&(Ws.isTransitionFromAnimation(this._animationData.animationId)||Ws.isTransitionToAnimation(this._animationData.animationId))&&(this.setAnimation(this._animationData.animationAfterTransitionId),this._animationData.animationOver=!1),t}updateFramesForAnimation(e,t){if(e.animationOver&&!this._directionChanged)return 0;const s=this.getAnimationId(e);let r=e.frameCounter;r||(r=this.data.getStartFrame(t,s,this._direction)),r+=this.frameIncrease,e.frameCounter=r,e.animationOver=!0;let i=!1,a=this._animatedLayerCount-1,l=0,c=1<<this._animatedLayerCount-1;for(;a>=0;){let u=0;if(i=e.getAnimationPlayed(a),!i||this._directionChanged){let h=e.getLastFramePlayed(a),d=e.getFrame(a);d&&d.isLastFrame&&d.remainingFrameRepeats<=this.frameIncrease&&(h=!0),(this._directionChanged||!d||d.remainingFrameRepeats>=0&&(d.remainingFrameRepeats=d.remainingFrameRepeats-this.frameIncrease)<=0)&&(u=pl.SEQUENCE_NOT_DEFINED,d&&(u=d.activeSequence),u===pl.SEQUENCE_NOT_DEFINED?d=this.data.getFrame(t,s,this._direction,a,r):d=this.data.getFrameFromSequence(t,s,this._direction,a,u,d.activeSequenceOffset+d.repeats,r),e.setFrame(a,d),l=l|c),!d||d.remainingFrameRepeats==pl.FRAME_REPEAT_FOREVER?(h=!0,i=!0):e.animationOver=!1,e.setLastFramePlayed(a,h),e.setAnimationPlayed(a,i)}c=c>>1,a--}return l}getFrameNumber(e,t){const s=this._animationData.getFrame(t);return s?s.id:super.getFrameNumber(e,t)}getLayerXOffset(e,t,s){const r=super.getLayerXOffset(e,t,s),i=this._animationData.getFrame(s);return i?r+i.x:r}getLayerYOffset(e,t,s){const r=super.getLayerYOffset(e,t,s),i=this._animationData.getFrame(s);return i?r+i.y:r}usesAnimationResetting(){return!1}setDirection(e){this._direction!==e&&(super.setDirection(e),this._directionChanged=!0)}get frameIncrease(){return this._frameIncrease}get data(){return this._data}};vE.TYPE=re.FURNITURE_ANIMATED;vE.DEFAULT_ANIMATION_ID=0;let Ss=vE;const Nb=class fh extends Ss{constructor(){super(),this._badgeId="",this._badgeAssetNameNormalScale="",this._badgeAssetNameSmallScale="",this._badgeVisibleInState=-1}updateModel(e){let t=super.updateModel(e);const s=this.object.model.getValue(C.FURNITURE_BADGE_IMAGE_STATUS),r=this.object.model.getValue(C.FURNITURE_BADGE_ASSET_NAME);if(s===-1)this._badgeAssetNameNormalScale="",this._badgeAssetNameSmallScale="";else if(s===1&&r!==this._badgeId){this._badgeId=r,this._badgeAssetNameNormalScale=this._badgeId,this._badgeAssetNameSmallScale===""&&(this._badgeAssetNameSmallScale=this._badgeAssetNameNormalScale+"_32");const i=this.object.model.getValue(C.FURNITURE_BADGE_VISIBLE_IN_STATE);isNaN(i)||(this._badgeVisibleInState=i),t=!0}return t}getSpriteAssetName(e,t){return this.getLayerTag(e,this.direction,t)!==fh.BADGE||this._badgeVisibleInState!==-1&&this.object.getState(0)!==this._badgeVisibleInState?super.getSpriteAssetName(e,t):e===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale}getLayerXOffset(e,t,s){let r=super.getLayerXOffset(e,t,s);if(this.getLayerTag(e,t,s)===fh.BADGE){const i=this.getAsset(e===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale,s);i&&(e===64?r+=(40-i.width)/2:r+=(20-i.width)/2)}return r}getLayerYOffset(e,t,s){let r=super.getLayerYOffset(e,t,s);if(this.getLayerTag(e,t,s)===fh.BADGE){const i=this.getAsset(e===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale,s);i&&(e===64?r+=(40-i.height)/2:r+=(20-i.height)/2)}return r}};Nb.BADGE="BADGE";let O4=Nb;const Ql=class oo extends Uo{constructor(){super(),this._imageUrl=null,this._shortUrl=null,this._imageReady=!1,this._isAnimated=!1,this._gifCollection=null,this._offsetX=0,this._offsetY=0,this._offsetZ=0,this._currentFrame=-1,this._totalFrames=-1}dispose(){super.dispose(),this._imageUrl&&this.asset&&this.asset.disposeAsset(this._imageUrl)}updateObject(e,t){return super.updateObject(e,t)?(this._imageReady&&this.checkAndCreateImageForCurrentState(),!0):!1}updateModel(e){const t=super.updateModel(e);if(t&&(this._offsetX=this.object.model.getValue(C.FURNITURE_BRANDING_OFFSET_X)||0,this._offsetY=this.object.model.getValue(C.FURNITURE_BRANDING_OFFSET_Y)||0,this._offsetZ=this.object.model.getValue(C.FURNITURE_BRANDING_OFFSET_Z)||0,this._isAnimated=this.object.model.getValue(C.FURNITURE_BRANDING_IS_ANIMATED)||!1),this._imageReady){if(this.checkIfImageChanged())return this._imageReady=!1,this._imageUrl=null,!0}else if(this._imageReady=this.checkIfImageReady(),this._imageReady)return this.checkAndCreateImageForCurrentState(),!0;return t}checkIfImageChanged(){const e=this.object.model.getValue(C.FURNITURE_BRANDING_IMAGE_URL);return e&&e===this._imageUrl?!1:(this._gifCollection,this.asset&&this.asset.disposeAsset(this._imageUrl),!0)}checkIfImageReady(){if(!(this.object&&this.object.model))return!1;const t=this.object.model.getValue(C.FURNITURE_BRANDING_IMAGE_URL);if(!t||this._imageUrl&&this._imageUrl===t)return!1;if(this.object.model.getValue(C.FURNITURE_BRANDING_IMAGE_STATUS)===1){let r=null;if(this._isAnimated){const i=pe.instance.roomEngine.roomContentLoader.getGifCollection(t);i&&(this._gifCollection=i,r=i.textures[0])}else r=Fr().getTexture(t);return r?(this.imageReady(r,t),!0):!1}return!1}imageReady(e,t){if(!e){this._imageUrl=null;return}this._imageUrl=t}checkAndCreateImageForCurrentState(){if(this._isAnimated){this.buildAssetsForGif();return}if(!this._imageUrl)return;const e=Fr().getTexture(this._imageUrl);if(!e)return;const t=this.object.getState(0);this.addBackgroundAsset(e,t,0)}buildAssetsForGif(){if(!this._gifCollection)return;const e=this._gifCollection.textures,t=this._gifCollection.durations;if(!e.length||!t.length||e.length!==t.length)return;const s=this.object.getState(0);for(let r=0;r<e.length;r++){const i=e[r];t[r],i&&this.addBackgroundAsset(i,s,r)}this._currentFrame=-1,this._totalFrames=e.length}addBackgroundAsset(e,t,s){let r=0,i=0,a=!1,l=!1;switch(t){case oo.STATE_0:r=0,i=0,a=!1,l=!1;break;case oo.STATE_1:r=-e.width,i=0,a=!0,l=!1;break;case oo.STATE_2:r=-e.width,i=-e.height,a=!0,l=!0;break;case oo.STATE_3:r=0,i=-e.height,a=!1,l=!0;break}this.asset.addAsset(`${this._imageUrl}_${s}`,e,!0,r,i,a,l)}getSpriteAssetName(e,t){return this.getLayerTag(e,this._direction,t)===oo.BRANDED_IMAGE&&this._imageUrl?`${this._imageUrl}_${this.getFrameNumber(e,t)}`:super.getSpriteAssetName(e,t)}updateAnimation(e){return!this._imageReady||!this._isAnimated||this._totalFrames<=0?0:1}getFrameNumber(e,t){if(!this._imageReady||!this._isAnimated||this._totalFrames<=0)return 0;if(this.getLayerTag(e,this._direction,t)===oo.BRANDED_IMAGE&&this._imageUrl){let r=this._currentFrame;return r<0?r=0:r+=1,r===this._totalFrames&&(r=0),this._currentFrame=r,this._currentFrame}return 0}};Ql.BRANDED_IMAGE="branded_image";Ql.STATE_0=0;Ql.STATE_1=1;Ql.STATE_2=2;Ql.STATE_3=3;let bE=Ql;class yb extends bE{getLayerXOffset(e,t,s){return super.getLayerXOffset(e,t,s)+this._offsetX}getLayerYOffset(e,t,s){return super.getLayerYOffset(e,t,s)+this._offsetY}getLayerZOffset(e,t,s){return super.getLayerZOffset(e,t,s)+this._offsetZ}}const Kd=class mh extends Ss{constructor(){super(),this._stateQueue=[],this._running=!1}setAnimation(e){if(e===-1&&!this._running){this._running=!0,this._stateQueue=[],this._stateQueue.push(mh.ANIMATION_ID_ROLL);return}if(e>=0&&e<=7){if(this._running){this._running=!1,this._stateQueue=[],this._stateQueue.push(mh.ANIMATION_ID_OFFSET_SLOW1),this._stateQueue.push(mh.ANIMATION_ID_OFFSET_SLOW2+e),this._stateQueue.push(e);return}super.setAnimation(e)}}updateAnimation(e){return this.getLastFramePlayed(0)&&this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(e)}};Kd.ANIMATION_ID_OFFSET_SLOW1=20;Kd.ANIMATION_ID_OFFSET_SLOW2=9;Kd.ANIMATION_ID_ROLL=-1;let S4=Kd;class C4 extends Uo{}const du=class Oc extends Ss{getFrameNumber(e,t){const s=this.getLayerTag(e,this.direction,t),r=this.object.getState(0);switch(s){case Oc.SECONDS_SPRITE:return Math.floor(r%60%10);case Oc.TEN_SECONDS_SPRITE:return Math.floor(r%60/10);case Oc.MINUTES_SPRITE:return Math.floor(r/60%10);case Oc.TEN_MINUTES_SPRITE:return Math.floor(r/60/10%10);default:return super.getFrameNumber(e,t)}}get animationId(){return 0}};du.SECONDS_SPRITE="seconds_sprite";du.TEN_SECONDS_SPRITE="ten_seconds_sprite";du.MINUTES_SPRITE="minutes_sprite";du.TEN_MINUTES_SPRITE="ten_minutes_sprite";let A4=du;class N4 extends Od{}const Mb=class Mf extends Ss{constructor(){super(),this._thumbnailAssetNameNormal=null,this._thumbnailImageNormal=null,this._thumbnailDirection=-1,this._thumbnailChanged=!1,this._hasOutline=!1}get hasThumbnailImage(){return this._thumbnailImageNormal!=null}setThumbnailImages(e){this._thumbnailImageNormal=e,this._thumbnailChanged=!0}updateModel(e){const t=super.updateModel(e);return!this._thumbnailChanged&&this._thumbnailDirection===this.direction?t:(this.refreshThumbnail(),!0)}refreshThumbnail(){this.asset!=null&&(this._thumbnailImageNormal?this.addThumbnailAsset(this._thumbnailImageNormal,64):this.asset.disposeAsset(this.getThumbnailAssetName(64)),this._thumbnailChanged=!1,this._thumbnailDirection=this.direction)}addThumbnailAsset(e,t){let s=0;for(;s<this.totalSprites;){if(this.getLayerTag(t,this.direction,s)===Mf.THUMBNAIL){const r=this.cacheSpriteAssetName(t,s,!1)+this.getFrameNumber(t,s),i=this.getAsset(r,s);if(i){const a=this.generateTransformedThumbnail(e,i),l=this.getThumbnailAssetName(t);this.asset.disposeAsset(l),this.asset.addAsset(l,a,!0,i.offsetX,i.offsetY,!1,!1)}return}s++}}generateTransformedThumbnail(e,t){if(this._hasOutline){const l=new jt,c=new jt(am.WHITE);c.tint=0,c.width=e.width+40,c.height=e.height+40;const u=new jt(e),h=(c.width-u.width)/2,d=(c.height-u.height)/2;u.position.set(h,d),l.addChild(c,u),e=ht.generateTexture(l)}const s=1.1,r=new Or,i=t.width/e.width;switch(this.direction){case 2:r.a=i,r.b=-.5*i,r.c=0,r.d=i*s,r.tx=0,r.ty=.5*i*e.width;break;case 0:case 4:r.a=i,r.b=.5*i,r.c=0,r.d=i*s,r.tx=0,r.ty=0;break;default:r.a=i,r.b=0,r.c=0,r.d=i,r.tx=0,r.ty=0}const a=new jt(e);return a.transform.setFromMatrix(r),ht.generateTexture(a)}getSpriteAssetName(e,t){return this._thumbnailImageNormal&&this.getLayerTag(e,this.direction,t)===Mf.THUMBNAIL?this.getThumbnailAssetName(e):super.getSpriteAssetName(e,t)}getThumbnailAssetName(e){return this._thumbnailAssetNameNormal=this.getFullThumbnailAssetName(this.object.id,64),this._thumbnailAssetNameNormal}getFullThumbnailAssetName(e,t){return[this._type,e,"thumb",t].join("_")}};Mb.THUMBNAIL="THUMBNAIL";let Db=Mb;class vb extends Db{constructor(){super(),this._cachedUrl=null,this._hasOutline=!0}updateModel(e){if(this.object){const t=this.getThumbnailURL();if(this._cachedUrl!==t)if(this._cachedUrl=t,this._cachedUrl&&this._cachedUrl!==""){const s=new Image;s.src=t,s.crossOrigin="*",s.onload=()=>{const r=ts.from(s);r.baseTexture.scaleMode=cg.LINEAR,this.setThumbnailImages(r)}}else this.setThumbnailImages(null)}return super.updateModel(e)}getThumbnailURL(){throw new Error("This method must be overridden!")}}class y4 extends vb{constructor(){super(),this._url=null,this._typePrefix=null}getThumbnailURL(){if(!this.object)return null;if(this._url)return this._url;const e=this.object.model.getValue(C.FURNITURE_DATA);if(!e||e==="")return null;this.object.type.indexOf("")>=0&&(this._typePrefix=this.object.type.indexOf("")>=0?"":"postcards/selfie/");let s=JSON.parse(e).w||"";return s=this.buildThumbnailUrl(s),this._url=s,this._url}buildThumbnailUrl(e){return e=e.replace(".png","_small.png"),e.indexOf(".png")===-1&&(e=e+"_small.png"),e}}class Fp{constructor(){this._hasMoved=!1,this._age=0,this._isEmitter=!1,this._fade=!1,this._alphaMultiplier=1}init(e,t,s,r,i,a,l,c=!1,u=null,h=!1){this._x=e,this._y=t,this._z=s,this._particleDirection=new qr(r.x,r.y,r.z),this._particleDirection.scaleBy(i),this._lastX=this._x-this._particleDirection.x*a,this._lastY=this._y-this._particleDirection.y*a,this._lastZ=this._z-this._particleDirection.z*a,this._age=0,this._hasMoved=!1,this._lifeTime=l,this._isEmitter=c,this._frames=u,this._fade=h,this._alphaMultiplier=1,this._fadeTime=.5+Math.random()*.5}dispose(){this._particleDirection=null}update(){this._age++,this._age===this._lifeTime&&this.ignite(),this._fade&&this._age/this._lifeTime>this._fadeTime&&(this._alphaMultiplier=(this._lifeTime-this._age)/(this._lifeTime*(1-this._fadeTime)))}getAsset(){return this._frames&&this._frames.length>0?this._frames[this._age%this._frames.length]:null}ignite(){}get fade(){return this._fade}get alphaMultiplier(){return this._alphaMultiplier}get direction(){return this._particleDirection}get age(){return this._age}get isEmitter(){return this._isEmitter}get isAlive(){return this._age<=this._lifeTime}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get z(){return this._z}set z(e){this._z=e}get lastX(){return this._lastX}set lastX(e){this._hasMoved=!0,this._lastX=e}get lastY(){return this._lastY}set lastY(e){this._hasMoved=!0,this._lastY=e}get lastZ(){return this._lastZ}set lastZ(e){this._hasMoved=!0,this._lastZ=e}get hasMoved(){return this._hasMoved}toString(){return[this._x,this._y,this._z].toString()}copy(e,t){this._x=e._x*t,this._y=e._y*t,this._z=e._z*t,this._lastX=e._lastX*t,this._lastY=e._lastY*t,this._lastZ=e._lastZ*t,this._hasMoved=e.hasMoved,this._particleDirection=e._particleDirection,this._age=e._age,this._lifeTime=e._lifeTime,this._isEmitter=e._isEmitter,this._fade=e._fade,this._fadeTime=e._fadeTime,this._alphaMultiplier=e._alphaMultiplier}}const Xd=class Eh extends Fp{constructor(e="",t=-1){super(),this._roomObjectSpriteId=-1,this._timeStep=.1,this._fuseTime=10,this._energy=1,this._hasIgnited=!1,this._burstPulse=1,this._particles=[],this._name=e,this._roomObjectSpriteId=t,this._particleConfigurations=[]}dispose(){for(const e of this._particles)e.dispose();this._particles=null,this._particleConfigurations=null,super.dispose()}setup(e,t,s,r,i,a,l,c,u,h){this._maxNumberOfParticles=e,this._particlesPerFrame=t,this._force=s,this._emitterDirection=r,this._emitterDirection.normalize(),this._gravity=i,this._airFriction=a,this._explosionShape=l,this._fuseTime=u,this._energy=c,this._burstPulse=h,this.reset()}reset(){for(const e of this._particles)e.dispose();this._particles=[],this._emittedParticles=0,this._hasIgnited=!1,this.init(0,0,0,this._emitterDirection,this._force,this._timeStep,this._fuseTime,!0)}copyStateFrom(e,t){super.copy(e,t),this._force=e._force,this._emitterDirection=e._emitterDirection,this._gravity=e._gravity,this._airFriction=e._airFriction,this._explosionShape=e._explosionShape,this._fuseTime=e._fuseTime,this._energy=e._energy,this._burstPulse=e._burstPulse,this._timeStep=e._timeStep,this._hasIgnited=e._hasIgnited}configureParticle(e,t,s,r){const i={};i.lifeTime=e,i.isEmitter=t,i.frames=s,i.fade=r,this._particleConfigurations.push(i)}ignite(){this._hasIgnited=!0,this._emittedParticles<this._maxNumberOfParticles&&this.age>1&&this.releaseParticles(this,this.direction)}releaseParticles(e,t=null){t||(t=new qr);const s=new qr,r=this.getRandomParticleConfiguration();let i=0;for(;i<this._particlesPerFrame;){switch(this._explosionShape){case Eh.CONE:s.x=this.randomBoolean(.5)?Math.random():-Math.random(),s.y=-(Math.random()+1),s.z=this.randomBoolean(.5)?Math.random():-Math.random();break;case Eh.PLANE:s.x=this.randomBoolean(.5)?Math.random():-Math.random(),s.y=0,s.z=this.randomBoolean(.5)?Math.random():-Math.random();break;case Eh.SPHERE:s.x=this.randomBoolean(.5)?Math.random():-Math.random(),s.y=this.randomBoolean(.5)?Math.random():-Math.random(),s.z=this.randomBoolean(.5)?Math.random():-Math.random();break}s.normalize();const a=new Fp;let l=0,c=!1,u=!1,h=[];r?(l=Math.floor(Math.random()*r.lifeTime+10),c=r.isEmitter,h=r.frames,u=r.fade):(l=Math.trunc(Math.floor(Math.random()*20+10)),c=!1,h=[]),a.init(e.x,e.y,e.z,s,this._energy,this._timeStep,l,c,h,u),this._particles.push(a),this._emittedParticles++,i++}}getRandomParticleConfiguration(){const e=Math.trunc(Math.floor(Math.random()*this._particleConfigurations.length));return this._particleConfigurations[e]}update(){super.update(),this.accumulateForces(),this.verlet(),this.satisfyConstraints(),!this.isAlive&&this._emittedParticles<this._maxNumberOfParticles&&this.age%this._burstPulse===0&&this.releaseParticles(this,this.direction)}verlet(){if(this.isAlive||this._emittedParticles<this._maxNumberOfParticles){const t=this.x,s=this.y,r=this.z;this.x=(2-this._airFriction)*this.x-(1-this._airFriction)*this.lastX,this.y=(2-this._airFriction)*this.y-(1-this._airFriction)*this.lastY+this._gravity*this._timeStep*this._timeStep,this.z=(2-this._airFriction)*this.z-(1-this._airFriction)*this.lastZ,this.lastX=t,this.lastY=s,this.lastZ=r}const e=[];for(const t of this._particles){t.update();const s=t.x,r=t.y,i=t.z;t.x=(2-this._airFriction)*t.x-(1-this._airFriction)*t.lastX,t.y=(2-this._airFriction)*t.y-(1-this._airFriction)*t.lastY+this._gravity*this._timeStep*this._timeStep,t.z=(2-this._airFriction)*t.z-(1-this._airFriction)*t.lastZ,t.lastX=s,t.lastY=r,t.lastZ=i,(t.y>10||!t.isAlive)&&e.push(t)}for(const t of e)t.isEmitter,this._particles.splice(this._particles.indexOf(t),1),t.dispose()}satisfyConstraints(){}accumulateForces(){for(const e of this._particles);}get particles(){return this._particles}get hasIgnited(){return this._hasIgnited}randomBoolean(e){return Math.random()<e}get roomObjectSpriteId(){return this._roomObjectSpriteId}};Xd.CONE="cone";Xd.PLANE="plane";Xd.SPHERE="sphere";let M4=Xd;class D4{constructor(e){this._canvasId=-1,this._hasIgnited=!1,this._centerX=0,this._centerY=0,this._scaleMultiplier=1,this._blend=1,this._bgColor=4278190080,this._isDone=!1,this._emitters=new Zt,this._visualization=e,this._blackOverlayAlphaTransform=new og,this._blackOverlayAlphaTransform.alpha=1,this._particleColorTransform=new og,this._identityMatrix=new Or,this._translationMatrix=new Or}dispose(){for(const e of this._emitters.getValues())e.dispose();this._emitters=null,this._canvasTexture&&(this._canvasTexture.destroy(),this._canvasTexture=null),this._blackOverlay&&(this._blackOverlay.destroy(),this._blackOverlay=null),this._emptySprite&&(this._emptySprite.destroy(),this._emptySprite=null),this._blackOverlayAlphaTransform=null,this._particleColorTransform=null,this._identityMatrix=null,this._translationMatrix=null}reset(){this._currentEmitter&&this._currentEmitter.reset(),this._currentEmitter=null,this._hasIgnited=!1,this._isDone=!1,this.updateCanvas()}setAnimation(e){this._currentEmitter&&this._currentEmitter.reset(),this._currentEmitter=this._emitters.getValue(e),this._hasIgnited=!1,this._isDone=!1,this.updateCanvas()}updateCanvas(){if(!(!this._currentEmitter||this._canvasId===-1)&&(this._roomSprite=this._visualization.getSprite(this._canvasId),this._roomSprite&&this._roomSprite.texture)){if(this._roomSprite.width<=1||this._roomSprite.height<=1)return;this._canvasTexture&&(this._canvasTexture.width!==this._roomSprite.width||this._canvasTexture.height!==this._roomSprite.height)&&(this._canvasTexture=null),this.clearCanvas(),this._centerX=-this._roomSprite.offsetX,this._centerY=-this._roomSprite.offsetY,this._roomSprite.texture=this._canvasTexture}}getLayerYOffset(e,t,s){return this._currentEmitter&&this._currentEmitter.roomObjectSpriteId===s?this._currentEmitter.y*this._scaleMultiplier:0}controlsSprite(e){return this._currentEmitter?this._currentEmitter.roomObjectSpriteId==e:!1}updateSprites(){!this._currentEmitter||!this._roomSprite||(this._canvasTexture&&this._roomSprite.texture!==this._canvasTexture&&(this._roomSprite.texture=this._canvasTexture),this._hasIgnited&&this._currentEmitter.roomObjectSpriteId>=0&&(this._visualization.getSprite(this._currentEmitter.roomObjectSpriteId).visible=!1))}updateAnimation(){if(!this._currentEmitter||!this._roomSprite||this._isDone)return;const e=10;!this._hasIgnited&&this._currentEmitter.hasIgnited&&(this._hasIgnited=!0);const t=this._offsetY*this._scaleMultiplier;if(this._currentEmitter.update(),this._hasIgnited){this._currentEmitter.roomObjectSpriteId>=0&&(this._visualization.getSprite(this._currentEmitter.roomObjectSpriteId).visible=!1),this._canvasTexture||this.updateCanvas(),this.clearCanvas();for(const s of this._currentEmitter.particles){const r=this._centerX+(s.x-s.z)*e/10*this._scaleMultiplier,i=this._centerY-t+(s.y+(s.x+s.z)/2)*e/10*this._scaleMultiplier,a=s.getAsset();if(a&&a.texture)if(s.fade&&s.alphaMultiplier<1){this._translationMatrix.identity(),this._translationMatrix.translate(r+a.offsetX,i+a.offsetY);const l=new jt(a.texture);this._particleColorTransform.alpha=s.alphaMultiplier,l.filters=[this._particleColorTransform],Us.instance.renderer.render(l,{renderTexture:this._canvasTexture,transform:this._translationMatrix,clear:!1})}else{const l=new Ii(r+a.offsetX,i+a.offsetY),c=new jt(a.texture);c.x=l.x,c.y=l.y,Us.instance.renderer.render(c,{renderTexture:this._canvasTexture,clear:!1})}else{const l=new jt(ts.WHITE);l.tint=16777215,l.x=r-1,l.y=i-1,l.width=2,l.height=2,Us.instance.renderer.render(l,{renderTexture:this._canvasTexture,clear:!1})}}if(!this._currentEmitter.particles.length){this._isDone=!0;return}}}parseData(e){this._size=e.size,this._canvasId=e.canvasId!==void 0?e.canvasId:-1,this._offsetY=e.offsetY!==void 0?e.offsetY:10,this._scaleMultiplier=this._size/64,this._blend=e.blend!==void 0?e.blend:1,this._blend=Math.min(this._blend,1),this._blackOverlayAlphaTransform.alpha=this._blend;const t=e.bgColor!==void 0?e.bgColor:"0";if(this._bgColor=parseInt(t,16)||0,!(!e.emitters||!e.emitters.length))for(const s of e.emitters){const r=s.id,i=s.name,a=s.spriteId,l=new M4(i,a);this._emitters.add(r,l);const c=s.maxNumParticles,u=s.particlesPerFrame,h=s.burstPulse!==void 0?s.burstPulse:1,d=s.fuseTime,f=s.simulation.force,E=s.simulation.direction,m=s.simulation.gravity,R=s.simulation.airFriction,I=s.simulation.shape,S=s.simulation.energy;for(const A of s.particles){const N=A.lifeTime,L=A.isEmitter||!1,M=A.fade||!1,b=[];for(const B of A.frames)b.push(this._visualization.asset.getAsset(B));l.configureParticle(N,L,b,M)}l.setup(c,u,f,new qr(0,E,0),m,R,I,S,d,h)}}copyStateFrom(e){let t=0;e._emitters&&e._currentEmitter&&(t=e._emitters.getKey(e._emitters.getValues().indexOf(e._currentEmitter))),this.setAnimation(t),this._currentEmitter&&this._currentEmitter.copyStateFrom(e._currentEmitter,e._size/this._size),this._canvasTexture=null}clearCanvas(){this._emptySprite||(this._emptySprite=new jt(ts.EMPTY),this._emptySprite.alpha=0),this._canvasTexture?Us.instance.renderer.render(this._emptySprite,{renderTexture:this._canvasTexture,clear:!0}):this._canvasTexture=Hi.create({width:this._roomSprite.width,height:this._roomSprite.height})}}class bb extends Ss{dispose(){if(super.dispose(),this._currentParticleSystem=null,this._particleSystems){for(const e of this._particleSystems.getValues())e.dispose();this._particleSystems=null}}updateObject(e,t){if(super.updateObject(e,t)){if(!this._particleSystems)this.readDefinition(),this._particleSystems?this._currentParticleSystem=this._particleSystems.getValue(e):me.log("ERROR Particle systems could not be read!",this.object.type);else if(e!==this._scale||this._particleSystems.getValue(e)!==this._currentParticleSystem){const s=this._particleSystems.getValue(e);s.copyStateFrom(this._currentParticleSystem),this._currentParticleSystem&&this._currentParticleSystem.reset(),this._currentParticleSystem=s}return!0}return!1}updateSprites(e,t,s){super.updateSprites(e,t,s),this._currentParticleSystem&&this._currentParticleSystem.updateSprites()}updateAnimation(e){return this._currentParticleSystem&&this._currentParticleSystem.updateAnimation(),super.updateAnimation(e)}setAnimation(e){this._currentParticleSystem&&this._currentParticleSystem.setAnimation(e),super.setAnimation(e)}getLayerYOffset(e,t,s){return this._currentParticleSystem&&this._currentParticleSystem.controlsSprite(s)?this._currentParticleSystem.getLayerYOffset(e,t,s):super.getLayerYOffset(e,t,s)}readDefinition(){if(!this.object||!this.object.model)return!1;const e=this.object.model.getValue(C.FURNITURE_FIREWORKS_DATA);if(!e||!e.length)return!1;this._particleSystems=new Zt;for(const t of e){const s=t.size,r=new D4(this);r.parseData(t),this._particleSystems.add(s,r)}return!0}}const qd=class ph extends bb{constructor(){super(...arguments),this._packetType=0,this._ribbonType=0,this._lastAnimationId=0}update(e,t,s,r){this.updatePresentWrap(),super.update(e,t,s,r)}updatePresentWrap(){if(!this.object)return;const e=1e3,t=this.object.model.getValue(C.FURNITURE_EXTRAS),s=parseInt(t),r=Math.floor(s/e),i=s%e;this._packetType=r>ph.MAX_PACKET_TYPE_VALUE?0:r,this._ribbonType=i>ph.MAX_RIBBON_TYPE_VALUE?0:i}getFrameNumber(e,t){if(this._lastAnimationId===ph.PRESENT_DEFAULT_STATE){if(t<=1)return this._packetType;if(t===2)return this._ribbonType}return super.getFrameNumber(e,t)}getSpriteAssetName(e,t){const s=this.getValidSize(e);let r=this._type,i="";t<this.spriteCount-1?i=String.fromCharCode("a".charCodeAt(0)+t):i="sd";const a=this.getFrameNumber(e,t);return r=r+("_"+s+"_"+i+"_"+this.direction),r=r+("_"+a),r}setAnimation(e){this._lastAnimationId=e,super.setAnimation(e)}};qd.PRESENT_DEFAULT_STATE=0;qd.MAX_PACKET_TYPE_VALUE=9;qd.MAX_RIBBON_TYPE_VALUE=11;let v4=qd;class b4 extends Uo{constructor(){super(...arguments),this._packetType=0,this._ribbonType=0}update(e,t,s,r){this.updatePresentWrap(),super.update(e,t,s,r)}updatePresentWrap(){if(!this.object)return;const e=this.object.model.getValue(C.FURNITURE_EXTRAS),t=1e3,s=parseInt(e);this._packetType=Math.floor(s/t),this._ribbonType=s%t}getFrameNumber(e,t){return t<=1?this._packetType:this._ribbonType}getSpriteAssetName(e,t){const s=this.getValidSize(e);let r=this._type,i="";t<this.spriteCount-1?i=String.fromCharCode("a".charCodeAt(0)+t):i="sd";const a=this.getFrameNumber(e,t);return r=r+("_"+s+"_"+i+"_"+this.direction),r=r+("_"+a),r}}const Jl=class Pn extends Ss{constructor(){super(),this._color1=Pn.DEFAULT_COLOR_1,this._color2=Pn.DEFAULT_COLOR_2,this._badgeAssetNameNormalScale="",this._badgeAssetNameSmallScale=""}updateModel(e){const t=super.updateModel(e);if(this._badgeAssetNameNormalScale===""){const i=this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME);i&&(this._badgeAssetNameNormalScale=i,this._badgeAssetNameSmallScale=this._badgeAssetNameNormalScale+"_32")}const s=this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_COLOR_1);this._color1=s||Pn.DEFAULT_COLOR_1;const r=this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_COLOR_2);return this._color2=r||Pn.DEFAULT_COLOR_2,t}getLayerColor(e,t,s){switch(this.getLayerTag(e,this._direction,t)){case Pn.PRIMARY_COLOUR_SPRITE_TAG:return this._color1;case Pn.SECONDARY_COLOUR_SPRITE_TAG:return this._color2}return super.getLayerColor(e,t,s)}getSpriteAssetName(e,t){return this.getLayerTag(e,this._direction,t)===Pn.BADGE?e===32?this._badgeAssetNameSmallScale:this._badgeAssetNameNormalScale:super.getSpriteAssetName(e,t)}getLibraryAssetNameForSprite(e,t){return t.tag===Pn.BADGE?"%group.badge.url%"+t.libraryAssetName.replace("badge_",""):super.getLibraryAssetNameForSprite(e,t)}};Jl.PRIMARY_COLOUR_SPRITE_TAG="COLOR1";Jl.SECONDARY_COLOUR_SPRITE_TAG="COLOR2";Jl.BADGE="BADGE";Jl.DEFAULT_COLOR_1=15658734;Jl.DEFAULT_COLOR_2=4934475;let P4=Jl;const _u=class tl extends Db{updateModel(e){const t=super.updateModel(e);if(!this.hasThumbnailImage){const i=this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME);i&&i.length&&this.setThumbnailImages(this.getBitmapAsset(i))}const s=this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_COLOR_1);this._color1=s||tl.DEFAULT_COLOR_1;const r=this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_COLOR_2);return this._color2=r||tl.DEFAULT_COLOR_2,t}generateTransformedThumbnail(e,t){const r=new Or,i=t.width/e.width;switch(this.direction){case 2:r.a=i,r.b=-.5*i,r.c=0,r.d=i*1.1,r.tx=0,r.ty=.5*i*e.width;break;case 0:case 4:r.a=i,r.b=.5*i,r.c=0,r.d=i*1.1,r.tx=0,r.ty=0;break;default:r.a=i,r.b=0,r.c=0,r.d=i,r.tx=0,r.ty=0}const a=new jt(e);return a.transform.setFromMatrix(r),a.position.set(0),ht.generateTexture(a)}getLayerColor(e,t,s){switch(this.getLayerTag(e,this._direction,t)){case tl.PRIMARY_COLOUR_SPRITE_TAG:return this._color1;case tl.SECONDARY_COLOUR_SPRITE_TAG:return this._color2}return super.getLayerColor(e,t,s)}getLibraryAssetNameForSprite(e,t){return t.tag===tl.THUMBNAIL&&this.object&&this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME)?"%group.badge.url%"+this.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_ASSET_NAME):super.getLibraryAssetNameForSprite(e,t)}getBitmapAsset(e){const t=this.asset.getAsset(e);return!t||!t.texture?null:t.texture}};_u.PRIMARY_COLOUR_SPRITE_TAG="COLOR1";_u.SECONDARY_COLOUR_SPRITE_TAG="COLOR2";_u.DEFAULT_COLOR_1=15658734;_u.DEFAULT_COLOR_2=4934475;let L4=_u;const gu=class sl extends Ss{constructor(){super(),this._stateQueue=[],this._running=!1}setAnimation(e){if(e===-1&&!this._running){this._running=!0,this._stateQueue=[],this._stateQueue.push(sl.ANIMATION_ID_START_ROLL),this._stateQueue.push(sl.ANIMATION_ID_ROLL);return}if(e>0&&e<=sl.ANIMATION_ID_OFFSET_SLOW1){if(this._running){this._running=!1,this._stateQueue=[],this._stateQueue.push(sl.ANIMATION_ID_OFFSET_SLOW1+e),this._stateQueue.push(sl.ANIMATION_ID_OFFSET_SLOW2+e),this._stateQueue.push(e);return}super.setAnimation(e)}}updateAnimation(e){return this.getLastFramePlayed(1)&&this.getLastFramePlayed(2)&&this.getLastFramePlayed(3)&&this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(e)}};gu.ANIMATION_ID_OFFSET_SLOW1=10;gu.ANIMATION_ID_OFFSET_SLOW2=20;gu.ANIMATION_ID_START_ROLL=31;gu.ANIMATION_ID_ROLL=32;let U4=gu;class F4 extends yb{constructor(){super(...arguments),this._needsTransform=!0}transformGifTextures(e){if(!this._gifCollection)return;const t=this._gifCollection.textures;if(t.length){for(let s=0;s<t.length;s++){const r=t[s];if(!r||!this.getAsset(`${this._imageUrl}_${s}`))continue;const a=1.1,l=new Or,c=e.width/r.width;switch(this.direction){case 2:l.a=c,l.b=-.5*c,l.c=0,l.d=c*a,l.tx=0,l.ty=.5*c*r.width;break;case 0:case 4:l.a=c,l.b=.5*c,l.c=0,l.d=c*a,l.tx=0,l.ty=0;break;default:l.a=c,l.b=0,l.c=0,l.d=c,l.tx=0,l.ty=0}const u=new jt(r),h=Hi.create({width:e.width+l.tx,height:e.height+l.ty});Us.instance.renderer.render(u,{renderTexture:h,clear:!0,transform:l}),this.asset.disposeAsset(`${this._imageUrl}_${s}`),this.asset.addAsset(`${this._imageUrl}_${s}`,h,!0,e.x,e.y,e.flipH,e.flipV)}this._needsTransform=!1}}generateTransformedImage(e,t){const r=new Or,i=t.width/e.width;switch(this.direction){case 2:r.a=i,r.b=-.5*i,r.c=0,r.d=i*1.1,r.tx=0,r.ty=.5*i*e.width;break;case 0:case 4:r.a=i,r.b=.5*i,r.c=0,r.d=i*1.1,r.tx=0,r.ty=0;break;default:r.a=i,r.b=0,r.c=0,r.d=i,r.tx=0,r.ty=0}const a=new jt(e),l=Hi.create({width:t.width+r.tx,height:t.height+r.ty});Us.instance.renderer.render(a,{renderTexture:l,clear:!0,transform:r}),this.asset.disposeAsset(`${this._imageUrl}_0`),this.asset.addAsset(`${this._imageUrl}_0`,l,!0,a.x,a.y,t.flipH,t.flipV),this._needsTransform=!1}checkAndCreateImageForCurrentState(){super.checkAndCreateImageForCurrentState(),this._needsTransform=!0}getSpriteAssetName(e,t){return this.getLayerTag(e,this._direction,t)===bE.BRANDED_IMAGE&&this._imageUrl?(this._needsTransform&&(this._isAnimated?this.transformGifTextures(this.getAsset(super.getSpriteAssetName(e,t))):this.generateTransformedImage(Fr().getTexture(this._imageUrl),this.getAsset(super.getSpriteAssetName(e,t)))),`${this._imageUrl}_${this.getFrameNumber(e,t)}`):super.getSpriteAssetName(e,t)}}class Df extends Zn{constructor(){super(),this._avatarData=new Zh}dispose(){super.dispose(),this._avatarData&&(this._avatarData.dispose(),this._avatarData=null)}createAvatarImage(e,t,s=null,r=null,i=null){return this._avatarData.createAvatarImage(e,t,s,r,i)}set avatarManager(e){this._avatarData.avatarManager=e}}const Pb=class Ih extends Uo{constructor(){super(),this._mannequinScale=-1,this._figure=null,this._gender=null,this._dynamicAssetName=null,this._needsUpdate=!1,this._placeHolderFigure="hd-99999-99998",this._disposed=!1}initialize(e){return e instanceof Df?super.initialize(e):!1}dispose(){this._disposed||(this._disposed=!0,this._dynamicAssetName&&this.asset&&(this.asset.disposeAsset(this._dynamicAssetName),this._dynamicAssetName=null),super.dispose())}updateObject(e,t){const s=super.updateObject(e,t);return s&&this._mannequinScale!==e&&(this._mannequinScale=e,this.updateAvatar()),s}updateModel(e){let t=super.updateModel(e);if(t){const s=this.object.model.getValue(C.FURNITURE_MANNEQUIN_FIGURE)||null;s&&(this._figure=s+"."+this._placeHolderFigure,this._gender=this.object.model.getValue(C.FURNITURE_MANNEQUIN_GENDER)||null,this.updateAvatar())}return t=t||this._needsUpdate,this._needsUpdate=!1,t}updateAvatar(e=!1){if(!this.avatarExists()||e){const t=this.data.createAvatarImage(this._figure,this._mannequinScale,this._gender,this);t&&(t.setDirection(bs.FULL,this.direction),this._dynamicAssetName&&this.asset.disposeAsset(this._dynamicAssetName),this.asset.addAsset(this.getAvatarAssetName(),t.getImage(bs.FULL,!1,1,!1),!0),this._dynamicAssetName=this.getAvatarAssetName(),this._needsUpdate=!0,t.dispose())}}avatarExists(){return this._figure&&this.getAsset(this.getAvatarAssetName())!==null}getAvatarAssetName(){return"mannequin_"+this._figure+"_"+this._mannequinScale+"_"+this.direction+"_"+this.object.id}resetFigure(e){e===this._figure&&this.updateAvatar(!0)}getSpriteAssetName(e,t){const s=this.getLayerTag(e,this.direction,t);return this._figure&&s===Ih.AVATAR_IMAGE_SPRITE_TAG&&this.avatarExists()?this.getAvatarAssetName():super.getSpriteAssetName(e,t)}getLayerXOffset(e,t,s){return this.getLayerTag(e,t,s)===Ih.AVATAR_IMAGE_SPRITE_TAG&&this.avatarExists()?-this.getSprite(s).width/2:super.getLayerXOffset(e,t,s)}getLayerYOffset(e,t,s){return this.getLayerTag(e,t,s)===Ih.AVATAR_IMAGE_SPRITE_TAG&&this.avatarExists()?-this.getSprite(s).height:super.getLayerYOffset(e,t,s)}get disposed(){return this._disposed}get data(){return this._data}};Pb.AVATAR_IMAGE_SPRITE_TAG="avatar_image";let x4=Pb;const Zl=class lo extends Ss{constructor(){super(),this._animOffsetIndex=[]}updateAnimation(e){this._animSpeedIndex||this.initItems(e);let t=this.getSprite(2);return t&&(this._animOffsetIndex[0]=this.getNewPoint(e,0)),t=this.getSprite(3),t&&(this._animOffsetIndex[1]=this.getNewPoint(e,1)),super.updateAnimation(e)}getNewPoint(e,t){let s=0,r=this._animPhaseIndex[t],i=this._animDirectionIndex[t];const a=this._animSpeedIndex[t],l=this._animFactorIndex[t];let c=1;e==32?(s=lo.AREA_DIAMETER_SMALL,c=.5):s=lo.AREA_DIAMETER_LARGE;const u=r+i*a;Math.abs(u)>=s&&(i>0?r=r-(u-s):r=r+(-s-u),i=-i,this._animDirectionIndex[t]=i);const h=(s-Math.abs(r))*l;let d=i*Math.sin(Math.abs(r/4))*h;return i>0?d=d-h:d=d+h,r=r+i*a*c,this._animPhaseIndex[t]=r,Math.trunc(d)==0&&(this._animFactorIndex[t]=this.getRandomAmplitudeFactor()),new Ii(r,d)}initItems(e){let t;e===32?t=lo.AREA_DIAMETER_SMALL:t=lo.AREA_DIAMETER_LARGE,this._animPhaseIndex=[],this._animPhaseIndex.push(Math.random()*t*1.5),this._animPhaseIndex.push(Math.random()*t*1.5),this._animDirectionIndex=[],this._animDirectionIndex.push(1),this._animDirectionIndex.push(-1),this._animSpeedIndex=[],this._animSpeedIndex.push(lo.ANIM_SPEED_FAST),this._animSpeedIndex.push(lo.ANIM_SPEED_SLOW),this._animFactorIndex=[],this._animFactorIndex.push(this.getRandomAmplitudeFactor()),this._animFactorIndex.push(this.getRandomAmplitudeFactor())}getLayerXOffset(e,t,s){return(s===2||s===3)&&this._animOffsetIndex.length==2?this._animOffsetIndex[s-2].x:super.getLayerXOffset(e,t,s)}getLayerYOffset(e,t,s){return(s===2||s===3)&&this._animOffsetIndex.length==2?this._animOffsetIndex[s-2].y:super.getLayerYOffset(e,t,s)}getRandomAmplitudeFactor(){return Math.random()*30/100+.15}};Zl.UPDATE_INTERVAL=2;Zl.AREA_DIAMETER_SMALL=15;Zl.AREA_DIAMETER_LARGE=31;Zl.ANIM_SPEED_FAST=2;Zl.ANIM_SPEED_SLOW=1;let w4=Zl;const Lb=class Ub{constructor(e,t,s,r,i,a){this._name=e,this._index=t,this._radius=s,this._arcSpeed=r*Math.PI*2/360,this._arcOffset=i*Math.PI*2/360,this._height=a,this._position=0,this._positionVector=new F(0,0,0),this._children=[]}dispose(){for(;this._children.length>0;)this._children.shift().dispose()}update(e,t,s){this._position=this._position+this._arcSpeed/Ub.SYSTEM_TEMPO,e[this._index]=this.getPositionVector(t,s);for(const r of this._children)r.update(e,this._positionVector,s)}getPositionVector(e,t){const s=this._radius*Math.cos(this._position+this._arcOffset),r=this._radius*Math.sin(this._position+this._arcOffset);return this._positionVector.x=(s-r)*(t/2),this._positionVector.y=(r+s)*(t/2)*.5-this._height*(t/2),this._positionVector.z=-Math.trunc(4*(s+r)-.7),e&&this._positionVector.add(e),this._positionVector}addChild(e){this._children.indexOf(e)>=0||this._children.push(e)}hasChild(e){return!!this.getChild(e)}getChild(e){for(const t of this._children){if(t.name===e)return t;if(t.hasChild(e))return t.getChild(e)}return null}get name(){return this._name}};Lb.SYSTEM_TEMPO=30;let G4=Lb;class B4 extends Ss{constructor(){super(),this._offsetArray=[],this._rootPosition=new F}dispose(){if(this._planetIndex)for(;this._planetIndex.length>0;)this._planetIndex.shift().dispose();this._planetIndex=null,this._planetNameIndex=null}updateAnimation(e){if(!this._planetIndex&&this.spriteCount>0&&!this.processPlanets())return 0;if(this._planetIndex){for(const t of this._planetIndex)t.update(this._offsetArray,this._rootPosition,e);return super.updateAnimation(e)}return 0}getLayerXOffset(e,t,s){return this._offsetArray[s]?this._offsetArray[s].x:super.getLayerXOffset(e,t,s)}getLayerYOffset(e,t,s){return this._offsetArray[s]?this._offsetArray[s].y:super.getLayerYOffset(e,t,s)}getLayerZOffset(e,t,s){return this._offsetArray[s]?this._offsetArray[s].z:super.getLayerZOffset(e,t,s)}processPlanets(){if(!this.object||!this.object.model)return;const e=this.object.model.getValue(C.FURNITURE_PLANETSYSTEM_DATA);if(!e)return!1;this._planetIndex=[],this._planetNameIndex=[];for(const t of e)this.getSprite(t.id)&&this.addPlanet(t.name,t.id,t.parent,t.radius||0,t.arcSpeed||0,t.arcOffset||0,t.height||0);return!0}addPlanet(e,t,s,r,i,a,l){if(!this._planetIndex)return;const c=new G4(e,t,r,i,a,l),u=this.getPlanet(s);u?u.addChild(c):(this._planetIndex.push(c),this._planetNameIndex.push(e))}getPlanet(e){for(const t of this._planetIndex){if(t.name===e)return t;if(t.hasChild(e))return t.getChild(e)}return null}}class k4 extends Ss{}const fu=class Th extends Ss{constructor(){super(),this._stateQueue=[],this._animationCounter=-1}setAnimation(e){return e===Th.ANIMATION_ID_ROLL_ONCE&&(this._stateQueue=[],this._stateQueue.push(Th.ANIMATION_ID_NORMAL),this._animationCounter=Th.ANIMATION_DURATION),super.setAnimation(e)}updateAnimation(e){return this._animationCounter>0&&this._animationCounter--,this._animationCounter||this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(e)}usesAnimationResetting(){return!0}};fu.ANIMATION_ID_ROLL=3;fu.ANIMATION_ID_ROLL_ONCE=2;fu.ANIMATION_ID_NORMAL=1;fu.ANIMATION_DURATION=15;let V4=fu;class H4 extends Ss{usesAnimationResetting(){return!0}}class j4 extends bE{imageReady(e,t){super.imageReady(e,t),e&&this.setImageOffset(e.width,e.height)}setImageOffset(e,t){const s=new pb;s.setDirection(1,0,-t),s.setDirection(3,0,0),s.setDirection(5,-e,0),s.setDirection(7,-e,-t),s.setDirection(4,-e/2,-t/2),this._imageOffset=s}getLayerXOffset(e,t,s){if(this._imageOffset){const r=this._imageOffset.getXOffset(t,0);if(r!==void 0)return r+this._offsetX}return super.getLayerXOffset(e,t,s)+this._offsetX}getLayerYOffset(e,t,s){if(this._imageOffset){const r=this._imageOffset.getYOffset(t,0);if(r!==void 0)return r+this._offsetY}return super.getLayerYOffset(e,t,s)+this._offsetY}getLayerZOffset(e,t,s){return super.getLayerZOffset(e,t,s)+-this._offsetZ}getLayerIgnoreMouse(e,t,s){return!0}}const mu=class Sc extends Ss{getFrameNumber(e,t){const s=this.getLayerTag(e,this.direction,t),r=this.object.getState(0);switch(s){case Sc.ONES_SPRITE:return Math.floor(r%10);case Sc.TENS_SPRITE:return Math.floor(r/10%10);case Sc.HUNDREDS_SPRITE:return Math.floor(r/100%10);case Sc.THOUSANDS_SPRITE:return Math.floor(r/1e3%10);default:return super.getFrameNumber(e,t)}}};mu.ONES_SPRITE="ones_sprite";mu.TENS_SPRITE="tens_sprite";mu.HUNDREDS_SPRITE="hundreds_sprite";mu.THOUSANDS_SPRITE="thousands_sprite";let W4=mu;class Y4 extends Ss{constructor(){super(...arguments),this._internalFrameIncreaseCounter=0}updateAnimations(e){return this._internalFrameIncreaseCounter=this._internalFrameIncreaseCounter+this.object.model.getValue(C.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED),this._frameIncrease=this._internalFrameIncreaseCounter,this._internalFrameIncreaseCounter=this._internalFrameIncreaseCounter-this._frameIncrease,super.updateAnimations(e)}}class z4 extends Uo{getLayerColor(e,t,s){return this._data?this._data.getLayerColor(e,t,s):Vc.DEFAULT_COLOR}}const $l=class bi extends Ss{constructor(){super(),this._stateQueue=[],this._running=!1,super.setAnimation(bi.ANIMATION_ID_OFF)}setAnimation(e){if(e===0&&!this._running){this._running=!0,this._stateQueue=[],this._stateQueue.push(bi.ANIMATION_ID_START_ROLL),this._stateQueue.push(bi.ANIMATION_ID_ROLL);return}if(e>0&&e<=bi.ANIMATION_ID_OFFSET_SLOW2){if(this._running){this._running=!1,this._stateQueue=[],this.direction===2?(this._stateQueue.push(bi.ANIMATION_ID_OFFSET_SLOW1+5),this._stateQueue.push(bi.ANIMATION_ID_OFFSET_SLOW2+5)):(this._stateQueue.push(bi.ANIMATION_ID_OFFSET_SLOW1+e),this._stateQueue.push(bi.ANIMATION_ID_OFFSET_SLOW2+e)),this._stateQueue.push(bi.ANIMATION_ID_OFF);return}super.setAnimation(bi.ANIMATION_ID_OFF)}}updateAnimation(e){return this.getLastFramePlayed(11)&&this._stateQueue.length&&super.setAnimation(this._stateQueue.shift()),super.updateAnimation(e)}};$l.ANIMATION_ID_OFFSET_SLOW1=20;$l.ANIMATION_ID_OFFSET_SLOW2=10;$l.ANIMATION_ID_START_ROLL=31;$l.ANIMATION_ID_ROLL=32;$l.ANIMATION_ID_OFF=30;let K4=$l;const Eu=class Ia extends Ss{updateObject(e,t){return super.updateObject(e,t),!0}getFrameNumber(e,t){const s=this.object.model.getValue(C.FURNITURE_VOTE_COUNTER_COUNT);switch(this.getLayerTag(e,this.direction,t)){case Ia.ONES_SPRITE:return s%10;case Ia.TENS_SPRITE:return s/10%10;case Ia.HUNDREDS_SPRITE:return s/100%10;default:return super.getFrameNumber(e,t)}}getLayerAlpha(e,t,s){if(this.object.model.getValue(C.FURNITURE_VOTE_COUNTER_COUNT)===Ia.HIDE_COUNTER_SCORE)switch(this.getLayerTag(e,t,s)){case Ia.ONES_SPRITE:case Ia.TENS_SPRITE:case Ia.HUNDREDS_SPRITE:return 0}return super.getLayerAlpha(e,t,s)}};Eu.ONES_SPRITE="ones_sprite";Eu.TENS_SPRITE="tens_sprite";Eu.HUNDREDS_SPRITE="hundreds_sprite";Eu.HIDE_COUNTER_SCORE=-1;let X4=Eu;const ec=class Ln extends Ss{getFrameNumber(e,t){const s=this.object.model.getValue(C.FURNITURE_VOTE_MAJORITY_RESULT);switch(this.getLayerTag(e,this.direction,t)){case Ln.ONES_SPRITE:return s%10;case Ln.TENS_SPRITE:return s/10%10;case Ln.HUNDREDS_SPRITE:return s/100%10;default:return super.getFrameNumber(e,t)}}getLayerAlpha(e,t,s){const r=this.object.model.getValue(C.FURNITURE_VOTE_MAJORITY_RESULT);if(Ln.HIDE_RESULTS_STATES.indexOf(this.object.getState(0))!==-1||r===Ln.HIDE_RESULTS_VALUE)switch(this.getLayerTag(e,t,s)){case Ln.ONES_SPRITE:case Ln.TENS_SPRITE:case Ln.HUNDREDS_SPRITE:return 0}return super.getLayerAlpha(e,t,s)}};ec.ONES_SPRITE="ones_sprite";ec.TENS_SPRITE="tens_sprite";ec.HUNDREDS_SPRITE="hundreds_sprite";ec.HIDE_RESULTS_STATES=[-1,1];ec.HIDE_RESULTS_VALUE=-1;let q4=ec;class Q4 extends Ss{}const Fb=class xb extends vb{getThumbnailURL(){if(!this.object)return null;const e=this.object.model.getValue(C.FURNITURE_DATA);return e&&e[xb.THUMBNAIL_URL]||null}};Fb.THUMBNAIL_URL="THUMBNAIL_URL";let J4=Fb;class Z4{constructor(e){this._sprite=new jt(e),this._texture=null,this._amount=-1,this._alpha=0}renderBubble(e){if(!this._sprite||this._amount===e)return null;const t=new di;t.addChild(this._sprite);const s=new iU("+"+e,{fontFamily:"Arial",fontSize:9,fill:16777215,align:"center"});return s.anchor.x=.5,s.x=this._sprite.width/2,s.y=19,t.addChild(s),this._texture?Us.instance.renderer.render(t,{renderTexture:this._texture,clear:!0}):this._texture=ht.generateTexture(t),this._texture}get amount(){return this._amount}set amount(e){this._amount=e}get alpha(){return this._alpha}set alpha(e){this._alpha=e}}class wb extends ME{constructor(){super(),this._isAllowedToTurnHead=!0}createSizeData(e,t,s){return e>1?new oc(t,s):new $h(t,s)}defineVisualizations(e){return this._isAllowedToTurnHead=!0,super.defineVisualizations(e)}processVisualElement(e,t,s){if(!e||!t||!s)return!1;switch(t){case"postures":if(!(e instanceof oc)||!e.processPostures(s))return!1;break;case"gestures":if(!(e instanceof oc)||!e.processGestures(s))return!1;break;default:if(!super.processVisualElement(e,t,s))return!1;break}return!0}postureToAnimation(e,t){const s=this.getSizeData(e);return s?s.postureToAnimation(t):oc.DEFAULT}getGestureDisabled(e,t){const s=this.getSizeData(e);return s?s.getGestureDisabled(t):!1}gestureToAnimation(e,t){const s=this.getSizeData(e);return s?s.gestureToAnimation(t):oc.DEFAULT}animationToPosture(e,t,s){const r=this.getSizeData(e);return r?r.animationToPosture(t,s):null}animationToGesture(e,t){const s=this.getSizeData(e);return s?s.animationToGesture(t):null}getGestureForAnimationId(e,t){const s=this.getSizeData(e);return s?s.getGestureForAnimationId(t):null}totalPostures(e){const t=this.getSizeData(e);return t?t.totalPostures:0}totalGestures(e){const t=this.getSizeData(e);return t?t.totalGestures:0}get isAllowedToTurnHead(){return this._isAllowedToTurnHead}}const Ki=class Js extends Ss{constructor(){for(super(),this._posture="",this._gesture="",this._isSleeping=!1,this._headDirection=-1,this._headOnly=!1,this._nonHeadSprites=[],this._headSprites=[],this._saddleSprites=[],this._animationOver=!1,this._paletteIndex=-1,this._paletteName="",this._customLayerIds=[],this._customPartIds=[],this._customPaletteIds=[],this._isRiding=!1,this._color=16777215,this._experience=0,this._experienceTimestamp=0,this._experienceData=null,this._previousAnimationDirection=-1,this._animationStates=[];this._animationStates.length<Js.ANIMATION_INDEX_COUNT;)this._animationStates.push(new Ob)}initialize(e){if(!(e instanceof wb))return!1;const t=this.getPetAdditionAsset(Js.PET_EXPERIENCE_BUBBLE);return t&&(this._experienceData=new Z4(t)),super.initialize(e)}dispose(){if(super.dispose(),this._animationStates){for(;this._animationStates.length;){const e=this._animationStates[0];e&&e.dispose(),this._animationStates.pop()}this._animationStates=null}}getAnimationId(e){return e.animationId}update(e,t,s,r){super.update(e,t,s,r),this.updateExperienceBubble(t)}updateExperienceBubble(e){if(this._experienceData&&(this._experienceData.alpha=0,this._experienceTimestamp)){const t=e-this._experienceTimestamp;t<Js.EXPERIENCE_BUBBLE_VISIBLE_IN_MS?this._experienceData.alpha=Math.sin(t/Js.EXPERIENCE_BUBBLE_VISIBLE_IN_MS*Math.PI)*255:this._experienceTimestamp=0;const s=this.getSprite(this.totalSprites-1);if(s){if(this._experienceData.alpha>0){const r=this._experienceData.renderBubble(this._experience);if(r){s.texture=r,s.offsetX=-20,s.offsetY=-80,s.alpha=this._experienceData.alpha,s.visible=!0,s.relativeDepth=-.2;return}}s.texture=null,s.visible=!1}}}updateModel(e){const t=this.object&&this.object.model;if(!t||this.updateModelCounter===t.updateCounter)return!1;const s=t.getValue(C.FIGURE_POSTURE),r=t.getValue(C.FIGURE_GESTURE);this.setPostureAndGesture(s,r);let i=t.getValue(C.FURNITURE_ALPHA_MULTIPLIER)||null;(i===null||isNaN(i))&&(i=1),this._alphaMultiplier!==i&&(this._alphaMultiplier=i,this._alphaChanged=!0),this._isSleeping=t.getValue(C.FIGURE_SLEEP)>0;const a=t.getValue(C.HEAD_DIRECTION);!isNaN(a)&&this.data.isAllowedToTurnHead?this._headDirection=a:this._headDirection=this.object.getDirection().x,this._experience=t.getValue(C.FIGURE_GAINED_EXPERIENCE),this._experienceTimestamp=t.getValue(C.FIGURE_EXPERIENCE_TIMESTAMP);const l=t.getValue(C.PET_PALETTE_INDEX),c=t.getValue(C.PET_CUSTOM_LAYER_IDS),u=t.getValue(C.PET_CUSTOM_PARTS_IDS),h=t.getValue(C.PET_CUSTOM_PALETTE_IDS),d=t.getValue(C.PET_IS_RIDING),f=t.getValue(C.PET_HEAD_ONLY),E=t.getValue(C.PET_COLOR);return l!==this._paletteIndex&&(this._paletteIndex=l,this._paletteName=this._paletteIndex.toString()),this._customLayerIds=c||[],this._customPartIds=u||[],this._customPaletteIds=h||[],this._isRiding=!isNaN(d)&&d>0,this._headOnly=!isNaN(f)&&f>0,!isNaN(E)&&this._color!==E&&(this._color=E),this.updateModelCounter=t.updateCounter,!0}updateAnimation(e){if(this.object){const t=this.object.getDirection().x;t!==this._previousAnimationDirection&&(this._previousAnimationDirection=t,this.resetAllAnimationFrames())}return super.updateAnimation(e)}setPostureAndGesture(e,t){this.data&&(e!==this._posture&&(this._posture=e,this.setAnimationForIndex(Js.POSTURE_ANIMATION_INDEX,this.data.postureToAnimation(this._scale,e))),this.data.getGestureDisabled(this._scale,e)&&(t=null),t!==this._gesture&&(this._gesture=t,this.setAnimationForIndex(Js.GESTURE_ANIMATION_INDEX,this.data.gestureToAnimation(this._scale,t))))}getAnimationStateData(e){return e>=0&&e<this._animationStates.length?this._animationStates[e]:null}setAnimationForIndex(e,t){const s=this.getAnimationStateData(e);s&&this.setSubAnimation(s,t)&&(this._animationOver=!1)}resetAllAnimationFrames(){this._animationOver=!1;let e=this._animationStates.length-1;for(;e>=0;){const t=this._animationStates[e];t&&t.setLayerCount(this.animatedLayerCount),e--}}updateAnimations(e){if(this._animationOver)return 0;let t=!0,s=0,r=0;for(;r<this._animationStates.length;){const i=this._animationStates[r];if(i&&!i.animationOver){const a=this.updateFramesForAnimation(i,e);s=s|a,i.animationOver?(Ws.isTransitionFromAnimation(i.animationId)||Ws.isTransitionToAnimation(i.animationId))&&(this.setAnimationForIndex(r,i.animationAfterTransitionId),t=!1):t=!1}r++}return this._animationOver=t,s}getSpriteAssetName(e,t){if(this._headOnly&&this.isNonHeadSprite(t)||this._isRiding&&this._parser3(t))return null;const s=this.totalSprites;if(t<s-Js.ADDITIONAL_SPRITE_COUNT){const r=this.getValidSize(e);if(t<s-(1+Js.ADDITIONAL_SPRITE_COUNT)){if(t>=Zn.LAYER_LETTERS.length)return null;const i=Zn.LAYER_LETTERS[t];return r===1?this._type+"_icon_"+i:this._type+"_"+r+"_"+i+"_"+this.getDirection(e,t)+"_"+this.getFrameNumber(r,t)}return this._type+"_"+r+"_sd_"+this.getDirection(e,t)+"_0"}return null}getLayerColor(e,t,s){return t<this.totalSprites-Js.ADDITIONAL_SPRITE_COUNT?this._color:16777215}getLayerXOffset(e,t,s){let r=super.getLayerXOffset(e,t,s),i=this._animationStates.length-1;for(;i>=0;){const a=this._animationStates[i];if(a){const l=a.getFrame(s);l&&(r+=l.x)}i--}return r}getLayerYOffset(e,t,s){let r=super.getLayerYOffset(e,t,s),i=this._animationStates.length-1;for(;i>=0;){const a=this._animationStates[i];if(a){const l=a.getFrame(s);l&&(r+=l.y)}i--}return r}getLayerZOffset(e,t,s){return this.data?this.data.getLayerZOffset(e,this.getDirection(e,s),s):vt.DEFAULT_ZOFFSET}getDirection(e,t){return this.isHeadSprite(t)?this.data.getValidDirection(e,this._headDirection):this._direction}getFrameNumber(e,t){let s=this._animationStates.length-1;for(;s>=0;){const r=this._animationStates[s];if(r){const i=r.getFrame(t);if(i)return i.id}s--}return super.getFrameNumber(e,t)}isHeadSprite(e){if(this._headSprites[e]===void 0){const t=this.data.getLayerTag(this._scale,fo.USE_DEFAULT_DIRECTION,e)===Js.HEAD,s=this.data.getLayerTag(this._scale,fo.USE_DEFAULT_DIRECTION,e)===Js.HAIR;t||s?this._headSprites[e]=!0:this._headSprites[e]=!1}return this._headSprites[e]}isNonHeadSprite(e){if(this._nonHeadSprites[e]===void 0)if(e<this.totalSprites-(1+Js.ADDITIONAL_SPRITE_COUNT)){const t=this.data.getLayerTag(this._scale,fo.USE_DEFAULT_DIRECTION,e);t&&t.length>0&&t!==Js.HEAD&&t!==Js.HAIR?this._nonHeadSprites[e]=!0:this._nonHeadSprites[e]=!1}else this._nonHeadSprites[e]=!0;return this._nonHeadSprites[e]}_parser3(e){return this._saddleSprites[e]===void 0&&(this.data.getLayerTag(this._scale,fo.USE_DEFAULT_DIRECTION,e)===Js.SADDLE?this._saddleSprites[e]=!0:this._saddleSprites[e]=!1),this._saddleSprites[e]}getAsset(e,t=-1){if(!this.asset)return null;const s=this._customLayerIds.indexOf(t);let r=this._paletteName,i=-1,a=-1;return s>-1&&(i=this._customPartIds[s],a=this._customPaletteIds[s],r=a>-1?a.toString():this._paletteName),!isNaN(i)&&i>-1&&(e=e+"_"+i),this.asset.getAssetWithPalette(e,r)}getAdditionalLayerCount(){return super.getAdditionalLayerCount()+Js.ADDITIONAL_SPRITE_COUNT}setLayerCount(e){super.setLayerCount(e),this._headSprites=[]}getPostureForAsset(e,t){const s=t.split("_");let r=s.length,i=0;for(;i<s.length;){if(s[i]==="64"||s[i]==="32"){r=i+3;break}i++}let a=null;if(r<s.length){let l=s[r];l=l.split("@")[0],a=this.data.animationToPosture(e,parseInt(l)/100,!1),a||(a=this.data.getGestureForAnimationId(e,parseInt(l)/100))}return a}getPetAdditionAsset(e){return Fr().getTexture(e)}get data(){return this._data}};Ki.TYPE=re.PET_ANIMATED;Ki.HEAD="head";Ki.SADDLE="saddle";Ki.HAIR="hair";Ki.ADDITIONAL_SPRITE_COUNT=1;Ki.EXPERIENCE_BUBBLE_VISIBLE_IN_MS=1e3;Ki.PET_EXPERIENCE_BUBBLE="avatar_addition_pet_experience_bubble";Ki.POSTURE_ANIMATION_INDEX=0;Ki.GESTURE_ANIMATION_INDEX=1;Ki.ANIMATION_INDEX_COUNT=2;let $4=Ki;class PE{constructor(e,t=-1,s=1,r=-1,i=1){this._normalMinX=t,this._normalMaxX=s,this._normalMinY=r,this._normalMaxY=i,this._asset=e}get asset(){return this._asset}get normalMinX(){return this._normalMinX}get normalMaxX(){return this._normalMaxX}get normalMinY(){return this._normalMinY}get normalMaxY(){return this._normalMaxY}dispose(){this._asset=null}}PE.MIN_NORMAL_COORDINATE_VALUE=-1;PE.MAX_NORMAL_COORDINATE_VALUE=1;class mo{constructor(){this._bitmaps=[]}dispose(){for(const e of this._bitmaps)e&&e.dispose();this._bitmaps=null}addBitmap(e,t=-1,s=1,r=-1,i=1){this._bitmaps.push(new PE(e,t,s,r,i))}getAsset(e){if(!e)return null;for(const t of this._bitmaps)if(t&&e.x>=t.normalMinX&&e.x<=t.normalMaxX&&e.y>=t.normalMinY&&e.y<=t.normalMaxY)return t.asset;return null}}mo.MIN_NORMAL_COORDINATE_VALUE=-1;mo.MAX_NORMAL_COORDINATE_VALUE=1;class eX{constructor(){this._sizes=[],this._maskVisualizations=new Map,this._assetNames=new Map,this._lastMaskVisualization=null,this._lastSize=-1}dispose(){if(this._maskVisualizations){for(const e of this._maskVisualizations.values())e&&e.dispose();this._maskVisualizations=null}this._lastMaskVisualization=null,this._sizes=null}createMaskVisualization(e){if(this._maskVisualizations.get(e))return null;const s=new mo;return this._maskVisualizations.set(e,s),this._sizes.push(e),this._sizes.sort(),s}getSizeIndex(e){let t=0,s=1;for(;s<this._sizes.length;){if(this._sizes[s]>e){this._sizes[s]-e<e-this._sizes[s-1]&&(t=s);break}t=s,s++}return t}getMaskVisualization(e){if(e===this._lastSize)return this._lastMaskVisualization;const t=this.getSizeIndex(e);return t<this._sizes.length?this._lastMaskVisualization=this._maskVisualizations.get(this._sizes[t]):this._lastMaskVisualization=null,this._lastSize=e,this._lastMaskVisualization}getGraphicAsset(e,t){const s=this.getMaskVisualization(e);return s?s.getAsset(t):null}getAssetName(e){return this._assetNames&&this._assetNames.get(e)||null}setAssetName(e,t){this._assetNames&&this._assetNames.set(e,t)}}class tX{constructor(){this._assetCollection=null,this._masks=new Map,this._data=null}get data(){return this._data}dispose(){if(this._assetCollection=null,this._data=null,this._masks&&this._masks.size){for(const e of this._masks.values())e&&e.dispose();this._masks.clear()}}initialize(e){this._data=e}initializeAssetCollection(e){this.data&&(this._assetCollection=e,this.parseMasks(this.data,e))}parseMasks(e,t){if(!(!e||!t)&&e.masks&&e.masks.length){let s=0;for(;s<e.masks.length;){const r=e.masks[s];if(r){const i=r.id;if(this._masks.get(i))continue;const l=new eX;if(r.visualizations&&r.visualizations.length){let c=0;for(;c<r.visualizations.length;){const u=r.visualizations[c];if(u){const h=u.size,d=l.createMaskVisualization(h);if(d){const f=this.parseMaskBitmaps(u.bitmaps,d,t);l.setAssetName(h,f)}}c++}}this._masks.set(i,l)}s++}}}parseMaskBitmaps(e,t,s){if(!e||!e.length)return null;let r=null;for(const i of e){if(!i)continue;const a=i.assetName,l=s.getAsset(a);if(!l)continue;let c=mo.MIN_NORMAL_COORDINATE_VALUE,u=mo.MAX_NORMAL_COORDINATE_VALUE,h=mo.MIN_NORMAL_COORDINATE_VALUE,d=mo.MAX_NORMAL_COORDINATE_VALUE;i.normalMinX!==void 0&&(c=i.normalMinX),i.normalMaxX!==void 0&&(u=i.normalMaxX),i.normalMinY!==void 0&&(h=i.normalMinY),i.normalMaxY!==void 0&&(d=i.normalMaxY),l.flipH||(r=a),t.addBitmap(l,c,u,h,d)}return r}updateMask(e,t,s,r,i,a){const l=this._masks.get(t);if(!l)return!0;const c=l.getGraphicAsset(s,r);if(!c)return!0;const u=c.texture;if(!u)return!0;const h=new Fe(i+c.offsetX,a+c.offsetY),d=new Or;let f=1,E=1,m=0,R=0,I=h.x+m,S=h.y+R;return c.flipH&&(f=-1,m=u.width,I=h.x+m-u.width),c.flipV&&(E=-1,R=u.height,S=h.y+R-u.height),d.scale(f,E),d.translate(I,S),Us.instance.renderer.render(new es(u),{renderTexture:e,clear:!1,transform:d}),!0}getMask(e){return!this._masks||!this._masks.size?null:this._masks.get(e)||null}}class Cc{constructor(e=null,t=0,s=!1){this._assetNames=[],this._maskAssetNames=[],this._maskAssetLocations=[],this._maskAssetFlipHs=[],this._maskAssetFlipVs=[],e!=null&&(this._maskAssetNames=e._maskAssetNames,this._maskAssetLocations=e._maskAssetLocations,this._maskAssetFlipHs=e._maskAssetFlipHs,this._maskAssetFlipVs=e._maskAssetFlipVs),this._color=t,this._alignBottom=s}addMask(e,t,s,r){this._maskAssetNames.push(e),this._maskAssetLocations.push(t),this._maskAssetFlipHs.push(s),this._maskAssetFlipVs.push(r)}addAssetColumn(e){this._assetNames.push(e)}set z(e){this._z=e}get z(){return this._z}set cornerPoints(e){this._points=e}get cornerPoints(){return this._points}get color(){return this._color}get maskAssetNames(){return this._maskAssetNames}get maskAssetLocations(){return this._maskAssetLocations}get maskAssetFlipHs(){return this._maskAssetFlipHs}get maskAssetFlipVs(){return this._maskAssetFlipVs}isBottomAligned(){return this._alignBottom}get assetNameColumns(){return this._assetNames}}class sX{constructor(e,t,s,r,i){this._x=e,this._y=t,this._speedX=s,this._speedY=r,this._asset=i,isNaN(this._x)&&(this._x=0),isNaN(this._y)&&(this._y=0),isNaN(this._speedX)&&(this._speedX=0),isNaN(this._speedY)&&(this._speedY=0)}get bitmapData(){return this._asset}dispose(){this._asset=null}getPosition(e,t,s,r,i){let a=this._x,l=this._y;s>0&&(a=a+this._speedX/s*i/1e3),r>0&&(l=l+this._speedY/r*i/1e3);const c=Math.trunc(a%1*e),u=Math.trunc(l%1*t);return new Fe(c,u)}}const vl=class Gb{constructor(e,t,s,r=0){this._material=e,this._offset=r,this._align=s,this._color=t,this._isDisposed=!1}get offset(){return this._offset}get align(){return this._align}get disposed(){return this._isDisposed}dispose(){this._isDisposed=!0,this._material=null,this.clearCache()}clearCache(){}render(e,t,s,r,i,a,l,c,u){const h=this._color>>16,d=this._color>>8&255,f=this._color&255,E=h<255||d<255||f<255;if(this._material){const m=this._material.render(e,t,E?null:s,r,i,a,l,c,u+this.offset,this.align===Gb.ALIGN_TOP);if(m&&E){const R=new es(m);E&&(R.tint=this._color),t.writeToRenderTexture(R,s,!1)}}else{const m=t.createAndFillRenderTexture(r,i,e,this._color);t.writeToRenderTexture(new es(m),s,!1)}return s}getMaterial(){return this._material}getColor(){return this._color}};vl.DEFAULT_OFFSET=0;vl.ALIGN_TOP=1;vl.ALIGN_BOTTOM=2;vl.ALIGN_DEFAULT=vl.ALIGN_TOP;let dn=vl;class rX{constructor(e,t,s){this._layers=[],this._geometry=s,this._cachedBitmapNormal=new F,this._isCached=!1,this._hasAnimationLayers=!1,t<0&&(t=0);let r=0;for(;r<t;)this._layers.push(null),r++}get geometry(){return this._geometry}get hasAnimationLayers(){return this._hasAnimationLayers}dispose(){if(this._layers&&this._layers.length){for(const e of this._layers)e&&e.dispose();this._layers=null}this._geometry=null,this._cachedBitmapNormal&&(this._cachedBitmapNormal=null)}clearCache(){if(this._isCached){if(this._cachedBitmapNormal&&this._cachedBitmapNormal.assign(new F),this._layers&&this._layers.length)for(const e of this._layers){if(!e)continue;e.clearCache()}this._isCached=!1}}setLayer(e,t,s,r,i=0){if(e<0||e>this._layers.length)return!1;let a=this._layers[e];return a&&a.dispose(),a=new dn(t,s,r,i),this._layers[e]=a,!0}setAnimationLayer(e,t,s){if(e<0||e>this._layers.length)return!1;let r=this._layers[e];return r&&r.dispose(),r=new xp(t,s),this._layers[e]=r,this._hasAnimationLayers=!0,!0}getLayers(){return this._layers}render(e,t,s,r,i,a,l,c=0,u=0,h=0,d=0,f=0,E=0,m=0){r<1&&(r=1),i<1&&(i=1),(!s||s.width!==r||s.height!==i)&&(s=null),this._isCached=!0;const R=t.createAndFillRenderTexture(r,i,e);if(this._cachedBitmapNormal.assign(a),this._layers&&this._layers.length)for(const I of this._layers)I&&(I instanceof dn?I.render(`${e}:${this._layers.indexOf(I)}`,t,R,r,i,a,l,c,u):I instanceof xp&&I.render(t,R,r,i,a,c,u,h,d,f,E,m));return R}}class LE{constructor(){this._planeVisualizations=new Map,this._sizes=[],this._lastPlaneVisualization=null,this._lastSize=-1}isStatic(e){return!0}dispose(){for(const e of this._planeVisualizations.values())e&&e.dispose();this._planeVisualizations=null,this._lastPlaneVisualization=null,this._sizes=null,this._lastSize=-1}clearCache(){for(const e of this._planeVisualizations.values())e&&e.clearCache()}createPlaneVisualization(e,t,s){if(this._planeVisualizations.get(e.toString()))return null;const i=new rX(e,t,s);return this._planeVisualizations.set(e.toString(),i),this._sizes.push(e),this._sizes.sort(),i}getSizeIndex(e){let t=0,s=1;for(;s<this._sizes.length;){if(this._sizes[s]>e){this._sizes[s]-e<e-this._sizes[s-1]&&(t=s);break}t=s,s++}return t}getPlaneVisualization(e){if(e===this._lastSize)return this._lastPlaneVisualization;const t=this.getSizeIndex(e);return t<this._sizes.length?this._lastPlaneVisualization=this._planeVisualizations.get(this._sizes[t].toString()):this._lastPlaneVisualization=null,this._lastSize=e,this._lastPlaneVisualization}getLayers(){return this.getPlaneVisualization(this._lastSize).getLayers()}}class Ro extends LE{render(e,t,s,r,i,a,l,c,u,h){const d=this.getPlaneVisualization(a);if(!d||!d.geometry)return null;const f=d.geometry.getScreenPoint(new F(0,0,0)),E=d.geometry.getScreenPoint(new F(0,i/d.geometry.scale,0)),m=d.geometry.getScreenPoint(new F(r/d.geometry.scale,0,0));let R=0,I=0;if(f&&E&&m){r=Math.round(Math.abs(f.x-m.x)),i=Math.round(Math.abs(f.x-E.x));const S=f.x-d.geometry.getScreenPoint(new F(1,0,0)).x;R=u*Math.trunc(Math.abs(S)),I=h*Math.trunc(Math.abs(S))}return d.render(e,t,s,r,i,l,c,R,I)}}Ro.DEFAULT_COLOR=16777215;Ro.HORIZONTAL_ANGLE_DEFAULT=45;Ro.VERTICAL_ANGLE_DEFAULT=30;class ed{constructor(e,t){this._texture=e,this._timeStamp=t}dispose(){this._texture=null}get texture(){return this._texture}get timeStamp(){return this._timeStamp}}const Qd=class Zs{constructor(){this._seed=1,this._modulus=16777216,this._multiplier=69069,this._increment=5}static setSeed(e=1){Zs._randomizer||(Zs._randomizer=new Zs),Zs._randomizer.seed=e}static setModulus(e=16777216){Zs._randomizer||(Zs._randomizer=new Zs),Zs._randomizer.modulus=e}static getValues(e,t,s){return Zs._randomizer||(Zs._randomizer=new Zs),Zs._randomizer.getRandomValues(e,t,s)}static getArray(e,t){return Zs._randomizer||(Zs._randomizer=new Zs),Zs._randomizer.getRandomArray(e,t)}set seed(e){this._seed=e}set modulus(e){e<1&&(e=1),this._modulus=e}dispose(){}getRandomValues(e,t,s){const r=[];let i=0;for(;i<e;)r.push(this.iterateScaled(t,s-t)),i++;return r}getRandomArray(e,t){if(e>t||t>1e3)return null;const s=[];let r=0;for(;r<=t;)s.push(r),r++;const i=[];let a=0;for(;a<e;){const l=this.iterateScaled(0,s.length-1);i.push(s[l]),s.splice(l,1),a++}return i}iterate(){let e=tP(Math.trunc(this._multiplier*this._seed)+this._increment);return e<0&&(e=-e),e=e%this._modulus,this._seed=e,e}iterateScaled(e,t){let s=this.iterate();return t<1?e:(s=Math.trunc(e+s/this._modulus*t),s)}};Qd.DEFAULT_SEED=1;Qd.DEFAULT_MODULUS=16777216;Qd._randomizer=null;let bl=Qd;const Fo=class Ta{constructor(e,t,s=1){if(this._cells=[],this._repeatMode=s,this._width=e<1?1:e,this._cachedBitmapData=null,this._cachedBitmapNormal=null,this._cachedBitmapDataOffsetX=0,this._cachedBitmapDataOffsetY=0,this._isCached=!1,this._isStatic=!0,t&&t.length){let r=0;for(;r<t.length;){const i=t[r];i&&(this._cells.push(i),i.isStatic||(this._isStatic=!1)),r++}}}get isStatic(){return this._isStatic}isRepeated(){return this._repeatMode!==Ta.REPEAT_MODE_NONE}get width(){return this._width}dispose(){if(this._cells&&this._cells.length){for(const e of this._cells)e&&e.dispose();this._cells=null}this._cachedBitmapData=null,this._cachedBitmapNormal&&(this._cachedBitmapNormal=null)}clearCache(){if(this._isCached){if(this._cachedBitmapData&&(this._cachedBitmapData=null),this._cachedBitmapNormal&&(this._cachedBitmapNormal.x=0,this._cachedBitmapNormal.y=0,this._cachedBitmapNormal.z=0),this._cells&&this._cells.length)for(const e of this._cells)e&&e.clearCache();this._isCached=!1}}render(e,t,s,r,i,a){if(this._repeatMode===Ta.REPEAT_MODE_NONE&&(s=this.getCellsHeight(this._cells,r)),this._cachedBitmapNormal||(this._cachedBitmapNormal=new F),this.isStatic){if(this._cachedBitmapData){if(this._cachedBitmapData.height===s&&F.isEqual(this._cachedBitmapNormal,r)&&this._cachedBitmapDataOffsetX===i&&this._cachedBitmapDataOffsetY===a)return this._cachedBitmapData;this._cachedBitmapData=null}}else this._cachedBitmapData=null;if(this._isCached=!0,this._cachedBitmapData||(this._cachedBitmapData=t.createRenderTexture(this._width,s,`${e}:column`)),this._cachedBitmapNormal.assign(r),this._cachedBitmapDataOffsetX=i,this._cachedBitmapDataOffsetY=a,!this._cells.length)return this._cachedBitmapData;switch(this._repeatMode){case Ta.REPEAT_MODE_NONE:this.renderRepeatNone(r);break;case Ta.REPEAT_MODE_BORDERS:this.renderRepeatBorders(r);break;case Ta.REPEAT_MODE_CENTER:this.renderRepeatCenter(r);break;case Ta.REPEAT_MODE_FIRST:this.renderRepeatFirst(r);break;case Ta.REPEAT_MODE_LAST:this.renderRepeatLast(r);break;default:this.renderRepeatAll(r,i,a);break}return this._cachedBitmapData}getCellsHeight(e,t){if(!e||!e.length)return 0;let s=0,r=0;for(;r<e.length;){const i=e[r];i&&(s+=i.getHeight(t)),r++}return s}renderCells(e,t,s,r,i=0,a=0){if(!e||!e.length||!this._cachedBitmapData)return t;let l=0;for(;l<e.length;){let c=null;if(s?c=e[l]:c=e[e.length-1-l],c){const u=c.render(r,i,a);if(u&&(s||(t-=u.height),u.y=t,ht.writeToRenderTexture(u,this._cachedBitmapData,!1),s&&(t=t+u.height),s&&t>=this._cachedBitmapData.height||!s&&t<=0))return t}l++}return t}renderRepeatNone(e){!this._cells.length||!this._cachedBitmapData||this.renderCells(this._cells,0,!0,e)}renderRepeatAll(e,t,s){if(!this._cells.length||!this._cachedBitmapData)return;let r=0;for(;r<this._cachedBitmapData.height;)if(r=this.renderCells(this._cells,r,!0,e,t,s),!r)return}renderRepeatBorders(e){if(!this._cells.length||!this._cachedBitmapData)return;const t=[];let s=0,r=1;for(;r<this._cells.length-1;){const c=this._cells[r];if(c){const u=c.getHeight(e);u>0&&(s=s+u,t.push(c))}r++}if(this._cells.length==1){const c=this._cells[0];if(c){const u=c.getHeight(e);u>0&&(s=s+u,t.push(c))}}let i=this._cachedBitmapData.height-s>>1,a=this.renderCells(t,i,!0,e),l=this._cells[0];if(l){const c=[l];for(;i>=0;)i=this.renderCells(c,i,!1,e)}if(l=this._cells[this._cells.length-1],l){const c=[l];for(;a<this._cachedBitmapData.height;)a=this.renderCells(c,a,!0,e)}}renderRepeatCenter(e){if(!this._cells.length||!this._cachedBitmapData)return;const t=[],s=[];let r=0,i=0,a=0;for(;a<this._cells.length>>1;){const u=this._cells[a];if(u){const h=u.getHeight(e);h>0&&(r=r+h,t.push(u))}a++}for(a=(this._cells.length>>1)+1;a<this._cells.length;){const u=this._cells[a];if(u){const h=u.getHeight(e);h>0&&(i=i+h,s.push(u))}a++}let l=0,c=this._cachedBitmapData.height;if(r+i>this._cachedBitmapData.height&&(l=r+i-this._cachedBitmapData.height,c=c+(l-(l>>1))),l==0){const u=this._cells[this._cells.length>>1];if(u){const h=u.getHeight(e);if(h>0){const d=this._cachedBitmapData.height-(r+i),f=Math.ceil(d/h)*h;let E=r-(f-d>>1);const m=E+f,R=[u];for(;E<m;)E=this.renderCells(R,E,!0,e)}}}this.renderCells(t,0,!0,e),this.renderCells(s,c,!1,e)}renderRepeatFirst(e){if(!this._cells.length||!this._cachedBitmapData)return;let t=this.renderCells(this._cells,this._cachedBitmapData.height,!1,e);const s=this._cells[0];if(!s)return;const r=[s];for(;t>=0;)t=this.renderCells(r,t,!1,e)}renderRepeatLast(e){if(!this._cells.length||!this._cachedBitmapData)return;let t=this.renderCells(this._cells,0,!0,e);const s=this._cells[this._cells.length-1];if(!s)return;const r=[s];for(;t<this._cachedBitmapData.height;)t=this.renderCells(r,t,!0,e)}getCells(){return this._cells}};Fo.REPEAT_MODE_NONE=0;Fo.REPEAT_MODE_ALL=1;Fo.REPEAT_MODE_BORDERS=2;Fo.REPEAT_MODE_CENTER=3;Fo.REPEAT_MODE_FIRST=4;Fo.REPEAT_MODE_LAST=5;let Ra=Fo;const Ar=class zr{constructor(e,t=1,s=1,r=-1,i=1,a=-1,l=1){this._repeatMode=1,this._align=1,this._cachedBitmapNormal=null,this._cachedBitmapHeight=0,this._isCached=!1,this._isStatic=!0,this._normalMinX=-1,this._normalMaxX=1,this._normalMinY=-1,this._normalMaxY=1,this._columns=[],e<1&&(e=1);let c=0;for(;c<e;)this._columns.push(null),c++;this._repeatMode=t,this._align=s,this._normalMinX=r,this._normalMaxX=i,this._normalMinY=a,this._normalMaxY=l,this._repeatMode===zr.REPEAT_MODE_RANDOM&&(this._isStatic=!1)}static nextRandomColumnIndex(e){return bl.getValues(1,0,e*17631)[0]%e}get normalMinX(){return this._normalMinX}get normalMaxX(){return this._normalMaxX}get normalMinY(){return this._normalMinY}get normalMaxY(){return this._normalMaxY}isBottomAligned(){return this._align===zr.ALIGN_BOTTOM}get isStatic(){return this._isStatic}dispose(){this._cachedBitmapNormal&&(this._cachedBitmapNormal=null)}clearCache(){if(this._isCached){if(this._cachedBitmapNormal&&(this._cachedBitmapNormal.x=0,this._cachedBitmapNormal.y=0,this._cachedBitmapNormal.z=0),this._columns&&this._columns.length)for(const e of this._columns)e&&e.clearCache();this._isCached=!1}}createColumn(e,t,s,r=1){if(e<0||e>=this._columns.length)return!1;const i=new Ra(t,s,r),a=this._columns[e];return a&&a.dispose(),this._columns[e]=i,i&&!i.isStatic&&(this._isStatic=!1),!0}render(e,t,s,r,i,a,l,c,u,h){if(r<1&&(r=1),i<1&&(i=1),this._cachedBitmapNormal||(this._cachedBitmapNormal=new F),this.isStatic){if(this._cachedBitmapData){if(this._cachedBitmapData.baseTexture&&this._cachedBitmapData.width===r&&this._cachedBitmapData.height===i&&F.isEqual(this._cachedBitmapNormal,a))return s?(this.copyCachedBitmapOnCanvas(s,this._cachedBitmapHeight,u,h),s):this._cachedBitmapData;this._cachedBitmapData=null}}else this._cachedBitmapData=null;if(this._isCached=!0,this._cachedBitmapNormal.assign(a),!l)return this._cachedBitmapHeight=i,this._cachedBitmapData?t.clearAndFillRenderTexture(this._cachedBitmapData):this._cachedBitmapData=t.createAndFillRenderTexture(r,i,`${e}:matrix`),this._cachedBitmapData;this._cachedBitmapData||(this._cachedBitmapHeight=i,this._cachedBitmapData=t.createRenderTexture(r,i,`${e}:matrix`),t.clearRenderTexture(this._cachedBitmapData));const d=[];let f=0;for(;f<this._columns.length;){const m=this._columns[f];if(m){const R=m.render(e,t,i,a,c,u);R&&d.push(R)}f++}if(!d.length)return s||this._cachedBitmapData;let E=0;switch(this._repeatMode){case zr.REPEAT_MODE_BORDERS:me.log("REPEAT_MODE_BORDERS");break;case zr.REPEAT_MODE_CENTER:me.log("REPEAT_MODE_CENTER");break;case zr.REPEAT_MODE_FIRST:me.log("REPEAT_MODE_FIRST");break;case zr.REPEAT_MODE_LAST:me.log("REPEAT_MODE_LAST");break;case zr.REPEAT_MODE_RANDOM:E=this.renderRepeatRandom(this._cachedBitmapData,d);break;default:E=this.renderRepeatAll(this._cachedBitmapData,d);break}return this._cachedBitmapHeight=E,s?(this.copyCachedBitmapOnCanvas(s,E,u,h),s):this._cachedBitmapData}copyCachedBitmapOnCanvas(e,t,s,r){if(!e||!this._cachedBitmapData||e===this._cachedBitmapData)return;r||(s=e.height-t-s);let i=null;this._align===zr.ALIGN_TOP?i=new Gr(0,0,this._cachedBitmapData.width,this._cachedBitmapHeight):i=new Gr(0,this._cachedBitmapData.height-this._cachedBitmapHeight,this._cachedBitmapData.width,this._cachedBitmapHeight);const a=new Hi(this._cachedBitmapData.baseTexture,i),l=new es(a);l.position.set(0,s),ht.writeToRenderTexture(l,e,!1)}getColumnsWidth(e){if(!e||!e.length)return 0;let t=0;for(const s of e)s&&(t+=s.width);return t}renderColumns(e,t,s,r){if(!e||!t||!t.length)return new Fe(s,0);let i=0,a=0;for(;a<t.length;){const l=r?t[a]:t[t.length-1-a];if(l){r||(s=s-l.width);let c=0;this._align==zr.ALIGN_BOTTOM&&(c=e.height-l.height);const u=new es(l);if(u.position.set(s,c),ht.writeToRenderTexture(u,e,!1),l.height>i&&(i=l.height),r&&(s=s+l.width),r&&s>=e.width||!r&&s<=0)return new Fe(s,i)}a++}return new Fe(s,i)}renderRepeatAll(e,t){if(!e||!t||!t.length)return 0;this.getColumnsWidth(t);let s=0,r=0;for(;s<e.width;){const i=this.renderColumns(e,t,s,!0);if(s=i.x,i.y>r&&(r=i.y),!i.x)return r}return r}renderRepeatRandom(e,t){if(!e||!t||!t.length)return 0;let s=0,r=0;for(;r<e.width;){const i=t[zr.nextRandomColumnIndex(t.length)];if(i!=null){const a=this.renderColumns(e,[i],r,!0);r=a.x,a.y>s&&(s=a.y)}else return s}return s}getColumns(e){if(this._repeatMode===zr.REPEAT_MODE_RANDOM){const t=[];let s=0;for(;s<e;){const r=this._columns[zr.nextRandomColumnIndex(this._columns.length)];if(r)if(t.push(r),r.width>1)s+=r.width;else break;else break}return t}return this._columns}};Ar.REPEAT_MODE_ALL=1;Ar.REPEAT_MODE_BORDERS=2;Ar.REPEAT_MODE_CENTER=3;Ar.REPEAT_MODE_FIRST=4;Ar.REPEAT_MODE_LAST=5;Ar.REPEAT_MODE_RANDOM=6;Ar.REPEAT_MODE_DEFAULT=Ar.REPEAT_MODE_ALL;Ar.MIN_NORMAL_COORDINATE_VALUE=-1;Ar.MAX_NORMAL_COORDINATE_VALUE=1;Ar.ALIGN_TOP=1;Ar.ALIGN_BOTTOM=2;Ar.ALIGN_DEFAULT=Ar.ALIGN_TOP;let ir=Ar;class UE{constructor(){this._planeMaterialItems=[],this._isCached=!1}dispose(){if(this._planeMaterialItems&&this._planeMaterialItems.length){for(const e of this._planeMaterialItems)e&&e.dispose();this._planeMaterialItems=null}this._isCached=!1}clearCache(){if(this._isCached){if(this._planeMaterialItems&&this._planeMaterialItems.length)for(const e of this._planeMaterialItems)e&&e.clearCache();this._isCached=!1}}addMaterialCellMatrix(e,t,s,r=-1,i=1,a=-1,l=1){const c=new ir(e,t,s,r,i,a,l);return this._planeMaterialItems.push(c),c}getMaterialCellMatrix(e){if(!e)return null;if(this._planeMaterialItems&&this._planeMaterialItems.length){for(const t of this._planeMaterialItems)if(t&&e.x>=t.normalMinX&&e.x<=t.normalMaxX&&e.y>=t.normalMinY&&e.y<=t.normalMaxY)return t}return null}render(e,t,s,r,i,a,l,c,u,h){r<1&&(r=1),i<1&&(i=1);const d=this.getMaterialCellMatrix(a);return d?(this._isCached=!0,d.render(e,t,s,r,i,a,l,c,u,h)):null}}UE.MIN_NORMAL_COORDINATE_VALUE=-1;UE.MAX_NORMAL_COORDINATE_VALUE=1;class iX{constructor(e,t=null,s=null,r=0){if(this._extraItemCount=0,this._texture=e,this._extraItemOffsets=[],this._extraItemAssets=[],this._extraItemCount=0,t&&t.length&&r>0){let i=0;for(;i<t.length;){const a=t[i];a&&this._extraItemAssets.push(a),i++}if(this._extraItemAssets.length){if(s){let a=0;for(;a<s.length;){const l=s[a];l&&this._extraItemOffsets.push(new Fe(l.x,l.y)),a++}}this._extraItemCount=r}}}get isStatic(){return this._extraItemCount===0}dispose(){this._texture&&(this._texture.dispose(),this._texture=null),this._extraItemAssets=null,this._extraItemOffsets=null,this._extraItemCount=0}clearCache(){}getHeight(e){if(this._texture){const t=this._texture.getBitmap(e);if(t)return t.height}return 0}render(e,t,s){if(!this._texture)return null;const r=this._texture.getBitmap(e);if(!r)return null;const i=new nU(r,r.width,r.height);if(t!==0||s!==0){for(;t<0;)t+=r.width;for(;s<0;)s+=r.height;i.tilePosition.set(t%r.width,s%r.height),i.uvRespectAnchor=!0,t&&(i.anchor.x=1,i.scale.x=-1),s&&(i.anchor.y=1,i.scale.y=-1)}if(!this.isStatic){const a=Math.min(this._extraItemCount,this._extraItemOffsets.length),l=Math.max(this._extraItemCount,this._extraItemOffsets.length),c=bl.getArray(this._extraItemCount,l);let u=0;for(;u<a;){const h=this._extraItemOffsets[c[u]],d=this._extraItemAssets[u%this._extraItemAssets.length];if(h&&d){const f=d.texture;if(f){let E=d.offsetX,m=d.offsetY,R=1,I=1,S=0,A=0;d.flipH&&(R=-1,S=f.width,E=-(d.width+d.x)),d.flipV&&(I=-1,A=f.height,m=-(d.height+d.y));const N=new Fe(h.x+E,h.y+m),L=new Or;let M=N.x+S;M=M>>1<<1,L.scale(R,I),L.translate(M,N.y+A);const b=new es(f);b.transform.setFromMatrix(L),i.addChild(b)}}u++}}return i}getAssetName(e){return this._texture==null?null:this._texture.getAssetName(e)}}class FE{constructor(e,t=-1,s=1,r=-1,i=1,a=null){this._bitmap=e,this._normalMinX=t,this._normalMaxX=s,this._normalMinY=r,this._normalMaxY=i,this._assetName=a}get bitmap(){return this._bitmap}get normalMinX(){return this._normalMinX}get normalMaxX(){return this._normalMaxX}get normalMinY(){return this._normalMinY}get normalMaxY(){return this._normalMaxY}get assetName(){return this._assetName}dispose(){this._bitmap=null}}FE.MIN_NORMAL_COORDINATE_VALUE=-1;FE.MAX_NORMAL_COORDINATE_VALUE=1;class ho{constructor(){this._bitmaps=[]}dispose(){if(this._bitmaps){for(const e of this._bitmaps)e&&e.dispose();this._bitmaps=null}}addBitmap(e,t=-1,s=1,r=-1,i=1,a=null){this._bitmaps.push(new FE(e,t,s,r,i,a))}getBitmap(e){const t=this.getPlaneTextureBitmap(e);return t?t.bitmap:null}getPlaneTextureBitmap(e){if(!e)return null;for(const t of this._bitmaps)if(t&&e.x>=t.normalMinX&&e.x<=t.normalMaxX&&e.y>=t.normalMinY&&e.y<=t.normalMaxY)return t;return null}getAssetName(e){const t=this.getPlaneTextureBitmap(e);return t?t.assetName:null}}ho.MIN_NORMAL_COORDINATE_VALUE=-1;ho.MAX_NORMAL_COORDINATE_VALUE=1;const Bb=class kb{constructor(){this._assetCollection=null,this._textures=new Map,this._materials=new Map,this._planes=new Map,this._geometries=new Map,this._data=null}get data(){return this._data}get assetCollection(){return this._assetCollection}initializeDimensions(e,t){return!0}dispose(){if(this._planes){for(const e of this._planes.values())e&&e.dispose();this._planes=null}if(this._materials&&(this.resetMaterials(),this._materials=null),this._textures&&(this.resetTextures(),this._textures=null),this._geometries){for(const e of this._geometries.values())e&&e.dispose();this._geometries=null}this._data=null,this._assetCollection=null}clearCache(){for(const e of this._planes.values())e&&e.clearCache();for(const e of this._materials.values())e&&e.clearCache()}initialize(e){this._data=e}reinitialize(){this.resetTextures(),this.resetMaterials(),this.initializeAll()}resetMaterials(){for(const e of this._materials.values())e&&e.dispose();this._materials.clear()}resetTextures(){for(const e of this._textures.values())e&&e.dispose();this._textures.clear()}getTexture(e){return this._textures.get(e)}getMaterial(e){return this._materials.get(e)}getPlane(e){return this._planes.get(e)}addPlane(e,t){return t?this._planes.get(e)?!1:(this._planes.set(e,t),!0):!1}initializeAssetCollection(e){this._data&&(this._assetCollection=e,this.initializeAll())}initializeAll(){this._data&&(this.initializeTexturesAndMaterials(),this.initializePlanes())}initializeTexturesAndMaterials(){this._data.textures&&this._data.textures.length&&this.parseTextures(this._data.textures,this.assetCollection),this._data.materials&&this._data.materials.length&&this.parsePlaneMaterials(this._data.materials)}initializePlanes(){}parseTextures(e,t){if(!(!e||!t)&&e.length)for(const s of e){if(!s)continue;const r=s.id;if(!this._textures.get(r)){const i=new ho;if(s.bitmaps&&s.bitmaps.length)for(const a of s.bitmaps){if(!a)continue;const l=a.assetName;let c=ho.MIN_NORMAL_COORDINATE_VALUE,u=ho.MAX_NORMAL_COORDINATE_VALUE,h=ho.MIN_NORMAL_COORDINATE_VALUE,d=ho.MAX_NORMAL_COORDINATE_VALUE;a.normalMinX!==void 0&&(c=a.normalMinX),a.normalMaxX!==void 0&&(u=a.normalMaxX),a.normalMinY!==void 0&&(h=a.normalMinY),a.normalMaxY!==void 0&&(d=a.normalMaxY);const f=t.getAsset(l);if(f){const E=f.texture;if(E){let m=E;f.flipH?m=z0.getFlipHBitmapData(E):m=m.clone(),i.addBitmap(m,c,u,h,d,l)}}}this._textures.set(r,i)}}}parsePlaneMaterials(e){if(!(!e||!e.length))for(const t of e){if(!t)continue;const s=t.id,r=new UE;if(t.matrices&&t.matrices.length)for(const i of t.matrices){if(!i)continue;let a=ir.REPEAT_MODE_DEFAULT,l=ir.ALIGN_DEFAULT,c=ir.MIN_NORMAL_COORDINATE_VALUE,u=ir.MAX_NORMAL_COORDINATE_VALUE,h=ir.MIN_NORMAL_COORDINATE_VALUE,d=ir.MAX_NORMAL_COORDINATE_VALUE;switch(i.normalMinX!==void 0&&(c=i.normalMinX),i.normalMaxX!==void 0&&(u=i.normalMaxX),i.normalMinY!==void 0&&(h=i.normalMinY),i.normalMaxY!==void 0&&(d=i.normalMaxY),i.repeatMode){case"borders":a=ir.REPEAT_MODE_BORDERS;break;case"center":a=ir.REPEAT_MODE_CENTER;break;case"first":a=ir.REPEAT_MODE_FIRST;break;case"last":a=ir.REPEAT_MODE_LAST;break;case"random":a=ir.REPEAT_MODE_RANDOM;break;default:a=ir.REPEAT_MODE_DEFAULT;break}switch(i.align){case"top":l=ir.ALIGN_TOP;break;case"bottom":l=ir.ALIGN_BOTTOM;break;default:l=ir.ALIGN_DEFAULT;break}if(i.columns&&i.columns.length){const f=r.addMaterialCellMatrix(i.columns.length,a,l,c,u,h,d);let E=0;for(;E<i.columns.length;){const m=i.columns[E];m&&this.parsePlaneMaterialCellColumn(m,f,E),E++}}}this._materials.set(s,r)}}parsePlaneMaterialCellColumn(e,t,s){if(!e||!t)return;let r=Ra.REPEAT_MODE_ALL;const i=e.width,a=this.parsePlaneMaterialCells(e);switch(e.repeatMode){case"borders":r=Ra.REPEAT_MODE_BORDERS;break;case"center":r=Ra.REPEAT_MODE_CENTER;break;case"first":r=Ra.REPEAT_MODE_FIRST;break;case"last":r=Ra.REPEAT_MODE_LAST;break;case"none":r=Ra.REPEAT_MODE_NONE;break;default:r=Ra.REPEAT_MODE_ALL;break}t.createColumn(s,i,a,r)}parsePlaneMaterialCells(e){if(!e||!e.cells||!e.cells.length)return null;const t=[];let s=0;for(;s<e.cells.length;){const r=e.cells[s];if(r){const i=r.textureId;let a=null,l=null,c=null,u=0;if(r.extraData){const f=r.extraData.extraItemTypes,E=r.extraData.offsets;f&&E&&f.length&&E.length&&(a=this.parseExtraItemTypes(f),l=this.parseExtraItemOffsets(E),u=l.length,r.extraData.limitMax!==void 0&&(u=r.extraData.limitMax))}if(a&&a.length){c=[];for(const f of a){if(!f)continue;const E=this._assetCollection.getAsset(f);E&&c.push(E)}}const h=this.getTexture(i),d=new iX(h,c,l,u);t.push(d)}s++}return!t||!t.length?null:t}parseExtraItemTypes(e){const t=[];if(e&&e.length){let s=0;for(;s<e.length;){const r=e[s];r&&t.push(r),s++}}return t}parseExtraItemOffsets(e){const t=[];if(e&&e.length){let s=0;for(;s<e.length;){const[r,i]=e[s];t.push(new Fe(r,i)),s++}}return t}getGeometry(e,t,s){t=Math.abs(t),t>90&&(t=90),s=Math.abs(s),s>90&&(s=90);const r=`${e}_${Math.round(t)}_${Math.round(s)}`;let i=this._geometries.get(r);return i||(i=new Cl(e,new F(t,s),new F(-10,0,0)),this._geometries.set(r,i),i)}parseVisualizations(e,t){if(!(!e||!t)&&t&&t.length)for(const s of t){if(!s)continue;const r=s.size;let i=Ro.HORIZONTAL_ANGLE_DEFAULT,a=Ro.VERTICAL_ANGLE_DEFAULT;s.horizontalAngle!==void 0&&(i=s.horizontalAngle),s.verticalAngle!==void 0&&(a=s.verticalAngle);const l=s.allLayers,c=e.createPlaneVisualization(r,l&&l.length||0,this.getGeometry(r,i,a));if(c&&l&&l.length){let u=0;for(;u<l.length;){const h=l[u];if(h){let d=null,f=dn.ALIGN_DEFAULT,E=Ro.DEFAULT_COLOR,m=dn.DEFAULT_OFFSET;h.materialId&&(d=this.getMaterial(h.materialId)),h.color&&(E=h.color),h.offset&&(m=h.offset),h.align&&(h.align==="bottom"?f=dn.ALIGN_BOTTOM:h.align=="top"&&(f=dn.ALIGN_TOP)),c.setLayer(u,d,E,f,m)}u++}}}}render(e,t,s,r,i,a,l,c,u,h=0,d=0,f=0,E=0,m=0){return null}getTextureIdentifier(e,t){return e.toString()}getLayers(e){let t=this.getPlane(e);return t||(t=this.getPlane(kb.DEFAULT)),t.getLayers()}};Bb.DEFAULT="default";let Hc=Bb;class nX extends Hc{initializePlanes(){if(!this.data)return;const e=this.data.planes;e&&e.length&&this.parseFloors(e)}parseFloors(e){if(e)for(const t in e){const s=e[t];if(!s)continue;const r=s.id,i=s.visualizations,a=new Ro;this.parseVisualizations(a,i),this.addPlane(r,a)||a.dispose()}}render(e,t,s,r,i,a,l,c,u,h=0,d=0,f=0,E=0,m=0){let R=this.getPlane(r);if(R||(R=this.getPlane(Hc.DEFAULT)),!R)return null;s&&t.clearAndFillRenderTexture(s);let I=R.render(e,t,s,i,a,l,c,u,h,d);return I&&I!==s&&(I=new Hi(I.baseTexture),!I)?null:new ed(I,-1)}}class Jd extends LE{render(e,t,s,r,i,a,l,c){const u=this.getPlaneVisualization(a);if(!u||!u.geometry)return null;const h=u.geometry.getScreenPoint(new F(0,0,0)),d=u.geometry.getScreenPoint(new F(0,0,i/u.geometry.scale)),f=u.geometry.getScreenPoint(new F(0,r/u.geometry.scale,0));return h&&d&&f&&(r=Math.round(Math.abs(h.x-f.x)),i=Math.round(Math.abs(h.y-d.y))),u.render(e,t,s,r,i,l,c)}}Jd.DEFAULT_COLOR=16777215;Jd.HORIZONTAL_ANGLE_DEFAULT=45;Jd.VERTICAL_ANGLE_DEFAULT=30;class aX extends Hc{initializePlanes(){if(!this.data)return;const e=this.data.planes;e&&e.length&&this.parseWalls(e)}parseWalls(e){if(e)for(const t in e){const s=e[t];if(!s)continue;const r=s.id,i=s.visualizations,a=new Jd;this.parseVisualizations(a,i),this.addPlane(r,a)||a.dispose()}}render(e,t,s,r,i,a,l,c,u,h=0,d=0,f=0,E=0,m=0){let R=this.getPlane(r);if(R||(R=this.getPlane(Hc.DEFAULT)),!R)return null;s&&t.clearAndFillRenderTexture(s);let I=R.render(e,t,s,i,a,l,c,u);return I&&I!==s&&(I=new Hi(I.baseTexture),!I)?null:new ed(I,-1)}getTextureIdentifier(e,t){return t?`${e}_${t.x}_${t.y}_${t.z}`:super.getTextureIdentifier(e,t)}}class Eo extends LE{constructor(){super(...arguments),this._width=0,this._height=0}isStatic(e){const t=this.getPlaneVisualization(e);return t?!t.hasAnimationLayers:super.isStatic(e)}initializeDimensions(e,t){e<0&&(e=0),t<0&&(t=0),(e!==this._width||t!==this._height)&&(this._width=e,this._height=t)}render(e,t,s,r,i,a,l,c,u,h,d,f,E){const m=this.getPlaneVisualization(a);if(!m||!m.geometry)return null;const R=m.geometry.getScreenPoint(new F(0,0,0)),I=m.geometry.getScreenPoint(new F(0,0,1)),S=m.geometry.getScreenPoint(new F(0,1,0));if(R&&I&&S){r=Math.round(Math.abs((R.x-S.x)*r/m.geometry.scale)),i=Math.round(Math.abs((R.y-I.y)*i/m.geometry.scale));const A=Math.trunc(u*Math.abs(R.x-S.x)),N=Math.trunc(h*Math.abs(R.y-I.y)),L=Math.trunc(d*Math.abs(R.x-S.x)),M=Math.trunc(f*Math.abs(R.y-I.y));return m.render(e,t,s,r,i,l,c,A,N,L,M,d,f,E)}return null}}Eo.DEFAULT_COLOR=16777215;Eo.HORIZONTAL_ANGLE_DEFAULT=45;Eo.VERTICAL_ANGLE_DEFAULT=30;const Zd=class rl extends Hc{constructor(){super(...arguments),this._landscapeWidth=0,this._landscapeHeight=0,this._cachedBitmap=null}initializeDimensions(e,t){return e<0&&(e=0),t<0&&(t=0),this._landscapeWidth=e,this._landscapeHeight=t,!0}initializePlanes(){if(!this.data)return;const e=this.data.planes;e&&e.length&&this.parseLandscapes(e)}parseLandscapes(e){if(!e)return;const t=Math.trunc(Math.random()*654321);for(const s in e){const r=e[s];if(!r)continue;const i=r.id,a=r.animatedVisualization,l=new Eo;for(const c of a){if(!c)continue;const u=c.size;let h=Eo.HORIZONTAL_ANGLE_DEFAULT,d=Eo.VERTICAL_ANGLE_DEFAULT;c.horizontalAngle!==void 0&&(h=c.horizontalAngle),c.verticalAngle!==void 0&&(d=c.verticalAngle);const f=c.allLayers.length??0,E=l.createPlaneVisualization(u,f||0,this.getGeometry(u,h,d));if(E){bl.setSeed(t);let m=0;for(;m<f;){const R=c.allLayers[m];if(R){if(R.items===void 0){const I=R;let S=null,A=dn.ALIGN_DEFAULT,N=Eo.DEFAULT_COLOR,L=dn.DEFAULT_OFFSET;I.materialId&&(S=this.getMaterial(I.materialId)),I.color&&(N=I.color),I.offset&&(L=I.offset),I.align&&(I.align==="bottom"?A=dn.ALIGN_BOTTOM:I.align==="top"&&(A=dn.ALIGN_TOP)),E.setLayer(m,S,N,A,L)}else{const S=R.items,A=[];if(S&&S.length){for(const N of S)if(N){N.id;const L=N.assetId,M=this.getCoordinateValue(N.x||"",N.randomX||""),b=this.getCoordinateValue(N.y||"",N.randomY||""),B=N.speedX,w=N.speedY;A.push({asset:L,x:M,y:b,speedX:B,speedY:w})}}E.setAnimationLayer(m,A,this.assetCollection)}m++}}}}this.addPlane(i,l)||l.dispose()}}getCoordinateValue(e,t){let s=0;if(e.length>0&&e.charAt(e.length-1)==="%"&&(e=e.substr(0,e.length-1),s=parseFloat(e)/100),t.length>0){const a=bl.getValues(1,0,1e4)[0]/1e4;t.charAt(t.length-1)==="%"&&(t=t.substr(0,t.length-1),s=s+a*parseFloat(t)/100)}return s}render(e,t,s,r,i,a,l,c,u,h=0,d=0,f=0,E=0,m=0){let R=this.getPlane(r);if(R||(R=this.getPlane(rl.DEFAULT)),!R)return null;s&&t.clearRenderTexture(s);let I=R.render(e,t,s,i,a,l,c,u,h,d,f,E,m);if(I&&I!==s&&(I=new Hi(I.baseTexture),!I))return null;let S=null;return!R.isStatic(l)&&rl.UPDATE_INTERVAL>0?S=new ed(I,Math.round(m/rl.UPDATE_INTERVAL)*rl.UPDATE_INTERVAL+rl.UPDATE_INTERVAL):S=new ed(I,-1),S}getTextureIdentifier(e,t){return t?t.x<0?e+"_0":e+"_1":super.getTextureIdentifier(e,t)}};Zd.LANDSCAPES_ENABLED=!0;Zd.LANDSCAPE_DEFAULT_COLOR=8828617;Zd.UPDATE_INTERVAL=500;let Vb=Zd;class xp{constructor(e,t){if(this._color=0,this._isDisposed=!1,this._color=0,this._isDisposed=!1,this._items=[],e&&t)for(const s of e){if(!s)continue;const r=s.asset;if(r){const i=t.getAsset(r);i&&this._items.push(new sX(s.x,s.y,s.speedX,s.speedY,i))}}}get disposed(){return this._isDisposed}dispose(){if(this._isDisposed=!0,this._items){for(const e of this._items)e&&e.dispose();this._items=[]}}clearCache(){}render(e,t,s,r,i,a,l,c,u,h,d,f){if(c>0&&u>0){let E=0;for(;E<this._items.length;){const m=this._items[E];if(m){const R=m.getPosition(c,u,h,d,f);if(R.x=Math.trunc(R.x-a),R.y=Math.trunc(R.y-l),m.bitmapData){if(R.x>-m.bitmapData.width&&R.x<t.width&&R.y>-m.bitmapData.height&&R.y<t.height){const I=new es(m.bitmapData.texture);I.position.set(R.x,R.y),e.writeToRenderTexture(I,t,!1)}if(R.x-c>-m.bitmapData.width&&R.x-c<t.width&&R.y>-m.bitmapData.height&&R.y<t.height){const I=new es(m.bitmapData.texture);I.position.set(R.x-c,R.y),e.writeToRenderTexture(I,t,!1)}if(R.x>-m.bitmapData.width&&R.x<t.width&&R.y-u>-m.bitmapData.height&&R.y-u<t.height){const I=new es(m.bitmapData.texture);I.position.set(R.x,R.y-u),e.writeToRenderTexture(I,t,!1)}if(R.x-c>-m.bitmapData.width&&R.x-c<t.width&&R.y-u>-m.bitmapData.height&&R.y-u<t.height){const I=new es(m.bitmapData.texture);I.position.set(R.x-c,R.y-u),e.writeToRenderTexture(I,t,!1)}}}E++}}return t}}class wp{constructor(e,t,s){this._type=e,this._leftSideLoc=t,this._rightSideLoc=s}get type(){return this._type}get leftSideLoc(){return this._leftSideLoc}get rightSideLoc(){return this._rightSideLoc}}class Gp{constructor(e,t,s,r){this._leftSideLoc=e,this._rightSideLoc=t,this._leftSideLength=s,this._rightSideLength=r}get leftSideLoc(){return this._leftSideLoc}get rightSideLoc(){return this._rightSideLoc}get leftSideLength(){return this._leftSideLength}get rightSideLength(){return this._rightSideLength}}const xo=class Oa{constructor(e,t,s,r,i,a,l,c,u,h=0,d=0,f=0,E=0){if(this._maskManager=null,this._width=0,this._height=0,this._textureCache=e,this._secondaryNormals=[],this._bitmapMasks=[],this._rectangleMasks=[],this._bitmapMasksOld=[],this._rectangleMasksOld=[],this._randomSeed=u,this._bitmapData=null,this._maskBitmapData=null,this._maskChanged=!1,this._activeTexture=null,this._origin=new F,this._origin.assign(t),this._location=new F,this._location.assign(s),this._leftSide=new F,this._leftSide.assign(r),this._rightSide=new F,this._rightSide.assign(i),this._normal=F.crossProduct(this._leftSide,this._rightSide),this._normal.length>0&&this._normal.multiply(1/this._normal.length),c!=null)for(const m of c){if(!m)continue;const R=new F;R.assign(m),this._secondaryNormals.push(R)}this._disposed=!1,this._isVisible=!1,this._id=null,this._hasTexture=!0,this._geometryUpdateId=-1,this._offset=new Fe,this._relativeDepth=0,this._type=a,this._color=0,this._rasterizer=null,this._canBeVisible=!0,this._cornerA=new F,this._cornerB=new F,this._cornerC=new F,this._cornerD=new F,this._width=0,this._height=0,this._textureOffsetX=h,this._textureOffsetY=d,this._textureMaxX=f,this._textureMaxY=E,this._useMask=l,this._uniqueId=++Oa._uniqueIdCounter}static blend(e,t){return sr.colorize(t,e|4278190080)&16777215}set canBeVisible(e){e!==this._canBeVisible&&(this._canBeVisible||this.resetTextureCache(),this._canBeVisible=e)}get canBeVisible(){return this._canBeVisible}get bitmapData(){return!this.visible||!this._bitmapData?null:this._bitmapData}get maskBitmapData(){return!this.visible||!this._maskBitmapData?null:this._maskBitmapData}get visible(){return this._isVisible&&this._canBeVisible}get offset(){return this._offset}get relativeDepth(){return this._relativeDepth}get color(){return this._color}set color(e){this._color=e}get type(){return this._type}get leftSide(){return this._leftSide}get rightSide(){return this._rightSide}get location(){return this._location}get normal(){return this._normal}get hasTexture(){return this._hasTexture}set hasTexture(e){this._hasTexture=e}set rasterizer(e){this._rasterizer=e}set maskManager(e){this._maskManager=e}set id(e){e!==this._id&&(this.resetTextureCache(),this._id=e)}get uniqueId(){return this._uniqueId}dispose(){this._activeTexture=null,this._location=null,this._origin=null,this._leftSide=null,this._rightSide=null,this._normal=null,this._rasterizer=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._bitmapMasks=null,this._rectangleMasks=null,this._maskPixels=null,this._maskBitmapData&&(this._maskBitmapData.destroy(!0),this._maskBitmapData=null),this._disposed=!0}copyBitmapData(e){return!this.visible||!this._bitmapData||!e||this._bitmapData.width!==e.width||this._bitmapData.height!==e.height?null:e}resetTextureCache(e=null){this._activeTexture=null}getTextureIdentifier(e){return this._rasterizer?this._rasterizer.getTextureIdentifier(e,this.normal):e.toString()}needsNewTexture(e,t){if(!e)return!1;const s=this._activeTexture;return this.updateMaskChangeStatus(),!!(this._canBeVisible&&(!s||s.timeStamp>=0&&t>s.timeStamp||this._maskChanged))}getTexture(e,t){if(!e)return null;let s=null;if(this.needsNewTexture(e,t)){this.getTextureIdentifier(e.scale);const r=this._leftSide.length*e.scale,i=this._rightSide.length*e.scale,a=e.getCoordinatePosition(this._normal);s=this._rasterizer.render(this._uniqueId.toString(),this._textureCache,null,this._id,r,i,e.scale,a,this._hasTexture,this._textureOffsetX,this._textureOffsetY,this._textureMaxX,this._textureMaxY,t),s&&this.updateMask(s.texture,e)}else this._activeTexture&&(s=this._activeTexture);return s?(this._activeTexture=s,s.texture):null}resolveMasks(e){if(!this._useMask)return null;const t=new Cc,s=0;for(;s<this._bitmapMasks.length;){const r=this._bitmapMasks[s];if(r){const i=this._maskManager.getMask(r.type);if(i){const a=i.getAssetName(e.scale);if(a){const l=e.getCoordinatePosition(this._normal),c=i.getGraphicAsset(e.scale,l);if(c){const u=this._maskBitmapData.width*(1-r.leftSideLoc/this._leftSide.length),h=this._maskBitmapData.height*(1-r.rightSideLoc/this._rightSide.length);t.addMask(a,new Fe(u+c.offsetX,h+c.offsetY),c.flipH,c.flipV)}}}}}return t}screenWidth(e){const t=e.getScreenPoint(new F(0,0,0)),s=e.getScreenPoint(new F(0,1,0));return Math.round(this._leftSide.length*Math.abs(t.x-s.x))}getDrawingDatas(e){const t=[];if(this._isVisible){const s=this.resolveMasks(e),r=this._rasterizer.getLayers(this._id);for(const i of r)if(this._hasTexture&&i.getMaterial()){const a=e.getCoordinatePosition(this._normal),l=i.getMaterial().getMaterialCellMatrix(a),c=new Cc(s,Oa.blend(this._color,i.getColor()),l.isBottomAligned());bl.setSeed(this._randomSeed);for(const u of l.getColumns(this.screenWidth(e))){const h=[];for(const d of u.getCells()){const f=d.getAssetName(a);f&&h.push(f)}h.length>0&&(u.isRepeated()||h.push(""),c.addAssetColumn(h))}c.assetNameColumns.length>0&&t.push(c)}else{const a=new Cc(s,Oa.blend(this._color,i.getColor()));t.push(a)}t.length||t.push(new Cc(s,this._color))}return t}update(e,t){if(!e||this._disposed)return!1;let s=!1;if(this._geometryUpdateId!=e.updateId&&(s=!0),(!s||!this._canBeVisible)&&!this.visible)return!1;if(s){this._activeTexture=null;let r=0;if(r=F.cosAngle(e.directionAxis,this.normal),r>-.001)return this._isVisible?(this._isVisible=!1,!0):!1;let i=0;for(;i<this._secondaryNormals.length;){if(r=F.cosAngle(e.directionAxis,this._secondaryNormals[i]),r>-.001)return this._isVisible?(this._isVisible=!1,!0):!1;i++}this.updateCorners(e);const l=e.getScreenPosition(this._origin).z;let c=Math.max(this._cornerA.z,this._cornerB.z,this._cornerC.z,this._cornerD.z)-l;this._type===Oa.TYPE_FLOOR&&(c=c-(this._location.z+Math.min(0,this._leftSide.z,this._rightSide.z))*8),this._type===Oa.TYPE_LANDSCAPE&&(c=c+.02),this._relativeDepth=c,this._isVisible=!0,this._geometryUpdateId=e.updateId}if(s||this.needsNewTexture(e,t)){if(!this._bitmapData||this._width!==this._bitmapData.width||this._height!==this._bitmapData.height){if(this._bitmapData)if(this._width!==this._bitmapData.width||this._height!==this._bitmapData.height){if(this._bitmapData.destroy(),this._bitmapData=null,this._width<1||this._height<1)return!0;this._bitmapData=this._textureCache.createAndFillRenderTexture(this._width,this._height)}else{if(this._width<1||this._height<1)return this._bitmapData.destroy(),this._bitmapData=null,!0;this._textureCache.clearAndFillRenderTexture(this._bitmapData)}else{if(this._width<1||this._height<1)return!1;this._bitmapData=this._textureCache.createAndFillRenderTexture(this._width,this._height)}if(!this._bitmapData)return!1}else this._textureCache.clearAndFillRenderTexture(this._bitmapData);bl.setSeed(this._randomSeed);const r=this.getTexture(e,t);if(r)this.renderTexture(e,r);else return this.dispose(),!1;return r!==null||s}return!1}updateCorners(e){this._cornerA.assign(e.getScreenPosition(this._location)),this._cornerB.assign(e.getScreenPosition(F.sum(this._location,this._rightSide))),this._cornerC.assign(e.getScreenPosition(F.sum(F.sum(this._location,this._leftSide),this._rightSide))),this._cornerD.assign(e.getScreenPosition(F.sum(this._location,this._leftSide))),this._offset=e.getScreenPoint(this._origin),this._cornerA.x=Math.round(this._cornerA.x),this._cornerA.y=Math.round(this._cornerA.y),this._cornerB.x=Math.round(this._cornerB.x),this._cornerB.y=Math.round(this._cornerB.y),this._cornerC.x=Math.round(this._cornerC.x),this._cornerC.y=Math.round(this._cornerC.y),this._cornerD.x=Math.round(this._cornerD.x),this._cornerD.y=Math.round(this._cornerD.y),this._offset.x=Math.round(this._offset.x),this._offset.y=Math.round(this._offset.y);const t=Math.min(this._cornerA.x,this._cornerB.x,this._cornerC.x,this._cornerD.x),s=Math.max(this._cornerA.x,this._cornerB.x,this._cornerC.x,this._cornerD.x)-t,r=Math.min(this._cornerA.y,this._cornerB.y,this._cornerC.y,this._cornerD.y),i=Math.max(this._cornerA.y,this._cornerB.y,this._cornerC.y,this._cornerD.y)-r;this._offset.x=this._offset.x-t,this._cornerA.x=this._cornerA.x-t,this._cornerB.x=this._cornerB.x-t,this._cornerC.x=this._cornerC.x-t,this._cornerD.x=this._cornerD.x-t,this._offset.y=this._offset.y-r,this._cornerA.y=this._cornerA.y-r,this._cornerB.y=this._cornerB.y-r,this._cornerC.y=this._cornerC.y-r,this._cornerD.y=this._cornerD.y-r,this._width=s,this._height=i}getMatrixForDimensions(e,t){let s=this._cornerD.x-this._cornerC.x,r=this._cornerD.y-this._cornerC.y,i=this._cornerB.x-this._cornerC.x,a=this._cornerB.y-this._cornerC.y;(this._type===Oa.TYPE_WALL||this._type===Oa.TYPE_LANDSCAPE)&&(Math.abs(i-e)<=1&&(i=e),Math.abs(a-e)<=1&&(a=e),Math.abs(s-t)<=1&&(s=t),Math.abs(r-t)<=1&&(r=t));const l=i/e,c=a/e,u=s/t,h=r/t,d=new Or(l,c,u,h);return d.translate(this._cornerC.x,this._cornerC.y),d}renderTexture(e,t){this._cornerA==null||this._cornerB==null||this._cornerC==null||this._cornerD==null||t==null||this._bitmapData==null||this.draw(t,this.getMatrixForDimensions(t.width,t.height))}draw(e,t){this._textureCache.writeToRenderTexture(new es(e),this._bitmapData,!0,t)}resetBitmapMasks(){this._disposed||!this._useMask||!this._bitmapMasks.length||(this._maskChanged=!0,this._bitmapMasks=[])}addBitmapMask(e,t,s){if(!this._useMask)return!1;for(const i of this._bitmapMasks)if(i&&i.type===e&&i.leftSideLoc===t&&i.rightSideLoc===s)return!1;const r=new wp(e,t,s);return this._bitmapMasks.push(r),this._maskChanged=!0,!0}resetRectangleMasks(){!this._useMask||!this._rectangleMasks.length||(this._maskChanged=!0,this._rectangleMasks=[])}addRectangleMask(e,t,s,r){if(this._useMask){for(const a of this._rectangleMasks)if(a&&a.leftSideLoc===e&&a.rightSideLoc===t&&a.leftSideLength===s&&a.rightSideLength===r)return!1;const i=new Gp(e,t,s,r);return this._rectangleMasks.push(i),this._maskChanged=!0,!0}return!1}updateMaskChangeStatus(){if(!this._maskChanged)return;let e=!0;if(this._bitmapMasks.length===this._bitmapMasksOld.length)for(const t of this._bitmapMasks){if(!t)continue;let s=!1;for(const r of this._bitmapMasksOld)if(r&&r.type===t.type&&r.leftSideLoc===t.leftSideLoc&&r.rightSideLoc===t.rightSideLoc){s=!0;break}if(!s){e=!1;break}}else e=!1;this._rectangleMasks.length>this._rectangleMasksOld.length&&(e=!1),e&&(this._maskChanged=!1)}updateMask(e,t){if(!e||!t||!this._useMask||!this._bitmapMasks.length&&!this._rectangleMasks.length&&!this._maskChanged||!this._maskManager)return;const s=e.width,r=e.height;if(this.updateMaskChangeStatus(),(!this._maskBitmapData||this._maskBitmapData.width!==s||this._maskBitmapData.height!==r)&&(this._maskBitmapData=this._textureCache.createAndFillRenderTexture(s,r,"mask"),this._maskChanged=!0),this._maskChanged){this._bitmapMasksOld=[],this._rectangleMasksOld=[],this._maskBitmapData&&this._textureCache.clearAndFillRenderTexture(this._maskBitmapData),this.resetTextureCache(e);const i=t.getCoordinatePosition(this._normal);let a=null,l=0,c=0,u=0;for(;u<this._bitmapMasks.length;){const h=this._bitmapMasks[u];h&&(a=h.type,l=this._maskBitmapData.width-this._maskBitmapData.width*h.leftSideLoc/this._leftSide.length,c=this._maskBitmapData.height-this._maskBitmapData.height*h.rightSideLoc/this._rightSide.length,this._maskManager.updateMask(this._maskBitmapData,a,t.scale,i,l,c),this._bitmapMasksOld.push(new wp(a,h.leftSideLoc,h.rightSideLoc))),u++}for(u=0;u<this._rectangleMasks.length;){const h=this._rectangleMasks[u];if(h){l=this._maskBitmapData.width-this._maskBitmapData.width*h.leftSideLoc/this._leftSide.length,c=this._maskBitmapData.height-this._maskBitmapData.height*h.rightSideLoc/this._rightSide.length;const d=this._maskBitmapData.width*h.leftSideLength/this._leftSide.length,f=this._maskBitmapData.height*h.rightSideLength/this._rightSide.length,E=new es(ts.WHITE);E.tint=0,E.width=d,E.height=f,E.position.set(l-d,c-f),this._textureCache.writeToRenderTexture(E,this._maskBitmapData,!1),this._rectangleMasksOld.push(new Gp(h.leftSideLength,h.rightSideLoc,h.leftSideLength,h.rightSideLength))}u++}this._maskPixels=this._textureCache.getPixels(this._maskBitmapData),this._maskChanged=!1}this.combineTextureMask(e,this._maskPixels)}combineTextureMask(e,t){var a,l;if(!e||!t)return;const s=this._textureCache.getPixels(e);for(let c=0;c<s.length;c+=4){const u=t[c],h=t[c+1],d=t[c+2];t[c+3],!u&&!h&&!d&&(s[c+3]=0)}const r=(a=e.baseTexture._glTextures[1])==null?void 0:a.texture,i=(l=Us.instance.renderer)==null?void 0:l.gl;!r||!i||(i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width,e.height,0,i.RGBA,i.UNSIGNED_BYTE,s),i.bindTexture(i.TEXTURE_2D,null))}};xo.ZERO_POINT=new Fe(0,0);xo.TYPE_UNDEFINED=0;xo.TYPE_WALL=1;xo.TYPE_FLOOR=2;xo.TYPE_LANDSCAPE=3;xo._uniqueIdCounter=1;let Mt=xo;class Hb extends Hr{constructor(){super(),this._wallRasterizer=new aX,this._floorRasterizer=new nX,this._landscapeRasterizer=new Vb,this._maskManager=new tX,this._initialized=!1}initialize(e){if(!e.roomVisualization)return!1;const t=e.roomVisualization.wallData;t&&this._wallRasterizer.initialize(t);const s=e.roomVisualization.floorData;s&&this._floorRasterizer.initialize(s);const r=e.roomVisualization.landscapeData;r&&this._landscapeRasterizer.initialize(r);const i=e.roomVisualization.maskData;return i&&this._maskManager.initialize(i),!0}onDispose(){this._wallRasterizer&&(this._wallRasterizer.dispose(),this._wallRasterizer=null),this._floorRasterizer&&(this._floorRasterizer.dispose(),this._floorRasterizer=null),this._landscapeRasterizer&&(this._landscapeRasterizer.dispose(),this._landscapeRasterizer=null),this._maskManager&&(this._maskManager.dispose(),this._maskManager=null),super.onDispose()}setGraphicAssetCollection(e){this._initialized||(this._wallRasterizer.initializeAssetCollection(e),this._floorRasterizer.initializeAssetCollection(e),this._landscapeRasterizer.initializeAssetCollection(e),this._maskManager.initializeAssetCollection(e),this._initialized=!0)}clearCache(){this._wallRasterizer&&this._wallRasterizer.clearCache(),this._floorRasterizer&&this._floorRasterizer.clearCache(),this._landscapeRasterizer&&this._landscapeRasterizer.clearCache()}get wallRasterizer(){return this._wallRasterizer}get floorRasterizer(){return this._floorRasterizer}get landscapeRasterizer(){return this._landscapeRasterizer}get maskManager(){return this._maskManager}}const yi=class js extends Od{constructor(){super(),this._data=null,this._roomPlaneParser=new Hs,this._roomPlaneBitmapMaskParser=new fb,this._geometryUpdateId=-1,this._directionX=0,this._directionY=0,this._directionZ=0,this._floorThickness=1,this._wallThickness=1,this._holeUpdateTime=NaN,this._planes=[],this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[],this._roomScale=0,this._lastUpdateTime=-1e3,this._updateIntervalTime=250,this._wallType=null,this._floorType=null,this._landscapeType=null,this._colorBackgroundOnly=!0,this._color=16777215,this._redColor=255,this._greenColor=255,this._blueColor=255,this._typeVisibility=[],this._assetUpdateCounter=0,this._maskData=null,this._isPlaneSet=!1,this._textureCache=new kU,this._typeVisibility[Mt.TYPE_UNDEFINED]=!1,this._typeVisibility[Mt.TYPE_FLOOR]=!0,this._typeVisibility[Mt.TYPE_WALL]=!0,this._typeVisibility[Mt.TYPE_LANDSCAPE]=!0}initialize(e){return e instanceof Hb?(this._data=e,super.initialize(e),this._data.setGraphicAssetCollection(this.asset),!0):!1}dispose(){super.dispose(),this.clearPlanes(),this._planes=null,this._visiblePlanes=null,this._visiblePlaneSpriteNumbers=null,this._roomPlaneParser&&(this._roomPlaneParser.dispose(),this._roomPlaneParser=null),this._roomPlaneBitmapMaskParser&&(this._roomPlaneBitmapMaskParser.dispose(),this._roomPlaneBitmapMaskParser=null),this._data&&(this._data.clearCache(),this._data=null),this._textureCache&&this._textureCache.clearCache()}reset(){super.reset(),this._floorType=null,this._wallType=null,this._landscapeType=null,this._maskData=null,this._geometryUpdateId=-1,this._roomScale=0}update(e,t,s,r){if(!this.object||!e)return;const i=this.updateGeometry(e),a=this.object.model;let l=!1;if(this.updateThickness(a)&&(l=!0),this.updateHole(a)&&(l=!0),this.initializeRoomPlanes(),l=this.updateMasks(a),!(t<this._lastUpdateTime+this._updateIntervalTime&&!i&&!l)){if(this.updatePlaneTexturesAndVisibilities(a)&&(l=!0),this.updatePlanes(e,i,t)&&(l=!0),l){let c=0;for(;c<this._visiblePlanes.length;){const u=this._visiblePlaneSpriteNumbers[c],h=this.getSprite(u),d=this._visiblePlanes[c];if(h&&d&&d.type!==Mt.TYPE_LANDSCAPE)if(this._colorBackgroundOnly){let f=d.color;const E=(f&255)*this._redColor/255,m=(f>>8&255)*this._greenColor/255,R=(f>>16&255)*this._blueColor/255;f=(f>>24<<24)+(R<<16)+(m<<8)+E,h.color=f}else h.color=d.color;c++}this.updateSpriteCounter++}this.updateModelCounter=a.updateCounter,this._lastUpdateTime=t}}updateGeometry(e){if(!e||this._geometryUpdateId===e.updateId)return!1;this._geometryUpdateId=e.updateId,this._boundingRectangle=null;const t=e.direction;return t&&(t.x!==this._directionX||t.y!==this._directionY||t.z!==this._directionZ||e.scale!==this._roomScale)?(this._directionX=t.x,this._directionY=t.y,this._directionZ=t.z,this._roomScale=e.scale,!0):!1}updateThickness(e){if(this.updateModelCounter===e.updateCounter)return!1;const t=e.getValue(C.ROOM_FLOOR_THICKNESS),s=e.getValue(C.ROOM_WALL_THICKNESS);return!isNaN(t)&&!isNaN(s)&&(t!==this._floorThickness||s!==this._wallThickness)?(this._floorThickness=t,this._wallThickness=s,this.clearPlanes(),!0):!1}updateHole(e){if(this.updateModelCounter===e.updateCounter)return!1;const t=e.getValue(C.ROOM_FLOOR_HOLE_UPDATE_TIME);return!isNaN(t)&&t!==this._holeUpdateTime?(this._holeUpdateTime=t,this.clearPlanes(),!0):!1}updateMasks(e){if(this.updateModelCounter===e.updateCounter)return!1;let t=!1;const s=e.getValue(C.ROOM_PLANE_MASK_XML);s!==this._maskData&&(this.updatePlaneMasks(s),this._maskData=s,t=!0);const r=e.getValue(C.ROOM_BACKGROUND_COLOR);r!==this._color&&(this._color=r,this._redColor=this._color&255,this._greenColor=this._color>>8&255,this._blueColor=this._color>>16&255,t=!0);const i=e.getValue(C.ROOM_COLORIZE_BG_ONLY)||!1;return i!==this._colorBackgroundOnly&&(this._colorBackgroundOnly=i,t=!0),t}updatePlaneTexturesAndVisibilities(e){if(this.updateModelCounter===e.updateCounter)return!1;const t=e.getValue(C.ROOM_FLOOR_TYPE),s=e.getValue(C.ROOM_WALL_TYPE),r=e.getValue(C.ROOM_LANDSCAPE_TYPE),i=e.getValue(C.ROOM_FLOOR_VISIBILITY)===1,a=e.getValue(C.ROOM_WALL_VISIBILITY)===1,l=e.getValue(C.ROOM_LANDSCAPE_VISIBILITY)===1;return this.updatePlaneTypes(t,s,r)||this.updatePlaneVisibility(i,a,l)}clearPlanes(){if(this._planes){for(;this._planes.length;){const e=this._planes[0];e&&e.dispose(),this._planes.pop()}this._planes=[],this._planes=[]}this._isPlaneSet=!1,this._assetUpdateCounter=this._assetUpdateCounter+1,this.reset()}initializeRoomPlanes(){if(!this.object||this._isPlaneSet)return;isNaN(this._floorThickness)||(this._roomPlaneParser.floorThicknessMultiplier=this._floorThickness),isNaN(this._wallThickness)||(this._roomPlaneParser.wallThicknessMultiplier=this._wallThickness);const e=this.object.model.getValue(C.ROOM_MAP_DATA);if(!this._roomPlaneParser.initializeFromMapData(e))return;const t=this.getLandscapeWidth(),s=this.getLandscapeHeight();let r=0,i=this.object.model.getValue(C.ROOM_RANDOM_SEED),a=0;for(;a<this._roomPlaneParser.planeCount;){const l=this._roomPlaneParser.getPlaneLocation(a),c=this._roomPlaneParser.getPlaneLeftSide(a),u=this._roomPlaneParser.getPlaneRightSide(a),h=this._roomPlaneParser.getPlaneSecondaryNormals(a),d=this._roomPlaneParser.getPlaneType(a);let f=null;if(l&&c&&u){const E=F.crossProduct(c,u);if(i=tP(Math.trunc(i*7613+517)>>>0),f=null,d===Yt.PLANE_FLOOR){const m=l.x+c.x+.5,R=l.y+u.y+.5,I=Math.trunc(m)-m,S=Math.trunc(R)-R;f=new Mt(this._textureCache,this.object.getLocation(),l,c,u,Mt.TYPE_FLOOR,!0,h,i,-I,-S),E.z!==0?f.color=js.FLOOR_COLOR:f.color=E.x!==0?js.FLOOR_COLOR_RIGHT:js.FLOOR_COLOR_LEFT,this._data&&(f.rasterizer=this._data.floorRasterizer)}else d===Yt.PLANE_WALL?(f=new Mt(this._textureCache,this.object.getLocation(),l,c,u,Mt.TYPE_WALL,!0,h,i),(c.length<1||u.length<1)&&(f.hasTexture=!1),E.x===0&&E.y===0?f.color=js.WALL_COLOR_BORDER:E.y>0?f.color=js.WALL_COLOR_TOP:E.y===0?f.color=js.WALL_COLOR_SIDE:f.color=js.WALL_COLOR_BOTTOM,this._data&&(f.rasterizer=this._data.wallRasterizer)):d===Yt.PLANE_LANDSCAPE?(f=new Mt(this._textureCache,this.object.getLocation(),l,c,u,Mt.TYPE_LANDSCAPE,!0,h,i,r,0,t,s),E.y>0?f.color=js.LANDSCAPE_COLOR_TOP:E.y==0?f.color=js.LANDSCAPE_COLOR_SIDE:f.color=js.LANDSCAPE_COLOR_BOTTOM,this._data&&(f.rasterizer=this._data.landscapeRasterizer),r=r+c.length):d==Yt.PLANE_BILLBOARD&&(f=new Mt(this._textureCache,this.object.getLocation(),l,c,u,Mt.TYPE_WALL,!0,h,i),(c.length<1||u.length<1)&&(f.hasTexture=!1),E.x==0&&E.y==0?f.color=js.WALL_COLOR_BORDER:E.y>0?f.color=js.WALL_COLOR_TOP:E.y==0?f.color=js.WALL_COLOR_SIDE:f.color=js.WALL_COLOR_BOTTOM);if(f){f.maskManager=this._data.maskManager;let m=0;for(;m<this._roomPlaneParser.getPlaneMaskCount(a);){const R=this._roomPlaneParser.getPlaneMaskLeftSideLoc(a,m),I=this._roomPlaneParser.getPlaneMaskRightSideLoc(a,m),S=this._roomPlaneParser.getPlaneMaskLeftSideLength(a,m),A=this._roomPlaneParser.getPlaneMaskRightSideLength(a,m);f.addRectangleMask(R,I,S,A),m++}this._planes.push(f)}}else return;a++}this._isPlaneSet=!0,this.defineSprites()}defineSprites(){this.createSprites(this._planes.length);let e=0;for(;e<this._planes.length;){const t=this._planes[e],s=this.getSprite(e);t&&s&&t.leftSide&&t.rightSide&&(t.type===Mt.TYPE_WALL&&(t.leftSide.length<1||t.rightSide.length<1)?s.alphaTolerance=Ti.MATCH_NOTHING:s.alphaTolerance=Ti.MATCH_OPAQUE_PIXELS,t.type===Mt.TYPE_WALL?s.tag="plane.wall@"+(e+1):t.type===Mt.TYPE_FLOOR?s.tag="plane.floor@"+(e+1):s.tag="plane@"+(e+1),s.spriteType=Rr.ROOM_PLANE),e++}}getLandscapeWidth(){let e=0,t=0;for(;t<this._roomPlaneParser.planeCount;){if(this._roomPlaneParser.getPlaneType(t)===Yt.PLANE_LANDSCAPE){const r=this._roomPlaneParser.getPlaneLeftSide(t);e+=r.length}t++}return e}getLandscapeHeight(){let e=0,t=0;for(;t<this._roomPlaneParser.planeCount;){if(this._roomPlaneParser.getPlaneType(t)===Yt.PLANE_LANDSCAPE){const r=this._roomPlaneParser.getPlaneRightSide(t);r.length>e&&(e=r.length)}t++}return e>5&&(e=5),e}updatePlaneTypes(e,t,s){if(e!==this._floorType?this._floorType=e:e=null,t!==this._wallType?this._wallType=t:t=null,s!==this._landscapeType?this._landscapeType=s:s=null,!e&&!t&&!s)return!1;let r=0;for(;r<this._planes.length;){const i=this._planes[r];i&&(i.type===Mt.TYPE_FLOOR&&e?i.id=e:i.type===Mt.TYPE_WALL&&t?i.id=t:i.type===Mt.TYPE_LANDSCAPE&&s&&(i.id=s)),r++}return!0}updatePlaneVisibility(e,t,s){return e===this._typeVisibility[Mt.TYPE_FLOOR]&&t===this._typeVisibility[Mt.TYPE_WALL]&&s===this._typeVisibility[Mt.TYPE_LANDSCAPE]?!1:(this._typeVisibility[Mt.TYPE_FLOOR]=e,this._typeVisibility[Mt.TYPE_WALL]=t,this._typeVisibility[Mt.TYPE_LANDSCAPE]=s,this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[],!0)}updatePlanes(e,t,s){if(!e||!this.object)return!1;this._assetUpdateCounter++,t&&(this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[]);const r=this._visiblePlanes.length>0;let i=this._visiblePlanes;this._visiblePlanes.length||(i=this._planes);let a=0,l=!1,c=0;for(;c<i.length;){let u=c;r&&(u=this._visiblePlaneSpriteNumbers[c]);const h=this.getSprite(u);if(h){const d=i[c];d?(h.id=d.uniqueId,d.update(e,s)&&(d.visible&&(a=d.relativeDepth+this.floorRelativeDepth+u/1e3,d.type!==Mt.TYPE_FLOOR&&(a=d.relativeDepth+this.wallRelativeDepth+u/1e3,(d.leftSide.length<1||d.rightSide.length<1)&&(a=a+js.ROOM_DEPTH_OFFSET*.5)),this.updateSprite(h,e,d,`plane ${u} ${e.scale}`,a)),l=!0),h.visible!=(d.visible&&this._typeVisibility[d.type])&&(h.visible=!h.visible,l=!0),h.visible&&(r||(this._visiblePlanes.push(d),this._visiblePlaneSpriteNumbers.push(c)))):(h.id=0,h.visible&&(h.visible=!1,l=!0))}c++}return l}updatePlaneMasks(e){if(!e)return;this._roomPlaneBitmapMaskParser.initialize(e);const t=[],s=[];let r=!1,i=0;for(;i<this._planes.length;){const a=this._planes[i];a&&(a.resetBitmapMasks(),a.type===Mt.TYPE_LANDSCAPE&&t.push(i)),i++}for(const a of this._roomPlaneBitmapMaskParser.masks.values()){const l=this._roomPlaneBitmapMaskParser.getMaskType(a),c=this._roomPlaneBitmapMaskParser.getMaskLocation(a),u=this._roomPlaneBitmapMaskParser.getMaskCategory(a);if(c){let h=0;for(;h<this._planes.length;){const d=this._planes[h];if((d.type===Mt.TYPE_WALL||d.type===Mt.TYPE_LANDSCAPE)&&d&&d.location&&d.normal){const f=F.dif(c,d.location);if(Math.abs(F.scalarProjection(f,d.normal))<.01&&d.leftSide&&d.rightSide){const m=F.scalarProjection(f,d.leftSide),R=F.scalarProjection(f,d.rightSide);d.type===Mt.TYPE_WALL||d.type===Mt.TYPE_LANDSCAPE&&u===Ao.HOLE?d.addBitmapMask(l,m,R):d.type===Mt.TYPE_LANDSCAPE&&(d.canBeVisible||(r=!0),d.canBeVisible=!0,s.push(h))}}h++}}}for(i=0;i<t.length;){const a=t[i];if(s.indexOf(a)<0){const l=this._planes[a];l.canBeVisible=!1,r=!0}i++}r&&(this._visiblePlanes=[],this._visiblePlaneSpriteNumbers=[])}updateSprite(e,t,s,r,i){const a=s.offset;e.offsetX=-a.x,e.offsetY=-a.y,e.relativeDepth=i,e.color=s.color,e.texture=s.bitmapData,e.name=r+"_"+this._assetUpdateCounter}getBoundingRectangle(){return this._boundingRectangle||(this._boundingRectangle=super.getBoundingRectangle()),new Gr(this._boundingRectangle.x,this._boundingRectangle.y,this._boundingRectangle.width,this._boundingRectangle.height)}get planes(){const e=[];for(const t of this._visiblePlanes)e.push(t);return e}get floorRelativeDepth(){return js.ROOM_DEPTH_OFFSET+.1}get wallRelativeDepth(){return js.ROOM_DEPTH_OFFSET+.5}};yi.FLOOR_COLOR=16777215;yi.FLOOR_COLOR_LEFT=14540253;yi.FLOOR_COLOR_RIGHT=12303291;yi.WALL_COLOR_TOP=16777215;yi.WALL_COLOR_SIDE=13421772;yi.WALL_COLOR_BOTTOM=10066329;yi.WALL_COLOR_BORDER=10066329;yi.LANDSCAPE_COLOR_TOP=16777215;yi.LANDSCAPE_COLOR_SIDE=13421772;yi.LANDSCAPE_COLOR_BOTTOM=10066329;yi.ROOM_DEPTH_OFFSET=1e3;let oX=yi;class lX extends Ss{constructor(){super(),this._tileHeight=0}getLayerYOffset(e,t,s){return s===1?(this._tileHeight=this.object.model.getValue(C.TILE_CURSOR_HEIGHT),-this._tileHeight*32):super.getLayerYOffset(e,t,s)}}const jb=class Wb{constructor(){this._visualizationDatas=new Map}getVisualization(e){const t=this.getVisualizationType(e);return t?new t:null}getVisualizationType(e){if(!e)return null;let t=null;switch(e){case re.ROOM:t=oX;break;case re.TILE_CURSOR:t=lX;break;case re.USER:case re.BOT:case re.RENTABLE_BOT:t=p4;break;case re.PET_ANIMATED:t=$4;break;case re.FURNITURE_STATIC:t=Uo;break;case re.FURNITURE_ANIMATED:t=Ss;break;case re.FURNITURE_RESETTING_ANIMATED:t=H4;break;case re.FURNITURE_BADGE_DISPLAY:t=O4;break;case re.FURNITURE_BG:t=j4;break;case re.FURNITURE_BB:t=yb;break;case re.FURNITURE_ISOMETRIC_BB:t=F4;break;case re.FURNITURE_BOTTLE:t=S4;break;case re.FURNITURE_BUILDER_PLACEHOLDER:t=C4;break;case re.FURNITURE_COUNTER_CLOCK:t=A4;break;case re.FURNITURE_CUBOID:t=N4;break;case re.FURNITURE_EXTERNAL_IMAGE:t=y4;break;case re.FURNITURE_FIREWORKS:t=bb;break;case re.FURNITURE_GIFT_WRAPPED_FIREWORKS:t=v4;break;case re.FURNITURE_GIFT_WRAPPED:t=b4;break;case re.FURNITURE_GUILD_CUSTOMIZED:t=P4;break;case re.FURNITURE_GUILD_ISOMETRIC_BADGE:t=L4;break;case re.FURNITURE_HABBOWHEEL:t=U4;break;case re.FURNITURE_MANNEQUIN:t=x4;break;case re.FURNITURE_PARTY_BEAMER:t=w4;break;case re.FURNITURE_PLANET_SYSTEM:t=B4;break;case re.FURNITURE_POSTER:t=k4;break;case re.FURNITURE_QUEUE_TILE:t=V4;break;case re.FURNITURE_SCORE_BOARD:t=W4;break;case re.FURNITURE_SOUNDBLOCK:t=Y4;break;case re.FURNITURE_STICKIE:t=z4;break;case re.FURNITURE_VAL_RANDOMIZER:t=K4;break;case re.FURNITURE_VOTE_COUNTER:t=X4;break;case re.FURNITURE_VOTE_MAJORITY:t=q4;break;case re.FURNITURE_WATER_AREA:t=Q4;break;case re.FURNITURE_YOUTUBE:t=J4;break}return t||(me.log("Unknown Visualization",e),null)}getVisualizationData(e,t,s){const r=this._visualizationDatas.get(e);if(r)return r;let i=null;switch(t){case re.FURNITURE_STATIC:case re.FURNITURE_GIFT_WRAPPED:case re.FURNITURE_BB:case re.FURNITURE_ISOMETRIC_BB:case re.FURNITURE_BG:case re.FURNITURE_STICKIE:case re.FURNITURE_BUILDER_PLACEHOLDER:i=new Zn;break;case re.FURNITURE_ANIMATED:case re.FURNITURE_RESETTING_ANIMATED:case re.FURNITURE_POSTER:case re.FURNITURE_HABBOWHEEL:case re.FURNITURE_VAL_RANDOMIZER:case re.FURNITURE_BOTTLE:case re.FURNITURE_PLANET_SYSTEM:case re.FURNITURE_QUEUE_TILE:case re.FURNITURE_PARTY_BEAMER:case re.FURNITURE_COUNTER_CLOCK:case re.FURNITURE_WATER_AREA:case re.FURNITURE_SCORE_BOARD:case re.FURNITURE_FIREWORKS:case re.FURNITURE_GIFT_WRAPPED_FIREWORKS:case re.FURNITURE_GUILD_CUSTOMIZED:case re.FURNITURE_GUILD_ISOMETRIC_BADGE:case re.FURNITURE_VOTE_COUNTER:case re.FURNITURE_VOTE_MAJORITY:case re.FURNITURE_SOUNDBLOCK:case re.FURNITURE_BADGE_DISPLAY:case re.FURNITURE_EXTERNAL_IMAGE:case re.FURNITURE_YOUTUBE:case re.TILE_CURSOR:i=new ME;break;case re.FURNITURE_MANNEQUIN:i=new Df;break;case re.ROOM:i=new Hb;break;case re.USER:case re.BOT:case re.RENTABLE_BOT:i=new Zh;break;case re.PET_ANIMATED:i=new wb;break}return i?i.initialize(s)?((i instanceof Zh||i instanceof Df)&&(i.avatarManager=pe.instance.avatar),Wb.CACHING_ENABLED&&this._visualizationDatas.set(e,i),i):(i.dispose(),null):null}};jb.CACHING_ENABLED=!0;let cX=jb;class pt{}pt.ROOM_MIN_X="room_min_x";pt.ROOM_MAX_X="room_max_x";pt.ROOM_MIN_Y="room_min_y";pt.ROOM_MAX_Y="room_max_y";pt.ROOM_IS_PUBLIC="room_is_public";pt.ROOM_Z_SCALE="room_z_scale";pt.AD_DISPLAY_DELAY="ad_display_delay";pt.IS_PLAYING_GAME="is_playing_game";pt.RESTRICTS_DRAGGING="restricts_dragging";pt.RESTRICTS_SCALING="restricts_scaling";pt.RESTRICTED_SCALE="room_scale";class uX{constructor(e,t){this._width=e,this._height=t,this._heights=[],this._isNotStackable=[],this._isRoomTile=[];let s=e*t;for(;s>0;)this._heights.push(0),this._isNotStackable.push(!1),this._isRoomTile.push(!1),s--}dispose(){this._width=0,this._height=0,this._height=null,this._isNotStackable=null,this._isRoomTile=null}validPosition(e,t){return e>=0&&e<this._width&&t>=0&&t<this._height}getTileHeight(e,t){return this.validPosition(e,t)?this._heights[t*this._width+e]:0}setTileHeight(e,t,s){this.validPosition(e,t)&&(this._heights[t*this._width+e]=s)}setStackingBlocked(e,t,s){this.validPosition(e,t)&&(this._isNotStackable[t*this._width+e]=s)}setIsRoomTile(e,t,s){this.validPosition(e,t)&&(this._isRoomTile[t*this._width+e]=s)}validateLocation(e,t,s,r,i,a,l,c,u,h=-1){let d=0,f=0;if(!this.validPosition(e,t)||!this.validPosition(e+s-1,t+r-1))return!1;(i<0||i>=this._width)&&(i=0),(a<0||a>=this._height)&&(a=0),l=Math.min(l,this._width-i),c=Math.min(c,this._height-a),h===-1&&(h=this.getTileHeight(e,t));let E=t;for(;E<t+r;){for(d=e;d<e+s;){if(d<i||d>=i+l||E<a||E>=a+c){if(f=E*this._width+d,u){if(!this._isRoomTile[f])return!1}else if(this._isNotStackable[f]||!this._isRoomTile[f]||Math.abs(this._heights[f]-h)>.01)return!1}d++}E++}return!0}get width(){return this._width}get height(){return this._height}}const $d=class Un{constructor(){this._isDisposed=!1,this._scale=64,this._heightMap=[],this._width=0,this._height=0,this._floorHeight=0}get disposed(){return this._isDisposed}get scale(){return this._scale}set scale(e){this._scale=e}dispose(){this.reset(),this._isDisposed=!0}initialize(e,t,s){if(e<=this._width&&t<=this._height){this._width=e,this._height=t,this._floorHeight=s;return}this.reset();let r=0;for(;r<t;){const i=[];this._heightMap.push(i);let a=0;for(;a<e;)i.push(0),a++;r++}this._width=e,this._height=t,this._floorHeight=s}reset(){this._heightMap=[]}setHeight(e,t,s){if(e<0||e>=this._width||t<0||t>=this._height)return!1;const r=this._heightMap[t];return r?(r[e]=s,!0):!1}getHeight(e,t){if(e<0||e>=this._width||t<0||t>=this._height)return 0;const s=this._heightMap[t];return s?s[e]:0}getLocation(e,t,s,r,i){if(e==0&&t==0){e=this._width,t=this._height;const h=Math.round(this.scale/10);if(i==Un.R){let d=this._width-1;for(;d>=0;){let f=1;for(;f<this._height;){if(this.getHeight(d,f)<=this._floorHeight){f-1<t&&(e=d,t=f-1);break}f++}d--}r=r+(this.scale/4-h/2),s=s+this.scale/2}else{let d=this._height-1;for(;d>=0;){let f=1;for(;f<this._width;){if(this.getHeight(f,d)<=this._floorHeight){f-1<e&&(e=f-1,t=d);break}f++}d--}r=r+(this.scale/4-h/2),s=s-h}}let a=e,l=t,c=this.getHeight(e,t);return i==Un.R?(a=a+(s/(this._scale/2)-.5),l=l+.5,c=c-(r-s/2)/(this._scale/2)):(l=l+((this._scale/2-s)/(this._scale/2)-.5),a=a+.5,c=c-(r-(this._scale/2-s)/2)/(this._scale/2)),new F(a,l,c)}getLocationOldFormat(e,t,s){let r,i,a=0,l=0;i=Math.ceil(e),a=i-e;let c,u,h,d=0;for(r=0;r<this._width;){if(i>=0&&i<this._height){if(this.getHeight(r,i)<=this._floorHeight){c=r-1,u=i,l=r,s=Un.L;break}if(this.getHeight(r,i+1)<=this._floorHeight){c=r,u=i,l=u-e,s=Un.R;break}}i++,r++}const f=this.scale/2*a;let E=-l*this.scale/2;return E=E+-t*18/32*this.scale/2,d=this.getHeight(c,u),h=d*this.scale/2+E,s==Un.R?h=h+a*this.scale/4:h=h+(1-a)*this.scale/4,this.getLocation(c,u,f,h,s)}getOldLocation(e,t){if(e==null)return null;let s=0,r=0,i=0,a=0,l="",c=0;if(t==90)s=Math.floor(e.x-.5),r=Math.floor(e.y+.5),c=this.getHeight(s,r),i=this._scale/2-(e.y-r+.5)*(this._scale/2),a=(c-e.z)*(this._scale/2)+(this._scale/2-i)/2,l=Un.L;else if(t==180)s=Math.floor(e.x+.5),r=Math.floor(e.y-.5),c=this.getHeight(s,r),i=(e.x+.5-s)*(this._scale/2),a=(c-e.z)*(this._scale/2)+i/2,l=Un.R;else return null;return[s,r,i,a,l]}getOldLocationString(e,t){const s=this.getOldLocation(e,t);if(s==null)return null;const r=Math.trunc(s[0]),i=Math.trunc(s[1]),a=Math.trunc(s[2]),l=Math.trunc(s[3]),c=s[4];return":w="+r+","+i+" l="+a+","+l+" "+c}getDirection(e){return e==Un.R?180:90}getFloorAltitude(e,t){const s=this.getHeight(e,t),r=s+1;return s+(Math.trunc(this.getHeight(e-1,t-1))==r||Math.trunc(this.getHeight(e,t-1))==r||Math.trunc(this.getHeight(e+1,t-1))==r||Math.trunc(this.getHeight(e-1,t))==r||Math.trunc(this.getHeight(e+1,t))==r||Math.trunc(this.getHeight(e-1,t+1))==r||Math.trunc(this.getHeight(e,t+1))==r||Math.trunc(this.getHeight(e+1,t+1))==r?.5:0)}isRoomTile(e,t){return e>=0&&e<this._width&&t>=0&&t<this._height&&this._heightMap[t][e]>=0}};$d.DEFAULT_SCALE=32;$d.L="l";$d.R="r";let xE=$d;const Yb=class zb{constructor(){this._targetId=-1,this._targetCategory=-2,this._targetLoc=null,this._moveDistance=0,this._previousMoveSpeed=0,this._maintainPreviousMoveSpeed=!1,this._currentLoc=null,this._limitedLocX=!1,this._limitedLocY=!1,this._centeredLocX=!1,this._centeredLocY=!1,this._screenWd=0,this._screenHt=0,this._scale=0,this._roomWd=0,this._roomHt=0,this._geometryUpdateId=-1,this._scaleChanged=!1,this._targetObjectLoc=new F}get location(){return this._currentLoc}get targetId(){return this._targetId}set targetId(e){this._targetId=e}get targetCategory(){return this._targetCategory}set targetCategory(e){this._targetCategory=e}get targetObjectLoc(){return this._targetObjectLoc}set targetObjectLoc(e){this._targetObjectLoc.assign(e)}get limitedLocationX(){return this._limitedLocX}set limitedLocationX(e){this._limitedLocX=e}get limitedLocationY(){return this._limitedLocY}set limitedLocationY(e){this._limitedLocY=e}get centeredLocX(){return this._centeredLocX}set centeredLocX(e){this._centeredLocX=e}get centeredLocY(){return this._centeredLocY}set centeredLocY(e){this._centeredLocY=e}get screenWd(){return this._screenWd}set screenWd(e){this._screenWd=e}get screenHt(){return this._screenHt}set screenHt(e){this._screenHt=e}get scale(){return this._scale}set scale(e){this._scale!=e&&(this._scale=e,this._scaleChanged=!0)}get roomWd(){return this._roomWd}set roomWd(e){this._roomWd=e}get roomHt(){return this._roomHt}set roomHt(e){this._roomHt=e}get geometryUpdateId(){return this._geometryUpdateId}set geometryUpdateId(e){this._geometryUpdateId=e}get isMoving(){return this._targetLoc!=null&&this._currentLoc!=null}set target(e){let t;this._targetLoc==null&&(this._targetLoc=new F),(this._targetLoc.x!=e.x||this._targetLoc.y!=e.y||this._targetLoc.z!=e.z)&&(this._targetLoc.assign(e),t=F.dif(this._targetLoc,this._currentLoc),this._moveDistance=t.length,this._maintainPreviousMoveSpeed=!0)}dispose(){this._targetLoc=null,this._currentLoc=null}initializeLocation(e){this._currentLoc==null&&(this._currentLoc=new F,this._currentLoc.assign(e))}resetLocation(e){this._currentLoc==null&&(this._currentLoc=new F),this._currentLoc.assign(e)}update(e,t){let s,r,i,a,l;if(this._followDuration>0&&this._targetLoc!=null&&this._currentLoc!=null){if(this._scaleChanged){this._scaleChanged=!1,this._currentLoc=this._targetLoc,this._targetLoc=null;return}s=F.dif(this._targetLoc,this._currentLoc),s.length>this._moveDistance&&(this._moveDistance=s.length),s.length<=t?(this._currentLoc=this._targetLoc,this._targetLoc=null,this._previousMoveSpeed=0):(r=Math.sin(Math.PI*s.length/this._moveDistance),i=t*.5,a=this._moveDistance/zb.MOVE_SPEED_DENOMINATOR,l=i+(a-i)*r,this._maintainPreviousMoveSpeed&&(l<this._previousMoveSpeed?(l=this._previousMoveSpeed,l>s.length&&(l=s.length)):this._maintainPreviousMoveSpeed=!1),this._previousMoveSpeed=l,s.divide(s.length),s.multiply(l),this._currentLoc=F.sum(this._currentLoc,s))}}reset(){this._geometryUpdateId=-1}activateFollowing(e){this._followDuration=e}};Yb.MOVE_SPEED_DENOMINATOR=12;let hX=Yb;class Bp{constructor(e,t){this._roomId=e,this._data=t,this._floorType=null,this._wallType=null,this._landscapeType=null}get roomId(){return this._roomId}get data(){return this._data}get floorType(){return this._floorType}set floorType(e){this._floorType=e}get wallType(){return this._wallType}set wallType(e){this._wallType=e}get landscapeType(){return this._landscapeType}set landscapeType(e){this._landscapeType=e}}class P_{constructor(e,t,s,r,i,a,l,c=NaN,u=-1,h=0,d=0,f="",E=!0,m=!0,R=-1){this._id=e,this._typeId=t,this._type=s,this._state=a,this._data=l,this._extra=c,this._expiryTime=u,this._usagePolicy=h,this._ownerId=d,this._ownerName=f,this._synchronized=E,this._realRoomObject=m,this._sizeZ=R,this._location=new F,this._direction=new F,this._location.assign(r),this._direction.assign(i)}get id(){return this._id}get typeId(){return this._typeId}get type(){return this._type}get location(){return this._location}get direction(){return this._direction}get state(){return this._state}get data(){return this._data}get extra(){return this._extra}get expiryTime(){return this._expiryTime}get usagePolicy(){return this._usagePolicy}get ownerId(){return this._ownerId}get ownerName(){return this._ownerName}get synchronized(){return this._synchronized}get realRoomObject(){return this._realRoomObject}get sizeZ(){return this._sizeZ}}class dX{constructor(e,t){this._tileObjectMap=new Map;let s=0;for(;s<t;)this._tileObjectMap.set(s,new Map),s++;this._width=e,this._height=t}clear(){for(const e of this._tileObjectMap.values())e&&e.clear();this._tileObjectMap.clear()}populate(e){this.clear();for(const t of e)this.addRoomObject(t)}dispose(){this._tileObjectMap=null,this._width=0,this._height=0}getObjectIntTile(e,t){if(e>=0&&e<this._width&&t>=0&&t<this._height){const s=this._tileObjectMap.get(t);if(s)return s.get(e)}return null}setObjectInTile(e,t,s){if(!s.isReady){me.log("Assigning non initialized object to tile object map!");return}if(e>=0&&e<this._width&&t>=0&&t<this._height){const r=this._tileObjectMap.get(t);r&&r.set(e,s)}}addRoomObject(e){if(!e||!e.model||!e.isReady)return;const t=e.getLocation(),s=e.getDirection();if(!t||!s)return;let r=e.model.getValue(C.FURNITURE_SIZE_X),i=e.model.getValue(C.FURNITURE_SIZE_Y);r<1&&(r=1),i<1&&(i=1);const a=Math.trunc(s.x+45)%360/90;(a===1||a===3)&&([r,i]=[i,r]);let l=t.y;for(;l<t.y+i;){let c=t.x;for(;c<t.x+r;){const u=this.getObjectIntTile(c,l);(!u||u!==e&&u.getLocation().z<=t.z)&&this.setObjectInTile(c,l,e),c++}l++}}}class _X{constructor(e){this._roomId=e,this._modelName=null,this._legacyGeometry=new xE,this._tileObjectMap=null,this._roomCamera=new hX,this._selectedObject=null,this._placedObject=null,this._furnitureStackingHeightMap=null,this._floorStack=new Map,this._wallStack=new Map,this._mouseButtonCursorOwners=[]}dispose(){}setModelName(e){this._modelName=e}setSelectedObject(e){this._selectedObject&&this._selectedObject.dispose(),this._selectedObject=e}setPlacedObject(e){this._placedObject&&this._placedObject.dispose(),this._placedObject=e}setFurnitureStackingHeightMap(e){this._furnitureStackingHeightMap&&this._furnitureStackingHeightMap.dispose(),this._furnitureStackingHeightMap=e,this._tileObjectMap&&this._tileObjectMap.dispose(),this._furnitureStackingHeightMap&&(this._tileObjectMap=new dX(this._furnitureStackingHeightMap.width,this._furnitureStackingHeightMap.height))}addPendingFurnitureFloor(e){e&&(this._floorStack.delete(e.id),this._floorStack.set(e.id,e))}removePendingFunitureFloor(e){const t=this._floorStack.get(e);return t?(this._floorStack.delete(e),t):null}getPendingFurnitureFloor(e){const t=this._floorStack.get(e);return t?(this._floorStack.delete(e),t):null}getNextPendingFurnitureFloor(){if(!this._floorStack.size)return null;const e=this._floorStack.keys();return this.getPendingFurnitureFloor(e.next().value)}addPendingFurnitureWall(e){e&&(this._wallStack.delete(e.id),this._wallStack.set(e.id,e))}removePendingFurnitureWall(e){const t=this._wallStack.get(e);return t?(this._wallStack.delete(e),t):null}getPendingFurnitureWall(e){const t=this._wallStack.get(e);return t?(this._wallStack.delete(e),t):null}getNextPendingFurnitureWall(){if(!this._wallStack.size)return null;const e=this._wallStack.keys();return this.getPendingFurnitureWall(e.next().value)}addButtonMouseCursorOwner(e){return this._mouseButtonCursorOwners.indexOf(e)===-1?(this._mouseButtonCursorOwners.push(e),!0):!1}removeButtonMouseCursorOwner(e){const t=this._mouseButtonCursorOwners.indexOf(e);return t>-1?(this._mouseButtonCursorOwners.splice(t,1),!0):!1}hasButtonMouseCursorOwners(){return this._mouseButtonCursorOwners.length>0}get roomId(){return this._roomId}get modelName(){return this._modelName}get legacyGeometry(){return this._legacyGeometry}get tileObjectMap(){return this._tileObjectMap}get roomCamera(){return this._roomCamera}get selectedObject(){return this._selectedObject}get placedObject(){return this._placedObject}get furnitureStackingHeightMap(){return this._furnitureStackingHeightMap}}class gX{constructor(e,t){this._object=e,this._groupBadge=t}get object(){return this._object}get groupBadge(){return this._groupBadge}}class L_{constructor(e,t,s,r,i,a=0,l=null,c=null,u=-1,h=-1,d=null){this._id=0,this._category=0,this._operation="",this._loc=null,this._dir=null,this._typeId=0,this._instanceData=null,this._stuffData=null,this._state=-1,this._animFrame=-1,this._posture=null,this._id=e,this._category=t,this._operation=s,this._loc=new F,this._loc.assign(r),this._dir=new F,this._dir.assign(i),this._typeId=a,this._instanceData=l,this._stuffData=c,this._state=u,this._animFrame=h,this._posture=d}get id(){return this._id}get category(){return this._category}get operation(){return this._operation}get loc(){return this._loc}get dir(){return this._dir}get typeId(){return this._typeId}get instanceData(){return this._instanceData}get stuffData(){return this._stuffData}get state(){return this._state}get animFrame(){return this._animFrame}get posture(){return this._posture}dispose(){this._loc=null,this._dir=null}}const pu=class sn{constructor(){this.spriteCount=0,this.externalImageCount=0}static addMannequinSprites(e,t){const s=[];for(const r of e)if(r)if(r.type==="boutique_mannequin1"&&r.name.indexOf("mannequin_")===0){const i=t.getRoomObject(t.activeRoomId,r.objectId,k.FLOOR);if(i){const a=i.visualization.getSpriteList();if(a)for(const l of a)l.x=l.x+(r.x+r.width/2+sn.MANNEQUIN_MAGIC_X_OFFSET),l.y=l.y+(r.y+r.height+sn.MANNEQUIN_MAGIC_Y_OFFSET),l.z=l.z+r.z,s.push(l)}}else s.push(r);return s}static sortSpriteDataObjects(e,t){return e.z<t.z?1:(e.z>t.z,-1)}static isSpriteInViewPort(e,t,s){return!0}static sortQuadPoints(e,t,s,r){const i=[];if(e.x==t.x?i.push(e,s,t,r):e.x==s.x?i.push(e,t,s,r):t.x<e.x&&t.y>e.y||t.x>e.x&&t.y<e.y?i.push(e,s,t,r):i.push(e,t,s,r),i[0].x<i[1].x){let a=i[0];i[0]=i[1],i[1]=a,a=i[2],i[2]=i[3],i[3]=a}if(i[0].y<i[2].y){let a=i[0];i[0]=i[2],i[2]=a,a=i[1],i[1]=i[3],i[3]=a}return i}getFurniData(e,t,s,r){const i=[];let a=t.getSortableSpriteList();const l=s.getRoomObjects(s.activeRoomId,k.UNIT);for(const c of l)if(c.id!==r){const u=c.visualization.getSpriteList();if(u){let h=0,d=0;for(const E of a)if(E.name==="avatar_"+c.id){h=E.z,d=E.y+E.height-t.geometry.scale/4;break}const f=s.getRoomObjectScreenLocation(s.activeRoomId,c.id,k.UNIT,t.id);if(f){d===0&&(d=f.y);for(const E of u)E.x=E.x+(f.x-t.screenOffsetX),E.y=E.y+d,E.z=E.z+h,(E.name.indexOf("h_std_fx29_")===0||E.name.indexOf("h_std_fx185_")===0)&&(E.y=E.y+sn.AVATAR_WATER_EFFECT_MAGIC_Y_OFFSET),a.push(E)}}}a=sn.addMannequinSprites(a,s),a.sort(sn.sortSpriteDataObjects);for(const c of a)c.name!==null&&c.name.length>0&&c.name.indexOf("tile_cursor_")!==0&&sn.isSpriteInViewPort(c,e,t)&&(r<0||c.objectId!=r)&&(i.push(this.getSpriteDataObject(c,e,t,s)),this.maxZ||(this.maxZ=c.z),this.spriteCount++);return JSON.stringify(i)}getRoomRenderingModifiers(e){return JSON.stringify(new Object)}getSpriteDataObject(e,t,s,r){let i=[];const a={};let l=e.name;return e.name.indexOf("@")!==-1&&(i=e.name.split("@"),l=i[0],i[1]),a.name=l,a.x=e.x-t.x,a.y=e.y-t.y,a.x=a.x+s.screenOffsetX,a.y=a.y+s.screenOffsetY,a.z=e.z,e.alpha&&e.alpha.toString()!=="255"&&(a.alpha=e.alpha),e.flipH&&(a.flipH=e.flipH),e.skew&&(a.skew=e.skew),e.frame&&(a.frame=e.frame),e.color&&e.color.length>0&&(a.color=parseInt(e.color)),e.blendMode&&e.blendMode!=="normal"&&(a.blendMode=e.blendMode),l.indexOf("http")===0&&(a.width=e.width,a.height=e.height,this.externalImageCount++,this.externalImageCount>sn.MAX_EXTERNAL_IMAGE_COUNT&&(a.name="box")),e.posture&&(a.posture=e.posture),a}makeBackgroundPlane(e,t,s){const r=new Fe(0,0),i=new Fe(e.width,0),a=new Fe(0,e.height),l=new Fe(e.width,e.height),c=sn.sortQuadPoints(r,i,a,l);let u=0;s.length>0?(u=s[0].z,this.maxZ&&(u=Math.max(this.maxZ,u))):u=this.maxZ?this.maxZ:0,u=u+(this.spriteCount*1.776104+s.length*2.31743);const h=new Cc(null,t);return h.cornerPoints=c,h.z=u,h}sortRoomPlanes(e,t,s){const r=new Map;let i=1;this.maxZ&&(i=i+this.maxZ);for(const c of e){const u={plane:c,z:i};r.set(c.uniqueId,u)}const a=t.getPlaneSortableSprites();a.sort((c,u)=>u.z-c.z),a.reverse();let l=[];for(const c of a){const u=c.sprite;if(u){const h=r.get(u.id);h&&(r.delete(u.id),h.z=c.z,l.push(h))}}return l=l.concat(Array.from(r.values())),l}getRoomPlanes(e,t,s,r){const i=[],l=s.getRoomObject(s.activeRoomId,wE.ROOM_OBJECT_ID,k.ROOM).visualization;if(l){const c=t.geometry,u=this.sortRoomPlanes(l.planes,t,s),h=Us.instance.stage;for(const d of u){const f=d.plane,E=[],m=F.sum(f.location,f.leftSide),R=c.getScreenPoint(f.location),I=c.getScreenPoint(m),S=c.getScreenPoint(F.sum(f.location,f.rightSide)),A=c.getScreenPoint(F.sum(m,f.rightSide));E.push(R,I,S,A);let N=0,L=0;for(const M of E)M.x+=h.width/2,M.y+=h.height/2,M.x+=t.screenOffsetX,M.y+=t.screenOffsetY,M.x+=-e.x,M.y+=-e.y,M.x<0?N--:M.x>=e.width&&N++,M.y<0?L--:M.y>=e.height&&L++;if(!(Math.abs(N)===4||Math.abs(L)===4)){const M=sn.sortQuadPoints(R,I,S,A);for(const b of f.getDrawingDatas(c))b.cornerPoints=M,b.z=d.z,i.push(b)}}i.unshift(this.makeBackgroundPlane(e,r,i))}return i}};pu.MANNEQUIN_MAGIC_X_OFFSET=1;pu.MANNEQUIN_MAGIC_Y_OFFSET=-16;pu.AVATAR_WATER_EFFECT_MAGIC_Y_OFFSET=-52;pu.MAX_EXTERNAL_IMAGE_COUNT=30;let fX=pu;class mX extends Hr{constructor(e){super(),this._connection=null,this._roomCreator=e,this._planeParser=new Hs,this._latestEntryTileEvent=null,this._currentRoomId=0,this._ownUserId=0,this._initialConnection=!0,this._guideId=-1,this._requesterId=-1}onDispose(){super.onDispose(),this._connection=null,this._roomCreator=null,this._latestEntryTileEvent=null,this._planeParser&&(this._planeParser.dispose(),this._planeParser=null)}setConnection(e){this._connection||!e||(this._connection=e,this._connection.addMessageEvent(new Nl(this.onUserInfoEvent.bind(this))),this._connection.addMessageEvent(new Al(this.onRoomReadyMessageEvent.bind(this))),this._connection.addMessageEvent(new $g(this.onRoomPaintEvent.bind(this))),this._connection.addMessageEvent(new xh(this.onRoomModelEvent.bind(this))),this._connection.addMessageEvent(new Jg(this.onRoomHeightMapEvent.bind(this))),this._connection.addMessageEvent(new Zg(this.onRoomHeightMapUpdateEvent.bind(this))),this._connection.addMessageEvent(new Gh(this.onRoomThicknessEvent.bind(this))),this._connection.addMessageEvent(new wh(this.onRoomDoorEvent.bind(this))),this._connection.addMessageEvent(new wg(this.onRoomRollingEvent.bind(this))),this._connection.addMessageEvent(new xg(this.onObjectsDataUpdateEvent.bind(this))),this._connection.addMessageEvent(new jg(this.onFurnitureAliasesEvent.bind(this))),this._connection.addMessageEvent(new Bg(this.onFurnitureFloorAddEvent.bind(this))),this._connection.addMessageEvent(new kg(this.onFurnitureFloorEvent.bind(this))),this._connection.addMessageEvent(new Vg(this.onFurnitureFloorRemoveEvent.bind(this))),this._connection.addMessageEvent(new Hg(this.onFurnitureFloorUpdateEvent.bind(this))),this._connection.addMessageEvent(new Kg(this.onFurnitureWallAddEvent.bind(this))),this._connection.addMessageEvent(new Xg(this.onFurnitureWallEvent.bind(this))),this._connection.addMessageEvent(new qg(this.onFurnitureWallRemoveEvent.bind(this))),this._connection.addMessageEvent(new Qg(this.onFurnitureWallUpdateEvent.bind(this))),this._connection.addMessageEvent(new Wg(this.onFurnitureDataEvent.bind(this))),this._connection.addMessageEvent(new Yg(this.onItemDataUpdateMessageEvent.bind(this))),this._connection.addMessageEvent(new zg(this.onOneWayDoorStatusMessageEvent.bind(this))),this._connection.addMessageEvent(new Hh(this.onRoomUnitDanceEvent.bind(this))),this._connection.addMessageEvent(new tf(this.onRoomUnitEffectEvent.bind(this))),this._connection.addMessageEvent(new jh(this.onRoomUnitEvent.bind(this))),this._connection.addMessageEvent(new sf(this.onRoomUnitExpressionEvent.bind(this))),this._connection.addMessageEvent(new rf(this.onRoomUnitHandItemEvent.bind(this))),this._connection.addMessageEvent(new nf(this.onRoomUnitIdleEvent.bind(this))),this._connection.addMessageEvent(new Wh(this.onRoomUnitInfoEvent.bind(this))),this._connection.addMessageEvent(new af(this.onRoomUnitNumberEvent.bind(this))),this._connection.addMessageEvent(new Yh(this.onRoomUnitRemoveEvent.bind(this))),this._connection.addMessageEvent(new of(this.onRoomUnitStatusEvent.bind(this))),this._connection.addMessageEvent(new Ym(this.onRoomUnitChatEvent.bind(this))),this._connection.addMessageEvent(new kh(this.onRoomUnitChatEvent.bind(this))),this._connection.addMessageEvent(new Vh(this.onRoomUnitChatEvent.bind(this))),this._connection.addMessageEvent(new ef(this.onRoomUnitTypingEvent.bind(this))),this._connection.addMessageEvent(new Bh(this.onPetFigureUpdateEvent.bind(this))),this._connection.addMessageEvent(new qA(this.onPetExperienceEvent.bind(this))),this._connection.addMessageEvent(new ZA(this.onYouArePlayingGameEvent.bind(this))),this._connection.addMessageEvent(new Gg(this.onDiceValueMessageEvent.bind(this))),this._connection.addMessageEvent(new Jm(this.onIgnoreResultEvent.bind(this))),this._connection.addMessageEvent(new ZS(this.onGuideSessionStartedMessageEvent.bind(this))),this._connection.addMessageEvent(new QS(this.onGuideSessionEndedMessageEvent.bind(this))),this._connection.addMessageEvent(new JS(this.onGuideSessionErrorMessageEvent.bind(this))))}setRoomId(e){this._currentRoomId!==0&&this._roomCreator&&this._roomCreator.destroyRoom(this._currentRoomId),this._currentRoomId=e,this._latestEntryTileEvent=null}clearRoomId(){this._currentRoomId=0,this._latestEntryTileEvent=null}onUserInfoEvent(e){if(!(e instanceof Nl)||!e.connection)return;const t=e.getParser();t&&(this._ownUserId=t.userInfo.userId)}onRoomReadyMessageEvent(e){const t=e.getParser();if(this._currentRoomId!==t.roomId&&this.setRoomId(t.roomId),this._roomCreator&&this._roomCreator.setRoomInstanceModelName(t.roomId,t.name),this._initialConnection){e.connection.send(new MD),this._initialConnection=!1;return}e.connection.send(new Tf)}onRoomPaintEvent(e){if(!(e instanceof $g))return;const t=e.getParser();if(!t)return;const s=t.floorType,r=t.wallType,i=t.landscapeType;this._roomCreator&&this._roomCreator.updateRoomInstancePlaneType(this._currentRoomId,s,r,i)}onRoomModelEvent(e){if(!(e instanceof xh)||!e.connection||!this._roomCreator)return;const t=e.getParser();if(!t)return;const s=this._roomCreator.getLegacyWallGeometry(this._currentRoomId);if(!s)return;this._planeParser.reset();const r=t.width,i=t.height;this._planeParser.initializeTileMap(r,i);let a=null;this._latestEntryTileEvent&&(a=this._latestEntryTileEvent.getParser());let l=-1,c=-1,u=0,h=0,d=0;for(;d<i;){let m=0;for(;m<r;){const R=t.getHeight(m,d);(d>0&&d<i-1||m>0&&m<r-1)&&R!=Hs.TILE_BLOCKED&&(a==null||m==a.x&&d==a.y)&&(t.getHeight(m,d-1)==Hs.TILE_BLOCKED&&t.getHeight(m-1,d)==Hs.TILE_BLOCKED&&t.getHeight(m,d+1)==Hs.TILE_BLOCKED&&(l=m+.5,c=d,u=R,h=90),t.getHeight(m,d-1)==Hs.TILE_BLOCKED&&t.getHeight(m-1,d)==Hs.TILE_BLOCKED&&t.getHeight(m+1,d)==Hs.TILE_BLOCKED&&(l=m,c=d+.5,u=R,h=180)),this._planeParser.setTileHeight(m,d,R),m++}d++}this._planeParser.setTileHeight(Math.floor(l),Math.floor(c),u),this._planeParser.initializeFromTileData(t.wallHeight),this._planeParser.setTileHeight(Math.floor(l),Math.floor(c),u+this._planeParser.wallHeight),t.scale===64?(this._planeParser.restrictsDragging=!0,this._planeParser.restrictsScaling=!0,this._planeParser.restrictedScale=.5):(this._planeParser.restrictsDragging=!1,this._planeParser.restrictsScaling=!1,this._planeParser.restrictedScale=1),s.scale=xE.DEFAULT_SCALE,s.initialize(r,i,this._planeParser.floorHeight);let f=t.height-1;for(;f>=0;){let m=t.width-1;for(;m>=0;)s.setHeight(m,f,this._planeParser.getTileHeight(m,f)),m--;f--}const E=this._planeParser.getMapData();E.doors.push({x:l,y:c,z:u,dir:h}),this._roomCreator.createRoomInstance(this._currentRoomId,E)}onRoomHeightMapEvent(e){if(!(e instanceof Jg)||!e.connection||!this._roomCreator)return;const t=e.getParser();if(!t)return;const s=t.width,r=t.height,i=new uX(s,r);let a=0;for(;a<r;){let l=0;for(;l<s;)i.setTileHeight(l,a,t.getTileHeight(l,a)),i.setStackingBlocked(l,a,t.getStackingBlocked(l,a)),i.setIsRoomTile(l,a,t.isRoomTile(l,a)),l++;a++}this._roomCreator.setFurnitureStackingHeightMap(this._currentRoomId,i)}onRoomHeightMapUpdateEvent(e){if(!(e instanceof Zg)||!e.connection||!this._roomCreator)return;const t=e.getParser();if(!t)return;const s=this._roomCreator.getFurnitureStackingHeightMap(this._currentRoomId);if(s){for(;t.next();)s.setTileHeight(t.x,t.y,t.tileHeight()),s.setStackingBlocked(t.x,t.y,t.isStackingBlocked()),s.setIsRoomTile(t.x,t.y,t.isRoomTile());this._roomCreator.refreshTileObjectMap(this._currentRoomId,"RoomMessageHandler.onRoomHeightMapUpdateEvent()")}}onRoomThicknessEvent(e){if(!(e instanceof Gh))return;const t=e.getParser();if(!t)return;const s=!t.hideWalls,r=!0,i=t.thicknessWall,a=t.thicknessFloor;this._roomCreator&&(this._roomCreator.updateRoomInstancePlaneVisibility(this._currentRoomId,s,r),this._roomCreator.updateRoomInstancePlaneThickness(this._currentRoomId,i,a))}onRoomDoorEvent(e){e instanceof wh&&(this._latestEntryTileEvent=e)}onRoomRollingEvent(e){if(!(e instanceof wg)||!e.connection||!this._roomCreator)return;const t=e.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,t.rollerId,null,null,1,null),this._roomCreator.updateRoomObjectFloor(this._currentRoomId,t.rollerId,null,null,2,null);const s=t.itemsRolling;if(s&&s.length)for(const i of s)i&&this._roomCreator.rollRoomObjectFloor(this._currentRoomId,i.id,i.location,i.targetLocation);const r=t.unitRolling;if(r){this._roomCreator.updateRoomObjectUserLocation(this._currentRoomId,r.id,r.location,r.targetLocation);const i=this._roomCreator.getRoomObjectUser(this._currentRoomId,r.id);if(i&&i.type!==ft.MONSTER_PLANT){let a="std";switch(r.movementType){case kn.MOVE:a="mv";break;case kn.SLIDE:a="std";break}this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,r.id,a)}}}onObjectsDataUpdateEvent(e){if(!(e instanceof xg)||!e.connection||!this._roomCreator)return;const t=e.getParser();if(t)for(const s of t.objects)this._roomCreator.updateRoomObjectFloor(this._currentRoomId,s.id,null,null,s.state,s.data)}onFurnitureAliasesEvent(e){!(e instanceof jg)||!e.connection||!this._roomCreator||(e.getParser().aliases,this._connection.send(new Tf))}onFurnitureFloorAddEvent(e){if(!(e instanceof Bg)||!e.connection||!this._roomCreator)return;const t=e.getParser().item;t&&this.addRoomObjectFurnitureFloor(this._currentRoomId,t)}onFurnitureFloorEvent(e){if(!(e instanceof kg)||!e.connection||!this._roomCreator)return;const t=e.getParser();if(!t)return;const s=t.items.length;let r=0;for(;r<s;){const i=t.items[r];i&&this.addRoomObjectFurnitureFloor(this._currentRoomId,i),r++}}onFurnitureFloorRemoveEvent(e){if(!(e instanceof Vg)||!e.connection||!this._roomCreator)return;const t=e.getParser();t&&(t.delay>0?setTimeout(()=>{this._roomCreator.removeRoomObjectFloor(this._currentRoomId,t.itemId,t.isExpired?-1:t.userId,!0)},t.delay):this._roomCreator.removeRoomObjectFloor(this._currentRoomId,t.itemId,t.isExpired?-1:t.userId,!0))}onFurnitureFloorUpdateEvent(e){if(!(e instanceof Hg)||!e.connection||!this._roomCreator)return;const t=e.getParser().item;if(!t)return;const s=new F(t.x,t.y,t.z),r=new F(t.direction);this._roomCreator.updateRoomObjectFloor(this._currentRoomId,t.itemId,s,r,t.data.state,t.data,t.extra),this._roomCreator.updateRoomObjectFloorHeight(this._currentRoomId,t.itemId,t.stackHeight),this._roomCreator.updateRoomObjectFloorExpiration(this._currentRoomId,t.itemId,t.expires)}onFurnitureWallAddEvent(e){if(!(e instanceof Kg)||!e.connection||!this._roomCreator)return;const t=e.getParser().item;t&&this.addRoomObjectFurnitureWall(this._currentRoomId,t)}onFurnitureWallEvent(e){if(!(e instanceof Xg)||!e.connection||!this._roomCreator)return;const t=e.getParser();if(!t)return;const s=t.items.length;let r=0;for(;r<s;){const i=t.items[r];i&&this.addRoomObjectFurnitureWall(this._currentRoomId,i),r++}}onFurnitureWallRemoveEvent(e){if(!(e instanceof qg)||!e.connection||!this._roomCreator)return;const t=e.getParser();t&&this._roomCreator.removeRoomObjectWall(this._currentRoomId,t.itemId,t.userId)}onFurnitureWallUpdateEvent(e){if(!(e instanceof Qg)||!e.connection||!this._roomCreator)return;const t=this._roomCreator.getLegacyWallGeometry(this._currentRoomId);if(!t)return;const s=e.getParser().item;if(!s)return;const r=t.getLocation(s.width,s.height,s.localX,s.localY,s.direction),i=new F(t.getDirection(s.direction));this._roomCreator.updateRoomObjectWall(this._currentRoomId,s.itemId,r,i,s.state,s.stuffData),this._roomCreator.updateRoomObjectWallExpiration(this._currentRoomId,s.itemId,s.secondsToExpiration)}onFurnitureDataEvent(e){if(!(e instanceof Wg)||!e.connection||!this._roomCreator)return;const t=e.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,t.furnitureId,null,null,t.objectData.state,t.objectData)}onItemDataUpdateMessageEvent(e){if(!(e instanceof Yg)||!e.connection||!this._roomCreator)return;const t=e.getParser();this._roomCreator.updateRoomObjectWallItemData(this._currentRoomId,t.furnitureId,t.data)}onOneWayDoorStatusMessageEvent(e){if(!(e instanceof zg)||!e.connection||!this._roomCreator)return;const t=e.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,t.itemId,null,null,t.state,new Br)}onDiceValueMessageEvent(e){if(!(e instanceof Gg)||!e.connection||!this._roomCreator)return;const t=e.getParser();this._roomCreator.updateRoomObjectFloor(this._currentRoomId,t.itemId,null,null,t.value,new Br)}onRoomUnitDanceEvent(e){!(e instanceof Hh)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.getParser().unitId,C.FIGURE_DANCE,e.getParser().danceId)}onRoomUnitEffectEvent(e){!(e instanceof tf)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserEffect(this._currentRoomId,e.getParser().unitId,e.getParser().effectId,e.getParser().delay)}onRoomUnitEvent(e){if(!(e instanceof jh)||!e.connection||!this._roomCreator)return;const t=e.getParser().users;if(!(!t||!t.length)){for(const s of t){if(!s)continue;const r=new F(s.x,s.y,s.z),i=new F(s.dir);this._roomCreator.addRoomObjectUser(this._currentRoomId,s.roomIndex,r,i,s.dir,s.userType,s.figure),s.webID===this._ownUserId&&(this._roomCreator.setRoomSessionOwnUser(this._currentRoomId,s.roomIndex),this._roomCreator.updateRoomObjectUserOwn(this._currentRoomId,s.roomIndex)),this._roomCreator.updateRoomObjectUserFigure(this._currentRoomId,s.roomIndex,s.figure,s.sex,s.subType,s.isRiding),ft.getTypeString(s.userType)===ft.PET&&this._roomCreator.getPetTypeId(s.figure)===be.MONSTERPLANT&&this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,s.roomIndex,s.petPosture),this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,s.roomIndex,C.FIGURE_IS_MUTED,this._roomCreator.sessionDataManager.isUserIgnored(s.name)?1:0)}this.updateGuideMarker()}}onRoomUnitExpressionEvent(e){!(e instanceof sf)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.getParser().unitId,C.FIGURE_EXPRESSION,e.getParser().expression)}onRoomUnitHandItemEvent(e){!(e instanceof rf)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.getParser().unitId,C.FIGURE_CARRY_OBJECT,e.getParser().handId)}onRoomUnitIdleEvent(e){!(e instanceof nf)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.getParser().unitId,C.FIGURE_SLEEP,e.getParser().isIdle?1:0)}onRoomUnitInfoEvent(e){!(e instanceof Wh)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserFigure(this._currentRoomId,e.getParser().unitId,e.getParser().figure,e.getParser().gender)}onRoomUnitNumberEvent(e){if(!(e instanceof af)||!e.connection||!this._roomCreator)return;const t=e.getParser();t&&this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.unitId,C.FIGURE_NUMBER_VALUE,t.value)}onRoomUnitRemoveEvent(e){!(e instanceof Yh)||!e.connection||!this._roomCreator||(this._roomCreator.removeRoomObjectUser(this._currentRoomId,e.getParser().unitId),this.updateGuideMarker())}onRoomUnitStatusEvent(e){if(!(e instanceof of)||!e.connection||!this._roomCreator)return;const t=e.getParser().statuses;if(!t||!t.length)return;const s=this._roomCreator.getRoomInstance(this._currentRoomId);if(!s)return;const r=s.model.getValue(pt.ROOM_Z_SCALE)||1;for(const i of t){if(!i)continue;let a=i.height;a&&(a=a/r);const l=new F(i.x,i.y,i.z+a),c=new F(i.direction);let u=null;i.didMove&&(u=new F(i.targetX,i.targetY,i.targetZ)),this._roomCreator.updateRoomObjectUserLocation(this._currentRoomId,i.id,l,u,i.canStandUp,a,c,i.headDirection),this._roomCreator.updateRoomObjectUserFlatControl(this._currentRoomId,i.id,null);let h=!0,d=!1,f=C.STD,E="";if(i.actions&&i.actions.length){for(const m of i.actions)if(m)switch(m.action){case"flatctrl":this._roomCreator.updateRoomObjectUserFlatControl(this._currentRoomId,i.id,m.value);break;case"sign":i.actions.length===1&&(h=!1),this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,i.id,C.FIGURE_SIGN,parseInt(m.value));break;case"gst":i.actions.length===1&&(h=!1),this._roomCreator.updateRoomObjectUserPetGesture(this._currentRoomId,i.id,m.value);break;case"wav":case"mv":d=!0,f=m.action,E=m.value;break;case"trd":break;default:d=!0,f=m.action,E=m.value;break}}d?this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,i.id,f,E):h&&this._roomCreator.updateRoomObjectUserPosture(this._currentRoomId,i.id,C.STD,"")}this.updateGuideMarker()}onRoomUnitChatEvent(e){if(!e.connection||!this._roomCreator)return;const t=e.getParser();t&&(this._roomCreator.updateRoomObjectUserGesture(this._currentRoomId,t.roomIndex,t.gesture),this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.roomIndex,C.FIGURE_TALK,t.message.length/10))}onRoomUnitTypingEvent(e){!(e instanceof ef)||!e.connection||!this._roomCreator||this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,e.getParser().unitId,C.FIGURE_IS_TYPING,e.getParser().isTyping?1:0)}onPetFigureUpdateEvent(e){if(!(e instanceof Bh)||!e.connection||!this._roomCreator)return;const t=e.getParser();t&&this._roomCreator.updateRoomObjectUserFigure(this._currentRoomId,t.roomIndex,t.figureData.figuredata,"","",t.isRiding)}onPetExperienceEvent(e){const t=e.getParser();t&&this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,t.roomIndex,C.FIGURE_GAINED_EXPERIENCE,t.gainedExperience)}onYouArePlayingGameEvent(e){if(!e)return;const t=e.getParser();t&&this._roomCreator.setRoomEngineGameMode(this._currentRoomId,t.isPlaying)}addRoomObjectFurnitureFloor(e,t){if(!t||!this._roomCreator)return;const s=new F(t.x,t.y,t.z),r=new F(t.direction);t.spriteName?this._roomCreator.addFurnitureFloorByTypeName(e,t.itemId,t.spriteName,s,r,t.state,t.data,t.extra,t.expires,t.usagePolicy,t.userId,t.username,!0,!0,t.stackHeight):this._roomCreator.addFurnitureFloor(e,t.itemId,t.spriteId,s,r,t.state,t.data,t.extra,t.expires,t.usagePolicy,t.userId,t.username,!0,!0,t.stackHeight)}addRoomObjectFurnitureWall(e,t){if(!t||!this._roomCreator)return;const s=this._roomCreator.getLegacyWallGeometry(e);if(!s)return;let r=null;t.isOldFormat||(r=s.getLocation(t.width,t.height,t.localX,t.localY,t.direction));const i=new F(s.getDirection(t.direction));this._roomCreator.addFurnitureWall(e,t.itemId,t.spriteId,r,i,t.state,t.stuffData,t.secondsToExpiration,t.usagePolicy,t.userId,t.username)}onIgnoreResultEvent(e){if(!e)return;const t=e.getParser();if(!t)return;const s=this._roomCreator.roomSessionManager.getSession(this._currentRoomId);if(!s)return;const r=s.userDataManager.getUserDataByName(t.name);if(r)switch(t.result){case 1:case 2:this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,r.roomIndex,C.FIGURE_IS_MUTED,1);return;case 3:this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,r.roomIndex,C.FIGURE_IS_MUTED,0);return}}onGuideSessionStartedMessageEvent(e){const t=e.getParser();this._guideId=t.guideUserId,this._requesterId=t.requesterUserId,this.updateGuideMarker()}onGuideSessionEndedMessageEvent(e){this.removeGuideMarker()}onGuideSessionErrorMessageEvent(e){this.removeGuideMarker()}updateGuideMarker(){const e=this._roomCreator.sessionDataManager.userId;this.setUserGuideStatus(this._guideId,this._requesterId===e?Li.GUIDE:Li.NONE),this.setUserGuideStatus(this._requesterId,this._guideId===e?Li.REQUESTER:Li.NONE)}removeGuideMarker(){this.setUserGuideStatus(this._guideId,Li.NONE),this.setUserGuideStatus(this._requesterId,Li.NONE),this._guideId=-1,this._requesterId=-1}setUserGuideStatus(e,t){if(!this._roomCreator||!this._roomCreator.roomSessionManager)return;const s=this._roomCreator.roomSessionManager.getSession(this._currentRoomId);if(!s)return;const r=s.userDataManager.getDataByType(e,Rt.USER);r&&this._roomCreator.updateRoomObjectUserAction(this._currentRoomId,r.roomIndex,C.FIGURE_GUIDE_STATUS,t)}get currentRoomId(){return this._currentRoomId}}class EX extends Hr{constructor(e){super(),this._roomEngine=e,this._eventIds=new Map,this._selectedAvatarId=-1,this._selectedObjectId=-1,this._selectedObjectCategory=-2,this._whereYouClickIsWhereYouGo=!0,this._objectPlacementSource=null,this.onRoomEngineObjectEvent=this.onRoomEngineObjectEvent.bind(this),this._roomEngine.events.addEventListener(ue.ADDED,this.onRoomEngineObjectEvent)}dispose(){this._eventIds&&(this._eventIds=null),this._roomEngine.events.removeEventListener(ue.ADDED,this.onRoomEngineObjectEvent),this._roomEngine=null}onRoomEngineObjectEvent(e){let t=this.getSelectedRoomObjectData(e.roomId);if(t&&t.operation===ye.OBJECT_PLACE&&t.id===e.objectId){const s=this._roomEngine.getRoomObject(e.roomId,t.id,t.category);if(s&&s.model&&t.category===k.FLOOR){const r=s.model.getValue(C.FURNITURE_ALLOWED_DIRECTIONS);if(r&&r.length){const i=new F(r[0]);if(s.setDirection(i),this.updateSelectedObjectData(e.roomId,t.id,t.category,t.loc,i,t.operation,t.typeId,t.instanceData,t.stuffData,t.state,t.animFrame,t.posture),t=this.getSelectedRoomObjectData(e.roomId),!t)return}}this.setFurnitureAlphaMultiplier(s,.5)}}processRoomCanvasMouseEvent(e,t,s){if(!e||!t||xi.isRunning())return;const r=t.type;let i=this._roomEngine.getRoomObjectCategoryForType(r);if(i!==k.ROOM&&(!this._roomEngine.isPlayingGame()||i!==k.UNIT)&&(i=k.MINIMUM),this.getMouseEventId(i,e.type)===e.eventId){if(e.type===ie.MOUSE_CLICK||e.type===ie.DOUBLE_CLICK||e.type===ie.MOUSE_DOWN||e.type===ie.MOUSE_UP||e.type===ie.MOUSE_MOVE)return}else e.eventId&&this.setMouseEventId(i,e.type,e.eventId);t.mouseHandler&&t.mouseHandler.mouseEvent(e,s)}processRoomObjectPlacement(e,t,s,r,i,a=null,l=null,c=-1,u=-1,h=null){this._objectPlacementSource=e;const d=new F(-100,-100),f=new F(0);return this.setSelectedRoomObjectData(t,s,r,d,f,ye.OBJECT_PLACE,i,a,l,c,u,h),this._roomEngine&&(this._roomEngine.setObjectMoverIconSprite(i,r,!1,a,l,c,u,h),this._roomEngine.setObjectMoverIconSpriteVisible(!1)),!0}cancelRoomObjectInsert(e){return this.resetSelectedObjectData(e),!0}getMouseEventId(e,t){const s=this._eventIds.get(e);return s&&s.get(t)||null}setMouseEventId(e,t,s){let r=this._eventIds.get(e);r||(r=new Map,this._eventIds.set(e,r)),r.delete(t),r.set(t,s)}handleRoomObjectEvent(e,t){if(e){if(e instanceof Me){this.handleRoomObjectMouseEvent(e,t);return}switch(e.type){case it.STATE_CHANGE:case it.STATE_RANDOM:this.onRoomObjectStateChangedEvent(e,t);return;case yc.DIMMER_STATE:this.onRoomObjectDimmerStateUpdateEvent(e,t);return;case hr.POSITION_CHANGED:case hr.OBJECT_REMOVED:this.handleSelectedObjectRemove(e,t);return;case W.OPEN_WIDGET:case W.CLOSE_WIDGET:case W.OPEN_FURNI_CONTEXT_MENU:case W.CLOSE_FURNI_CONTEXT_MENU:case W.PLACEHOLDER:case W.CREDITFURNI:case W.STACK_HEIGHT:case W.EXTERNAL_IMAGE:case W.STICKIE:case W.PRESENT:case W.TROPHY:case W.TEASER:case W.ECOTRONBOX:case W.DIMMER:case W.WIDGET_REMOVE_DIMMER:case W.CLOTHING_CHANGE:case W.JUKEBOX_PLAYLIST_EDITOR:case W.MANNEQUIN:case W.PET_PRODUCT_MENU:case W.GUILD_FURNI_CONTEXT_MENU:case W.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:case W.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:case W.BACKGROUND_COLOR:case W.MYSTERYBOX_OPEN_DIALOG:case W.EFFECTBOX_OPEN_DIALOG:case W.MYSTERYTROPHY_OPEN_DIALOG:case W.ACHIEVEMENT_RESOLUTION_OPEN:case W.ACHIEVEMENT_RESOLUTION_ENGRAVING:case W.ACHIEVEMENT_RESOLUTION_FAILED:case W.FRIEND_FURNITURE_CONFIRM:case W.FRIEND_FURNITURE_ENGRAVING:case W.BADGE_DISPLAY_ENGRAVING:case W.HIGH_SCORE_DISPLAY:case W.HIDE_HIGH_SCORE_DISPLAY:case W.INERNAL_LINK:case W.ROOM_LINK:case W.YOUTUBE:this.onRoomObjectWidgetRequestEvent(e,t);return;case oe.DICE_ACTIVATE:case oe.DICE_OFF:case oe.USE_HABBOWHEEL:case oe.STICKIE:case oe.ENTER_ONEWAYDOOR:this.onRoomObjectFurnitureActionEvent(e,t);return;case oe.SOUND_MACHINE_INIT:case oe.SOUND_MACHINE_START:case oe.SOUND_MACHINE_STOP:case oe.SOUND_MACHINE_DISPOSE:this.handleObjectSoundMachineEvent(e,t);return;case oe.JUKEBOX_INIT:case oe.JUKEBOX_START:case oe.JUKEBOX_MACHINE_STOP:case oe.JUKEBOX_DISPOSE:this.handleObjectJukeboxEvent(e,t);return;case nr.ADD_HOLE:case nr.REMOVE_HOLE:this.onRoomObjectFloorHoleEvent(e,t);return;case Ut.ROOM_AD_FURNI_CLICK:case Ut.ROOM_AD_FURNI_DOUBLE_CLICK:case Ut.ROOM_AD_TOOLTIP_SHOW:case Ut.ROOM_AD_TOOLTIP_HIDE:case Ut.ROOM_AD_LOAD_IMAGE:this.onRoomObjectRoomAdEvent(e,t);return;case _n.LOAD_BADGE:this.onRoomObjectBadgeAssetEvent(e,t);return;case oe.MOUSE_ARROW:case oe.MOUSE_BUTTON:this.handleMousePointer(e,t);return;case Wn.PLAY_SOUND:case Wn.PLAY_SOUND_AT_PITCH:this.handleRoomObjectPlaySoundEvent(e,t);return;case is.ROOM_OBJECT_INITIALIZED:case is.ROOM_OBJECT_DISPOSED:case is.PLAY_SAMPLE:case is.CHANGE_PITCH:this.handleRoomObjectSamplePlaybackEvent(e,t);return;case Sa.ROOM_BACKGROUND_COLOR:this.onHSLColorEnableEvent(e,t);return;case fi.RODRE_CURRENT_USER_ID:case fi.RODRE_URL_PREFIX:this.onRoomObjectDataRequestEvent(e,t);return;default:me.warn("Unhandled Event",e.constructor.name,"Object ID",e.object.id);return}}}handleRoomObjectMouseEvent(e,t){if(!(!e||!e.type))switch(e.type){case Me.CLICK:this.handleRoomObjectMouseClickEvent(e,t);return;case Me.DOUBLE_CLICK:this.handleRoomObjectMouseDoubleClickEvent(e,t);return;case Me.MOUSE_MOVE:this.handleRoomObjectMouseMoveEvent(e,t);return;case Me.MOUSE_DOWN:this.handleRoomObjectMouseDownEvent(e,t);return;case Me.MOUSE_DOWN_LONG:this.handleRoomObjectMouseDownLongEvent(e,t);return;case Me.MOUSE_ENTER:this.handleRoomObjectMouseEnterEvent(e,t);return;case Me.MOUSE_LEAVE:this.handleRoomObjectMouseLeaveEvent(e,t);return}}handleRoomObjectMouseClickEvent(e,t){if(!e)return;let s=ye.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(t);r&&(s=r.operation);let i=!1,a=!1;this._whereYouClickIsWhereYouGo&&(!s||s===ye.OBJECT_UNDEFINED)&&(i=this.handleMoveTargetFurni(t,e));const l=this._roomEngine.getRoomObjectCategoryForType(e.objectType);switch(s){case ye.OBJECT_MOVE:l===k.ROOM?r&&this.modifyRoomObject(t,r.id,r.category,ye.OBJECT_MOVE_TO):l===k.UNIT&&(r&&e.objectType===ft.MONSTER_PLANT&&this.modifyRoomObject(t,r.id,r.category,ye.OBJECT_MOVE_TO),e.eventId&&this.setMouseEventId(k.ROOM,ie.MOUSE_CLICK,e.eventId),this.placeObjectOnUser(t,e.objectId,l)),a=!0,e.objectId!==-1&&this.setSelectedObject(t,e.objectId,l);break;case ye.OBJECT_PLACE:if(l===k.ROOM)this.placeObject(t,e instanceof yn,e instanceof qo);else if(l===k.UNIT)switch(e.objectType){case ft.MONSTER_PLANT:case ft.RENTABLE_BOT:this.placeObject(t,e instanceof yn,e instanceof qo);break;default:e.eventId&&this.setMouseEventId(k.ROOM,ie.MOUSE_CLICK,e.eventId),this.placeObjectOnUser(t,e.objectId,l);break}break;case ye.OBJECT_UNDEFINED:l===k.ROOM?!i&&e instanceof yn&&this.onRoomObjectTileMouseEvent(t,e):(this.setSelectedObject(t,e.objectId,l),a=!1,l===k.UNIT?(e.ctrlKey&&!e.altKey&&!e.shiftKey&&e.objectType===ft.RENTABLE_BOT?this.modifyRoomObject(t,e.objectId,l,ye.OBJECT_PICKUP_BOT):e.ctrlKey&&!e.altKey&&!e.shiftKey&&e.objectType===ft.MONSTER_PLANT?this.modifyRoomObject(t,e.objectId,l,ye.OBJECT_PICKUP_PET):!e.ctrlKey&&!e.altKey&&e.shiftKey&&e.objectType===ft.MONSTER_PLANT&&this.modifyRoomObject(t,e.objectId,l,ye.OBJECT_ROTATE_POSITIVE),this._roomEngine.isPlayingGame()?a=!0:i=!0):(l===k.FLOOR||l===k.WALL)&&(e.altKey||e.ctrlKey||e.shiftKey)&&(!e.ctrlKey&&!e.altKey&&e.shiftKey?l===k.FLOOR&&this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.REQUEST_ROTATE,t,e.objectId,l)):e.ctrlKey&&!e.altKey&&!e.shiftKey&&this.modifyRoomObject(t,e.objectId,l,ye.OBJECT_PICKUP),this._roomEngine.isPlayingGame()?a=!0:i=!0),e.eventId&&(i&&this.setMouseEventId(k.ROOM,ie.MOUSE_CLICK,e.eventId),a&&this.setMouseEventId(k.MINIMUM,ie.MOUSE_CLICK,e.eventId)));break}if(l===k.ROOM){const c=this.getMouseEventId(k.MINIMUM,ie.MOUSE_CLICK),u=this.getMouseEventId(k.UNIT,ie.MOUSE_CLICK);c!==e.eventId&&u!==e.eventId&&!a&&(this.deselectObject(t),this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.DESELECTED,t,-1,k.MINIMUM)),this.setSelectedAvatar(t,0,!1))}}handleRoomObjectMouseDoubleClickEvent(e,t){const s=e.objectId,r=e.objectType,i=this._roomEngine.getRoomObjectCategoryForType(r);this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.DOUBLE_CLICK,t,s,i))}handleRoomObjectMouseMoveEvent(e,t){if(!e)return;let s=ye.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(t);r&&(s=r.operation);const i=this._roomEngine.getRoomObjectCategoryForType(e.objectType);if(this._roomEngine){const a=this._roomEngine.getRoomObjectCursor(t);if(a&&a.logic){let l=null;e instanceof yn?l=this.handleMouseOverTile(e,t):e.object&&e.object.id!==-1?this._whereYouClickIsWhereYouGo&&(l=this.handleMouseOverObject(i,t,e)):l=new Jo(null,0,!1,e.eventId),a.processUpdateMessage(l)}}switch(s){case ye.OBJECT_MOVE:i===k.ROOM&&this.handleObjectMove(e,t);return;case ye.OBJECT_PLACE:i===k.ROOM&&this.handleObjectPlace(e,t);return}}handleRoomObjectMouseDownEvent(e,t){if(!e)return;let s=ye.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(t);r&&(s=r.operation);const i=this._roomEngine.getRoomObjectCategoryForType(e.objectType);switch(s){case ye.OBJECT_UNDEFINED:(i===k.FLOOR||i===k.WALL||e.objectType===ft.MONSTER_PLANT)&&(e.altKey&&!e.ctrlKey&&!e.shiftKey||this.decorateModeMove(e))&&this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.REQUEST_MOVE,t,e.objectId,i));return}}handleRoomObjectMouseDownLongEvent(e,t){if(!e)return;let s=ye.OBJECT_UNDEFINED;const r=this.getSelectedRoomObjectData(t);r&&(s=r.operation);const i=this._roomEngine.getRoomObjectCategoryForType(e.objectType);switch(s){case ye.OBJECT_UNDEFINED:(i===k.FLOOR||i===k.WALL||e.objectType===ft.MONSTER_PLANT)&&(!e.ctrlKey&&!e.shiftKey||this.decorateModeMove(e))&&this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.REQUEST_MANIPULATION,t,e.objectId,i));return}}handleRoomObjectMouseEnterEvent(e,t){const s=e.objectId,r=e.objectType,i=this._roomEngine.getRoomObjectCategoryForType(r);this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.MOUSE_ENTER,t,s,i))}handleRoomObjectMouseLeaveEvent(e,t){const s=e.objectId,r=e.objectType,i=this._roomEngine.getRoomObjectCategoryForType(r);if(i!==k.ROOM&&i===k.UNIT){const a=this._roomEngine.getRoomObjectCursor(t);a&&a.processUpdateMessage(new Pt(0,null))}this._roomEngine.events&&this._roomEngine.events.dispatchEvent(new ue(ue.MOUSE_LEAVE,t,s,i))}onRoomObjectStateChangedEvent(e,t){if(e)switch(e.type){case it.STATE_CHANGE:this.changeObjectState(t,e.object.id,e.object.type,e.state,!1);return;case it.STATE_RANDOM:this.changeObjectState(t,e.object.id,e.object.type,e.state,!0);return}}onRoomObjectDimmerStateUpdateEvent(e,t){if(e)switch(e.type){case yc.DIMMER_STATE:this._roomEngine.events.dispatchEvent(new sR(t,e.state,e.presetId,e.effectId,e.color,e.brightness));return}}handleSelectedObjectRemove(e,t){if(!(!e||!this._roomEngine))switch(e.type){case hr.POSITION_CHANGED:{const s=e.objectId,r=e.objectType,i=this._roomEngine.getRoomObjectCategoryForType(r),a=this._roomEngine.getRoomObject(t,s,i),l=this._roomEngine.getRoomObjectSelectionArrow(t);if(a&&l&&l.logic){const c=a.getLocation();l.logic.processUpdateMessage(new Rs(c,null))}return}case hr.OBJECT_REMOVED:this.setSelectedAvatar(t,0,!1);return}}onRoomObjectWidgetRequestEvent(e,t){if(!e||!this._roomEngine)return;const s=e.objectId,r=e.objectType,i=this._roomEngine.getRoomObjectCategoryForType(r),a=this._roomEngine.events;if(a&&!Yn.isRoomPreviewerId(t))switch(e.type){case W.OPEN_WIDGET:a.dispatchEvent(new q(q.OPEN_WIDGET,t,s,i,e.object.logic.widget));return;case W.CLOSE_WIDGET:a.dispatchEvent(new q(q.CLOSE_WIDGET,t,s,i,e.object.logic.widget));return;case W.OPEN_FURNI_CONTEXT_MENU:a.dispatchEvent(new q(q.OPEN_FURNI_CONTEXT_MENU,t,s,i,e.object.logic.contextMenu));return;case W.CLOSE_FURNI_CONTEXT_MENU:a.dispatchEvent(new q(q.CLOSE_FURNI_CONTEXT_MENU,t,s,i));return;case W.PLACEHOLDER:a.dispatchEvent(new q(q.REQUEST_PLACEHOLDER,t,s,i));return;case W.CREDITFURNI:a.dispatchEvent(new q(q.REQUEST_CREDITFURNI,t,s,i));return;case W.STACK_HEIGHT:a.dispatchEvent(new q(q.REQUEST_STACK_HEIGHT,t,s,i));return;case W.EXTERNAL_IMAGE:a.dispatchEvent(new q(q.REQUEST_EXTERNAL_IMAGE,t,s,i));return;case W.STICKIE:a.dispatchEvent(new q(q.REQUEST_STICKIE,t,s,i));return;case W.PRESENT:a.dispatchEvent(new q(q.REQUEST_PRESENT,t,s,i));return;case W.TROPHY:a.dispatchEvent(new q(q.REQUEST_TROPHY,t,s,i));return;case W.TEASER:a.dispatchEvent(new q(q.REQUEST_TEASER,t,s,i));return;case W.ECOTRONBOX:a.dispatchEvent(new q(q.REQUEST_ECOTRONBOX,t,s,i));return;case W.DIMMER:a.dispatchEvent(new q(q.REQUEST_DIMMER,t,s,i));return;case W.WIDGET_REMOVE_DIMMER:a.dispatchEvent(new q(q.REMOVE_DIMMER,t,s,i));return;case W.CLOTHING_CHANGE:a.dispatchEvent(new q(q.REQUEST_CLOTHING_CHANGE,t,s,i));return;case W.JUKEBOX_PLAYLIST_EDITOR:a.dispatchEvent(new q(q.REQUEST_PLAYLIST_EDITOR,t,s,i));return;case W.MANNEQUIN:a.dispatchEvent(new q(q.REQUEST_MANNEQUIN,t,s,i));return;case W.PET_PRODUCT_MENU:a.dispatchEvent(new Sl(Sl.USE_PRODUCT_FROM_ROOM,t,s,i));return;case W.GUILD_FURNI_CONTEXT_MENU:this._roomEngine.connection.send(new DD(e.objectId,e.object.model.getValue(C.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID)));return;case W.MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:a.dispatchEvent(new q(q.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG,t,s,i));return;case W.PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:a.dispatchEvent(new q(q.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG,t,s,i));return;case W.BACKGROUND_COLOR:a.dispatchEvent(new q(q.REQUEST_BACKGROUND_COLOR,t,s,i));return;case W.MYSTERYBOX_OPEN_DIALOG:a.dispatchEvent(new q(q.REQUEST_MYSTERYBOX_OPEN_DIALOG,t,s,i));return;case W.EFFECTBOX_OPEN_DIALOG:a.dispatchEvent(new q(q.REQUEST_EFFECTBOX_OPEN_DIALOG,t,s,i));return;case W.MYSTERYTROPHY_OPEN_DIALOG:a.dispatchEvent(new q(q.REQUEST_MYSTERYTROPHY_OPEN_DIALOG,t,s,i));return;case W.ACHIEVEMENT_RESOLUTION_OPEN:this._roomEngine.connection.send(new Oy(e.objectId,0));return;case W.ACHIEVEMENT_RESOLUTION_ENGRAVING:a.dispatchEvent(new q(q.REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING,t,s,i));return;case W.ACHIEVEMENT_RESOLUTION_FAILED:a.dispatchEvent(new q(q.REQUEST_ACHIEVEMENT_RESOLUTION_FAILED,t,s,i));return;case W.FRIEND_FURNITURE_CONFIRM:a.dispatchEvent(new q(q.REQUEST_FRIEND_FURNITURE_CONFIRM,t,s,i));return;case W.FRIEND_FURNITURE_ENGRAVING:a.dispatchEvent(new q(q.REQUEST_FRIEND_FURNITURE_ENGRAVING,t,s,i));return;case W.BADGE_DISPLAY_ENGRAVING:a.dispatchEvent(new q(q.REQUEST_BADGE_DISPLAY_ENGRAVING,t,s,i));return;case W.HIGH_SCORE_DISPLAY:a.dispatchEvent(new q(q.REQUEST_HIGH_SCORE_DISPLAY,t,s,i));return;case W.HIDE_HIGH_SCORE_DISPLAY:a.dispatchEvent(new q(q.REQUEST_HIDE_HIGH_SCORE_DISPLAY,t,s,i));return;case W.INERNAL_LINK:a.dispatchEvent(new q(q.REQUEST_INTERNAL_LINK,t,s,i));return;case W.ROOM_LINK:a.dispatchEvent(new q(q.REQUEST_ROOM_LINK,t,s,i));return;case W.YOUTUBE:a.dispatchEvent(new q(q.REQUEST_YOUTUBE,t,s,i));return}}onRoomObjectFurnitureActionEvent(e,t){e&&this.useObject(t,e.object.id,e.object.type,e.type)}handleObjectSoundMachineEvent(e,t){if(!e)return;const s=this._roomEngine.getRoomObjectCategoryForType(e.objectType),r=this.getSelectedRoomObjectData(t);if(!(r&&r.category===s&&r.id===e.objectId&&r.operation===ye.OBJECT_PLACE))switch(e.type){case oe.SOUND_MACHINE_INIT:this._roomEngine.events.dispatchEvent(new Dt(Dt.SOUND_MACHINE_INIT,t,e.objectId,s));return;case oe.SOUND_MACHINE_START:this._roomEngine.events.dispatchEvent(new Dt(Dt.SOUND_MACHINE_SWITCHED_ON,t,e.objectId,s));return;case oe.SOUND_MACHINE_STOP:this._roomEngine.events.dispatchEvent(new Dt(Dt.SOUND_MACHINE_SWITCHED_OFF,t,e.objectId,s));return;case oe.SOUND_MACHINE_DISPOSE:this._roomEngine.events.dispatchEvent(new Dt(Dt.SOUND_MACHINE_DISPOSE,t,e.objectId,s));return}}handleObjectJukeboxEvent(e,t){if(!e)return;const s=this._roomEngine.getRoomObjectCategoryForType(e.objectType),r=this.getSelectedRoomObjectData(t);if(!(r&&r.category===s&&r.id===e.objectId&&r.operation===ye.OBJECT_PLACE))switch(e.type){case oe.JUKEBOX_INIT:this._roomEngine.events.dispatchEvent(new Dt(Dt.JUKEBOX_INIT,t,e.objectId,s));return;case oe.JUKEBOX_START:this._roomEngine.events.dispatchEvent(new Dt(Dt.JUKEBOX_SWITCHED_ON,t,e.objectId,s));return;case oe.JUKEBOX_MACHINE_STOP:this._roomEngine.events.dispatchEvent(new Dt(Dt.JUKEBOX_SWITCHED_OFF,t,e.objectId,s));return;case oe.JUKEBOX_DISPOSE:this._roomEngine.events.dispatchEvent(new Dt(Dt.JUKEBOX_DISPOSE,t,e.objectId,s));return}}onRoomObjectFloorHoleEvent(e,t){if(e)switch(e.type){case nr.ADD_HOLE:this._roomEngine.addRoomInstanceFloorHole(t,e.objectId);return;case nr.REMOVE_HOLE:this._roomEngine.removeRoomInstanceFloorHole(t,e.objectId);return}}onRoomObjectRoomAdEvent(e,t){if(!e)return;let s=null;switch(e.type){case Ut.ROOM_AD_FURNI_CLICK:this._roomEngine.events.dispatchEvent(e),e.clickUrl&&e.clickUrl.length>0&&pe.instance.createLinkEvent(e.clickUrl),s=gi.FURNI_CLICK;break;case Ut.ROOM_AD_FURNI_DOUBLE_CLICK:if(e.clickUrl&&e.clickUrl.length>0){const r="CATALOG_PAGE";e.clickUrl.indexOf(r)===0&&pe.instance.createLinkEvent(e.clickUrl.substr(r.length))}s=gi.FURNI_DOUBLE_CLICK;break;case Ut.ROOM_AD_TOOLTIP_SHOW:s=gi.TOOLTIP_SHOW;break;case Ut.ROOM_AD_TOOLTIP_HIDE:s=gi.TOOLTIP_HIDE;break}s&&this._roomEngine.events.dispatchEvent(new ue(s,t,e.objectId,this._roomEngine.getRoomObjectCategoryForType(e.objectType)))}onRoomObjectBadgeAssetEvent(e,t){if(!(!e||!this._roomEngine))switch(e.type){case _n.LOAD_BADGE:{const s=e.objectId,r=e.objectType,i=this._roomEngine.getRoomObjectCategoryForType(r);this._roomEngine.loadRoomObjectBadgeImage(t,s,i,e.badgeId,e.groupBadge);return}}}handleMousePointer(e,t){e&&this._roomEngine.updateMousePointer(e.type,e.objectId,e.objectType)}handleRoomObjectPlaySoundEvent(e,t){const s=this._roomEngine.getRoomObjectCategoryForType(e.objectType);switch(e.type){case Wn.PLAY_SOUND:this._roomEngine.events.dispatchEvent(new ll(ll.PLAY_SOUND,t,e.objectId,s,e.soundId,e.pitch));return;case Wn.PLAY_SOUND_AT_PITCH:this._roomEngine.events.dispatchEvent(new ll(ll.PLAY_SOUND_AT_PITCH,t,e.objectId,s,e.soundId,e.pitch));return}}handleRoomObjectSamplePlaybackEvent(e,t){if(!e)return;const s=this._roomEngine.getRoomObjectCategoryForType(e.objectType);switch(e.type){case is.ROOM_OBJECT_INITIALIZED:this._roomEngine.events.dispatchEvent(new Tr(Tr.ROOM_OBJECT_INITIALIZED,t,e.objectId,s,e.sampleId,e.pitch));break;case is.ROOM_OBJECT_DISPOSED:this._roomEngine.events.dispatchEvent(new Tr(Tr.ROOM_OBJECT_DISPOSED,t,e.objectId,s,e.sampleId,e.pitch));break;case is.PLAY_SAMPLE:this._roomEngine.events.dispatchEvent(new Tr(Tr.PLAY_SAMPLE,t,e.objectId,s,e.sampleId,e.pitch));break;case is.CHANGE_PITCH:this._roomEngine.events.dispatchEvent(new Tr(Tr.CHANGE_PITCH,t,e.objectId,s,e.sampleId,e.pitch));break}}onHSLColorEnableEvent(e,t){if(!(!e||!this._roomEngine))switch(e.type){case Sa.ROOM_BACKGROUND_COLOR:this._roomEngine.events.dispatchEvent(new yh(yh.ROOM_BACKGROUND_COLOR,t,e.enable,e.hue,e.saturation,e.lightness));return}}onRoomObjectDataRequestEvent(e,t){if(!(!e||!this._roomEngine||!e.object))switch(e.type){case fi.RODRE_CURRENT_USER_ID:e.object.model.setValue(C.SESSION_CURRENT_USER_ID,this._roomEngine.sessionDataManager.userId);return;case fi.RODRE_URL_PREFIX:e.object.model.setValue(C.SESSION_URL_PREFIX,Ue.getValue("url.prefix"));return}}onRoomObjectTileMouseEvent(e,t){if(!this._roomEngine||this._roomEngine.isDecorating||!this._roomEngine.roomSessionManager)return;const s=this._roomEngine.roomSessionManager.getSession(e);!s||s.isSpectator||this.sendWalkUpdate(t.tileXAsInt,t.tileYAsInt)}handleObjectMove(e,t){if(!e||!this._roomEngine||!this._roomEngine.events)return;const r=this.getSelectedRoomObjectData(t);if(!r)return;const i=this._roomEngine.getRoomObject(t,r.id,r.category);if(!i)return;let a=!0;if(r.category===k.FLOOR||r.category===k.UNIT){const l=this._roomEngine.getFurnitureStackingHeightMap(t);e instanceof yn&&this.handleFurnitureMove(i,r,Math.trunc(e.tileX+.5),Math.trunc(e.tileY+.5),l)||(this.handleFurnitureMove(i,r,r.loc.x,r.loc.y,l),a=!1)}else if(r.category===k.WALL){if(a=!1,e instanceof qo){const l=e.wallLocation,c=e.wallWidth,u=e.wallHeight,h=e.x,d=e.y,f=e.direction;this.handleWallItemMove(i,r,l,c,u,h,d,f)&&(a=!0)}a||(i.setLocation(r.loc),i.setDirection(r.dir)),this._roomEngine.updateRoomObjectMask(t,r.id,a)}a?(this.setFurnitureAlphaMultiplier(i,.5),this._roomEngine.setObjectMoverIconSpriteVisible(!1)):(this.setFurnitureAlphaMultiplier(i,0),this._roomEngine.setObjectMoverIconSpriteVisible(!0))}handleObjectPlace(e,t){if(!e||!this._roomEngine||!this._roomEngine.events)return;let r=this.getSelectedRoomObjectData(t);if(!r)return;let i=this._roomEngine.getRoomObject(t,r.id,r.category);if(!i){if(e instanceof yn){if(r.category===k.FLOOR)this._roomEngine.addFurnitureFloor(t,r.id,r.typeId,r.loc,r.dir,0,r.stuffData,parseFloat(r.instanceData),-1,0,0,"",!1);else if(r.category===k.UNIT){this._roomEngine.addRoomObjectUser(t,r.id,new F,new F(180),180,r.typeId,r.instanceData);const a=this._roomEngine.getRoomObject(t,r.id,r.category);a&&r.posture&&a.model.setValue(C.FIGURE_POSTURE,r.posture)}}else e instanceof qo&&r.category===k.WALL&&this._roomEngine.addFurnitureWall(t,r.id,r.typeId,r.loc,r.dir,0,r.instanceData,0);if(i=this._roomEngine.getRoomObject(t,r.id,r.category),i&&r.category===k.FLOOR){const a=i.model.getValue(C.FURNITURE_ALLOWED_DIRECTIONS);if(a&&a.length){const l=new F(a[0]);if(i.setDirection(l),this.updateSelectedObjectData(t,r.id,r.category,r.loc,l,r.operation,r.typeId,r.instanceData,r.stuffData,r.state,r.animFrame,r.posture),r=this.getSelectedRoomObjectData(t),!r)return}}this.setFurnitureAlphaMultiplier(i,.5),this._roomEngine.setObjectMoverIconSpriteVisible(!0)}if(i){let a=!0;const l=this._roomEngine.getFurnitureStackingHeightMap(t);if(r.category===k.FLOOR)e instanceof yn&&this.handleFurnitureMove(i,r,Math.trunc(e.tileX+.5),Math.trunc(e.tileY+.5),l)||(this._roomEngine.removeRoomObjectFloor(t,r.id),a=!1);else if(r.category===k.WALL){if(a=!1,e instanceof qo){const c=e.wallLocation,u=e.wallWidth,h=e.wallHeight,d=e.x,f=e.y,E=e.direction;this.handleWallItemMove(i,r,c,u,h,d,f,E)&&(a=!0)}a||this._roomEngine.removeRoomObjectWall(t,r.id),this._roomEngine.updateRoomObjectMask(t,r.id,a)}else r.category===k.UNIT&&(e instanceof yn&&this.handleUserPlace(i,Math.trunc(e.tileX+.5),Math.trunc(e.tileY+.5),this._roomEngine.getLegacyWallGeometry(t))||(this._roomEngine.removeRoomObjectUser(t,r.id),a=!1));this._roomEngine.setObjectMoverIconSpriteVisible(!a)}}handleFurnitureMove(e,t,s,r,i){if(!e||!t)return!1;const a=new F;a.assign(e.getDirection()),e.setDirection(t.dir);const l=new F(s,r,0),c=new F;c.assign(e.getDirection());let u=this.validateFurnitureLocation(e,l,t.loc,t.dir,i);return u||(c.x=this.getValidRoomObjectDirection(e,!0),e.setDirection(c),u=this.validateFurnitureLocation(e,l,t.loc,t.dir,i)),u?(e.setLocation(u),c&&e.setDirection(c),!0):(e.setDirection(a),!1)}handleWallItemMove(e,t,s,r,i,a,l,c){if(!e||!t)return!1;const u=new F(c),h=this.validateWallItemLocation(e,s,r,i,a,l,t);return h?(e.setLocation(h),e.setDirection(u),!0):!1}validateFurnitureLocation(e,t,s,r,i){if(!e||!e.model||!t)return null;let a=null;const l=e.getDirection();if(!l||!s||!r)return null;if(t.x===s.x&&t.y===s.y&&l.x===r.x)return a=new F,a.assign(s),a;let c=e.model.getValue(C.FURNITURE_SIZE_X),u=e.model.getValue(C.FURNITURE_SIZE_Y);c<1&&(c=1),u<1&&(u=1);const h=s.x,d=s.y;let f=c,E=u,m=0,R=Math.trunc(Math.trunc(l.x+45)%360/90);if((R===1||R===3)&&(m=c,c=u,u=m),R=Math.trunc(Math.trunc(r.x+45)%360/90),(R===1||R===3)&&(m=f,f=E,E=m),i&&t){const I=e.model.getValue(C.FURNITURE_ALWAYS_STACKABLE)===1;return i.validateLocation(t.x,t.y,c,u,h,d,f,E,I)?new F(t.x,t.y,i.getTileHeight(t.x,t.y)):null}return null}validateWallItemLocation(e,t,s,r,i,a,l){if(e==null||e.model==null||t==null||s==null||r==null||l==null)return null;const c=e.model.getValue(C.FURNITURE_SIZE_X),u=e.model.getValue(C.FURNITURE_SIZE_Z),h=e.model.getValue(C.FURNITURE_CENTER_Z);if((i<c/2||i>s.length-c/2||a<h||a>r.length-(u-h))&&(i<c/2&&i<=s.length-c/2?i=c/2:i>=c/2&&i>s.length-c/2&&(i=s.length-c/2),a<h&&a<=r.length-(u-h)?a=h:a>=h&&a>r.length-(u-h)&&(a=r.length-(u-h))),i<c/2||i>s.length-c/2||a<h||a>r.length-(u-h))return null;let d=F.sum(F.product(s,i/s.length),F.product(r,a/r.length));return d=F.sum(t,d),d}changeObjectState(e,t,s,r,i){const a=this._roomEngine.getRoomObjectCategoryForType(s);this.changeRoomObjectState(e,t,a,r,i)}useObject(e,t,s,r){if(!(!this._roomEngine||!this._roomEngine.connection))switch(r){case oe.DICE_ACTIVATE:this._roomEngine.connection.send(new LD(t));return;case oe.DICE_OFF:this._roomEngine.connection.send(new UD(t));return;case oe.USE_HABBOWHEEL:this._roomEngine.connection.send(new PD(t));return;case oe.STICKIE:this._roomEngine.connection.send(new ED(t));return;case oe.ENTER_ONEWAYDOOR:this._roomEngine.connection.send(new xD(t));return}}changeRoomObjectState(e,t,s,r,i){return!this._roomEngine||!this._roomEngine.connection||(s===k.FLOOR?i?this._roomEngine.connection.send(new wD(t,r)):this._roomEngine.connection.send(new Ml(t,r)):s===k.WALL&&this._roomEngine.connection.send(new GD(t,r))),!0}sendWalkUpdate(e,t){!this._roomEngine||!this._roomEngine.connection||this._roomEngine.connection.send(new cv(e,t))}handleMouseOverObject(e,t,s){if(e!==k.FLOOR)return null;const r=this._roomEngine.getRoomObject(t,s.objectId,k.FLOOR);if(!r)return null;const i=this.getActiveSurfaceLocation(r,s);if(!i||!this._roomEngine.getFurnitureStackingHeightMap(t))return null;const l=i.x,c=i.y,u=i.z;return new Jo(new F(l,c,r.getLocation().z),u,!0,s.eventId)}handleMoveTargetFurni(e,t){if(t.objectType===ft.USER||t.objectType===ft.PET||t.objectType===ft.BOT||t.objectType===ft.RENTABLE_BOT||t.objectType===ft.MONSTER_PLANT)return;const s=this._roomEngine.getRoomObject(e,t.objectId,k.FLOOR),r=this.getActiveSurfaceLocation(s,t);return r?(this.sendWalkUpdate(r.x,r.y),!0):!1}getActiveSurfaceLocation(e,t){if(!e||!t)return null;const s=this._roomEngine.sessionDataManager.getFloorItemDataByName(e.type);if(!s||!s.canStandOn&&!s.canSitOn&&!s.canLayOn)return null;const r=e.model;if(!r)return null;const i=e.getLocation(),a=e.getDirection();let l=r.getValue(C.FURNITURE_SIZE_X),c=r.getValue(C.FURNITURE_SIZE_Y);const u=r.getValue(C.FURNITURE_SIZE_Z);(a.x===90||a.x===270)&&([l,c]=[c,l]),l<1&&(l=1),c<1&&(c=1);const h=this._roomEngine.getActiveRoomInstanceRenderingCanvas();if(!h)return null;const d=h.geometry.scale,f=s.canSitOn?.5:0,E=(d/2+t.spriteOffsetX+t.localX)/(d/4),m=(t.spriteOffsetY+t.localY+(u-f)*d/2)/(d/4),R=(E+2*m)/4,I=(E-2*m)/4,S=Math.floor(i.x+R),A=Math.floor(i.y-I+1);let N=!1;(S<i.x||S>=i.x+l||A<i.y||A>=i.y+c)&&(N=!0);const L=s.canSitOn?u-.5:u;return N?null:new F(S,A,L)}handleMouseOverTile(e,t){if(this._whereYouClickIsWhereYouGo)return new Jo(new F(e.tileXAsInt,e.tileYAsInt,e.tileZAsInt),0,!0,e.eventId);const s=this._roomEngine.getRoomObjectCursor(t);if(s&&s.visualization){const r=e.tileXAsInt,i=e.tileYAsInt,a=e.tileZAsInt;if(this._roomEngine.getRoomInstance(t)){const c=this._roomEngine.getRoomTileObjectMap(t);if(c){const u=c.getObjectIntTile(r,i),h=this._roomEngine.getFurnitureStackingHeightMap(t);if(h){if(u&&u.model&&u.model.getValue(C.FURNITURE_IS_VARIABLE_HEIGHT)>0){const d=h.getTileHeight(r,i),f=this._roomEngine.getLegacyWallGeometry(t).getHeight(r,i);return new Jo(new F(r,i,a),d-f,!0,e.eventId)}return new Jo(new F(r,i,a),0,!0,e.eventId)}}}}return null}placeObject(e,t,s){const r=this.getSelectedRoomObjectData(e);if(!r)return;let i=null,a=r.id;const l=r.category;let c=0,u=0,h=0,d=0,f="";if(this._roomEngine&&this._roomEngine.connection&&(i=this._roomEngine.getRoomObject(e,a,l),i)){const E=i.getLocation();if(d=i.getDirection().x,l===k.FLOOR||l===k.UNIT)c=E.x,u=E.y,h=E.z;else if(l===k.WALL){c=E.x,u=E.y,h=E.z;const m=this._roomEngine.getLegacyWallGeometry(e);m&&(f=m.getOldLocationString(E,d))}d=(d/45%8+8)%8,a<0&&l===k.UNIT&&(a=a*-1),this._objectPlacementSource!==xa.CATALOG&&(l===k.UNIT?r.typeId===Rt.PET?this._roomEngine.connection.send(new ID(a,Math.trunc(c),Math.trunc(u))):r.typeId===Rt.RENTABLE_BOT&&this._roomEngine.connection.send(new gD(a,Math.trunc(c),Math.trunc(u))):i.model.getValue(C.FURNITURE_IS_STICKIE)!==void 0?this._roomEngine.connection.send(new bD(a,f)):this._roomEngine.connection.send(new cE(a,l,f,Math.trunc(c),Math.trunc(u),d)))}if(this._roomEngine.setPlacedRoomObjectData(e,new L_(r.id,r.category,null,r.dir,null)),this.resetSelectedObjectData(e),this._roomEngine&&this._roomEngine.events){const E=i&&i.id===r.id;this._roomEngine.events.dispatchEvent(new pg(ue.PLACED,e,a,l,f,c,u,h,d,E,t,s,r.instanceData))}}modifyRoomObject(e,t,s,r){if(!this._roomEngine)return!1;const i=this._roomEngine.getRoomObject(e,t,s);if(!i)return!1;let a=!0;switch(r){case ye.OBJECT_ROTATE_POSITIVE:case ye.OBJECT_ROTATE_NEGATIVE:if(this._roomEngine.connection){let l=0;r==ye.OBJECT_ROTATE_NEGATIVE?l=this.getValidRoomObjectDirection(i,!1):l=this.getValidRoomObjectDirection(i,!0);const c=i.getLocation().x,u=i.getLocation().y;if(this.isValidLocation(i,new F(l),this._roomEngine.getFurnitureStackingHeightMap(e)))if(l=Math.trunc(l/45),i.type===ft.MONSTER_PLANT){const h=this._roomEngine.roomSessionManager.getSession(e);if(h){const d=h.userDataManager.getUserDataByIndex(t);d&&this._roomEngine.connection.send(new Ef(d.webID,Math.trunc(c),Math.trunc(u),l))}}else this._roomEngine.connection.send(new pf(t,c,u,l))}break;case ye.OBJECT_EJECT:case ye.OBJECT_PICKUP:this._roomEngine.connection&&this._roomEngine.connection.send(new vD(s,t));break;case ye.OBJECT_PICKUP_PET:if(this._roomEngine.connection){const l=this._roomEngine.roomSessionManager.getSession(e);if(l){const c=l.userDataManager.getUserDataByIndex(t);l.pickupPet(c.webID)}}break;case ye.OBJECT_PICKUP_BOT:if(this._roomEngine.connection){const l=this._roomEngine.roomSessionManager.getSession(e);if(l){const c=l.userDataManager.getUserDataByIndex(t);l.pickupBot(c.webID)}}break;case ye.OBJECT_MOVE:a=!1,this.setFurnitureAlphaMultiplier(i,.5),this.setSelectedRoomObjectData(e,i.id,s,i.getLocation(),i.getDirection(),r),this._roomEngine.setObjectMoverIconSprite(i.id,s,!0),this._roomEngine.setObjectMoverIconSpriteVisible(!1);break;case ye.OBJECT_MOVE_TO:{const l=this.getSelectedRoomObjectData(e);if(this.updateSelectedObjectData(e,l.id,l.category,l.loc,l.dir,ye.OBJECT_MOVE_TO,l.typeId,l.instanceData,l.stuffData,l.state,l.animFrame,l.posture),this.setFurnitureAlphaMultiplier(i,1),this._roomEngine.removeObjectMoverIconSprite(),this._roomEngine.connection){if(s===k.FLOOR){const c=i.getDirection().x%360,u=i.getLocation(),h=c/45;this._roomEngine.connection.send(new pf(t,u.x,u.y,h))}else if(s===k.WALL){const c=i.getDirection().x%360,u=this._roomEngine.getLegacyWallGeometry(e);if(u){const h=u.getOldLocationString(i.getLocation(),c);h&&this._roomEngine.connection.send(new WD(t,h))}}else if(s===k.UNIT){const c=i.getDirection().x%360,u=i.getLocation(),h=c/45;parseInt(i.model.getValue(C.RACE));const d=this._roomEngine.roomSessionManager.getSession(e);if(d){const f=d.userDataManager.getUserDataByIndex(t);f&&this._roomEngine.connection.send(new Ef(f.webID,u.x,u.y,h))}}}break}}return a&&this.resetSelectedObjectData(e),!0}modifyRoomObjectDataWithMap(e,t,s,r,i){if(!this._roomEngine||!this._roomEngine.getRoomObject(e,t,s))return!1;switch(r){case ye.OBJECT_SAVE_STUFF_DATA:this._roomEngine.connection&&this._roomEngine.connection.send(new lE(t,i));break}return!0}modifyWallItemData(e,t,s,r){return!this._roomEngine||!this._roomEngine.connection?!1:(this._roomEngine.connection.send(new SD(t,s,r)),!0)}deleteWallItem(e,t){return!this._roomEngine||!this._roomEngine.connection?!1:(this._roomEngine.connection.send(new RD(t)),!0)}getValidRoomObjectDirection(e,t){if(!e||!e.model)return 0;let s=0,r=0,i=[];e.type===ft.MONSTER_PLANT?i=e.model.getValue(C.PET_ALLOWED_DIRECTIONS):i=e.model.getValue(C.FURNITURE_ALLOWED_DIRECTIONS);let a=e.getDirection().x;if(i&&i.length){if(s=i.indexOf(a),s<0){for(s=0,r=0;r<i.length&&!(a<=i[r]);)s++,r++;s=s%i.length}t?s=(s+1)%i.length:s=(s-1+i.length)%i.length,a=i[s]}return a}isValidLocation(e,t,s){if(!e||!e.model||!t)return!1;const r=e.getDirection(),i=e.getLocation();if(!r||!i)return!1;if(r.x%180===t.x%180)return!0;let a=e.model.getValue(C.FURNITURE_SIZE_X),l=e.model.getValue(C.FURNITURE_SIZE_Y);a<1&&(a=1),l<1&&(l=1);let c=a,u=l,h=Math.trunc(Math.trunc(t.x+45)%360/90);if((h===1||h===3)&&([a,l]=[l,a]),h=Math.trunc(Math.trunc(r.x+45)%360/90),(h===1||h===3)&&([c,u]=[u,c]),s&&i){const d=e.model.getValue(C.FURNITURE_ALWAYS_STACKABLE)===1;if(s.validateLocation(i.x,i.y,a,l,i.x,i.y,c,u,d,i.z))return!0}return!1}placeObjectOnUser(e,t,s){const r=this.getSelectedRoomObjectData(e);!r||!this._roomEngine.getRoomObject(e,t,s)||!this._roomEngine||!this._roomEngine.events||this._roomEngine.events.dispatchEvent(new qU(ue.PLACED_ON_USER,e,t,s,r.id,r.category))}setSelectedObject(e,t,s){if(!this._roomEngine)return;const r=this._roomEngine.events;if(r)switch(s){case k.UNIT:case k.FLOOR:case k.WALL:if(s===k.UNIT)this.deselectObject(e),this.setSelectedAvatar(e,t,!0);else if(this.setSelectedAvatar(e,0,!1),t!==this._selectedObjectId){this.deselectObject(e);const i=this._roomEngine.getRoomObject(e,t,s);i&&i.logic&&(i.logic.processUpdateMessage(new kc(!0)),this._selectedObjectId=t,this._selectedObjectCategory=s)}r.dispatchEvent(new ue(ue.SELECTED,e,t,s));return}}deselectObject(e){if(this._selectedObjectId===-1)return;const t=this._roomEngine.getRoomObject(e,this._selectedObjectId,this._selectedObjectCategory);t&&t.logic&&(t.logic.processUpdateMessage(new kc(!1)),this._selectedObjectId=-1,this._selectedObjectCategory=k.MINIMUM)}setSelectedAvatar(e,t,s){if(!this._roomEngine)return;const r=k.UNIT,i=this._roomEngine.getRoomObject(e,this._selectedAvatarId,r);i&&i.logic&&(i.logic.processUpdateMessage(new qh(!1)),this._selectedAvatarId=-1);let a=!1;if(s){const c=this._roomEngine.getRoomObject(e,t,r);if(c&&c.logic){c.logic.processUpdateMessage(new qh(!0)),a=!0,this._selectedAvatarId=t;const u=c.getLocation();u&&this._roomEngine.connection.send(new av(~~u.x,~~u.y))}}const l=this._roomEngine.getRoomObjectSelectionArrow(e);l&&l.logic&&(a&&!this._roomEngine.isPlayingGame()?l.logic.processUpdateMessage(new Qn(Qn.ENABLED)):l.logic.processUpdateMessage(new Qn(Qn.DISABLED)))}resetSelectedObjectData(e){if(!this._roomEngine)return;this._roomEngine.removeObjectMoverIconSprite();const t=this.getSelectedRoomObjectData(e);if(t){if(t.operation===ye.OBJECT_MOVE||t.operation===ye.OBJECT_MOVE_TO){const s=this._roomEngine.getRoomObject(e,t.id,t.category);s&&t.operation!==ye.OBJECT_MOVE_TO&&(s.setLocation(t.loc),s.setDirection(t.dir)),this.setFurnitureAlphaMultiplier(s,1),t.category===k.WALL&&this._roomEngine.updateRoomObjectMask(e,t.id,!0),this.updateSelectedObjectData(e,t.id,t.category,t.loc,t.dir,ye.OBJECT_MOVE,t.typeId,t.instanceData,t.stuffData,t.state,t.animFrame,t.posture)}else if(t.operation===ye.OBJECT_PLACE){const s=t.id;switch(t.category){case k.FLOOR:this._roomEngine.removeRoomObjectFloor(e,s);break;case k.WALL:this._roomEngine.removeRoomObjectWall(e,s);break;case k.UNIT:this._roomEngine.removeRoomObjectUser(e,s);break}}this._roomEngine.setSelectedRoomObjectData(e,null)}}getSelectedRoomObjectData(e){return this._roomEngine?this._roomEngine.getSelectedRoomObjectData(e):null}setFurnitureAlphaMultiplier(e,t){!e||!e.model||e.model.setValue(C.FURNITURE_ALPHA_MULTIPLIER,t)}decorateModeMove(e){return this._roomEngine.isDecorating&&!(e.ctrlKey||e.shiftKey)}cancelRoomObjectPlacement(e){return this.resetSelectedObjectData(e),!0}setSelectedRoomObjectData(e,t,s,r,i,a,l=0,c=null,u=null,h=-1,d=-1,f=null){if(this.resetSelectedObjectData(e),!this._roomEngine)return;const E=new L_(t,s,a,r,i,l,c,u,h,d,f);this._roomEngine.setSelectedRoomObjectData(e,E)}updateSelectedObjectData(e,t,s,r,i,a,l=0,c=null,u=null,h=-1,d=-1,f=null){if(!this._roomEngine)return null;const E=new L_(t,s,a,r,i,l,c,u,h,d,f);this._roomEngine.setSelectedRoomObjectData(e,E)}handleUserPlace(e,t,s,r){return r.isRoomTile(t,s)?(e.setLocation(new F(t,s,r.getHeight(t,s))),!0):!1}get engine(){return this._roomEngine}get selectedAvatarId(){return this._selectedAvatarId}}class pX{constructor(){this._events=new jr,this._cachedEvents=new Map,this._registeredEvents=new Map,this._functions=[]}getLogic(e){const t=this.getLogicType(e);if(!t)return null;const s=new t;if(!s)return null;if(s.eventDispatcher=this._events,!this._cachedEvents.get(e)){this._cachedEvents.set(e,!0);const r=s.getEventTypes();for(const i of r)i&&this.registerEventType(i)}return s}registerEventType(e){if(!this._registeredEvents.get(e)){this._registeredEvents.set(e,!0);for(const t of this._functions)t&&this._events.addEventListener(e,t)}}registerEventFunction(e){if(e&&!(this._functions.indexOf(e)>=0)){this._functions.push(e);for(const t of this._registeredEvents.keys())t&&this._events.addEventListener(t,e)}}removeEventFunction(e){if(!e)return;const t=this._functions.indexOf(e);if(t!==-1){this._functions.splice(t,1);for(const s of this._registeredEvents.keys())s&&this._events.removeEventListener(s,e)}}getLogicType(e){if(!e)return null;let t=null;switch(e){case Z.ROOM:t=l4;break;case Z.TILE_CURSOR:t=u4;break;case Z.SELECTION_ARROW:t=c4;break;case Z.USER:case Z.BOT:case Z.RENTABLE_BOT:t=tK;break;case Z.PET:t=i4;break;case Z.FURNITURE_BASIC:t=St;break;case Z.FURNITURE_BADGE_DISPLAY:t=nb;break;case Z.FURNITURE_CHANGE_STATE_WHEN_STEP_ON:t=rK;break;case Z.FURNITURE_COUNTER_CLOCK:t=nK;break;case Z.FURNITURE_CRACKABLE:t=aK;break;case Z.FURNITURE_CREDIT:t=lK;break;case Z.FURNITURE_CUSTOM_STACK_HEIGHT:t=uK;break;case Z.FURNITURE_DICE:t=hK;break;case Z.FURNITURE_EDITABLE_INTERNAL_LINK:t=_K;break;case Z.FURNITURE_EDITABLE_ROOM_LINK:t=gK;break;case Z.FURNITURE_EXTERNAL_IMAGE_WALLITEM:t=mK;break;case Z.FURNITURE_FIREWORKS:t=EK;break;case Z.FURNITURE_FLOOR_HOLE:t=pK;break;case Z.FURNITURE_GUILD_CUSTOMIZED:t=lb;break;case Z.FURNITURE_HIGH_SCORE:t=RK;break;case Z.FURNITURE_HOCKEY_SCORE:t=OK;break;case Z.FURNITURE_ES:t=CK;break;case Z.FURNITURE_MANNEQUIN:t=MK;break;case Z.FURNITURE_MULTIHEIGHT:t=vK;break;case Z.FURNITURE_MULTISTATE:t=hs;break;case Z.FURNITURE_ONE_WAY_DOOR:t=LK;break;case Z.FURNITURE_PET_CUSTOMIZATION:t=UK;break;case Z.FURNITURE_PRESENT:t=wK;break;case Z.FURNITURE_PURCHASABLE_CLOTHING:t=GK;break;case Z.FURNITURE_PUSHABLE:t=BK;break;case Z.FURNITURE_BACKGROUND_COLOR:t=jK;break;case Z.FURNITURE_BG:t=WK;break;case Z.FURNITURE_BB:t=YK;break;case Z.FURNITURE_ROOMDIMMER:t=zK;break;case Z.FURNITURE_SCORE:t=KK;break;case Z.FURNITURE_SOUNDBLOCK:t=qK;break;case Z.FURNITURE_STICKIE:t=JK;break;case Z.FURNITURE_TROPHY:t=ZK;break;case Z.FURNITURE_VOTE_COUNTER:t=$K;break;case Z.FURNITURE_VOTE_MAJORITY:t=e4;break;case Z.FURNITURE_WINDOW:t=s4;break;case Z.FURNITURE_LOVELOCK:t=yK;break;case Z.FURNITURE_YOUTUBE:t=r4;break;case Z.FURNITURE_CRAFTING_GIZMO:t=oK;break;case Z.FURNITURE_RENTABLE_SPACE:t=HK;break;case Z.FURNITURE_EFFECTBOX:t=fK;break;case Z.FURNITURE_MONSTERPLANT_SEED:t=DK;break;case Z.FURNITURE_MYSTERYBOX:t=bK;break;case Z.FURNITURE_MYSTERYTROPHY:t=PK;break;case Z.FURNITURE_RANDOM_TELEPORT:t=VK;break;case Z.FURNITURE_CLOTHING_CHANGE:t=iK;break;case Z.FURNITURE_CUCKOO_CLOCK:t=cK;break;case Z.FURNITURE_ECOTRON_BOX:t=dK;break;case Z.FURNITURE_GROUP_FORUM_TERMINAL:t=IK;break;case Z.FURNITURE_HWEEN_LOVELOCK:t=SK;break;case Z.FURNITURE_INTERNAL_LINK:t=AK;break;case Z.FURNITURE_JUKEBOX:t=NK;break;case Z.FURNITURE_PLACEHOLDER:t=FK;break;case Z.FURNITURE_PLANET_SYSTEM:t=xK;break;case Z.FURNITURE_RANDOMSTATE:t=kK;break;case Z.FURNITURE_SONG_DISK:t=XK;break;case Z.FURNITURE_SOUND_MACHINE:t=QK;break;case Z.FURNITURE_WELCOME_GIFT:t=t4;break;case Z.FURNITURE_ACHIEVEMENT_RESOLUTION:t=sK;break;case Z.FURNITURE_HABBOWHEEL:t=TK;break;default:t=St;break}return t||(me.warn("Unknown Logic",e),null)}get events(){return this._events}}const Xi=class Lt extends En{constructor(e){super(),this._communication=e,this._sessionDataManager=null,this._roomSessionManager=null,this._roomManager=null,this._roomObjectEventHandler=new EX(this),this._roomMessageHandler=new mX(this),this._roomContentLoader=new hh,this._ready=!1,this._roomContentLoaderReady=!1,this._activeRoomId=-1,this._activeRoomActiveCanvas=-1,this._roomInstanceDatas=new Map,this._roomDatas=new Map,this._roomRendererFactory=new Z0,this._visualizationFactory=new cX,this._logicFactory=new pX,this._activeRoomActiveCanvasMouseX=0,this._activeRoomActiveCanvasMouseY=0,this._activeRoomIsDragged=!1,this._activeRoomWasDragged=!1,this._activeRoomDragStartX=0,this._activeRoomDragStartY=0,this._activeRoomDragX=0,this._activeRoomDragY=0,this._skipFurnitureCreationForNextFrame=!1,this._mouseCursorUpdate=!1,this._imageObjectIdBank=null,this._imageCallbacks=new Map,this._thumbnailCallbacks=new Map,this._roomDraggingAlwaysCenters=!1,this._roomAllowsDragging=!0,this._badgeListenerObjects=new Map,this.runVisibilityUpdate=this.runVisibilityUpdate.bind(this),this.processRoomObjectEvent=this.processRoomObjectEvent.bind(this),this.onRoomSessionEvent=this.onRoomSessionEvent.bind(this),this.onRoomContentLoaderReadyEvent=this.onRoomContentLoaderReadyEvent.bind(this),this.onBadgeImageReadyEvent=this.onBadgeImageReadyEvent.bind(this)}onInit(){this._ready||(this._imageObjectIdBank=new vp(1e3),this._thumbnailObjectIdBank=new vp(1e3),this._logicFactory.registerEventFunction(this.processRoomObjectEvent),this._roomManager&&(this._roomManager.setContentLoader(this._roomContentLoader),this._roomManager.addUpdateCategory(k.FLOOR),this._roomManager.addUpdateCategory(k.WALL),this._roomManager.addUpdateCategory(k.UNIT),this._roomManager.addUpdateCategory(k.CURSOR),this._roomManager.addUpdateCategory(k.ROOM)),this._roomMessageHandler.setConnection(this._communication.connection),this._roomContentLoader.initialize(this.events),this._roomContentLoader.setSessionDataManager(this._sessionDataManager),this._roomContentLoader.setIconListener(this),this._roomSessionManager&&(this._roomSessionManager.events.addEventListener(Ne.STARTED,this.onRoomSessionEvent),this._roomSessionManager.events.addEventListener(Ne.ENDED,this.onRoomSessionEvent)),this.events.addEventListener(hh.LOADER_READY,this.onRoomContentLoaderReadyEvent),qs().add(this.update,this),document.addEventListener("visibilitychange",this.runVisibilityUpdate))}onDispose(){if(this._ready){for(const[e,t]of this._roomInstanceDatas)this.removeRoomInstance(e);document.removeEventListener("visibilitychange",this.runVisibilityUpdate),qs().remove(this.update,this),this._roomObjectEventHandler&&this._roomObjectEventHandler.dispose(),this._roomMessageHandler&&this._roomMessageHandler.dispose(),this._roomContentLoader&&this._roomContentLoader.dispose(),this.events.removeEventListener(hh.LOADER_READY,this.onRoomContentLoaderReadyEvent),this._roomSessionManager&&(this._roomSessionManager.events.removeEventListener(Ne.STARTED,this.onRoomSessionEvent),this._roomSessionManager.events.removeEventListener(Ne.ENDED,this.onRoomSessionEvent)),super.onDispose()}}onRoomSessionEvent(e){if(e instanceof Ne)switch(e.type){case Ne.STARTED:this._roomMessageHandler&&this._roomMessageHandler.setRoomId(e.session.roomId);return;case Ne.ENDED:this._roomMessageHandler&&(this._roomMessageHandler.clearRoomId(),this.removeRoomInstance(e.session.roomId));return}}onRoomContentLoaderReadyEvent(e){this._roomContentLoaderReady=!0,this._roomManager.init()}setActiveRoomId(e){this._activeRoomId=e}destroyRoom(e){this.removeRoomInstance(e)}getRoomInstance(e){return this._roomManager&&this._roomManager.getRoomInstance(this.getRoomId(e))||null}removeRoomInstance(e){this.getRoomInstance(e)&&this._roomManager&&this._roomManager.removeRoomInstance(this.getRoomId(e));const s=this._roomInstanceDatas.get(e);s&&(this._roomInstanceDatas.delete(s.roomId),s.dispose()),this.events.dispatchEvent(new je(je.DISPOSED,e))}createRoomInstance(e,t){let s="111",r="201",i="1";if(!this._ready){let c=this._roomDatas.get(e);c&&(this._roomDatas.delete(e),s=c.floorType,r=c.wallType,i=c.landscapeType),c=new Bp(e,t),c.floorType=s,c.wallType=r,c.landscapeType=i,this._roomDatas.set(e,c),me.warn("Room Engine not initilized yet, can not create room. Room data stored for later initialization.");return}if(!t){me.warn("Room property messages");return}const a=this._roomDatas.get(e);a&&(this._roomDatas.delete(e),a.floorType&&(s=a.floorType),a.wallType&&(r=a.wallType),a.landscapeType&&(i=a.landscapeType)),this.setupRoomInstance(e,t,s,r,i,this.getRoomInstanceModelName(e))&&(t.restrictsDragging?this._roomAllowsDragging=!1:this._roomAllowsDragging=!0,this.events.dispatchEvent(new je(je.INITIALIZED,e)))}setupRoomInstance(e,t,s,r,i,a){if(!this._ready||!this._roomManager)return;const l=this._roomManager.createRoomInstance(this.getRoomId(e));if(!l)return null;const c=k.ROOM,u=l.createRoomObjectAndInitalize(Lt.ROOM_OBJECT_ID,Lt.ROOM_OBJECT_TYPE,c);if(l.model.setValue(pt.ROOM_IS_PUBLIC,0),l.model.setValue(pt.ROOM_Z_SCALE,1),t&&(l.model.setValue(pt.RESTRICTS_DRAGGING,t.restrictsDragging),l.model.setValue(pt.RESTRICTS_SCALING,t.restrictsScaling),l.model.setValue(pt.RESTRICTED_SCALE,t.restrictedScale),t.dimensions)){const f=t.dimensions.minX,E=t.dimensions.maxX,m=t.dimensions.minY,R=t.dimensions.maxY;l.model.setValue(pt.ROOM_MIN_X,f),l.model.setValue(pt.ROOM_MAX_X,E),l.model.setValue(pt.ROOM_MIN_Y,m),l.model.setValue(pt.ROOM_MAX_Y,R);const I=Math.trunc(f*423+E*671+m*913+R*7509);u&&u.model&&u.model.setValue(C.ROOM_RANDOM_SEED,I)}const h=u&&u.logic||null;if(h&&(h.initialize(t),s&&(h.processUpdateMessage(new ks(ks.ROOM_FLOOR_UPDATE,s)),l.model.setValue(C.ROOM_FLOOR_TYPE,s)),r&&(h.processUpdateMessage(new ks(ks.ROOM_WALL_UPDATE,r)),l.model.setValue(C.ROOM_WALL_TYPE,r)),i&&(h.processUpdateMessage(new ks(ks.ROOM_LANDSCAPE_UPDATE,i)),l.model.setValue(C.ROOM_LANDSCAPE_TYPE,i))),t&&t.doors.length){let d=0;for(;d<t.doors.length;){const f=t.doors[d];if(f){const E=f.x,m=f.y,R=f.z,I=f.dir,S=Vs.DOOR,A="door_"+d,N=new F(E,m,R);h.processUpdateMessage(new Vs(Vs.ADD_MASK,A,S,N,Vs.HOLE)),(I===90||I===180)&&(I===90&&(l.model.setValue(C.ROOM_DOOR_X,E-.5),l.model.setValue(C.ROOM_DOOR_Y,m)),I===180&&(l.model.setValue(C.ROOM_DOOR_X,E),l.model.setValue(C.ROOM_DOOR_Y,m-.5)),l.model.setValue(C.ROOM_DOOR_Z,R),l.model.setValue(C.ROOM_DOOR_DIR,I))}d++}}return l.createRoomObjectAndInitalize(Lt.CURSOR_OBJECT_ID,Lt.CURSOR_OBJECT_TYPE,k.CURSOR),Ue.getValue("enable.avatar.arrow",!1)&&l.createRoomObjectAndInitalize(Lt.ARROW_OBJECT_ID,Lt.ARROW_OBJECT_TYPE,k.CURSOR),l}getRoomInstanceDisplay(e,t,s,r,i){const a=this.getRoomInstance(e);if(!a)return null;let l=a.renderer;if(!l&&(l=this._roomRendererFactory.createRenderer(),!l))return null;l.roomObjectVariableAccurateZ=C.OBJECT_ACCURATE_Z_VALUE,a.setRenderer(l);const c=l.createCanvas(t,s,r,i);if(!c)return null;if(a.model.getValue(pt.RESTRICTS_SCALING)){let h=a.model.getValue(pt.RESTRICTED_SCALE);h||(h=1),c.setScale(h),c.restrictsScaling=!0}else c.restrictsScaling=!1;if(c.setMouseListener(this._roomObjectEventHandler),c.geometry){c.geometry.z_scale=a.model.getValue(pt.ROOM_Z_SCALE);const h=a.model.getValue(C.ROOM_DOOR_X),d=a.model.getValue(C.ROOM_DOOR_Y),f=a.model.getValue(C.ROOM_DOOR_Z),E=a.model.getValue(C.ROOM_DOOR_DIR),m=new F(h,d,f);let R=null;E===90&&(R=new F(-2e3,0,0)),E===180&&(R=new F(0,-2e3,0)),c.geometry.setDisplacement(m,R);const I=c.master;if(I){const S=new jt(ts.EMPTY);S.name=Lt.OVERLAY,S.interactive=!1,I.addChild(S)}}return c.master}setRoomInstanceRenderingCanvasMask(e,t,s){const r=this.getRoomInstanceRenderingCanvas(e,t);r&&r.setMask(s)}setRoomInstanceRenderingCanvasScale(e,t,s,r=null,i=null,a=!1,l=!1){const c=this.getRoomInstanceRenderingCanvas(e,t);if(c){if(c.restrictsScaling&&!a)return;c.setScale(s,r,i,a,l),this.events.dispatchEvent(new je(je.ROOM_ZOOMED,e))}}getRoomInstanceRenderingCanvas(e,t=-1){const s=this.getRoomInstance(e);if(!s)return null;const r=s.renderer;if(!r)return null;t===-1&&(t=this._activeRoomActiveCanvas);const i=r.getCanvas(t);return i||null}getActiveRoomInstanceRenderingCanvas(){return this.getRoomInstanceRenderingCanvas(this._activeRoomId,this._activeRoomActiveCanvas)}getRoomInstanceRenderingCanvasOffset(e,t=-1){t===-1&&(t=this._activeRoomActiveCanvas);const s=this.getRoomInstanceRenderingCanvas(e,t);return s?new Fe(s.screenOffsetX,s.screenOffsetY):null}setRoomInstanceRenderingCanvasOffset(e,t,s){const r=this.getRoomInstanceRenderingCanvas(e,t);if(!r||!s)return!1;const i=~~s.x,a=~~s.y;if(!(r.screenOffsetX===i&&r.screenOffsetY===a))return this.events.dispatchEvent(new $T(e,-(r.screenOffsetX-i),-(r.screenOffsetY-a))),r.screenOffsetX=i,r.screenOffsetY=a,!0}getRoomInstanceRenderingCanvasScale(e=-1e3,t=-1){e===-1e3&&(e=this._activeRoomId),t===-1&&(t=this._activeRoomActiveCanvas);const s=this.getRoomInstanceRenderingCanvas(e,t);return s?s.scale:1}initializeRoomInstanceRenderingCanvas(e,t,s,r){const i=this.getRoomInstanceRenderingCanvas(e,t);i&&i.initialize(s,r)}getRoomInstanceGeometry(e,t=-1){const s=this.getRoomInstance(e);if(!s)return null;const r=s.renderer;if(!r)return null;t===-1&&(t=this._activeRoomActiveCanvas);const i=r.getCanvas(t);return i?i.geometry:null}getRoomInstanceVariable(e,t){const s=this.getRoomInstance(e);return s&&s.model&&s.model.getValue(t)||null}updateRoomInstancePlaneVisibility(e,t,s=!0){const r=this.getRoomOwnObject(e);return r?(r.processUpdateMessage(new qn(qn.WALL_VISIBILITY,t)),r.processUpdateMessage(new qn(qn.FLOOR_VISIBILITY,s)),!0):!1}updateRoomInstancePlaneThickness(e,t,s){const r=this.getRoomOwnObject(e);return r?(r.processUpdateMessage(new Xn(Xn.WALL_THICKNESS,t)),r.processUpdateMessage(new Xn(Xn.FLOOR_THICKNESS,s)),!0):!1}updateRoomInstancePlaneType(e,t=null,s=null,r=null,i=!1){const a=this.getRoomOwnObject(e),l=this.getRoomInstance(e);if(!a){let c=this._roomDatas.get(e);return c||(c=new Bp(e,null),this._roomDatas.set(e,c)),t&&(c.floorType=t),s&&(c.wallType=s),r&&(c.landscapeType=r),!0}return t&&(l&&!i&&l.model.setValue(C.ROOM_FLOOR_TYPE,t),a.processUpdateMessage(new ks(ks.ROOM_FLOOR_UPDATE,t))),s&&(l&&!i&&l.model.setValue(C.ROOM_WALL_TYPE,s),a.processUpdateMessage(new ks(ks.ROOM_WALL_UPDATE,s))),r&&(l&&!i&&l.model.setValue(C.ROOM_LANDSCAPE_TYPE,r),a.processUpdateMessage(new ks(ks.ROOM_LANDSCAPE_UPDATE,r))),!0}updateObjectRoomColor(e,t,s,r){const i=this.getRoomOwnObject(e);if(!i||!i.logic)return!1;const a=new Jh(Jh.BACKGROUND_COLOR,t,s,r);return i.logic.processUpdateMessage(a),this.events.dispatchEvent(new QT(e,t,s,r)),!0}addRoomInstanceFloorHole(e,t){if(t<0)return;const s=this.getRoomOwnObject(e),r=this.getRoomObjectFloor(e,t);if(s&&s.logic&&r&&r.model){const i=r.getLocation(),a=r.model.getValue(C.FURNITURE_SIZE_X),l=r.model.getValue(C.FURNITURE_SIZE_Y);s.processUpdateMessage(new Kn(Kn.ADD,t,i.x,i.y,a,l))}}removeRoomInstanceFloorHole(e,t){if(t<0)return;const s=this.getRoomOwnObject(e);s&&s.processUpdateMessage(new Kn(Kn.REMOVE,t))}setRoomEngineGameMode(e,t){const s=this.getRoomInstance(e);if(!s)return;const r=t?1:0;s.model.setValue(pt.IS_PLAYING_GAME,r),r===0?this.events.dispatchEvent(new je(je.NORMAL_MODE,e)):this.events.dispatchEvent(new je(je.GAME_MODE,e))}isRoomIdPlayingGame(e){const t=this.getRoomInstance(e);return t?t.model.getValue(pt.IS_PLAYING_GAME)>0:!1}isPlayingGame(){return this.isRoomIdPlayingGame(this._activeRoomId)}disableUpdate(e){e?qs().remove(this.update,this):(qs().remove(this.update,this),qs().add(this.update,this))}runUpdate(){this.update(1)}runVisibilityUpdate(){document.hidden||this.update(1,!0)}update(e,t=!1){this._roomManager&&(e=ve(),xi.turnVisualizationOn(),this.processPendingFurniture(),this._roomManager.update(e,t),this.updateRoomCameras(e),this._mouseCursorUpdate&&this.setPointer(),xi.turnVisualizationOff())}setPointer(){this._mouseCursorUpdate=!1;const e=this.getRoomInstanceData(this._activeRoomId);e&&e.hasButtonMouseCursorOwners()?document.body.style.cursor="pointer":document.body.style.cursor="auto"}processPendingFurniture(){if(this._skipFurnitureCreationForNextFrame){this._skipFurnitureCreationForNextFrame=!1;return}const e=new Date().valueOf(),t=5;for(const s of this._roomInstanceDatas.values()){if(!s)continue;let r=null,i=0,a=!1;for(;r=s.getNextPendingFurnitureFloor();)if(a=this.processPendingFurnitureFloor(s.roomId,r.id,r),!(++i%t)&&new Date().valueOf()-e>=40){this._skipFurnitureCreationForNextFrame=!0;break}for(;!this._skipFurnitureCreationForNextFrame&&(r=s.getNextPendingFurnitureWall());)if(a=this.processPendingFurnitureWall(s.roomId,r.id,r),!(++i%t)&&new Date().valueOf()-e>=40){this._skipFurnitureCreationForNextFrame=!0;break}if(a&&this._roomManager&&(this._roomManager.getRoomInstance(this.getRoomId(s.roomId)).hasUninitializedObjects()||this.objectsInitialized(s.roomId.toString())),this._skipFurnitureCreationForNextFrame)return}}onRoomEngineInitalized(e){if(e){this._ready=!0,this.events.dispatchEvent(new je(je.ENGINE_INITIALIZED,0));for(const t of this._roomDatas.values())t&&this.createRoomInstance(t.roomId,t.data)}}processPendingFurnitureFloor(e,t,s){if(!s){const c=this.getRoomInstanceData(e);if(c&&(s=c.getPendingFurnitureFloor(t)),!s)return!1}let r=s.type;r||(r=this.getFurnitureFloorName(s.typeId));const i=this.createRoomObjectFloor(e,t,r);if(!i)return!1;const a=i.model;if(a&&(a.setValue(C.FURNITURE_COLOR,this.getFurnitureFloorColorIndex(s.typeId)),a.setValue(C.FURNITURE_TYPE_ID,s.typeId),a.setValue(C.FURNITURE_AD_URL,this.getRoomObjectAdUrl(s.type)),a.setValue(C.FURNITURE_REAL_ROOM_OBJECT,s.realRoomObject?1:0),a.setValue(C.FURNITURE_EXPIRY_TIME,s.expiryTime),a.setValue(C.FURNITURE_EXPIRTY_TIMESTAMP,ve()),a.setValue(C.FURNITURE_USAGE_POLICY,s.usagePolicy),a.setValue(C.FURNITURE_OWNER_ID,s.ownerId),a.setValue(C.FURNITURE_OWNER_NAME,s.ownerName)),!this.updateRoomObjectFloor(e,t,s.location,s.direction,s.state,s.data,s.extra)||s.sizeZ>=0&&!this.updateRoomObjectFloorHeight(e,t,s.sizeZ))return!1;this.events&&this.events.dispatchEvent(new ue(ue.ADDED,e,t,k.FLOOR));const l=this.getPlacedRoomObjectData(e);return l&&l.id===t&&l.category===k.FLOOR&&this.selectRoomObject(e,t,k.FLOOR),i.isReady&&s.synchronized&&this.addObjectToTileMap(e,i),!0}processPendingFurnitureWall(e,t,s){if(!s){const u=this.getRoomInstanceData(e);if(u&&(s=u.getPendingFurnitureWall(t)),!s)return!1}let r="";s.data&&(r=s.data.getLegacyString());let i=this.getFurnitureWallName(s.typeId,r);i||(i="");const a=this.createRoomObjectWall(e,t,i);if(!a)return!1;const l=a.model;if(l&&(l.setValue(C.FURNITURE_COLOR,this.getFurnitureWallColorIndex(s.typeId)),l.setValue(C.FURNITURE_TYPE_ID,s.typeId),l.setValue(C.FURNITURE_AD_URL,this.getRoomObjectAdUrl(s.type)),l.setValue(C.FURNITURE_REAL_ROOM_OBJECT,s.realRoomObject?1:0),l.setValue(C.OBJECT_ACCURATE_Z_VALUE,1),l.setValue(C.FURNITURE_EXPIRY_TIME,s.expiryTime),l.setValue(C.FURNITURE_EXPIRTY_TIMESTAMP,ve()),l.setValue(C.FURNITURE_USAGE_POLICY,s.usagePolicy),l.setValue(C.FURNITURE_OWNER_ID,s.ownerId),l.setValue(C.FURNITURE_OWNER_NAME,s.ownerName)),!this.updateRoomObjectWall(e,t,s.location,s.direction,s.state,r))return!1;this.events&&this.events.dispatchEvent(new ue(ue.ADDED,e,t,k.WALL));const c=this.getPlacedRoomObjectData(e);return c&&Math.abs(c.id)===t&&c.category===k.WALL&&this.selectRoomObject(e,t,k.WALL),!0}setRoomSessionOwnUser(e,t){if(!this._roomSessionManager)return;const s=this._roomSessionManager.getSession(e);s&&s.setOwnRoomIndex(t);const r=this.getRoomCamera(e);r&&(r.targetId=t,r.targetCategory=k.UNIT,r.activateFollowing(this.cameraFollowDuration))}get cameraFollowDuration(){return 1e3}updateRoomCameras(e){for(const t of this._roomInstanceDatas.values()){if(!t)continue;const s=t.roomCamera;if(!s)continue;let r=null;const i=this.getRoomObject(t.roomId,s.targetId,s.targetCategory);i&&(r=i.getLocation()),r&&(t.roomId!==this._activeRoomId||!this._activeRoomIsDragged)&&this.updateRoomCamera(t.roomId,1,r,e)}if(this._activeRoomWasDragged){const t=this.getRoomInstanceRenderingCanvas(this._activeRoomId,1);t&&this.setRoomInstanceRenderingCanvasOffset(this._activeRoomId,1,new Fe(t.screenOffsetX+this._activeRoomDragX,t.screenOffsetY+this._activeRoomDragY)),this._activeRoomDragX=0,this._activeRoomDragY=0}}updateRoomCamera(e,t,s,r){const i=this.getRoomInstanceRenderingCanvas(e,t),a=this.getRoomInstanceData(e);if(!i||!a||i.scale!==1)return;const l=i.geometry,c=a.roomCamera,u=this.getRoomInstance(e);if(!l||!c||!u)return;const h=this.getRoomCanvasRectangle(e,t);if(!h)return;let d=Math.floor(s.z)+1;const f=Math.round(h.width),E=Math.round(h.height),m=this.getCanvasBoundingRectangle(t);if(m&&(m.right<0||m.bottom<0||m.left>=f||m.top>=E)&&c.reset(),c.screenWd!==f||c.screenHt!==E||c.scale!==l.scale||c.geometryUpdateId!==l.updateId||!F.isEqual(s,c.targetObjectLoc)||c.isMoving){c.targetObjectLoc=s;const R=new F;R.assign(s),R.x=Math.round(R.x),R.y=Math.round(R.y);const I=u.model.getValue(pt.ROOM_MIN_X)-.5,S=u.model.getValue(pt.ROOM_MIN_Y)-.5,A=u.model.getValue(pt.ROOM_MAX_X)+.5,N=u.model.getValue(pt.ROOM_MAX_Y)+.5,L=Math.round((I+A)/2),M=Math.round((S+N)/2),b=2;let B=new Fe(R.x-L,R.y-M);const w=l.scale/Math.sqrt(2),x=w/2,U=new Or;U.rotate(-(l.direction.x+90)/180*Math.PI),B=U.apply(B),B.y=B.y*(x/w);const G=h.width/2/w-1,K=h.height/2/x-1;let Y=0,te=0,ne=0,J=0,Ce=l.getScreenPoint(new F(L,M,b));if(!Ce)return;if(Ce.x=Ce.x+Math.round(h.width/2),Ce.y=Ce.y+Math.round(h.height/2),m)if(m.x+=-i.screenOffsetX,m.y+=-i.screenOffsetY,m.width>1&&m.height>1)Y=(m.left-Ce.x-l.scale*.25)/w,ne=(m.right-Ce.x+l.scale*.25)/w,te=(m.top-Ce.y-l.scale*.5)/x,J=(m.bottom-Ce.y+l.scale*.5)/x;else{l.adjustLocation(new F(-30,-30),25);return}else{l.adjustLocation(new F(0,0),25);return}let Ae=!1,tt=!1,Wt=!1,ls=!1;Math.round((ne-Y)*w)<h.width?(d=2,B.x=(ne+Y)/2,Wt=!0):(B.x>ne-G&&(B.x=ne-G,Ae=!0),B.x<Y+G&&(B.x=Y+G,Ae=!0)),Math.round((J-te)*x)<h.height?(d=2,B.y=(J+te)/2,ls=!0):(B.y>J-K&&(B.y=J-K,tt=!0),B.y<te+K&&(B.y=te+K,tt=!0),tt&&(B.y=B.y/(x/w))),U.invert(),B=U.apply(B),B.x=B.x+L,B.y=B.y+M;let $t=.35,Gs=.2,yr=.2;const ca=10,$i=10;if(yr*f>100&&(yr=100/f),$t*E>150&&($t=150/E),Gs*E>150&&(Gs=150/E),c.limitedLocationX&&c.screenWd==f&&c.screenHt==E&&(yr=0),c.limitedLocationY&&c.screenWd==f&&c.screenHt==E&&($t=0,Gs=0),h.width=h.width*(1-yr*2),h.height=h.height*(1-($t+Gs)),h.width<ca&&(h.width=ca),h.height<$i&&(h.height=$i),$t+Gs>0?(h.x+=-h.width/2,h.y+=-h.height*(Gs/($t+Gs))):(h.x+=-h.width/2,h.y+=-h.height/2),Ce=l.getScreenPoint(R),!Ce)return;if(Ce){Ce.x=Ce.x+i.screenOffsetX,Ce.y=Ce.y+i.screenOffsetY,R.z=d,R.x=Math.round(B.x*2)/2,R.y=Math.round(B.y*2)/2,c.location||(l.location=R,this.useOffsetScrolling?c.initializeLocation(new F(0,0,0)):c.initializeLocation(R));const Er=l.getScreenPoint(R),ri=new F(0,0,0);Er&&(ri.x=Er.x,ri.y=Er.y),(Ce.x<h.left||Ce.x>h.right)&&!c.centeredLocX||(Ce.y<h.top||Ce.y>h.bottom)&&!c.centeredLocY||Wt&&!c.centeredLocX&&c.screenWd!=f||ls&&!c.centeredLocY&&c.screenHt!=E||c.roomWd!=m.width||c.roomHt!=m.height||c.screenWd!=f||c.screenHt!=E?(c.limitedLocationX=Ae,c.limitedLocationY=tt,this.useOffsetScrolling?c.target=ri:c.target=R):(Ae||(c.limitedLocationX=!1),tt||(c.limitedLocationY=!1))}c.centeredLocX=Wt,c.centeredLocY=ls,c.screenWd=f,c.screenHt=E,c.scale=l.scale,c.geometryUpdateId=l.updateId,c.roomWd=m.width,c.roomHt=m.height,this._sessionDataManager.isCameraFollowDisabled||(this.useOffsetScrolling?c.update(r,8):c.update(r,.5)),this.useOffsetScrolling?this.setRoomInstanceRenderingCanvasOffset(this.activeRoomId,1,new Fe(-c.location.x,-c.location.y)):l.adjustLocation(c.location,25)}else c.limitedLocationX=!1,c.limitedLocationY=!1,c.centeredLocX=!1,c.centeredLocY=!1}getRoomCanvasRectangle(e,t){const s=this.getRoomInstanceRenderingCanvas(e,t);return s?new Gr(0,0,s.width,s.height):null}getRoomObjectBoundingRectangle(e,t,s,r){const i=this.getRoomInstanceGeometry(e,r);if(!i)return null;const a=this.getRoomObject(e,t,s);if(!a)return null;const l=a.visualization;if(!l)return null;const c=l.getBoundingRectangle(),u=this.getRoomInstanceRenderingCanvas(e,r),h=u?u.scale:1,d=i.getScreenPoint(a.getLocation());return!d||(d.x=Math.round(d.x),d.y=Math.round(d.y),c.x=c.x*h,c.y=c.y*h,c.width=c.width*h,c.height=c.height*h,d.x=d.x*h,d.y=d.y*h,c.x+=d.x,c.y+=d.y,!u)?null:(c.x+=Math.round(u.width/2)+u.screenOffsetX,c.y+=Math.round(u.height/2)+u.screenOffsetY,c)}getCanvasBoundingRectangle(e){return this.getRoomObjectBoundingRectangle(this._activeRoomId,Lt.ROOM_OBJECT_ID,k.ROOM,e)}getFurnitureFloorName(e){return this._roomContentLoader?this._roomContentLoader.getFurnitureFloorNameForTypeId(e):null}getFurnitureWallName(e,t=null){return this._roomContentLoader?this._roomContentLoader.getFurnitureWallNameForTypeId(e,t):null}getFurnitureFloorColorIndex(e){return this._roomContentLoader?this._roomContentLoader.getFurnitureFloorColorIndex(e):null}getFurnitureWallColorIndex(e){return this._roomContentLoader?this._roomContentLoader.getFurnitureWallColorIndex(e):null}getRoomInstanceData(e){const t=this._roomInstanceDatas.get(e);if(t)return t;const s=new _X(e);return this._roomInstanceDatas.set(s.roomId,s),s}getRoomInstanceModelName(e){const t=this.getRoomInstanceData(e);return t?t.modelName:null}setRoomInstanceModelName(e,t){const s=this.getRoomInstanceData(e);s&&s.setModelName(t)}getRoomTileObjectMap(e){const t=this.getRoomInstanceData(e);return t?t.tileObjectMap:null}getCurrentRoomCamera(){return this.getRoomCamera(this._activeRoomId)}getRoomCamera(e){const t=this.getRoomInstanceData(e);return t?t.roomCamera:null}getSelectedRoomObjectData(e){const t=this.getRoomInstanceData(e);return t?t.selectedObject:null}setSelectedRoomObjectData(e,t){const s=this.getRoomInstanceData(e);if(!s)return null;s.setSelectedObject(t),t&&s.setPlacedObject(null)}getPlacedRoomObjectData(e){const t=this.getRoomInstanceData(e);return t?t.placedObject:null}setPlacedRoomObjectData(e,t){const s=this.getRoomInstanceData(e);if(!s)return null;s.setPlacedObject(t)}cancelRoomObjectPlacement(){this._roomObjectEventHandler&&this._roomObjectEventHandler.cancelRoomObjectPlacement(this._activeRoomId)}getFurnitureStackingHeightMap(e){const t=this.getRoomInstanceData(e);return t?t.furnitureStackingHeightMap:null}setFurnitureStackingHeightMap(e,t){const s=this.getRoomInstanceData(e);if(!s)return null;s.setFurnitureStackingHeightMap(t)}getLegacyWallGeometry(e){const t=this.getRoomInstanceData(e);return t?t.legacyGeometry:null}createRoomObjectAndInitialize(e,t,s,r){const i=this.getRoomInstance(e);return i?i.createRoomObjectAndInitalize(t,s,r):null}getTotalObjectsForManager(e,t){const s=this.getRoomInstance(e);return s?s.getTotalObjectsForManager(t):0}getRoomObject(e,t,s){if(!this._ready)return null;let r=this.getRoomId(e);return e===0&&(r=Lt.TEMPORARY_ROOM),this.getObject(r,t,s)}getObject(e,t,s){let r=null;if(this._roomManager&&(r=this._roomManager.getRoomInstance(e)),!r)return null;let i=r.getRoomObject(t,s);if(!i)switch(s){case k.FLOOR:this.processPendingFurnitureFloor(this.getRoomIdFromString(e),t,null),i=r.getRoomObject(t,s);break;case k.WALL:this.processPendingFurnitureWall(this.getRoomIdFromString(e),t,null),i=r.getRoomObject(t,s);break}return i}getRoomObjectByIndex(e,t,s){const r=this.getRoomInstance(e);return r?r.getRoomObjectByIndex(t,s):null}getRoomObjectCategoryForType(e){return!e||!this._roomContentLoader?k.MINIMUM:this._roomContentLoader.getCategoryForType(e)}getRoomObjectCursor(e){return this.getObject(this.getRoomId(e),Lt.CURSOR_OBJECT_ID,k.CURSOR)}getRoomObjectSelectionArrow(e){return this.getObject(this.getRoomId(e),Lt.ARROW_OBJECT_ID,k.CURSOR)}getRoomOwnObject(e){return this.getObject(this.getRoomId(e),Lt.ROOM_OBJECT_ID,k.ROOM)}getRoomObjectUser(e,t){return this.getObject(this.getRoomId(e),t,k.UNIT)}removeRoomObjectUser(e,t){return this.removeRoomObject(e,t,k.UNIT)}createRoomObjectUser(e,t,s){return this.createRoomObjectAndInitialize(e,t,s,k.UNIT)}getRoomObjectFloor(e,t){return this.getObject(this.getRoomId(e),t,k.FLOOR)}createRoomObjectFloor(e,t,s){return this.createRoomObjectAndInitialize(e,t,s,k.FLOOR)}removeRoomObjectFloor(e,t,s=-1,r=!1){const i=this.getRoomInstanceData(e);if(i&&i.removePendingFunitureFloor(t),this._sessionDataManager&&s===this._sessionDataManager.userId&&!Hp.isBuilderClubId(t)){const a=this.getRoomObject(e,t,k.FLOOR);if(a){const l=this.getRoomObjectScreenLocation(e,t,k.FLOOR,this._activeRoomActiveCanvas);if(l&&!(a.model.getValue(C.FURNITURE_DISABLE_PICKING_ANIMATION)===1)){const u=a.model.getValue(C.FURNITURE_TYPE_ID),h=a.model.getValue(C.FURNITURE_EXTRAS),d=a.model.getValue(C.FURNITURE_DATA_FORMAT),f=un.getData(d),E=this.getFurnitureFloorIcon(u,null,h,f).data;if(E){const m=ht.generateImage(E);if(this.events){const R=new Eg(m,l.x,l.y);R.iconName=ea.INVENTORY,this.events.dispatchEvent(R)}}}}}this.removeRoomObject(e,t,k.FLOOR),this.setMouseDefault(e,k.FLOOR,t),r&&this.refreshTileObjectMap(e,"RoomEngine.disposeObjectFurniture()")}getRoomObjectWall(e,t){return this.getObject(this.getRoomId(e),t,k.WALL)}removeRoomObjectWall(e,t,s=-1){if(this._sessionDataManager&&s===this._sessionDataManager.userId&&!Hp.isBuilderClubId(t)){const r=this.getRoomObject(e,t,k.WALL);if(r&&r.type.indexOf("post_it")===-1&&r.type.indexOf("external_image_wallitem")===-1){const i=this.getRoomObjectScreenLocation(e,t,k.WALL,this._activeRoomActiveCanvas);if(i){const a=r.model.getValue(C.FURNITURE_TYPE_ID),l=r.model.getValue(C.FURNITURE_DATA),c=this.getFurnitureWallIcon(a,null,l).data;if(c){const u=ht.generateImage(c);if(this.events){const h=new Eg(u,i.x,i.y);h.iconName=ea.INVENTORY,this.events.dispatchEvent(h)}}}}}this.removeRoomObject(e,t,k.WALL),this.updateRoomObjectMask(e,t,!1),this.setMouseDefault(e,k.WALL,t)}createRoomObjectWall(e,t,s){return this.createRoomObjectAndInitialize(e,t,s,k.WALL)}removeRoomObject(e,t,s){const r=this.getRoomInstance(e);if(!r)return null;r.removeRoomObject(t,s),this.events&&this.events.dispatchEvent(new ue(ue.REMOVED,e,t,s))}addFurnitureFloor(e,t,s,r,i,a,l,c=NaN,u=-1,h=0,d=0,f="",E=!0,m=!0,R=-1){const I=this.getRoomInstanceData(e);if(!I)return!1;const S=new P_(t,s,null,r,i,a,l,c,u,h,d,f,E,m,R);return I.addPendingFurnitureFloor(S),!0}addFurnitureFloorByTypeName(e,t,s,r,i,a,l,c=NaN,u=-1,h=0,d=0,f="",E=!0,m=!0,R=-1){const I=this.getRoomInstanceData(e);if(!I)return!1;const S=new P_(t,0,s,r,i,a,l,c,u,h,d,f,E,m,R);return I.addPendingFurnitureFloor(S),!0}addFurnitureWall(e,t,s,r,i,a,l,c=-1,u=0,h=0,d="",f=!0){const E=this.getRoomInstanceData(e);if(!E)return!1;const m=new Br;m.setString(l);const R=new P_(t,s,null,r,i,a,m,NaN,c,u,h,d,!0,f);return E.addPendingFurnitureWall(R),!0}updateRoomObjectFloor(e,t,s,r,i,a,l=null){const c=this.getRoomObjectFloor(e,t);return c?(c.processUpdateMessage(new Rs(s,r)),c.processUpdateMessage(new Pt(i,a,l)),!0):!1}updateRoomObjectWall(e,t,s,r,i,a=null){const l=this.getRoomObjectWall(e,t);if(!l||!l.logic)return!1;const c=new Rs(s,r),u=new Br,h=new Pt(i,u);return u.setString(a),l.logic.processUpdateMessage(c),l.logic.processUpdateMessage(h),this.updateRoomObjectMask(e,t),!0}updateRoomObjectWallItemData(e,t,s){const r=this.getRoomObjectWall(e,t);return!r||!r.logic?!1:(r.logic.processUpdateMessage(new OE(s)),!0)}updateRoomObjectFloorHeight(e,t,s){const r=this.getRoomObjectFloor(e,t);return r?(r.processUpdateMessage(new eb(null,null,s)),!0):!1}updateRoomObjectFloorExpiration(e,t,s){const r=this.getRoomObjectFloor(e,t);return r?(r.model.setValue(C.FURNITURE_EXPIRY_TIME,s),r.model.setValue(C.FURNITURE_EXPIRTY_TIMESTAMP,ve()),!0):!1}updateRoomObjectWallExpiration(e,t,s){const r=this.getRoomObjectWall(e,t);return r?(r.model.setValue(C.FURNITURE_EXPIRY_TIME,s),r.model.setValue(C.FURNITURE_EXPIRTY_TIMESTAMP,ve()),!0):!1}updateRoomObjectMask(e,t,s=!0){const r=k.WALL+"_"+t,i=this.getRoomObjectWall(e,t);let a=null;if(i&&i.model){if(i.model.getValue(C.FURNITURE_USES_PLANE_MASK)>0){const c=i.model.getValue(C.FURNITURE_PLANE_MASK_TYPE),u=i.getLocation();s?a=new Vs(Vs.ADD_MASK,r,c,u):a=new Vs(Vs.REMOVE_MASK,r)}}else a=new Vs(Vs.REMOVE_MASK,r);const l=this.getRoomOwnObject(e);l&&l.logic&&a&&l.logic.processUpdateMessage(a)}rollRoomObjectFloor(e,t,s,r){const i=this.getRoomObjectFloor(e,t);i&&i.processUpdateMessage(new Ua(s,r,null,!!r))}updateRoomObjectWallLocation(e,t,s){const r=this.getRoomObjectWall(e,t);return r?(r.logic&&r.logic.processUpdateMessage(new Ua(s,null,null)),this.updateRoomObjectMask(e,t),!0):!1}addRoomObjectUser(e,t,s,r,i,a,l){if(this.getRoomObjectUser(e,t))return!1;let u=ft.getTypeString(a);u===ft.PET&&(u=this.getPetType(l));const h=this.createRoomObjectUser(e,t,u);return h?(h.processUpdateMessage(new Qh(this.fixedUserLocation(e,s),null,r,i,!1,0)),l&&h.processUpdateMessage(new Xh(l)),this.events&&this.events.dispatchEvent(new ue(ue.ADDED,e,t,k.UNIT)),!0):!1}updateRoomObjectUserLocation(e,t,s,r,i=!1,a=0,l=null,c=NaN){const u=this.getRoomObjectUser(e,t);if(!u)return!1;s||(s=u.getLocation()),l||(l=u.getDirection()),isNaN(c)&&(c=u.model.getValue(C.HEAD_DIRECTION)),u.processUpdateMessage(new Qh(this.fixedUserLocation(e,s),this.fixedUserLocation(e,r),l,c,i,a));const h=this._roomSessionManager&&this._roomSessionManager.getSession(e)||null;return h&&h.ownRoomIndex===t&&this._logicFactory.events.dispatchEvent(new xc(xc.ROAME_MOVE_TO,r)),!0}fixedUserLocation(e,t){if(!t)return null;const s=this.getFurnitureStackingHeightMap(e),r=this.getLegacyWallGeometry(e);if(!s||!r)return t;let i=t.z;const a=s.getTileHeight(t.x,t.y),l=r.getHeight(t.x,t.y);return Math.abs(i-a)<.1&&Math.abs(a-l)<.1&&(i=r.getFloorAltitude(t.x,t.y)),new F(t.x,t.y,i)}updateRoomObjectUserAction(e,t,s,r,i=null){const a=this.getRoomObjectUser(e,t);if(!a)return!1;let l=null;switch(s){case C.FIGURE_TALK:l=new IE(r);break;case C.FIGURE_SLEEP:l=new RE(r===1);break;case C.FIGURE_IS_TYPING:l=new Zv(r===1);break;case C.FIGURE_IS_MUTED:l=new zv(r===1);break;case C.FIGURE_CARRY_OBJECT:l=new Bv(r,i);break;case C.FIGURE_USE_OBJECT:l=new $v(r);break;case C.FIGURE_DANCE:l=new kv(r);break;case C.FIGURE_GAINED_EXPERIENCE:l=new Hv(r);break;case C.FIGURE_NUMBER_VALUE:l=new qv(r);break;case C.FIGURE_SIGN:l=new Jv(r);break;case C.FIGURE_EXPRESSION:l=new jv(r);break;case C.FIGURE_IS_PLAYING_GAME:l=new Qv(r===1);break;case C.FIGURE_GUIDE_STATUS:l=new eK(r);break}return l?(a.processUpdateMessage(l),!0):!1}updateRoomObjectUserFigure(e,t,s,r=null,i=null,a=!1){const l=this.getRoomObjectUser(e,t);return l?(l.processUpdateMessage(new Xh(s,r,i,a)),!0):!1}updateRoomObjectUserFlatControl(e,t,s){const r=this.getRoomObjectUser(e,t);return r?(r.processUpdateMessage(new Wv(parseInt(s))),!0):!1}updateRoomObjectUserEffect(e,t,s,r=0){const i=this.getRoomObjectUser(e,t);return i?(i.processUpdateMessage(new Vv(s,r)),!0):!1}updateRoomObjectUserGesture(e,t,s){const r=this.getRoomObjectUser(e,t);return r?(r.processUpdateMessage(new Yv(s)),!0):!1}updateRoomObjectUserPetGesture(e,t,s){const r=this.getRoomObjectUser(e,t);return r?(r.processUpdateMessage(new Xv(s)),!0):!1}updateRoomObjectUserPosture(e,t,s,r=null){const i=this.getRoomObjectUser(e,t);return i?(i.processUpdateMessage(new TE(s,r)),!0):!1}updateRoomObjectUserOwn(e,t){const s=this.getRoomObjectUser(e,t);s&&s.processUpdateMessage(new Kv)}useRoomObject(e,t){const s=this.getRoomObject(this._activeRoomId,e,t);if(s){const r=s.logic;if(r)return r.useObject(),!0}return!1}objectInitialized(e,t,s){const r=this.getRoomIdFromString(e);s===k.WALL&&this.updateRoomObjectMask(r,t);const i=this.getRoomObject(r,t,s);if(i&&i.model&&i.logic){const a=i.model.getValue(C.FURNITURE_DATA_FORMAT);if(!isNaN(a)){const l=un.getData(a);l.initializeFromRoomObjectModel(i.model),i.processUpdateMessage(new Pt(i.getState(0),l))}this.events.dispatchEvent(new ue(ue.CONTENT_UPDATED,r,t,s))}e!==Lt.TEMPORARY_ROOM&&this.addObjectToTileMap(r,i)}changeObjectModelData(e,t,s,r,i){const a=this.getObject(this.getRoomId(e),t,s);if(!a||!a.logic)return!1;const l=new tb(r,i);return a.processUpdateMessage(l),!0}changeObjectState(e,t,s){const r=this.getObject(this.getRoomId(e),t,s);if(!r||!r.model)return;let i=r.model.getValue(C.FURNITURE_AUTOMATIC_STATE_INDEX);isNaN(i)?i=1:i=i+1,r.model.setValue(C.FURNITURE_AUTOMATIC_STATE_INDEX,i);const a=r.model.getValue(C.FURNITURE_DATA_FORMAT),l=un.getData(a);l.initializeFromRoomObjectModel(r.model),r.logic&&r.logic.processUpdateMessage(new Pt(i,l))}loadRoomObjectBadgeImage(e,t,s,r,i=!0){if(!this._sessionDataManager)return;let a=null;if(e===0){const c=this._roomManager.getRoomInstance(Lt.TEMPORARY_ROOM);c&&(a=c.getRoomObject(t,s))}else a=this.getRoomObjectFloor(e,t);if(!a||!a.logic)return;let l=i?this._sessionDataManager.loadGroupBadgeImage(r):this._sessionDataManager.loadBadgeImage(r);if(l)this.putBadgeInObjectAssets(a,r,i);else{l="loading_icon",this._badgeListenerObjects||(this._badgeListenerObjects=new Map),this._badgeListenerObjects.size||this._sessionDataManager.events.addEventListener(To.IMAGE_READY,this.onBadgeImageReadyEvent);let c=this._badgeListenerObjects.get(r);c||(c=[]),c.push(new gX(a,i)),this._badgeListenerObjects.set(r,c)}a.logic.processUpdateMessage(new Dl(r,l))}onBadgeImageReadyEvent(e){if(!this._sessionDataManager)return;const t=this._badgeListenerObjects&&this._badgeListenerObjects.get(e.badgeId);if(t){for(const s of t){if(!s)continue;this.putBadgeInObjectAssets(s.object,e.badgeId,s.groupBadge);const r=s.groupBadge?this._sessionDataManager.loadGroupBadgeImage(e.badgeId):this._sessionDataManager.loadBadgeImage(e.badgeId);s.object&&s.object.logic&&s.object.logic.processUpdateMessage(new Dl(e.badgeId,r))}this._badgeListenerObjects.delete(e.badgeId),this._badgeListenerObjects.size||this._sessionDataManager.events.removeEventListener(To.IMAGE_READY,this.onBadgeImageReadyEvent)}}putBadgeInObjectAssets(e,t,s=!1){if(!this._roomContentLoader||!this._sessionDataManager)return;const r=s?this._sessionDataManager.loadGroupBadgeImage(t):this._sessionDataManager.loadBadgeImage(t),i=s?this._sessionDataManager.getGroupBadgeImage(t):this._sessionDataManager.getBadgeImage(t);i&&this._roomContentLoader.addAssetToCollection(e.type,r,i,!1)}dispatchMouseEvent(e,t,s,r,i,a,l,c){const u=this.getRoomInstanceRenderingCanvas(this._activeRoomId,e);if(!u)return;const h=this.getRenderingCanvasOverlay(u),d=this.getOverlayIconSprite(h,Lt.OBJECT_ICON_SPRITE);if(d){const f=d.getLocalBounds();d.x=t-f.width/2,d.y=s-f.height/2}if(!this.handleRoomDragging(u,t,s,r,i,a,l)&&!u.handleMouseEvent(t,s,r,i,a,l,c)){let f=null;r===ie.MOUSE_CLICK?(this.events&&this.events.dispatchEvent(new ue(ue.DESELECTED,this._activeRoomId,-1,k.MINIMUM)),f=Me.CLICK):r===ie.MOUSE_MOVE?f=Me.MOUSE_MOVE:r===ie.MOUSE_DOWN?f=Me.MOUSE_DOWN:r===ie.MOUSE_DOWN_LONG?f=Me.MOUSE_DOWN_LONG:r===ie.MOUSE_UP&&(f=Me.MOUSE_UP),this._roomObjectEventHandler.handleRoomObjectEvent(new Me(f,this.getRoomObject(this._activeRoomId,Lt.ROOM_OBJECT_ID,k.ROOM),null,i),this._activeRoomId)}this._activeRoomActiveCanvas=e,this._activeRoomActiveCanvasMouseX=t,this._activeRoomActiveCanvasMouseY=s}handleRoomDragging(e,t,s,r,i,a,l){let c=t-this._activeRoomActiveCanvasMouseX,u=s-this._activeRoomActiveCanvasMouseY;if(r===ie.MOUSE_DOWN)!i&&!a&&!l&&!this.isDecorating&&this._roomAllowsDragging&&(this._activeRoomIsDragged=!0,this._activeRoomWasDragged=!1,this._activeRoomDragStartX=this._activeRoomActiveCanvasMouseX,this._activeRoomDragStartY=this._activeRoomActiveCanvasMouseY);else if(r===ie.MOUSE_UP){if(this._activeRoomIsDragged&&(this._activeRoomIsDragged=!1,this._activeRoomWasDragged)){const h=this.getRoomInstanceData(this._activeRoomId);if(h){const d=h.roomCamera;d&&(this.useOffsetScrolling&&(d.isMoving||(d.centeredLocX=!1,d.centeredLocY=!1),d.resetLocation(new F(-e.screenOffsetX,-e.screenOffsetY))),this._roomDraggingAlwaysCenters&&d.reset())}}}else if(r===ie.MOUSE_MOVE)this._activeRoomIsDragged&&(this._activeRoomWasDragged||(c=t-this._activeRoomDragStartX,u=s-this._activeRoomDragStartY,(c<=-Lt.DRAG_THRESHOLD||c>=Lt.DRAG_THRESHOLD||u<=-Lt.DRAG_THRESHOLD||u>=Lt.DRAG_THRESHOLD)&&(this._activeRoomWasDragged=!0),c=0,u=0),(c!=0||u!=0)&&(this._activeRoomDragX+=c,this._activeRoomDragY+=u,this._activeRoomWasDragged=!0));else if((r===ie.MOUSE_CLICK||r===ie.DOUBLE_CLICK)&&(this._activeRoomIsDragged=!1,this._activeRoomWasDragged))return this._activeRoomWasDragged=!1,!0;return!1}updateMousePointer(e,t,s){const r=this.getRoomObjectCategoryForType(s);switch(e){case oe.MOUSE_BUTTON:this.setMouseButton(this._activeRoomId,r,t);return;default:this.setMouseDefault(this._activeRoomId,r,t);return}}setMouseButton(e,t,s){if(!this._roomSessionManager)return;const r=this._roomSessionManager.getSession(e);if(r&&(t!==k.FLOOR&&t!==k.WALL||r.controllerLevel>=ct.GUEST)){const i=this.getRoomInstanceData(e);i&&i.addButtonMouseCursorOwner(t+"_"+s)&&(this._mouseCursorUpdate=!0)}}setMouseDefault(e,t,s){if(!this._roomSessionManager)return;const r=this.getRoomInstanceData(e);r&&r.removeButtonMouseCursorOwner(t+"_"+s)&&(this._mouseCursorUpdate=!0)}processRoomObjectOperation(e,t,s){if(!this._roomObjectEventHandler)return!1;this._roomObjectEventHandler.modifyRoomObject(this._activeRoomId,e,t,s)}modifyRoomObjectDataWithMap(e,t,s,r){if(!this._roomObjectEventHandler)return!1;t===k.FLOOR&&this._roomObjectEventHandler.modifyRoomObjectDataWithMap(this._activeRoomId,e,t,s,r)}modifyRoomObjectData(e,t,s,r){if(!this._roomObjectEventHandler)return!1;t===k.WALL&&this._roomObjectEventHandler.modifyWallItemData(this._activeRoomId,e,s,r)}processRoomObjectEvent(e){if(!this._roomObjectEventHandler)return;const t=this.getRoomObjectRoomId(e.object);if(!t)return;const s=this.getRoomIdFromString(t);this._roomObjectEventHandler.handleRoomObjectEvent(e,s)}processRoomObjectPlacement(e,t,s,r,i=null,a=null,l=-1,c=-1,u=null){const h=this.getRoomInstance(this._activeRoomId);return!h||h.model.getValue(pt.ROOM_IS_PUBLIC)!==0||!this._roomObjectEventHandler?!1:this._roomObjectEventHandler.processRoomObjectPlacement(e,this._activeRoomId,t,s,r,i,a,l,c,u)}getRoomObjectScreenLocation(e,t,s,r=-1){r==-1&&(r=this._activeRoomActiveCanvas);const i=this.getRoomInstanceGeometry(e,r);if(!i)return null;const a=this.getRoomObject(e,t,s);if(!a)return null;const l=i.getScreenPoint(a.getLocation());if(!l)return null;const c=this.getRoomInstanceRenderingCanvas(e,r);return c?(l.x=l.x*c.scale,l.y=l.y*c.scale,l.x+=c.width/2+c.screenOffsetX,l.y+=c.height/2+c.screenOffsetY,l.x=Math.round(l.x),l.y=Math.round(l.y),l):null}selectRoomObject(e,t,s){this._roomObjectEventHandler&&this._roomObjectEventHandler.setSelectedObject(e,t,s)}setSelectedAvatar(e,t){this._roomObjectEventHandler||this._roomObjectEventHandler.setSelectedAvatar(e,t,!0)}cancelRoomObjectInsert(){this._roomObjectEventHandler&&this._roomObjectEventHandler.cancelRoomObjectInsert(this._activeRoomId)}addOverlayIconSprite(e,t,s,r=1){if(!e||!s)return;let i=this.getOverlayIconSprite(e,t);return i?null:(i=new jt(s),i.name=t,i.scale.set(r),e.addChild(i),i)}onRoomContentLoaded(e,t,s){if(!this._roomContentLoader||e===-1)return;this._thumbnailObjectIdBank.freeNumber(e-1);const r=this._thumbnailCallbacks.get(t);if(r){this._thumbnailCallbacks.delete(t);const i=this._roomContentLoader.getImage(t);if(i)for(const a of r)a&&a.imageReady(e,null,i)}}setObjectMoverIconSprite(e,t,s,r=null,i=null,a=-1,l=-1,c=null){let u=null,h=0,d=null;const f=1;if(s)d=this.getRoomObjectImage(this._activeRoomId,e,t,new F,1,null);else if(this._roomContentLoader)if(t===k.FLOOR?(u=this._roomContentLoader.getFurnitureFloorNameForTypeId(e),h=this._roomContentLoader.getFurnitureFloorColorIndex(e)):t===k.WALL&&(u=this._roomContentLoader.getFurnitureWallNameForTypeId(e,r),h=this._roomContentLoader.getFurnitureWallColorIndex(e)),t===k.UNIT)if(u=ft.getTypeString(e),u==="pet"){u=this.getPetType(r);const I=new gn(r);d=this.getRoomObjectPetImage(I.typeId,I.paletteId,I.color,new F(180),64,null,!0,0,I.customParts,c)}else d=this.getGenericRoomObjectImage(u,r,new F(180),64,null,0,null,i,a,l,c);else d=this.getGenericRoomObjectImage(u,h.toString(),new F,1,null,0,r,i,a,l,c);if(!d||!d.data)return;const E=this.getActiveRoomInstanceRenderingCanvas();if(!E)return;const m=this.getRenderingCanvasOverlay(E);this.removeOverlayIconSprite(m,Lt.OBJECT_ICON_SPRITE);const R=this.addOverlayIconSprite(m,Lt.OBJECT_ICON_SPRITE,d.data,f);R&&(R.x=this._activeRoomActiveCanvasMouseX-d.data.width/2,R.y=this._activeRoomActiveCanvasMouseY-d.data.height/2)}getRoomObjectImage(e,t,s,r,i,a,l=0){if(!this._roomManager)return null;let c=-1,u=null,h=null,d="",f=null;const E=this.getRoomId(e),m=this._roomManager.getRoomInstance(E);if(m){const R=m.getRoomObject(t,s);if(R&&R.model)switch(c=R.id,u=R.type,s){case k.FLOOR:case k.WALL:{d=R.model.getValue(C.FURNITURE_COLOR).toString(),f=R.model.getValue(C.FURNITURE_EXTRAS);const I=R.model.getValue(C.FURNITURE_DATA_FORMAT);I!==Br.FORMAT_KEY&&(h=un.getData(I),h.initializeFromRoomObjectModel(R.model));break}case k.UNIT:d=R.model.getValue(C.FIGURE);break}}return this.getGenericRoomObjectImage(u,d,r,i,a,l,f,h,-1,-1,null,c)}getFurnitureFloorIconUrl(e){let t=null,s="";return this._roomContentLoader?(t=this._roomContentLoader.getFurnitureFloorNameForTypeId(e),s=this._roomContentLoader.getFurnitureFloorColorIndex(e).toString(),this._roomContentLoader.getAssetIconUrl(t,s)):null}getFurnitureFloorIcon(e,t,s=null,r=null){return this.getFurnitureFloorImage(e,new F,1,t,0,s,-1,-1,r)}getFurnitureWallIconUrl(e,t=null){let s=null,r="";return this._roomContentLoader?(s=this._roomContentLoader.getFurnitureWallNameForTypeId(e,t),r=this._roomContentLoader.getFurnitureWallColorIndex(e).toString(),this._roomContentLoader.getAssetIconUrl(s,r)):null}getFurnitureWallIcon(e,t,s=null){return this.getFurnitureWallImage(e,new F,1,t,0,s)}getFurnitureFloorImage(e,t,s,r,i=0,a=null,l=-1,c=-1,u=null){let h=null,d="";return this._roomContentLoader&&(h=this._roomContentLoader.getFurnitureFloorNameForTypeId(e),d=this._roomContentLoader.getFurnitureFloorColorIndex(e).toString()),s===1&&r?this.getGenericRoomObjectThumbnail(h,d,r,a,u):this.getGenericRoomObjectImage(h,d,t,s,r,i,a,u,l,c)}getFurnitureWallImage(e,t,s,r,i=0,a=null,l=-1,c=-1){let u=null,h="";return this._roomContentLoader&&(u=this._roomContentLoader.getFurnitureWallNameForTypeId(e),h=this._roomContentLoader.getFurnitureWallColorIndex(e).toString()),s===1&&r?this.getGenericRoomObjectThumbnail(u,h,r,a,null):this.getGenericRoomObjectImage(u,h,t,s,r,i,a,null,l,c)}getRoomObjectPetImage(e,t,s,r,i,a,l=!1,c=0,u=null,h=null){let d=null,f=e+" "+t+" "+s.toString(16);if(l&&(f=f+" head"),u){f=f+(" "+u.length);for(const E of u)f=f+(" "+E.layerId+" "+E.partId+" "+E.paletteId)}return this._roomContentLoader&&(d=this._roomContentLoader.getPetNameForType(e)),this.getGenericRoomObjectImage(d,f,r,i,a,c,null,null,-1,-1,h)}getGenericRoomObjectImage(e,t,s,r,i,a=0,l=null,c=null,u=-1,h=-1,d=null,f=-1){if(!this._roomManager)return null;const E=new Up;if(E.id=-1,!this._ready||!e)return E;let m=this._roomManager.getRoomInstance(Lt.TEMPORARY_ROOM);if(!m&&(m=this._roomManager.createRoomInstance(Lt.TEMPORARY_ROOM),!m))return E;let R=this._imageObjectIdBank.reserveNumber();const I=this.getRoomObjectCategoryForType(e);if(R<0)return E;R++;const S=m.createRoomObjectAndInitalize(R,e,I);if(!S||!S.model||!S.logic)return E;const A=S.model;switch(I){case k.FLOOR:case k.WALL:A.setValue(C.FURNITURE_COLOR,parseInt(t)),A.setValue(C.FURNITURE_EXTRAS,l);break;case k.UNIT:if(e===ft.USER||e===ft.BOT||e===ft.RENTABLE_BOT||e===ft.PET)A.setValue(C.FIGURE,t);else{const b=new gn(t);A.setValue(C.PET_PALETTE_INDEX,b.paletteId),A.setValue(C.PET_COLOR,b.color),b.headOnly&&A.setValue(C.PET_HEAD_ONLY,1),b.hasCustomParts&&(A.setValue(C.PET_CUSTOM_LAYER_IDS,b.customLayerIds),A.setValue(C.PET_CUSTOM_PARTS_IDS,b.customPartIds),A.setValue(C.PET_CUSTOM_PALETTE_IDS,b.customPaletteIds)),d&&A.setValue(C.FIGURE_POSTURE,d)}break}S.setDirection(s);const N=S.visualization;if(!N)return m.removeRoomObject(R,I),E;(u>-1||c)&&(c&&c.getLegacyString()!==""?S.logic.processUpdateMessage(new Pt(parseInt(c.getLegacyString()),c)):S.logic.processUpdateMessage(new Pt(u,c)));const L=new Cl(r,new F(-135,30,0),new F(11,11,5));if(N.update(L,0,!0,!1),h>0){let b=0;for(;b<h;)N.update(L,0,!0,!1),b++}const M=N.getImage(a,f);if(E.data=M,E.id=R,!this.isRoomContentTypeLoaded(e)&&i){let b=this._imageCallbacks.get(R.toString());b||(b=[],this._imageCallbacks.set(R.toString(),b)),b.push(i),A.setValue(C.IMAGE_QUERY_SCALE,r)}else m.removeRoomObject(R,I),this._imageObjectIdBank.freeNumber(R-1),E.id=0;return L.dispose(),E}getGenericRoomObjectThumbnail(e,t,s,r=null,i=null){if(!this._roomManager)return null;const a=new Up;if(a.id=-1,!this._ready||!e)return a;let l=this._roomManager.getRoomInstance(Lt.TEMPORARY_ROOM);if(!l&&(l=this._roomManager.createRoomInstance(Lt.TEMPORARY_ROOM),!l))return a;let c=this._thumbnailObjectIdBank.reserveNumber();if(this.getRoomObjectCategoryForType(e),c<0)return a;c++,a.id=c,a.data=null,a.image=null;const u=[e,t].join("_"),h=this._roomContentLoader.getImage(u);if(!h&&s){let d=this._thumbnailCallbacks.get(u);d||(d=[],this._thumbnailCallbacks.set(u,d),this._roomContentLoader.downloadImage(c,e,t,null)),d.push(s)}else h&&(a.image=h),this._thumbnailObjectIdBank.freeNumber(c-1),a.id=0;return a}initalizeTemporaryObjectsByType(e,t){const s=this._roomManager.getRoomInstance(Lt.TEMPORARY_ROOM);if(!s||!this._roomContentLoader)return;const r=this._roomContentLoader.getCategoryForType(e),i=s.getManager(r);let a=null,l=0;if(i&&i.objects.length){for(const c of i.objects.getValues())if(c&&c.model&&c.type===e){const u=c.id,h=c.visualization;let d=null;if(h){const E=c.model.getValue(C.IMAGE_QUERY_SCALE);a&&l!==E&&(a.dispose(),a=null),a||(l=E,a=new Cl(E,new F(-135,30,0),new F(11,11,5))),h.update(a,0,!0,!1),d=h.image}s.removeRoomObject(u,r),this._imageObjectIdBank.freeNumber(u-1);const f=this._imageCallbacks.get(u.toString());if(f){this._imageCallbacks.delete(u.toString());for(const E of f)E&&(d?E.imageReady(u,d):E.imageFailed(u))}}}a&&a.dispose()}setObjectMoverIconSpriteVisible(e){const t=this.getActiveRoomInstanceRenderingCanvas();if(!t)return;const s=this.getRenderingCanvasOverlay(t),r=this.getOverlayIconSprite(s,Lt.OBJECT_ICON_SPRITE);r&&(r.visible=e)}removeObjectMoverIconSprite(){const e=this.getActiveRoomInstanceRenderingCanvas();if(!e)return;const t=this.getRenderingCanvasOverlay(e);this.removeOverlayIconSprite(t,Lt.OBJECT_ICON_SPRITE)}getRenderingCanvasOverlay(e){if(!e)return null;const t=e.master;return t&&t.getChildByName(Lt.OVERLAY)||null}removeOverlayIconSprite(e,t){if(!e)return!1;let s=e.children.length-1;for(;s>=0;){const r=e.getChildAt(s);if(r&&r.name===t){if(e.removeChildAt(s),r.children.length){const i=r.getChildAt(0);i.parent.removeChild(i),i.destroy()}return!0}s--}return!1}getOverlayIconSprite(e,t){if(!e)return null;let s=e.children.length-1;for(;s>=0;){const r=e.getChildAt(s);if(r&&r.name===t)return r;s--}return null}getRoomObjects(e,t){if(this._ready){const s=this.getRoomId(e),r=this._roomManager.getRoomInstance(s);if(r)return r.getRoomObjectsForCategory(t)}return[]}addObjectToTileMap(e,t){const s=this.getRoomInstanceData(e).tileObjectMap;s&&s.addRoomObject(t)}refreshTileObjectMap(e,t){const s=this.getRoomInstanceData(e).tileObjectMap;s&&s.populate(this.getRoomObjects(e,k.FLOOR))}getRenderRoomMessage(e,t,s=!1,r=!0,i=!1,a=-1){let l=null;if(a>-1?l=this.getRoomInstanceRenderingCanvas(this._activeRoomId,a):l=this.getActiveRoomInstanceRenderingCanvas(),!l)return null;i&&l.skipSpriteVisibilityChecking();let c=-1;!r&&this._roomSessionManager.getSession(this._activeRoomId)!=null&&(c=this._roomSessionManager.getSession(this._activeRoomId).ownRoomIndex);const u=new fX,h=u.getFurniData(e,l,this,c),d=u.getRoomRenderingModifiers(this),f=u.getRoomPlanes(e,l,this,t);return i&&l.resumeSpriteVisibilityChecking(),me.log(h,d,f),null}createTextureFromRoom(e,t=-1,s=null){let r=null;t>-1?r=this.getRoomInstanceRenderingCanvas(this._activeRoomId,t):r=this.getActiveRoomInstanceRenderingCanvas();let i=null;return s?i=ht.generateTexture(r.master,s):i=r.getDisplayAsTexture(),i}saveTextureAsScreenshot(e,t=!1){let s=null;t?s=new lf:s=new zh,s.assignBitmap(e),this._communication.connection.send(s)}saveBase64AsScreenshot(e,t=!1){let s=null;t?s=new lf:s=new zh,s.assignBase64(e),this._communication.connection.send(s)}objectsInitialized(e){const t=this.getRoomIdFromString(e);this.events.dispatchEvent(new je(je.OBJECTS_INITIALIZED,t))}getRoomId(e){return e.toString()}getRoomIdFromString(e){if(!e)return-1;const t=e.split("_");return t.length<=0?-1:parseInt(t[0])||0}getRoomObjectRoomId(e){return!e||!e.model?null:e.model.getValue(C.OBJECT_ROOM_ID)}getRoomObjectAdUrl(e){return this._roomContentLoader.getRoomObjectAdUrl(e)}getPetTypeId(e){let t=-1;if(e){const s=e.split(" ");s.length>1&&(t=parseInt(s[0]))}return t}getPetType(e){if(!e)return null;const t=e.split(" ");if(t.length>1){const s=parseInt(t[0]);return this._roomContentLoader?this._roomContentLoader.getPetNameForType(s):"pet"}return null}isRoomContentTypeLoaded(e){return this._roomContentLoader?this._roomContentLoader.getCollection(e)!==null:!1}getPetColorResult(e,t){return this._roomContentLoader?this._roomContentLoader.getPetColorResult(e,t):null}getPetColorResultsForTag(e,t){return this._roomContentLoader?this._roomContentLoader.getPetColorResultsForTag(e,t):null}deleteRoomObject(e,t){return!this._roomObjectEventHandler||t!==k.WALL?!1:this._roomObjectEventHandler.deleteWallItem(this._activeRoomId,e)}get connection(){return this._communication.connection}get sessionDataManager(){return this._sessionDataManager}set sessionDataManager(e){this._sessionDataManager=e}get roomSessionManager(){return this._roomSessionManager}set roomSessionManager(e){this._roomSessionManager=e}get roomManager(){return this._roomManager}set roomManager(e){this._roomManager=e}get objectEventHandler(){return this._roomObjectEventHandler}get roomRendererFactory(){return this._roomRendererFactory}get visualizationFactory(){return this._visualizationFactory}get logicFactory(){return this._logicFactory}get activeRoomId(){return this._activeRoomId}get ready(){return this._ready}get roomContentLoader(){return this._roomContentLoader}get isDecorating(){if(!this._roomSessionManager)return!1;const e=this._roomSessionManager.getSession(this._activeRoomId);return e&&e.isDecorating||!1}get useOffsetScrolling(){return!0}get selectedAvatarId(){return this._roomObjectEventHandler?this._roomObjectEventHandler.selectedAvatarId:-1}getRoomObjectCount(e,t){return this._roomManager==null?0:this._roomManager.getRoomInstance(e.toString()).getRoomObjectsForCategory(t).length}};Xi.ROOM_OBJECT_ID=-1;Xi.ROOM_OBJECT_TYPE="room";Xi.CURSOR_OBJECT_ID=-2;Xi.CURSOR_OBJECT_TYPE="tile_cursor";Xi.ARROW_OBJECT_ID=-3;Xi.ARROW_OBJECT_TYPE="selection_arrow";Xi.OVERLAY="overlay";Xi.OBJECT_ICON_SPRITE="object_icon_sprite";Xi.DRAG_THRESHOLD=15;Xi.TEMPORARY_ROOM="temporary_room";let wE=Xi;const qi=class _e{constructor(e,t=1){this._previewRoomId=1,this._currentPreviewObjectType=0,this._currentPreviewObjectCategory=0,this._currentPreviewObjectData="",this._currentPreviewRectangle=null,this._currentPreviewCanvasWidth=0,this._currentPreviewCanvasHeight=0,this._currentPreviewScale=64,this._backgroundColor=305148561,this._backgroundSprite=null,this._disableUpdate=!1,this._roomEngine=e,this._planeParser=new Hs,this._previewRoomId=Yn.makeRoomPreviewerId(t),this._addViewOffset=new Fe(0,0),this.onRoomObjectAdded=this.onRoomObjectAdded.bind(this),this.onRoomInitializedonRoomInitialized=this.onRoomInitializedonRoomInitialized.bind(this),this.isRoomEngineReady&&this._roomEngine.events&&(this._roomEngine.events.addEventListener(ue.ADDED,this.onRoomObjectAdded),this._roomEngine.events.addEventListener(ue.CONTENT_UPDATED,this.onRoomObjectAdded),this._roomEngine.events.addEventListener(je.INITIALIZED,this.onRoomInitializedonRoomInitialized)),this.createRoomForPreview()}dispose(){this.reset(!0),this.isRoomEngineReady&&this._roomEngine.events&&(this._roomEngine.events.removeEventListener(ue.ADDED,this.onRoomObjectAdded),this._roomEngine.events.removeEventListener(ue.CONTENT_UPDATED,this.onRoomObjectAdded),this._roomEngine.events.removeEventListener(je.INITIALIZED,this.onRoomInitializedonRoomInitialized)),this._backgroundSprite&&(this._backgroundSprite.destroy(),this._backgroundSprite=null),this._planeParser&&(this._planeParser.dispose(),this._planeParser=null)}createRoomForPreview(){if(this.isRoomEngineReady){const t=new Hs;t.initializeTileMap(7+2,7+2);let s=1;for(;s<1+7;){let r=1;for(;r<1+7;)t.setTileHeight(r,s,0),r++;s++}t.initializeFromTileData(),this._roomEngine.createRoomInstance(this._previewRoomId,t.getMapData()),t.dispose()}}reset(e){this.isRoomEngineReady&&(this._roomEngine.removeRoomObjectFloor(this._previewRoomId,_e.PREVIEW_OBJECT_ID),this._roomEngine.removeRoomObjectWall(this._previewRoomId,_e.PREVIEW_OBJECT_ID),this._roomEngine.removeRoomObjectUser(this._previewRoomId,_e.PREVIEW_OBJECT_ID),e||this.updatePreviewRoomView()),this._currentPreviewObjectCategory=k.MINIMUM}updatePreviewModel(e,t,s=!0){const r=new bO;r.flush(),r.parseModel(e,t,s);const i=this._roomEngine.getLegacyWallGeometry(this._previewRoomId);if(!i)return;this._planeParser.reset();const a=r.width,l=r.height;this._planeParser.initializeTileMap(a,l);const c=null;let u=-1,h=-1,d=0,f=0,E=0;for(;E<l;){let S=0;for(;S<a;){const A=r.getHeight(S,E);(E>0&&E<l-1||S>0&&S<a-1)&&A!=Hs.TILE_BLOCKED&&c==null&&(r.getHeight(S,E-1)==Hs.TILE_BLOCKED&&r.getHeight(S-1,E)==Hs.TILE_BLOCKED&&r.getHeight(S,E+1)==Hs.TILE_BLOCKED&&(u=S+.5,h=E,d=A,f=90),r.getHeight(S,E-1)==Hs.TILE_BLOCKED&&r.getHeight(S-1,E)==Hs.TILE_BLOCKED&&r.getHeight(S+1,E)==Hs.TILE_BLOCKED&&(u=S,h=E+.5,d=A,f=180)),this._planeParser.setTileHeight(S,E,A),S++}E++}this._planeParser.setTileHeight(Math.floor(u),Math.floor(h),d),this._planeParser.initializeFromTileData(r.wallHeight),this._planeParser.setTileHeight(Math.floor(u),Math.floor(h),d+this._planeParser.wallHeight),i.scale=xE.DEFAULT_SCALE,i.initialize(a,l,this._planeParser.floorHeight);let m=r.height-1;for(;m>=0;){let S=r.width-1;for(;S>=0;)i.setHeight(S,m,this._planeParser.getTileHeight(S,m)),S--;m--}const R=this._planeParser.getMapData();R.doors.push({x:u,y:h,z:d,dir:f});const I=this.getRoomPreviewOwnRoomObject();I&&I.processUpdateMessage(new ib(R))}addFurnitureIntoRoom(e,t,s=null,r=null){if(s||(s=new Br),this.isRoomEngineReady&&(this.reset(!1),this._currentPreviewObjectType=e,this._currentPreviewObjectCategory=k.FLOOR,this._currentPreviewObjectData="",this._roomEngine.addFurnitureFloor(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e,new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y,0),t,0,s,NaN,-1,0,-1,"",!0,!1))){this._previousAutomaticStateChangeTime=ve(),this._automaticStateChange=!0;const i=this._roomEngine.getRoomObject(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);return i&&r&&i.model.setValue(C.FURNITURE_EXTRAS,r),this.updatePreviewRoomView(),_e.PREVIEW_OBJECT_ID}return-1}addWallItemIntoRoom(e,t,s){if(this.isRoomEngineReady){if(this._currentPreviewObjectCategory===k.WALL&&this._currentPreviewObjectType===e&&this._currentPreviewObjectData===s)return _e.PREVIEW_OBJECT_ID;if(this.reset(!1),this._currentPreviewObjectType=e,this._currentPreviewObjectCategory=k.WALL,this._currentPreviewObjectData=s,this._roomEngine.addFurnitureWall(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e,new F(.5,2.3,1.8),t,0,s,0,0,-1,"",!1))return this._previousAutomaticStateChangeTime=ve(),this._automaticStateChange=!0,this.updatePreviewRoomView(),_e.PREVIEW_OBJECT_ID}return-1}addAvatarIntoRoom(e,t){return this.isRoomEngineReady?(this.reset(!1),this._currentPreviewObjectType=1,this._currentPreviewObjectCategory=k.UNIT,this._currentPreviewObjectData=e,this._roomEngine.addRoomObjectUser(this._previewRoomId,_e.PREVIEW_OBJECT_ID,new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y,0),new F(90,0,0),135,ft.getTypeNumber(ft.USER),e)&&(this._previousAutomaticStateChangeTime=ve(),this._automaticStateChange=!0,this.updateUserGesture(1),this.updateUserEffect(t),this.updateUserPosture("std")),this.updatePreviewRoomView(),_e.PREVIEW_OBJECT_ID):-1}addPetIntoRoom(e){return this.isRoomEngineReady?(this.reset(!1),this._currentPreviewObjectType=1,this._currentPreviewObjectCategory=k.UNIT,this._currentPreviewObjectData=e,this._roomEngine.addRoomObjectUser(this._previewRoomId,_e.PREVIEW_OBJECT_ID,new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y,0),new F(90,0,0),90,ft.getTypeNumber(ft.PET),e)&&(this._previousAutomaticStateChangeTime=ve(),this._automaticStateChange=!1,this.updateUserGesture(1),this.updateUserPosture("std")),this.updatePreviewRoomView(),_e.PREVIEW_OBJECT_ID):-1}updateUserPosture(e,t=""){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserPosture(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e,t)}updateUserGesture(e){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserGesture(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e)}updateUserEffect(e){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserEffect(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e)}updateObjectUserFigure(e,t=null,s=null,r=!1){return this.isRoomEngineReady?this._roomEngine.updateRoomObjectUserFigure(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e,t,s,r):!1}updateObjectUserAction(e,t,s=null){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserAction(this._previewRoomId,_e.PREVIEW_OBJECT_ID,e,t,s)}updateObjectStuffData(e){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectFloor(this._previewRoomId,_e.PREVIEW_OBJECT_ID,null,null,e.state,e)}changeRoomObjectState(){this.isRoomEngineReady&&(this._automaticStateChange=!1,this._currentPreviewObjectCategory!==k.UNIT&&this._roomEngine.changeObjectState(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory))}changeRoomObjectDirection(){if(this.isRoomEngineReady){const e=this._roomEngine.getRoomObject(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(!e)return;const t=this._roomEngine.objectEventHandler.getValidRoomObjectDirection(e,!0);switch(this._currentPreviewObjectCategory){case k.FLOOR:{const s=new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y),r=new F(t,t,t);this._roomEngine.updateRoomObjectFloor(this._previewRoomId,_e.PREVIEW_OBJECT_ID,s,r,null,null);return}case k.WALL:return}}}checkAutomaticRoomObjectStateChange(){if(this._automaticStateChange){const e=ve();e>this._previousAutomaticStateChangeTime+_e.AUTOMATIC_STATE_CHANGE_INTERVAL&&(this._previousAutomaticStateChangeTime=e,this.isRoomEngineReady&&this._roomEngine.changeObjectState(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory))}}getRoomCanvas(e,t){if(this.isRoomEngineReady){const s=this._roomEngine.getRoomInstanceDisplay(this._previewRoomId,_e.PREVIEW_CANVAS_ID,e,t,this._currentPreviewScale);if(s&&this._backgroundColor!==null){let i=this._backgroundSprite;i||(i=new jt(ts.WHITE),s.addChildAt(i,0)),i.width=e,i.height=t,i.tint=this._backgroundColor}this._roomEngine.setRoomInstanceRenderingCanvasMask(this._previewRoomId,_e.PREVIEW_CANVAS_ID,!0);const r=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,_e.PREVIEW_CANVAS_ID);return r&&r.adjustLocation(new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y,0),30),this._currentPreviewCanvasWidth=e,this._currentPreviewCanvasHeight=t,s}return null}modifyRoomCanvas(e,t){this.isRoomEngineReady&&(this._currentPreviewCanvasWidth=e,this._currentPreviewCanvasHeight=t,this._backgroundSprite&&(this._backgroundSprite.width=e,this._backgroundSprite.height=t),this._roomEngine.initializeRoomInstanceRenderingCanvas(this._previewRoomId,_e.PREVIEW_CANVAS_ID,e,t))}set addViewOffset(e){this._addViewOffset=e}get addViewOffset(){return this._addViewOffset}updatePreviewObjectBoundingRectangle(e){const t=this._roomEngine.getRoomObjectBoundingRectangle(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory,_e.PREVIEW_CANVAS_ID);if(t&&e)if(t.x+=-(this._currentPreviewCanvasWidth>>1),t.y+=-(this._currentPreviewCanvasHeight>>1),t.x+=-e.x,t.y+=-e.y,!this._currentPreviewRectangle)this._currentPreviewRectangle=t;else{const s=this._currentPreviewRectangle.clone().enlarge(t);(s.width-this._currentPreviewRectangle.width>this._currentPreviewCanvasWidth-this._currentPreviewRectangle.width>>1||s.height-this._currentPreviewRectangle.height>this._currentPreviewCanvasHeight-this._currentPreviewRectangle.height>>1||this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)&&(this._currentPreviewRectangle=s)}}validatePreviewSize(e){if(this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)return e;if(this.isRoomEngineReady){const t=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,_e.PREVIEW_CANVAS_ID);this._currentPreviewRectangle.width>this._currentPreviewCanvasWidth*(1+_e.ALLOWED_IMAGE_CUT)||this._currentPreviewRectangle.height>this._currentPreviewCanvasHeight*(1+_e.ALLOWED_IMAGE_CUT)?_e.ZOOM_ENABLED?this._roomEngine.getRoomInstanceRenderingCanvasScale(this._previewRoomId,_e.PREVIEW_CANVAS_ID)!==.5&&(this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,_e.PREVIEW_CANVAS_ID,.5,null,null),this._currentPreviewScale=_e.SCALE_SMALL,this._currentPreviewNeedsZoomOut=!0,e.x=e.x>>1,e.y=e.y>>1,this._currentPreviewRectangle.x=this._currentPreviewRectangle.x>>2,this._currentPreviewRectangle.y=this._currentPreviewRectangle.y>>2,this._currentPreviewRectangle.width=this._currentPreviewRectangle.width>>2,this._currentPreviewRectangle.height=this._currentPreviewRectangle.height>>2):t.isZoomedIn()&&(t.performZoomOut(),this._currentPreviewScale=_e.SCALE_SMALL,this._currentPreviewNeedsZoomOut=!0):this._currentPreviewNeedsZoomOut||(_e.ZOOM_ENABLED?this._roomEngine.getRoomInstanceRenderingCanvasScale(this._previewRoomId,_e.PREVIEW_CANVAS_ID)!==1&&(this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,_e.PREVIEW_CANVAS_ID,1,null,null),this._currentPreviewScale=_e.SCALE_NORMAL):t.isZoomedIn()||(t.performZoomIn(),this._currentPreviewScale=_e.SCALE_NORMAL))}return e}zoomIn(){this.isRoomEngineReady&&(_e.ZOOM_ENABLED?this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,_e.PREVIEW_CANVAS_ID,1):this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,_e.PREVIEW_CANVAS_ID).performZoomIn()),this._currentPreviewScale=_e.SCALE_NORMAL}zoomOut(){this.isRoomEngineReady&&(_e.ZOOM_ENABLED?this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,_e.PREVIEW_CANVAS_ID,.5):this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,_e.PREVIEW_CANVAS_ID).performZoomOut()),this._currentPreviewScale=_e.SCALE_SMALL}updateAvatarDirection(e,t){this.isRoomEngineReady&&this._roomEngine.updateRoomObjectUserLocation(this._previewRoomId,_e.PREVIEW_OBJECT_ID,new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y,0),new F(_e.PREVIEW_OBJECT_LOCATION_X,_e.PREVIEW_OBJECT_LOCATION_Y,0),!1,0,new F(e*45,0,0),t*45)}updateObjectRoom(e=null,t=null,s=null,r=!1){return this.isRoomEngineReady?this._roomEngine.updateRoomInstancePlaneType(this._previewRoomId,e,t,s,r):!1}updateRoomWallsAndFloorVisibility(e,t=!0){this.isRoomEngineReady&&this._roomEngine.updateRoomInstancePlaneVisibility(this._previewRoomId,e,t)}getCanvasOffset(e){if(this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)return e;let t=-(this._currentPreviewRectangle.left+this._currentPreviewRectangle.right)>>1,s=-(this._currentPreviewRectangle.top+this._currentPreviewRectangle.bottom)>>1;const r=this._currentPreviewCanvasHeight-this._currentPreviewRectangle.height>>1;r>10?s=s+Math.min(15,r-10):this._currentPreviewObjectCategory!==k.UNIT?s=s+(5-Math.max(0,r/2)):s=s-(5-Math.min(0,r/2)),s=s+this._addViewOffset.y,t=t+this._addViewOffset.x;const i=t-e.x,a=s-e.y;if(i!==0||a!==0){const l=Math.sqrt(i*i+a*a);return l>10&&(t=e.x+i*10/l,s=e.y+a*10/l),new Fe(t,s)}return null}updatePreviewRoomView(e=!1){if(!(this._disableUpdate&&!e)&&(this.checkAutomaticRoomObjectStateChange(),this.isRoomEngineReady)){let t=this._roomEngine.getRoomInstanceRenderingCanvasOffset(this._previewRoomId,_e.PREVIEW_CANVAS_ID);if(t&&(this.updatePreviewObjectBoundingRectangle(t),this._currentPreviewRectangle)){const s=this._currentPreviewScale;t=this.validatePreviewSize(t);const r=this.getCanvasOffset(t);r&&this._roomEngine.setRoomInstanceRenderingCanvasOffset(this._previewRoomId,_e.PREVIEW_CANVAS_ID,r),this._currentPreviewScale!==s&&(this._currentPreviewRectangle=null)}}}set disableUpdate(e){this._disableUpdate=e}set disableRoomEngineUpdate(e){this.isRoomEngineReady&&this._roomEngine.disableUpdate(e)}onRoomInitializedonRoomInitialized(e){if(e)switch(e.type){case je.INITIALIZED:e.roomId===this._previewRoomId&&this.isRoomEngineReady&&this._roomEngine.updateRoomInstancePlaneType(this._previewRoomId,"110","99999");return}}onRoomObjectAdded(e){if(e.roomId===this._previewRoomId&&e.objectId===_e.PREVIEW_OBJECT_ID&&e.category===this._currentPreviewObjectCategory){this._currentPreviewRectangle=null,this._currentPreviewNeedsZoomOut=!1;const t=this._roomEngine.getRoomObject(e.roomId,e.objectId,e.category);if(t&&t.model&&e.category===k.WALL){const s=t.model.getValue(C.FURNITURE_SIZE_Z),r=t.model.getValue(C.FURNITURE_CENTER_Z);(s!==null||r!==null)&&this._roomEngine.updateRoomObjectWallLocation(e.roomId,e.objectId,new F(.5,2.3,(3.6-s)/2+r))}}}updateRoomEngine(){this.isRoomEngineReady&&this._roomEngine.runUpdate()}getRenderingCanvas(){const e=this._roomEngine.getRoomInstanceRenderingCanvas(this._previewRoomId,_e.PREVIEW_CANVAS_ID);return e||null}getGenericRoomObjectImage(e,t,s,r,i,a=0,l=null,c=null,u=-1,h=-1,d=null){return this.isRoomEngineReady?this._roomEngine.getGenericRoomObjectImage(e,t,s,r,i,a,l,c,u,h,d):null}getRoomObjectImage(e,t,s,r=0){return this.isRoomEngineReady?this._roomEngine.getRoomObjectImage(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory,e,t,s,r):null}getRoomObjectCurrentImage(){if(this.isRoomEngineReady){const e=this._roomEngine.getRoomObject(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(e&&e.visualization)return e.visualization.getImage(16777215,-1)}return null}getRoomPreviewObject(){if(this.isRoomEngineReady){const e=this._roomEngine.getRoomObject(this._previewRoomId,_e.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(e)return e}return null}getRoomPreviewOwnRoomObject(){if(this.isRoomEngineReady){const e=this._roomEngine.getRoomObject(this._previewRoomId,wE.ROOM_OBJECT_ID,k.ROOM);if(e)return e}return null}get isRoomEngineReady(){return this._roomEngine&&this._roomEngine.ready}get roomId(){return this._previewRoomId}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e}get width(){return this._currentPreviewCanvasWidth}get height(){return this._currentPreviewCanvasHeight}};qi.SCALE_NORMAL=64;qi.SCALE_SMALL=32;qi.PREVIEW_COUNTER=0;qi.PREVIEW_CANVAS_ID=1;qi.PREVIEW_OBJECT_ID=1;qi.PREVIEW_OBJECT_LOCATION_X=2;qi.PREVIEW_OBJECT_LOCATION_Y=2;qi.ALLOWED_IMAGE_CUT=.25;qi.AUTOMATIC_STATE_CHANGE_INTERVAL=2500;qi.ZOOM_ENABLED=!0;let td=qi;class kp{constructor(e,t){this._image=e,this._placeHolder=t}get image(){return this._image}get placeHolder(){return this._placeHolder}}class IX{constructor(e){this._code=e,this._parts=[]}get code(){return this._code}get parts(){return this._parts}}const Rn=class vr{constructor(e,t=0,s=0,r=0){this.type=e,this.key=t,this.color=s,this.position=r}get code(){return this.key===0?null:vr.getCode(this.type,this.key,this.color,this.position)}static getCode(e,t,s,r){return(e===vr.BASE?e:t>=100?vr.SYMBOL_ALT:vr.SYMBOL)+(t<10?"0":"")+(e===vr.BASE?t:t>=100?t-100:t)+(s<10?"0":"")+s+r}calculatePosition(e){const t=this.calculateGridPos(this.position);let s=vr.CELL_WIDTH*t.x+vr.CELL_WIDTH/2-e.width/2,r=vr.CELL_HEIGHT*t.y+vr.CELL_HEIGHT/2-e.height/2;return s<0&&(s=0),s+e.width>vr.IMAGE_WIDTH&&(s=vr.IMAGE_WIDTH-e.width),r<0&&(r=0),r+e.height>vr.IMAGE_HEIGHT&&(r=vr.IMAGE_HEIGHT-e.height),new Ii(Math.floor(s),Math.floor(r))}calculateGridPos(e){const t=new Ii;return t.x=Math.floor(e%3),t.y=Math.floor(e/3),t}};Rn.BASE="b";Rn.SYMBOL="s";Rn.SYMBOL_ALT="t";Rn.BASE_PART=0;Rn.LAYER_PART=1;Rn.IMAGE_WIDTH=39;Rn.IMAGE_HEIGHT=39;Rn.CELL_WIDTH=13;Rn.CELL_HEIGHT=13;let Il=Rn;const GE=class Fn{constructor(e,t){this._assets=e,this._sessionDataManager=t,this._groupBases=new Map,this._groupSymbols=new Map,this._groupPartColors=new Map,this._requestedBadges=new Map,this._groupBadgesQueue=new Map,this._readyToGenerateGroupBadges=!1}init(){if(this._sessionDataManager&&this._sessionDataManager.communication){this._messages=[new wm(this.onGroupBadgePartsEvent.bind(this))];for(const e of this._messages)this._sessionDataManager.communication.registerMessageEvent(e)}}dispose(){if(this._messages&&this._messages.length){for(const e of this._messages)this._sessionDataManager.communication.removeMessageEvent(e);this._messages=null}this._sessionDataManager=null}getBadgeImage(e,t=Fn.NORMAL_BADGE,s=!0){let r=this.getBadgeTexture(e,t);return!r&&s&&(r=this.getBadgePlaceholder()),r}getBadgeInfo(e){const t=this.getBadgeTexture(e);return t?new kp(t,!1):new kp(this.getBadgePlaceholder(),!0)}loadBadgeImage(e,t=Fn.NORMAL_BADGE){return this._assets.getTexture(this.getBadgeUrl(e,t))?e:(this.getBadgeTexture(e,t),null)}getBadgeTexture(e,t=Fn.NORMAL_BADGE){const s=this.getBadgeUrl(e,t);if(!s||!s.length)return null;const r=this._assets.getTexture(s);if(r)return r.clone();if(t===Fn.NORMAL_BADGE){if(this._requestedBadges.get(e))return null;this._requestedBadges.set(e,!0),this._assets.downloadAsset(s).then(i=>{if(!i)return;this._requestedBadges.delete(e);const a=this._assets.getTexture(s);a&&this._sessionDataManager&&this._sessionDataManager.events.dispatchEvent(new To(e,a.clone()))}).catch(i=>{})}else if(t===Fn.GROUP_BADGE){if(this._groupBadgesQueue.get(e))return;this._groupBadgesQueue.set(e,!0),this._readyToGenerateGroupBadges&&this.loadGroupBadge(e)}return null}getBadgePlaceholder(){const e=Ue.getValue("images.url")+"/loading_icon.png",t=this._assets.getTexture(e);return t?t.clone():null}getBadgeUrl(e,t=Fn.NORMAL_BADGE){let s=null;switch(t){case Fn.NORMAL_BADGE:s=Ue.getValue("badge.asset.url").replace("%badgename%",e);break;case Fn.GROUP_BADGE:s=e;break}return s}loadGroupBadge(e){const t=new IX(e),s=[...e.matchAll(/[b|s][0-9]{4,6}/g)];for(const r of s){const i=r[0],a=i.length===6,l=i[0],c=parseInt(i.slice(1,a?3:4)),u=parseInt(i.slice(a?3:4,a?5:6)),h=i.length<6?0:parseInt(i.slice(a?5:6,a?6:7)),d=new Il(l,c,u,h);t.parts.push(d)}this.renderGroupBadge(t)}renderGroupBadge(e){const t=new di,s=new jt(am.EMPTY);s.width=Il.IMAGE_WIDTH,s.height=Il.IMAGE_HEIGHT,t.addChild(s);for(const i of e.parts){let a=!0;const l=i.type==="b"?this._groupBases.get(i.key):this._groupSymbols.get(i.key);if(l)for(const c of l){if(!c||!c.length)continue;const u=this._assets.getTexture(`badgepart_${c}`);if(!u)continue;const{x:h,y:d}=i.calculatePosition(u),f=new jt(u);f.position.set(h,d),a&&(f.tint=parseInt(this._groupPartColors.get(i.color),16)),a=!1,t.addChild(f)}}this._requestedBadges.delete(e.code),this._groupBadgesQueue.delete(e.code);const r=ht.generateTexture(t);this._assets.setTexture(e.code,r),this._sessionDataManager&&this._sessionDataManager.events.dispatchEvent(new To(e.code,r))}onGroupBadgePartsEvent(e){if(!e)return;const t=e.getParser();if(t){t.bases.forEach((s,r)=>this._groupBases.set(r,s.map(i=>i.replace(".png","").replace(".gif","")))),t.symbols.forEach((s,r)=>this._groupSymbols.set(r,s.map(i=>i.replace(".png","").replace(".gif","")))),this._groupPartColors=t.partColors,this._readyToGenerateGroupBadges=!0;for(const s of this._groupBadgesQueue.keys())this.loadGroupBadge(s)}}get disposed(){return!!this._sessionDataManager}};GE.GROUP_BADGE="group_badge";GE.NORMAL_BADGE="normal_badge";let Uu=GE;class Vp{constructor(e,t,s,r,i,a,l,c,u,h,d,f,E,m,R,I,S,A,N,L,M,b,B,w,x,U,G,K,Y){this._type=e,this._id=t,this._fullName=s,this._className=r,this._category=i,this._revision=c,this._tileSizeX=u,this._tileSizeY=h,this._tileSizeZ=d,this._colors=f,this._hasIndexedColor=E,this._colourIndex=m,this._localizedName=a,this._description=l,this._adUrl=R,this._purchaseOfferId=I,this._purchaseCouldBeUsedForBuyout=S,this._rentOfferId=A,this._rentCouldBeUsedForBuyout=N,this._customParams=M,this._specialType=b,this._availableForBuildersClub=L,this._canStandOn=B,this._canSitOn=w,this._canLayOn=x,this._excludedFromDynamic=U,this._furniLine=G,this._environment=K,this._rare=Y}get type(){return this._type}get id(){return this._id}get className(){return this._className}set className(e){this._className=e}get fullName(){return this._fullName}get category(){return this._category}get hasIndexedColor(){return this._hasIndexedColor}get colorIndex(){return this._colourIndex}get revision(){return this._revision}get tileSizeX(){return this._tileSizeX}get tileSizeY(){return this._tileSizeY}get tileSizeZ(){return this._tileSizeZ}get colors(){return this._colors}get name(){return this._localizedName}get description(){return this._description}get adUrl(){return this._adUrl}get purchaseOfferId(){return this._purchaseOfferId}get customParams(){return this._customParams}get specialType(){return this._specialType}get rentOfferId(){return this._rentOfferId}get purchaseCouldBeUsedForBuyout(){return this._purchaseCouldBeUsedForBuyout}get rentCouldBeUsedForBuyout(){return this._rentCouldBeUsedForBuyout}get availableForBuildersClub(){return this._availableForBuildersClub}get canStandOn(){return this._canStandOn}get canSitOn(){return this._canSitOn}get canLayOn(){return this._canLayOn}get isExternalImage(){return this._className.indexOf("external_image")!==-1}get excludeDynamic(){return this._excludedFromDynamic}get furniLine(){return this._furniLine}get environment(){return this._environment}get rare(){return this._rare}}const BE=class vf extends jr{constructor(e,t,s){super(),this._floorItems=e,this._wallItems=t,this._localization=s}loadFurnitureData(e){e&&fetch(e).then(t=>t.json()).then(t=>this.onFurnitureDataLoaded(t)).catch(t=>this.onFurnitureDataError(t))}onFurnitureDataLoaded(e){e&&((typeof e.roomitemtypes>"u"||typeof e.wallitemtypes>"u")&&me.warn("Could not find `roomitemtypes` or `wallitemtypes` in furnidata."),e.roomitemtypes&&this.parseFloorItems(e.roomitemtypes),e.wallitemtypes&&this.parseWallItems(e.wallitemtypes),this.dispatchEvent(new He(vf.FURNITURE_DATA_READY)))}onFurnitureDataError(e){e&&(me.error(e),this.dispatchEvent(new He(vf.FURNITURE_DATA_ERROR)))}parseFloorItems(e){if(!(!e||!e.furnitype))for(const t of e.furnitype){if(!t)continue;const s=[];if(t.partcolors)for(const u of t.partcolors.color){let h=u;h.charAt(0)==="#"&&(h=h.replace("#","")),s.push(parseInt(h,16))}const r=t.classname.split("*"),i=r[0],a=r.length>1?parseInt(r[1]):0,l=r.length>1,c=new Vp(go.FLOOR,t.id,t.classname,i,t.category,t.name,t.description,t.revision,t.xdim,t.ydim,0,s,l,a,t.adurl,t.offerid,t.buyout,t.rentofferid,t.rentbuyout,t.bc,t.customparams,t.specialtype,t.canstandon,t.cansiton,t.canlayon,t.excludeddynamic,t.furniline,t.environment,t.rare);this._floorItems.set(c.id,c),this.updateLocalizations(c)}}parseWallItems(e){if(!(!e||!e.furnitype))for(const t of e.furnitype){if(!t)continue;const s=new Vp(go.WALL,t.id,t.classname,t.classname,t.category,t.name,t.description,t.revision,0,0,0,null,!1,0,t.adurl,t.offerid,t.buyout,t.rentofferid,t.rentbuyout,t.bc,null,t.specialtype,!1,!1,!1,t.excludeddynamic,t.furniline,t.environment,t.rare);this._wallItems.set(s.id,s),this.updateLocalizations(s)}}updateLocalizations(e){if(this._localization)switch(e.type){case go.FLOOR:this._localization.setValue("roomItem.name."+e.id,e.name),this._localization.setValue("roomItem.desc."+e.id,e.description);return;case go.WALL:this._localization.setValue("wallItem.name."+e.id,e.name),this._localization.setValue("wallItem.desc."+e.id,e.description);return}}};BE.FURNITURE_DATA_READY="FDP_FURNITURE_DATA_READY";BE.FURNITURE_DATA_ERROR="FDP_FURNITURE_DATA_ERROR";let U_=BE;class TX{constructor(e){this._sessionDataManager=e,this._groupBadges=new Map}init(){if(this._sessionDataManager&&this._sessionDataManager.communication){this._messages=[new Al(this.onRoomReadyMessageEvent.bind(this)),new yN(this.onGroupBadgesEvent.bind(this))];for(const e of this._messages)this._sessionDataManager.communication.registerMessageEvent(e)}}dispose(){if(!this.disposed){if(this._messages&&this._messages.length){for(const e of this._messages)this._sessionDataManager.communication.removeMessageEvent(e);this._messages=null}this._groupBadges=null,this._sessionDataManager=null}}onRoomReadyMessageEvent(e){this._sessionDataManager.send(new Dv)}onGroupBadgesEvent(e){const t=e.getParser();for(const[s,r]of t.badges.entries())this._groupBadges.set(s,r)}getGroupBadge(e){return this._groupBadges.get(e)}get disposed(){return!!this._sessionDataManager}}class _r{}_r.NO_CLUB=0;_r.CLUB=1;_r.VIP=2;class Qi extends Hr{constructor(e,t){super(),this._connection=e,this._listener=t,this._roomId=0}onDispose(){this._connection=null,this._listener=null}setRoomId(e){this._roomId=e}get connection(){return this._connection}get listener(){return this._listener}get roomId(){return this._roomId}}class RX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new bh(this.onRoomGenericError.bind(this)))}onRoomGenericError(e){if(!(e instanceof bh))return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;let r=null;switch(t.errorCode){case um.KICKED_OUT_OF_ROOM:r=Be.RSEME_KICKED;break;default:return}!r||r.length==0||this.listener.events.dispatchEvent(new Be(r,s))}}class OX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new EA(this.onOpenPetPackageRequested.bind(this))),e.addMessageEvent(new pA(this.onOpenPetPackageResult.bind(this)))}onOpenPetPackageRequested(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new Aa(Aa.RSOPPE_OPEN_PET_PACKAGE_REQUESTED,s,t.objectId,t.figureData,0,null))}onOpenPetPackageResult(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new Aa(Aa.RSOPPE_OPEN_PET_PACKAGE_RESULT,s,t.objectId,null,t.nameValidationStatus,t.nameValidationInfo))}}class SX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new OA(this.onPollContentsEvent.bind(this))),e.addMessageEvent(new CA(this.onPollOfferEvent.bind(this))),e.addMessageEvent(new SA(this.onPollErrorEvent.bind(this))),e.addMessageEvent(new DA(this.onStartRoomPollEvent.bind(this))),e.addMessageEvent(new MA(this.onRoomPollResultEvent.bind(this)))}onPollContentsEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new ui(ui.CONTENT,t,s.id);r.startMessage=s.startMessage,r.endMessage=s.endMessage,r.numQuestions=s.numQuestions,r.questionArray=s.questionArray,r.npsPoll=s.npsPoll,this.listener.events.dispatchEvent(r)}onPollOfferEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new ui(ui.OFFER,t,s.id);r.summary=s.headline,r.summary=s.summary,this.listener.events.dispatchEvent(r)}onPollErrorEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t||!e.getParser())return;const r=new ui(ui.ERROR,t,-1);r.headline="???",r.summary="???",this.listener.events.dispatchEvent(r)}onStartRoomPollEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new cl(cl.VOTE_QUESTION,t,s.question,s.choices);this.listener.events.dispatchEvent(r)}onRoomPollResultEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new cl(cl.VOTE_RESULT,t,s.question,s.choices,s.SafeStr_7651,s.SafeStr_7654);this.listener.events.dispatchEvent(r)}}class CX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new Ym(this.onRoomUnitChatEvent.bind(this))),e.addMessageEvent(new kh(this.onRoomUnitChatEvent.bind(this))),e.addMessageEvent(new Vh(this.onRoomUnitChatEvent.bind(this))),e.addMessageEvent(new sN(this.onRoomUnitHandItemReceivedEvent.bind(this))),e.addMessageEvent(new Zm(this.onRespectReceivedEvent.bind(this))),e.addMessageEvent(new LN(this.onPetRespectNoficationEvent.bind(this))),e.addMessageEvent(new UN(this.onPetSupplementedNotificationEvent.bind(this))),e.addMessageEvent(new eN(this.onFloodControlEvent.bind(this))),e.addMessageEvent(new tN(this.onRemainingMuteEvent.bind(this)))}onRoomUnitChatEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;let r=we.CHAT_TYPE_SPEAK;e instanceof kh?r=we.CHAT_TYPE_SHOUT:e instanceof Vh&&(r=we.CHAT_TYPE_WHISPER);const i=new we(we.CHAT_EVENT,t,s.roomIndex,s.message,r,s.bubble);this.listener.events.dispatchEvent(i)}onRoomUnitHandItemReceivedEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();s&&this.listener.events.dispatchEvent(new we(we.CHAT_EVENT,t,s.giverUserId,"",we.CHAT_TYPE_HAND_ITEM_RECEIVED,Vn.GENERIC,null,s.handItemType))}onRespectReceivedEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=t.userDataManager.getUserData(s.userId);r&&this.listener.events.dispatchEvent(new we(we.CHAT_EVENT,t,r.roomIndex,"",we.CHAT_TYPE_RESPECT,Vn.GENERIC))}onPetRespectNoficationEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=t.userDataManager.getPetData(s.petData.id);if(!r)return;let i=we.CHAT_TYPE_PETRESPECT;s.isTreat&&(i=we.CHAT_TYPE_PETTREAT),this.listener.events.dispatchEvent(new we(we.CHAT_EVENT,t,r.roomIndex,"",i,Vn.GENERIC))}onPetSupplementedNotificationEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=t.userDataManager.getPetData(s.petId);if(!r)return;let i=-1;const a=t.userDataManager.getUserData(s.userId);a&&(i=a.roomIndex);let l=we.CHAT_TYPE_PETREVIVE;switch(s.supplementType){case Pa.REVIVE:l=we.CHAT_TYPE_PETREVIVE;break;case Pa.REBREED_FERTILIZER:l=we.CHAT_TYPE_PET_REBREED_FERTILIZE;break;case Pa.SPEED_FERTILIZER:l=we.CHAT_TYPE_PET_SPEED_FERTILIZE;break}this.listener.events.dispatchEvent(new we(we.CHAT_EVENT,t,r.roomIndex,"",l,Vn.GENERIC,null,i))}onFloodControlEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=s.seconds;this.listener.events.dispatchEvent(new we(we.FLOOD_EVENT,t,-1,r.toString(),0,0))}onRemainingMuteEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();s&&this.listener.events.dispatchEvent(new we(we.CHAT_EVENT,t,t.ownRoomIndex,"",we.CHAT_TYPE_MUTE_REMAINING,Vn.GENERIC,null,s.seconds))}}class AX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new sa(this.onGetGuestRoomResultEvent.bind(this)))}onGetGuestRoomResultEvent(e){if(!(e instanceof sa))return;const t=e.getParser();if(!t||t.roomForward)return;const s=this.listener.getSession(this.roomId);if(!s)return;const r=t.data;s.tradeMode=r.tradeMode,s.isGuildRoom=r.habboGroupId!==0,s.doorMode=r.doorMode,s.allowPets=r.allowPets,s.moderationSettings=t.moderation,this.listener.events.dispatchEvent(new Tg(Tg.RSDUE_ALLOW_PETS,s)),this.listener.events.dispatchEvent(new Ne(Ne.ROOM_DATA,s))}}class NX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new jA(this.onRoomDimmerPresets.bind(this)))}onRoomDimmerPresets(e){if(!e)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;const r=new Mh(Mh.ROOM_DIMMER_PRESETS,s);r.selectedPresetId=t.selectedPresetId;let i=0;for(;i<t.presetCount;){const a=t.getPreset(i);a&&r.storePreset(a.id,a.type,a.color,a.brightness),i++}this.listener&&this.listener.events.dispatchEvent(r)}}class yX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new Ug(this.onRoomRightsEvent.bind(this))),e.addMessageEvent(new Lg(this.onRoomRightsClearEvent.bind(this))),e.addMessageEvent(new Fg(this.onRoomRightsOwnerEvent.bind(this)))}onRoomRightsEvent(e){if(!(e instanceof Ug))return;const t=this.listener.getSession(this.roomId);t&&t.setControllerLevel(e.getParser().controllerLevel)}onRoomRightsClearEvent(e){if(!(e instanceof Lg))return;const t=this.listener.getSession(this.roomId);t&&t.setControllerLevel(ct.NONE)}onRoomRightsOwnerEvent(e){if(!(e instanceof Fg))return;const t=this.listener.getSession(this.roomId);t&&t.setRoomOwner()}}class MX extends Qi{constructor(e,t){super(e,t),e&&e.addMessageEvent(new lC(this.onFurnitureGiftOpenedEvent.bind(this)))}onFurnitureGiftOpenedEvent(e){if(!e)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener&&this.listener.events&&this.listener.events.dispatchEvent(new Dh(Dh.RSPE_PRESENT_OPENED,s,t.classId,t.itemType,t.productCode,t.placedItemId,t.placedItemType,t.placedInRoom,t.petFigureString))}}const e_=class Ac extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new Fh(this.onRoomEnterEvent.bind(this))),e.addMessageEvent(new Al(this.onRoomReadyMessageEvent.bind(this))),e.addMessageEvent(new Gc(this.onDesktopViewEvent.bind(this))),e.addMessageEvent(new Uh(this.onRoomDoorbellAcceptedEvent.bind(this))),e.addMessageEvent(new Lh(this.onRoomDoorbellRejectedEvent.bind(this))),e.addMessageEvent(new $A(this.onYouAreSpectatorMessageEvent.bind(this)))}onRoomEnterEvent(e){e instanceof Fh&&this.listener&&this.listener.sessionUpdate(this.roomId,Ac.RS_CONNECTED)}onRoomReadyMessageEvent(e){if(!(e instanceof Al))return;const t=this.roomId,s=e.getParser().roomId;this.listener&&(this.listener.sessionReinitialize(t,s),this.listener.sessionUpdate(this.roomId,Ac.RS_READY))}onDesktopViewEvent(e){e instanceof Gc&&this.listener&&this.listener.sessionUpdate(this.roomId,Ac.RS_DISCONNECTED)}onRoomDoorbellAcceptedEvent(e){if(!(e instanceof Uh)||!this.listener)return;const t=e.getParser();if(!t)return;const s=t.userName;if(!s||!s.length)this.connection.send(new QD(this.roomId));else if(this.listener.events){const r=this.listener.getSession(this.roomId);if(!r)return;this.listener.events.dispatchEvent(new mi(mi.RSDE_ACCEPTED,r,s))}}onRoomDoorbellRejectedEvent(e){if(!(e instanceof Lh)||!this.listener)return;const t=e.getParser();if(!t)return;const s=t.userName;if(!s||!s.length)this.listener.sessionUpdate(this.roomId,Ac.RS_DISCONNECTED);else if(this.listener.events){const r=this.listener.getSession(this.roomId);if(!r)return;this.listener.events.dispatchEvent(new mi(mi.RSDE_REJECTED,r,s))}}onYouAreSpectatorMessageEvent(e){if(this.listener){const t=this.listener.getSession(this.roomId);if(!t)return;t.isSpectator=!0,this.listener.events.dispatchEvent(new Rg(Rg.SPECTATOR_MODE,t))}}};e_.RS_CONNECTED="RS_CONNECTED";e_.RS_READY="RS_READY";e_.RS_DISCONNECTED="RS_DISCONNECTED";let Fu=e_;class DX{constructor(){this._adultLevel=7}get id(){return this._id}set id(e){this._id=e}get level(){return this._level}set level(e){this._level=e}get maximumLevel(){return this._maximumLevel}set maximumLevel(e){this._maximumLevel=e}get experience(){return this._experience}set experience(e){this._experience=e}get levelExperienceGoal(){return this._levelExperienceGoal}set levelExperienceGoal(e){this._levelExperienceGoal=e}get energy(){return this._energy}set energy(e){this._energy=e}get maximumEnergy(){return this._maximumEnergy}set maximumEnergy(e){this._maximumEnergy=e}get happyness(){return this._happyness}set happyness(e){this._happyness=e}get maximumHappyness(){return this._maximumHappyness}set maximumHappyness(e){this._maximumHappyness=e}get ownerId(){return this._ownerId}set ownerId(e){this._ownerId=e}get ownerName(){return this._ownerName}set ownerName(e){this._ownerName=e}get respect(){return this._respect}set respect(e){this._respect=e}get age(){return this._age}set age(e){this._age=e}get unknownRarity(){return this._unknownRarity}set unknownRarity(e){this._unknownRarity=e}get saddle(){return this._saddle}set saddle(e){this._saddle=e}get rider(){return this._rider}set rider(e){this._rider=e}get skillTresholds(){return this._skillThresholds}set skillTresholds(e){this._skillThresholds=e}get publiclyRideable(){return this._publiclyRideable}set publiclyRideable(e){this._publiclyRideable=e}get breedable(){return this._breedable}set breedable(e){this._breedable=e}get fullyGrown(){return this._fullyGrown}set fullyGrown(e){this._fullyGrown=e}get dead(){return this._dead}set dead(e){this._dead=e}get rarityLevel(){return this._rarityLevel}set rarityLevel(e){this._rarityLevel=e}get maximumTimeToLive(){return this._maximumTimeToLive}set maximumTimeToLive(e){this._maximumTimeToLive=e}get remainingTimeToLive(){return this._remainingTimeToLive}set remainingTimeToLive(e){this._remainingTimeToLive=e}get remainingGrowTime(){return this._remainingGrowTime}set remainingGrowTime(e){this._remainingGrowTime=e}get publiclyBreedable(){return this._publiclyBreedable}set publiclyBreedable(e){this._publiclyBreedable=e}get adultLevel(){return this._adultLevel}}class Kb{constructor(e){this._roomIndex=-1,this._name="",this._type=0,this._sex="",this._figure="",this._custom="",this._webID=0,this._groupID=0,this._groupStatus=0,this._groupName="",this._ownerId=0,this._ownerName="",this._petLevel=0,this._rarityLevel=0,this._roomIndex=e}get roomIndex(){return this._roomIndex}get activityPoints(){return this._activityPoints}set activityPoints(e){this._activityPoints=e}get name(){return this._name}set name(e){this._name=e}get type(){return this._type}set type(e){this._type=e}get sex(){return this._sex}set sex(e){this._sex=e}get figure(){return this._figure}set figure(e){this._figure=e}get custom(){return this._custom}set custom(e){this._custom=e}get webID(){return this._webID}set webID(e){this._webID=e}get groupId(){return this._groupID}set groupId(e){this._groupID=e}get groupName(){return this._groupName}set groupName(e){this._groupName=e}get groupStatus(){return this._groupStatus}set groupStatus(e){this._groupStatus=e}get ownerId(){return this._ownerId}set ownerId(e){this._ownerId=e}get ownerName(){return this._ownerName}set ownerName(e){this._ownerName=e}get rarityLevel(){return this._rarityLevel}set rarityLevel(e){this._rarityLevel=e}get hasSaddle(){return this._hasSaddle}set hasSaddle(e){this._hasSaddle=e}get isRiding(){return this._isRiding}set isRiding(e){this._isRiding=e}get canBreed(){return this._canBreed}set canBreed(e){this._canBreed=e}get canHarvest(){return this._canHarvest}set canHarvest(e){this._canHarvest=e}get canRevive(){return this._canRevive}set canRevive(e){this._canRevive=e}get hasBreedingPermission(){return this._hasBreedingPermission}set hasBreedingPermission(e){this._hasBreedingPermission=e}get petLevel(){return this._petLevel}set petLevel(e){this._petLevel=e}get botSkills(){return this._botSkills}set botSkills(e){this._botSkills=e}get isModerator(){return this._isModerator}set isModerator(e){this._isModerator=e}}class vX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new jh(this.onRoomUnitEvent.bind(this))),e.addMessageEvent(new Wh(this.onRoomUnitInfoEvent.bind(this))),e.addMessageEvent(new Yh(this.onRoomUnitRemoveEvent.bind(this))),e.addMessageEvent(new Hh(this.onRoomUnitDanceEvent.bind(this))),e.addMessageEvent(new qm(this.onUserCurrentBadgesEvent.bind(this))),e.addMessageEvent(new Vm(this.onRoomDoorbellEvent.bind(this))),e.addMessageEvent(new xd(this.onUserNameChangeMessageEvent.bind(this))),e.addMessageEvent(new Fm(this.onNewFriendRequestEvent.bind(this))),e.addMessageEvent(new QA(this.onPetInfoEvent.bind(this))),e.addMessageEvent(new JA(this.onPetStatusUpdateEvent.bind(this))),e.addMessageEvent(new LW(this.onPetBreedingMessageEvent.bind(this))),e.addMessageEvent(new IA(this.onPetLevelUpdateMessageEvent.bind(this))),e.addMessageEvent(new tW(this.onConfirmBreedingResultEvent.bind(this))),e.addMessageEvent(new sW(this.onNestBreedingSuccessEvent.bind(this))),e.addMessageEvent(new eW(this.onConfirmBreedingRequestEvent.bind(this))),e.addMessageEvent(new Bh(this.onPetFigureUpdateEvent.bind(this))),e.addMessageEvent(new XA(this.onPetBreedingResultEvent.bind(this))),e.addMessageEvent(new gA(this.onPetPlacingError.bind(this))),e.addMessageEvent(new aA(this.onBotError.bind(this))),e.addMessageEvent(new FA(this.onFavoriteMembershipUpdateMessageEvent.bind(this)))}onRoomUnitEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser().users,r=[];if(s&&s.length)for(const i of s){if(!i)continue;const a=new Kb(i.roomIndex);a.name=i.name,a.custom=i.custom,a.activityPoints=i.activityPoints,a.figure=i.figure,a.type=i.userType,a.webID=i.webID,a.groupId=i.groupID,a.groupName=i.groupName,a.groupStatus=i.groupStatus,a.sex=i.sex,a.ownerId=i.ownerId,a.ownerName=i.ownerName,a.rarityLevel=i.rarityLevel,a.hasSaddle=i.hasSaddle,a.isRiding=i.isRiding,a.canBreed=i.canBreed,a.canHarvest=i.canHarvest,a.canRevive=i.canRevive,a.hasBreedingPermission=i.hasBreedingPermission,a.petLevel=i.petLevel,a.botSkills=i.botSkills,a.isModerator=i.isModerator,t.userDataManager.getUserData(i.roomIndex)||r.push(a),t.userDataManager.updateUserData(a)}this.listener.events.dispatchEvent(new XR(t,r))}onRoomUnitInfoEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();s&&(t.userDataManager.updateFigure(s.unitId,s.figure,s.gender,!1,!1),t.userDataManager.updateMotto(s.unitId,s.motto),t.userDataManager.updateAchievementScore(s.unitId,s.achievementScore),this.listener.events.dispatchEvent(new JR(t,s.unitId,s.figure,s.gender,s.motto,s.achievementScore)))}onRoomUnitRemoveEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);t&&t.userDataManager.removeUserData(e.getParser().unitId)}onRoomUnitDanceEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new IR(s,t.unitId,t.danceId))}onUserCurrentBadgesEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&(s.userDataManager.setUserBadges(t.userId,t.badges),this.listener.events.dispatchEvent(new YR(s,t.userId,t.badges)))}onRoomDoorbellEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=t.userName;if(!s||!s.length)return;const r=this.listener.getSession(this.roomId);r&&this.listener.events.dispatchEvent(new mi(mi.DOORBELL,r,s))}onUserNameChangeMessageEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&s.userDataManager.updateName(t.id,t.newName)}onNewFriendRequestEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;const r=t.request;this.listener.events.dispatchEvent(new s0(s,r.requestId,r.requesterUserId,r.requesterName))}onPetInfoEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;const r=new DX;r.id=t.id,r.level=t.level,r.maximumLevel=t.maximumLevel,r.experience=t.experience,r.levelExperienceGoal=t.levelExperienceGoal,r.energy=t.energy,r.maximumEnergy=t.maximumEnergy,r.happyness=t.happyness,r.maximumHappyness=t.maximumHappyness,r.ownerId=t.ownerId,r.ownerName=t.ownerName,r.respect=t.respect,r.age=t.age,r.unknownRarity=t.unknownRarity,r.saddle=t.saddle,r.rider=t.rider,r.breedable=t.breedable,r.fullyGrown=t.fullyGrown,r.rarityLevel=t.rarityLevel,r.dead=t.dead,r.skillTresholds=t.skillTresholds,r.publiclyRideable=t.publiclyRideable,r.maximumTimeToLive=t.maximumTimeToLive,r.remainingTimeToLive=t.remainingTimeToLive,r.remainingGrowTime=t.remainingGrowTime,r.publiclyBreedable=t.publiclyBreedable,this.listener.events.dispatchEvent(new xR(s,r))}onPetStatusUpdateEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&(s.userDataManager.updatePetBreedingStatus(t.roomIndex,t.canBreed,t.canHarvest,t.canRevive,t.hasBreedingPermission),this.listener.events.dispatchEvent(new VR(s,t.petId,t.canBreed,t.canHarvest,t.canRevive,t.hasBreedingPermission)))}onPetBreedingMessageEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new i0(s,t.state,t.ownPetId,t.otherPetId))}onPetLevelUpdateMessageEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&(s.userDataManager.updatePetLevel(t.roomIndex,t.level),this.listener.events.dispatchEvent(new l0(s,t.petId,t.level)))}onConfirmBreedingResultEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new e0(s,t.breedingNestStuffId,t.result))}onNestBreedingSuccessEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new r0(s,t.petId,t.rarityCategory))}onConfirmBreedingRequestEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new $U(s,t.nestId,t.pet1,t.pet2,t.rarityCategories,t.resultPetType))}onPetFigureUpdateEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;const r=t.figureData.figuredata;s.userDataManager.updateFigure(t.roomIndex,r,"",t.hasSaddle,t.isRiding),this.listener.events.dispatchEvent(new o0(s,t.petId,r))}onPetBreedingResultEvent(e){if(!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);s&&this.listener.events.dispatchEvent(new n0(s,t.resultData,t.otherResultData))}onPetPlacingError(e){if(!e||!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;let r=null;switch(t.errorCode){case 0:r=Be.RSEME_PETS_FORBIDDEN_IN_HOTEL;break;case 1:r=Be.RSEME_PETS_FORBIDDEN_IN_FLAT;break;case 2:r=Be.RSEME_MAX_PETS;break;case 3:r=Be.RSEME_NO_FREE_TILES_FOR_PET;break;case 4:r=Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET;break;case 5:r=Be.RSEME_MAX_NUMBER_OF_OWN_PETS;break}!r||r.length==0||this.listener.events.dispatchEvent(new Be(r,s))}onBotError(e){if(!e||!this.listener)return;const t=e.getParser();if(!t)return;const s=this.listener.getSession(this.roomId);if(!s)return;let r=null;switch(t.errorCode){case 0:r=Be.RSEME_BOTS_FORBIDDEN_IN_HOTEL;break;case 1:r=Be.RSEME_BOTS_FORBIDDEN_IN_FLAT;break;case 2:r=Be.RSEME_BOT_LIMIT_REACHED;break;case 3:r=Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT;break;case 4:r=Be.RSEME_BOT_NAME_NOT_ACCEPTED;break}!r||r.length==0||this.listener.events.dispatchEvent(new Be(r,s))}onFavoriteMembershipUpdateMessageEvent(e){if(!this.listener)return;const t=e.getParser(),s=this.listener.getSession(this.roomId);if(!s)return;const r=s.userDataManager.getUserDataByIndex(t.roomIndex);r&&(r.groupId=t.groupId,r.groupName=t.groupName,this.listener.events.dispatchEvent(new OR(s,t.roomIndex,t.groupId,t.status,t.groupName)))}}class bX extends Qi{constructor(e,t){super(e,t),e.addMessageEvent(new NA(this.onQuestionEvent.bind(this))),e.addMessageEvent(new AA(this.onQuestionAnsweredEvent.bind(this))),e.addMessageEvent(new yA(this.onQuestionFinishedEvent.bind(this)))}onQuestionEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new hi(hi.QUESTION,t,s.pollId);r.question=s.question,r.duration=s.duration,r.pollType=s.pollType,r.questionId=s.questionId,r.pollId=s.pollId,this.listener.events.dispatchEvent(r)}onQuestionAnsweredEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new hi(hi.ANSWERED,t,s.userId);r.value=s.value,r.userId=s.userId,r.answerCounts=s.answerCounts,this.listener.events.dispatchEvent(r)}onQuestionFinishedEvent(e){if(!this.listener)return;const t=this.listener.getSession(this.roomId);if(!t)return;const s=e.getParser();if(!s)return;const r=new hi(hi.FINISHED,t);r.questionId=s.questionId,r.answerCounts=s.answerCounts,this.listener.events.dispatchEvent(r)}}class PX{constructor(e){this._sessionDataManager=e,this._ignoredUsers=[]}init(){if(this._sessionDataManager&&this._sessionDataManager.communication){this._messages=[new MN(this.onIgnoredUsersEvent.bind(this)),new Jm(this.onIgnoreResultEvent.bind(this))];for(const e of this._messages)this._sessionDataManager.communication.registerMessageEvent(e)}}dispose(){if(!this.disposed){if(this._messages&&this._messages.length){for(const e of this._messages)this._sessionDataManager.communication.removeMessageEvent(e);this._messages=null}this._sessionDataManager=null}}requestIgnoredUsers(){this._sessionDataManager.send(new Ov(this._sessionDataManager.userName))}onIgnoredUsersEvent(e){if(!e)return;const t=e.getParser();t&&(this._ignoredUsers=t.ignoredUsers)}onIgnoreResultEvent(e){if(!e)return;const t=e.getParser();if(!t)return;const s=t.name;switch(t.result){case 0:return;case 1:this.addUserToIgnoreList(s);return;case 2:this.addUserToIgnoreList(s),this._ignoredUsers.shift();return;case 3:this.removeUserFromIgnoreList(s);return}}addUserToIgnoreList(e){this._ignoredUsers.indexOf(e)<0&&this._ignoredUsers.push(e)}removeUserFromIgnoreList(e){const t=this._ignoredUsers.indexOf(e);t>=0&&this._ignoredUsers.splice(t,1)}ignoreUserId(e){this._sessionDataManager.send(new Av(e))}ignoreUser(e){this._sessionDataManager.send(new Cv(e))}unignoreUser(e){this._sessionDataManager.send(new Nv(e))}isIgnored(e){return this._ignoredUsers.indexOf(e)>=0}get disposed(){return!!this._sessionDataManager}}class LX{constructor(e,t,s){this._type=e,this._name=t,this._description=s}get type(){return this._type}get name(){return this._name}get description(){return this._description}}const kE=class bf extends jr{constructor(e){super(),this._products=e}dispose(){this._products=null}loadProductData(e){e&&fetch(e).then(t=>t.json()).then(t=>this.onProductDataLoadedEvent(t)).catch(t=>this.onProductDataError(t))}onProductDataLoadedEvent(e){e&&(this.parseProducts(e.productdata),this.dispatchEvent(new He(bf.PDP_PRODUCT_DATA_READY)))}onProductDataError(e){e&&this.dispatchEvent(new He(bf.PDP_PRODUCT_DATA_FAILED))}parseProducts(e){if(e)for(const t of e.product)t&&this._products.set(t.code,new LX(t.code,t.name,t.description))}};kE.PDP_PRODUCT_DATA_READY="PDP_PRODUCT_DATA_READY";kE.PDP_PRODUCT_DATA_FAILED="PDP_PRODUCT_DATA_FAILED";let F_=kE;const Iu=class Nc extends Hr{constructor(){super(),this._connection=null,this._userDataByType=new Map,this._userDataByRoomIndex=new Map,this._userBadges=new Map}onDispose(){this._connection=null}setConnection(e){this._connection=e}getUserData(e){return this.getDataByType(e,Nc.TYPE_USER)}getPetData(e){return this.getDataByType(e,Nc.TYPE_PET)}getBotData(e){return this.getDataByType(e,Nc.TYPE_BOT)}getRentableBotData(e){return this.getDataByType(e,Nc.TYPE_RENTABLE_BOT)}getDataByType(e,t){const s=this._userDataByType.get(t);if(!s)return null;const r=s.get(e);return r||null}getUserDataByIndex(e){const t=this._userDataByRoomIndex.get(e);return t||null}getUserDataByName(e){for(const t of this._userDataByRoomIndex.values())if(!(!t||t.name!==e))return t;return null}updateUserData(e){if(!e)return;this.removeUserData(e.roomIndex);let t=this._userDataByType.get(e.type);t||(t=new Map,this._userDataByType.set(e.type,t)),t.set(e.webID,e),this._userDataByRoomIndex.set(e.roomIndex,e)}removeUserData(e){const t=this.getUserDataByIndex(e);if(!t)return;this._userDataByRoomIndex.delete(e);const s=this._userDataByType.get(t.type);s&&s.delete(t.webID)}getUserBadges(e){this._connection&&this._connection.send(new fE(e));const t=this._userBadges.get(e);return t||[]}setUserBadges(e,t){this._userBadges.set(e,t)}updateFigure(e,t,s,r,i){const a=this.getUserDataByIndex(e);a&&(a.figure=t,a.sex=s,a.hasSaddle=r,a.isRiding=i)}updateName(e,t){const s=this.getUserDataByIndex(e);s&&(s.name=t)}updateMotto(e,t){const s=this.getUserDataByIndex(e);s&&(s.custom=t)}updateAchievementScore(e,t){const s=this.getUserDataByIndex(e);s&&(s.activityPoints=t)}updatePetLevel(e,t){const s=this.getUserDataByIndex(e);s&&(s.petLevel=t)}updatePetBreedingStatus(e,t,s,r,i){const a=this.getUserDataByIndex(e);a&&(a.canBreed=t,a.canHarvest=s,a.canRevive=r,a.hasBreedingPermission=i)}requestPetInfo(e){!this._connection||!this.getPetData(e)||this._connection.send(new KM(e))}get connection(){return this._connection}};Iu.TYPE_USER=1;Iu.TYPE_PET=2;Iu.TYPE_BOT=3;Iu.TYPE_RENTABLE_BOT=4;let UX=Iu;class FX extends Hr{constructor(){super(),this._connection=null,this._userData=new UX,this._roomId=0,this._password=null,this._state=Ne.CREATED,this._tradeMode=oh.NO_TRADING,this._doorMode=0,this._controllerLevel=ct.NONE,this._ownRoomIndex=-1,this._isGuildRoom=!1,this._isRoomOwner=!1,this._isDecorating=!1,this._isSpectator=!1,this._moderationSettings=null}onDispose(){this._userData&&(this._userData.dispose(),this._userData=null),this._connection=null}setConnection(e){this._connection||!e||(this._connection=e,this._userData&&this._userData.setConnection(e))}setControllerLevel(e){if(e>=ct.NONE&&e<=ct.MODERATOR){this._controllerLevel=e;return}this._controllerLevel=ct.NONE}setOwnRoomIndex(e){this._ownRoomIndex=e}setRoomOwner(){this._isRoomOwner=!0}start(){return this._state!==Ne.CREATED||!this._connection?!1:(this._state=Ne.STARTED,this.enterRoom())}enterRoom(){return this._connection?(this._connection.send(new sD(this._roomId,this._password)),!0):!1}reset(e){e!==this._roomId&&(this._roomId=e)}sendChatMessage(e,t){this._connection.send(new dE(e,t))}sendShoutMessage(e,t){this._connection.send(new JD(e,t))}sendWhisperMessage(e,t,s){this._connection.send(new $D(e,t,s))}sendChatTypingMessage(e){e?this._connection.send(new ev):this._connection.send(new tv)}sendMottoMessage(e){this._connection.send(new yv(e))}sendDanceMessage(e){this._connection.send(new rv(e))}sendExpressionMessage(e){this._connection.send(new sv(e))}sendSignMessage(e){e<0||e>17||this._connection.send(new lv(e))}sendPostureMessage(e){this._connection.send(new ov(e))}sendDoorbellApprovalMessage(e,t){this._connection.send(new tD(e,t))}sendAmbassadorAlertMessage(e){this._connection.send(new iD(e))}sendKickMessage(e){this._connection.send(new lD(e))}sendMuteMessage(e,t){this._connection.send(new cD(e,t,this._roomId))}sendBanMessage(e,t){this._connection.send(new nD(e,this._roomId,t))}sendGiveRightsMessage(e){this._connection.send(new oD(e))}sendTakeRightsMessage(e){this._connection.send(new nE(e))}sendPollStartMessage(e){this._connection.send(new $M(e))}sendPollRejectMessage(e){this._connection.send(new ZM(e))}sendPollAnswerMessage(e,t,s){this._connection.send(new JM(e,t,s))}sendPeerUsersClassificationMessage(e){this._connection.send(new wv(e))}sendOpenPetPackageMessage(e,t){this._connection.send(new uE(e,t))}sendRoomUsersClassificationMessage(e){this._connection.send(new Gv(e))}updateMoodlightData(e,t,s,r,i){let a="000000"+s.toString(16).toUpperCase();a="#"+a.substring(a.length-6),this.connection.send(new ND(e,t,a,r,i))}toggleMoodlightState(){this.connection.send(new yD)}pickupPet(e){this._connection&&this._connection.send(new TD(e))}pickupBot(e){this._connection&&this._connection.send(new Bd(e))}requestMoodlightSettings(){this._connection&&this._connection.send(new AD)}openGift(e){this._connection.send(new HD(e))}mountPet(e){this._connection.send(new mf(e,!0))}dismountPet(e){this._connection.send(new mf(e,!1))}usePetProduct(e,t){this._connection.send(new QM(e,t))}removePetSaddle(e){this._connection.send(new zM(e))}togglePetBreeding(e){this._connection.send(new XM(e))}togglePetRiding(e){this._connection.send(new qM(e))}useMultistateItem(e){this._connection.send(new Ml(e))}harvestPet(e){this._connection.send(new pD(e))}compostPlant(e){this._connection.send(new mD(e))}requestPetCommands(e){this._connection.send(new YM(e))}sendScriptProceed(){this._connection.send(new WM)}sendUpdateClothingChangeFurniture(e,t,s){this._connection.send(new OD(e,t,s))}changeQueue(e){this._connection.send(new qD(e))}votePoll(e){this._connection.send(new eD(e))}get connection(){return this._connection}get userDataManager(){return this._userData}get roomId(){return this._roomId}set roomId(e){this._roomId=e}get password(){return this._password}set password(e){this._password=e}get state(){return this._state}get isPrivateRoom(){return!0}get tradeMode(){return this._tradeMode}set tradeMode(e){this._tradeMode=e}get doorMode(){return this._doorMode}set doorMode(e){this._doorMode=e}get allowPets(){return this._allowPets}set allowPets(e){this._allowPets=e}get controllerLevel(){return this._controllerLevel}get ownRoomIndex(){return this._ownRoomIndex}get isGuildRoom(){return this._isGuildRoom}set isGuildRoom(e){this._isGuildRoom=e}get isRoomOwner(){return this._isRoomOwner}get isDecorating(){return this._isDecorating}set isDecorating(e){this._isDecorating=e}get isSpectator(){return this._isSpectator}set isSpectator(e){this._isSpectator=e}get moderationSettings(){return this._moderationSettings}set moderationSettings(e){this._moderationSettings=e}}class xX extends En{constructor(e,t){super(),this._communication=e,this._roomEngine=t,this._handlers=[],this._sessions=new Map,this._pendingSession=null,this._sessionStarting=!1,this._viewerSession=null,this.onRoomEngineEvent=this.onRoomEngineEvent.bind(this)}onInit(){this.createHandlers(),this.processPendingSession(),this._roomEngine.events.addEventListener(je.ENGINE_INITIALIZED,this.onRoomEngineEvent)}onDispose(){this._roomEngine.events.removeEventListener(je.ENGINE_INITIALIZED,this.onRoomEngineEvent),super.onDispose()}createHandlers(){const e=this._communication&&this._communication.connection;e&&this._handlers.push(new CX(e,this),new AX(e,this),new NX(e,this),new yX(e,this),new Fu(e,this),new vX(e,this),new MX(e,this),new RX(e,this),new bX(e,this),new SX(e,this),new OX(e,this))}setHandlers(e){if(!(!this._handlers||!this._handlers.length))for(const t of this._handlers)t&&t.setRoomId(e.roomId)}onRoomEngineEvent(e){this.processPendingSession()}processPendingSession(){!this._pendingSession||!this._roomEngine.ready||(this.addSession(this._pendingSession),this._pendingSession=null)}getSession(e){const t=this._sessions.get(this.getRoomId(e));return t||null}createSession(e,t=null){const s=new FX;return s.roomId=e,s.password=t,this.addSession(s)}addSession(e){return this._roomEngine.ready?(this._sessionStarting=!0,this._sessions.get(this.getRoomId(e.roomId))&&this.removeSession(e.roomId,!1),e.setConnection(this._communication.connection),this._sessions.set(this.getRoomId(e.roomId),e),this.events.dispatchEvent(new Ne(Ne.CREATED,e)),this._viewerSession=e,this.startSession(this._viewerSession),!0):(this._pendingSession=e,!1)}startSession(e){return e.state===Ne.STARTED?!1:(this._sessionStarting=!1,e.start()?(this.events.dispatchEvent(new Ne(Ne.STARTED,e)),this.setHandlers(e),!0):(this.removeSession(e.roomId),!1))}removeSession(e,t=!0){const s=this.getSession(e);s&&(this._sessions.delete(this.getRoomId(e)),this.events.dispatchEvent(new Ne(Ne.ENDED,s,t)),s.dispose())}sessionUpdate(e,t){if(this.getSession(e))switch(t){case Fu.RS_CONNECTED:return;case Fu.RS_READY:return;case Fu.RS_DISCONNECTED:this.removeSession(e);return}}sessionReinitialize(e,t){const s=this.getSession(e);s&&(this._sessions.delete(this.getRoomId(e)),s.reset(t),this._sessions.set(this.getRoomId(t),s),this.setHandlers(s))}getRoomId(e){return"hard_coded_room_id"}get communication(){return this._communication}get roomEngine(){return this._roomEngine}get viewerSession(){return this._viewerSession}}const t_=class Xb{static logEventLog(e){try{Je.available&&Je.call("logEventLog",e)}catch{me.log("External interface not working, failed to log event log.")}}static openPage(e){try{Je.available&&Je.call("openPage",e)}catch{me.log("Failed to open web page",e)}}static openWebPage(e){window.open(e)}static sendHeartBeat(){try{Je.available&&Je.call("heartBeat")}catch{me.log("Failed to send heartbeat")}}static openWebPageAndMinimizeClient(e){try{Je.available&&Xb.openPage(e)}catch{me.log("Failed to open web page",e)}}static closeWebPageAndRestoreClient(){try{Je.available&&Je.call("closeWebPageAndRestoreClient")}catch{me.log("Failed to close web page and restore client!")}}static openHabblet(e,t=null){try{Je.available&&Je.call("openHabblet",e,t)}catch{me.log("Failed to open Habblet",e)}}static closeHabblet(e,t=null){try{Je.available&&Je.call("closeHabblet",e,t)}catch{me.log("Failed to close Habblet",e)}}static send(e,t){try{Je.available&&Je.call("disconnect",e,t)}catch{me.log("Failed to close send ")}}static showGame(e){try{Je.available&&Je.callGame("showGame",e)}catch(t){me.log("Failed to open game",t)}}static hideGame(){try{Je.available&&Je.callGame("hideGame")}catch{me.log("Failed to hide game")}}static open(e){try{Je.available&&Je.call("openExternalLink",escape(e))}catch{me.log("External interface not working. Could not request to open: "+e)}}static roomVisited(e){try{Je.available&&Je.call("roomVisited",e)}catch{me.log("External interface not working. Could not store last room visit.")}}static openMinimail(e){try{Je.available&&Je.call("openMinimail",e)}catch{me.log("External interface not working. Could not open minimail.")}}static openNews(){try{Je.available&&Je.call("openNews")}catch{me.log("External interface not working. Could not open news.")}}static closeNews(){try{Je.available&&Je.call("closeNews")}catch{me.log("External interface not working. Could not close news.")}}static openAvatars(){try{Je.available&&Je.call("openAvatars")}catch{me.log("External interface not working. Could not open avatars.")}}static openRoomEnterAd(){try{Je.available&&Je.call("openRoomEnterAd")}catch{me.log("External interface not working. Could not open roomenterad.")}}static updateFigure(e){try{Je.available&&Je.call("updateFigure",e)}catch{me.log("External interface not working. Could not update figure.")}}};t_.ADVERTISEMENT="advertisement";t_.OPENLINK="openlink";t_.OPENROOM="openroom";let ra=t_;class wX extends En{constructor(e){super(),this._communication=e,this.resetUserInfo(),this._ignoredUsersManager=new PX(this),this._groupInformationManager=new TX(this),this._clubLevel=0,this._securityLevel=0,this._isAmbassador=!1,this._noobnessLevel=-1,this._isEmailVerified=!1,this._systemOpen=!1,this._systemShutdown=!1,this._isAuthenticHabbo=!1,this._isRoomCameraFollowDisabled=!1,this._uiFlags=0,this._floorItems=new Map,this._wallItems=new Map,this._products=new Map,this._furnitureData=null,this._furnitureReady=!1,this._productsReady=!1,this._furnitureListenersNotified=!1,this._pendingFurnitureListeners=[],this._pendingProductListeners=[],this._tags=[],this._badgeImageManager=null,this.onFurnitureDataReadyEvent=this.onFurnitureDataReadyEvent.bind(this),this.onProductDataReadyEvent=this.onProductDataReadyEvent.bind(this),this.onNitroSettingsEvent=this.onNitroSettingsEvent.bind(this)}onInit(){this.loadFurnitureData(),this.loadProductData(),this.loadBadgeImageManager(),this._ignoredUsersManager&&this._ignoredUsersManager.init(),this._groupInformationManager&&this._groupInformationManager.init(),this._communication.registerMessageEvent(new Pm(this.onUserFigureEvent.bind(this))),this._communication.registerMessageEvent(new Nl(this.onUserInfoEvent.bind(this))),this._communication.registerMessageEvent(new Km(this.onUserPermissionsEvent.bind(this))),this._communication.registerMessageEvent(new jO(this.onAvailabilityStatusMessageEvent.bind(this))),this._communication.registerMessageEvent(new TA(this.onPetRespectFailed.bind(this))),this._communication.registerMessageEvent(new ji(this.onChangeNameUpdateEvent.bind(this))),this._communication.registerMessageEvent(new xd(this.onUserNameChangeMessageEvent.bind(this))),this._communication.registerMessageEvent(new SN(this.onUserTags.bind(this))),this._communication.registerMessageEvent(new Al(this.onRoomModelNameEvent.bind(this))),this._communication.registerMessageEvent(new DN(this.onInClientLinkEvent.bind(this))),this._communication.registerMessageEvent(new zC(this.onMysteryBoxKeysEvent.bind(this))),this._communication.registerMessageEvent(new WS(this.onNoobnessLevelMessageEvent.bind(this))),this._communication.registerMessageEvent(new TN(this.onAccountSafetyLockStatusChangeMessageEvent.bind(this))),this._communication.registerMessageEvent(new CN(this.onEmailStatus.bind(this))),pe.instance.events.addEventListener(fl.SETTINGS_UPDATED,this.onNitroSettingsEvent)}onDispose(){this.destroyFurnitureData(),this._ignoredUsersManager&&(this._ignoredUsersManager.dispose(),this._ignoredUsersManager=null),this._groupInformationManager&&(this._groupInformationManager.dispose(),this._groupInformationManager=null),pe.instance.events.removeEventListener(fl.SETTINGS_UPDATED,this.onNitroSettingsEvent),super.onDispose()}resetUserInfo(){this._userId=0,this._name=null,this._figure=null,this._gender=null,this._realName=null,this._canChangeName=!1,this._safetyLocked=!1}loadFurnitureData(){this.destroyFurnitureData(),this._furnitureData=new U_(this._floorItems,this._wallItems,pe.instance.localization),this._furnitureData.addEventListener(U_.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent),this._furnitureData.loadFurnitureData(Ue.getValue("furnidata.url"))}loadProductData(){this.destroyProductData(),this._productData=new F_(this._products),this._productData.addEventListener(F_.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent),this._productData.loadProductData(Ue.getValue("productdata.url"))}loadBadgeImageManager(){this._badgeImageManager||(this._badgeImageManager=new Uu(Fr(),this),this._badgeImageManager.init())}hasProductData(e){return this._productsReady?!0:(e&&this._pendingProductListeners.indexOf(e)===-1&&this._pendingProductListeners.push(e),!1)}getAllFurnitureData(e){if(!this._furnitureReady)return this._pendingFurnitureListeners.indexOf(e)===-1&&this._pendingFurnitureListeners.push(e),null;const t=[];for(const s of this._floorItems.values())s&&t.push(s);for(const s of this._wallItems.values())s&&t.push(s);return t}removePendingFurniDataListener(e){if(!this._pendingFurnitureListeners)return;const t=this._pendingFurnitureListeners.indexOf(e);t!==-1&&this._pendingFurnitureListeners.splice(t,1)}onUserFigureEvent(e){!e||!e.connection||(this._figure=e.getParser().figure,this._gender=e.getParser().gender,ra.updateFigure(this._figure))}onUserInfoEvent(e){if(!e||!e.connection)return;this.resetUserInfo();const t=e.getParser().userInfo;t&&(this._userId=t.userId,this._name=t.username,this._figure=t.figure,this._gender=t.gender,this._realName=t.realName,this._respectsReceived=t.respectsReceived,this._respectsLeft=t.respectsRemaining,this._respectsPetLeft=t.respectsPetRemaining,this._canChangeName=t.canChangeName,this._safetyLocked=t.safetyLocked,this._ignoredUsersManager&&this._ignoredUsersManager.requestIgnoredUsers())}onUserPermissionsEvent(e){!e||!e.connection||(this._clubLevel=e.getParser().clubLevel,this._securityLevel=e.getParser().securityLevel,this._isAmbassador=e.getParser().isAmbassador)}onAvailabilityStatusMessageEvent(e){if(!e||!e.connection)return;const t=e.getParser();t&&(this._systemOpen=t.isOpen,this._systemShutdown=t.onShutdown,this._isAuthenticHabbo=t.isAuthenticUser)}onPetRespectFailed(e){!e||!e.connection||this._respectsPetLeft++}onChangeNameUpdateEvent(e){if(!e||!e.connection)return;const t=e.getParser();t&&t.resultCode===ji.NAME_OK&&(this._canChangeName=!1,this.events.dispatchEvent(new Sp(t.name)))}onUserNameChangeMessageEvent(e){if(!e||!e.connection)return;const t=e.getParser();t&&t.webId===this.userId&&(this._name=t.newName,this._canChangeName=!1,this.events.dispatchEvent(new Sp(this._name)))}onUserTags(e){if(!e||!e.connection)return;const t=e.getParser();t&&(this._tags=t.tags)}onRoomModelNameEvent(e){if(!e)return;const t=e.getParser();t&&ra.roomVisited(t.roomId)}onFurnitureDataReadyEvent(e){if(this._furnitureData.removeEventListener(U_.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent),this._furnitureReady=!0,!this._furnitureListenersNotified&&(this._furnitureListenersNotified=!0,this._pendingFurnitureListeners&&this._pendingFurnitureListeners.length))for(const t of this._pendingFurnitureListeners)t&&t.loadFurnitureData();this._pendingProductListeners=[]}onProductDataReadyEvent(e){this._productData.removeEventListener(F_.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent),this._productsReady=!0;for(const t of this._pendingProductListeners)t&&t.loadProductData();this._pendingProductListeners=[]}onInClientLinkEvent(e){if(!e)return;const t=e.getParser();t&&pe.instance.createLinkEvent(t.link)}onMysteryBoxKeysEvent(e){if(!e)return;const t=e.getParser();t&&this.events.dispatchEvent(new hR(t.boxColor,t.keyColor))}onNoobnessLevelMessageEvent(e){this._noobnessLevel=e.getParser().noobnessLevel,this._noobnessLevel!==gl.OLD_IDENTITY&&Ue.setValue("new.identity",1)}onAccountSafetyLockStatusChangeMessageEvent(e){if(!e)return;const t=e.getParser();t&&(this._safetyLocked=t.status==Ad.SAFETY_LOCK_STATUS_LOCKED)}onEmailStatus(e){if(!e)return;const t=e.getParser();t&&(this._isEmailVerified=t.isVerified)}onNitroSettingsEvent(e){this._isRoomCameraFollowDisabled=e.cameraFollow,this._uiFlags=e.flags,this.events.dispatchEvent(new u0(this._uiFlags))}destroyFurnitureData(){this._furnitureData&&(this._furnitureData.dispose(),this._furnitureData=null)}destroyProductData(){this._productData&&(this._productData.dispose(),this._productData=null)}getFloorItemData(e){const t=this._floorItems.get(e);return t||null}getFloorItemDataByName(e){if(!e||!this._floorItems||!this._floorItems.size)return null;for(const t of this._floorItems.values())if(!(!t||t.className!==e))return t}getWallItemData(e){const t=this._wallItems.get(e);return t||null}getWallItemDataByName(e){if(!e||!this._wallItems||!this._wallItems.size)return null;for(const t of this._wallItems.values())if(!(!t||t.className!==e))return t}getProductData(e){return this._productsReady||this.loadProductData(),this._products.get(e)}getBadgeUrl(e){return this._badgeImageManager.getBadgeUrl(e)}getGroupBadgeUrl(e){return this._badgeImageManager.getBadgeUrl(e,Uu.GROUP_BADGE)}getBadgeImage(e){return this._badgeImageManager.getBadgeImage(e)}getGroupBadgeImage(e){return this._badgeImageManager.getBadgeImage(e,Uu.GROUP_BADGE)}getUserTags(e){e<0||this.send(new Sv(e))}loadBadgeImage(e){return this._badgeImageManager.loadBadgeImage(e)}loadGroupBadgeImage(e){return this._badgeImageManager.loadBadgeImage(e,Uu.GROUP_BADGE)}hasSecurity(e){return this._securityLevel>=e}giveRespect(e){e<0||this._respectsLeft<=0||(this.send(new xv(e)),this._respectsLeft--)}givePetRespect(e){e<0||this._respectsPetLeft<=0||(this.send(new lu(e)),this._respectsPetLeft--)}sendSpecialCommandMessage(e,t=0){this.send(new dE(e))}ignoreUser(e){this._ignoredUsersManager&&this._ignoredUsersManager.ignoreUser(e)}unignoreUser(e){this._ignoredUsersManager&&this._ignoredUsersManager.unignoreUser(e)}isUserIgnored(e){return this._ignoredUsersManager&&this._ignoredUsersManager.isIgnored(e)}getGroupBadge(e){return this._groupInformationManager&&this._groupInformationManager.getGroupBadge(e)}send(e){this._communication.connection.send(e)}get communication(){return this._communication}get userId(){return this._userId}get userName(){return this._name}get figure(){return this._figure}get gender(){return this._gender}get realName(){return this._realName}get ignoredUsersManager(){return this._ignoredUsersManager}get groupInformationManager(){return this._groupInformationManager}get respectsReceived(){return this._respectsReceived}get respectsLeft(){return this._respectsLeft}get respectsPetLeft(){return this._respectsPetLeft}get canChangeName(){return this._canChangeName}get clubLevel(){return this._clubLevel}get securityLevel(){return this._securityLevel}get isAmbassador(){return this._isAmbassador}get isEmailVerified(){return this._isEmailVerified}get isNoob(){return this._noobnessLevel!==gl.OLD_IDENTITY}get isRealNoob(){return this._noobnessLevel===gl.REAL_NOOB}get isSystemOpen(){return this._systemOpen}get isSystemShutdown(){return this._systemShutdown}get isAuthenticHabbo(){return this._isAuthenticHabbo}get isModerator(){return this._securityLevel>=Cr.MODERATOR}get isCameraFollowDisabled(){return this._isRoomCameraFollowDisabled}get uiFlags(){return this._uiFlags}get tags(){return this._tags}}class qb extends Ud{constructor(e,t,s,r,i=""){super(e,t,s,r),this._jukeboxDiskId=-1,this._songData=i}get id(){return this._id}get length(){return this._length}get name(){return this._name}get creator(){return this._creator}get songData(){return this._songData}set songData(e){this._songData=e}get diskId(){return this._jukeboxDiskId}set diskId(e){this._jukeboxDiskId=e}}class GX{constructor(e,t,s,r,i){this._songId=e,this._startPos=t,this._playLength=s,this._fadeInSeconds=r,this._fadeOutSeconds=i,this._playRequestTime=Date.now()}get songId(){return this._songId}get startPos(){return this._startPos<0?0:this._startPos+(Date.now()-this._playRequestTime)/1e3}get playLength(){return this._playLength}get playRequestTime(){return this._playRequestTime}get fadeInSeconds(){return this._fadeInSeconds}get fadeOutSeconds(){return this._fadeOutSeconds}}const Qb=class Jb extends He{constructor(e,t){super(Jb.NOTIFY_PLAYED_SONG),this._name=e,this._creator=t}get name(){return this._name}get creator(){return this._creator}};Qb.NOTIFY_PLAYED_SONG="UIEW_NOTIFY_PLAYED_SONG";let Zb=Qb;class Bi extends He{constructor(e,t,s,r){super(e),this._id=s,this._position=r,this._priority=t}get id(){return this._id}get position(){return this._position}get priority(){return this._priority}}Bi.NPE_USER_PLAY_SONG="NPE_USER_PLAY_SONG";Bi.NPW_USER_STOP_SONG="NPW_USER_STOP_SONG";Bi.NPE_SONG_CHANGED="NPE_SONG_CHANGED";class ln extends He{constructor(e){super(e)}}ln.PLUE_PLAY_LIST_UPDATED="PLUE_PLAY_LIST_UPDATED";ln.PLUE_PLAY_LIST_FULL="PLUE_PLAY_LIST_FULL";class hl extends He{constructor(e){super(e)}}hl.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT="SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT";class Pl extends He{constructor(e,t){super(e),this._id=t}get id(){return this._id}}Pl.SIR_TRAX_SONG_INFO_RECEIVED="SIR_TRAX_SONG_INFO_RECEIVED";class jc extends He{constructor(e,t){super(e),this._id=t}get id(){return this._id}}jc.TRAX_SONG_COMPLETE="SME_TRAX_SONG_COMPLETE";class Is{}Is.PRIORITY_ROOM_PLAYLIST=0;Is.PRIORITY_USER_PLAYLIST=1;Is.PRIORITY_SONG_PLAY=2;Is.PRIORITY_PURCHASE_PREVIEW=3;Is.PRIORITY_COUNT=4;class BX{constructor(){this._isPlaying=!1,this._disposed=!1,this._entries=[],this._missingSongInfo=[],this._messageEvents=[new mN(this.onNowPlayingMessageEvent.bind(this)),new fN(this.onJukeboxSongDisksMessageEvent.bind(this)),new gN(this.onJukeboxPlayListFullMessageEvent.bind(this))],this.onSongInfoReceivedEvent=this.onSongInfoReceivedEvent.bind(this)}init(){this._messageEvents.forEach(e=>pe.instance.communication.connection.addMessageEvent(e)),pe.instance.soundManager.events.addEventListener(Pl.SIR_TRAX_SONG_INFO_RECEIVED,this.onSongInfoReceivedEvent)}get priority(){return Is.PRIORITY_ROOM_PLAYLIST}onNowPlayingMessageEvent(e){const t=e.getParser();this._isPlaying=t.currentSongId!==-1,t.currentSongId>=0?(pe.instance.soundManager.musicController.playSong(t.currentSongId,Is.PRIORITY_ROOM_PLAYLIST,t.syncCount/1e3,0,1,1),this._currentEntryId=t.currentSongId):this.stopPlaying(),t.nextSongId>=0&&pe.instance.soundManager.musicController.addSongInfoRequest(t.nextSongId),this._playPosition=t.currentPosition,pe.instance.soundManager.events.dispatchEvent(new Bi(Bi.NPE_SONG_CHANGED,Is.PRIORITY_ROOM_PLAYLIST,t.currentSongId,t.currentPosition))}onJukeboxSongDisksMessageEvent(e){const t=e.getParser();this._entries=[];for(let s=0;s<t.songDisks.length;s++){const r=t.songDisks.getWithIndex(s),i=t.songDisks.getKey(s);let a=pe.instance.soundManager.musicController.getSongInfo(r);a==null&&(a=new qb(r,-1,null,null,null),this._missingSongInfo.indexOf(r)<0&&(this._missingSongInfo.push(r),pe.instance.soundManager.musicController.requestSongInfoWithoutSamples(r))),a.diskId=i,this._entries.push(a)}this._missingSongInfo.length==0&&pe.instance.soundManager.events.dispatchEvent(new ln(ln.PLUE_PLAY_LIST_UPDATED))}onJukeboxPlayListFullMessageEvent(e){pe.instance.soundManager.events.dispatchEvent(new ln(ln.PLUE_PLAY_LIST_FULL))}onSongInfoReceivedEvent(e){for(let s=0;s<this.length;s++){const r=this._entries[s];if(r.id===e.id){const i=r.diskId,a=pe.instance.soundManager.musicController.getSongInfo(e.id);a!=null&&(a.diskId=i,this._entries[s]=a);break}}const t=this._missingSongInfo.indexOf(e.id);t>=0&&this._missingSongInfo.splice(t,1),this._missingSongInfo.length==0&&pe.instance.soundManager.events.dispatchEvent(new ln(ln.PLUE_PLAY_LIST_UPDATED))}stopPlaying(){pe.instance.soundManager.musicController.stop(this.priority),this._currentEntryId=-1,this._playPosition=-1,this._isPlaying=!1}get length(){return this._entries?this._entries.length:0}get playPosition(){return this._playPosition}get nowPlayingSongId(){return this._currentEntryId}get isPlaying(){return this._isPlaying}get entries(){return this._entries}getEntry(e){return e<0||e>=this._entries.length?null:this._entries[e]}requestPlayList(){pe.instance.communication.connection.send(new fv)}dispose(){this._disposed||(this._disposed=!0,this.stopPlaying(),pe.instance.soundManager.events&&pe.instance.soundManager.events.removeEventListener(Pl.SIR_TRAX_SONG_INFO_RECEIVED,this.onSongInfoReceivedEvent),this._messageEvents.forEach(e=>pe.instance.communication.connection.removeMessageEvent(e)),this._messageEvents=null)}}class kX{constructor(e){this._id=e,this._items=[]}addChannelItem(e){this._items.push(e)}get items(){return this._items}}class VX{constructor(e,t){this._id=e,this._length=t}get id(){return this._id}get length(){return this._length}}class Pf{constructor(e){this._channels=[],this._metaData=new Map;let t=[];const s=e.split(":"),r=s[s.length-1];if(r.indexOf("meta")>-1){const i=r.split(";");for(const a of i){const l=a.split(",");this._metaData.set(l[0],l[1])}t=s.slice(0,s.length-1)}else t=s;for(let i=0;i<t.length/2;i++)if(t[i*2].length>0){const a=parseInt(t[i*2]),l=t[i*2+1].split(";"),c=new kX(a);for(const u of l){const h=u.split(",");if(h.length!==2)return;c.addChannelItem(new VX(parseInt(h[0]),parseInt(h[1])))}this._channels.push(c)}}get channels(){return this._channels}getSampleIds(){const e=[];for(const t of this._channels)for(const s of t.items)e.indexOf(s.id)===-1&&e.push(s.id);return e}get hasMetaData(){return this._metaData.has("meta")}get metaCutMode(){return this._metaData.has("c")}get metaTempo(){const e=this._metaData.get("t");return e?parseInt(e):null}}class HX{constructor(e){this._sampleUrl=e,this._isPlaying=!1,this._startPos=0,this._currentPos=0,this._playLength=0,this._sequence=[],this._cache=new Map}async play(e,t,s=0,r=-1){this.reset(),this._currentSong=new Pf(e),this._startPos=Math.trunc(s),this._playLength=r,this._currentPos=this._startPos,this._currentSongId=t,await this.preload(),this._isPlaying=!0,this.tick(),this._tickerInterval=window.setInterval(()=>this.tick(),1e3)}reset(){this._isPlaying=!1,window.clearInterval(this._tickerInterval),jo.Howler.stop(),this._currentSongId=-1,this._currentSong=void 0,this._tickerInterval=void 0,this._startPos=0,this._playLength=0,this._sequence=[],this._currentPos=0}pause(){this._isPlaying=!1,jo.Howler.stop()}resume(){this._isPlaying=!0}stop(){const e=this._currentSongId;this.reset(),pe.instance.soundManager.events.dispatchEvent(new jc(jc.TRAX_SONG_COMPLETE,e))}setVolume(e){jo.Howler.volume(e)}getVolume(){return jo.Howler.volume()}async getSample(e){let t=this._cache.get(e);return t||(t=await this.loadSong(e)),Promise.resolve(t)}async preload(){if(this._sequence=[],!!this._currentSong){for(const e of this._currentSong.channels){const t=[];for(const s of e.items){const r=await this.getSample(s.id),i=Math.ceil(s.length*2/Math.ceil(r.duration()));for(let a=0;a<i;a++)for(let l=0;l<Math.ceil(r.duration());l++)t.push({sampleId:s.id,offset:l})}this._sequence.push(t)}this._playLength<=0&&(this._playLength=Math.max(...this._sequence.map(e=>e.length)))}}async preloadSamplesForSong(e){const t=new Pf(e);await Promise.all(t.getSampleIds().map(s=>this.getSample(s)))}async loadSong(e){return new Promise((t,s)=>{const r=new jo.Howl({src:[this._sampleUrl.replace("%sample%",e.toString())],preload:!0});r.once("load",()=>{this._cache.set(e,r),t(r)}),r.once("loaderror",()=>{me.error("failed to load sample "+e),s("failed to load sample "+e)})})}tick(){this._currentPos>this._playLength-1&&this.stop(),this._isPlaying&&(this._currentSong&&this.playPosition(this._currentPos),this._currentPos++)}playPosition(e){if(!(!this._currentSong||!this._sequence)&&jo.Howler._audioUnlocked)for(const t of this._sequence){const s=t[e];if(!s||s.sampleId===-1||s.sampleId===0)continue;const r=this._cache.get(s.sampleId);r&&(s.offset===0?r.play():r.playing()||(r.seek(s.offset),r.play()))}}}const VE=class Rh{constructor(){this._priorityPlaying=-1,this._requestNumberPlaying=-1,this._previousNotificationTime=-1,this._timerInstance=-1,this._songRequestList=[],this._requestedSongs=new Map,this._availableSongs=new Map,this._songDiskInventory=new Zt,this._songRequestsPerPriority=[],this._songRequestCountsPerPriority=[],this._diskInventoryMissingData=[],this._songIdPlaying=-1,this._previousNotifiedSongId=-1,this._messageEvents=[new pN(this.onTraxSongInfoMessageEvent.bind(this)),new IN(this.onSongDiskInventoryMessage.bind(this))],this.onJukeboxInit=this.onJukeboxInit.bind(this),this.onJukeboxDispose=this.onJukeboxDispose.bind(this),this.onSoundMachineInit=this.onSoundMachineInit.bind(this),this.onSoundMachineDispose=this.onSoundMachineDispose.bind(this),this.onTraxSongComplete=this.onTraxSongComplete.bind(this)}init(){this._timerInstance=window.setInterval(this.onTick.bind(this),1e3),this._musicPlayer=new HX(pe.instance.getConfiguration("external.samples.url")),this._messageEvents.forEach(e=>pe.instance.communication.connection.addMessageEvent(e)),pe.instance.roomEngine.events.addEventListener(Dt.JUKEBOX_INIT,this.onJukeboxInit),pe.instance.roomEngine.events.addEventListener(Dt.JUKEBOX_DISPOSE,this.onJukeboxDispose),pe.instance.roomEngine.events.addEventListener(Dt.SOUND_MACHINE_INIT,this.onSoundMachineInit),pe.instance.roomEngine.events.addEventListener(Dt.SOUND_MACHINE_DISPOSE,this.onSoundMachineDispose),pe.instance.soundManager.events.addEventListener(jc.TRAX_SONG_COMPLETE,this.onTraxSongComplete)}getRoomItemPlaylist(e){return this._roomItemPlaylist}get songDiskInventory(){return this._songDiskInventory}getSongDiskInventorySize(){return this._songDiskInventory.length}getSongDiskInventoryDiskId(e){return e>=0&&e<this._songDiskInventory.length?this._songDiskInventory.getKey(e):-1}getSongDiskInventorySongId(e){return e>=0&&e<this._songDiskInventory.length?this._songDiskInventory.getWithIndex(e):-1}getSongInfo(e){const t=this.getSongDataEntry(e);return t||this.requestSongInfoWithoutSamples(e),t}getSongIdPlayingAtPriority(e){return e!==this._priorityPlaying?-1:this._songIdPlaying}stop(e){const t=e===this._priorityPlaying,s=this.getTopRequestPriority()===e;t?(this.resetSongStartRequest(e),this.stopSongAtPriority(e)):(this.resetSongStartRequest(e),s&&this.reRequestSongAtPriority(this._priorityPlaying))}addSongInfoRequest(e){this.requestSong(e,!0)}requestSongInfoWithoutSamples(e){this.requestSong(e,!1)}requestUserSongDisks(){pe.instance.communication.connection.send(new Iv)}updateVolume(e){this._musicPlayer.setVolume(e)}dispose(){this._timerInstance&&(clearInterval(this._timerInstance),this._timerInstance=void 0),this._messageEvents.forEach(e=>pe.instance.communication.connection.removeMessageEvent(e)),pe.instance.roomEngine.events.removeEventListener(Dt.JUKEBOX_INIT,this.onJukeboxInit),pe.instance.roomEngine.events.removeEventListener(Dt.JUKEBOX_DISPOSE,this.onJukeboxDispose),pe.instance.roomEngine.events.removeEventListener(Dt.SOUND_MACHINE_INIT,this.onSoundMachineInit),pe.instance.roomEngine.events.removeEventListener(Dt.SOUND_MACHINE_DISPOSE,this.onSoundMachineDispose),pe.instance.soundManager.events.removeEventListener(jc.TRAX_SONG_COMPLETE,this.onTraxSongComplete)}get samplesIdsInUse(){let e,t,s=[];for(let r=0;r<this._songRequestsPerPriority.length;r++)if(this._songRequestsPerPriority[r]&&(e=this._songRequestsPerPriority[r],t=this._availableSongs.get(e.songId),t)){const i=t.songData;if(i.length>0){const a=new Pf(i);s=s.concat(a.getSampleIds())}}return s}onSongLoaded(e){const t=this.getTopRequestPriority();if(t>=0){const s=this.getSongIdRequestedAtPriority(t);e===s&&this.playSongObject(t,e)}}samplesUnloaded(e){throw new Error("Method not implemented.")}onTraxSongComplete(e){if(this.getSongIdPlayingAtPriority(this._priorityPlaying)===e.id){this.getTopRequestPriority()===this._priorityPlaying&&this.getSongRequestCountAtPriority(this._priorityPlaying)==this._requestNumberPlaying&&this.resetSongStartRequest(this._priorityPlaying);const t=this._priorityPlaying;this.playSongWithHighestPriority(),t>=Is.PRIORITY_SONG_PLAY&&pe.instance.soundManager.events.dispatchEvent(new Bi(Bi.NPW_USER_STOP_SONG,t,e.id,-1))}}onTraxSongInfoMessageEvent(e){const t=e.getParser();for(const s of t.songs){const r=!!this.getSongDataEntry(s.id);if(this.areSamplesRequested(s.id),!r){const i=new qb(s.id,s.length,s.name,s.creator,s.data);this._availableSongs.set(s.id,i);const a=this.getTopRequestPriority(),l=this.getSongIdRequestedAtPriority(a);for(s.id===l&&this.playSongObject(a,l),pe.instance.soundManager.events.dispatchEvent(new Pl(Pl.SIR_TRAX_SONG_INFO_RECEIVED,s.id));this._diskInventoryMissingData.indexOf(s.id)!=-1;)this._diskInventoryMissingData.splice(this._diskInventoryMissingData.indexOf(s.id),1),this._diskInventoryMissingData.length===0&&pe.instance.soundManager.events.dispatchEvent(new hl(hl.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT))}}}onSongDiskInventoryMessage(e){const t=e.getParser();this._songDiskInventory.reset();for(let s=0;s<t.songDiskCount;s++){const r=t.getDiskId(s),i=t.getSongId(s);this._songDiskInventory.add(r,i),this._availableSongs.get(i)||(this._diskInventoryMissingData.push(i),this.requestSongInfoWithoutSamples(i))}this._diskInventoryMissingData.length===0&&pe.instance.soundManager.events.dispatchEvent(new hl(hl.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT))}onTick(){this._songRequestList.length!==0&&(pe.instance.communication.connection.send(new pv(...this._songRequestList)),this._songRequestList=[])}requestSong(e,t){this._requestedSongs.get(e)===void 0&&(this._requestedSongs.set(e,t),this._songRequestList.push(e))}areSamplesRequested(e){return this._requestedSongs.get(e)?this._requestedSongs.get(e):!1}processSongEntryForPlaying(e,t=!0){return this.getSongDataEntry(e)?!0:(this.addSongInfoRequest(e),!1)}playSong(e,t,s=0,r=0,i=.5,a=.5){return!this.addSongStartRequest(t,e,s,r,i,a)||!this.processSongEntryForPlaying(e)?!1:(t>=this._priorityPlaying&&this.playSongObject(t,e),!0)}playSongObject(e,t){if(t===-1||e<0||e>=Is.PRIORITY_COUNT)return!1;let s=!1;this.stopSongAtPriority(this._priorityPlaying)&&(s=!0);const r=this.getSongDataEntry(t);if(!r)return!1;if(s)return!0;this._musicPlayer.setVolume(pe.instance.soundManager.traxVolume);let i=Rh.SKIP_POSITION_SET,a=0;const l=this.getSongStartRequest(e);return l&&(i=l.startPos,a=l.playLength,l.fadeInSeconds,l.fadeOutSeconds),i>=r.length/1e3?!1:(i<=Rh.SKIP_POSITION_SET&&(i=0),i=Math.trunc(i),this._priorityPlaying=e,this._requestNumberPlaying=this.getSongRequestCountAtPriority(e),this._songIdPlaying=t,this._priorityPlaying<=Rh.MAXIMUM_NOTIFY_PRIORITY&&this.notifySongPlaying(r),this._musicPlayer.preloadSamplesForSong(r.songData).then(()=>this._musicPlayer.play(r.songData,r.id,i,a)),e>Is.PRIORITY_ROOM_PLAYLIST&&pe.instance.soundManager.events.dispatchEvent(new Bi(Bi.NPE_USER_PLAY_SONG,e,r.id,-1)),!0)}notifySongPlaying(e){const s=Date.now();e.length>=8e3&&(this._previousNotifiedSongId!=e.id||s>this._previousNotificationTime+8e3)&&(pe.instance.soundManager.events.dispatchEvent(new Zb(e.name,e.creator)),this._previousNotifiedSongId=e.id,this._previousNotificationTime=s)}addSongStartRequest(e,t,s,r,i,a){if(e<0||e>=Is.PRIORITY_COUNT)return!1;const l=new GX(t,s,r,i,a);return this._songRequestsPerPriority[e]=l,this._songRequestCountsPerPriority[e]=this._songRequestCountsPerPriority[e]+1,!0}getSongDataEntry(e){let t;return this._availableSongs&&(t=this._availableSongs.get(e)),t}getSongStartRequest(e){return this._songRequestsPerPriority[e]}getTopRequestPriority(){return this._songRequestsPerPriority.length-1}getSongIdRequestedAtPriority(e){return e<0||e>=Is.PRIORITY_COUNT||!this._songRequestsPerPriority[e]?-1:this._songRequestsPerPriority[e].songId}getSongRequestCountAtPriority(e){return e<0||e>=Is.PRIORITY_COUNT?-1:this._songRequestCountsPerPriority[e]}playSongWithHighestPriority(){let e;this._priorityPlaying=-1,this._songIdPlaying=-1,this._requestNumberPlaying=-1;let s=this.getTopRequestPriority();for(;s>=0;){if(e=this.getSongIdRequestedAtPriority(s),e>=0&&this.playSongObject(s,e))return;s--}}resetSongStartRequest(e){e>=0&&e<Is.PRIORITY_COUNT&&(this._songRequestsPerPriority[e]=void 0)}reRequestSongAtPriority(e){this._songRequestCountsPerPriority[e]=this._songRequestCountsPerPriority[e]+1}stopSongAtPriority(e){if(e===this._priorityPlaying&&this._priorityPlaying>=0){const t=this.getSongIdPlayingAtPriority(e);if(t>=0)return this.getSongDataEntry(t),this._musicPlayer.stop(),!0}return!1}onSoundMachineInit(e){this.disposeRoomPlaylist()}onSoundMachineDispose(e){this.disposeRoomPlaylist()}onJukeboxInit(e){this.disposeRoomPlaylist(),this._roomItemPlaylist=new BX,this._roomItemPlaylist.init(),pe.instance.communication.connection.send(new mv)}onJukeboxDispose(e){this.disposeRoomPlaylist()}disposeRoomPlaylist(){this._roomItemPlaylist&&(this._roomItemPlaylist.dispose(),this._roomItemPlaylist=void 0)}};VE.SKIP_POSITION_SET=-1;VE.MAXIMUM_NOTIFY_PRIORITY=Is.PRIORITY_ROOM_PLAYLIST;let jX=VE;class WX extends En{constructor(){super(),this._volumeSystem=.5,this._volumeFurni=.5,this._volumeTrax=.5,this._internalSamples=new Zt,this._furniSamples=new Zt,this._furnitureBeingPlayed=new Zt,this._musicController=new jX,this.onEvent=this.onEvent.bind(this)}onInit(){this._musicController.init(),pe.instance.roomEngine.events.addEventListener(Tr.PLAY_SAMPLE,this.onEvent),pe.instance.roomEngine.events.addEventListener(ue.REMOVED,this.onEvent),pe.instance.roomEngine.events.addEventListener(je.DISPOSED,this.onEvent),pe.instance.events.addEventListener(fl.SETTINGS_UPDATED,this.onEvent),pe.instance.events.addEventListener(ml.PLAY_SOUND,this.onEvent)}onDispose(){this._musicController&&(this._musicController.dispose(),this._musicController=null),pe.instance.roomEngine.events.removeEventListener(Tr.PLAY_SAMPLE,this.onEvent),pe.instance.roomEngine.events.removeEventListener(ue.REMOVED,this.onEvent),pe.instance.roomEngine.events.removeEventListener(je.DISPOSED,this.onEvent),pe.instance.events.removeEventListener(fl.SETTINGS_UPDATED,this.onEvent),pe.instance.events.removeEventListener(ml.PLAY_SOUND,this.onEvent)}onEvent(e){var t;switch(e.type){case Tr.PLAY_SAMPLE:{const s=e;this.playFurniSample(s.objectId,s.sampleId,s.pitch);return}case ue.REMOVED:{const s=e;this.stopFurniSample(s.objectId);return}case je.DISPOSED:{this._furnitureBeingPlayed.getKeys().forEach(s=>{this.stopFurniSample(s)});return}case fl.SETTINGS_UPDATED:{const s=e,r=s.volumeFurni!==this._volumeFurni,i=s.volumeTrax!==this._volumeTrax;this._volumeSystem=s.volumeSystem/100,this._volumeFurni=s.volumeFurni/100,this._volumeTrax=s.volumeTrax/100,r&&this.updateFurniSamplesVolume(this._volumeFurni),i&&((t=this._musicController)==null||t.updateVolume(this._volumeTrax));return}case ml.PLAY_SOUND:{const s=e;this.playInternalSample(s.sampleCode);return}}}playSample(e,t,s=1){e.volume=t,e.currentTime=0;try{e.play()}catch(r){me.error(r)}}playInternalSample(e){let t=this._internalSamples.getValue(e);if(!t){const s=Ue.getValue("sounds.url");t=new Audio(s.replace("%sample%",e)),this._internalSamples.add(e,t)}this.playSample(t,this._volumeSystem)}playFurniSample(e,t,s){let r=this._furniSamples.getValue(t);if(!r){const i=Ue.getValue("external.samples.url");r=new Audio(i.replace("%sample%",t.toString())),this._furniSamples.add(t,r)}this._furnitureBeingPlayed.hasKey(e)||this._furnitureBeingPlayed.add(e,t),r.onended=i=>{this.stopFurniSample(e)},r.onpause=i=>{this.stopFurniSample(e)},r.onerror=i=>{this.stopFurniSample(e)},this.playSample(r,this._volumeFurni,s)}stopInternalSample(e){const t=this._internalSamples.getValue(e);if(t)try{t.pause()}catch(s){me.error(s)}}stopFurniSample(e){const t=this._furnitureBeingPlayed.getValue(e);if(!t)return;const s=this._furniSamples.getValue(t);if(this._furnitureBeingPlayed.remove(e),!!s)try{s.pause()}catch(r){me.error(r)}}updateInternalSamplesVolume(e){this._internalSamples.getValues().forEach(t=>{t.volume=e})}updateFurniSamplesVolume(e){this._furniSamples.getValues().forEach(t=>{t.volume=e})}get traxVolume(){return this._volumeTrax}get musicController(){return this._musicController}}Je.available;dd.SCALE_MODE=window.devicePixelRatio%1?cg.LINEAR:cg.NEAREST;dd.ROUND_PIXELS=!0;dd.GC_MAX_IDLE=120;const Tu=class co{constructor(e,t){co.INSTANCE||(co.INSTANCE=this),this._application=new Us(t),this._core=e,this._events=new jr,this._communication=new J3(e.communication),this._localization=new $3(this._communication),this._avatar=new e6,this._roomEngine=new wE(this._communication),this._sessionDataManager=new wX(this._communication),this._roomSessionManager=new xX(this._communication,this._roomEngine),this._roomManager=new sF(this._roomEngine,this._roomEngine.visualizationFactory,this._roomEngine.logicFactory),this._cameraManager=new iF,this._soundManager=new WX,this._linkTrackers=[],this._isReady=!1,this._isDisposed=!1,this._core.configuration.events.addEventListener(_i.LOADED,this.onConfigurationLoadedEvent.bind(this)),this._roomEngine.events.addEventListener(je.ENGINE_INITIALIZED,this.onRoomEngineReady.bind(this))}static bootstrap(){co.INSTANCE&&(co.INSTANCE.dispose(),co.INSTANCE=null);const e=document.createElement("canvas"),t=new this(new f0,{autoDensity:!1,width:window.innerWidth,height:window.innerHeight,resolution:window.devicePixelRatio,view:e});e.addEventListener("webglcontextlost",()=>t.events.dispatchEvent(new He(co.WEBGL_CONTEXT_LOST)))}init(){if(!(this._isReady||this._isDisposed)){if(this._avatar&&this._avatar.init(),this._soundManager&&this._soundManager.init(),this._roomEngine&&(this._roomEngine.sessionDataManager=this._sessionDataManager,this._roomEngine.roomSessionManager=this._roomSessionManager,this._roomEngine.roomManager=this._roomManager,this._sessionDataManager&&this._sessionDataManager.init(),this._roomSessionManager&&this._roomSessionManager.init(),this._roomEngine.init()),!this._communication.connection)throw new Error("No connection found");new Z3(this._communication.connection),this._isReady=!0}}dispose(){this._isDisposed||(this._roomManager&&(this._roomManager.dispose(),this._roomManager=null),this._roomSessionManager&&(this._roomSessionManager.dispose(),this._roomSessionManager=null),this._sessionDataManager&&(this._sessionDataManager.dispose(),this._sessionDataManager=null),this._roomEngine&&(this._roomEngine.dispose(),this._roomEngine=null),this._avatar&&(this._avatar.dispose(),this._avatar=null),this._soundManager&&(this._soundManager.dispose(),this._soundManager=null),this._communication&&(this._communication.dispose(),this._communication=null),this._application&&(this._application.destroy(),this._application=null),this._isDisposed=!0,this._isReady=!1)}onConfigurationLoadedEvent(e){qs().maxFPS=Ue.getValue("system.fps.max",24),me.LOG_DEBUG=Ue.getValue("system.log.debug",!0),me.LOG_WARN=Ue.getValue("system.log.warn",!1),me.LOG_ERROR=Ue.getValue("system.log.error",!1),me.LOG_EVENTS=Ue.getValue("system.log.events",!1),me.LOG_PACKETS=Ue.getValue("system.log.packets",!1),Vb.LANDSCAPES_ENABLED=Ue.getValue("room.landscapes.enabled",!0)}onRoomEngineReady(e){this.startSendingHeartBeat()}getConfiguration(e,t=null){return Ue.getValue(e,t)}getLocalization(e){return this._localization.getValue(e)}getLocalizationWithParameter(e,t,s){return this._localization.getValueWithParameter(e,t,s)}getLocalizationWithParameters(e,t,s){return this._localization.getValueWithParameters(e,t,s)}addLinkEventTracker(e){this._linkTrackers.indexOf(e)>=0||this._linkTrackers.push(e)}removeLinkEventTracker(e){const t=this._linkTrackers.indexOf(e);t!==-1&&this._linkTrackers.splice(t,1)}createLinkEvent(e){if(!(!e||e===""))for(const t of this._linkTrackers){if(!t)continue;const s=t.eventUrlPrefix;s.length>0?e.substr(0,s.length)===s&&t.linkReceived(e):t.linkReceived(e)}}startSendingHeartBeat(){this.sendHeartBeat(),setInterval(this.sendHeartBeat,1e4)}sendHeartBeat(){ra.sendHeartBeat()}get application(){return this._application}get core(){return this._core}get events(){return this._events}get localization(){return this._localization}get communication(){return this._communication}get avatar(){return this._avatar}get roomEngine(){return this._roomEngine}get sessionDataManager(){return this._sessionDataManager}get roomSessionManager(){return this._roomSessionManager}get roomManager(){return this._roomManager}get cameraManager(){return this._cameraManager}get soundManager(){return this._soundManager}get width(){return this._application.renderer.width}get height(){return this._application.renderer.height}get isReady(){return this._isReady}get isDisposed(){return this._isDisposed}static get instance(){return this.INSTANCE||null}};Tu.WEBGL_CONTEXT_LOST="NE_WEBGL_CONTEXT_LOST";Tu.WEBGL_UNAVAILABLE="NE_WEBGL_UNAVAILABLE";Tu.READY="NE_READY!";Tu.INSTANCE=null;let pe=Tu;const Si=class At{static format(e,t="",s=3){return e>s*At.YEAR?At.getLocalization("friendlytime.years"+t,Math.round(e/At.YEAR)):e>s*At.MONTH?At.getLocalization("friendlytime.months"+t,Math.round(e/At.MONTH)):e>s*At.DAY?At.getLocalization("friendlytime.days"+t,Math.round(e/At.DAY)):e>s*At.HOUR?At.getLocalization("friendlytime.hours"+t,Math.round(e/At.HOUR)):e>s*At.MINUTE?At.getLocalization("friendlytime.minutes"+t,Math.round(e/At.MINUTE)):At.getLocalization("friendlytime.seconds"+t,Math.round(e))}static shortFormat(e,t="",s=3){return e>s*At.YEAR?At.getLocalization("friendlytime.years.short"+t,Math.round(e/At.YEAR)):e>s*At.MONTH?At.getLocalization("friendlytime.months.short"+t,Math.round(e/At.MONTH)):e>s*At.DAY?At.getLocalization("friendlytime.days.short"+t,Math.round(e/At.DAY)):e>s*At.HOUR?At.getLocalization("friendlytime.hours.short"+t,Math.round(e/At.HOUR)):e>s*At.MINUTE?At.getLocalization("friendlytime.minutes.short"+t,Math.round(e/At.MINUTE)):At.getLocalization("friendlytime.seconds.short"+t,Math.round(e))}static getLocalization(e,t){return pe.instance.getLocalizationWithParameter(e,"amount",t.toString())}};Si.MINUTE=60;Si.HOUR=60*Si.MINUTE;Si.DAY=24*Si.HOUR;Si.WEEK=7*Si.DAY;Si.MONTH=30*Si.DAY;Si.YEAR=365*Si.DAY;let Jn=Si;const $b=class eP{static isBuilderClubId(e){return e>=eP.BUILDER_CLUB_FURNI_ID_BASE}};$b.BUILDER_CLUB_FURNI_ID_BASE=2147418112;let Hp=$b;const YX=n=>n>>>0,tP=n=>{const e=YX(n);return e>=Math.pow(2,31)?e-Math.pow(2,32):e};class HE{constructor(e){if(this._id=e.id,this._isMain=e.main||!1,this._avatarSets=new Map,this._bodyParts=[],this._allBodyParts=[],e.avatarSets&&e.avatarSets.length>0)for(const s of e.avatarSets){if(!s)continue;const r=new HE(s);this._avatarSets.set(r.id,r)}if(e.bodyParts&&e.bodyParts.length>0)for(const s of e.bodyParts)s&&this._bodyParts.push(s.id);let t=this._bodyParts.concat();for(const s of this._avatarSets.values())s&&(t=t.concat(s.getBodyParts()));this._allBodyParts=t}findAvatarSet(e){if(e===this._id)return this;for(const t of this._avatarSets.values())if(t&&t.findAvatarSet(e))return t;return null}getBodyParts(){return this._allBodyParts.concat()}get id(){return this._id}get isMain(){if(this._isMain)return!0;for(const e of this._avatarSets.values())if(e&&e.isMain)return!0;return!1}}class qr{constructor(e=0,t=0,s=0){this._x=e,this._y=t,this._z=s}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static cross(e,t){const s=new qr;return s.x=e.y*t.z-e.z*t.y,s.y=e.z*t.x-e.x*t.z,s.z=e.x*t.y-e.y*t.x,s}static subtract(e,t){return new qr(e.x-t.x,e.y-t.y,e.z-t.z)}dot(e){return this._x*e.x+this._y*e.y+this._z*e.z}cross(e){const t=new qr;return t.x=this._y*e.z-this._z*e.y,t.y=this._z*e.x-this._x*e.z,t.z=this._x*e.y-this._y*e.x,t}subtract(e){this._x=this._x-e.x,this._y=this._y-e.y,this._z=this._z-e.z}add(e){this._x=this._x+e.x,this._y=this._y+e.y,this._z=this._z+e.z}normalize(){const e=1/this.length();this._x=this._x*e,this._y=this._y*e,this._z=this._z*e}scaleBy(e){this._x*=e,this._y*=e,this._z*=e}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}toString(){return"Vector3D: ("+this._x+","+this._y+","+this._z+")"}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get z(){return this._z}set z(e){this._z=e}}class sP{constructor(e,t,s){this._location=new qr(e,t,s),this._transformedLocation=new qr,this._needsTransformation=!1,(e!=0||t!=0||s!=0)&&(this._needsTransformation=!0)}get location(){return this._location}get transformedLocation(){return this._transformedLocation}applyTransform(e){this._needsTransformation&&(this._transformedLocation=e.vectorMultiplication(this._location))}}class jp extends sP{constructor(e,t=!1){super(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z)),this._id=e.id,this._radius=parseFloat(e.radius),this._normal=new qr(parseFloat(e.nx),parseFloat(e.ny),parseFloat(e.nz)),this._isDoubleSided=e.double||!1,this._isDynamic=t}getDistance(e){const t=Math.abs(e.z-this.transformedLocation.z-this._radius),s=Math.abs(e.z-this.transformedLocation.z+this._radius);return Math.min(t,s)}get id(){return this._id}get normal(){return this._normal}get isDoubleSided(){return this._isDoubleSided}toString(){return this._id+": "+this.location+" - "+this.transformedLocation}get isDynamic(){return this._isDynamic}}class zX extends sP{constructor(e){if(super(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z)),this._id=e.id,this._radius=parseFloat(e.radius),this._parts=new Map,this._dynamicParts=new Map,e.items&&e.items.length>0)for(const t of e.items){if(!t)continue;const s=new jp(t);this._parts.set(s.id,s)}}getDynamicParts(e){const t=this._dynamicParts.get(e),s=[];if(t)for(const r in t){const i=t[r];i&&s.push(i)}return s}getPartIds(e){const t=[];for(const s of this._parts.values())s&&t.push(s.id);if(e){const s=this._dynamicParts.get(e);if(s)for(const r in s){const i=s[r];i&&t.push(i.id)}}return t}removeDynamicParts(e){return this._dynamicParts.delete(e),!0}addPart(e,t){if(this.hasPart(e.id,t))return!1;let s=this._dynamicParts.get(t);return s||(s={},this._dynamicParts.set(t,s)),s[e.id]=new jp(e,!0),!0}hasPart(e,t){let s=this._parts.get(e)||null;return!s&&this._dynamicParts.get(t)!==void 0&&(s=this._dynamicParts.get(t)[e]||null),s!==null}getParts(e,t,s,r){const i=[];for(const c of this._parts.values())c&&(c.applyTransform(e),i.push([c.getDistance(t),c]));const a=this._dynamicParts.get(r);if(a)for(const c in a){const u=a[c];u&&(u.applyTransform(e),i.push([u.getDistance(t),u]))}i.sort((c,u)=>{const h=c[0],d=u[0];return h<d?-1:h>d?1:0});const l=[];for(const c of i)c&&l.push(c[1].id);return l}getDistance(e){const t=Math.abs(e.z-this.transformedLocation.z-this._radius),s=Math.abs(e.z-this.transformedLocation.z+this._radius);return Math.min(t,s)}get id(){return this._id}get radius(){return this._radius}}const sd=class xn{constructor(e=0,t=0,s=0,r=0,i=0,a=0,l=0,c=0,u=0){this._data=[e,t,s,r,i,a,l,c,u]}static getXRotationMatrix(e){const t=e*Math.PI/180,s=Math.cos(t),r=Math.sin(t);return new xn(1,0,0,0,s,-r,0,r,s)}static getYRotationMatrix(e){const t=e*Math.PI/180,s=Math.cos(t),r=Math.sin(t);return new xn(s,0,r,0,1,0,-r,0,s)}static getZRotationMatrix(e){const t=e*Math.PI/180,s=Math.cos(t),r=Math.sin(t);return new xn(s,-r,0,r,s,0,0,0,1)}identity(){return this._data=[1,0,0,0,1,0,0,0,1],this}vectorMultiplication(e){const t=e.x*this._data[0]+e.y*this._data[3]+e.z*this._data[6],s=e.x*this._data[1]+e.y*this._data[4]+e.z*this._data[7],r=e.x*this._data[2]+e.y*this._data[5]+e.z*this._data[8];return new qr(t,s,r)}multiply(e){const t=this._data[0]*e.data[0]+this._data[1]*e.data[3]+this._data[2]*e.data[6],s=this._data[0]*e.data[1]+this._data[1]*e.data[4]+this._data[2]*e.data[7],r=this._data[0]*e.data[2]+this._data[1]*e.data[5]+this._data[2]*e.data[8],i=this._data[3]*e.data[0]+this._data[4]*e.data[3]+this._data[5]*e.data[6],a=this._data[3]*e.data[1]+this._data[4]*e.data[4]+this._data[5]*e.data[7],l=this._data[3]*e.data[2]+this._data[4]*e.data[5]+this._data[5]*e.data[8],c=this._data[6]*e.data[0]+this._data[7]*e.data[3]+this._data[8]*e.data[6],u=this._data[6]*e.data[1]+this._data[7]*e.data[4]+this._data[8]*e.data[7],h=this._data[6]*e.data[2]+this._data[7]*e.data[5]+this._data[8]*e.data[8];return new xn(t,s,r,i,a,l,c,u,h)}scalarMultiply(e){let t=0;for(;t<this._data.length;)this._data[t]=this._data[t]*e,t++}rotateX(e){const t=e*Math.PI/180,s=Math.cos(t),r=Math.sin(t);return new xn(1,0,0,0,s,-r,0,r,s).multiply(this)}rotateY(e){const t=e*Math.PI/180,s=Math.cos(t),r=Math.sin(t);return new xn(s,0,r,0,1,0,-r,0,s).multiply(this)}rotateZ(e){const t=e*Math.PI/180,s=Math.cos(t),r=Math.sin(t);return new xn(s,-r,0,r,s,0,0,0,1).multiply(this)}skew(){}transpose(){return new xn(this._data[0],this._data[3],this._data[6],this._data[1],this._data[4],this._data[7],this._data[2],this._data[5],this._data[8])}equals(e){return!1}get data(){return this._data}};sd.IDENTITY=new sd(1,0,0,0,1,0,0,0,1);sd.TOLERANS=1e-18;let x_=sd;class KX{constructor(e){this._camera=new qr(0,0,10),this._avatarSet=new HE(e.avatarSets[0]),this._geometryTypes=new Map,this._itemIdToBodyPartMap=new Map,this._transformation=new x_,this._canvases=new Map;const t=e.camera;if(t&&(this._camera.x=parseFloat(t.x),this._camera.y=parseFloat(t.y),this._camera.z=parseFloat(t.z)),e.canvases&&e.canvases.length>0)for(const s of e.canvases){if(!s)continue;const r=s.scale,i=new Map;if(s.geometries&&s.geometries.length>0)for(const a of s.geometries){if(!a)continue;const l=new L0(a,r);i.set(l.id,l)}this._canvases.set(r,i)}if(e.types&&e.types.length>0)for(const s of e.types){if(!s)continue;const r=new Map,i=new Map;if(s.bodyParts&&s.bodyParts.length>0)for(const a of s.bodyParts){if(!a)continue;const l=new zX(a);r.set(l.id,l);for(const c of l.getPartIds(null))i.set(c,l)}this._geometryTypes.set(s.id,r),this._itemIdToBodyPartMap.set(s.id,i)}}removeDynamicItems(e){for(const t of this._geometryTypes.values())if(t)for(const s of t.values())s&&s.removeDynamicParts(e)}getBodyPartIdsInAvatarSet(e){const t=this._avatarSet.findAvatarSet(e);return t?t.getBodyParts():[]}isMainAvatarSet(e){const t=this._avatarSet.findAvatarSet(e);return t?t.isMain:!1}getCanvas(e,t){const s=this._canvases.get(e);return s&&s.get(t)||null}typeExists(e){return!!this._geometryTypes.get(e)}hasBodyPart(e,t){if(this.typeExists(e)){const s=this._geometryTypes.get(e);if(s&&s.get(t))return!0}return!1}getBodyPartIDs(e){const t=this.getBodyPartsOfType(e),s=[];if(t)for(const r of t.values())r&&s.push(r.id);return s}getBodyPartsOfType(e){return this.typeExists(e)?this._geometryTypes.get(e):new Map}getBodyPart(e,t){return this.getBodyPartsOfType(e).get(t)||null}getBodyPartOfItem(e,t,s){const r=this._itemIdToBodyPartMap.get(e);if(r){const i=r.get(t);if(i)return i;const a=this.getBodyPartsOfType(e);if(a){for(const l of a.values())if(l&&l.hasPart(t,s))return l}}return null}getBodyPartsInAvatarSet(e,t){const s=this.getBodyPartIdsInAvatarSet(t),r=[];for(const i of s){if(!i)continue;const a=e.get(i);a&&r.push(a)}return r}getBodyPartsAtAngle(e,t,s){if(!s)return[];const r=this.getBodyPartsOfType(s),i=this.getBodyPartsInAvatarSet(r,e),a=[],l=[];this._transformation=x_.getYRotationMatrix(t);for(const c of i.values())c&&(c.applyTransform(this._transformation),a.push([c.getDistance(this._camera),c]));a.sort((c,u)=>{const h=c[0],d=u[0];return h<d?-1:h>d?1:0});for(const c of a)c&&l.push(c[1].id);return l}getParts(e,t,s,r,i){if(this.hasBodyPart(e,t)){const a=this.getBodyPartsOfType(e).get(t);return this._transformation=x_.getYRotationMatrix(s),a.getParts(this._transformation,this._camera,r,i)}return[]}}class XX extends jr{constructor(e){super(),this._renderManager=e,this._geometry=null,this._figureData=new w0,this._partSetsData=new G0,this._animationData=new P0,this._animationManager=new N0,this._mandatorySetTypeIds={},this._actionManager=null,this._defaultAction=null}init(){}dispose(){this.disposed||(super.dispose(),this._renderManager=null,this._figureData=null,this._partSetsData=null,this._animationData=null,this._mandatorySetTypeIds=null)}initGeometry(e){e&&(this._geometry=new KX(e))}initActions(e,t){t&&(this._actionManager=new p0(e,t),this._defaultAction=this._actionManager.getDefaultAction())}updateActions(e){this._actionManager.updateActions(e),this._defaultAction=this._actionManager.getDefaultAction()}initPartSets(e){return e&&this._partSetsData.parse(e)?(this._partSetsData.getPartDefinition("ri").appendToFigure=!0,this._partSetsData.getPartDefinition("li").appendToFigure=!0,!0):!1}initAnimation(e){return e?this._animationData.parse(e):!1}initFigureData(e){return e?this._figureData.parse(e):!1}injectFigureData(e){this._figureData.injectJSON(e)}registerAnimations(e,t="fx",s=200){let r=0;for(;r<s;){const i=e.getCollection(t+r);if(i){const a=i.data;this._animationManager.registerAnimation(this,a.animations)}r++}}registerAnimation(e){this._animationManager.registerAnimation(this,e)}getPartColor(e,t,s=0){const r=e.getPartColorIds(t);if(!r||r.length<s)return null;const i=this._figureData.getSetType(t);if(i==null)return null;const a=this._figureData.getPalette(i.paletteID);return a?a.getColor(r[s]):null}getBodyPartData(e,t,s){return this._animationManager.getLayerData(e,t,s)}getAnimation(e){return this._animationManager.getAnimation(e)}getActionDefinition(e){return this._actionManager.getActionDefinition(e)}getActionDefinitionWithState(e){return this._actionManager.getActionDefinitionWithState(e)}isMainAvatarSet(e){return this._geometry.isMainAvatarSet(e)}sortActions(e){return this._actionManager.sortActions(e)}maxFrames(e){let t=0;for(const s of e)t=Math.max(t,this._animationData.getFrameCount(s.definition));return t}getMandatorySetTypeIds(e,t){return this._mandatorySetTypeIds[e]||(this._mandatorySetTypeIds[e]=[]),this._mandatorySetTypeIds[e][t]?this._mandatorySetTypeIds[e][t]:(this._mandatorySetTypeIds[e][t]=this._figureData.getMandatorySetTypeIds(e,t),this._mandatorySetTypeIds[e][t])}getDefaultPartSet(e,t){return this._figureData.getDefaultPartSet(e,t)}getCanvasOffsets(e,t,s){return this._actionManager.getCanvasOffsets(e,t,s)}getCanvas(e,t){return this._geometry.getCanvas(e,t)}removeDynamicItems(e){this._geometry.removeDynamicItems(e)}getActiveBodyPartIds(e,t){let s=[];const r=[],i=e.definition.geometryType;if(e.definition.isAnimation){const a=e.definition.state+"."+e.actionParameter,l=this._animationManager.getAnimation(a);if(l&&(s=l.getAnimatedBodyPartIds(0,e.overridingAction),l.hasAddData())){const c={id:"",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:1},u={setType:""};for(const h of l.addData){const d=this._geometry.getBodyPart(i,h.align);if(d){c.id=h.id,d.addPart(c,t),u.setType=h.id;const f=this._partSetsData.addPartDefinition(u);f.appendToFigure=!0,h.base===""&&(f.staticId=1),r.indexOf(d.id)===-1&&r.push(d.id)}}}for(const c of s){const u=this._geometry.getBodyPart(i,c);u&&r.indexOf(u.id)===-1&&r.push(u.id)}}else{s=this._partSetsData.getActiveParts(e.definition);for(const a of s){const l=this._geometry.getBodyPartOfItem(i,a,t);l&&r.indexOf(l.id)===-1&&r.push(l.id)}}return r}getBodyPartsUnordered(e){return this._geometry.getBodyPartIdsInAvatarSet(e)}getBodyParts(e,t,s){const r=xr.DIRECTION_TO_ANGLE[s];return this._geometry.getBodyPartsAtAngle(e,r,t)}getFrameBodyPartOffset(e,t,s,r){const i=this._animationData.getAction(e.definition);return i?i.getFrameBodyPartOffset(t,s,r):Cg.DEFAULT_OFFSET}getParts(e,t,s,r,i,a,l,c=null){let u=null,h=[],d=null;if(!s==null)return[];const f=this._partSetsData.getActiveParts(s.definition),E=[];let m=[0];const R=this._animationData.getAction(s.definition);if(s.definition.isAnimation){const N=s.definition.state+"."+s.actionParameter,L=this._animationManager.getAnimation(N);if(L){m=this.getPopulatedArray(L.frameCount(s.overridingAction));for(const M of L.getAnimatedBodyPartIds(0,s.overridingAction))if(M===e){const b=this._geometry.getBodyPart(r,M);if(b)for(const B of b.getDynamicParts(l))f.push(B.id)}}}const I=this._geometry.getParts(r,e,i,f,l),S=t.getPartTypeIds();for(const N of S){if(c&&c.get(N))continue;const L=t.getPartSetId(N),M=t.getPartColorIds(N),b=this._figureData.getSetType(N);if(b){const B=this._figureData.getPalette(b.paletteID);if(B){const w=b.getPartSet(L);if(w){a=a.concat(w.hiddenLayers);for(const x of w.parts)if(I.indexOf(x.type)>-1){if(R){const te=R.getPart(x.type);te?h=te.frames:h=m}else h=m;u=s.definition,f.indexOf(x.type)===-1&&(u=this._defaultAction);const U=this._partSetsData.getPartDefinition(x.type);let G=U?U.flippedSetType:x.type;(!G||G==="")&&(G=x.type),M&&M.length>x.colorLayerIndex-1&&(d=B.getColor(M[x.colorLayerIndex-1]));const K=x.colorLayerIndex>0,Y=new D_(e,x.type,x.id.toString(),d,h,u,K,x.paletteMap,G);E.push(Y)}}}}}const A=[];for(const N of I){let L=null,M=!1;const b=c&&c.get(N);for(const B of E)B.partType===N&&(b?L=B.color:(M=!0,a.indexOf(N)===-1&&A.push(B)));if(!M){if(b){const B=c.get(N);let w=0,x=0;for(;x<B.length;)w=w+B.charCodeAt(x),x++;if(R){const G=R.getPart(N);G?h=G.frames:h=m}else h=m;const U=new D_(e,N,B,L,h,s.definition,L!=null,-1,N,!1,1);A.push(U)}else if(f.indexOf(N)>-1){const B=this._geometry.getBodyPartOfItem(r,N,l);if(e===B.id){const w=this._partSetsData.getPartDefinition(N);let x=!1,U=1;if(w.appendToFigure){let G="1";if(s.actionParameter!==""&&(G=s.actionParameter),w.hasStaticId()&&(G=w.staticId.toString()),R){const Y=R.getPart(N);Y?h=Y.frames:h=m}else h=m;const K=new D_(e,N,G,null,h,s.definition,!1,-1,N,x,U);A.push(K)}}}}}return A}getPopulatedArray(e){const t=[];let s=0;for(;s<e;)t.push(s),s++;return t}getItemIds(){if(this._actionManager){const e=this._actionManager.getActionDefinition("CarryItem").params,t=[];for(const s of e.values())t.push(s);return t}return[]}get renderManager(){return this._renderManager}get figureData(){return this._figureData}get partData(){return this._partSetsData}get animationManager(){return this._animationManager}}const qX={animations:[{id:"Move",parts:[{setType:"bd",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"bds",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"ss",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lg",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"sh",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lh",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lhs",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rh",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rhs",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rs",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"rc",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]},{setType:"ch",frames:[{number:0,assetPartDefinition:"wlk"},{number:1,assetPartDefinition:"wlk"},{number:2,assetPartDefinition:"wlk"},{number:3,assetPartDefinition:"wlk"}]}]},{id:"Wave",parts:[{setType:"lh",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"lhs",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"}]},{setType:"ch",frames:[{number:0,assetPartDefinition:"wav"},{number:1,assetPartDefinition:"wav"},{number:2,assetPartDefinition:"wav"},{number:3,assetPartDefinition:"wav"}]}]},{id:"Talk",parts:[{setType:"hd",frames:[{number:0,assetPartDefinition:"spk"},{number:1,assetPartDefinition:"spk"}]},{setType:"fc",frames:[{number:0,assetPartDefinition:"spk"},{number:1,assetPartDefinition:"spk"}]},{setType:"fa",frames:[{number:0,assetPartDefinition:"spk"},{number:1,assetPartDefinition:"spk"}]}]},{id:"Sign",parts:[{setType:"lh",frames:[{number:0,assetPartDefinition:"sig"}]},{setType:"li",frames:[{number:0,assetPartDefinition:"sig"}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wav"}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wav"}]}]},{id:"Respect",parts:[{setType:"lh",frames:[{number:0,assetPartDefinition:"respect",repeats:15},{number:1,assetPartDefinition:"respect",repeats:15}]},{setType:"ls",frames:[{number:0,assetPartDefinition:"wav",repeats:15},{number:1,assetPartDefinition:"wav",repeats:15}]},{setType:"lc",frames:[{number:0,assetPartDefinition:"wav",repeats:15},{number:1,assetPartDefinition:"wav",repeats:15}]}]},{id:"Blow",parts:[{setType:"rh",frames:[{number:0,assetPartDefinition:"blw",repeats:10},{number:1,assetPartDefinition:"blw",repeats:10}]},{setType:"rs",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"rc",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"ri",frames:[{number:0,assetPartDefinition:""}]},{setType:"ey",frames:[{number:0,assetPartDefinition:"std",repeats:10},{number:0,assetPartDefinition:"eyb",repeats:10}]},{setType:"fc",frames:[{number:0,assetPartDefinition:"std",repeats:10},{number:0,assetPartDefinition:"blw",repeats:10}]}]},{id:"Laugh",parts:[{setType:"rh",frames:[{number:0,assetPartDefinition:"blw"}]},{setType:"rs",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"rc",frames:[{number:0,assetPartDefinition:"drk"}]},{setType:"ri",frames:[{number:0,assetPartDefinition:""}]},{setType:"ey",frames:[{number:0,assetPartDefinition:"std",repeats:2}]},{setType:"fc",frames:[{number:0,assetPartDefinition:"sml"}]}],offsets:{frames:[{id:0,directions:[{id:0,bodyParts:[{id:"head",dx:0,dy:1}]},{id:1,bodyParts:[{id:"head",dx:0,dy:1}]},{id:2,bodyParts:[{id:"head",dx:0,dy:1}]},{id:3,bodyParts:[{id:"head",dx:0,dy:1}]},{id:4,bodyParts:[{id:"head",dx:0,dy:1}]},{id:5,bodyParts:[{id:"head",dx:0,dy:1}]},{id:6,bodyParts:[{id:"head",dx:0,dy:1}]},{id:7,bodyParts:[{id:"head",dx:0,dy:1}]}]},{id:1,directions:[{id:0,bodyParts:[{id:"head",dx:0,dy:0}]},{id:1,bodyParts:[{id:"head",dx:0,dy:0}]},{id:2,bodyParts:[{id:"head",dx:0,dy:0}]},{id:3,bodyParts:[{id:"head",dx:0,dy:0}]},{id:4,bodyParts:[{id:"head",dx:0,dy:0}]},{id:5,bodyParts:[{id:"head",dx:0,dy:0}]},{id:6,bodyParts:[{id:"head",dx:0,dy:0}]},{id:7,bodyParts:[{id:"head",dx:0,dy:0}]}]}]}}]},QX={geometry:{direction:0,camera:{x:0,y:0,z:10},canvases:[{scale:"h",geometries:[{id:"vertical",width:90,height:130,dx:0,dy:0},{id:"sitting",width:90,height:130,dx:0,dy:0},{id:"horizontal",width:128,height:80,dx:30,dy:0},{id:"swhorizontal",width:192,height:120,dx:0,dy:-40}]},{scale:"sh",geometries:[{id:"vertical",width:45,height:72,dx:0,dy:0},{id:"sitting",width:45,height:72,dx:0,dy:0},{id:"horizontal",width:64,height:50,dx:15,dy:-10},{id:"swhorizontal",width:96,height:70,dx:0,dy:-20},{id:"swim",width:64,height:70,dx:25,dy:10}]}],avatarSets:[{id:"full",avatarSets:[{id:"body",main:!0,bodyParts:[{id:"top"},{id:"bottom"},{id:"behind"},{id:"torso"},{id:"leftitem"},{id:"rightitem"},{id:"leftarm"},{id:"rightarm"}]},{id:"head",bodyParts:[{id:"head"}]}]}],types:[{id:"vertical",bodyParts:[{id:"top",x:0,y:0,z:0,radius:2},{id:"bottom",x:0,y:0,z:0,radius:.001},{id:"behind",x:0,y:0,z:.2,radius:.3},{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.045,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.5,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.5,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"sitting",bodyParts:[{id:"top",x:0,y:0,z:0,radius:2},{id:"bottom",x:0,y:0,z:0,radius:.001},{id:"behind",x:0,y:0,z:.2,radius:.3},{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.045,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.5,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.5,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"horizontal",bodyParts:[{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.6,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.6,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"swhorizontal",bodyParts:[{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ch",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"cp",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1},{id:"sh",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!1},{id:"lg",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"ss",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"wa",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!1},{id:"cc",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ca",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"li",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightitem",x:0,y:0,z:-.29,radius:.3,items:[{id:"ri",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1}]},{id:"leftarm",x:-1,y:0,z:-.51,radius:.6,items:[{id:"lh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"lhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"ls",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"lc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"rightarm",x:1,y:0,z:-.51,radius:.6,items:[{id:"rh",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rhs",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!1},{id:"rs",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"rc",x:0,y:0,z:0,radius:.025,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]},{id:"swim",bodyParts:[{id:"torso",x:0,y:0,z:0,radius:.4,items:[{id:"bds",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"ss",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1}]},{id:"head",x:0,y:0,z:0,radius:.5,items:[{id:"hd",x:0,y:0,z:0,radius:.01,nx:0,ny:0,nz:-1,double:!0},{id:"fc",x:0,y:0,z:0,radius:.02,nx:0,ny:0,nz:-1,double:!1},{id:"ey",x:0,y:0,z:0,radius:.03,nx:0,ny:0,nz:-1,double:!1},{id:"hr",x:0,y:0,z:0,radius:.04,nx:0,ny:0,nz:-1,double:!0},{id:"hrb",x:0,y:0,z:0,radius:.05,nx:0,ny:0,nz:-1,double:!0},{id:"fa",x:0,y:0,z:0,radius:.06,nx:0,ny:0,nz:-1,double:!1},{id:"ea",x:0,y:0,z:0,radius:.07,nx:0,ny:0,nz:-1,double:!1},{id:"ha",x:0,y:0,z:0,radius:.08,nx:0,ny:0,nz:-1,double:!1},{id:"he",x:0,y:0,z:0,radius:.09,nx:0,ny:0,nz:-1,double:!1}]}]}]}},JX={partSets:{partSet:[{setType:"ri",flippedSetType:"ri"},{setType:"ri",flippedSetType:"ri"},{setType:"rh",flippedSetType:"lh"},{setType:"rhs",flippedSetType:"lhs"},{setType:"rs",swim:"0",flippedSetType:"ls"},{setType:"rc",flippedSetType:"lc"},{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"sh"},{setType:"lg"},{setType:"ch"},{setType:"cp"},{setType:"cc"},{setType:"hd"},{setType:"fc"},{setType:"ey"},{setType:"hr"},{setType:"hrb",removeSetType:"hr"},{setType:"li",flippedSetType:"li"},{setType:"lh",flippedSetType:"rh"},{setType:"lhs",flippedSetType:"rhs"},{setType:"ls",flippedSetType:"rs"},{setType:"lc",flippedSetType:"rc"},{setType:"wa"},{setType:"ea"},{setType:"ca"},{setType:"fa"},{setType:"ha"},{setType:"he"}],activePartSets:[{id:"figure",activeParts:[{setType:"rh"},{setType:"rh"},{setType:"rhs"},{setType:"rs"},{setType:"rc"},{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"sh"},{setType:"lg"},{setType:"ch"},{setType:"cp"},{setType:"cc"},{setType:"wa"},{setType:"hd"},{setType:"fc"},{setType:"ey"},{setType:"hr"},{setType:"hrb"},{setType:"lh"},{setType:"lhs"},{setType:"ls"},{setType:"lc"},{setType:"ea"},{setType:"ca"},{setType:"fa"},{setType:"ha"},{setType:"he"}]},{id:"head",activeParts:[{setType:"hd"},{setType:"fc"},{setType:"ey"},{setType:"hr"},{setType:"hrb"},{setType:"ea"},{setType:"fa"},{setType:"ha"},{setType:"he"}]},{id:"speak",activeParts:[{setType:"hd"},{setType:"hr"},{setType:"hrb"},{setType:"fc"},{setType:"fa"},{setType:"ha"}]},{id:"gesture",activeParts:[{setType:"ey"},{setType:"fc"}]},{id:"eye",activeParts:[{setType:"ey"}]},{id:"handRight",activeParts:[{setType:"rh"},{setType:"rhs"},{setType:"rs"},{setType:"rc"},{setType:"ri"}]},{id:"handRightAndHead",activeParts:[{setType:"rh"},{setType:"rhs"},{setType:"rs"},{setType:"rc"},{setType:"ri"},{setType:"ey"},{setType:"fc"},{setType:"hd"}]},{id:"handLeft",activeParts:[{setType:"lh"},{setType:"lhs"},{setType:"ls"},{setType:"lc"},{setType:"li"}]},{id:"walk",activeParts:[{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"lg"},{setType:"lh"},{setType:"lhs"},{setType:"rh"},{setType:"rhs"},{setType:"ls"},{setType:"lc"},{setType:"rs"},{setType:"rc"},{setType:"sh"}]},{id:"sit",activeParts:[{setType:"bd"},{setType:"bds"},{setType:"ss"},{setType:"lg"},{setType:"sh"},{setType:"cc"}]},{id:"itemRight",activeParts:[{setType:"ri"}]}]}},Ru=class wn extends jr{constructor(e,t,s,r){super(),this._state=wn.NOT_LOADED,this._libraryName=e,this._revision=t,this._downloadUrl=r,this._assets=s,this._animation=null,this._downloadUrl=this._downloadUrl.replace(/%libname%/gi,this._libraryName),this._downloadUrl=this._downloadUrl.replace(/%revision%/gi,this._revision),this._assets.getCollection(this._libraryName)&&(this._state=wn.LOADED)}async downloadAsset(){if(!this._assets||this._state===wn.LOADING||this._state===wn.LOADED)return;if(this._assets.getCollection(this._libraryName)){this._state=wn.LOADED,this.dispatchEvent(new al(al.DOWNLOAD_COMPLETE,this));return}if(this._state=wn.LOADING,!await this._assets.downloadAsset(this._downloadUrl))return;this._state=wn.LOADED;const s=this._assets.getCollection(this._libraryName);s&&(this._animation=s.data.animations),this.dispatchEvent(new al(al.DOWNLOAD_COMPLETE,this))}get libraryName(){return this._libraryName}get animation(){return this._animation}get isLoaded(){return this._state===wn.LOADED}};Ru.DOWNLOAD_COMPLETE="EADL_DOWNLOAD_COMPLETE";Ru.NOT_LOADED=0;Ru.LOADING=1;Ru.LOADED=2;let ZX=Ru;const s_=class Lf extends jr{constructor(e,t){super(),this._assets=e,this._structure=t,this._missingMandatoryLibs=Ue.getValue("avatar.mandatory.effect.libraries"),this._effectMap=new Map,this._effectListeners=new Map,this._incompleteEffects=new Map,this._initDownloadBuffer=[],this._pendingDownloadQueue=[],this._currentDownloads=[],this._libraryNames=[],this._isReady=!1,this.onLibraryLoaded=this.onLibraryLoaded.bind(this),this.onAvatarRenderReady=this.onAvatarRenderReady.bind(this),this.loadEffectMap(),this._structure.renderManager.events.addEventListener(pd.AVATAR_RENDER_READY,this.onAvatarRenderReady)}loadEffectMap(){const e=new XMLHttpRequest;try{e.open("GET",Ue.getValue("avatar.effectmap.url")),e.send(),e.onloadend=t=>{if(e.responseText){const s=JSON.parse(e.responseText);this.processEffectMap(s.effects),this.processMissingLibraries(),this._isReady=!0,this.dispatchEvent(new He(Lf.DOWNLOADER_READY))}},e.onerror=t=>{throw new Error("invalid_avatar_effect_map")}}catch(t){me.error(t)}}processEffectMap(e){if(e)for(const t of e){if(!t)continue;const s=t.id,r=t.lib,i=t.revision||"";if(this._libraryNames.indexOf(r)>=0)continue;this._libraryNames.push(r);const a=new ZX(r,i,this._assets,Ue.getValue("avatar.asset.effect.url"));a.addEventListener(al.DOWNLOAD_COMPLETE,this.onLibraryLoaded);let l=this._effectMap.get(s);l||(l=[]),l.push(a),this._effectMap.set(s,l)}}downloadAvatarEffect(e,t){if(!this._isReady||!this._structure.renderManager.isReady){this._initDownloadBuffer.push([e,t]);return}const s=this.getAvatarEffectPendingLibraries(e);if(s&&s.length){if(t&&!t.disposed){let r=this._effectListeners.get(e.toString());r||(r=[]),r.push(t),this._effectListeners.set(e.toString(),r)}this._incompleteEffects.set(e.toString(),s);for(const r of s)r&&this.downloadLibrary(r)}else t&&!t.disposed&&t.resetEffect(e)}onAvatarRenderReady(e){if(e){for(const[t,s]of this._initDownloadBuffer)this.downloadAvatarEffect(t,s);this._initDownloadBuffer=[]}}onLibraryLoaded(e){if(!e||!e.library)return;const t=[];this._structure.registerAnimation(e.library.animation);for(const[r,i]of this._incompleteEffects.entries()){let a=!0;for(const l of i)if(!(!l||l.isLoaded)){a=!1;break}if(a){t.push(r);const l=this._effectListeners.get(r);for(const c of l)!c||c.disposed||c.resetEffect(parseInt(r));this._effectListeners.delete(r),this.dispatchEvent(new He(Lf.LIBRARY_LOADED))}}for(const r of t)this._incompleteEffects.delete(r);let s=0;for(;s<this._currentDownloads.length;){const r=this._currentDownloads[s];r&&r.libraryName===e.library.libraryName&&this._currentDownloads.splice(s,1),s++}}processMissingLibraries(){const e=this._missingMandatoryLibs.slice();for(const t of e){if(!t)continue;const s=this._effectMap.get(t);if(s)for(const r of s)r&&this.downloadLibrary(r)}}isAvatarEffectReady(e){return!this._isReady||!this._structure.renderManager.isReady?!1:!this.getAvatarEffectPendingLibraries(e).length}getAvatarEffectPendingLibraries(e){const t=[];if(!this._structure)return t;const s=this._effectMap.get(e.toString());if(s)for(const r of s)!r||r.isLoaded||t.indexOf(r)===-1&&t.push(r);return t}downloadLibrary(e){!e||e.isLoaded||this._pendingDownloadQueue.indexOf(e)>=0||this._currentDownloads.indexOf(e)>=0||(this._pendingDownloadQueue.push(e),this.processDownloadQueue())}processDownloadQueue(){for(;this._pendingDownloadQueue.length;)this._pendingDownloadQueue[0].downloadAsset(),this._currentDownloads.push(this._pendingDownloadQueue.shift())}};s_.DOWNLOADER_READY="EADM_DOWNLOADER_READY";s_.LIBRARY_LOADED="EADM_LIBRARY_LOADED";s_.MAX_DOWNLOADS=2;let lc=s_;class $X extends nO{constructor(e,t,s,r,i){super(e,t,s,r,i,null)}isPlaceholder(){return!0}}const rP=class iP extends En{constructor(){super(),this._structure=null,this._avatarAssetDownloadManager=null,this._placeHolderFigure=null,this._figureMapReady=!1,this._effectMapReady=!1,this._actionsReady=!1,this._geometryReady=!1,this._partSetsReady=!1,this._animationsReady=!1,this._isReady=!1,this.onAvatarAssetDownloaderReady=this.onAvatarAssetDownloaderReady.bind(this),this.onAvatarAssetDownloaded=this.onAvatarAssetDownloaded.bind(this),this.onEffectAssetDownloaderReady=this.onEffectAssetDownloaderReady.bind(this),this.onEffectAssetDownloaded=this.onEffectAssetDownloaded.bind(this),this.onAvatarStructureDownloadDone=this.onAvatarStructureDownloadDone.bind(this)}onInit(){this._structure=new XX(this),this.loadGeometry(),this.loadPartSets(),this.loadActions(),this.loadAnimations(),this.loadFigureData(),this._aliasCollection=new T0(this,Fr()),this._aliasCollection.init(),this._avatarAssetDownloadManager||(this._avatarAssetDownloadManager=new ac(Fr(),this._structure),this._avatarAssetDownloadManager.addEventListener(ac.DOWNLOADER_READY,this.onAvatarAssetDownloaderReady),this._avatarAssetDownloadManager.addEventListener(ac.LIBRARY_LOADED,this.onAvatarAssetDownloaded)),this._effectAssetDownloadManager||(this._effectAssetDownloadManager=new lc(Fr(),this._structure),this._effectAssetDownloadManager.addEventListener(lc.DOWNLOADER_READY,this.onEffectAssetDownloaderReady),this._effectAssetDownloadManager.addEventListener(lc.LIBRARY_LOADED,this.onEffectAssetDownloaded)),this.checkReady()}onDispose(){this._avatarAssetDownloadManager&&(this._avatarAssetDownloadManager.removeEventListener(ac.DOWNLOADER_READY,this.onAvatarAssetDownloaderReady),this._avatarAssetDownloadManager.removeEventListener(ac.LIBRARY_LOADED,this.onAvatarAssetDownloaded)),this._effectAssetDownloadManager&&(this._effectAssetDownloadManager.removeEventListener(lc.DOWNLOADER_READY,this.onEffectAssetDownloaderReady),this._effectAssetDownloadManager.removeEventListener(lc.LIBRARY_LOADED,this.onEffectAssetDownloaded))}loadGeometry(){this._structure&&(this._structure.initGeometry(QX.geometry),this._geometryReady=!0,this.checkReady())}loadPartSets(){this._structure&&(this._structure.initPartSets(JX.partSets),this._partSetsReady=!0,this.checkReady())}loadActions(){const e=Ue.getValue("avatar.default.actions");e&&this._structure.initActions(Fr(),e);const t=new XMLHttpRequest;try{t.open("GET",Ue.getValue("avatar.actions.url")),t.send(),t.onloadend=s=>{this._structure&&(this._structure.updateActions(JSON.parse(t.responseText)),this._actionsReady=!0,this.checkReady())},t.onerror=s=>{throw new Error("invalid_avatar_actions")}}catch(s){me.error(s)}}loadAnimations(){this._structure&&(this._structure.initAnimation(qX.animations),this._animationsReady=!0,this.checkReady())}loadFigureData(){const e=Ue.getValue("avatar.default.figuredata");if(!e||typeof e=="string"){me.error("XML figuredata is no longer supported");return}this._structure&&this._structure.initFigureData(e),new Np(Ue.getValue("avatar.figuredata.url"),this._structure.figureData).addEventListener(Np.AVATAR_STRUCTURE_DONE,this.onAvatarStructureDownloadDone)}onAvatarStructureDownloadDone(e){this._structureReady=!0,this._structure.init(),this.checkReady()}onAvatarAssetDownloaderReady(e){e&&(this._figureMapReady=!0,this.checkReady())}onAvatarAssetDownloaded(e){e&&this._aliasCollection.reset()}onEffectAssetDownloaderReady(e){e&&(this._effectMapReady=!0,this.checkReady())}onEffectAssetDownloaded(e){e&&this._aliasCollection.reset()}checkReady(){this._isReady||!this._geometryReady||!this._partSetsReady||!this._actionsReady||!this._animationsReady||!this._figureMapReady||!this._effectMapReady||!this._structureReady||(this._isReady=!0,this.events&&this.events.dispatchEvent(new He(pd.AVATAR_RENDER_READY)))}createFigureContainer(e){return new Mc(e)}isFigureContainerReady(e){return this._avatarAssetDownloadManager?this._avatarAssetDownloadManager.isAvatarFigureContainerReady(e):!1}createAvatarImage(e,t,s,r=null,i=null){if(!this._structure||!this._avatarAssetDownloadManager)return null;const a=new Mc(e);return s&&this.validateAvatarFigure(a,s),this._avatarAssetDownloadManager.isAvatarFigureContainerReady(a)?new nO(this._structure,this._aliasCollection,a,t,this._effectAssetDownloadManager,i):(this._placeHolderFigure||(this._placeHolderFigure=new Mc(iP.DEFAULT_FIGURE)),this._avatarAssetDownloadManager.downloadAvatarFigure(a,r),new $X(this._structure,this._aliasCollection,this._placeHolderFigure,t,this._effectAssetDownloadManager))}downloadAvatarFigure(e,t){this._avatarAssetDownloadManager&&this._avatarAssetDownloadManager.downloadAvatarFigure(e,t)}validateAvatarFigure(e,t){let s=!1;const r=this._structure.getMandatorySetTypeIds(t,2);if(r){const i=this._structure.figureData;for(const a of r)if(e.hasPartType(a)){const l=i.getSetType(a);if(l&&!l.getPartSet(e.getPartSetId(a))){const u=this._structure.getDefaultPartSet(a,t);u&&(e.updatePart(a,u.id,[0]),s=!0)}}else{const l=this._structure.getDefaultPartSet(a,t);l&&(e.updatePart(a,l.id,[0]),s=!0)}}return!s}getFigureClubLevel(e,t,s=null){if(!this._structure)return 0;const r=this._structure.figureData,i=Array.from(e.getPartTypeIds());let a=0;for(const l of i){const c=r.getSetType(l);if(!c)continue;const u=e.getPartSetId(l),h=c.getPartSet(u);if(h){a=Math.max(h.clubLevel,a);const d=r.getPalette(c.paletteID),f=e.getPartColorIds(l);for(const E of f){const m=d.getColor(E);m&&(a=Math.max(m.clubLevel,a))}}}s||(s=this._structure.getBodyPartsUnordered(bs.FULL));for(const l of s){const c=r.getSetType(l);c&&i.indexOf(l)===-1&&(a=Math.max(c.optionalFromClubLevel(t),a))}return a}isValidFigureSetForGender(e,t){const r=this.structureData.getFigurePartSet(e);return!!(r&&(r.gender.toUpperCase()==="U"||r.gender.toUpperCase()===t.toUpperCase()))}getFigureStringWithFigureIds(e,t,s){const r=new B0;r.loadAvatarData(e,t);const i=this.resolveFigureSets(s);for(const a of i)r.savePartData(a.type,a.id,r.getColourIds(a.type));return r.getFigureString()}resolveFigureSets(e){const t=this.structureData,s=[];for(const r of e){const i=t.getFigurePartSet(r);i&&s.push(i)}return s}getMandatoryAvatarPartSetIds(e,t){return this._structure?this._structure.getMandatorySetTypeIds(e,t):null}getAssetByName(e){return this._aliasCollection.getAsset(e)}get assets(){return Fr()}get isReady(){return this._isReady}get structure(){return this._structure}get structureData(){return this._structure?this._structure.figureData:null}get downloadManager(){return this._avatarAssetDownloadManager}};rP.DEFAULT_FIGURE="hd-99999-99999";let e6=rP;class Oh{constructor(e,t,s){this._layerId=e,this._partId=t,this._paletteId=s}get layerId(){return this._layerId}set layerId(e){this._layerId=e}get partId(){return this._partId}set partId(e){this._partId=e}get paletteId(){return this._paletteId}set paletteId(e){this._paletteId=e}}class gn{constructor(e){this._typeId=this.getTypeId(e),this._paletteId=this.getPaletteId(e),this._color=this.getColor(e),this._headOnly=this.getHeadOnly(e);const t=this.getCustomData(e);this._customLayerIds=this.getCustomLayerIds(t),this._customPartIds=this.getCustomPartIds(t),this._customPaletteIds=this.getCustomPaletteIds(t),this._customParts=[];let s=0;for(;s<this._customLayerIds.length;)this._customParts.push(new Oh(this._customLayerIds[s],this._customPartIds[s],this._customPaletteIds[s])),s++}get typeId(){return this._typeId}get paletteId(){return this._paletteId}get color(){return this._color}get customLayerIds(){return this._customLayerIds}get customPartIds(){return this._customPartIds}get customPaletteIds(){return this._customPaletteIds}get customParts(){return this._customParts}getCustomPart(e){if(this._customParts){for(const t of this._customParts)if(t.layerId===e)return t}return null}get hasCustomParts(){return this._customLayerIds!=null&&this._customLayerIds.length>0}get headOnly(){return this._headOnly}get figureString(){let e=this.typeId+" "+this.paletteId+" "+this.color.toString(16);e=e+(" "+this.customParts.length);for(const t of this.customParts)e=e+(" "+t.layerId+" "+t.partId+" "+t.paletteId);return e}getCustomData(e){let t=[];if(e){const s=e.split(" "),r=this._headOnly?1:0,i=4+r;if(s.length>i){const a=3+r,l=parseInt(s[a]);t=s.slice(i,i+l*3)}}return t}getCustomLayerIds(e){const t=[];let s=0;for(;s<e.length;)t.push(parseInt(e[s+0])),s=s+3;return t}getCustomPartIds(e){const t=[];let s=0;for(;s<e.length;)t.push(parseInt(e[s+1])),s=s+3;return t}getCustomPaletteIds(e){const t=[];let s=0;for(;s<e.length;)t.push(parseInt(e[s+2])),s=s+3;return t}getTypeId(e){if(e){const t=e.split(" ");if(t.length>=1)return parseInt(t[0])}return 0}getPaletteId(e){if(e){const t=e.split(" ");if(t.length>=2)return parseInt(t[1])}return 0}getColor(e){if(e){const t=e.split(" ");if(t.length>=3)return parseInt(t[2],16)}return 16777215}getHeadOnly(e){if(e){const t=e.split(" ");if(t.length>=4)return t[3]==="head"}return!1}}class r_{constructor(e){this._complete=!0,this._target=e}get running(){return this._running&&!!this._target}get complete(){return this._complete}set target(e){this._target=e}get target(){return this._target}set tag(e){this._tag=e}get tag(){return this._tag}start(){this._running=!0}update(e){}stop(){this._target=null,this._running=!1}tick(e){}}class t6 extends r_{constructor(e){super(e)}tick(e){super.tick(e),this.target&&(this.target.remove(),this.target=null)}}class jE extends r_{constructor(e,t){super(e),this._complete=!1,this._duration=t}get duration(){return this._duration}start(){super.start(),this._complete=!1,this._startTimeMs=ve()}tick(e){super.tick(e);const t=(e-this._startTimeMs)/this._duration;t<1?this.update(t):(this.update(1),this._complete=!0)}}class s6 extends jE{constructor(e,t,s){super(e,t),this._height=s}start(){super.start(),this._offset=0,this.target.style.top=this._offset-this._height+"px"}update(e){super.update(e),this.target.style.top=this._offset-this._height+this.getBounceOffset(e)*this._height+"px"}getBounceOffset(e){return e<.364?7.5625*e*e:e<.727?(e=e-.545,7.5625*e*e+.75):e<.909?(e=e-.9091,7.5625*e*e+.9375):(e=e-.955,7.5625*e*e+.984375)}stop(){this.target.style.top=this._offset+"px",super.stop()}}class r6 extends jE{constructor(e){super(e.target,e.duration),this._interval=e}start(){super.start(),this._interval.start()}update(e){super.update(e),this._interval.update(e)}stop(){super.stop(),this._interval.stop()}}class i6 extends r6{constructor(e,t){super(e),this._rate=t}}class n6 extends i6{constructor(e,t){super(e,t)}update(e){this._interval.update(Math.pow(e,1/this._rate))}}class a6 extends jE{constructor(e,t,s,r,i,a){super(e,t),this._deltaX=s,this._deltaY=r,this._height=-i,this._numJumps=a}start(){super.start(),this._startX=this.target.offsetLeft,this._startY=this.target.offsetTop}update(e){super.update(e),this.target.style.left=this._startX+this._deltaX*e+"px",this.target.style.top=this._startY+this._height*Math.abs(Math.sin(e*Math.PI*this._numJumps))+this._deltaY*e+"px"}}const tc=class Xe{static get TIMER_TIME(){return 1e3/UU()}static runMotion(e){return Xe._RUNNING_MOTIONS.indexOf(e)===-1&&Xe._QUEUED_MOTIONS.indexOf(e)===-1&&(Xe._IS_UPDATING?Xe._QUEUED_MOTIONS.push(e):(Xe._RUNNING_MOTIONS.push(e),e.start()),Xe.startTimer()),e}static removeMotion(e){let t=Xe._RUNNING_MOTIONS.indexOf(e);t>-1?Xe._IS_UPDATING?(t=Xe._REMOVED_MOTIONS.indexOf(e),t==-1&&Xe._REMOVED_MOTIONS.push(e)):(Xe._RUNNING_MOTIONS.splice(t,1),e.running&&e.stop(),Xe._RUNNING_MOTIONS.length||Xe.stopTimer()):(t=Xe._QUEUED_MOTIONS.indexOf(e),t>-1&&Xe._QUEUED_MOTIONS.splice(t,1))}static getMotionByTag(e){for(const t of Xe._RUNNING_MOTIONS)if(t.tag==e)return t;for(const t of Xe._QUEUED_MOTIONS)if(t.tag==e)return t;return null}static getMotionByTarget(e){for(const t of Xe._RUNNING_MOTIONS)if(t.target==e)return t;for(const t of Xe._QUEUED_MOTIONS)if(t.target==e)return t;return null}static getMotionByTagAndTarget(e,t){for(const s of Xe._RUNNING_MOTIONS)if(s.tag==e&&s.target==t)return s;for(const s of Xe._QUEUED_MOTIONS)if(s.tag==e&&s.target==t)return s;return null}static get isRunning(){return!!Xe._TIMER}static get isUpdating(){return Xe._IS_UPDATING}static onTick(){Xe._IS_UPDATING=!0;const e=ve();let t=null;for(;t=Xe._QUEUED_MOTIONS.pop();)Xe._RUNNING_MOTIONS.push(t);for(;t=Xe._REMOVED_MOTIONS.pop();)Xe._RUNNING_MOTIONS.splice(Xe._RUNNING_MOTIONS.indexOf(t),1),t.running&&t.stop();for(t of Xe._RUNNING_MOTIONS)t.running?(t.tick(e),t.complete&&Xe.removeMotion(t)):Xe.removeMotion(t);Xe._RUNNING_MOTIONS.length||Xe.stopTimer(),Xe._IS_UPDATING=!1}static startTimer(){Xe._TIMER||(Xe._TIMER=setInterval(Xe.onTick,Xe.TIMER_TIME))}static stopTimer(){Xe._TIMER&&(clearInterval(Xe._TIMER),Xe._TIMER=null)}getNumRunningMotions(e){let t=0;for(const s of Xe._RUNNING_MOTIONS)s.target===e&&t++;return t}};tc._QUEUED_MOTIONS=[];tc._RUNNING_MOTIONS=[];tc._REMOVED_MOTIONS=[];tc._TIMER=null;tc._IS_UPDATING=!1;let w_=tc;class Wp extends r_{constructor(...e){super(e?e[0].target:null),this._queue=[];for(const t of e)this._queue.push(t);this._motion=e[0],this._complete=!this._motion}get running(){return this._running&&this._motion?this._motion.running:!1}start(){super.start(),this._motion.start()}update(e){super.update(e),this._motion.running&&this._motion.update(e)}stop(){super.stop(),this._motion.stop()}tick(e){if(super.tick(e),this._motion.tick(e),this._motion.complete){this._motion.stop();const t=this._queue.indexOf(this._motion);t<this._queue.length-1?(this._motion=this._queue[t+1],this._target=this._motion.target,this._motion.start()):this._complete=!0}}}class o6 extends r_{constructor(e){super(null),this._waitTimeMs=e}get running(){return this._running}start(){super.start(),this._complete=!1,this._startTimeMs=ve()}tick(e){super.tick(e),this._complete=e-this._startTimeMs>=this._waitTimeMs,this._complete&&this.stop()}}function ze(){return pe.instance}function Cs(n){ze().addLinkEventTracker(n)}function fs(){return ze().avatar}function Yp(n){return fs().structureData.getPalette(n)}function zp(n){return fs().structureData.getSetType(n)}function vc(){return ze().cameraManager}function l6(){return ze().core}function c6(){return l6().configuration}function de(n){n=n.startsWith("event:")?n.substring(6):n,ze().createLinkEvent(n)}function Wc(){var n;return(n=ze())==null?void 0:n.communication}function ce(n,e=null){return Ue.getValue(n,e)}function Uf(){var n;return(n=Wc())==null?void 0:n.connection}function nP(){return ze().localization}const Ou=n=>{!n||!n.length||(n.startsWith("http")?ra.openWebPage(n):de(n))};function As(n){ze().removeLinkEventTracker(n)}function ee(){return ze().roomEngine}let G_=!1,xu=0,wu=0;const Gu=(n,e=1)=>{const t=n.clientX,s=n.clientY;let r=n.type;switch(r===ie.MOUSE_CLICK&&(xu&&(wu=1,xu>=Date.now()-300&&wu++),xu=Date.now(),wu===2&&(G_||(r=ie.DOUBLE_CLICK),wu=0,xu=null)),r){case ie.MOUSE_CLICK:break;case ie.DOUBLE_CLICK:break;case ie.MOUSE_MOVE:G_=!0;break;case ie.MOUSE_DOWN:G_=!1;break;case ie.MOUSE_UP:break;case ie.RIGHT_CLICK:break;default:return}ee().dispatchMouseEvent(e,t,s,r,n.altKey,n.ctrlKey||n.metaKey,n.shiftKey,!1)};let B_=!1,Bu=0,ku=0;const Vu=(n,e=1,t=!1,s=!1,r=!1,i=!1)=>{let a=0,l=0;n.touches[0]?(a=n.touches[0].clientX,l=n.touches[0].clientY):n.changedTouches[0]&&(a=n.changedTouches[0].clientX,l=n.changedTouches[0].clientY);let c=n.type;switch(t&&(c=Ks.TOUCH_LONG),(c===ie.MOUSE_CLICK||c===Ks.TOUCH_END)&&(c=ie.MOUSE_CLICK,Bu&&(ku=1,Bu>=Date.now()-300&&ku++),Bu=Date.now(),ku===2&&(B_||(c=ie.DOUBLE_CLICK),ku=0,Bu=null)),c){case ie.MOUSE_CLICK:break;case ie.DOUBLE_CLICK:break;case Ks.TOUCH_START:c=ie.MOUSE_DOWN,B_=!1;break;case Ks.TOUCH_MOVE:c=ie.MOUSE_MOVE,B_=!0;break;case Ks.TOUCH_END:c=ie.MOUSE_UP;break;case Ks.TOUCH_LONG:c=ie.MOUSE_DOWN_LONG;break;default:return}c===Ks.TOUCH_START&&ee().dispatchMouseEvent(e,a,l,c,s,r,i,!1),ee().dispatchMouseEvent(e,a,l,c,s,r,i,!1)};function tr(n){if(!n||!n.model)return!1;const e=$().userId,t=n.model.getValue(C.FURNITURE_OWNER_ID);return e===t}function Yc(n,e,t){return n?n.isRoomOwner||n.controllerLevel>=ct.GUEST||$().isModerator||tr(ee().getRoomObject(n.roomId,e,t)):!1}function wo(){return ze().roomSessionManager}function po(n,e=null){wo().createSession(n,e)}function u6(){const n=Go();return n?n.model.getValue(C.FIGURE_CAN_STAND_UP):fe.POSTURE_STAND}function k_(){const n=Go();if(!n)return!1;const t=n.model.getValue(C.FIGURE_EFFECT);return!(t===29||t===30||t===185)}function $(){return ze().sessionDataManager}function Qr(){return ce("hc.disabled",!1)?_r.VIP:$().clubLevel}class Lr{}Lr.OKAY=0;Lr.MISSING_OFFER=1;Lr.FURNI_LIMIT_REACHED=2;Lr.NOT_IN_ROOM=3;Lr.NOT_ROOM_OWNER=4;Lr.GUILD_ROOM=5;Lr.VISITORS_IN_ROOM=6;class h6{constructor(e,t,s){this._depth=0,this._localization="",this._pageId=-1,this._pageName="",this._iconId=0,this._depth=t,this._parent=s,this._localization=e.localization,this._pageId=e.pageId,this._pageName=e.pageName,this._iconId=e.icon,this._children=[],this._offerIds=e.offerIds,this._isVisible=e.visible,this._isActive=!1,this._isOpen=!1}activate(){this._isActive=!0}deactivate(){this._isActive=!1}open(){this._isOpen=!0}close(){this._isOpen=!1}addChild(e){e&&this._children.push(e)}get depth(){return this._depth}get isBranch(){return this._children.length>0}get isLeaf(){return this._children.length===0}get localization(){return this._localization}get pageId(){return this._pageId}get pageName(){return this._pageName}get iconId(){return this._iconId}get children(){return this._children}get offerIds(){return this._offerIds}get parent(){return this._parent}get isVisible(){return this._isVisible}get isActive(){return this._isActive}get isOpen(){return this._isOpen}}const aP=class oP{constructor(e,t,s,r,i,a=-1){this._pageId=e,this._layoutCode=t,this._localization=s,this._offers=r,this._acceptSeasonCurrencyAsCredits=i;for(const l of r)l.page=this;a===-1?this._mode=oP.MODE_NORMAL:this._mode=a}get pageId(){return this._pageId}get layoutCode(){return this._layoutCode}get localization(){return this._localization}get offers(){return this._offers}get acceptSeasonCurrencyAsCredits(){return this._acceptSeasonCurrencyAsCredits}get mode(){return this._mode}};aP.MODE_NORMAL=0;let lP=aP;class ss{}ss.DUCKET_INFO="ducket_info";ss.CREDITS="credits";ss.AVATAR_EFFECTS="avatar_effects";ss.HC_MEMBERSHIP="hc_membership";ss.CLUB_GIFTS="club_gifts";ss.LIMITED_SOLD="limited_sold";ss.PET_ACCESSORIES="pet_accessories";ss.TRAX_SONGS="trax_songs";ss.NEW_ADDITIONS="new_additions";ss.QUEST_SHELL="quest_shell";ss.QUEST_SNOWFLAKES="quest_snowflakes";ss.VAL_QUESTS="val_quests";ss.GUILD_CUSTOM_FURNI="guild_custom_furni";ss.GIFT_SHOP="gift_shop";ss.HORSE_STYLES="horse_styles";ss.HORSE_SHOE="horse_shoe";ss.SET_EASTER="set_easter";ss.ECOTRON_TRANSFORM="ecotron_transform";ss.LOYALTY_INFO="loyalty_info";ss.ROOM_BUNDLES="room_bundles";ss.ROOM_BUNDLES_MOBILE="room_bundles_mobile";ss.HABBO_CLUB_DESKTOP="habbo_club_desktop";ss.MOBILE_SUBSCRIPTIONS="mobile_subscriptions";class d6{constructor(e,t){this.breed=e,this.palettes=t}}class Nt{}Nt.NONE=0;Nt.CONFIRM=1;Nt.PURCHASE=2;Nt.NO_CREDITS=3;Nt.NO_POINTS=4;Nt.SOLD_OUT=5;Nt.FAILED=6;class ci{}ci.NORMAL="NORMAL";ci.BUILDER="BUILDERS_CLUB";const _6=n=>"",g6=n=>"",Kp=(n,e)=>{const t=n.get(e),s=[];if(t&&t.length)for(const r of t)r.isVisible&&s.push(r);return s},cP=(n,e,t,s)=>{if(t.isVisible&&t.pageId>0){let r=!1;const i=[t.pageName,t.localization].join(" ").toLowerCase().replace(/ /gi,"");if(i.indexOf(n)>-1&&(s.push(t),r=!0),!r){for(const a of e)if(i.indexOf(a)>=0){s.push(t);break}}}for(const r of t.children)cP(n,e,r,s)};function f6(n){if(!n.length)return 0;let e=n.length-1;for(;e>=0&&!isNaN(parseInt(n.charAt(e)));)e--;return e>0?parseInt(n.substring(e+1)):-1}function m6(n,e){switch(n){case 0:return[[16743226],[16750435],[16764339],[16094464],[16498012],[16704690],[15586304],[16115545],[16513201],[8694111],[11585939],[14413767],[6664599],[9553845],[12971486],[8358322],[10002885],[13292268],[10780600],[12623573],[14403561],[12418717],[14327229],[15517403],[14515069],[15764368],[16366271],[11250603],[13948116],[16777215],[14256481],[14656129],[15848130],[14005087],[14337152],[15918540],[15118118],[15531929],[9764857],[11258085]];case 1:return[[16743226],[16750435],[16764339],[16094464],[16498012],[16704690],[15586304],[16115545],[16513201],[8694111],[11585939],[14413767],[6664599],[9553845],[12971486],[8358322],[10002885],[13292268],[10780600],[12623573],[14403561],[12418717],[14327229],[15517403],[14515069],[15764368],[16366271],[11250603],[13948116],[16777215],[14256481],[14656129],[15848130],[14005087],[14337152],[15918540],[15118118],[15531929],[9764857],[11258085]];case 2:return[[16579283],[15378351],[8830016],[15257125],[9340985],[8949607],[6198292],[8703620],[9889626],[8972045],[12161285],[13162269],[8620113],[12616503],[8628101],[13827840],[9764857]];case 3:return[[16777215],[15658734],[14540253]];case 4:return[[16777215],[16053490],[15464440],[16248792],[15396319],[15007487]];case 5:return[[16777215],[15658734],[14540253]];case 6:return[[16777215],[15658734],[14540253],[16767177],[16770205],[16751331]];case 7:return[[13421772],[11447982],[16751331],[10149119],[16763290],[16743786]];default:{const t=[];for(const s of e){const r=ee().getPetColorResult(n,s.paletteId);r&&(r.primaryColor===r.secondaryColor?t.push([r.primaryColor]):t.push([r.primaryColor,r.secondaryColor]))}return t}}}class Pe{}Pe.WALL="i";Pe.FLOOR="s";Pe.EFFECT="e";Pe.HABBO_CLUB="h";Pe.BADGE="b";Pe.GAME_TOKEN="GAME_TOKEN";Pe.PET="p";Pe.ROBOT="r";const uP=class hP{constructor(e,t,s,r,i,a,l=!1,c=0,u=0){this._productType=e.toLowerCase(),this._productClassId=t,this._extraParam=s,this._productCount=r,this._productData=i,this._furnitureData=a,this._isUniqueLimitedItem=l,this._uniqueLimitedItemSeriesSize=c,this._uniqueLimitedItemsLeft=u}static stripAddonProducts(e){return e.length===1?e:e.filter(t=>t.productType!==Pe.BADGE&&t.productType!==Pe.EFFECT&&t.productClassId!==hP.EFFECT_CLASSID_NINJA_DISAPPEAR)}getIconUrl(e=null,t=null){switch(this._productType){case Pe.FLOOR:return ee().getFurnitureFloorIconUrl(this.productClassId);case Pe.WALL:{if(e&&this._furnitureData){let s="";switch(this._furnitureData.className){case"floor":s=["th",this._furnitureData.className,e.product.extraParam].join("_");break;case"wallpaper":s=["th","wall",e.product.extraParam].join("_");break;case"landscape":s=["th",this._furnitureData.className,(e.product.extraParam||"").replace(".","_"),"001"].join("_");break}if(s!=="")return`${ce("catalog.asset.url")}/${s}.png`}return ee().getFurnitureWallIconUrl(this.productClassId,this._extraParam)}case Pe.EFFECT:return _6(this.productClassId);case Pe.HABBO_CLUB:return g6(this.productClassId);case Pe.BADGE:return $().getBadgeUrl(this._extraParam);case Pe.ROBOT:return null}return null}get productType(){return this._productType}get productClassId(){return this._productClassId}get extraParam(){return this._extraParam}set extraParam(e){this._extraParam=e}get productCount(){return this._productCount}get productData(){return this._productData}get furnitureData(){return this._furnitureData}get isUniqueLimitedItem(){return this._isUniqueLimitedItem}get uniqueLimitedItemSeriesSize(){return this._uniqueLimitedItemSeriesSize}get uniqueLimitedItemsLeft(){return this._uniqueLimitedItemsLeft}set uniqueLimitedItemsLeft(e){this._uniqueLimitedItemsLeft=e}};uP.EFFECT_CLASSID_NINJA_DISAPPEAR=108;let Tl=uP;const On=class rn{constructor(e,t,s,r,i,a,l,c,u,h){this._clubLevel=0,this._bundlePurchaseAllowed=!1,this._offerId=e,this._localizationId=t,this._isRentOffer=s,this._priceInCredits=r,this._priceInActivityPoints=i,this._activityPointType=a,this._giftable=l,this._clubLevel=c,this._products=u,this._bundlePurchaseAllowed=h,this.setPricingModelForProducts(),this.setPricingType();for(const d of u)if(d.productType===Pe.BADGE){this._badgeCode=d.extraParam;break}}activate(){}get clubLevel(){return this._clubLevel}get page(){return this._page}set page(e){this._page=e}get offerId(){return this._offerId}get localizationId(){return this._localizationId}get priceInCredits(){return this._priceInCredits}get priceInActivityPoints(){return this._priceInActivityPoints}get activityPointType(){return this._activityPointType}get giftable(){return this._giftable}get product(){if(!this._products||!this._products.length)return null;if(this._products.length===1)return this._products[0];const e=Tl.stripAddonProducts(this._products);return e.length?e[0]:null}get pricingModel(){return this._pricingModel}get priceType(){return this._priceType}get bundlePurchaseAllowed(){return this._bundlePurchaseAllowed}get isRentOffer(){return this._isRentOffer}get badgeCode(){return this._badgeCode}get localizationName(){const e=Rl(this._localizationId);return e?e.name:p(this._localizationId)}get localizationDescription(){const e=Rl(this._localizationId);return e?e.description:p(this._localizationId)}get isLazy(){return!1}get products(){return this._products}setPricingModelForProducts(){const e=Tl.stripAddonProducts(this._products);e.length===1?e[0].productCount===1?this._pricingModel=rn.PRICING_MODEL_SINGLE:this._pricingModel=rn.PRICING_MODEL_MULTI:e.length>1?this._pricingModel=rn.PRICING_MODEL_BUNDLE:this._pricingModel=rn.PRICING_MODEL_UNKNOWN}setPricingType(){this._priceInCredits>0&&this._priceInActivityPoints>0?this._priceType=rn.PRICE_TYPE_CREDITS_ACTIVITYPOINTS:this._priceInCredits>0?this._priceType=rn.PRICE_TYPE_CREDITS:this._priceInActivityPoints>0?this._priceType=rn.PRICE_TYPE_ACTIVITYPOINTS:this._priceType=rn.PRICE_TYPE_NONE}clone(){const e=[],t=Rl(this.localizationId);for(const r of this._products){const i=Ff(r.productClassId,r.productType);e.push(new Tl(r.productType,r.productClassId,r.extraParam,r.productCount,t,i))}const s=new rn(this.offerId,this.localizationId,this.isRentOffer,this.priceInCredits,this.priceInActivityPoints,this.activityPointType,this.giftable,this.clubLevel,e,this.bundlePurchaseAllowed);return s.page=this.page,s}};On.PRICING_MODEL_UNKNOWN="pricing_model_unknown";On.PRICING_MODEL_SINGLE="pricing_model_single";On.PRICING_MODEL_MULTI="pricing_model_multi";On.PRICING_MODEL_BUNDLE="pricing_model_bundle";On.PRICING_MODEL_FURNITURE="pricing_model_furniture";On.PRICE_TYPE_NONE="price_type_none";On.PRICE_TYPE_CREDITS="price_type_credits";On.PRICE_TYPE_ACTIVITYPOINTS="price_type_activitypoints";On.PRICE_TYPE_CREDITS_ACTIVITYPOINTS="price_type_credits_and_activitypoints";let or=On;class E6{constructor(e){this._furniData=e,this._product=new Tl(this._furniData.type,this._furniData.id,this._furniData.customParams,1,Rl(this._furniData.className),this._furniData)}activate(){V(new ey(this._furniData.rentOfferId>-1?this._furniData.rentOfferId:this._furniData.purchaseOfferId))}get offerId(){return this.isRentOffer?this._furniData.rentOfferId:this._furniData.purchaseOfferId}get priceInActivityPoints(){return 0}get activityPointType(){return 0}get priceInCredits(){return 0}get page(){return this._page}set page(e){this._page=e}get priceType(){return""}get product(){return this._product}get products(){return[this._product]}get localizationId(){return"roomItem.name."+this._furniData.id}get bundlePurchaseAllowed(){return!1}get isRentOffer(){return this._furniData.rentOfferId>-1}get giftable(){return!1}get pricingModel(){return or.PRICING_MODEL_FURNITURE}get clubLevel(){return 0}get badgeCode(){return""}get localizationName(){return this._furniData.name}get localizationDescription(){return this._furniData.description}get isLazy(){return!0}}const p6=(n,e,t=null)=>{let s=null;switch(n.toLocaleLowerCase()){case Pe.FLOOR:s=ee().getFurnitureFloorIconUrl(e);break;case Pe.WALL:s=ee().getFurnitureWallIconUrl(e,t);break}return s};class I6{constructor(e){this._isEnabled=!1,this._price=null,this._stuffTypes=null,this._boxTypes=null,this._ribbonTypes=null,this._defaultStuffTypes=null,this._isEnabled=e.isEnabled,this._price=e.price,this._boxTypes=e.boxTypes,this._ribbonTypes=e.ribbonTypes,this._stuffTypes=e.giftWrappers,this._defaultStuffTypes=e.giftFurnis}get isEnabled(){return this._isEnabled}get price(){return this._price}get stuffTypes(){return this._stuffTypes}get boxTypes(){return this._boxTypes}get ribbonTypes(){return this._ribbonTypes}get defaultStuffTypes(){return this._defaultStuffTypes}}class Su{constructor(e,t,s,r,i,a,l,c,u=-1){this._timeLeftMinutes=-1,this._offerId=e,this._furniId=t,this._furniType=s,this._extraData=r,this._stuffData=i,this._price=a,this._status=l,this._averagePrice=c,this._offerCount=u}get offerId(){return this._offerId}set offerId(e){this._offerId=e}get furniId(){return this._furniId}get furniType(){return this._furniType}get extraData(){return this._extraData}get stuffData(){return this._stuffData}get price(){return this._price}set price(e){this._price=e}get averagePrice(){return this._averagePrice}get image(){return this._image}set image(e){this._image=e}get imageCallback(){return this._imageCallback}set imageCallback(e){this._imageCallback=e}get status(){return this._status}get timeLeftMinutes(){return this._timeLeftMinutes}set timeLeftMinutes(e){this._timeLeftMinutes=e}get offerCount(){return this._offerCount}set offerCount(e){this._offerCount=e}get isUniqueLimitedItem(){return this.stuffData&&this.stuffData.uniqueSeries>0}}Su.TYPE_FLOOR=1;Su.TYPE_WALL=2;class No{}No.ONGOING=1;No.ONGOING_OWN=1;No.SOLD=2;No.EXPIRED=3;class Ys{}Ys.BY_ACTIVITY=1;Ys.BY_VALUE=2;Ys.ADVANCED=3;class dP{constructor(e,t){this._images=e,this._texts=t}getText(e){let t=this._texts[e]||"";return t&&t.length&&(t=t.replace(/\r\n|\r|\n/g,"<br />")),t}getImage(e){const t=this._images[e]||"";if(!t||!t.length)return null;let s=ce("catalog.asset.image.url");return s=s.replace("%name%",t),s}}class T6{constructor(e,t,s,r,i,a,l,c){this.roomId=e,this.objectId=t,this.category=s,this.wallLocation=r,this.x=i,this.y=a,this.direction=l,this.offer=c}get offerId(){return this.offer.offerId}get productClassId(){return this.offer.product.productClassId}get productData(){return this.offer.product.productData}get furniData(){return this.offer.product.furnitureData}get extraParam(){return this.offer.product.extraParam}}const Cu=class il{constructor(){this._requestType=il.REQUEST_TYPE_NONE}resetRequest(){this._requestType=il.REQUEST_TYPE_NONE,this._requestById=-1,this._requestedByOfferId=-1,this._requestByName=null}get requestType(){return this._requestType}get requestById(){return this._requestById}set requestById(e){this._requestType=il.REQUEST_TYPE_ID,this._requestById=e}get requestedByOfferId(){return this._requestedByOfferId}set requestedByOfferId(e){this._requestType=il.REQUEST_TYPE_OFFER,this._requestedByOfferId=e}get requestByName(){return this._requestByName}set requestByName(e){this._requestType=il.REQUEST_TYPE_NAME,this._requestByName=e}};Cu.REQUEST_TYPE_NONE=0;Cu.REQUEST_TYPE_ID=1;Cu.REQUEST_TYPE_OFFER=2;Cu.REQUEST_TYPE_NAME=3;let cc=Cu;class R6{constructor(e,t,s){this.searchValue=e,this.offers=t,this.filteredNodes=s}}function Ff(n,e){let t=null;switch(e.toLowerCase()){case Pe.FLOOR:t=$().getFloorItemData(n);break;case Pe.WALL:t=$().getWallItemData(n);break}return t}function i_(n,e,t){const s=ee().getRoomObject(n,e,t);if(!s)return;const r=s.model.getValue(C.FURNITURE_TYPE_ID);switch(t){case k.FLOOR:return $().getFloorItemData(r);case k.WALL:return $().getWallItemData(r)}return null}function O6(){const n=Go();return n?n.model.getValue(C.FIGURE_POSTURE):fe.POSTURE_STAND}function Rl(n){return n?$().getProductData(n):null}function at(){return wo().getSession(-1)}function xf(){V(new hy)}function Io(){return $().clubLevel>=_r.CLUB}function Hu(){return $().clubLevel>=_r.VIP}function S6(n){const e=ee().getRoomObject(at().roomId,n,k.FLOOR);if(!e||!e.model)return!1;const t=$().userId,s=e.model.getValue(C.FURNITURE_OWNER_ID);return t===s}function C6(){const n=Go();return n?n.model.getValue(C.FIGURE_EFFECT)===77:!1}function A6(n){wo().startSession(n)}const N6=()=>{at()&&(xf(),wo().removeSession(-1))};function Go(){const n=$().userId,e=ee().activeRoomId,t=k.UNIT,s=ee().getTotalObjectsForManager(e,t);let r=0;for(;r<s;){const i=ee().getRoomObjectByIndex(e,r,t);if(i){const a=at().userDataManager.getUserDataByIndex(i.id);if(a&&a.webID===n)return i}r++}return null}const WE=(n,e,t,s=1)=>{const r=ee().getRoomObjectBoundingRectangle(n,e,t,s);return r?(r.x=Math.round(r.x),r.y=Math.round(r.y),r):null},_P=(n,e,t,s=1)=>{const r=ee().getRoomObjectScreenLocation(n,e,t,s);return r?(r.x=Math.round(r.x),r.y=Math.round(r.y),r):null},y6=(n,e,t=1)=>{const s=ee(),r=s.activeRoomId;s.initializeRoomInstanceRenderingCanvas(r,t,n,e)};function M6(n){let e=!1;const t=ee().getRoomObject(n.roomId,n.objectId,n.category);return t&&t.model.getValue(C.FURNITURE_SELECTION_DISABLED)===1&&(e=!0,$().isModerator&&(e=!1)),e}function dl(n,e,t){ee().processRoomObjectOperation(n,e,t)}function Xp(n){ee().setActiveRoomId(n)}const V=n=>Uf().send(n);class wr{static getAchievementBadgeCode(e){if(!e)return null;let t=e.badgeId;return e.finalLevel||(t=nP().getPreviousLevelBadgeId(t)),t}static getAchievementCategoryImageUrl(e,t=null,s=!1){const r=ce("achievements.images.url");let i=s?"achicon_":"achcategory_";return i+=e.code,t!==null&&(i+=`_${t>0?"active":"inactive"}`),r.replace("%image%",i)}static getAchievementCategoryMaxProgress(e){if(!e)return 0;let t=0;for(const s of e.achievements)t+=s.levelCount;return t}static getAchievementCategoryProgress(e){if(!e)return 0;let t=0;for(const s of e.achievements)t+=s.finalLevel?s.level:s.level-1;return t}static getAchievementCategoryTotalUnseen(e){if(!e)return 0;let t=0;for(const s of e.achievements)s.unseen>0&&t++;return t}static getAchievementHasStarted(e){return e?!!(e.finalLevel||e.level-1>0):!1}static getAchievementIsIgnored(e){if(!e)return!1;const t=ce("achievements.unseen.ignored"),s=e.badgeId.replace(/[0-9]/g,"");return t.indexOf(s)>=0}static getAchievementLevel(e){return e?e.finalLevel?e.level:e.level-1:0}}class qp{constructor(e){this._code=e,this._achievements=[]}getProgress(){return wr.getAchievementCategoryProgress(this)}getMaxProgress(){return wr.getAchievementCategoryMaxProgress(this)}get code(){return this._code}get achievements(){return this._achievements}set achievements(e){this._achievements=e}}class li{}li.ACTION_SAVE="AEA_ACTION_SAVE";li.ACTION_CLEAR="AEA_ACTION_CLEAR";li.ACTION_RESET="AEA_ACTION_RESET";li.ACTION_RANDOMIZE="AEA_ACTION_RANDOMIZE";class D6{constructor(e,t=!1){this._partColor=e,this._isDisabled=t,this._isHC=this._partColor.clubLevel>0,this._isSelected=!1}dispose(){this._partColor=null}get partColor(){return this._partColor}get color(){return sr.int2rgb(this._partColor.rgb)}get isDisabled(){return this._isDisabled}get isHC(){return this._isHC}get isSelected(){return this._isSelected}set isSelected(e){this._isSelected=e,this.notify&&this.notify()}get notify(){return this._notifier}set notify(e){this._notifier=e}}class YE{constructor(e,t,s){this._selectedPartIndex=-1,this._name=e,this._parts=t,this._palettes=s,this._selectedPartIndex=-1}static defaultColorId(e,t){if(!e||!e.length)return-1;let s=0;for(;s<e.length;){const r=e[s];if(r.partColor&&r.partColor.clubLevel<=t)return r.partColor.id;s++}return-1}init(){for(const e of this._parts)e&&e.init()}dispose(){if(this._parts){for(const e of this._parts)e.dispose();this._parts=null}if(this._palettes){for(const e of this._palettes)for(const t of e)t.dispose();this._palettes=null}this._selectedPartIndex=-1,this._paletteIndexes=null}selectPartId(e){if(!this._parts)return;let t=0;for(;t<this._parts.length;){if(this._parts[t].id===e){this.selectPartIndex(t);return}t++}}selectColorIds(e){if(!e||!this._palettes)return;this._paletteIndexes=new Array(e.length);let t=0;for(;t<this._palettes.length;){const s=this.getPalette(t);if(s){let r=0;if(e.length>t)r=e[t];else{const a=s[0];a&&a.partColor&&(r=a.partColor.id)}let i=0;for(;i<s.length;){const a=s[i];a.partColor.id===r?(this._paletteIndexes[t]=i,a.isSelected=!0):a.isSelected=!1,i++}}t++}this.updatePartColors()}selectPartIndex(e){if(!this._parts)return null;if(this._selectedPartIndex>=0&&this._parts.length>this._selectedPartIndex){const t=this._parts[this._selectedPartIndex];t&&(t.isSelected=!1)}if(this._parts.length>e){const t=this._parts[e];if(t)return t.isSelected=!0,this._selectedPartIndex=e,t}return null}selectColorIndex(e,t){const s=this.getPalette(t);if(!s||s.length<=e)return null;this.deselectColorIndex(this._paletteIndexes[t],t),this._paletteIndexes[t]=e;const r=s[e];return r?(r.isSelected=!0,this.updatePartColors(),r):null}getCurrentColorIndex(e){return this._paletteIndexes[e]}deselectColorIndex(e,t){const s=this.getPalette(t);if(!s||s.length<=e)return;const r=s[e];r&&(r.isSelected=!1)}getSelectedColorIds(){if(!this._paletteIndexes||!this._paletteIndexes.length||!this._palettes||!this._palettes.length)return null;const e=this._palettes[0];if(!e||!e.length)return null;const t=e[0];if(!t||!t.partColor)return null;const s=t.partColor.id,r=[];let i=0;for(;i<this._paletteIndexes.length;){const l=this._palettes[i];if(!(!l||l.length<=i))if(l.length>this._paletteIndexes[i]){const c=l[this._paletteIndexes[i]];c&&c.partColor?r.push(c.partColor.id):r.push(s)}else r.push(s);i++}const a=this.getCurrentPart();return a?r.slice(0,Math.max(a.maxColorIndex,1)):null}getSelectedColors(){const e=[];let t=0;for(;t<this._paletteIndexes.length;){const s=this.getSelectedColor(t);s?e.push(s.partColor):e.push(null),t++}return e}getSelectedColor(e){const t=this.getPalette(e);return!t||t.length<=this._paletteIndexes[e]?null:t[this._paletteIndexes[e]]}getSelectedColorId(e){const t=this.getSelectedColor(e);return t&&t.partColor?t.partColor.id:0}getPalette(e){return!this._paletteIndexes||!this._palettes||this._palettes.length<=e?null:this._palettes[e]}getCurrentPart(){return this._parts[this._selectedPartIndex]}updatePartColors(){const e=this.getSelectedColors();for(const t of this._parts)t&&(t.partColors=e)}hasClubSelectionsOverLevel(e){let t=!1;const s=this.getSelectedColors();if(s){let i=0;for(;i<s.length;){const a=s[i];a&&a.clubLevel>e&&(t=!0),i++}}const r=this.getCurrentPart();if(r&&r.partSet){const i=r.partSet;i&&i.clubLevel>e&&(t=!0)}return t}hasInvalidSelectedItems(e){const t=this.getCurrentPart();if(!t)return!1;const s=t.partSet;if(!(!s||!s.isSellable))return e.indexOf(s.id)>-1}stripClubItemsOverLevel(e){const t=this.getCurrentPart();if(t&&t.partSet&&t.partSet.clubLevel>e){const r=this.selectPartIndex(0);return r&&!r.partSet&&this.selectPartIndex(1),!0}return!1}stripClubColorsOverLevel(e){const t=[],s=this.getSelectedColors(),r=this.getPalette(0);let i=!1;const a=YE.defaultColorId(r,e);if(a===-1)return!1;let l=0;for(;l<s.length;){const c=s[l];c?c.clubLevel>e?(t.push(a),i=!0):t.push(c.id):(t.push(a),i=!0),l++}return i&&this.selectColorIds(t),i}get name(){return this._name}get parts(){return this._parts}get selectedPartIndex(){return this._selectedPartIndex}}class ns{static getGender(e){switch(e){case nt.MALE:case"m":case"M":e=nt.MALE;break;case nt.FEMALE:case"f":case"F":e=nt.FEMALE;break;default:e=nt.MALE}return e}static hasFigureSetId(e){return this.FIGURE_SET_IDS.indexOf(e)>=0}static createCategory(e,t){if(!e||!t||!this.CURRENT_FIGURE)return null;const s=[],r=[];let i=0;for(;i<this.MAX_PALETTES;)r.push([]),i++;const a=zp(t);if(!a)return null;const l=Yp(a.paletteID);if(!l)return null;let c=this.CURRENT_FIGURE.getColorIds(t);c||(c=[]);const u=new Array(c.length),h=this.clubItemsDimmed,d=Qr();for(const S of l.colors.getValues())if(S.isSelectable&&(h||d>=S.clubLevel)){let A=0;for(;A<this.MAX_PALETTES;){const N=d<S.clubLevel,L=new D6(S,N);r[A].push(L),A++}if(t!==nt.FACE){let N=0;for(;N<c.length;)S.id===c[N]&&(u[N]=S),N++}}let f=[];if(h?f=fs().getMandatoryAvatarPartSetIds(this.CURRENT_FIGURE.gender,2):f=fs().getMandatoryAvatarPartSetIds(this.CURRENT_FIGURE.gender,d),f.indexOf(t)===-1){const S=new Qp(null,null,!1);S.isClear=!0,s.push(S)}const m=t!==nt.FACE,R=a.partSets;for(i=R.length-1;i>=0;){const S=R.getWithIndex(i);let A=!1;if((S.gender===nt.UNISEX||S.gender===this.CURRENT_FIGURE.gender)&&(A=!0),S.isSelectable&&A&&(h||d>=S.clubLevel)){const N=d<S.clubLevel;let L=!0;S.isSellable&&(L=this.hasFigureSetId(S.id)),L&&s.push(new Qp(S,u,m,N))}i--}for(s.sort(this.clubItemsFirst?this.clubSorter:this.noobSorter),i=0;i<this.MAX_PALETTES;)r[i].sort(this.colorSorter),i++;return new YE(t,s,r)}static clubSorter(e,t){const s=e.partSet?e.partSet.clubLevel:9999999999,r=t.partSet?t.partSet.clubLevel:9999999999,i=e.partSet?e.partSet.isSellable:!1,a=t.partSet?t.partSet.isSellable:!1;return i&&!a?1:a&&!i||s>r?-1:s<r?1:e.partSet.id>t.partSet.id?-1:e.partSet.id<t.partSet.id?1:0}static colorSorter(e,t){const s=e.partColor?e.partColor.clubLevel:-1,r=t.partColor?t.partColor.clubLevel:-1;return s<r?-1:s>r?1:e.partColor.index<t.partColor.index?-1:e.partColor.index>t.partColor.index?1:0}static noobSorter(e,t){const s=e.partSet?e.partSet.clubLevel:-1,r=t.partSet?t.partSet.clubLevel:-1,i=e.partSet?e.partSet.isSellable:!1,a=t.partSet?t.partSet.isSellable:!1;return i&&!a?1:a&&!i||s<r?-1:s>r?1:e.partSet.id<t.partSet.id?-1:e.partSet.id>t.partSet.id?1:0}static avatarSetFirstSelectableColor(e){const t=zp(e);if(!t)return-1;const s=Yp(t.paletteID);if(!s)return-1;for(const r of s.colors.getValues())if(!(!r.isSelectable||Qr()<r.clubLevel))return r.id;return-1}static get clubItemsFirst(){return ce("avatareditor.show.clubitems.first",!0)}static get clubItemsDimmed(){return ce("avatareditor.show.clubitems.dimmed",!0)}}ns.MAX_PALETTES=2;ns.CURRENT_FIGURE=null;ns.FIGURE_SET_IDS=[];ns.BOUND_FURNITURE_NAMES=[];const It=class Gt{constructor(){this._gender="M",this._direction=Gt.DEFAULT_DIRECTION,this._avatarEffectType=-1,this._notifier=null}loadAvatarData(e,t){this._data=new Map,this._colors=new Map,this._gender=t,this.parseFigureString(e),this.updateView()}parseFigureString(e){if(!e)return;const t=e.split(".");if(!(!t||!t.length))for(const s of t){const r=s.split("-");if(!r.length)continue;const i=r[0],a=parseInt(r[1]),l=[];let c=2;for(;c<r.length;)l.push(parseInt(r[c])),c++;l.length||l.push(0),this.savePartSetId(i,a,!1),this.savePartSetColourId(i,l,!1)}}getPartSetId(e){const t=this._data.get(e);return t!==void 0?t:-1}getColorIds(e){const t=this._colors.get(e);return t!==void 0?t:[ns.avatarSetFirstSelectableColor(e)]}getFigureString(){let e="";const t=[];for(const[r,i]of this._data.entries()){const a=this._colors.get(r);let l=r+"-"+i;if(a&&a.length){let c=0;for(;c<a.length;)l=l+("-"+a[c]),c++}t.push(l)}let s=0;for(;s<t.length;)e=e+t[s],s<t.length-1&&(e=e+"."),s++;return e}savePartData(e,t,s,r=!1){this.savePartSetId(e,t,r),this.savePartSetColourId(e,s,r)}savePartSetId(e,t,s=!0){switch(e){case Gt.FACE:case Gt.HAIR:case Gt.HAT:case Gt.HEAD_ACCESSORIES:case Gt.EYE_ACCESSORIES:case Gt.FACE_ACCESSORIES:case Gt.SHIRT:case Gt.JACKET:case Gt.CHEST_ACCESSORIES:case Gt.CHEST_PRINTS:case Gt.TROUSERS:case Gt.SHOES:case Gt.TROUSER_ACCESSORIES:t>=0?this._data.set(e,t):this._data.delete(e);break}s&&this.updateView()}savePartSetColourId(e,t,s=!0){switch(e){case Gt.FACE:case Gt.HAIR:case Gt.HAT:case Gt.HEAD_ACCESSORIES:case Gt.EYE_ACCESSORIES:case Gt.FACE_ACCESSORIES:case Gt.SHIRT:case Gt.JACKET:case Gt.CHEST_ACCESSORIES:case Gt.CHEST_PRINTS:case Gt.TROUSERS:case Gt.SHOES:case Gt.TROUSER_ACCESSORIES:this._colors.set(e,t);break}s&&this.updateView()}getFigureStringWithFace(e,t=!0){let s="";const r=[Gt.FACE],i=[];for(const l of r){const c=this._colors.get(l);if(!c)continue;let u=this._data.get(l);l===Gt.FACE&&t&&(u=e);let h=l+"-"+u;if(u>=0){let d=0;for(;d<c.length;)h=h+("-"+c[d]),d++}i.push(h)}let a=0;for(;a<i.length;)s=s+i[a],a<i.length-1&&(s=s+"."),a++;return s}updateView(){this.notify&&this.notify()}get gender(){return this._gender}get direction(){return this._direction}set direction(e){this._direction=e,this.updateView()}set avatarEffectType(e){this._avatarEffectType=e}get avatarEffectType(){return this._avatarEffectType}get notify(){return this._notifier}set notify(e){this._notifier=e}};It.DEFAULT_DIRECTION=4;It.MALE="M";It.FEMALE="F";It.UNISEX="U";It.SCALE="h";It.STD="std";It.DEFAULT_FRAME="0";It.FACE="hd";It.HAIR="hr";It.HAT="ha";It.HEAD_ACCESSORIES="he";It.EYE_ACCESSORIES="ea";It.FACE_ACCESSORIES="fa";It.JACKET="cc";It.SHIRT="ch";It.CHEST_ACCESSORIES="ca";It.CHEST_PRINTS="cp";It.TROUSERS="lg";It.SHOES="sh";It.TROUSER_ACCESSORIES="wa";It.SET_TYPES=[It.FACE,It.HAIR,It.HAT,It.HEAD_ACCESSORIES,It.EYE_ACCESSORIES,It.FACE_ACCESSORIES,It.JACKET,It.SHIRT,It.CHEST_ACCESSORIES,It.CHEST_PRINTS,It.TROUSERS,It.SHOES,It.TROUSERS];let nt=It;const n_=class nl{constructor(e,t,s=!0,r=!1){if(this._renderManager=fs(),this._partSet=e,this._partColors=t,this._useColors=s,this._isDisabled=r,this._thumbContainer=null,this._imageUrl=null,this._maxColorIndex=0,this._isValidFigure=!1,this._isHC=!1,this._isSellable=!1,this._isClear=!1,this._isSelected=!1,this._disposed=!1,this._isInitalized=!1,e){const i=e.parts;for(const a of i)this._maxColorIndex=Math.max(this._maxColorIndex,a.colorLayerIndex)}}init(){this._isInitalized||(this._isInitalized=!0,this.update())}dispose(){this._disposed||(this._renderManager=null,this._partSet=null,this._partColors=null,this._imageUrl=null,this._disposed=!0,this._isInitalized=!1,this._thumbContainer&&(this._thumbContainer.destroy(),this._thumbContainer=null))}update(){this.updateThumbVisualization()}analyzeFigure(){if(!this._renderManager||!this._partSet||!this._partSet.parts||!this._partSet.parts.length)return!1;const e=this._renderManager.createFigureContainer(this.partSet.type+"-"+this.partSet.id);return this._renderManager.isFigureContainerReady(e)?(this._isValidFigure=!0,!0):(this._renderManager.downloadAvatarFigure(e,this),!1)}renderThumb(){if(!this._renderManager||!this._partSet||!this._isValidFigure&&!this.analyzeFigure())return null;const e=this._partSet.parts.concat().sort(this.sortByDrawOrder),t=new di;for(const s of e){if(!s)continue;let r=null,i=0,a=!1;for(;!a&&i<nl.THUMB_DIRECTIONS.length;){const d=nt.SCALE+"_"+nt.STD+"_"+s.type+"_"+s.id+"_"+nl.THUMB_DIRECTIONS[i]+"_"+nt.DEFAULT_FRAME;r=this._renderManager.getAssetByName(d),r&&r.texture?a=!0:i++}if(!a)continue;const l=r.offsetX,c=r.offsetY;let u=null;if(this._useColors&&s.colorLayerIndex>0){const d=this._partColors[s.colorLayerIndex-1];d&&(u=d)}const h=new jt(r.texture);h.position.set(l,c),u&&(h.tint=u.rgb),t.addChild(h)}return t}updateThumbVisualization(){if(!this._isInitalized)return;let e=this._thumbContainer;e||(e=this.renderThumb()),e&&(this._partSet?(this._isHC=this._partSet.clubLevel>0,this._isSellable=this._partSet.isSellable):(this._isHC=!1,this._isSellable=!1),this._isDisabled&&this.setAlpha(e,.2),this._imageUrl=ht.generateImageUrl(e),this.notify&&this.notify())}setAlpha(e,t){return e.filters=[nl.ALPHA_FILTER],e}sortByDrawOrder(e,t){const s=nl.DRAW_ORDER.indexOf(e.type),r=nl.DRAW_ORDER.indexOf(t.type);return s<r?-1:s>r?1:e.index<t.index?-1:e.index>t.index?1:0}resetFigure(e){this.analyzeFigure()&&this.update()}get disposed(){return this._disposed}get id(){return this._partSet?this._partSet.id:-1}get partSet(){return this._partSet}set partColors(e){this._partColors=e,this.update()}get isDisabled(){return this._isDisabled}set thumbContainer(e){this._thumbContainer=e,this.update()}get imageUrl(){return this._imageUrl}get maxColorIndex(){return this._maxColorIndex}get isHC(){return this._isHC}get isSellable(){return this._isSellable}get isClear(){return this._isClear}set isClear(e){this._isClear=e}get isSelected(){return this._isSelected}set isSelected(e){this._isSelected=e,this.notify&&this.notify()}get notify(){return this._notifier}set notify(e){this._notifier=e}};n_.ALPHA_FILTER=new FU(.2);n_.THUMB_DIRECTIONS=[2,6,0,4,3,1];n_.DRAW_ORDER=[qe.LEFT_HAND_ITEM,qe.LEFT_HAND,qe.LEFT_SLEEVE,qe.LEFT_COAT_SLEEVE,qe.BODY,qe.SHOES,qe.LEGS,qe.CHEST,qe.CHEST_ACCESSORY,qe.COAT_CHEST,qe.CHEST_PRINT,qe.WAIST_ACCESSORY,qe.RIGHT_HAND,qe.RIGHT_SLEEVE,qe.RIGHT_COAT_SLEEVE,qe.HEAD,qe.FACE,qe.EYES,qe.HAIR,qe.HAIR_BIG,qe.FACE_ACCESSORY,qe.EYE_ACCESSORY,qe.HEAD_ACCESSORY,qe.HEAD_ACCESSORY_EXTRA,qe.RIGHT_HAND_ITEM];let Qp=n_;class a_{constructor(){this._isInitalized=!1,this._maxPaletteCount=0}dispose(){this._categories=null,this._disposed=!0}get disposed(){return this._disposed}init(){this._categories||(this._categories=new Map)}reset(){if(this._isInitalized=!1,this._categories)for(const e of this._categories.values())e&&e.dispose();this._categories=new Map}addCategory(e){let t=this._categories.get(e);t||(t=ns.createCategory(this,e),t&&(this._categories.set(e,t),this.updateSelectionsFromFigure(e)))}updateSelectionsFromFigure(e){const t=this._categories.get(e);if(!t)return;const s=ns.CURRENT_FIGURE.getPartSetId(e);let r=ns.CURRENT_FIGURE.getColorIds(e);r||(r=[]),t.selectPartId(s),t.selectColorIds(r)}hasClubSelectionsOverLevel(e){if(!this._categories)return!1;for(const t of this._categories.values())if(t&&t.hasClubSelectionsOverLevel(e))return!0;return!1}hasInvalidSelectedItems(e){if(!this._categories)return!1;for(const t of this._categories.values())if(t.hasInvalidSelectedItems(e))return!0;return!1}stripClubItemsOverLevel(e){if(!this._categories)return!1;let t=!1;for(const[s,r]of this._categories.entries()){let i=!1;if(r.stripClubItemsOverLevel(e)&&(i=!0),r.stripClubColorsOverLevel(e)&&(i=!0),i){const a=r.getCurrentPart();a&&ns.CURRENT_FIGURE&&ns.CURRENT_FIGURE.savePartData(s,a.id,r.getSelectedColorIds(),!0),t=!0}}return t}stripInvalidSellableItems(){if(!this._categories)return!1;let e=!1;for(const[t,s]of this._categories.entries());return e}selectPart(e,t){const s=this._categories.get(e);if(!s)return;const r=s.selectedPartIndex;s.selectPartIndex(t);const i=s.getCurrentPart();if(i){if(i.isDisabled){s.selectPartIndex(r);return}this._maxPaletteCount=i.maxColorIndex,ns.CURRENT_FIGURE.savePartData(e,i.id,s.getSelectedColorIds(),!0)}}selectColor(e,t,s){const r=this._categories.get(e);if(!r)return;const i=r.getCurrentColorIndex(s);if(r.selectColorIndex(t,s),r.getSelectedColor(s).isDisabled){r.selectColorIndex(i,s);return}ns.CURRENT_FIGURE.savePartSetColourId(e,r.getSelectedColorIds(),!0)}getCategoryData(e){return this._isInitalized||this.init(),this._categories?this._categories.get(e):null}get categories(){return this._categories}get canSetGender(){return!1}get maxPaletteCount(){return this._maxPaletteCount||1}set maxPaletteCount(e){this._maxPaletteCount=e}get name(){return null}}class v6 extends a_{constructor(){super(...arguments),this._imageCallBackHandled=!1}init(){super.init(),this.addCategory(nt.FACE),this._isInitalized=!0}selectColor(e,t,s){super.selectColor(e,t,s),this.updateSelectionsFromFigure(nt.FACE)}updateSelectionsFromFigure(e){if(!this._categories||!ns.CURRENT_FIGURE)return;const t=this._categories.get(e);if(!t)return;const s=ns.CURRENT_FIGURE.getPartSetId(e);let r=ns.CURRENT_FIGURE.getColorIds(e);r||(r=[]),t.selectPartId(s),t.selectColorIds(r);for(const i of t.parts){const a=l=>{const c=ns.CURRENT_FIGURE.getFigureStringWithFace(i.id),u=fs().createAvatarImage(c,Xr.LARGE,null,{resetFigure:a,dispose:null,disposed:!1}),h=u.getImageAsSprite(bs.HEAD);h&&(h.y=10,i.thumbContainer=h,setTimeout(()=>u.dispose(),0))};a()}}get canSetGender(){return!0}get name(){return ur.GENERIC}}const dr=n=>{if(n==null||typeof n!="object")return n;const e=new n.constructor;for(const t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e};class Jr{static makeColorHex(e){return"#"+e}static makeColorNumberHex(e){return"#"+e.toString(16).padStart(6,"0")}static convertFromHex(e){return parseInt(e.replace("#",""),16)}static uintHexColor(e){const t=e>>>0;return Jr.makeColorHex(t.toString(16).substring(2))}static int_to_8BitVals(e){const t=e>>24&255,s=e>>16&255,r=e>>8&255,i=e&255;return[t,s,r,i]}static eight_bitVals_to_int(e,t,s,r){return(e<<24)+(t<<16)+(s<<8)+(r|0)}static int2rgb(e){e>>>=0;const t=e&255,s=(e&65280)>>>8;return"rgba("+[(e&16711680)>>>16,s,t,1].join(",")+")"}}const $a=n=>{let e=Math.floor(n/86400),t=Math.floor(n%86400/3600),s=Math.floor(n%86400%3600/60),r=n%86400%3600%60;return e.toString().padStart(2,"0")+":"+t.toString().padStart(2,"0")+":"+s.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")},wf=n=>{try{JSON.parse(window.localStorage.getItem(n))}catch{return null}},zE=n=>{let e=ze().localization.getBadgeDesc(n);return(!e||!e.length)&&(e=`badge_desc_${n}`),e},Au=n=>{let e=ze().localization.getBadgeName(n);return(!e||!e.length)&&(e=`badge_name_${n}`),e};function p(n,e=null,t=null){return ze().getLocalizationWithParameters(n,e,t)}class Nu{}Nu.CATALOG_PLACE_MULTIPLE_OBJECTS="catalogPlaceMultipleObjects";Nu.CATALOG_SKIP_PURCHASE_CONFIRMATION="catalogSkipPurchaseConfirmation";const gP=(n,e)=>n.dispatchEvent(e),Gf=n=>gP(ze().events,n),fn=new jr,Fs=n=>gP(fn,n);let fP=!1;const mn=n=>{fP&&Gf(new ml(ml.PLAY_SOUND,n))},Jp=[ie.MOUSE_CLICK],b6=()=>{const n=()=>Jp.forEach(t=>window.removeEventListener(t,e)),e=t=>(fP=!0)&&n();Jp.forEach(t=>window.addEventListener(t,e))};b6();class he{}he.DEFAULT=1;he.WALL_PAPER=2;he.FLOOR=3;he.LANDSCAPE=4;he.POST_IT=5;he.POSTER=6;he.SOUND_SET=7;he.TRAX_SONG=8;he.PRESENT=9;he.ECOTRON_BOX=10;he.TROPHY=11;he.CREDIT_FURNI=12;he.PET_SHAMPOO=13;he.PET_CUSTOM_PART=14;he.PET_CUSTOM_PART_SHAMPOO=15;he.PET_SADDLE=16;he.GUILD_FURNI=17;he.GAME_FURNI=18;he.MONSTERPLANT_SEED=19;he.MONSTERPLANT_REVIVAL=20;he.MONSTERPLANT_REBREED=21;he.MONSTERPLANT_FERTILIZE=22;he.FIGURE_PURCHASABLE_SET=23;class zc{constructor(e){e&&(this._locked=!1,this._id=e.itemId,this._type=e.spriteId,this._ref=e.ref,this._category=e.category,this._groupable=e.isGroupable&&!e.rentable,this._tradeable=e.tradable,this._recyclable=e.isRecycleable,this._sellable=e.sellable,this._stuffData=e.stuffData,this._extra=e.extra,this._secondsToExpiration=e.secondsToExpiration,this._expirationTimeStamp=e.expirationTimeStamp,this._hasRentPeriodStarted=e.hasRentPeriodStarted,this._creationDay=e.creationDay,this._creationMonth=e.creationMonth,this._creationYear=e.creationYear,this._slotId=e.slotId,this._songId=e.songId,this._flatId=e.flatId,this._isRented=e.rentable,this._isWallItem=e.isWallItem)}get rentable(){return this._isRented}get id(){return this._id}get ref(){return this._ref}get category(){return this._category}get type(){return this._type}get stuffData(){return this._stuffData}set stuffData(e){this._stuffData=e}get extra(){return this._extra}get recyclable(){return this._recyclable}get isTradable(){return this._tradeable}get isGroupable(){return this._groupable}get sellable(){return this._sellable}get secondsToExpiration(){if(this._secondsToExpiration===-1)return-1;let e=-1;return this._hasRentPeriodStarted?(e=this._secondsToExpiration-(ve()-this._expirationTimeStamp)/1e3,e<0&&(e=0)):e=this._secondsToExpiration,e}get creationDay(){return this._creationDay}get creationMonth(){return this._creationMonth}get creationYear(){return this._creationYear}get slotId(){return this._slotId}get songId(){return this._songId}get locked(){return this._locked}set locked(e){this._locked=e}get flatId(){return this._flatId}get isWallItem(){return this._isWallItem}get hasRentPeriodStarted(){return this._hasRentPeriodStarted}get expirationTimeStamp(){return this._expirationTimeStamp}update(e){this._type=e.spriteId,this._ref=e.ref,this._category=e.category,this._groupable=e.isGroupable&&!e.rentable,this._tradeable=e.tradable,this._recyclable=e.isRecycleable,this._sellable=e.sellable,this._stuffData=e.stuffData,this._extra=e.extra,this._secondsToExpiration=e.secondsToExpiration,this._expirationTimeStamp=e.expirationTimeStamp,this._hasRentPeriodStarted=e.hasRentPeriodStarted,this._creationDay=e.creationDay,this._creationMonth=e.creationMonth,this._creationYear=e.creationYear,this._slotId=e.slotId,this._songId=e.songId,this._flatId=e.flatId,this._isRented=e.rentable,this._isWallItem=e.isWallItem}clone(){const e=new zc(null);return e._expirationTimeStamp=this._expirationTimeStamp,e._isWallItem=this._isWallItem,e._songId=this._songId,e._locked=this._locked,e._id=this._id,e._ref=this._ref,e._category=this._category,e._type=this._type,e._stuffData=this._stuffData,e._extra=this._extra,e._recyclable=this._recyclable,e._tradeable=this._tradeable,e._groupable=this._groupable,e._sellable=this._sellable,e._secondsToExpiration=this._secondsToExpiration,e._hasRentPeriodStarted=this._hasRentPeriodStarted,e._creationDay=this._creationDay,e._creationMonth=this._creationMonth,e._creationYear=this._creationYear,e._slotId=this._slotId,e._isRented=this._isRented,e._flatId=this._flatId,e}}class KE{constructor(e=-1,t=-1,s=null,r=null,i=-1){this._type=e,this._category=t,this._roomEngine=s,this._stuffData=r,this._extra=i,this._isWallItem=!1,this._iconUrl=null,this._name=null,this._description=null,this._locked=!1,this._selected=!1,this._hasUnseenItems=!1,this._items=[]}clone(){const e=new KE;return e._type=this._type,e._category=this._category,e._roomEngine=this._roomEngine,e._stuffData=this._stuffData,e._extra=this._extra,e._isWallItem=this._isWallItem,e._iconUrl=this._iconUrl,e._name=this._name,e._description=this._description,e._locked=this._locked,e._selected=this._selected,e._hasUnseenItems=this._hasUnseenItems,e._items=this._items,e}prepareGroup(){this.setIcon(),this.setName(),this.setDescription()}dispose(){}getItemByIndex(e){return this._items[e]}getItemById(e){for(const t of this._items)if(t.id===e)return t;return null}getTradeItems(e){const t=[],s=this.getLastItem();if(!s)return t;let r=0,i=0;for(;i<this._items.length&&!(r>=e);){const a=this.getItemByIndex(i);!a.locked&&a.isTradable&&a.type===s.type&&(t.push(a),r++),i++}return t}push(e){const t=[...this._items];let s=0;for(;s<t.length;){let r=t[s];if(r.id===e.id){r=r.clone(),r.locked=!1,t.splice(s,1),t.push(r),this._items=t;return}s++}t.push(e),this._items=t,this._items.length===1&&this.prepareGroup()}pop(){const e=[...this._items];let t=null;if(e.length>0){const s=e.length-1;t=e[s],e.splice(s,1)}return this._items=e,t}remove(e){const t=[...this._items];let s=0;for(;s<t.length;){let r=t[s];if(r.id===e)return t.splice(s,1),this._items=t,r;s++}return null}getTotalCount(){if(this._category===he.POST_IT){let e=0,t=0;for(;t<this._items.length;){const s=this.getItemByIndex(t);e=e+parseInt(s.stuffData.getLegacyString()),t++}return e}return this._items.length}getUnlockedCount(){if(this.category===he.POST_IT)return this.getTotalCount();let e=0,t=0;for(;t<this._items.length;)this.getItemByIndex(t).locked||e++,t++;return e}getLastItem(){return this._items.length?this.getItemByIndex(this._items.length-1):null}unlockAllItems(){const e=[...this._items];let t=0;for(;t<e.length;){const s=e[t];if(s.locked){const r=s.clone();r.locked=!1,e[t]=r}t++}this._items=e}lockItemIds(e){const t=[...this._items];let s=0,r=!1;for(;s<t.length;){const i=t[s],a=e.indexOf(i.ref)>=0;if(i.locked!==a){r=!0;const l=i.clone();l.locked=a,t[s]=l}s++}return this._items=t,r}setName(){const e=this.getLastItem();if(!e){this._name="";return}let t="";switch(this._category){case he.POSTER:t="poster_"+e.stuffData.getLegacyString()+"_name";break;case he.TRAX_SONG:this._name="SONG_NAME";return;default:this.isWallItem?t="wallItem.name."+e.type:t="roomItem.name."+e.type}this._name=p(t)}setDescription(){this._description=""}setIcon(){if(this._iconUrl)return;let e=null;this.isWallItem?e=this._roomEngine.getFurnitureWallIconUrl(this._type,this._stuffData.getLegacyString()):e=this._roomEngine.getFurnitureFloorIconUrl(this._type),e&&(this._iconUrl=e)}get type(){return this._type}get category(){return this._category}get stuffData(){return this._stuffData}get extra(){return this._extra}get iconUrl(){return this._iconUrl}get name(){return this._name}get description(){return this._description}get hasUnseenItems(){return this._hasUnseenItems}set hasUnseenItems(e){this._hasUnseenItems=e}get locked(){return this._locked}set locked(e){this._locked=e}get selected(){return this._selected}set selected(e){this._selected=e}get isWallItem(){const e=this.getItemByIndex(0);return e?e.isWallItem:!1}get isGroupable(){const e=this.getItemByIndex(0);return e?e.isGroupable:!1}get isSellable(){const e=this.getItemByIndex(0);return e?e.sellable:!1}get items(){return this._items}set items(e){this._items=e}}const XE=(n,e,t,s=NaN)=>new KE(n,e,ee(),t,s),P6=(n,e,t)=>{const s=[];for(const i of n)i.type===e.type&&s.push(i);for(const i of s)if(i.getItemById(e.id))return i;const r=XE(e.type,e.category,e.stuffData,e.extra);return r.push(e),t?(r.hasUnseenItems=!0,n.unshift(r)):n.push(r),r},L6=(n,e,t)=>{let s=null;for(const r of n)if(r.type===e.type&&r.isWallItem===e.isWallItem&&r.isGroupable)if(e.category===he.POSTER){if(r.stuffData.getLegacyString()===e.stuffData.getLegacyString()){s=r;break}}else if(e.category===he.GUILD_FURNI){if(e.stuffData.compare(r.stuffData)){s=r;break}}else{s=r;break}if(s){if(s.push(e),t){s.hasUnseenItems=!0;const r=n.indexOf(s);r>=0&&n.splice(r,1),n.unshift(s)}return s}return s=XE(e.type,e.category,e.stuffData,e.extra),s.push(e),t?(s.hasUnseenItems=!0,n.unshift(s)):n.push(s),s},Zp=(n,e,t)=>{e.isGroupable?L6(n,e,t):P6(n,e,t)},U6=(n,e,t,s)=>{if(e===1)return n;s[t]=n;for(const i of s)if(!i)return null;const r=new Map;for(const i of s){for(const[a,l]of i)r.set(a,l);i.clear()}return s=null,r},F6=n=>{const e=[];for(const t of n){let s=t.getTotalCount();t.category===he.POST_IT&&(s=1);let r=0;for(;r<s;)e.push(t.getItemByIndex(r).id),r++}return e};let mP=!1,EP=-1;const x6=()=>mP,yu=n=>mP=n,Ll=()=>EP,o_=n=>EP=n,Kc=()=>{Ll()!==-1&&(ee().cancelRoomObjectPlacement(),o_(-1),yu(!1))},Bf=(n,e=!1)=>{const t=n.petData;if(!t)return!1;const s=wo().getSession(1);return!s||!s.isRoomOwner&&!s.allowPets?!1:(de("inventory/hide"),ee().processRoomObjectPlacement(xa.INVENTORY,-t.id,k.UNIT,Rt.PET,t.figureData.figuredata)&&(o_(t.id),yu(!0)),!0)},Ul=(n,e=!1)=>{if(!n||!n.getUnlockedCount())return!1;const t=n.getLastItem();if(!t)return!1;if(t.category===he.FLOOR||t.category===he.WALL_PAPER||t.category===he.LANDSCAPE)return e||V(new Dc(t.id)),!1;{de("inventory/hide");let s=0,r=!1;t.isWallItem?s=k.WALL:s=k.FLOOR,t.category===he.POSTER?r=ee().processRoomObjectPlacement(xa.INVENTORY,t.id,s,t.type,t.stuffData.getLegacyString()):r=ee().processRoomObjectPlacement(xa.INVENTORY,t.id,s,t.type,t.extra.toString(),t.stuffData),r&&(o_(t.ref),yu(!0))}return!0},kf=(n,e=!1)=>{const t=n.botData;if(!t)return!1;const s=wo().getSession(1);return!s||!s.isRoomOwner?!1:(de("inventory/hide"),ee().processRoomObjectPlacement(xa.INVENTORY,-t.id,k.UNIT,Rt.RENTABLE_BOT,t.figure)&&(o_(t.id),yu(!0)),!0)};class wt{}wt.FURNI=1;wt.RENTABLE=2;wt.PET=3;wt.BADGE=4;wt.BOT=5;wt.GAMES=6;const w6=n=>n.map(e=>e.petData.id),pP=(n,e,t=!0)=>{const s={petData:n};return t?e.unshift(s):e.push(s),s},IP=(n,e)=>{let t=0;for(;t<e.length;){const s=e[t];if(s&&s.petData.id===n)return Ll()===s.petData.id&&(Kc(),de("inventory/open")),e.splice(t,1),s;t++}return null},G6=(n,e,t)=>{const s=w6(n),r=[],i=[];for(const a of e.keys())s.indexOf(a)===-1&&r.push(a);for(const a of s)!e.get(a)&&i.push(a);s.length;for(const a of i)IP(a,n);for(const a of r){const l=e.get(a);l&&pP(l,n,t(wt.PET,l.id))}return n},B6=(n,e,t,s)=>{if(e===1)return n;s[t]=n;for(const i of s)if(!i)return null;const r=new Map;for(const i of s){for(const[a,l]of i)r.set(a,l);i.clear()}return s=null,r};class qt{}qt.TRADING_STATE_READY=0;qt.TRADING_STATE_RUNNING=1;qt.TRADING_STATE_COUNTDOWN=2;qt.TRADING_STATE_CONFIRMING=3;qt.TRADING_STATE_CONFIRMED=4;qt.TRADING_STATE_COMPLETED=5;qt.TRADING_STATE_CANCELLED=6;class $p{constructor(e=-1,t="",s=new Zt,r=0,i=0,a=!1,l=!1){this.userId=e,this.userName=t,this.userItems=s,this.itemCount=r,this.creditsCount=i,this.accepts=a,this.canTrade=l}}class _s{}_s.ALERT_SCAM=0;_s.HOTEL_TRADING_DISABLED=1;_s.YOU_NOT_ALLOWED=2;_s.THEY_NOT_ALLOWED=4;_s.ROOM_DISABLED=6;_s.YOU_OPEN=7;_s.THEY_OPEN=8;_s.ERROR_WHILE_COMMIT=9;_s.THEY_CANCELLED=10;const eI=n=>{var e;return((e=$().getWallItemData(n))==null?void 0:e.isExternalImage)||!1},tI=n=>{const e=new Zt;if(n.length)for(const s of n){const r=s.spriteId,i=s.category;let a=s.furniType+r;(!s.isGroupable||eI(r))&&(a="itemid"+s.itemId),s.category===he.POSTER?a=s.itemId+"poster"+s.stuffData.getLegacyString():s.category===he.GUILD_FURNI&&(a="");let l=s.isGroupable&&!eI(s.spriteId)?e.getValue(a):null;l||(l=XE(r,i,s.stuffData),e.add(a,l)),l.push(new zc(s))}return e},k6=(n,e)=>{let t=n.toString();if(!(e instanceof ta))return t;let s=1;for(;s<5;)t=t+(","+e.getValue(s)),s++;return t};class Sh{static getProductImageUrl(e,t,s){let r=null;switch(e){case Hn.S:r=ee().getFurnitureFloorIconUrl(t);break;case Hn.I:this.getProductCategory(Hn.I,t)===1&&(r=ee().getFurnitureWallIconUrl(t,s));break}return r}static getProductCategory(e,t){if(e===Hn.S)return 1;if(e===Hn.I){if(t===3001)return he.WALL_PAPER;if(t===3002)return he.FLOOR;if(t===4057)return he.LANDSCAPE}return 1}}class rd{static getRandomNumber(e){return Math.floor(Math.random()*e)}static getRandomElement(e){return e[this.getRandomNumber(e.length)]}static getRandomElements(e,t){const s=new Array(t);let r=e.length;const i=new Array(r);for(;t--;){var a=this.getRandomNumber(r);s[t]=e[a in i?i[a]:a],i[a]=--r in i?i[r]:r}return s}}const ms=new Map;ms.set("r","red");ms.set("b","blue");ms.set("g","green");ms.set("y","yellow");ms.set("w","white");ms.set("o","orange");ms.set("c","cyan");ms.set("br","brown");ms.set("pr","purple");ms.set("pk","pink");ms.set("red","red");ms.set("blue","blue");ms.set("green","green");ms.set("yellow","yellow");ms.set("white","white");ms.set("orange","orange");ms.set("cyan","cyan");ms.set("brown","brown");ms.set("purple","purple");ms.set("pink","pink");const V6=n=>n.replace(/([\u00A0-\u9999<>&])(.|$)/g,(e,t,s)=>t!=="&"||s!=="#"?(/[\u00A0-\u9999<>&]/.test(s)&&(s="&#"+s.charCodeAt(0)+";"),"&#"+t.charCodeAt(0)+";"+s):e),H6=n=>{let e="";if(n=V6(n),n.startsWith("@")&&n.indexOf("@",1)>-1){let t=null;for(;(t=/@[a-zA-Z]+@/g.exec(n))!==null;){const s=t[0].toString(),r=s.substr(1,s.length-2),i=n.replace(s,"");ms.has(r)?e='<span style="color: '+ms.get(r)+'">'+i+"</span>":e=i;break}}else e=n;return e},TP=(n,e)=>window.localStorage.setItem(n,JSON.stringify(e));class kr{}kr.CAMERA_SHUTTER="camera_shutter";kr.CREDITS="credits";kr.DUCKETS="duckets";kr.MESSENGER_NEW_THREAD="messenger_new_thread";kr.MESSENGER_MESSAGE_RECEIVED="messenger_message_received";kr.MODTOOLS_NEW_TICKET="modtools_new_ticket";function j6(n){const e=n.parts;let t=0;for(const s of e)t=Math.max(t,s.colorLayerIndex);return t}function W6(n,e){return e=e.filter(t=>n.indexOf(t)===-1),[...n,...rd.getRandomElements(e,rd.getRandomNumber(e.length)+1)]}function Y6(n,e,t=0,s=[]){if(!n)return null;const r=n.partSets.getValues().filter(i=>!i.isSelectable||i.gender!=="U"&&i.gender!==e||i.clubLevel>t||i.isSellable&&s.indexOf(i.id)===-1?null:i);return!r||!r.length?null:rd.getRandomElement(r)}function z6(n,e,t=0){if(!n)return[];const s=n.colors.getValues().filter(r=>!r.isSelectable||r.clubLevel>t?null:r);return!s||!s.length?null:rd.getRandomElements(s,j6(e))}function K6(n,e,t=0,s=[],r=[]){const i=fs().structure,a=new Mc(""),l=W6(i.getMandatorySetTypeIds(e,t),nt.SET_TYPES);for(const c of r){const u=n.getPartSetId(c),h=n.getColorIds(c);a.updatePart(c,u,h)}for(const c of l){if(a.hasPartType(c))continue;const u=i.figureData.getSetType(c),h=Y6(u,e,t,s);if(!h)continue;let d=[];h.isColorable&&(d=z6(i.figureData.getPalette(u.paletteID),h,t).map(f=>f.id)),a.updatePart(u.type,h.id,d)}return a.getFigureString()}class X6 extends a_{init(){super.init(),this.addCategory(nt.HAIR),this.addCategory(nt.HAT),this.addCategory(nt.HEAD_ACCESSORIES),this.addCategory(nt.EYE_ACCESSORIES),this.addCategory(nt.FACE_ACCESSORIES),this._isInitalized=!0}get name(){return ur.HEAD}}class q6 extends a_{init(){super.init(),this.addCategory(nt.TROUSERS),this.addCategory(nt.SHOES),this.addCategory(nt.TROUSER_ACCESSORIES),this._isInitalized=!0}get name(){return ur.LEGS}}class Q6 extends a_{init(){super.init(),this.addCategory(nt.SHIRT),this.addCategory(nt.CHEST_PRINTS),this.addCategory(nt.JACKET),this.addCategory(nt.CHEST_ACCESSORIES),this._isInitalized=!0}get name(){return ur.TORSO}}class Xc{}Xc.COLORMATRIX="colormatrix";Xc.COMPOSITE="composite";class J6{constructor(e,t){this.texture=e,this.imageUrl=t}}class Z6{constructor(e,t){this.effectName=e,this.thumbnailUrl=t}}class $6{constructor(e,t,s){this._productName=e,this._customImage=t,this._furnitureClassName=s}get productName(){return this._productName}get customImage(){return this._customImage}get furnitureClassName(){return this._furnitureClassName}}class zs{}zs.STATE_UNLOCKED=1;zs.STATE_LOCKED_AVAILABLE=2;zs.STATE_LOCKED_EXPIRED=3;zs.STATE_LOCKED_FUTURE=4;class Ri{}Ri.TYPE_CHAT=1;Ri.TYPE_ROOM_INFO=2;Ri.TYPE_IM=3;const RP=()=>{const n=new Date;return`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`},sI=(n=0)=>{const e=n?new Date(Date.now()-n*1e3):new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},OP=n=>{if(!n||!n.length)return null;const e=n.split("/"),t=e[0],s=e[1],r=parseInt(e[2]);return{username:t,figure:s,userId:r}};class Kr{constructor(){this.id=-1,this.name=null,this.gender=0,this.online=!1,this.followingAllowed=!1,this.figure=null,this.categoryId=0,this.motto=null,this.realName=null,this.lastAccess=null,this.persistedMessageUser=!1,this.vipMember=!1,this.pocketHabboUser=!1,this.relationshipStatus=-1,this.unread=0}populate(e){this.id=e.id,this.name=e.name,this.gender=e.gender,this.online=e.online,this.followingAllowed=e.followingAllowed,this.figure=e.figure,this.categoryId=e.categoryId,this.motto=e.motto,this.realName=e.realName,this.lastAccess=e.lastAccess,this.persistedMessageUser=e.persistedMessageUser,this.vipMember=e.vipMember,this.pocketHabboUser=e.pocketHabboUser,this.relationshipStatus=e.relationshipStatus}}Kr.RELATIONSHIP_NONE=0;Kr.RELATIONSHIP_HEART=1;Kr.RELATIONSHIP_SMILE=2;Kr.RELATIONSHIP_BOBBA=3;class Oo{}Oo.GROUP_CHAT=0;Oo.PRIVATE_CHAT=1;class ki{}ki.HIDDEN=0;ki.SHOW=1;ki.UNREAD=2;class rI{populate(e){return e?(this._id=e.requestId,this._name=e.requesterName,this._figureString=e.figureString,this._requesterUserId=e.requesterUserId,!0):!1}get id(){return this._id}get name(){return this._name}get requesterUserId(){return this._requesterUserId}get figureString(){return this._figureString}}class eq{constructor(e=0,t=0,s=0,r=[]){this.userFriendLimit=e,this.normalFriendLimit=t,this.extendedFriendLimit=s,this.categories=r}}class Vi{constructor(e,t,s=0,r=null,i=0){this._type=i,this._senderId=e,this._message=t,this._secondsSinceSent=s,this._extraData=r,this._date=new Date}get type(){return this._type}get senderId(){return this._senderId}get message(){return this._message}get secondsSinceSent(){return this._secondsSinceSent}get extraData(){return this._extraData}get date(){return this._date}}Vi.CHAT=0;Vi.ROOM_INVITE=1;Vi.STATUS_NOTIFICATION=2;Vi.SECURITY_NOTIFICATION=3;class tq{constructor(e,t=Oo.PRIVATE_CHAT){this._userId=e,this._chats=[],this._type=t}addChat(e){this._chats.push(e)}get userId(){return this._userId}get chats(){return this._chats}get type(){return this._type}set type(e){this._type=e}}const qE=class SP{constructor(e){this._threadId=++SP.THREAD_ID,this._participant=e,this._groups=[],this._lastUpdated=new Date,this._unreadCount=0}addMessage(e,t,s=0,r=null,i=0){const a=e<0&&r,l=a?OP(r).userId:e,c=this.getLastGroup(l);if(!c)return;a&&(c.type=Oo.GROUP_CHAT);const u=new Vi(e,t,s,r,i);return c.addChat(u),this._lastUpdated=new Date,this._unreadCount++,u}getLastGroup(e){let t=this._groups[this._groups.length-1];return t&&t.userId===e||(t=new tq(e),this._groups.push(t)),t}setRead(){this._unreadCount=0}get threadId(){return this._threadId}get participant(){return this._participant}get groups(){return this._groups}get lastUpdated(){return this._lastUpdated}get unreadCount(){return this._unreadCount}get unread(){return this._unreadCount>0}};qE.MESSAGE_RECEIVED="MT_MESSAGE_RECEIVED";qE.THREAD_ID=0;let sq=qE;function l_(n=0){de(n===0?"friends-messenger/toggle":`friends-messenger/${n}`)}const rq=()=>Id.RENDERER_VERSION,CP=()=>"2.2.0";function Mu(n){V(new yl(n,!0))}function AP(n){de(`groups/manage/${n}`)}function iI(n,e){de(e?`group-members/${n}/${e}`:`group-members/${n}`)}const QE=class Vf{constructor(e,t,s,r){this.type=e,this.key=t||0,this.color=s||0,this.position=r||4}get code(){return this.key===0&&this.type!==Vf.BASE?null:Vf.getCode(this.type,this.key,this.color,this.position)}static getCode(e,t,s,r){return e+(t<10?"0":"")+t+(s<10?"0":"")+s+r}};QE.BASE="b";QE.SYMBOL="s";let br=QE;class ps{}ps.NOT_MEMBER=0;ps.MEMBER=1;ps.REQUEST_PENDING=2;class Ur{}Ur.REGULAR=0;Ur.EXCLUSIVE=1;Ur.PRIVATE=2;const iq=n=>{V(n.favourite?new Vy(n.groupId):new Py(n.groupId))},JE=n=>V(new Ly(n));class wi{}wi.ACTIVE="active";wi.NONE="none";wi.EXPIRED="expired";const nq="HC1",aq=["ACH_VipHC1","ACH_VipHC2","ACH_VipHC3","ACH_VipHC4","ACH_VipHC5","HC1","HC2","HC3","HC4","HC5"],oq=n=>{let e=null;return aq.forEach(t=>n.indexOf(t)>-1&&(e=t)),e||nq};class id{}id.TOO_MANY_PENDING_CALLS_CODE=1;id.HAS_ABUSIVE_CALL_CODE=2;const lq=n=>n===1?"useless":n===2?"abusive":"resolved";class Ls{}Ls.SELECT_USER=0;Ls.SELECT_CHATS=1;Ls.SELECT_TOPICS=2;Ls.INPUT_REPORT_MESSAGE=3;Ls.REPORT_SUMMARY=4;class bt{}bt.EMERGENCY=1;bt.GUIDE=2;bt.IM=3;bt.ROOM=4;bt.BULLY=6;bt.THREAD=7;bt.MESSAGE=8;bt.PHOTO=9;const cq=n=>{switch(n){case 1:case 2:return"Normal";case 3:return"Automatic";case 4:return"Automatic IM";case 5:return"Guide System";case 6:return"IM";case 7:return"Room";case 8:return"Panic";case 9:return"Guardian";case 10:return"Automatic Helper";case 11:return"Discussion";case 12:return"Selfie";case 14:return"Photo";case 15:return"Ambassador"}return"Unknown"};class gt{constructor(e,t,s,r,i){this._actionId=e,this._name=t,this._actionType=s,this._sanctionTypeId=r,this._actionLengthHours=i}get actionId(){return this._actionId}get name(){return this._name}get actionType(){return this._actionType}get sanctionTypeId(){return this._sanctionTypeId}get actionLengthHours(){return this._actionLengthHours}}gt.ALERT=1;gt.MUTE=2;gt.BAN=3;gt.KICK=4;gt.TRADE_LOCK=5;gt.MESSAGE=6;class ut{}ut.NONE=0;ut.START_DOORBELL=1;ut.START_PASSWORD=2;ut.STATE_PENDING_SERVER=3;ut.UPDATE_STATE=4;ut.STATE_WAITING=5;ut.STATE_NO_ANSWER=6;ut.STATE_WRONG_PASSWORD=7;ut.STATE_ACCEPTED=8;class Gn{}Gn.LIST=0;Gn.THUMBNAILS=1;Gn.FORCED_THUMBNAILS=2;const uq=()=>{const n=[];for(let e=10;e<=100;e=e+10)n.push(e);return n},nI=uq(),Wo=[{name:"anything",query:null},{name:"room.name",query:"roomname"},{name:"owner",query:"owner"},{name:"tag",query:"tag"},{name:"group",query:"group"}];function Wi(n){V(new Bc(n,!1,!0))}class Le{}Le.DEFAULT="default";Le.MOTD="motd";Le.MODERATION="moderation";Le.EVENT="event";Le.NITRO="nitro";Le.SEARCH="search";Le.ALERT="alert";const NP=class Hf{constructor(e,t=Le.DEFAULT,s=null,r=null,i=null,a=null){Hf.ITEM_ID+=1,this._id=Hf.ITEM_ID,this._messages=e,this._alertType=t,this._clickUrl=s,this._clickUrlText=r,this._title=i,this._imageUrl=a}get id(){return this._id}get messages(){return this._messages}set alertType(e){this._alertType=e}get alertType(){return this._alertType}get clickUrl(){return this._clickUrl}get clickUrlText(){return this._clickUrlText}get title(){return this._title}get imageUrl(){return this._imageUrl}};NP.ITEM_ID=-1;let aI=NP;class Bt{}Bt.FRIENDOFFLINE="friendoffline";Bt.FRIENDONLINE="friendonline";Bt.THIRDPARTYFRIENDOFFLINE="thirdpartyfriendoffline";Bt.THIRDPARTYFRIENDONLINE="thirdpartyfriendonline";Bt.ACHIEVEMENT="achievement";Bt.BADGE_RECEIVED="badge_received";Bt.INFO="info";Bt.RECYCLEROK="recyclerok";Bt.RESPECT="respect";Bt.CLUB="club";Bt.SOUNDMACHINE="soundmachine";Bt.PETLEVEL="petlevel";Bt.CLUBGIFT="clubgift";Bt.BUYFURNI="buyfurni";Bt.VIP="vip";Bt.ROOMMESSAGESPOSTED="roommessagesposted";const yP=class jf{constructor(e,t=Bt.INFO,s=null,r=null){jf.ITEM_ID+=1,this._id=jf.ITEM_ID,this._message=e,this._notificationType=t,this._iconUrl=s,this._linkUrl=r}get id(){return this._id}get message(){return this._message}get notificationType(){return this._notificationType}get iconUrl(){return this._iconUrl}get linkUrl(){return this._linkUrl}};yP.ITEM_ID=-1;let hq=yP;const MP=class Wf{constructor(e,t,s,r,i,a,l){Wf.ITEM_ID+=1,this._id=Wf.ITEM_ID,this._confirmType=e,this._message=t,this._onConfirm=s,this._onCancel=r,this._confirmText=i,this._cancelText=a,this._title=l}get id(){return this._id}get confirmType(){return this._confirmType}get message(){return this._message}get onConfirm(){return this._onConfirm}get onCancel(){return this._onCancel}get confirmText(){return this._confirmText}get cancelText(){return this._cancelText}get title(){return this._title}};MP.ITEM_ID=-1;let dq=MP;class ZE{constructor(){this._credits=0,this._activityPoints=new Map,this._clubDays=0,this._clubPeriods=0,this._isVIP=!1,this._pastClubDays=0,this._pastVipDays=0,this._isExpiring=!1,this._minutesUntilExpiration=0,this._minutesSinceLastModified=0,this._lastUpdated=0}static from(e){const t=new ZE;return t._credits=e._credits,t._activityPoints=e._activityPoints,t._clubDays=e._clubDays,t._clubPeriods=e._clubPeriods,t._isVIP=e._isVIP,t._pastClubDays=e._pastClubDays,t._pastVipDays=e._pastVipDays,t._isExpiring=e._isExpiring,t._minutesUntilExpiration=e._minutesUntilExpiration,t._minutesSinceLastModified=e._minutesSinceLastModified,t._lastUpdated=e._lastUpdated,t}get credits(){return this._credits}set credits(e){this._lastUpdated=ve(),this._credits=e}get activityPoints(){return this._activityPoints}set activityPoints(e){this._lastUpdated=ve(),this._activityPoints=e}get clubDays(){return this._clubDays}set clubDays(e){this._lastUpdated=ve(),this._clubDays=e}get clubPeriods(){return this._clubPeriods}set clubPeriods(e){this._lastUpdated=ve(),this._clubPeriods=e}get hasClubLeft(){return this._clubDays>0||this._clubPeriods>0}get isVip(){return this._isVIP}set isVip(e){this._isVIP=e}get pastClubDays(){return this._pastClubDays}set pastClubDays(e){this._lastUpdated=ve(),this._pastClubDays=e}get pastVipDays(){return this._pastVipDays}set pastVipDays(e){this._lastUpdated=ve(),this._pastVipDays=e}get isExpiring(){return this._isExpiring}set isExpiring(e){this._isExpiring=e}get minutesUntilExpiration(){var e=(ve()-this._lastUpdated)/6e4,t=this._minutesUntilExpiration-e;return t>0?t:0}set minutesUntilExpiration(e){this._lastUpdated=ve(),this._minutesUntilExpiration=e}get minutesSinceLastModified(){return this._minutesSinceLastModified}set minutesSinceLastModified(e){this._lastUpdated=ve(),this._minutesSinceLastModified=e}get lastUpdated(){return this._lastUpdated}get clubLevel(){return this.clubDays===0&&this.clubPeriods===0?_r.NO_CLUB:this.isVip?_r.VIP:_r.CLUB}}class Du extends He{}class Bn extends Du{constructor(e,t){super(e),this._id=-1,this._numQuestions=0,this._startMessage="",this._endMessage="",this._questionArray=null,this._pollType="",this._npsPoll=!1,this._id=t}get id(){return this._id}get summary(){return this._summary}set summary(e){this._summary=e}get headline(){return this._headline}set headline(e){this._headline=e}get numQuestions(){return this._numQuestions}set numQuestions(e){this._numQuestions=e}get startMessage(){return this._startMessage}set startMessage(e){this._startMessage=e}get endMessage(){return this._endMessage}set endMessage(e){this._endMessage=e}get questionArray(){return this._questionArray}set questionArray(e){this._questionArray=e}get pollType(){return this._pollType}set pollType(e){this._pollType=e}get npsPoll(){return this._npsPoll}set npsPoll(e){this._npsPoll=e}}Bn.OFFER="RWPUW_OFFER";Bn.ERROR="RWPUW_ERROR";Bn.CONTENT="RWPUW_CONTENT";class ya extends Du{constructor(e,t=0,s=0,r=0){super(e),this._hue=t,this._saturation=s,this._lightness=r}get hue(){return this._hue}get saturation(){return this._saturation}get lightness(){return this._lightness}}ya.PREVIEW="RWUBCPE_PREVIEW";ya.CLEAR_PREVIEW="RWUBCPE_CLEAR_PREVIEW";const c_=class DP extends Du{constructor(e,t){super(DP.CHAT_INPUT_CONTENT),this._chatMode="",this._userName="",this._chatMode=e,this._userName=t}get chatMode(){return this._chatMode}get userName(){return this._userName}};c_.CHAT_INPUT_CONTENT="RWUCICE_CHAT_INPUT_CONTENT";c_.WHISPER="whisper";c_.SHOUT="shout";let bc=c_;const vP=class bP extends Du{constructor(e,t,s,r,i,a,l){super(bP.UPDATE_CHAT),this._objectId=e,this._category=t,this._botId=s,this._chat=r,this._automaticChat=i,this._chatDelay=a,this._mixSentences=l}get objectId(){return this._objectId}get category(){return this._category}get botId(){return this._botId}get chat(){return this._chat}get automaticChat(){return this._automaticChat}get chatDelay(){return this._chatDelay}get mixSentences(){return this._mixSentences}};vP.UPDATE_CHAT="RWURBCE_UPDATE_CHAT";let PP=vP;class st extends Du{constructor(e,t,s,r){super(e),this._id=t,this._category=s,this._roomId=r}get id(){return this._id}get category(){return this._category}get roomId(){return this._roomId}}st.OBJECT_SELECTED="RWUROE_OBJECT_SELECTED";st.OBJECT_DESELECTED="RWUROE_OBJECT_DESELECTED";st.USER_REMOVED="RWUROE_USER_REMOVED";st.FURNI_REMOVED="RWUROE_FURNI_REMOVED";st.FURNI_ADDED="RWUROE_FURNI_ADDED";st.USER_ADDED="RWUROE_USER_ADDED";st.OBJECT_ROLL_OVER="RWUROE_OBJECT_ROLL_OVER";st.OBJECT_ROLL_OUT="RWUROE_OBJECT_ROLL_OUT";st.OBJECT_REQUEST_MANIPULATION="RWUROE_OBJECT_REQUEST_MANIPULATION";st.OBJECT_DOUBLE_CLICKED="RWUROE_OBJECT_DOUBLE_CLICKED";class Fl{constructor(e){this.type=e,this.id=0,this.category=0,this.name="",this.description="",this.image=null,this.isWallItem=!1,this.isStickie=!1,this.isRoomOwner=!1,this.roomControllerLevel=0,this.isAnyRoomController=!1,this.expiration=-1,this.purchaseCatalogPageId=-1,this.purchaseOfferId=-1,this.extraParam="",this.isOwner=!1,this.stuffData=null,this.groupId=0,this.ownerId=0,this.ownerName="",this.usagePolicy=0,this.rentCatalogPageId=-1,this.rentOfferId=-1,this.purchaseCouldBeUsedForBuyout=!1,this.rentCouldBeUsedForBuyout=!1,this.availableForBuildersClub=!1,this.tileSizeX=1,this.tileSizeY=1}}Fl.FURNI="IFI_FURNI";class LP{constructor(e,t,s,r,i,a=!1){this.roomIndex=e,this.category=t,this.id=s,this.name=r,this.userType=i,this.isFriend=a}}class xl{constructor(e){this.type=e,this.level=0,this.maximumLevel=0,this.experience=0,this.levelExperienceGoal=0,this.energy=0,this.maximumEnergy=0,this.happyness=0,this.maximumHappyness=0,this.respectsPetLeft=0,this.respect=0,this.age=0,this.name="",this.id=-1,this.image=null,this.petType=0,this.petBreed=0,this.petFigure="",this.posture="std",this.isOwner=!1,this.ownerId=-1,this.ownerName="",this.canRemovePet=!1,this.roomIndex=0,this.unknownRarityLevel=0,this.saddle=!1,this.rider=!1,this.breedable=!1,this.skillTresholds=[],this.publiclyRideable=0,this.fullyGrown=!1,this.dead=!1,this.rarityLevel=0,this.maximumTimeToLive=0,this.remainingTimeToLive=0,this.remainingGrowTime=0,this.publiclyBreedable=!1}}xl.PET_INFO="IPI_PET_INFO";class wl{constructor(e){this.type=e,this.name="",this.motto="",this.webID=0,this.figure="",this.badges=[],this.carryItem=0,this.roomIndex=0,this.amIOwner=!1,this.amIAnyRoomController=!1,this.roomControllerLevel=0,this.ownerId=-1,this.ownerName="",this.botSkills=[]}}wl.RENTABLE_BOT="IRBI_RENTABLE_BOT";const Wa=class UP{constructor(e){this.type=e,this.name="",this.motto="",this.achievementScore=0,this.webID=0,this.xp=0,this.userType=-1,this.figure="",this.badges=[],this.groupId=0,this.groupName="",this.groupBadgeId="",this.carryItem=0,this.roomIndex=0,this.isSpectatorMode=!1,this.allowNameChange=!1,this.amIOwner=!1,this.amIAnyRoomController=!1,this.roomControllerLevel=0,this.canBeKicked=!1,this.canBeBanned=!1,this.canBeMuted=!1,this.respectLeft=0,this.isIgnored=!1,this.isGuildRoom=!1,this.canTrade=!1,this.canTradeReason=0,this.targetRoomControllerLevel=0,this.isAmbassador=!1}get isOwnUser(){return this.type===UP.OWN_USER}};Wa.OWN_USER="IUI_OWN_USER";Wa.PEER="IUI_PEER";Wa.BOT="IUI_BOT";Wa.TRADE_REASON_OK=0;Wa.TRADE_REASON_SHUTDOWN=2;Wa.TRADE_REASON_NO_TRADING=3;Wa.DEFAULT_BOT_BADGE_ID="BOT";let Ds=Wa;class Yo{static getObjectName(e,t){const s=at();let r=-1,i=null,a=0;switch(t){case k.FLOOR:case k.WALL:{const l=ee().getRoomObject(s.roomId,e,t);if(!l)break;if(l.type.indexOf("poster")===0)i=p("${poster_"+parseInt(l.type.replace("poster",""))+"_name}");else{let c=null;const u=l.model.getValue(C.FURNITURE_TYPE_ID);if(t===k.FLOOR?c=$().getFloorItemData(u):t===k.WALL&&(c=$().getWallItemData(u)),!c)break;r=c.id,i=c.name}break}case k.UNIT:{const l=s.userDataManager.getUserDataByIndex(e);if(!l)break;r=l.webID,i=l.name,a=l.type;break}}return!i||!i.length?null:new LP(e,t,r,i,a)}static getFurniInfo(e,t){const s=at(),r=new Fl(Fl.FURNI);r.id=e,r.category=t;const i=ee().getRoomObject(s.roomId,e,t);if(!i)return;const a=i.model;a.getValue(Kt.INFOSTAND_EXTRA_PARAM)&&(r.extraParam=a.getValue(Kt.INFOSTAND_EXTRA_PARAM));const l=a.getValue(C.FURNITURE_DATA_FORMAT),c=un.getData(l);c.initializeFromRoomObjectModel(a),r.stuffData=c;const u=i.type;if(u.indexOf("poster")===0){const m=parseInt(u.replace("poster",""));r.name=p("${poster_"+m+"_name}"),r.description=p("${poster_"+m+"_desc}")}else{const m=a.getValue(C.FURNITURE_TYPE_ID);let R=null;t===k.FLOOR?R=$().getFloorItemData(m):t===k.WALL&&(R=$().getWallItemData(m)),R&&(r.name=R.name,r.description=R.description,r.purchaseOfferId=R.purchaseOfferId,r.purchaseCouldBeUsedForBuyout=R.purchaseCouldBeUsedForBuyout,r.rentOfferId=R.rentOfferId,r.rentCouldBeUsedForBuyout=R.rentCouldBeUsedForBuyout,r.availableForBuildersClub=R.availableForBuildersClub,r.tileSizeX=R.tileSizeX,r.tileSizeY=R.tileSizeY)}u.indexOf("post_it")>-1&&(r.isStickie=!0);const h=a.getValue(C.FURNITURE_EXPIRY_TIME),d=a.getValue(C.FURNITURE_EXPIRTY_TIMESTAMP);r.expiration=h<0?h:Math.max(0,h-(ve()-d)/1e3);let f=ee().getRoomObjectImage(s.roomId,e,t,new F(180),64,null);(!f.data||f.data.width>140||f.data.height>200)&&(f=ee().getRoomObjectImage(s.roomId,e,t,new F(180),1,null)),r.image=f.getImage(),r.isWallItem=t===k.WALL,r.isRoomOwner=s.isRoomOwner,r.roomControllerLevel=s.controllerLevel,r.isAnyRoomController=$().isModerator,r.ownerId=a.getValue(C.FURNITURE_OWNER_ID),r.ownerName=a.getValue(C.FURNITURE_OWNER_NAME),r.usagePolicy=a.getValue(C.FURNITURE_USAGE_POLICY);const E=a.getValue(C.FURNITURE_GUILD_CUSTOMIZED_GUILD_ID);return E!==0&&(r.groupId=E),tr(i)&&(r.isOwner=!0),r}static getUserInfo(e,t){const s=at();let r=Ds.OWN_USER;t.webID!==$().userId&&(r=Ds.PEER);const i=new Ds(r);i.isSpectatorMode=s.isSpectator,i.name=t.name,i.motto=t.custom,i.achievementScore=t.activityPoints,i.webID=t.webID,i.roomIndex=t.roomIndex,i.userType=Rt.USER;const a=ee().getRoomObject(s.roomId,t.roomIndex,e);if(a&&(i.carryItem=a.model.getValue(C.FIGURE_CARRY_OBJECT)||0),r===Ds.OWN_USER&&(i.allowNameChange=$().canChangeName),i.amIOwner=s.isRoomOwner,i.isGuildRoom=s.isGuildRoom,i.roomControllerLevel=s.controllerLevel,i.amIAnyRoomController=$().isModerator,i.isAmbassador=$().isAmbassador,r===Ds.PEER){if(a){const u=a.model.getValue(C.FIGURE_FLAT_CONTROL);u!==null&&(i.targetRoomControllerLevel=u),i.canBeMuted=this.canBeMuted(i),i.canBeKicked=this.canBeKicked(i),i.canBeBanned=this.canBeBanned(i)}i.isIgnored=$().isUserIgnored(t.name),i.respectLeft=$().respectsLeft;const l=$().isSystemShutdown,c=s.tradeMode;if(l)i.canTrade=!1;else switch(c){case oh.ROOM_CONTROLLER_REQUIRED:{const u=i.roomControllerLevel!==ct.NONE&&i.roomControllerLevel!==ct.GUILD_MEMBER,h=i.targetRoomControllerLevel!==ct.NONE&&i.targetRoomControllerLevel!==ct.GUILD_MEMBER;i.canTrade=u||h;break}case oh.NO_TRADING:i.canTrade=!0;break;default:i.canTrade=!1;break}i.canTradeReason=Ds.TRADE_REASON_OK,l&&(i.canTradeReason=Ds.TRADE_REASON_SHUTDOWN),c!==oh.FREE_TRADING&&(i.canTradeReason=Ds.TRADE_REASON_NO_TRADING)}return i.groupId=t.groupId,i.groupBadgeId=$().getGroupBadge(i.groupId),i.groupName=t.groupName,i.badges=s.userDataManager.getUserBadges(t.webID),i.figure=t.figure,i}static getBotInfo(e,t){const s=at(),r=new Ds(Ds.BOT);r.name=t.name,r.motto=t.custom,r.webID=t.webID,r.roomIndex=t.roomIndex,r.userType=t.type;const i=ee().getRoomObject(s.roomId,t.roomIndex,e);return i&&(r.carryItem=i.model.getValue(C.FIGURE_CARRY_OBJECT)||0),r.amIOwner=s.isRoomOwner,r.isGuildRoom=s.isGuildRoom,r.roomControllerLevel=s.controllerLevel,r.amIAnyRoomController=$().isModerator,r.isAmbassador=$().isAmbassador,r.badges=[Ds.DEFAULT_BOT_BADGE_ID],r.figure=t.figure,r}static getRentableBotInfo(e,t){const s=at(),r=new wl(wl.RENTABLE_BOT);r.name=t.name,r.motto=t.custom,r.webID=t.webID,r.roomIndex=t.roomIndex,r.ownerId=t.ownerId,r.ownerName=t.ownerName,r.botSkills=t.botSkills;const i=ee().getRoomObject(s.roomId,t.roomIndex,e);return i&&(r.carryItem=i.model.getValue(C.FIGURE_CARRY_OBJECT)||0),r.amIOwner=s.isRoomOwner,r.roomControllerLevel=s.controllerLevel,r.amIAnyRoomController=$().isModerator,r.badges=[Ds.DEFAULT_BOT_BADGE_ID],r.figure=t.figure,r}static getPetInfo(e){const t=at(),s=t.userDataManager.getPetData(e.id);if(!s)return;const r=new gn(s.figure);let i=null;r.typeId===be.MONSTERPLANT&&(e.level>=e.adultLevel?i="std":i="grw"+e.level);const a=e.ownerId===$().userId,l=new xl(xl.PET_INFO);return l.name=s.name,l.id=e.id,l.ownerId=e.ownerId,l.ownerName=e.ownerName,l.rarityLevel=e.rarityLevel,l.petType=r.typeId,l.petBreed=r.paletteId,l.petFigure=s.figure,l.posture=i,l.isOwner=a,l.roomIndex=s.roomIndex,l.level=e.level,l.maximumLevel=e.maximumLevel,l.experience=e.experience,l.levelExperienceGoal=e.levelExperienceGoal,l.energy=e.energy,l.maximumEnergy=e.maximumEnergy,l.happyness=e.happyness,l.maximumHappyness=e.maximumHappyness,l.respect=e.respect,l.respectsPetLeft=$().respectsPetLeft,l.age=e.age,l.saddle=e.saddle,l.rider=e.rider,l.breedable=e.breedable,l.fullyGrown=e.fullyGrown,l.dead=e.dead,l.rarityLevel=e.rarityLevel,l.skillTresholds=e.skillTresholds,l.canRemovePet=!1,l.publiclyRideable=e.publiclyRideable,l.maximumTimeToLive=e.maximumTimeToLive,l.remainingTimeToLive=e.remainingTimeToLive,l.remainingGrowTime=e.remainingGrowTime,l.publiclyBreedable=e.publiclyBreedable,(a||t.isRoomOwner||$().isModerator||t.controllerLevel>=ct.GUEST)&&(l.canRemovePet=!0),l}static checkGuildSetting(e){return e.isGuildRoom?e.roomControllerLevel>=ct.GUILD_ADMIN:e.roomControllerLevel>=ct.GUEST}static isValidSetting(e,t){const s=at();if(!s.isPrivateRoom)return!1;const r=s.moderationSettings;let i=!1;return r&&(i=t(e,r)),i&&e.targetRoomControllerLevel<ct.ROOM_OWNER}static canBeMuted(e){const t=(s,r)=>{switch(r.allowMute){case ar.MODERATION_LEVEL_USER_WITH_RIGHTS:return this.checkGuildSetting(s);default:return s.roomControllerLevel>=ct.ROOM_OWNER}};return this.isValidSetting(e,t)}static canBeKicked(e){const t=(s,r)=>{switch(r.allowKick){case ar.MODERATION_LEVEL_ALL:return!0;case ar.MODERATION_LEVEL_USER_WITH_RIGHTS:return this.checkGuildSetting(s);default:return s.roomControllerLevel>=ct.ROOM_OWNER}};return this.isValidSetting(e,t)}static canBeBanned(e){const t=(s,r)=>{switch(r.allowBan){case ar.MODERATION_LEVEL_USER_WITH_RIGHTS:return this.checkGuildSetting(s);default:return s.roomControllerLevel>=ct.ROOM_OWNER}};return this.isValidSetting(e,t)}}class Ze{}Ze.GENERIC_SKILL=0;Ze.DRESS_UP=1;Ze.SETUP_CHAT=2;Ze.RANDOM_WALK=3;Ze.DANCE=4;Ze.CHANGE_BOT_NAME=5;Ze.SERVE_BEVERAGE=6;Ze.INCLIENT_LINK=7;Ze.NUX_PROCEED=8;Ze.CHANGE_BOT_MOTTO=9;Ze.NUX_TAKE_TOUR=10;Ze.NO_PICK_UP=12;Ze.NAVIGATOR_SEARCH=14;Ze.DONATE_TO_USER=24;Ze.DONATE_TO_ALL=25;const FP=class xP{constructor(e=-1,t=-1,s=-1,r="",i="",a="",l=null,c=0,u=0,h=null,d=null){this.senderId=e,this.senderCategory=t,this.roomId=s,this.text=r,this.formattedText=i,this.username=a,this.location=l,this.type=c,this.styleId=u,this.imageUrl=h,this.color=d,this.id=-1,this.width=0,this.height=0,this.elementRef=null,this.skipMovement=!1,this._top=0,this._left=0,this.id=++xP.BUBBLE_COUNTER}get top(){return this._top}set top(e){this._top=e,this.elementRef&&(this.elementRef.style.top=this._top+"px")}get left(){return this._left}set left(e){this._left=e,this.elementRef&&(this.elementRef.style.left=this._left+"px")}};FP.BUBBLE_COUNTER=0;let _q=FP;class Gi{}Gi.CHAT_DEFAULT=0;Gi.CHAT_WHISPER=1;Gi.CHAT_SHOUT=2;class oI{constructor(e=0,t=0,s=0,r=0){this.id=e,this.type=t,this.color=s,this.light=r}}const gq=(n,e,t,s=0)=>!(n.left+s+n.width<e.left+s||n.left+s>e.left+s+e.width||n.top+n.height<e.top+t||n.top>e.top+t+e.height);class Pr{static savePreset(e,t,s,r,i){at().updateMoodlightData(e,t,s,r,i)}static changeState(){at().toggleMoodlightState()}static previewDimmer(e,t,s){ee().updateObjectRoomColor(at().roomId,e,t,s)}static scaleBrightness(e){return~~((e-this.MIN_BRIGHTNESS)*(100-0)/(this.MAX_BRIGHTNESS-this.MIN_BRIGHTNESS)+0)}}Pr.AVAILABLE_COLORS=[7665141,21495,15161822,15353138,15923281,8581961,0];Pr.HTML_COLORS=["#74F5F5","#0053F7","#E759DE","#EA4532","#F2F851","#82F349","#000000"];Pr.MIN_BRIGHTNESS=76;Pr.MAX_BRIGHTNESS=255;const fq=130,mq=100,Eq=130,pq=100,Iq=130,Tq=100,wP=n=>{let e=0,t=0,s=0,r=0;for(;r<n.length;){switch(r%3){case 0:e=e+n.charCodeAt(r)*37;break;case 1:t=t+n.charCodeAt(r)*37;break;case 2:s=s+n.charCodeAt(r)*37;break}r++}return e=e%mq+fq,t=t%pq+Eq,s=s%Tq+Iq,`rgb(${e},${t},${s})`};class Ol{static getMergedMannequinFigureContainer(e,t){const s=fs().createFigureContainer(e),r=fs().createFigureContainer(t);for(const i of this.MANNEQUIN_CLOTHING_PART_TYPES)s.removePart(i);for(const i of r.getPartTypeIds())s.updatePart(i,r.getPartSetId(i),r.getPartColorIds(i));return s}static transformAsMannequinFigure(e){for(const t of e.getPartTypeIds())this.MANNEQUIN_CLOTHING_PART_TYPES.indexOf(t)>=0||e.removePart(t);e.updatePart(this.MANNEQUIN_FIGURE[0],this.MANNEQUIN_FIGURE[1],this.MANNEQUIN_FIGURE[2])}}Ol.MANNEQUIN_FIGURE=["hd",99999,[99998]];Ol.MANNEQUIN_CLOTHING_PART_TYPES=[qe.CHEST_ACCESSORY,qe.COAT_CHEST,qe.CHEST,qe.LEGS,qe.SHOES,qe.WAIST_ACCESSORY];class nd{}nd.POSTURE_STAND=0;nd.POSTURE_SIT=1;class _l{constructor(e,t,s){this._id=e,this._category=t,this._name=s}get id(){return this._id}get category(){return this._category}get name(){return this._name}}class Rq{constructor(e,t,s,r,i,a,l){this.id=e,this.category=t,this.name=s,this.requestRoomObjectId=r,this.targetRoomObjectId=i,this.requestInventoryStripId=a,this.replace=l}}const ad="0",GP="1";class Ei{}Ei.UNSTARTED=-1;Ei.ENDED=0;Ei.PLAYING=1;Ei.PAUSED=2;Ei.BUFFERING=3;Ei.CUED=5;function Sr(n){V(new Mv(n))}const vu=n=>{const e=Math.floor(n/2);return n%2?(e+.5).toString():e.toString()};class Ge{}Ge.TOGGLE_FURNI_STATE=0;Ge.RESET=1;Ge.SET_FURNI_STATE=3;Ge.MOVE_FURNI=4;Ge.GIVE_SCORE=6;Ge.CHAT=7;Ge.TELEPORT=8;Ge.JOIN_TEAM=9;Ge.LEAVE_TEAM=10;Ge.CHASE=11;Ge.FLEE=12;Ge.MOVE_AND_ROTATE_FURNI=13;Ge.GIVE_SCORE_TO_PREDEFINED_TEAM=14;Ge.TOGGLE_TO_RANDOM_STATE=15;Ge.MOVE_FURNI_TO=16;Ge.GIVE_REWARD=17;Ge.CALL_ANOTHER_STACK=18;Ge.KICK_FROM_ROOM=19;Ge.MUTE_USER=20;Ge.BOT_TELEPORT=21;Ge.BOT_MOVE=22;Ge.BOT_TALK=23;Ge.BOT_GIVE_HAND_ITEM=24;Ge.BOT_FOLLOW_AVATAR=25;Ge.BOT_CHANGE_FIGURE=26;Ge.BOT_TALK_DIRECT_TO_AVTR=27;class Ve{}Ve.STATES_MATCH=0;Ve.FURNIS_HAVE_AVATARS=1;Ve.ACTOR_IS_ON_FURNI=2;Ve.TIME_ELAPSED_MORE=3;Ve.TIME_ELAPSED_LESS=4;Ve.USER_COUNT_IN=5;Ve.ACTOR_IS_IN_TEAM=6;Ve.HAS_STACKED_FURNIS=7;Ve.STUFF_TYPE_MATCHES=8;Ve.STUFFS_IN_FORMATION=9;Ve.ACTOR_IS_GROUP_MEMBER=10;Ve.ACTOR_IS_WEARING_BADGE=11;Ve.ACTOR_IS_WEARING_EFFECT=12;Ve.NOT_STATES_MATCH=13;Ve.FURNI_NOT_HAVE_HABBO=14;Ve.NOT_ACTOR_ON_FURNI=15;Ve.NOT_USER_COUNT_IN=16;Ve.NOT_ACTOR_IN_TEAM=17;Ve.NOT_HAS_STACKED_FURNIS=18;Ve.NOT_FURNI_IS_OF_TYPE=19;Ve.NOT_STUFFS_IN_FORMATION=20;Ve.NOT_ACTOR_IN_GROUP=21;Ve.NOT_ACTOR_WEARS_BADGE=22;Ve.NOT_ACTOR_WEARING_EFFECT=23;Ve.DATE_RANGE_ACTIVE=24;Ve.ACTOR_HAS_HANDITEM=25;const lI=n=>`${n.getFullYear()}/${("0"+(n.getMonth()+1)).slice(-2)}/${("0"+n.getDate()).slice(-2)} ${("0"+n.getHours()).slice(-2)}:${("0"+n.getMinutes()).slice(-2)}`;class Se{}Se.STUFF_SELECTION_OPTION_NONE=0;Se.STUFF_SELECTION_OPTION_BY_ID=1;Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE=2;Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT=3;const Oq=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
uniform mat3 projectionMatrix;
varying vec2 vTextureCoord;
void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Sq=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec3 lineColor;
uniform vec3 color;
void main(void) {
    vec4 currentColor = texture2D(uSampler, vTextureCoord);
    vec3 colorLine = lineColor * currentColor.a;
    vec3 colorOverlay = color * currentColor.a;

    if(currentColor.r == 0.0 && currentColor.g == 0.0 && currentColor.b == 0.0 && currentColor.a > 0.0) {
        gl_FragColor = vec4(colorLine.r, colorLine.g, colorLine.b, currentColor.a);
    } else if(currentColor.a > 0.0) {
        gl_FragColor = vec4(colorOverlay.r, colorOverlay.g, colorOverlay.b, currentColor.a);
    }
}`;class Cq extends NT{constructor(e,t){super(Oq,Sq),this.uniforms.lineColor=new Float32Array(3),this.uniforms.color=new Float32Array(3),this.lineColor=e,this.color=t}get lineColor(){return this._lineColor}set lineColor(e){const t=this.uniforms.lineColor;typeof e=="number"?(sr.hex2rgb(e,t),this._lineColor=e):(t[0]=e[0],t[1]=e[1],t[2]=e[2],this._lineColor=sr.rgb2hex(t))}get color(){return this._color}set color(e){const t=this.uniforms.color;typeof e=="number"?(sr.hex2rgb(e,t),this._color=e):(t[0]=e[0],t[1]=e[1],t[2]=e[2],this._color=sr.rgb2hex(t))}}const BP=class nn{static show(e){nn.applySelectionShader(nn.getRoomObject(e))}static hide(e){nn.clearSelectionShader(nn.getRoomObject(e))}static clearSelectionShaderFromFurni(e){for(const t of e)nn.clearSelectionShader(nn.getRoomObject(t))}static applySelectionShaderToFurni(e){for(const t of e)nn.applySelectionShader(nn.getRoomObject(t))}static getRoomObject(e){const t=ee();return t.getRoomObject(t.activeRoomId,e,k.FLOOR)}static applySelectionShader(e){if(!e)return;const t=e.visualization;if(t)for(const s of t.sprites)s.blendMode!==1&&(s.filters=[nn._selectionShader])}static clearSelectionShader(e){if(!e)return;const t=e.visualization;if(t)for(const s of t.sprites)s.filters=[]}};BP._selectionShader=new Cq([1,1,1],[.6,.6,.6]);let Pc=BP;const Gl="	";class zt{}zt.AVATAR_SAYS_SOMETHING=0;zt.AVATAR_WALKS_ON_FURNI=1;zt.AVATAR_WALKS_OFF_FURNI=2;zt.EXECUTE_ONCE=3;zt.TOGGLE_FURNI=4;zt.EXECUTE_PERIODICALLY=6;zt.AVATAR_ENTERS_ROOM=7;zt.GAME_STARTS=8;zt.GAME_ENDS=9;zt.SCORE_ACHIEVED=10;zt.COLLISION=11;zt.EXECUTE_PERIODICALLY_LONG=12;zt.BOT_REACHED_STUFF=13;zt.BOT_REACHED_AVATAR=14;const j=n=>{const{ref:e=null,innerRef:t=null,display:s=null,fit:r=!1,fitV:i=!1,grow:a=!1,shrink:l=!1,fullWidth:c=!1,fullHeight:u=!1,overflow:h=null,position:d=null,float:f=null,pointer:E=!1,visible:m=null,textColor:R=null,classNames:I=[],className:S="",style:A={},children:N=null,...L}=n,M=_.useMemo(()=>{const w=[];return s&&s.length&&w.push("d-"+s),(r||c)&&w.push("w-100"),(r||u)&&w.push("h-100"),i&&w.push("vw-100","vh-100"),a&&w.push("flex-grow-1"),l&&w.push("flex-shrink-0"),h&&w.push("overflow-"+h),d&&w.push("position-"+d),f&&w.push("float-"+f),E&&w.push("cursor-pointer"),m!==null&&w.push(m?"visible":"invisible"),R&&w.push("text-"+R),I.length&&w.push(...I),w},[s,r,i,a,l,c,u,h,d,f,E,m,R,I]),b=_.useMemo(()=>{let w=M.join(" ");return S.length&&(w+=" "+S),w.trim()},[M,S]),B=_.useMemo(()=>{let w={};return Object.keys(A).length&&(w={...w,...A}),w},[A]);return o("div",{ref:t,className:b,style:B,...L,children:N})},kP=_.createContext({isCssGrid:!1}),Aq=n=>o(kP.Provider,{value:n.value,children:n.children}),Nq=()=>_.useContext(kP),ge=n=>{const{inline:e=!1,gap:t=2,maxContent:s=!1,columnCount:r=0,center:i=!1,alignSelf:a=null,alignItems:l=null,justifyContent:c=null,fullHeight:u=!0,classNames:h=[],style:d={},...f}=n,E=_.useMemo(()=>{const R=[];return e?R.push("inline-grid"):R.push("grid"),t?R.push("gap-"+t):t===0&&R.push("gap-0"),s&&R.push("flex-basis-max-content"),a&&R.push("align-self-"+a),l&&R.push("align-items-"+l),c&&R.push("justify-content-"+c),!l&&!c&&i&&R.push("align-items-center","justify-content-center"),h.length&&R.push(...h),R},[e,t,s,a,l,c,i,h]),m=_.useMemo(()=>{let R={};return r&&(R["--bs-columns"]=r.toString()),Object.keys(d).length&&(R={...R,...d}),R},[r,d]);return o(Aq,{value:{isCssGrid:!0},children:o(j,{fullHeight:u,classNames:E,style:m,...f})})},Ot=n=>{const{columnMinWidth:e=40,columnMinHeight:t=40,columnCount:s=0,fullHeight:r=!1,maxContent:i=!0,overflow:a="auto",style:l={},...c}=n,u=_.useMemo(()=>{let h={};return h["--nitro-grid-column-min-height"]=t+"px",s>1&&(h.gridTemplateColumns=`repeat(auto-fill, minmax(${e}px, 1fr))`),Object.keys(l).length&&(h={...h,...l}),h},[e,t,s,l]);return o(ge,{columnCount:s,fullHeight:r,overflow:a,style:u,...c})},P=n=>{const{display:e="flex",column:t=void 0,reverse:s=!1,gap:r=null,center:i=!1,alignSelf:a=null,alignItems:l=null,justifyContent:c=null,classNames:u=[],...h}=n,d=_.useMemo(()=>{const f=[];return t?s?f.push("flex-column-reverse"):f.push("flex-column"):s&&f.push("flex-row-reverse"),r&&f.push("gap-"+r),a&&f.push("align-self-"+a),l&&f.push("align-items-"+l),c&&f.push("justify-content-"+c),!l&&!c&&i&&f.push("align-items-center","justify-content-center"),u.length&&f.push(...u),f},[t,s,r,i,a,l,c,u]);return o(j,{display:e,classNames:d,...h})},H=n=>{const{variant:e="primary",size:t="sm",active:s=!1,disabled:r=!1,classNames:i=[],...a}=n,l=_.useMemo(()=>{const c=["btn"];return e&&c.push("btn-"+e),t&&c.push("btn-"+t),s&&c.push("active"),r&&c.push("disabled"),i.length&&c.push(...i),c},[e,t,s,r,i]);return o(P,{center:!0,classNames:l,...a})},$n=n=>{const{classNames:e=[],...t}=n,s=_.useMemo(()=>{const r=["btn-group"];return e.length&&r.push(...e),r},[e]);return o(j,{classNames:s,...t})},VP=_.createContext({closers:null,setClosers:null,closeAll:null}),yq=n=>o(VP.Provider,{...n}),Mq=()=>_.useContext(VP),od=n=>{const{alignItems:e="center",gap:t=1,children:s=null,...r}=n;return o(P,{alignItems:e,gap:t,...r,children:s})},ld=n=>{const{headerText:e="",isExpanded:t=!1,gap:s=0,classNames:r=[],children:i=null,...a}=n,[l,c]=_.useState(!1),{setClosers:u=null,closeAll:h=null}=Mq(),d=()=>{h(),c(m=>!m)},f=_.useCallback(()=>c(!1),[]),E=_.useMemo(()=>{const m=["nitro-card-accordion-set"];return l&&m.push("active"),r&&r.length&&m.push(...r),m},[l,r]);return _.useEffect(()=>{c(t)},[t]),_.useEffect(()=>{const m=f;return u(R=>{const I=[...R];return I.push(m),I}),()=>{u(R=>{const I=[...R],S=I.indexOf(m);return S>=0&&I.splice(S,1),I})}},[f,u]),g(D,{classNames:E,gap:s,...a,children:[g(P,{pointer:!0,justifyContent:"between",className:"nitro-card-accordion-set-header px-2 py-1",onClick:d,children:[o(y,{children:e}),l&&o($f,{className:"fa-icon"}),!l&&o(em,{className:"fa-icon"})]}),l&&o(D,{fullHeight:!0,overflow:"auto",gap:0,className:"nitro-card-accordion-set-content",children:i})]})},Dq=n=>{const{...e}=n,[t,s]=_.useState([]),r=_.useCallback(()=>{for(const i of t)i()},[t]);return o(yq,{value:{closers:t,setClosers:s,closeAll:r},children:o(D,{gap:0,...e})})},Ee=n=>{const{overflow:e="auto",classNames:t=[],...s}=n,r=_.useMemo(()=>{const i=["container-fluid","content-area"];return t.length&&i.push(...t),i},[t]);return o(D,{classNames:r,overflow:e,...s})},vq=_.createContext({theme:null}),bq=n=>o(vq.Provider,{value:n.value,children:n.children}),Te=n=>{const{headerText:e=null,isGalleryPhoto:t=!1,noCloseButton:s=!1,onReportPhoto:r=null,onCloseClick:i=null,justifyContent:a="center",alignItems:l="center",classNames:c=[],children:u=null,...h}=n,d=_.useMemo(()=>{const E=["drag-handler","container-fluid","nitro-card-header"];return c.length&&E.push(...c),E},[c]);return o(D,{center:!0,position:"relative",classNames:d,...h,children:g(P,{fullWidth:!0,center:!0,children:[o("span",{className:"nitro-card-header-text",children:e}),t&&o(j,{position:"absolute",className:"end-4 nitro-card-header-report-camera",onClick:r,children:o(aU,{className:"fa-icon"})}),o(P,{center:!0,position:"absolute",className:"end-2 nitro-card-header-close",onMouseDownCapture:E=>{E.stopPropagation(),E.nativeEvent.stopImmediatePropagation()},onClick:i,children:o(ei,{className:"fa-icon w-12 h-12"})})]})})},HP=n=>{const{justifyContent:e="center",classNames:t=[],variant:s="muted",...r}=n,i=_.useMemo(()=>{const a=["container-fluid","p-1"];return t.length&&a.push(...t),a.push("bg-"+s),a},[t,s]);return o(P,{justifyContent:e,classNames:i,...r})};class xs{}xs.CENTER="DWP_CENTER";xs.TOP_CENTER="DWP_TOP_CENTER";xs.TOP_LEFT="DWP_TOP_LEFT";xs.NOTHING="DWP_NOTHING";const Nn=[],cI=0,uI=0,Ya=n=>{const{uniqueKey:e=null,handleSelector:t=".drag-handler",windowPosition:s=xs.CENTER,disableDrag:r=!1,dragStyle:i={},children:a=null,offsetLeft:l=0,offsetTop:c=0}=n,[u,h]=_.useState(null),[d,f]=_.useState(null),[E,m]=_.useState({x:0,y:0}),[R,I]=_.useState(!1),[S,A]=_.useState(null),N=_.useRef(),L=_.useCallback(()=>{let J=400;for(const Ce of Nn)J+=1,Ce.style.zIndex=J.toString()},[]),M=_.useCallback(()=>{const J=Nn.indexOf(N.current);if(J===-1)Nn.push(N.current);else{if(J===Nn.length-1)return;J>=0&&(Nn.splice(J,1),Nn.push(N.current))}L()},[L]),b=_.useCallback(J=>{M()},[M]),B=_.useCallback(J=>{M()},[M]),w=_.useCallback((J,Ce)=>{m({x:J,y:Ce}),I(!0)},[]),x=_.useCallback(J=>{w(J.clientX,J.clientY)},[w]),U=_.useCallback(J=>{const Ce=J.touches[0];w(Ce.clientX,Ce.clientY)},[w]),G=_.useCallback(J=>{h({x:J.clientX-E.x,y:J.clientY-E.y})},[E]),K=_.useCallback(J=>{const Ce=J.touches[0];h({x:Ce.clientX-E.x,y:Ce.clientY-E.y})},[E]),Y=_.useCallback(()=>{if(!N.current||!S)return;let J=d.x+u.x,Ce=d.y+u.y;const Ae=N.current.offsetLeft+J,tt=N.current.offsetTop+Ce;if(tt<cI?Ce=-N.current.offsetTop:tt+S.offsetHeight>=document.body.offsetHeight-cI&&(Ce=document.body.offsetHeight-N.current.offsetHeight-N.current.offsetTop),Ae+N.current.offsetWidth<uI?J=-N.current.offsetLeft:Ae>=document.body.offsetWidth-uI&&(J=document.body.offsetWidth-N.current.offsetWidth-N.current.offsetLeft),h({x:0,y:0}),f({x:J,y:Ce}),I(!1),e!==null){const Wt={...wf(`nitro.windows.${e}`)};Wt.offset={x:J,y:Ce},TP(`nitro.windows.${e}`,Wt)}},[S,u,d,e]),te=_.useCallback(J=>{Y()},[Y]),ne=_.useCallback(J=>{Y()},[Y]);return _.useEffect(()=>{const J=N.current;if(!J)return;if(Nn.push(J),L(),!r){const tt=J.querySelector(t);tt&&A(tt)}let Ce=0,Ae=0;switch(s){case xs.TOP_CENTER:J.style.top=50+c+"px",J.style.left=`calc(50vw - ${J.offsetWidth/2+l}px)`;break;case xs.CENTER:J.style.top=`calc(50vh - ${J.offsetHeight/2+c}px)`,J.style.left=`calc(50vw - ${J.offsetWidth/2+l}px)`;break;case xs.TOP_LEFT:J.style.top=50+c+"px",J.style.left=50+l+"px";break}return h({x:0,y:0}),f({x:Ce,y:Ae}),()=>{const tt=Nn.indexOf(J);tt>=0&&Nn.splice(tt,1)}},[t,s,e,r,l,c,L]),_.useEffect(()=>{if(!d&&!u)return;const J=N.current;J&&(J.style.transform=`translate(${d.x+u.x}px, ${d.y+u.y}px)`,J.style.visibility="visible")},[d,u]),_.useEffect(()=>{if(S)return S.addEventListener(ie.MOUSE_DOWN,x),S.addEventListener(Ks.TOUCH_START,U),()=>{S.removeEventListener(ie.MOUSE_DOWN,x),S.removeEventListener(Ks.TOUCH_START,U)}},[S,x,U]),_.useEffect(()=>{if(R)return document.addEventListener(ie.MOUSE_UP,te),document.addEventListener(Ks.TOUCH_END,ne),document.addEventListener(ie.MOUSE_MOVE,G),document.addEventListener(Ks.TOUCH_MOVE,K),()=>{document.removeEventListener(ie.MOUSE_UP,te),document.removeEventListener(Ks.TOUCH_END,ne),document.removeEventListener(ie.MOUSE_MOVE,G),document.removeEventListener(Ks.TOUCH_MOVE,K)}},[R,te,G,ne,K]),_.useEffect(()=>{if(!e)return;const J=wf(`nitro.windows.${e}`);!J||!J.offset||(h({x:0,y:0}),J.offset&&f(J.offset))},[e]),tm.createPortal(o(j,{position:"absolute",innerRef:N,className:"draggable-window",onMouseDownCapture:b,onTouchStartCapture:B,style:i,children:a}),document.getElementById("draggable-windows-container"))},Re=n=>{const{theme:e="primary",uniqueKey:t=null,handleSelector:s=".drag-handler",windowPosition:r=xs.CENTER,disableDrag:i=!1,overflow:a="hidden",position:l="relative",gap:c=0,classNames:u=[],...h}=n,d=_.useRef(),f=_.useMemo(()=>{const E=["nitro-card","rounded","shadow"];return E.push(`theme-${e||"primary"}`),u.length&&E.push(...u),E},[e,u]);return o(bq,{value:{theme:e},children:o(Ya,{uniqueKey:t,handleSelector:s,windowPosition:r,disableDrag:i,children:o(D,{innerRef:d,overflow:a,position:l,gap:c,classNames:f,...h})})})},as=n=>{const{figure:e="",gender:t="M",headOnly:s=!1,direction:r=0,scale:i=1,classNames:a=[],style:l={},...c}=n,[u,h]=_.useState(null),[d,f]=_.useState(-1),E=_.useRef(!1),m=_.useMemo(()=>{const I=["avatar-image"];return a.length&&I.push(...a),I},[a]),R=_.useMemo(()=>{let I={};return u&&u.length&&(I.backgroundImage=`url('${u}')`),i!==1&&(I.transform=`scale(${i})`,i%1||(I.imageRendering="pixelated")),Object.keys(l).length&&(I={...I,...l}),I},[u,i,l]);return _.useEffect(()=>{const I=fs().createAvatarImage(e,Xr.LARGE,t,{resetFigure:N=>{E.current||f(Math.random())},dispose:()=>{},disposed:!1},null);if(!I)return;let S=bs.FULL;s&&(S=bs.HEAD),I.setDirection(S,r);const A=I.getCroppedImage(S);A&&h(A.src),I.dispose()},[e,t,r,s,d]),_.useEffect(()=>(E.current=!1,()=>{E.current=!0}),[]),o(j,{classNames:m,style:R,...c})},jP=n=>{const{imageUrl:e=null,fit:t=!0,style:s=null,...r}=n,i=_.useMemo(()=>{const a={...s};return e&&(a.background=`url(${e}) center no-repeat`),a},[s,e]);return o(j,{fit:t,style:i,...r})},xt=n=>{const{badgeCode:e=null,isGroup:t=!1,showInfo:s=!1,customTitle:r=null,isGrayscale:i=!1,scale:a=1,classNames:l=[],style:c={},children:u=null,...h}=n,[d,f]=_.useState(null),E=_.useMemo(()=>{const R=["badge-image"];return t&&R.push("group-badge"),i&&R.push("grayscale"),l.length&&R.push(...l),R},[l,t,i]),m=_.useMemo(()=>{let R={};return d&&(R.backgroundImage=`url(${t?d.src:ce("badge.asset.url").replace("%badgename%",e.toString())})`,R.width=d.width,R.height=d.height,a!==1&&(R.transform=`scale(${a})`,a%1||(R.imageRendering="pixelated"),R.width=d.width*a,R.height=d.height*a)),Object.keys(c).length&&(R={...R,...c}),R},[d,a,c]);return _.useEffect(()=>{if(!e||!e.length)return;let R=!1;const I=A=>{if(A.badgeId!==e)return;const N=ht.generateImage(new jt(A.image));N.onload=()=>f(N),R=!0,$().events.removeEventListener(To.IMAGE_READY,I)};$().events.addEventListener(To.IMAGE_READY,I);const S=t?$().getGroupBadgeImage(e):$().getBadgeImage(e);if(S&&!R){const A=ht.generateImage(new jt(S));A.onload=()=>f(A)}return()=>$().events.removeEventListener(To.IMAGE_READY,I)},[e,t]),g(j,{classNames:E,style:m,...h,children:[s&&ce("badge.descriptions.enabled",!0)&&g(j,{className:"badge-information text-black py-1 px-2 small",children:[o("div",{className:"fw-bold mb-1",children:t?r:Au(e)}),o("div",{children:t?p("group.badgepopup.body"):zE(e)})]}),u]})},Pq=n=>{const{day:e="00",hour:t="00",minutes:s="00",seconds:r="00",classNames:i=[],children:a=null,...l}=n,c=_.useMemo(()=>{const u=["nitro-counter-time"];return i.length&&u.push(...i),u},[i]);return g(P,{gap:1,children:[o(j,{classNames:c,...l,children:g("div",{children:[e!="00"?e:t,e!="00"?p("countdown_clock_unit_days"):p("countdown_clock_unit_hours")]})}),o(j,{style:{marginTop:"3px"},children:":"}),o(j,{classNames:c,...l,children:g("div",{children:[s,p("countdown_clock_unit_minutes")]})}),o(j,{style:{marginTop:"3px"},children:":"}),o(j,{classNames:c,...l,children:g("div",{children:[r,p("countdown_clock_unit_seconds")]})}),a]})},gs=n=>{const{type:e="",classNames:t=[],style:s={},...r}=n,i=_.useMemo(()=>{const c=["nitro-currency-icon"];return t.length&&c.push(...t),c},[t]),a=_.useMemo(()=>{let c=ce("currency.asset.icon.url","");return c=c.replace("%type%",e.toString()),`url(${c})`},[e]),l=_.useMemo(()=>{let c={};return c.backgroundImage=a,Object.keys(s).length&&(c={...c,...s}),c},[s,a]);return o(j,{classNames:i,style:l,...r})},$E=n=>{const{productType:e="s",productClassId:t=-1,direction:s=2,extraData:r="",scale:i=1,style:a={},...l}=n,[c,u]=_.useState(null),h=_.useMemo(()=>{var f;let d={};return(f=c==null?void 0:c.src)!=null&&f.length&&(d.backgroundImage=`url('${c.src}')`,d.width=c.width,d.height=c.height),i!==1&&(d.transform=`scale(${i})`,i%1||(d.imageRendering="pixelated")),Object.keys(a).length&&(d={...d,...a}),d},[c,i,a]);return _.useEffect(()=>{let d=null;const f={imageReady:(E,m,R)=>{!R&&m&&(R=ht.generateImage(m)),R.onload=()=>u(R)},imageFailed:null};switch(e.toLocaleLowerCase()){case Pe.FLOOR:d=ee().getFurnitureFloorImage(t,new F(s),64,f,0,r);break;case Pe.WALL:d=ee().getFurnitureWallImage(t,new F(s),64,f,0,r);break}if(d){const E=d.getImage();E.onload=()=>u(E)}},[e,t,s,r]),c?o(j,{classNames:["furni-image"],style:h,...l}):null},WP=n=>{const{figure:e=null,userName:t=null,message:s=null,editable:r=!1,onChange:i=null}=n;return g(P,{overflow:"hidden",className:"nitro-gift-card text-black",children:[g("div",{className:"d-flex align-items-center justify-content-center gift-face flex-shrink-0",children:[!t&&o("div",{className:"gift-incognito"}),e&&o("div",{className:"gift-avatar",children:o(as,{figure:e,direction:2,headOnly:!0})})]}),o(P,{overflow:"hidden",className:"w-100 pt-4 pb-4 pe-4 ps-3",children:g(D,{grow:!0,overflow:"auto",justifyContent:"between",children:[!r&&o(y,{textBreak:!0,className:"gift-message",children:s}),r&&i!==null&&o("textarea",{className:"gift-message h-100",maxLength:140,value:s,onChange:a=>i(a.target.value),placeholder:p("catalog.gift_wrapping_new.message_hint")}),t&&o(y,{italics:!0,textEnd:!0,className:"pe-1",children:p("catalog.gift_wrapping_new.message_from",["name"],[t])})]})})]})},D=n=>{const{size:e=0,offset:t=0,column:s=!0,gap:r=2,classNames:i=[],...a}=n,{isCssGrid:l=!1}=Nq(),c=_.useMemo(()=>{const u=[];if(e){let h=`col-${e}`;l&&(h=`g-${h}`),u.push(h)}if(t){let h=`offset-${t}`;l&&(h=`g-start-${t}`),u.push(h)}return i.length&&u.push(...i),u},[e,t,l,i]);return o(P,{classNames:c,column:s,gap:r,...a})},So=n=>{const{count:e=0,position:t="absolute",classNames:s=[],children:r=null,...i}=n,a=_.useMemo(()=>{const l=["badge","border","border-black","bg-danger","px-1","nitro-item-count"];return s.length&&l.push(...s),l},[s]);return g(j,{position:"absolute",classNames:a,...i,children:[e,r]})},qc=n=>{const{value:e=0}=n,t=e.toString().split("");return o(X,{children:t.map((s,r)=>o("i",{className:"limited-edition-number n-"+s},r))})},YP=n=>{const{uniqueNumber:e=0,uniqueSeries:t=0,classNames:s=[],children:r=null,...i}=n,a=_.useMemo(()=>{const l=["unique-compact-plate","z-index-1"];return s.length&&l.push(...s),l},[s]);return g(j,{classNames:a,...i,children:[o("div",{children:o(qc,{value:e})}),o("div",{children:o(qc,{value:t})}),r]})},Lq=n=>{const{uniqueLimitedItemsLeft:e=0,uniqueLimitedSeriesSize:t=0,classNames:s=[],...r}=n,i=_.useMemo(()=>{const a=["unique-complete-plate"];return s.length&&a.push(...s),a},[s]);return o(j,{classNames:i,...r,children:g(D,{className:"plate-container",gap:0,children:[g(P,{justifyContent:"between",alignItems:"center",children:[p("unique.items.left"),o("div",{children:o(qc,{value:e})})]}),g(P,{justifyContent:"between",alignItems:"center",children:[p("unique.items.number.sold"),o("div",{children:o(qc,{value:t})})]})]})})},Qe=n=>{const{itemImage:e=void 0,itemColor:t=void 0,itemActive:s=!1,itemCount:r=1,itemCountMinimum:i=1,itemUniqueSoldout:a=!1,itemUniqueNumber:l=-2,itemUnseen:c=!1,itemHighlight:u=!1,disabled:h=!1,center:d=!0,column:f=!0,style:E={},classNames:m=[],position:R="relative",overflow:I="hidden",children:S=null,...A}=n,N=_.useMemo(()=>{const M=["layout-grid-item","border","border-2","border-muted","rounded"];return s&&M.push("active"),(a||l>0)&&M.push("unique-item"),a&&M.push("sold-out"),c&&M.push("unseen"),u&&M.push("has-highlight"),h&&M.push("disabled"),e===null&&M.push("icon","loading-icon"),m.length&&M.push(...m),M},[s,a,l,c,u,h,e,m]),L=_.useMemo(()=>{let M={...E};return e&&!(a||l>0)&&(M.backgroundImage=`url(${e})`),t&&(M.backgroundColor=t),Object.keys(E).length&&(M={...M,...E}),M},[E,e,t,a,l]);return g(D,{center:d,pointer:!0,position:R,overflow:I,column:f,classNames:N,style:L,...A,children:[r>i&&o(So,{count:r}),l>0&&g(X,{children:[o(j,{fit:!0,className:"unique-bg-override",style:{backgroundImage:`url(${e})`}}),o("div",{className:"position-absolute bottom-0 unique-item-counter",children:o(qc,{value:l})})]}),S]})},Sn=n=>{const{imageUrl:e=null,className:t="",...s}=n;return o("img",{src:e,className:"no-select "+t,alt:"",...s})},ep=n=>{const{...e}=n;return g(j,{classNames:["spinner-container"],...e,children:[o(j,{className:"spinner"}),o(j,{className:"spinner"}),o(j,{className:"spinner"})]})},Uq=n=>{const{roomId:e=-1,textureReceiver:t=null,onClose:s=null}=n,r=_.useRef(),i=()=>{if(!r||!r.current)return null;const l=r.current.getBoundingClientRect();return new yT(Math.floor(l.x),Math.floor(l.y),Math.floor(l.width),Math.floor(l.height))},a=()=>{mn(kr.CAMERA_SHUTTER),t(ee().createTextureFromRoom(e,1,i()))};return o(Ya,{handleSelector:".nitro-room-thumbnail-camera",children:g("div",{className:"nitro-room-thumbnail-camera px-2",children:[o("div",{ref:r,className:"camera-frame"}),g("div",{className:"d-flex align-items-end h-100 pb-2",children:[o("button",{className:"btn btn-sm btn-danger w-100 mb-1 me-2",onClick:s,children:p("cancel")}),o("button",{className:"btn btn-sm btn-success w-100 mb-1",onClick:a,children:p("navigator.thumbeditor.save")})]})]})})},u_=n=>{const{title:e="",onClose:t=null,classNames:s=[],children:r=null,type:i=Le.DEFAULT,...a}=n,l=_.useMemo(()=>{const c=["nitro-alert"];return c.push("nitro-alert-"+i),s.length&&c.push(...s),c},[s,i]);return g(Re,{classNames:l,theme:"primary-slim",...a,children:[o(Te,{headerText:e,onCloseClick:t}),o(Ee,{grow:!0,justifyContent:"between",overflow:"hidden",className:"text-black",gap:0,children:r})]})};class vs{}vs.BOUNCE="bounce";vs.SLIDE_LEFT="slideLeft";vs.SLIDE_RIGHT="slideRight";vs.FLIP_X="flipX";vs.FADE_IN="fadeIn";vs.FADE_DOWN="fadeDown";vs.FADE_UP="fadeUp";vs.HEAD_SHAKE="headShake";function Fq(n,e,t=300){switch(n){case vs.BOUNCE:switch(e){default:return{};case ha:return{animationName:"bounceIn",animationDuration:`${t}ms`};case Za:return{animationName:"bounceOut",animationDuration:`${t}ms`}}case vs.SLIDE_LEFT:switch(e){default:return{};case ha:return{animationName:"slideInLeft",animationDuration:`${t}ms`};case Za:return{animationName:"slideOutLeft",animationDuration:`${t}ms`}}case vs.SLIDE_RIGHT:switch(e){default:return{};case ha:return{animationName:"slideInRight",animationDuration:`${t}ms`};case Za:return{animationName:"slideOutRight",animationDuration:`${t}ms`}}case vs.FLIP_X:switch(e){default:return{};case ha:return{animationName:"flipInX",animationDuration:`${t}ms`};case Za:return{animationName:"flipOutX",animationDuration:`${t}ms`}}case vs.FADE_UP:switch(e){default:return{};case ha:return{animationName:"fadeInUp",animationDuration:`${t}ms`};case Za:return{animationName:"fadeOutDown",animationDuration:`${t}ms`}}case vs.FADE_IN:switch(e){default:return{};case ha:return{animationName:"fadeIn",animationDuration:`${t}ms`};case Za:return{animationName:"fadeOut",animationDuration:`${t}ms`}}case vs.FADE_DOWN:switch(e){default:return{};case ha:return{animationName:"fadeInDown",animationDuration:`${t}ms`};case Za:return{animationName:"fadeOutUp",animationDuration:`${t}ms`}}case vs.HEAD_SHAKE:switch(e){default:return{};case ha:return{animationName:"headShake",animationDuration:`${t}ms`}}}return null}const h_=n=>{const{type:e=null,inProp:t=!1,timeout:s=300,className:r=null,children:i=null}=n,[a,l]=_.useState(!1);return _.useEffect(()=>{let c=null;return t?l(!0):c=setTimeout(()=>{l(!1),clearTimeout(s)},s),()=>{c&&clearTimeout(c)}},[t,s]),o(oU,{in:t,timeout:s,children:c=>o("div",{className:(r??"")+" animate__animated",style:{...Fq(e,c,s)},children:a&&i})})},tp=n=>{const{fadesOut:e=!0,timeoutMs:t=8e3,onClose:s=null,overflow:r="hidden",classNames:i=[],...a}=n,[l,c]=_.useState(!1),u=_.useMemo(()=>{const h=["nitro-notification-bubble","rounded"];return i.length&&h.push(...i),h},[i]);return _.useEffect(()=>(c(!0),()=>c(!1)),[]),_.useEffect(()=>{if(!e)return;const h=setTimeout(()=>{c(!1),setTimeout(()=>s(),300)},t);return()=>clearTimeout(h)},[e,t,s]),o(h_,{type:vs.FADE_IN,inProp:l,timeout:300,children:o(P,{overflow:r,classNames:u,onClick:s,...a})})},cn=n=>{const{figure:e="",typeId:t=-1,paletteId:s=-1,petColor:r=16777215,customParts:i=[],posture:a="std",headOnly:l=!1,direction:c=0,scale:u=1,style:h={},...d}=n,[f,E]=_.useState(null),[m,R]=_.useState(0),[I,S]=_.useState(0),A=_.useRef(!1),N=_.useMemo(()=>{let L={};return f&&f.length&&(L.backgroundImage=`url(${f})`),u!==1&&(L.transform=`scale(${u})`,u%1||(L.imageRendering="pixelated")),L.width=m,L.height=I,Object.keys(h).length&&(L={...L,...h}),L},[f,u,h,m,I]);return _.useEffect(()=>{let L=t,M=s,b=r,B=i,w=l;if(e&&e.length){const U=new gn(e);L=U.typeId,M=U.paletteId,b=U.color,B=U.customParts}L===16&&(w=!1);const x=ee().getRoomObjectPetImage(L,M,b,new F(c*45),64,{imageReady:(U,G,K)=>{A.current||(K?(E(K.src),R(K.width),S(K.height)):G&&(E(ht.generateImageUrl(G)),R(G.width),S(G.height)))},imageFailed:U=>{}},w,0,B,a);if(x){const U=x.getImage();U&&(E(U.src),R(U.width),S(U.height))}},[e,t,s,r,i,a,l,c]),_.useEffect(()=>(A.current=!1,()=>{A.current=!0}),[]),o(j,{classNames:["pet-image"],style:N,...d})},sp=n=>{const{text:e="",progress:t=0,maxProgress:s=100,position:r="relative",justifyContent:i="center",classNames:a=[],children:l=null,...c}=n,u=_.useMemo(()=>{const h=["nitro-progress-bar","text-white"];return a.length&&h.push(...a),h},[a]);return g(D,{position:r,justifyContent:i,classNames:u,...c,children:[e&&e.length>0&&o(P,{fit:!0,center:!0,position:"absolute",className:"nitro-progress-bar-text small",children:e}),o(j,{className:"nitro-progress-bar-inner",style:{width:~~((t-0)*(100-0)/(s-0)+0)+"%"}}),l]})},rp=n=>{const{level:e=0,classNames:t=[],children:s=null,...r}=n,i=_.useMemo(()=>{const a=["nitro-rarity-level"];return t.length&&a.push(...t),a},[t]);return g(j,{classNames:i,...r,children:[o("div",{children:e}),s]})},d_=n=>{const{roomPreviewer:e=null,height:t=0,children:s=null}=n,[r,i]=_.useState(null),a=_.useRef(),l=c=>{e&&(c.shiftKey?e.changeRoomObjectDirection():e.changeRoomObjectState())};return _.useEffect(()=>{if(!e)return;const c=h=>{!e||!r||!a.current||(e.updatePreviewRoomView(),r.canvasUpdated&&(a.current.style.backgroundImage=`url(${ht.generateImageUrl(r.master)})`))};if(!r&&a.current&&e){let d=document.defaultView.getComputedStyle(a.current,null).backgroundColor;d=sr.rgbStringToHex(d),d=d.replace("#","0x"),e.backgroundColor=parseInt(d,16);const f=a.current.parentElement.clientWidth;e.getRoomCanvas(f,t);const E=e.getRenderingCanvas();i(E),E.canvasUpdated=!0,c()}qs().add(c);const u=new ResizeObserver(()=>{if(!e||!a.current)return;const h=a.current.parentElement.offsetWidth;e.modifyRoomCanvas(h,t),c()});return u.observe(a.current),()=>{u.disconnect(),qs().remove(c)}},[r,e,a,t]),g("div",{className:"room-preview-container",children:[o("div",{ref:a,className:"room-preview-image",style:{height:t},onClick:l}),s]})},__=n=>{const{roomId:e=-1,customUrl:t=null,shrink:s=!0,overflow:r="hidden",classNames:i=[],children:a=null,...l}=n,c=_.useMemo(()=>{const h=["room-thumbnail","rounded","border"];return i.length&&h.push(...i),h},[i]),u=_.useMemo(()=>t&&t.length?ce("image.library.url")+t:ce("thumbnails.url").replace("%thumbnail%",e.toString()),[t,e]);return g(j,{shrink:s,overflow:r,classNames:c,...l,children:[u&&o("img",{alt:"",src:u}),a]})},zP=n=>{const{color:e="",message:t="",date:s="",senderName:r="",customTitle:i=null,onCloseClick:a=null}=n;return o(Ya,{handleSelector:".drag-handler",children:g(D,{gap:0,alignItems:"center",className:`nitro-layout-trophy trophy-${e}`,children:[g(P,{center:!0,fullWidth:!0,position:"relative",className:"trophy-header drag-handler",children:[o(j,{position:"absolute",pointer:!0,className:"trophy-close",onClick:a}),o(y,{bold:!0,children:p("widget.furni.trophy.title")})]}),g(D,{className:"trophy-content py-1",gap:1,children:[i&&o(y,{bold:!0,children:i}),t]}),g(P,{alignItems:"center",justifyContent:"between",className:"trophy-footer mt-1",children:[o(y,{bold:!0,children:s}),o(y,{bold:!0,children:r})]})]})})},Ci=n=>{const{userId:e=0,userName:t=null,classNames:s=[],pointer:r=!0,children:i=null,...a}=n,l=_.useMemo(()=>{const c=["nitro-friends-spritesheet","icon-profile-sm"];return s.length&&c.push(...s),c},[s]);return o(j,{classNames:l,pointer:r,onClick:c=>Sr(e),...a,children:i})},Yi=n=>{const{isActive:e=!1,count:t=0,overflow:s="hidden",position:r="relative",pointer:i=!0,classNames:a=[],children:l=null,...c}=n,u=_.useMemo(()=>{const h=["nav-item","rounded-top","border"];return e&&h.push("active"),a.length&&h.push(...a),h},[e,a]);return g(P,{overflow:s,pointer:i,position:r,classNames:u,...c,children:[o(P,{shrink:!0,center:!0,children:l}),t>0&&o(So,{count:t})]})},aa=n=>{const{justifyContent:e="center",gap:t=1,classNames:s=[],children:r=null,...i}=n,a=_.useMemo(()=>{const l=["container-fluid","nitro-card-tabs","pt-1"];return s.length&&l.push(...s),l},[s]);return o(P,{justifyContent:e,gap:t,classNames:a,...i,children:r})},$s=(...n)=>n.filter(Boolean).join(" "),xq=n=>{const{classNames:e=[],...t}=n,s=_.useMemo(()=>{const r=["form-group"];return e.length&&r.push(...e),r},[e]);return o(P,{classNames:s,...t})},wq=n=>{const{variant:e="black",height:t=1,classNames:s=[],style:r={},...i}=n,a=_.useMemo(()=>{const c=[];return e&&c.push("bg-"+e),s.length&&c.push(...s),c},[e,s]),l=_.useMemo(()=>{let c={display:"list-item"};return t>0&&(c.height=t),Object.keys(r).length&&(c={...c,...r}),c},[t,r]);return o(j,{classNames:a,style:l,...i})},g_=n=>{var E,m;const{rows:e=[],overscan:t=5,scrollToBottom:s=!1,rowRender:r=null}=n,[i,a]=_.useState(e.length-1),l=_.useRef(null),{virtualItems:c=[],totalSize:u=0,scrollToIndex:h=null}=lU({parentRef:l,size:e.length,overscan:t}),d=c.length>0&&((E=c==null?void 0:c[0])==null?void 0:E.start)||0,f=c.length>0?u-(((m=c==null?void 0:c[c.length-1])==null?void 0:m.end)||0):0;return _.useEffect(()=>{s&&h(i)},[s,i,h]),g(j,{fit:!0,innerRef:l,position:"relative",overflow:"auto",children:[d>0&&o("div",{style:{minHeight:`${d}px`}}),c.map(R=>{const I=e[R.index];return I?o("div",{"data-index":R.index,ref:R.measureRef,children:r(I)},R.key):o(_.Fragment,{},R.key)}),f>0&&o("div",{style:{minHeight:`${f}px`}})]})},y=n=>{const{variant:e="black",fontWeight:t=null,fontSize:s=0,align:r=null,bold:i=!1,underline:a=!1,italics:l=!1,truncate:c=!1,center:u=!1,textEnd:h=!1,small:d=!1,wrap:f=!1,noWrap:E=!1,textBreak:m=!1,...R}=n,I=_.useMemo(()=>{const S=["d-inline"];return e&&S.push("text-"+e),i&&S.push("fw-bold"),t&&S.push("fw-"+t),s&&S.push("fs-"+s),r&&S.push("text-"+r),a&&S.push("text-decoration-underline"),l&&S.push("fst-italic"),c&&S.push("text-truncate"),u&&S.push("text-center"),h&&S.push("text-end"),d&&S.push("small"),f&&S.push("text-wrap"),E&&S.push("text-nowrap"),m&&S.push("text-break"),S},[e,t,s,r,i,a,l,c,u,h,d,f,E,m]);return o(j,{classNames:I,...R})},Gq=n=>{const{isError:e=!1,message:t="",percent:s=0}=n;return o(D,{fullHeight:!0,position:"relative",className:"nitro-loading",children:o(j,{fullHeight:!0,className:"container h-100",children:g(D,{fullHeight:!0,alignItems:"center",justifyContent:"end",children:[o(j,{className:"connecting-duck"}),o(D,{size:6,className:"text-center py-4",children:e&&t&&t.length?o(j,{className:"fs-4 text-shadow",children:t}):g(X,{children:[g(y,{fontSize:4,variant:"white",className:"text-shadow",children:[s.toFixed(),"%"]}),o(sp,{progress:s,className:"mt-2 large"})]})})]})})})},oa=(n,e,t,s=!0)=>{_.useEffect(()=>{if(s)return Array.isArray(n)?n.map(r=>e.addEventListener(r,t)):e.addEventListener(n,t),()=>{Array.isArray(n)?n.map(r=>e.removeEventListener(r,t)):e.removeEventListener(n,t)}},[n,e,s,t])},hI=(n,e)=>oa(n,c6().events,e),Bq=(n,e)=>oa(n,ze().cameraManager.events,e),kq=(n,e)=>oa(n,ze().localization.events,e),eo=(n,e)=>oa(n,ze().events,e),$e=(n,e)=>oa(n,ee().events,e),kt=(n,e)=>oa(n,wo().events,e),Vq=(n,e)=>oa(n,$().events,e),_o=(n,e,t=!0)=>oa(n,ze().soundManager.events,e,t),z=(n,e)=>{_.useEffect(()=>{const t=new n(e);return Wc().registerMessageEvent(t),()=>Wc().removeMessageEvent(t)},[n,e])},Ts=(n,e,t=!0)=>oa(n,fn,e,t),Hq=()=>{const[n,e]=_.useState(!0),[t,s]=_.useState([]),[r,i]=_.useState(null),[a,l]=_.useState(-1),[c,u]=_.useState(0),h=_.useMemo(()=>{let S=0;return t.forEach(A=>S+=wr.getAchievementCategoryTotalUnseen(A)),S},[t]),d=_.useMemo(()=>{let S=0;return t.forEach(A=>S+=A.getProgress()),S},[t]),f=_.useMemo(()=>{let S=0;return t.forEach(A=>S+=A.getMaxProgress()),S},[t]),E=_.useMemo(()=>~~((d-0)*(100-0)/(f-0)+0),[d,f]),m=_.useMemo(()=>r===null?null:t.find(S=>S.code===r),[t,r]),R=_.useMemo(()=>a===-1||!m?null:m.achievements.find(S=>S.achievementId===a),[m,a]),I=_.useCallback((S,A)=>{s(N=>{const L=[...N];for(const M of L)if(M.code===S)for(const b of M.achievements)b.achievementId===A&&(b.unseen=0);return L})},[]);return z(eC,S=>{const N=S.getParser().achievement;s(L=>{const M=[...L],b=M.findIndex(B=>B.code===N.category);if(b===-1){const B=new qp(N.category);B.achievements.push(N),M.push(B)}else{const B=dr(M[b]),w=[...B.achievements],x=w.findIndex(G=>G.achievementId===N.achievementId);let U=null;x===-1?w.push(N):(U=w[x],w[x]=N),wr.getAchievementIsIgnored(N)||(N.unseen++,U&&(N.unseen+=U.unseen)),B.achievements=w,M[b]=B}return M})}),z(tC,S=>{const A=S.getParser(),N=[];for(const L of A.achievements){const M=L.category;let b=N.find(B=>B.code===M);b||(b=new qp(M),N.push(b)),b.achievements.push(L)}s(N)}),z(sC,S=>{const A=S.getParser();u(A.score)}),_.useEffect(()=>{n&&(V(new wN),e(!1))},[n]),_.useEffect(()=>{!r||a===-1||I(r,a)},[r,a,I]),{achievementCategories:t,selectedCategoryCode:r,setSelectedCategoryCode:i,selectedAchievementId:a,setSelectedAchievementId:l,achievementScore:c,getTotalUnseen:h,getProgress:d,getMaxProgress:f,scaledProgressPercent:E,selectedCategory:m,selectedAchievement:R,setAchievementSeen:I}},f_=()=>os(Hq),jq=()=>{const[n,e]=_.useState([]),[t,s]=_.useState([]),[r,i]=_.useState(-1),[a,l]=_.useState(10),[c,u]=_.useState(null);return Bq(Nh.INITIALIZED,h=>{e(Array.from(vc().effects.values()))}),z(iS,h=>{const d=h.getParser();u({credits:d.creditPrice,duckets:d.ducketPrice,publishDucketPrice:d.publishDucketPrice})}),_.useEffect(()=>{if(!vc().isLoaded){vc().init(),V(new WN);return}},[]),{availableEffects:n,cameraRoll:t,setCameraRoll:s,selectedPictureIndex:r,setSelectedPictureIndex:i,myLevel:a,price:c}},KP=()=>os(jq);class Vr extends He{}Vr.SHOW_CATALOG="CE_SHOW_CATALOG";Vr.HIDE_CATALOG="CE_HIDE_CATALOG";Vr.TOGGLE_CATALOG="CE_TOGGLE_CATALOG";Vr.SOLD_OUT="CE_SOLD_OUT";Vr.APPROVE_NAME_RESULT="CE_APPROVE_NAME_RESULT";Vr.PURCHASE_APPROVED="CE_PURCHASE_APPROVED";Vr.INIT_GIFT="CE_INIT_GIFT";Vr.CATALOG_RESET="CE_RESET";Vr.CATALOG_INVISIBLE_PAGE_VISITED="CE_CATALOG_INVISIBLE_PAGE_VISITED";class Wq extends Vr{constructor(e,t,s){super(Vr.INIT_GIFT),this._pageId=e,this._offerId=t,this._extraData=s}get pageId(){return this._pageId}get offerId(){return this._offerId}get extraData(){return this._extraData}}const XP=class qP extends Vr{constructor(e){super(qP.POST_MARKETPLACE),this._item=e}get item(){return this._item}};XP.POST_MARKETPLACE="CE_POST_MARKETPLACE";let QP=XP;const JP=class ZP extends He{constructor(e){super(ZP.PURCHASE_SUCCESS),this._purchase=e}get purchase(){return this._purchase}};JP.PURCHASE_SUCCESS="CPE_PURCHASE_SUCCESS";let wa=JP;const $P=class eL extends He{constructor(e){super(eL.PURCHASE_FAILED),this._code=e}get code(){return this._code}};$P.PURCHASE_FAILED="CPFE_PURCHASE_FAILED";let Bl=$P;const tL=class sL extends He{constructor(e){super(sL.NOT_ALLOWED),this._code=e}get code(){return this._code}};tL.NOT_ALLOWED="CPNAE_NOT_ALLOWED";let Yf=tL;class Ns extends He{}Ns.WIDGETS_INITIALIZED="CWE_CWE_WIDGETS_INITIALIZED";Ns.SELECT_PRODUCT="CWE_SELECT_PRODUCT";Ns.SET_EXTRA_PARM="CWE_CWE_SET_EXTRA_PARM";Ns.PURCHASE="CWE_PURCHASE";Ns.COLOUR_ARRAY="CWE_COLOUR_ARRAY";Ns.MULTI_COLOUR_ARRAY="CWE_MULTI_COLOUR_ARRAY";Ns.COLOUR_INDEX="CWE_COLOUR_INDEX";Ns.TEXT_INPUT="CWE_TEXT_INPUT";Ns.DROPMENU_SELECT="CWE_CWE_DROPMENU_SELECT";Ns.PURCHASE_OVERRIDE="CWE_PURCHASE_OVERRIDE";Ns.SELLABLE_PET_PALETTES="CWE_SELLABLE_PET_PALETTES";Ns.UPDATE_ROOM_PREVIEW="CWE_UPDATE_ROOM_PREVIEW";Ns.GUILD_SELECTED="CWE_GUILD_SELECTED";Ns.TOTAL_PRICE_WIDGET_INITIALIZED="CWE_TOTAL_PRICE_WIDGET_INITIALIZED";Ns.PRODUCT_OFFER_UPDATED="CWE_CWE_PRODUCT_OFFER_UPDATED";Ns.SET_PREVIEWER_STUFFDATA="CWE_CWE_SET_PREVIEWER_STUFFDATA";Ns.EXTRA_PARAM_REQUIRED_FOR_BUY="CWE_CWE_EXTRA_PARAM_REQUIRED_FOR_BUY";Ns.TOGGLE="CWE_CWE_TOGGLE";Ns.BUILDER_SUBSCRIPTION_UPDATED="CWE_CWE_BUILDER_SUBSCRIPTION_UPDATED";Ns.ROOM_CHANGED="CWE_CWE_ROOM_CHANGED";Ns.SHOW_WARNING_TEXT="CWE_CWE_SHOW_WARNING_TEXT";const rL=class iL extends He{constructor(){super(iL.SOLD_OUT)}};rL.SOLD_OUT="CPSOE_SOLD_OUT";let zf=rL;const Yq=class nL extends He{constructor(e,t){super(nL.UPDATE_STUFF_DATA),this._offer=e,this._stuffData=t}get offer(){return this._offer}get stuffData(){return this._stuffData}};Yq.UPDATE_STUFF_DATA="SRPSA_UPDATE_STUFF_DATA";class cd extends He{}cd.INIT="HC_NAME_CHANGE_INIT";const aL=class oL extends He{constructor(e,t,s){super(oL.FURNI_ADDED),this.id=e,this.spriteId=t,this.category=s}};aL.FURNI_ADDED="IFAE_FURNI_ADDED";let Kf=aL;class Fi extends He{}Fi.SHOW_THUMBNAIL="NE_SHOW_THUMBNAIL";Fi.HIDE_THUMBNAIL="NE_HIDE_THUMBNAIL";Fi.TOGGLE_THUMBNAIL="NE_TOGGLE_THUMBNAIL";const dI=n=>n&&n.length?n.replace(/\\r/g,"\r"):"",_I=n=>{const e="0"+n;return e.substr(e.length-2,e.length)};let uc=null;const zq=()=>{const[n,e]=_.useState([]),[t,s]=_.useState([]),[r,i]=_.useState([]),[a,l]=_.useState(!1),[c,u]=_.useState(!1),h=()=>ce("notification",{}),d=x=>{const U=h();return U?U[x]:null},f=(x,U,G,K)=>{if(x.has(G))return x.get(G);const Y=["notification",U,G].join(".");return ze().localization.hasValue(Y)||K?p(Y,Array.from(x.keys()),Array.from(x.values())):null},E=(x,U)=>{let G=x.get("image");return G||(G=ce("image.library.notifications.url","").replace("%image%",U.replace(/\./g,"_"))),p(G)},m=_.useCallback((x,U=null,G=null,K=null,Y=null,te=null)=>{(!Y||!Y.length)&&(Y=p("notifications.broadcast.title")),(!U||!U.length)&&(U=Le.DEFAULT);const ne=new aI([dI(x)],U,G,K,Y,te);e(J=>[ne,...J])},[]),R=_.useCallback(()=>m(null,Le.NITRO),[m]),I=_.useCallback((x,U,G=null,K=null)=>{if(a)return;const Y=new hq(x,U,G,K);s(te=>[Y,...te])},[a]),S=(x,U=null)=>{U||(U=new Map);const G=d("notification."+x);if(G)for(const Ce in G)U.set(Ce,G[Ce]);x==="floorplan_editor.error"&&U.set("message",U.get("message").replace(/[^a-zA-Z._ ]/g,""));const K=f(U,x,"title",!0),Y=f(U,x,"message",!0).replace(/\\r/g,"\r"),te=f(U,x,"linkTitle",!1),ne=f(U,x,"linkUrl",!1),J=E(U,x);U.get("display")==="BUBBLE"?I(p(Y),Bt.INFO,J,ne):m(p(Y),x,ne,te,K,J),U.get("sound")&&mn(U.get("sound"))},A=_.useCallback((x,U,G,K=null,Y=null,te=null,ne=null)=>{(!K||!K.length)&&(K=p("generic.confirm")),(!Y||!Y.length)&&(Y=p("generic.cancel")),(!te||!te.length)&&(te=p("notifications.broadcast.title"));const J=new dq(ne,x,U,G,K,Y,te);i(Ce=>[J,...Ce])},[]),N=(x,U=null,G=!0)=>{m(x,Le.DEFAULT,U,p("mod.alert.link"),p("mod.alert.title"))},L=_.useCallback((x,U="")=>{switch(x){case _s.ALERT_SCAM:m(p("inventory.trading.warning.other_not_offering"),null,null,null,p("inventory.trading.notification.title"));return;case _s.HOTEL_TRADING_DISABLED:case _s.YOU_NOT_ALLOWED:case _s.THEY_NOT_ALLOWED:case _s.ROOM_DISABLED:case _s.YOU_OPEN:case _s.THEY_OPEN:m(p(`inventory.trading.openfail.${x}`,["otherusername"],[U]),null,null,null,p("inventory.trading.openfail.title"));return;case _s.ERROR_WHILE_COMMIT:m(`${p("inventory.trading.notification.caption")}, ${p("inventory.trading.notification.commiterror.info")}`,null,null,null,p("inventory.trading.notification.title"));return;case _s.THEY_CANCELLED:m(p("inventory.trading.info.closed"),null,null,null,p("inventory.trading.notification.title"));return}},[m]),M=_.useCallback(x=>{e(U=>{const G=[...U],K=G.findIndex(Y=>x===Y);return K>=0&&G.splice(K,1),G})},[]),b=_.useCallback(x=>{s(U=>{const G=[...U],K=G.findIndex(Y=>x===Y);return K>=0&&G.splice(K,1),G})},[]),B=_.useCallback(x=>{i(U=>{const G=[...U],K=G.findIndex(Y=>x===Y);return K>=0&&G.splice(K,1),G})},[]);z(Zm,x=>{const U=x.getParser();if(U.userId!==$().userId)return;const G=p("notifications.text.respect.1"),K=p("notifications.text.respect.2",["count"],[U.respectsReceived.toString()]);I(G,Bt.RESPECT),I(K,Bt.RESPECT)}),z(cA,x=>{const U=x.getParser();m(U.message.replace(/\\r/g,"\r"),null,null,p("notifications.broadcast.title"))}),z(nA,x=>{const U=x.getParser(),G=p("achievements.levelup.desc"),K=Au(U.data.badgeCode),Y=$().getBadgeUrl(U.data.badgeCode),te="questengine/achievements/"+U.data.category;I(G+" "+K,Bt.ACHIEVEMENT,Y,te)}),z(oA,x=>{const U=x.getParser();U.numGifts<=0||I(U.numGifts.toString(),Bt.CLUBGIFT,null,"catalog/open/"+ce("catalog.links")["hc.hc_gifts"])}),z(xC,x=>{const U=x.getParser();N(U.message,U.url,!1)}),z(Hm,x=>{const U=x.getParser();if(U.amountChanged<=0||U.type!==5)return;const G=ce("currency.asset.icon.url","").replace("%type%",U.type.toString());I(p("notifications.text.loyalty.received",["AMOUNT"],[U.amountChanged.toString()]),Bt.INFO,G)}),z(HC,x=>{const U=x.getParser();N(U.message)}),z(YO,x=>{const U=x.getParser();m(p("opening.hours."+(U.userThrowOutAtClose?"disconnected":"closed"),["h","m"],[_I(U.openHour),_I(U.openMinute)]),Le.DEFAULT,null,null,p("opening.hours.title"))}),z(hC,x=>{const U=x.getParser(),G=p("notifications.text."+(U.boughtAsGift?"petbought":"petreceived"));let K=null;const Y=ee().getRoomObjectPetImage(U.pet.typeId,U.pet.paletteId,parseInt(U.pet.color,16),new F(45*3),64,null,!0);Y&&(K=Y.getImage().src),I(G,Bt.PETLEVEL,K)}),z(hA,x=>{const G=x.getParser().messages.map(Y=>dI(Y)),K=new aI(G,Le.MOTD,null,null,p("notifications.motd.title"));e(Y=>[K,...Y])}),z(_A,x=>{const U=x.getParser();let G=null;const K=ee().getRoomObjectPetImage(U.figureData.typeId,U.figureData.paletteId,parseInt(U.figureData.color,16),new F(45*3),64,null,!0);K&&(G=K.getImage().src),I(p("notifications.text.petlevel",["pet_name","level"],[U.petName,U.level.toString()]),Bt.PETLEVEL,G)}),z(uA,x=>{const U=x.getParser();l(!U.enabled)}),z(dS,x=>{const U=x.getParser();if(!U.products||!U.products.length)return;const G=U.products[0];G&&I(p("notifications.text.club_gift.selected"),Bt.INFO,Sh.getProductImageUrl(G.productType,G.furniClassId,G.extraParam))}),z(KO,x=>{const U=x.getParser();m(p("maintenance.shutdown",["m","d"],[U.minutesUntilMaintenance.toString(),U.duration.toString()]),Le.DEFAULT,null,null,p("opening.hours.title"))}),z(UC,x=>{const U=x.getParser();N(U.message,U.url)}),z(dA,x=>{const U=x.getParser();S(U.type,U.parameters)}),z(zO,x=>{const U=x.getParser();m(p("opening.hours.shutdown",["m"],[U.openMinute.toString()]),Le.DEFAULT,null,null,p("opening.hours.title"))}),z(WO,x=>{const U=x.getParser();m(p("opening.hours.disconnected",["h","m"],[U.openHour.toString(),U.openMinute.toString()]),Le.DEFAULT,null,null,p("opening.hours.title"))}),z(lA,x=>{const U=x.getParser();switch(U.errorCode){default:case 0:m(p("connection.server.error.desc",["errorCode"],[U.errorCode.toString()]),Le.ALERT,null,null,p("connection.server.error.title"));break;case 1001:case 1002:case 1003:case 1004:case 1005:case 1006:case 1007:case 1008:case 1009:case 1010:case 1011:case 1012:case 1013:case 1014:case 1015:case 1016:case 1017:case 1018:case 1019:x.connection.dispose();break;case 4013:m(p("connection.room.maintenance.desc"),Le.ALERT,null,null,p("connection.room.maintenance.title"));break}}),z(fA,x=>{const U=x.getParser();m(p(U.alertMessage),Le.DEFAULT,null,null,p(U.titleMessage?U.titleMessage:"notifications.broadcast.title"))});const w=_.useCallback(()=>{if(!c)if(xi.isRunning()){if(uc)return;uc=setTimeout(()=>{w()},xi.totalRunningTime+5e3)}else uc&&(clearTimeout(uc),uc=null),I(p("mod.chatdisclaimer"),Bt.INFO),u(!0)},[c,I]);return z(Fh,w),{alerts:n,bubbleAlerts:t,confirms:r,simpleAlert:m,showNitroAlert:R,showTradeAlert:L,showConfirm:A,showSingleBubble:I,closeAlert:M,closeBubbleAlert:b,closeConfirm:B}},Xt=()=>os(zq),Kq=(n,e)=>{const[t,s]=_.useState(()=>{if(typeof window>"u")return e;try{return wf(n)??e}catch{return e}});return[t,i=>{try{const a=i instanceof Function?i(t):i;s(a),typeof window<"u"&&TP(n,a)}catch(a){me.error(a)}}]},ip=Kq,Xq=()=>ip(Nu.CATALOG_PLACE_MULTIPLE_OBJECTS,!1),lL=()=>os(Xq),qq=()=>ip(Nu.CATALOG_SKIP_PURCHASE_CONFIRMATION,!1),cL=()=>os(qq),Qq=-12345678,Jq=()=>{const[n,e]=_.useState(!1),[t,s]=_.useState(!1),[r,i]=_.useState(-1),[a,l]=_.useState(-1),[c,u]=_.useState(ci.NORMAL),[h,d]=_.useState(null),[f,E]=_.useState(null),[m,R]=_.useState(null),[I,S]=_.useState(null),[A,N]=_.useState([]),[L,M]=_.useState(null),[b,B]=_.useState([]),[w,x]=_.useState(null),[U,G]=_.useState(!1),[K,Y]=_.useState({quantity:1,extraData:null,extraParamRequired:!1,previewStuffData:null}),[te,ne]=_.useState({}),[J,Ce]=_.useState(!1),[Ae,tt]=lL(),[Wt,ls]=cL(),[cs,mr]=_.useState(null),[$t,Gs]=_.useState(null),[yr,ca]=_.useState(0),[$i,Er]=_.useState(0),[ri,ke]=_.useState(0),[ot,Jt]=_.useState(0),[Mr,We]=_.useState(0),[_t,ii]=_.useState(0),{simpleAlert:Xa=null}=Xt(),Dr=_.useRef(new cc),Lu=_.useCallback(()=>{i(-1),l(-1),d(null),E(null),R(null),S(null),N([]),M(null),B([]),e(!1)},[]),rc=_.useCallback(Q=>{if(!Q)return Lr.MISSING_OFFER;if(yr<0||yr>=$i)return Lr.FURNI_LIMIT_REACHED;const se=at();if(!se)return Lr.NOT_IN_ROOM;if(!se.isRoomOwner)return Lr.NOT_ROOM_OWNER;if(ot<=0){const le=ee();let Oe=le.getRoomObjectCount(se.roomId,k.UNIT);for(;Oe>0;){const lt=le.getRoomObjectByIndex(se.roomId,Oe,k.UNIT),Vt=se.userDataManager.getUserDataByIndex(lt.id);if(Vt&&Vt.type===Rt.USER&&Vt.roomIndex!==se.ownRoomIndex&&!Vt.isModerator)return Lr.VISITORS_IN_ROOM;Oe--}}return Lr.OKAY},[yr,$i,ot]),qa=_.useCallback(Q=>{const se=at();return!!((se&&Q.page&&Q.page.layoutCode!=="sold_ltd_items"&&c===ci.NORMAL&&(se.isRoomOwner||se.isGuildRoom&&se.controllerLevel>=ct.GUILD_MEMBER)||c===ci.BUILDER&&rc(Q)===Lr.OKAY)&&Q.pricingModel!==or.PRICING_MODEL_BUNDLE&&Q.product.productType!==Pe.EFFECT&&Q.product.productType!==Pe.HABBO_CLUB)},[c,rc]),Qa=_.useCallback(Q=>{if(!qa(Q))return;const se=Q.product;if(!se)return;let le=0;switch(se.productType){case Pe.FLOOR:le=k.FLOOR;break;case Pe.WALL:le=k.WALL;break}ee().processRoomObjectPlacement(xa.CATALOG,-Q.offerId,le,se.productClassId,se.extraParam)&&(mr(Q),Ce(!0),e(!1))},[qa]),Vo=_.useCallback((Q,se)=>{const le=ee();let Oe=le.getRoomInstanceVariable(le.activeRoomId,C.ROOM_WALL_TYPE),lt=le.getRoomInstanceVariable(le.activeRoomId,C.ROOM_FLOOR_TYPE),Vt=le.getRoomInstanceVariable(le.activeRoomId,C.ROOM_LANDSCAPE_TYPE);switch(Oe=Oe&&Oe.length?Oe:"101",lt=lt&&lt.length?lt:"101",Vt=Vt&&Vt.length?Vt:"1.1",Q){case"floor":le.updateRoomInstancePlaneType(le.activeRoomId,se,Oe,Vt,!0);return;case"wallpaper":le.updateRoomInstancePlaneType(le.activeRoomId,lt,se,Vt,!0);return;case"landscape":le.updateRoomInstancePlaneType(le.activeRoomId,lt,Oe,se,!0);return;default:le.updateRoomInstancePlaneType(le.activeRoomId,lt,Oe,Vt,!0);return}},[]),ic=_.useCallback(()=>{cs&&(ee().cancelRoomObjectInsert(),Ce(!1),mr(null))},[cs]),ua=_.useCallback((Q=!0)=>{Ce(se=>(se&&Q&&de("catalog/open"),!1))},[]),Ja=_.useCallback((Q=!1)=>{Q||ua(),Gs(se=>{if(se)switch(se.category){case k.FLOOR:ee().removeRoomObjectFloor(se.roomId,se.objectId);break;case k.WALL:{switch(se.furniData.className){case"floor":case"wallpaper":case"landscape":Vo("reset","");break;default:ee().removeRoomObjectWall(se.roomId,se.objectId);break}break}default:ee().deleteRoomObject(se.objectId,se.category);break}return null})},[ua,Vo]),Qs=_.useCallback((Q,se)=>{if(se.pageId===Q&&se!==h)return se;for(const le of se.children){const Oe=Qs(Q,le);if(Oe)return Oe}return null},[h]),en=_.useCallback((Q,se)=>{if(se.pageName===Q&&se!==h)return se;for(const le of se.children){const Oe=en(Q,le);if(Oe)return Oe}return null},[h]),Ho=_.useCallback((Q,se=!1)=>{if(!f||!f.size)return null;if(se){const le=[],Oe=f.get(Q);if(Oe&&Oe.length)for(const lt of Oe)lt.isVisible&&le.push(lt);if(le.length)return le}return f.get(Q)},[f]),tn=_.useCallback((Q,se)=>{Q<0||(s(!0),i(Q),Q>-1&&V(new JN(Q,se,c)))},[c]),WL=_.useCallback((Q,se,le,Oe,lt,Vt)=>{const ys=new lP(Q,se,le,Oe,Vt);if(R(ys),l(Ke=>Q!==-1?Q:Ke),G(!1),lt>-1&&ys.offers.length){for(const Ke of ys.offers)if(Ke.offerId===lt){S(Ke);break}}},[]),An=_.useCallback((Q,se=-1)=>{if(ic(),Q.parent.pageName==="root"&&Q.children.length){for(const lt of Q.children)if(lt.isVisible){Q=lt;break}}const le=[];let Oe=Q;for(;Oe&&Oe.pageName!=="root";)le.push(Oe),Oe=Oe.parent;le.reverse(),N(lt=>{const Vt=lt.indexOf(Q)>=0,ys=Q.isOpen;for(const Ke of lt)Ke.deactivate(),le.indexOf(Ke)===-1&&Ke.close();for(const Ke of le)Ke.activate(),Ke.parent&&Ke.open(),Ke===Q.parent&&Ke.children.length&&Ke.open();return Vt&&ys?Q.close():Q.open(),le}),Q.pageId>-1&&tn(Q.pageId,se)},[N,tn,ic]),nc=_.useCallback(Q=>{if(Q!==-1&&M(null),!n)Dr.current.requestById=Q,e(!0);else{const se=Qs(Q,h);se&&An(se)}},[n,h,Qs,An]),O_=_.useCallback(Q=>{if(M(null),!n)Dr.current.requestByName=Q,e(!0);else{const se=en(Q,h);se&&An(se)}},[n,h,en,An]),S_=_.useCallback(Q=>{if(M(null),!n)Dr.current.requestedByOfferId=Q,e(!0);else{const se=Ho(Q);if(!se||!se.length)return;An(se[0],Q)}},[n,Ho,An]),gp=_.useCallback(()=>{},[]);return z(uS,Q=>{const se=Q.getParser(),le=new Map,Oe=(lt,Vt,ys)=>{const Ke=new h6(lt,Vt,ys);for(const ni of Ke.offerIds)le.has(ni)?le.get(ni).push(Ke):le.set(ni,[Ke]);Vt++;for(const ni of lt.children)Ke.addChild(Oe(ni,Vt,Ke));return Ke};d(Oe(se.root,0,null)),E(le)}),z(cS,Q=>{const se=Q.getParser();if(se.catalogType!==c)return;const le=[];for(const Oe of se.offers){const lt=[],Vt=Rl(Oe.localizationId);for(const Ke of Oe.products){const ni=Ff(Ke.furniClassId,Ke.productType);lt.push(new Tl(Ke.productType,Ke.furniClassId,Ke.extraParam,Ke.productCount,Vt,ni,Ke.uniqueLimitedItem,Ke.uniqueLimitedSeriesSize,Ke.uniqueLimitedItemsLeft))}if(!lt.length)continue;const ys=new or(Oe.offerId,Oe.localizationId,Oe.rent,Oe.priceCredits,Oe.priceActivityPoints,Oe.priceActivityPointsType,Oe.giftable,Oe.clubLevel,lt,Oe.bundlePurchaseAllowed);(c===ci.NORMAL||ys.pricingModel!==or.PRICING_MODEL_BUNDLE&&ys.pricingModel!==or.PRICING_MODEL_MULTI)&&le.push(ys)}se.frontPageItems&&se.frontPageItems.length&&B(se.frontPageItems),s(!1),r===se.pageId&&WL(se.pageId,se.layoutCode,new dP(se.localization.images.concat(),se.localization.texts.concat()),le,se.offerId,se.acceptSeasonCurrencyAsCredits)}),z(TS,Q=>{const se=Q.getParser();Fs(new wa(se.offer))}),z(pS,Q=>{const se=Q.getParser();Fs(new Bl(se.code))}),z(IS,Q=>{const se=Q.getParser();Fs(new Yf(se.code))}),z(mS,Q=>{Q.getParser(),Fs(new zf)}),z(ES,Q=>{const le=Q.getParser().offer;if(!le||!le.products.length)return;le.products[0].uniqueLimitedItem;const lt=[],Vt=Rl(le.localizationId);for(const Ke of le.products){const ni=Ff(Ke.furniClassId,Ke.productType);lt.push(new Tl(Ke.productType,Ke.furniClassId,Ke.extraParam,Ke.productCount,Vt,ni,Ke.uniqueLimitedItem,Ke.uniqueLimitedSeriesSize,Ke.uniqueLimitedItemsLeft))}const ys=new or(le.offerId,le.localizationId,le.rent,le.priceCredits,le.priceActivityPoints,le.priceActivityPointsType,le.giftable,le.clubLevel,lt,le.bundlePurchaseAllowed);(c===ci.NORMAL||ys.pricingModel!==or.PRICING_MODEL_BUNDLE&&ys.pricingModel!==or.PRICING_MODEL_MULTI)&&(ys.page=m,S(ys),ys.product&&ys.product.productType===Pe.WALL&&Y(Ke=>{const ni={...Ke};return ni.extraData=ys.product.extraParam||null,ni}))}),z(OS,Q=>{const se=Q.getParser(),le=new d6(se.productCode,se.palettes.slice());ne(Oe=>{const lt=[];Oe.petPalettes&&lt.push(...Oe.petPalettes);for(let Vt=0;Vt<lt.length;Vt++)if(lt[Vt].breed===le.breed){lt.splice(Vt,1);break}return lt.push(le),{...Oe,petPalettes:lt}})}),z(fS,Q=>{const se=Q.getParser();ne(le=>{const Oe=se.offers;return{...le,clubOffers:Oe}})}),z(NN,Q=>{const se=Q.getParser();ne(le=>{const Oe=se.groups;return{...le,groups:Oe}})}),z(gS,Q=>{const se=Q.getParser();ne(le=>{const Oe=new I6(se);return{...le,giftConfiguration:Oe}})}),z(NC,Q=>{const se=Q.getParser();if(!se)return;let le="";se.result===1?le=p("inventory.marketplace.result.title.success"):le=p("inventory.marketplace.result.title.failure");const Oe=p(`inventory.marketplace.result.${se.result}`);Xa(Oe,Le.DEFAULT,null,null,le)}),z(Lm,Q=>{const se=Q.getParser();ne(le=>({...le,clubGifts:se}))}),z(hS,Q=>{const se=n;Lu(),se&&Xa(p("catalog.alert.published.description"),Le.ALERT,null,null,p("catalog.alert.published.title"))}),z(oS,Q=>{const se=Q.getParser();ca(se.furniCount),gp()}),z(lS,Q=>{const se=Q.getParser();Er(se.furniLimit),ke(se.maxFurniLimit),Jt(se.secondsLeft),We(ve()),ii(se.secondsLeftWithGrace),gp()}),Ts(wa.PURCHASE_SUCCESS,Q=>mn(kr.CREDITS)),$e(pg.PLACED,Q=>{if(!J||Q.type!==pg.PLACED)return;if(Ja(!0),!cs){ua();return}let se=!1;const le=cs.product;if(Q.category===k.WALL)switch(le.furnitureData.className){case"floor":case"wallpaper":case"landscape":se=Q.placedOnFloor||Q.placedOnWall;break;default:se=Q.placedInRoom;break}else se=Q.placedInRoom;if(!se){ua();return}switch(Gs(new T6(Q.roomId,Q.objectId,Q.category,Q.wallLocation,Q.x,Q.y,Q.direction,cs)),c){case ci.NORMAL:{switch(Q.category){case k.FLOOR:ee().addFurnitureFloor(Q.roomId,Q.objectId,le.productClassId,new F(Q.x,Q.y,Q.z),new F(Q.direction),0,new Br);break;case k.WALL:switch(le.furnitureData.className){case"floor":case"wallpaper":case"landscape":Vo(le.furnitureData.className,le.extraParam);break;default:ee().addFurnitureWall(Q.roomId,Q.objectId,le.productClassId,new F(Q.x,Q.y,Q.z),new F(Q.direction*45),0,Q.instanceData,0);break}}const Oe=ee().getRoomObject(Q.roomId,Q.objectId,Q.category);Oe&&Oe.model.setValue(C.FURNITURE_ALPHA_MULTIPLIER,.5),Wt&&V(new au(r,cs.offerId,le.extraParam,1)),Ae&&Qa(cs);break}case ci.BUILDER:{let Oe=cs.page.pageId;switch(Oe===Qq&&(Oe=-1),Q.category){case k.FLOOR:V(new KN(Oe,cs.offerId,le.extraParam,Q.x,Q.y,Q.direction));break;case k.WALL:V(new XN(Oe,cs.offerId,le.extraParam,Q.wallLocation));break}Ae&&Qa(cs);break}}}),Ts(Kf.FURNI_ADDED,Q=>{const se=ee();if(!(!$t||$t.productClassId!==Q.spriteId||$t.roomId!==se.activeRoomId)){switch(Q.category){case he.FLOOR:{const le=se.getRoomInstanceVariable(se.activeRoomId,C.ROOM_FLOOR_TYPE);$t.extraParam!==le&&V(new Dc(Q.id));break}case he.WALL_PAPER:{const le=se.getRoomInstanceVariable(se.activeRoomId,C.ROOM_WALL_TYPE);$t.extraParam!==le&&V(new Dc(Q.id));break}case he.LANDSCAPE:{const le=se.getRoomInstanceVariable(se.activeRoomId,C.ROOM_LANDSCAPE_TYPE);$t.extraParam!==le&&V(new Dc(Q.id));break}default:V(new cE(Q.id,$t.category,$t.wallLocation,$t.x,$t.y,$t.direction))}Ae||Ja()}}),_.useEffect(()=>()=>S(null),[m]),_.useEffect(()=>{if(!(!n||!h||!f||!Dr.current))switch(Dr.current.requestType){case cc.REQUEST_TYPE_NONE:if(m)return;if(h.isBranch){for(const Q of h.children)if(Q&&Q.isVisible){An(Q);return}}return;case cc.REQUEST_TYPE_ID:nc(Dr.current.requestById),Dr.current.resetRequest();return;case cc.REQUEST_TYPE_OFFER:S_(Dr.current.requestedByOfferId),Dr.current.resetRequest();return;case cc.REQUEST_TYPE_NAME:O_(Dr.current.requestByName),Dr.current.resetRequest();return}},[n,h,f,m,An,nc,S_,O_]),_.useEffect(()=>{!L&&m&&m.pageId===-1&&nc(a)},[L,m,a,nc]),_.useEffect(()=>{I&&Y({quantity:1,extraData:null,extraParamRequired:!1,previewStuffData:null})},[I]),_.useEffect(()=>{!n||h||(V(new $N),V(new $m),V(new QN(c)),V(new qN))},[n,h,c]),_.useEffect(()=>(x(new td(ee(),++td.PREVIEW_COUNTER)),()=>{x(Q=>(Q.dispose(),null))}),[]),{isVisible:n,setIsVisible:e,isBusy:t,pageId:r,previousPageId:a,currentType:c,rootNode:h,offersToNodes:f,currentPage:m,setCurrentPage:R,currentOffer:I,setCurrentOffer:S,activeNodes:A,searchResult:L,setSearchResult:M,frontPageItems:b,roomPreviewer:w,navigationHidden:U,setNavigationHidden:G,purchaseOptions:K,setPurchaseOptions:Y,catalogOptions:te,setCatalogOptions:ne,getNodeById:Qs,getNodeByName:en,activateNode:An,openPageById:nc,openPageByName:O_,openPageByOfferId:S_,requestOfferToMover:Qa}},Ct=()=>os(Jq),Zq=1e3,$q=10,e7=1e3;let t7=0,s7=0;const r7=()=>{const[n,e]=_.useState([]),[t,s]=_.useState([]),[r,i]=_.useState([]),[a,l]=_.useState(!1),c=d=>{d.id=t7++,e(f=>{const E=[...f];return E.push(d),E.length>Zq&&E.shift(),E})},u=d=>{s(f=>{const E=[...f];return E.push(d),E.length>$q&&E.shift(),E})},h=d=>{d.id=s7++,i(f=>{const E=[...f];return E.push(d),E.length>e7&&E.shift(),E})};return kt(Ne.STARTED,d=>l(!0)),z(sa,d=>{if(!a)return;const f=d.getParser();t.length&&t[t.length-1].id===f.data.roomId||(c({id:-1,webId:-1,entityId:-1,name:f.data.roomName,timestamp:RP(),type:Ri.TYPE_ROOM_INFO,roomId:f.data.roomId}),u({id:f.data.roomId,name:f.data.roomName}),l(!1))}),z(Um,d=>{const f=d.getParser();h({id:-1,webId:f.senderId,entityId:-1,name:"",message:f.messageText,roomId:-1,timestamp:sI(f.secondsSinceSent),type:Ri.TYPE_IM})}),z(xm,d=>{const f=d.getParser();h({id:-1,webId:f.senderId,entityId:-1,name:"",message:f.messageText,roomId:-1,timestamp:sI(),type:Ri.TYPE_IM})}),{addChatEntry:c,chatHistory:n,roomHistory:t,messengerHistory:r}},m_=()=>os(r7),i7=()=>{const[n,e]=_.useState([]),[t,s]=_.useState([]),[r,i]=_.useState([]),[a,l]=_.useState([]),[c,u]=_.useState(null),h=_.useMemo(()=>{const A=n.filter(N=>N.online);return A.sort((N,L)=>N.name<L.name?-1:N.name>L.name?1:0),A},[n]),d=_.useMemo(()=>{const A=n.filter(N=>!N.online);return A.sort((N,L)=>N.name<L.name?-1:N.name>L.name?1:0),A},[n]),f=A=>V(new wd(A.id)),E=(A,N)=>N!==A.relationshipStatus&&V(new Ry(A.id,N)),m=A=>{for(const N of n)if(N.id===A)return N;return null},R=A=>!(A===$().userId||m(A)||t.find(N=>N.requesterUserId===A)||r.indexOf(A)>=0),I=(A,N)=>{if(!R(A))return!1;i(L=>{const M=[...L];return M.push(A),M}),V(new tE(N))},S=(A,N)=>{A===-1&&!N?(V(new cf(!0)),s([])):s(L=>{const M=[...L],b=M.findIndex(B=>B.id===A);return b===-1?L:(V(N?new _y(M[b].id):new cf(!1,M[b].id)),M.splice(b,1),M)})};return z(FS,A=>{const N=A.getParser();u(new eq(N.userFriendLimit,N.normalFriendLimit,N.extendedFriendLimit,N.categories)),V(new fy)}),z(bS,A=>{const N=A.getParser();e(L=>{const M=[...L];for(const b of N.fragment){const B=M.findIndex(x=>x.id===b.id),w=new Kr;w.populate(b),B>-1?M[B]=w:M.push(w)}return M})}),z(PS,A=>{const N=A.getParser();e(L=>{const M=[...L],b=B=>{const w=M.findIndex(x=>x.id===B.id);if(w===-1){const x=new Kr;x.populate(B),M.unshift(x)}else M[w].populate(B)};for(const B of N.addedFriends)b(B);for(const B of N.updatedFriends)b(B);for(const B of N.removedFriendIds){const w=M.findIndex(x=>x.id===B);w>-1&&M.splice(w,1)}return M})}),z(LS,A=>{const N=A.getParser();s(L=>{const M=[...L];for(const b of N.requests){const B=M.findIndex(w=>w.requesterUserId===b.requesterUserId);if(B>0)M[B]=dr(M[B]),M[B].populate(b);else{const w=new rI;w.populate(b),M.push(w)}}return M})}),z(Fm,A=>{const L=A.getParser().request;s(M=>{const b=[...M];if(b.findIndex(w=>w.requesterUserId===L.requesterUserId)===-1){const w=new rI;w.populate(L),b.push(w)}return b})}),_.useEffect(()=>{V(new Ey);const A=setInterval(()=>V(new gy),12e4);return()=>{clearInterval(A)}},[]),{friends:n,requests:t,sentRequests:r,dismissedRequestIds:a,setDismissedRequestIds:l,settings:c,onlineFriends:h,offlineFriends:d,getFriend:m,canRequestFriend:R,requestFriend:I,requestResponse:S,followFriend:f,updateRelationship:E}},Wr=()=>os(i7),n7=()=>{const[n,e]=_.useState([]),[t,s]=_.useState(-1),[r,i]=_.useState([]),[a,l]=_.useState(ki.HIDDEN),{getFriend:c=null}=Wr(),{simpleAlert:u=null}=Xt(),h=_.useMemo(()=>n.filter(R=>r.indexOf(R.threadId)===-1),[n,r]),d=_.useMemo(()=>t>0&&h.find(R=>R.threadId===t||null),[t,h]),f=R=>{let I=n.find(S=>S.participant&&S.participant.id===R);if(I){const S=r.indexOf(I.threadId);S>=0&&i(A=>{const N=[...A];return N.splice(S,1),N})}else{const S=c(R);if(!S)return null;I=new sq(S),I.addMessage(null,p("messenger.moderationinfo"),0,null,Vi.SECURITY_NOTIFICATION),I.setRead(),e(A=>{const N=[...A];return N.push(I),N})}return I},E=R=>{i(I=>{const S=[...I];return S.indexOf(R)>=0?I:(S.push(R),S)}),t===R&&s(-1)},m=(R,I,S,A=0,N=null,L=Vi.CHAT)=>{if(!R||!S||!S.length)return;const M=I===$().userId;M&&S.length<=255&&V(new Iy(R.participant.id,S)),e(b=>{const B=[...b],w=B.findIndex(x=>x.threadId===R.threadId);return w===-1?b:(R=dr(B[w]),M&&R.groups.length===1&&mn(kr.MESSENGER_NEW_THREAD),R.addMessage(L===Vi.ROOM_INVITE?null:I,S,A,N,L),t===R.threadId&&R.setRead(),B[w]=R,!M&&R.unread&&mn(kr.MESSENGER_MESSAGE_RECEIVED),B)})};return z(Um,R=>{const I=R.getParser(),S=f(I.senderId);S&&m(S,I.senderId,I.messageText,I.secondsSinceSent,I.extraData)}),z(xm,R=>{const I=R.getParser(),S=f(I.senderId);S&&m(S,I.senderId,I.messageText,0,null,Vi.ROOM_INVITE)}),z(xS,R=>{const I=R.getParser();u(`Received room invite error: ${I.errorCode},recipients: ${I.failedRecipients}`,Le.DEFAULT,null,null,p("friendlist.alert.title"))}),_.useEffect(()=>{t<=0||e(R=>{const I=[...R],S=I.findIndex(A=>A.threadId===t);return S>=0&&(I[S]=dr(I[S]),I[S].setRead()),I})},[t]),_.useEffect(()=>{l(R=>{if(!h.length)return ki.HIDDEN;let I=!1;for(const S of h)if(S.unreadCount>0){I=!0;break}return I?ki.UNREAD:ki.SHOW})},[h]),{messageThreads:n,activeThread:d,iconState:a,visibleThreads:h,getMessageThread:f,setActiveThreadId:s,closeThread:E,sendMessage:m}},uL=()=>os(n7),a7=()=>{const[n,e]=_.useState(null);return z(wm,t=>{const s=t.getParser(),r={badgeBases:[],badgeSymbols:[],badgePartColors:[],groupColorsA:[],groupColorsB:[]};s.bases.forEach((a,l)=>r.badgeBases.push({id:l,images:a})),s.symbols.forEach((a,l)=>r.badgeSymbols.push({id:l,images:a})),s.partColors.forEach((a,l)=>r.badgePartColors.push({id:l,color:a})),s.colorsA.forEach((a,l)=>r.groupColorsA.push({id:l,color:a})),s.colorsB.forEach((a,l)=>r.groupColorsB.push({id:l,color:a}));const i=(a,l)=>a.id<l.id?-1:a.id>l.id?1:0;r.badgeBases.sort(i),r.badgeSymbols.sort(i),r.badgePartColors.sort(i),r.groupColorsA.sort(i),r.groupColorsB.sort(i),e(r)}),_.useEffect(()=>{V(new yy)},[]),{groupCustomize:n}},bu=()=>os(a7),o7=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(null),{simpleAlert:r=null,showConfirm:i=null}=Xt(),a=(l,c)=>{const u={reportType:l,reportedUserId:-1,reportedChats:[],cfhCategory:-1,cfhTopic:-1,roomId:-1,roomName:"",messageId:-1,threadId:-1,groupId:-1,extraData:"",roomObjectId:-1,message:"",currentStep:0};switch(l){case bt.BULLY:case bt.EMERGENCY:case bt.IM:u.reportedUserId=c.reportedUserId,u.currentStep=Ls.SELECT_CHATS;break;case bt.ROOM:u.roomId=c.roomId,u.roomName=c.roomName,u.currentStep=Ls.SELECT_TOPICS;break;case bt.THREAD:u.groupId=c.groupId,u.threadId=c.threadId,u.currentStep=Ls.SELECT_TOPICS;break;case bt.MESSAGE:u.groupId=c.groupId,u.threadId=c.threadId,u.messageId=c.messageId,u.currentStep=Ls.SELECT_TOPICS;break;case bt.PHOTO:u.extraData=c.extraData,u.roomId=c.roomId,u.reportedUserId=c.reportedUserId,u.roomObjectId=c.roomObjectId,u.currentStep=Ls.SELECT_TOPICS;break}e(u)};return z(qS,l=>{const c=l.getParser();let u=c.messageText;switch(c.resultType){case id.TOO_MANY_PENDING_CALLS_CODE:V(new $y),r(p("help.cfh.error.pending"),Le.MODERATION,null,null,p("help.cfh.error.title"));break;case id.HAS_ABUSIVE_CALL_CODE:r(p("help.cfh.error.abusive"),Le.MODERATION,null,null,p("help.cfh.error.title"));break;default:u.trim().length===0&&(u=p("help.cfh.sent.text")),r(u,Le.MODERATION,null,null,p("help.cfh.sent.title"))}}),z($S,l=>{const c=l.getParser(),u=c.messageText.length===0?p("help.cfh.closed."+lq(c.closeReason)):c.messageText;r(u,Le.MODERATION,null,null,p("mod.alert.title"))}),z(KS,l=>{const c=l.getParser();c.count>0&&i(p("help.emergency.pending.title")+`
`+c.pendingCalls[0].message,()=>{V(new Jy)},null,p("help.emergency.pending.button.discard"),p("help.emergency.pending.button.keep"),p("help.emergency.pending.message.subtitle"))}),z(zS,l=>{r("Your pending calls were deleted",Le.MODERATION,null,null,p("mod.alert.title"))}),z(XS,l=>{const c=l.getParser();r(c.message,Le.MODERATION,null,null,p("help.cfh.reply.title"))}),z(YS,l=>{const c=l.getParser();r(p("help.emergency.global_mute.message"),Le.MODERATION,c.infoUrl,p("help.emergency.global_mute.link"),p("help.emergency.global_mute.subtitle"))}),z(eS,l=>{const c=l.getParser();s(c)}),{activeReport:n,setActiveReport:e,sanctionInfo:t,setSanctionInfo:s,report:a}},Ji=()=>os(o7),E_=()=>{const[n,e]=_.useState([]),t=_.useMemo(()=>!!n.length,[n]),s=_.useCallback(()=>{let i=-1;return e(a=>{const l=[...a];return i=l.length?l[l.length-1]+1:0,l.push(i),l}),i},[]),r=_.useCallback(i=>{e(a=>{const l=[...a],c=l.indexOf(i);return c===-1?a:(l.splice(c,1),l)})},[]);return{isVisible:t,activate:s,deactivate:r}},l7=n=>V(new hM(n)),c7=(n,e)=>V(new dM(n,...e)),u7=()=>{const[n,e]=_.useState(new Map),t=_.useCallback(c=>{var u;return((u=n.get(c))==null?void 0:u.length)||0},[n]),s=_.useMemo(()=>{let c=0;for(const u of n.keys())c+=t(u);return c},[n,t]),r=_.useCallback(c=>{let u=!0;return e(h=>{if(!h.has(c))return u=!1,h;const d=new Map(h);return d.delete(c),l7(c),d}),u},[]),i=_.useCallback((c,u)=>{let h=!0;return e(d=>{if(!d.has(c))return h=!1,d;const f=new Map(d),E=f.get(c);if(E)for(const m of u)E.splice(E.indexOf(m),1);return c7(c,u),f}),h},[]),a=_.useCallback((c,u)=>n.has(c)?n.get(c).indexOf(u)>=0:!1,[n]),l=_.useCallback((c,u)=>{e(h=>{if(!h.has(c))return h;const d=new Map(h),f=d.get(c),E=f.indexOf(u);return E>=0&&f.splice(E,1),d})},[]);return z(mA,c=>{const u=c.getParser();e(h=>{const d=new Map(h);for(const f of u.categories){let E=d.get(f);E||(E=[],d.set(f,E));const m=u.getItemsByCategory(f);for(const R of m)E.indexOf(R)===-1&&E.push(R)}return d})}),{getCount:t,getFullCount:s,resetCategory:r,resetItems:i,isUnseen:a,removeUnseen:l}},ti=()=>os(u7),h7=()=>{const[n,e]=_.useState(!0),[t,s]=_.useState([]),[r,i]=_.useState(new Map),[a,l]=_.useState([]),[c,u]=_.useState(null),{isVisible:h=!1,activate:d=null,deactivate:f=null}=E_(),{isUnseen:E=null,resetCategory:m=null}=ti(),R=ce("user.badges.max.slots",5),I=L=>a.indexOf(L)>=0,S=()=>a.length<R,A=L=>{l(M=>{const b=[...M],B=b.indexOf(L);if(B===-1){if(!S())return M;b.push(L)}else b.splice(B,1);const w=new tM;for(let x=0;x<R;x++)w.addActivatedBadge(b[x]??"");return V(w),b})},N=L=>t.indexOf(L)===-1?0:r.get(L)??0;return z(iC,L=>{const M=L.getParser(),b=[];i(B=>{const w=new Map(B);return M.getAllBadgeCodes().forEach(x=>{const U=t.indexOf(x)>=0,G=M.getBadgeId(x);w.set(x,G),!U&&b.push(x)}),w}),l(M.getActiveBadgeCodes()),s(B=>[...B,...b])}),z(rC,L=>{const M=L.getParser(),b=E(wt.BADGE,M.badgeId);s(B=>{const w=[...B];return b?w.unshift(M.badgeCode):w.push(M.badgeCode),w}),i(B=>{const w=new Map(B);return w.set(M.badgeCode,M.badgeId),w})}),_.useEffect(()=>{!t||!t.length||u(L=>{let M=L;return M&&t.indexOf(M)===-1&&(M=null),M||(M=t[0]),M})},[t]),_.useEffect(()=>{if(h)return()=>{m(wt.BADGE)}},[h,m]),_.useEffect(()=>{!h||!n||(V(new eM),e(!1))},[h,n]),{badgeCodes:t,activeBadgeCodes:a,selectedBadgeCode:c,setSelectedBadgeCode:u,isWearingBadge:I,canWearBadges:S,toggleBadge:A,getBadgeId:N,activate:d,deactivate:f}},p_=()=>os(h7),d7=()=>{const[n,e]=_.useState(!0),[t,s]=_.useState([]),[r,i]=_.useState(null),{isVisible:a=!1,activate:l=null,deactivate:c=null}=E_(),{isUnseen:u=null,resetCategory:h=null}=ti();return z(QO,d=>{const f=d.getParser();s(E=>{const m=[...E],R=m.map(S=>S.botData.id),I=[];for(const S of f.items.values())R.indexOf(S.id)===-1&&I.push(S);for(const S of R){let A=!0;for(const M of f.items.values())if(M.id===S){A=!1;break}if(!A)continue;const N=m.findIndex(M=>M.botData.id===S),L=m[N];N===-1||!L||(Ll()===L.botData.id&&(Kc(),de("inventory/open")),m.splice(N,1))}for(const S of I){const A={botData:S};u(wt.BOT,S.id)?m.unshift(A):m.push(A)}return m})}),z(qO,d=>{const f=d.getParser();s(E=>{const m=[...E];if(m.findIndex(A=>A.botData.id===f.item.id)>=0)return E;const I={botData:f.item};return u(wt.BOT,I.botData.id)?m.unshift(I):m.push(I),m})}),z(JO,d=>{const f=d.getParser();s(E=>{const m=[...E],R=m.findIndex(I=>I.botData.id===f.itemId);return R===-1?E:(m.splice(R,1),Ll()===f.itemId&&(Kc(),de("inventory/show")),m)})}),_.useEffect(()=>{!t||!t.length||i(d=>{let f=d;return f&&t.indexOf(f)===-1&&(f=null),f||(f=t[0]),f})},[t]),_.useEffect(()=>{if(a)return()=>{h(wt.BOT)}},[a,h]),_.useEffect(()=>{!a||!n||(V(new hf),e(!1))},[a,n]),{botItems:t,selectedBot:r,setSelectedBot:i,activate:l,deactivate:c}},hL=()=>os(d7);let ju=null;const _7=()=>{const[n,e]=_.useState(!0),[t,s]=_.useState([]),[r,i]=_.useState(null),{isVisible:a=!1,activate:l=null,deactivate:c=null}=E_(),{isUnseen:u=null,resetCategory:h=null}=ti(),d=m=>{if(!(!t||!t.length))return t.filter(R=>R.type===m)},f=m=>{if(!(!t||!t.length)){for(const R of t){const I=R.getItemById(m);if(I&&I.isWallItem)return R}return null}},E=m=>{if(!(!t||!t.length)){for(const R of t){const I=R.getItemById(m);if(I&&!I.isWallItem)return R}return null}};return z(Bm,m=>{const R=m.getParser();s(I=>{const S=[...I];for(const A of R.items){let N=0,L=null;for(;N<S.length;){const M=S[N];let b=0;for(;b<M.items.length;){const B=M.items[b];if(B.id===A.itemId){B.update(A);const w=[...M.items];w[b]=B,M.items=w,L=M;break}b++}if(L)break;N++}if(L)L.hasUnseenItems=!0,S[N]=dr(L);else{const M=new zc(A);Zp(S,M,u(wt.FURNI,A.itemId)),Fs(new Kf(M.id,M.type,M.category))}}return S})}),z(Ph,m=>{const R=m.getParser();ju||(ju=new Array(R.totalFragments));const I=U6(R.fragment,R.totalFragments,R.fragmentNumber,ju);I&&(s(S=>{const A=[...S],N=F6(A);for(const L of N){if(I.get(L))continue;let M=0;for(;M<A.length;){const b=A[M],B=b.remove(L);if(!B){M++;continue}Ll()===B.ref&&(Kc(),Ul(b)||de("inventory/show")),b.getTotalCount()<=0&&(A.splice(M,1),b.dispose());break}}for(const L of I.keys()){if(N.indexOf(L)>=0)continue;const M=I.get(L);if(!M)continue;const b=new zc(M);Zp(A,b,u(wt.FURNI,L)),Fs(new Kf(b.id,b.type,b.category))}return A}),ju=null)}),z(aC,m=>{e(!0)}),z(km,m=>{const R=m.getParser();s(I=>{const S=[...I];let A=0;for(;A<S.length;){const N=S[A],L=N.remove(R.itemId);if(!L){A++;continue}Ll()===L.ref&&(Kc(),Ul(N)||de("inventory/show")),N.getTotalCount()<=0&&(S.splice(A,1),N.dispose());break}return S})}),z(oC,m=>{}),_.useEffect(()=>{!t||!t.length||i(m=>{let R=m;return R&&t.indexOf(R)===-1&&(R=null),R||(R=t[0]),R})},[t]),_.useEffect(()=>{if(a)return()=>{h(wt.FURNI)&&s(m=>{const R=[...m];for(const I of R)I.hasUnseenItems=!1;return R})}},[a,h]),_.useEffect(()=>{!a||!n||(V(new sM),e(!1))},[a,n]),{isVisible:a,groupItems:t,setGroupItems:s,selectedItem:r,setSelectedItem:i,activate:l,deactivate:c,getWallItemById:f,getFloorItemById:E,getItemsByType:d}},Bo=()=>os(_7);let Wu=null;const g7=()=>{const[n,e]=_.useState(!0),[t,s]=_.useState([]),[r,i]=_.useState(null),{isVisible:a=!1,activate:l=null,deactivate:c=null}=E_(),{isUnseen:u=null,resetCategory:h=null}=ti();return z(uC,d=>{const f=d.getParser();Wu||(Wu=new Array(f.totalFragments));const E=B6(f.fragment,f.totalFragments,f.fragmentNumber,Wu);E&&(s(m=>{const R=[...m];return G6(R,E,u),R}),Wu=null)}),z(cC,d=>{const f=d.getParser();s(E=>{const m=[...E];return pP(f.pet,m,u(wt.PET,f.pet.id)),m})}),z(dC,d=>{const f=d.getParser();s(E=>{const m=[...E];return IP(f.petId,m),m})}),_.useEffect(()=>{!t||!t.length||i(d=>{let f=d;return f&&t.indexOf(f)===-1&&(f=null),f||(f=t[0]),f})},[t]),_.useEffect(()=>{if(a)return()=>{h(wt.PET)}},[a,h]),_.useEffect(()=>{!a||!n||(V(new df),e(!1))},[a,n]),{petItems:t,selectedPet:r,setSelectedPet:i,activate:l,deactivate:c}},dL=()=>os(g7),f7=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(null),[r,i]=_.useState(qt.TRADING_STATE_READY),{groupItems:a=[],setGroupItems:l=null,activate:c=null,deactivate:u=null}=Bo(),{simpleAlert:h=null,showTradeAlert:d=null}=Xt(),f=r>=qt.TRADING_STATE_RUNNING,E=()=>{switch(r){case qt.TRADING_STATE_RUNNING:!t.itemCount&&!n.accepts&&h(p("inventory.trading.warning.other_not_offering"),null,null,null),n.accepts?V(new uM):V(new rM);return;case qt.TRADING_STATE_CONFIRMING:V(new aM),i(qt.TRADING_STATE_CONFIRMED);return}},m=I=>{const S=I.getLastItem();S&&V(new lM(S.id))},R=()=>{if(f)switch(r){case qt.TRADING_STATE_RUNNING:V(new nM);return;default:V(new iM);return}};return z(_C,I=>{const S=I.getParser();!n||!t||(n.userId===S.userID?e(A=>{const N=dr(A);return N.accepts=S.userAccepts,N}):t.userId===S.userID&&s(A=>{const N=dr(A);return N.accepts=S.userAccepts,N}))}),z(gC,I=>{const S=I.getParser();S.reason===Om.ERROR_WHILE_COMMIT?d(_s.ERROR_WHILE_COMMIT):n&&S.userID!==n.userId&&d(_s.THEY_CANCELLED),e(null),s(null),i(qt.TRADING_STATE_READY)}),z(fC,I=>{I.getParser(),e(null),s(null),i(qt.TRADING_STATE_READY)}),z(mC,I=>{I.getParser(),i(qt.TRADING_STATE_COUNTDOWN)}),z(EC,I=>{const S=I.getParser(),A=tI(S.firstUserItemArray),N=tI(S.secondUserItemArray);e(L=>{const M=dr(L);M.userId===S.firstUserID?(M.creditsCount=S.firstUserNumCredits,M.itemCount=S.firstUserNumItems,M.userItems=A):(M.creditsCount=S.secondUserNumCredits,M.itemCount=S.secondUserNumItems,M.userItems=N);const b=[];for(const B of M.userItems.getValues()){let w=0;for(;w<B.getTotalCount();){const x=B.getItemByIndex(w);x&&b.push(x.ref),w++}}return l(B=>{const w=[...B];for(const x of w)x.lockItemIds(b);return w}),M}),s(L=>{const M=dr(L);return M.userId===S.firstUserID?(M.creditsCount=S.firstUserNumCredits,M.itemCount=S.firstUserNumItems,M.userItems=A):(M.creditsCount=S.secondUserNumCredits,M.itemCount=S.secondUserNumItems,M.userItems=N),M})}),z(pC,I=>{I.getParser()}),z(IC,I=>{const S=I.getParser(),A=new $p,N=at().userDataManager.getUserData(S.userID);A.userItems=new Zt;const L=new $p,M=at().userDataManager.getUserData(S.otherUserID);L.userItems=new Zt,N.webID===$().userId?(A.userId=N.webID,A.userName=N.name,A.canTrade=S.userCanTrade,L.userId=M.webID,L.userName=M.name,L.canTrade=S.otherUserCanTrade):M.webID===$().userId&&(A.userId=M.webID,A.userName=M.name,A.canTrade=S.otherUserCanTrade,L.userId=N.webID,L.userName=N.name,L.canTrade=S.userCanTrade),e(A),s(L),i(qt.TRADING_STATE_RUNNING)}),z(TC,I=>{const S=I.getParser();d(S.reason,S.otherUserName)}),z(RC,I=>{I.getParser(),d(_s.THEY_NOT_ALLOWED)}),z(OC,I=>{I.getParser(),d(_s.YOU_NOT_ALLOWED)}),_.useEffect(()=>{if(r===qt.TRADING_STATE_READY)return;const I=c();return()=>u(I)},[r,c,u]),{ownUser:n,otherUser:t,tradeState:r,setTradeState:i,isTrading:f,groupItems:a,progressTrade:E,removeItem:m,stopTrading:R}},_L=()=>os(f7),m7=()=>{const[n,e]=_.useState(null),[t,s]=_.useState([]),[r,i]=_.useState([]),[a,l]=_.useState([]),[c,u]=_.useState([]),[h,d]=_.useState([]),[f,E]=_.useState([]),{simpleAlert:m=null}=Xt(),R=G=>{t.indexOf(G)>=0||s(K=>[...K,G])},I=G=>{s(K=>{const Y=[...K],te=Y.indexOf(G);return te>=0&&Y.splice(te),Y})},S=G=>{t.indexOf(G)>=0?I(G):R(G)},A=G=>{r.indexOf(G)>=0||i(K=>[...K,G])},N=G=>{i(K=>{const Y=[...K],te=Y.indexOf(G);return te>=0&&Y.splice(te),Y})},L=G=>{r.indexOf(G)>=0?N(G):A(G)},M=G=>{a.indexOf(G)>=0||l(K=>[...K,G])},b=G=>{l(K=>{const Y=[...K],te=Y.indexOf(G);return te>=0&&Y.splice(te),Y})},B=G=>{a.indexOf(G)>=0?b(G):M(G)},w=G=>{c.indexOf(G)>=0||u(K=>[...K,G])},x=G=>{u(K=>{const Y=[...K],te=Y.indexOf(G);return te>=0&&Y.splice(te),Y})},U=G=>{r.indexOf(G)>=0?x(G):w(G)};return z(FC,G=>{const Y=G.getParser().data;e(Y),d(Y.issues)}),z(bC,G=>{const K=G.getParser();d(Y=>{const te=[...Y],ne=te.findIndex(J=>J.issueId===K.issueData.issueId);return ne>=0?te[ne]=K.issueData:(te.push(K.issueData),mn(kr.MODTOOLS_NEW_TICKET)),te})}),z(GC,G=>{G.getParser()}),z(PC,G=>{G.getParser()&&m("Failed to pick issue",Le.DEFAULT,null,null,"Error")}),z(vC,G=>{const K=G.getParser();d(Y=>{const te=[...Y],ne=te.findIndex(J=>J.issueId===K.issueId);return ne>=0&&te.splice(ne,1),te})}),z(LC,G=>{G.getParser().success?m("Moderation action was successfull",Le.MODERATION,null,null,"Success"):m("There was a problem applying tht moderation action",Le.MODERATION,null,null,"Error")}),z($O,G=>{const K=G.getParser();E(K.callForHelpCategories)}),z(ZO,G=>{G.getParser()}),{settings:n,openRooms:t,openRoomChatlogs:r,openUserChatlogs:c,openUserInfos:a,cfhCategories:f,tickets:h,openRoomInfo:R,closeRoomInfo:I,toggleRoomInfo:S,openRoomChatlog:A,closeRoomChatlog:N,toggleRoomChatlog:L,openUserInfo:M,closeUserInfo:b,toggleUserInfo:B,openUserChatlog:w,closeUserChatlog:x,toggleUserChatlog:U}},sc=()=>os(m7),E7=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(null),[r,i]=_.useState(null),[a,l]=_.useState(null),[c,u]=_.useState({roomInfo:null,state:ut.NONE}),[h,d]=_.useState(null),[f,E]=_.useState({settingsReceived:!1,homeRoomId:0,enteredGuestRoom:null,currentRoomOwner:!1,currentRoomId:0,currentRoomIsStaffPick:!1,createdFlatId:0,avatarId:0,roomPicker:!1,eventMod:!1,currentRoomRating:0,canRate:!0}),{simpleAlert:m=null}=Xt();return z(sA,R=>{const I=R.getParser();V(new Bc(I.roomId,!1,!1))}),z(XC,R=>{const I=R.getParser();I.canCreate||m(p(`navigator.cannotcreateevent.error.${I.errorCode}`),null,null,null,p("navigator.cannotcreateevent.title"))}),z(Nl,R=>{V(new GM),V(new iE)}),z(Km,R=>{const I=R.getParser();E(S=>{const A={...S};return A.eventMod=I.securityLevel>=Cr.MODERATOR,A.roomPicker=I.securityLevel>=Cr.COMMUNITY,A})}),z(bA,R=>{const I=R.getParser();Wi(I.roomId)}),z(Wm,R=>{const I=R.getParser();E(S=>{const A={...S};return A.enteredGuestRoom=null,A.currentRoomOwner=I.isOwner,A.currentRoomId=I.roomId,A}),V(new Bc(I.roomId,!0,!1)),Je.available&&Je.call("legacyTrack","navigator","private",[I.roomId])}),z(sa,R=>{const I=R.getParser();if(I.roomEnter)u({roomInfo:null,state:ut.NONE}),E(S=>{const A={...S};return A.enteredGuestRoom=I.data,A.currentRoomIsStaffPick=I.staffPick,!(A.createdFlatId===I.data.roomId)&&I.data.displayRoomEntryAd&&ce("roomenterad.habblet.enabled",!1)&&ra.openRoomEnterAd(),A.createdFlatId=0,A.enteredGuestRoom&&A.enteredGuestRoom.habboGroupId>0,A});else if(I.roomForward){if(I.data.ownerName!==$().userName&&!I.isGroupMember)switch(I.data.doorMode){case Ft.DOORBELL_STATE:u(S=>{const A={...S};return A.roomInfo=I.data,A.state=ut.START_DOORBELL,A});return;case Ft.PASSWORD_STATE:u(S=>{const A={...S};return A.roomInfo=I.data,A.state=ut.START_PASSWORD,A});return}if(I.data.doorMode===Ft.NOOB_STATE&&!$().isAmbassador&&!$().isRealNoob&&!$().isModerator)return;po(I.data.roomId)}else E(S=>{const A={...S};return A.enteredGuestRoom=I.data,A.currentRoomIsStaffPick=I.staffPick,A})}),z(UA,R=>{const I=R.getParser();E(S=>{const A={...S};return A.currentRoomRating=I.totalLikes,A.canRate=I.canLike,A})}),z(Vm,R=>{const I=R.getParser();(!I.userName||I.userName.length===0)&&u(S=>{const A={...S};return A.state=ut.STATE_WAITING,A})}),z(Uh,R=>{const I=R.getParser();(!I.userName||I.userName.length===0)&&u(S=>{const A={...S};return A.state=ut.STATE_ACCEPTED,A})}),z(Lh,R=>{const I=R.getParser();(!I.userName||I.userName.length===0)&&u(S=>{const A={...S};return A.state=ut.STATE_NO_ANSWER,A})}),z(bh,R=>{switch(R.getParser().errorCode){case-100002:u(S=>{const A={...S};return A.state=ut.STATE_WRONG_PASSWORD,A});return;case 4009:m(p("navigator.alert.need.to.be.vip"),Le.DEFAULT,null,null,p("generic.alert.title"));return;case 4010:m(p("navigator.alert.invalid_room_name"),Le.DEFAULT,null,null,p("generic.alert.title"));return;case 4011:m(p("navigator.alert.cannot_perm_ban"),Le.DEFAULT,null,null,p("generic.alert.title"));return;case 4013:m(p("navigator.alert.room_in_maintenance"),Le.DEFAULT,null,null,p("generic.alert.title"));return}}),z(JC,R=>{const I=R.getParser();l(I.topLevelContexts),i(I.topLevelContexts.length?I.topLevelContexts[0]:null)}),z($C,R=>{const I=R.getParser();i(S=>{let A=S;if(A||(A=a&&a.length&&a[0]||null),!A)return null;if(I.result.code!==A.code&&a&&a.length)for(const N of a)N.code===I.result.code&&(A=N);for(const N of a)N.code===I.result.code&&(A=N);return A}),d(I.result)}),z(iA,R=>{const I=R.getParser();e(I.categories)}),z(rA,R=>{const I=R.getParser();s(I.categories)}),z(qC,R=>{const I=R.getParser();po(I.roomId)}),z(QC,R=>{const I=R.getParser();let S=!1;if(E(L=>{S=L.settingsReceived;const M={...L};return M.homeRoomId=I.homeRoomId,M.settingsReceived=!0,M}),S)return;let A=-1,N=-1;ce("friend.id")!==void 0&&parseInt(ce("friend.id"))>0&&(A=0,V(new wd(parseInt(ce("friend.id"))))),ce("forward.type")!==void 0&&ce("forward.id")!==void 0&&(A=parseInt(ce("forward.type")),N=parseInt(ce("forward.id"))),A===2?Wi(N):A===-1&&I.roomIdToEnter>0&&(de("navigator/close"),I.roomIdToEnter!==I.homeRoomId?po(I.roomIdToEnter):po(I.homeRoomId))}),z(vA,R=>{const I=R.getParser();switch(I.reason){case va.REASON_FULL:m(p("navigator.guestroomfull.text"),Le.DEFAULT,null,null,p("navigator.guestroomfull.title"));break;case va.REASON_QUEUE_ERROR:m(p(`room.queue.error.${I.parameter}`),Le.DEFAULT,null,null,p("room.queue.error.title"));break;case va.REASON_BANNED:m(p("navigator.banned.text"),Le.DEFAULT,null,null,p("navigator.banned.title"));break;default:m(p("room.queue.error.title"),Le.DEFAULT,null,null,p("room.queue.error.title"));break}N6()}),z(ZC,R=>de("navigator/show")),{categories:n,doorData:c,setDoorData:u,topLevelContext:r,topLevelContexts:a,searchResult:h,navigatorData:f}},Mi=()=>os(E7),p7=()=>{const[n,e]=_.useState(new ZE),t=_.useMemo(()=>ce("hc.disabled",!1),[]),s=_.useMemo(()=>t||n.clubDays>0?wi.ACTIVE:n.pastVipDays>0||n.pastVipDays>0?wi.EXPIRED:wi.NONE,[n,t]),r=i=>{if(i===-1)return n.credits;for(const[a,l]of n.activityPoints.entries())if(a===i)return l;return 0};return z(vN,i=>{const a=i.getParser();e(l=>{const c=dr(l);return c.credits=parseFloat(a.credits),l.credits!==c.credits&&mn(kr.CREDITS),c})}),z(bN,i=>{const a=i.getParser();e(l=>{const c=dr(l);return c.activityPoints=a.currencies,c})}),z(Hm,i=>{const a=i.getParser();e(l=>{const c=dr(l);return c.activityPoints=new Map(c.activityPoints),c.activityPoints.set(a.type,a.amount),a.type===0&&mn(kr.DUCKETS),c})}),z(PN,i=>{const a=i.getParser(),l=a.productName;l!=="club_habbo"&&l!=="habbo_club"||e(c=>{const u=dr(c);return u.clubDays=Math.max(0,a.daysToPeriodEnd),u.clubPeriods=Math.max(0,a.periodsSubscribedAhead),u.isVip=a.isVip,u.pastClubDays=a.pastClubDays,u.pastVipDays=a.pastVipDays,u.isExpiring=a.responseType===kl.RESPONSE_TYPE_DISCOUNT_AVAILABLE,u.minutesUntilExpiration=a.minutesUntilExpiration,u.minutesSinceLastModified=a.minutesSinceLastModified,u})}),_.useEffect(()=>{if(t)return;V(new Rf("habbo_club"));const i=setInterval(()=>V(new Rf("habbo_club")),5e4);return()=>clearInterval(i)},[t]),_.useEffect(()=>{V(new vv)},[]),{purse:n,hcDisabled:t,clubStatus:s,getCurrencyAmount:r}},ko=()=>os(p7),I7=(n,e)=>{_.useEffect(()=>{if(!n)return;const t=s=>e(s);return fn.addEventListener(st.FURNI_ADDED,t),()=>{fn.removeEventListener(st.FURNI_ADDED,t)}},[n,e])},si=(n,e)=>{_.useEffect(()=>{if(!n)return;const t=s=>e(s);return fn.addEventListener(st.FURNI_REMOVED,t),()=>{fn.removeEventListener(st.FURNI_REMOVED,t)}},[n,e])},T7=n=>{Ts(st.OBJECT_DESELECTED,n)},R7=n=>{Ts(st.OBJECT_ROLL_OUT,n)},O7=n=>{Ts(st.OBJECT_ROLL_OVER,n)},np=n=>{Ts(st.OBJECT_SELECTED,n)},gL=(n,e)=>{_.useEffect(()=>{if(!n)return;const t=s=>e(s);return fn.addEventListener(st.USER_ADDED,t),()=>{fn.removeEventListener(st.USER_ADDED,t)}},[n,e])},fL=(n,e)=>{_.useEffect(()=>{if(!n)return;const t=s=>e(s);return fn.addEventListener(st.USER_REMOVED,t),()=>{fn.removeEventListener(st.USER_REMOVED,t)}},[n,e])},S7=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(!1);return z(eA,r=>{const i=r.getParser();i&&e(i)}),{promoteInformation:n,isExtended:t,setPromoteInformation:e,setIsExtended:s}},ap=()=>os(S7),C7=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(null),[r,i]=_.useState(null),[a,l]=_.useState(0),c=(h,d,f,E=!1)=>{if(!t)return;const m=sr.hslToRGB(((h&255)<<16)+((d&255)<<8)+(f&255));E&&l(m),!h&&!d&&!f?t.tint=0:t.tint=m},u=h=>{if(!r)return;const d=h>>16&255,f=h>>8&255,E=h&255;r.red=d/255,r.green=f/255,r.blue=E/255};return Ts(ya.PREVIEW,h=>c(h.hue,h.saturation,h.lightness)),Ts(ya.CLEAR_PREVIEW,h=>{t&&(t.tint=a)}),$e(yh.ROOM_BACKGROUND_COLOR,h=>{Yn.isRoomPreviewerId(h.roomId)||(h.enable?c(h.hue,h.saturation,h.lightness,!0):c(0,0,0,!0))}),$e(QT.ROOM_COLOR,h=>{if(Yn.isRoomPreviewerId(h.roomId))return;let d=0,f=255;h.bgOnly||(d=h.color,f=h.brightness),u(sr.hslToRGB((sr.rgbToHSL(d)&16776960)+f))}),$e([je.INITIALIZED,je.DISPOSED],h=>{if(Yn.isRoomPreviewerId(h.roomId))return;const d=at();if(d)switch(h.type){case je.INITIALIZED:Xp(h.roomId),e(d);return;case je.DISPOSED:e(null);return}}),kt([Ne.CREATED,Ne.ENDED],h=>{switch(h.type){case Ne.CREATED:A6(h.session);return;case Ne.ENDED:e(null);return}}),$e([ue.SELECTED,ue.DESELECTED,ue.ADDED,ue.REMOVED,ue.PLACED,ue.REQUEST_MOVE,ue.REQUEST_ROTATE,ue.MOUSE_ENTER,ue.MOUSE_LEAVE,ue.DOUBLE_CLICK],h=>{if(Yn.isRoomPreviewerId(h.roomId))return;let d=null;switch(h.type){case ue.SELECTED:M6(h)||(d=new st(st.OBJECT_SELECTED,h.objectId,h.category,h.roomId));break;case ue.DESELECTED:d=new st(st.OBJECT_DESELECTED,h.objectId,h.category,h.roomId);break;case ue.ADDED:{let f=null;switch(h.category){case k.FLOOR:case k.WALL:f=st.FURNI_ADDED;break;case k.UNIT:f=st.USER_ADDED;break}f&&(d=new st(f,h.objectId,h.category,h.roomId));break}case ue.REMOVED:{let f=null;switch(h.category){case k.FLOOR:case k.WALL:f=st.FURNI_REMOVED;break;case k.UNIT:f=st.USER_REMOVED;break}f&&(d=new st(f,h.objectId,h.category,h.roomId));break}case ue.REQUEST_MOVE:Yc(n,h.objectId,h.category)&&dl(h.objectId,h.category,ye.OBJECT_MOVE);break;case ue.REQUEST_ROTATE:Yc(n,h.objectId,h.category)&&dl(h.objectId,h.category,ye.OBJECT_ROTATE_POSITIVE);break;case ue.MOUSE_ENTER:d=new st(st.OBJECT_ROLL_OVER,h.objectId,h.category,h.roomId);break;case ue.MOUSE_LEAVE:d=new st(st.OBJECT_ROLL_OUT,h.objectId,h.category,h.roomId);break;case ue.DOUBLE_CLICK:d=new st(st.OBJECT_DOUBLE_CLICKED,h.objectId,h.category,h.roomId);break}d&&Fs(d)}),_.useEffect(()=>{if(!n)return;const h=ze(),d=ee(),f=n.roomId,E=1,m=Math.floor(window.innerWidth),R=Math.floor(window.innerHeight),I=h.application.renderer;I&&(I.view.style.width=`${m}px`,I.view.style.height=`${R}px`,I.resolution=window.devicePixelRatio,I.resize(m,R));const S=d.getRoomInstanceDisplay(f,E,m,R,Cl.SCALE_ZOOMED_IN),A=ee().getRoomInstanceRenderingCanvas(f,E);if(!S||!A)return;const N=new jt(am.WHITE),L=new CT,M=A.master;N.tint=0,N.width=m,N.height=R,M.addChildAt(N,0),M.filters=[L],s(N),i(L);const b=d.getRoomInstanceGeometry(f,E);if(b){const x=d.getRoomInstanceVariable(f,pt.ROOM_MIN_X)||0,U=d.getRoomInstanceVariable(f,pt.ROOM_MAX_X)||0,G=d.getRoomInstanceVariable(f,pt.ROOM_MIN_Y)||0,K=d.getRoomInstanceVariable(f,pt.ROOM_MAX_Y)||0;let Y=(x+U)/2,te=(G+K)/2;const ne=20;Y=Y+(ne-1),te=te+(ne-1);const J=Math.sqrt(ne*ne+ne*ne)*Math.tan(30/180*Math.PI);b.location=new F(Y,te,J)}const B=h.application.stage;if(!B)return;B.addChild(S),Xp(n.roomId);const w=x=>{const U=Math.floor(window.innerWidth),G=Math.floor(window.innerHeight);I.view.style.width=`${U}px`,I.view.style.height=`${G}px`,I.resolution=window.devicePixelRatio,I.resize(U,G),N.width=U,N.height=G,y6(U,G,1),h.application.render()};return window.addEventListener("resize",w),()=>{s(null),i(null),l(0),window.removeEventListener("resize",w)}},[n]),{roomSession:n}},yt=()=>os(C7),A7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(0),{roomSession:a=null}=yt(),l=()=>{const h=sr.rgbToHSL(r),[d,f,E,m]=Jr.int_to_8BitVals(h);V(new jD(n,f,E,m))},c=()=>a.useMultistateItem(n),u=()=>{Fs(new ya(ya.CLEAR_PREVIEW)),e(-1),s(-1),i(0)};return $e(q.REQUEST_BACKGROUND_COLOR,h=>{if(!Yc(a,h.objectId,h.category))return;const f=ee().getRoomObject(h.roomId,h.objectId,h.category).model;e(h.objectId),s(h.category);const E=parseInt(f.getValue(C.FURNITURE_ROOM_BACKGROUND_COLOR_HUE)),m=parseInt(f.getValue(C.FURNITURE_ROOM_BACKGROUND_COLOR_SATURATION)),R=parseInt(f.getValue(C.FURNITURE_ROOM_BACKGROUND_COLOR_LIGHTNESS)),I=Jr.eight_bitVals_to_int(0,E,m,R),S=sr.hslToRGB(I);i(S)}),si(n!==-1&&t!==-1,h=>{h.id!==n||h.category!==t||u()}),_.useEffect(()=>{if(n===-1||t===-1)return;const h=sr.rgbToHSL(r),[d,f,E,m]=Jr.int_to_8BitVals(h);Fs(new ya(ya.PREVIEW,f,E,m))},[n,t,r]),{objectId:n,color:r,setColor:i,applyToner:l,toggleToner:c,onClose:u}},N7=A7,y7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState("1"),[a,l]=_.useState(""),[c,u]=_.useState(""),[h,d]=_.useState(""),[f,E]=_.useState(""),{simpleAlert:m=null}=Xt(),R=()=>{e(-1),s(-1),i("1"),l(""),u(""),d(""),E("")};return $e([q.REQUEST_BADGE_DISPLAY_ENGRAVING,q.REQUEST_ACHIEVEMENT_RESOLUTION_ENGRAVING],I=>{const S=ee().getRoomObject(I.roomId,I.objectId,I.category);if(!S)return;const A=new ta;A.initializeFromRoomObjectModel(S.model),e(I.objectId),s(I.category),i("1"),l(Au(A.getValue(1))),u(zE(A.getValue(1))),d(A.getValue(2)),E(A.getValue(3))}),$e(q.REQUEST_ACHIEVEMENT_RESOLUTION_FAILED,I=>{const S=ee().getRoomObject(I.roomId,I.objectId,I.category);!S||S.model.getValue(C.FURNITURE_OWNER_ID)!==$().userId||m(`${p("resolution.failed.subtitle")} ${p("resolution.failed.text")}`,null,null,null,p("resolution.failed.title"))}),si(n!==-1&&t!==-1,I=>{I.id!==n||I.category!==t||R()}),{objectId:n,category:t,color:r,badgeName:a,badgeDesc:c,date:h,senderName:f,onClose:R}},M7=y7,Xf="MONSTERPLANT_SEED_CONFIRMATION",qf="PURCHASABLE_CLOTHING_CONFIRMATION",mL="GROUP_FURNITURE",EL="EFFECTBOX_OPEN",Qf="MYSTERYTROPHY_OPEN_DIALOG",D7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(null),[r,i]=_.useState(null),[a,l]=_.useState(-1),[c,u]=_.useState(null),[h,d]=_.useState(!1),[f,E]=_.useState(-1),{roomSession:m=null}=yt(),R=()=>{e(-1),u(null),d(!1),s(null)},I=()=>{i(null),l(-1)},S=A=>{if(A)switch(A){case"use_friend_furni":m.useMultistateItem(n);break;case"use_monsterplant_seed":i(Xf),l(n);break;case"use_random_teleport":ee().useRoomObject(n,k.FLOOR);break;case"use_purchaseable_clothing":i(qf),l(n);break;case"use_mystery_box":m.useMultistateItem(n);break;case"use_mystery_trophy":i(Qf),l(n);break;case"join_group":JE(c.guildId),d(!0);return;case"go_to_group_homeroom":c&&Wi(c.guildHomeRoomId);break}R()};return $e([q.OPEN_FURNI_CONTEXT_MENU,q.CLOSE_FURNI_CONTEXT_MENU,q.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG,q.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG,q.REQUEST_EFFECTBOX_OPEN_DIALOG,q.REQUEST_MYSTERYBOX_OPEN_DIALOG,q.REQUEST_MYSTERYTROPHY_OPEN_DIALOG],A=>{const N=ee().getRoomObject(m.roomId,A.objectId,A.category);if(N)switch(E(N.model.getValue(C.FURNITURE_OWNER_ID)),A.type){case q.REQUEST_MONSTERPLANT_SEED_PLANT_CONFIRMATION_DIALOG:if(!tr(N))return;l(N.id),i(Xf),R();return;case q.REQUEST_EFFECTBOX_OPEN_DIALOG:if(!tr(N))return;l(N.id),i(EL),R();return;case q.REQUEST_PURCHASABLE_CLOTHING_CONFIRMATION_DIALOG:if(!tr(N))return;l(N.id),i(qf),R();return;case q.REQUEST_MYSTERYBOX_OPEN_DIALOG:m.useMultistateItem(N.id),R();return;case q.REQUEST_MYSTERYTROPHY_OPEN_DIALOG:if(!tr(N))return;l(N.id),i(Qf),R();return;case q.OPEN_FURNI_CONTEXT_MENU:switch(e(N.id),A.contextMenu){case Tt.FRIEND_FURNITURE:s(Tt.FRIEND_FURNITURE);return;case Tt.MONSTERPLANT_SEED:tr(N)&&s(Tt.MONSTERPLANT_SEED);return;case Tt.MYSTERY_BOX:s(Tt.MYSTERY_BOX);return;case Tt.MYSTERY_TROPHY:tr(N)&&s(Tt.MYSTERY_TROPHY);return;case Tt.RANDOM_TELEPORT:s(Tt.RANDOM_TELEPORT);return;case Tt.PURCHASABLE_CLOTHING:tr(N)&&s(Tt.PURCHASABLE_CLOTHING);return}return;case q.CLOSE_FURNI_CONTEXT_MENU:N.id===n&&R();return}}),z(GA,A=>{const N=A.getParser();e(N.objectId),u(N),d(N.userIsMember),s(mL)}),{objectId:n,mode:t,confirmMode:r,confirmingObjectId:a,groupData:c,isGroupMember:h,objectOwnerId:f,closeConfirm:I,processAction:S,onClose:R}},v7=D7,b7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState([]),[r,i]=_.useState(null),[a,l]=_.useState([]),[c,u]=_.useState(null),[h,d]=_.useState(new Map),[f,E]=_.useState(!1),{groupItems:m=[],getItemsByType:R=null,activate:I=null,deactivate:S=null}=Bo(),{simpleAlert:A=null}=Xt(),N=r&&h.get(r.name)||null,L=()=>{s([]),i(null),l([]),d(new Map)},M=()=>{e(-1),L()},b=()=>{E(!0),V(new ly(n,r.name))},B=w=>{i(w),h.get(w.name)||V(new uy(w.name))};return $e(q.OPEN_WIDGET,w=>{w.widget===De.CRAFTING&&(e(w.objectId),L(),V(new cy(w.objectId)))}),z(yS,w=>{const x=w.getParser();if(!x.isActive()){e(-1);return}s(U=>{const G=[];for(const K of x.recipes){const Y=ee().roomContentLoader._activeObjectTypeIds.get(K.itemName),te=ee().getFurnitureFloorIconUrl(Y);G.push({name:K.recipeName,localizedName:p("roomItem.name."+Y),iconUrl:te})}return G}),u(x.ingredients)}),z(MS,w=>{const x=w.getParser();d(U=>{const G=new Map(U);return G.set(r.name,x.ingredients),G})}),z(vS,w=>{i(null),E(!1),w.getParser().result&&A(p("crafting.info.result.ok"))}),z(DS,w=>{}),_.useEffect(()=>{!c||!c.length||l(w=>{const x=[];for(const U of c){const G=ee().roomContentLoader._activeObjectTypeIds.get(U),K=ee().getFurnitureFloorIconUrl(G),Y=R(G);let te=0;if(Y)for(const ne of Y)te+=ne.items.length;x.push({name:U,iconUrl:K,count:te})}return x})},[m,c,R]),_.useEffect(()=>{if(n===-1)return;const w=I();return()=>S(w)},[n,I,S]),{objectId:n,recipes:t,ingredients:a,selectedRecipe:r,requiredIngredients:N,isCrafting:f,selectRecipe:B,craft:b,onClose:M}},P7=b7,L7=()=>{const[n,e]=_.useState([]),[t,s]=_.useState(0),[r,i]=_.useState(0),[a,l]=_.useState(0),[c,u]=_.useState(0),[h,d]=_.useState(16777215),[f,E]=_.useState(255),[m,R]=_.useState(0),[I,S]=_.useState(0),[A,N]=_.useState(0),{roomSession:L=null}=yt(),M=()=>L.isRoomOwner||L.controllerLevel>=ct.GUEST||$().isModerator,b=w=>{const x=n[w-1];x&&(s(x.id),R(x.type),S(x.color),N(x.light))},B=()=>{if(r===0)return;const w=t-1;if(t<1||t>n.length)return;const x=n[w];!x||m===x.type&&I===x.color&&A===x.light||(e(U=>{const G=[...U];return G[w]=new oI(x.id,m,I,A),G}),Pr.savePreset(x.id,m,I,A,!0))};return $e(q.REQUEST_DIMMER,w=>{M()&&L.requestMoodlightSettings()}),kt(Mh.ROOM_DIMMER_PRESETS,w=>{const x=[];let U=0;for(;U<w.presetCount;){const G=w.getPreset(U);G&&x.push(new oI(G.id,G.type,G.color,G.brightness)),U++}e(x),s(w.selectedPresetId)}),$e(sR.ROOM_COLOR,w=>{Yn.isRoomPreviewerId(w.roomId)||(l(r),i(w.state),s(w.presetId),u(w.effectId),R(w.effectId),d(w.color),S(w.color),E(w.brightness),N(w.brightness))}),_.useEffect(()=>{r===0&&a===0||Pr.previewDimmer(I,A,m===2)},[r,a,I,A,m]),{presets:n,selectedPresetId:t,dimmerState:r,lastDimmerState:a,effectId:c,color:h,brightness:f,selectedEffectId:m,setSelectedEffectId:R,selectedColor:I,setSelectedColor:S,selectedBrightness:A,setSelectedBrightness:N,selectPresetId:b,applyChanges:B}},U7=L7,F7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(0),a=()=>{e(-1),s(-1),i(0)},l=()=>{at().connection.send(new FD(n)),a()};return $e(q.REQUEST_CREDITFURNI,c=>{const u=ee().getRoomObject(c.roomId,c.objectId,c.category);!u||!tr(u)||(e(c.objectId),s(c.category),i(u.model.getValue(C.FURNITURE_CREDIT_VALUE)||0))}),si(n!==-1&&t!==-1,c=>{c.id!==n||c.category!==t||a()}),{objectId:n,value:r,redeem:l,onClose:a}},x7=F7,w7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(-1),[a,l]=_.useState([]),{roomSession:c=null}=yt(),u=()=>{e(-1),s(-1),i(-1),l([])};return $e(q.REQUEST_EXTERNAL_IMAGE,h=>{const d=ee().getRoomObject(h.roomId,h.objectId,h.category),f=ee().getRoomObjects(c==null?void 0:c.roomId,k.WALL);if(!d)return;const E=[];f.forEach(R=>{if(R.type!=="external_image_wallitem_poster_small")return null;const I=R.model.getValue(C.FURNITURE_DATA),S=JSON.parse(I);E.push(S)}),e(h.objectId),s(h.category),l(E);const m=JSON.parse(d.model.getValue(C.FURNITURE_DATA));i(R=>{let I=0;return m&&(I=E.findIndex(S=>S.u===m.u)),I<0&&(I=0),I})}),si(n!==-1&&t!==-1,h=>{h.id!==n||h.category!==t||u()}),{objectId:n,currentPhotoIndex:r,currentPhotos:a,onClose:u}},G7=w7,B7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(0),[a,l]=_.useState([]),[c,u]=_.useState([]),[h,d]=_.useState(null),[f,E]=_.useState(0),m=()=>{e(-1),s(-1),i(0),l([]),u([]),d(null)},R=I=>{at().connection.send(new dy(n,I)),m()};return z(VA,I=>{const S=I.getParser();e(S.furniId),E(S.start?1:2)}),z(BA,I=>m()),z(kA,I=>m()),$e(q.REQUEST_FRIEND_FURNITURE_ENGRAVING,I=>{const S=ee().getRoomObject(I.roomId,I.objectId,I.category);if(!S)return;const A=S.model.getValue(C.FURNITURE_DATA),N=S.model.getValue(C.FURNITURE_FRIENDFURNI_ENGRAVING);A[0]!=="1"||A.length!==6||(e(I.objectId),s(I.category),i(N),l([A[1],A[2]]),u([A[3],A[4]]),d(A[5]),E(0))}),si(n!==-1&&t!==-1,I=>{I.id!==n||I.category!==t||m()}),{objectId:n,type:r,usernames:a,figures:c,date:h,stage:f,onClose:m,respond:R}},k7=B7,V7=["perteam","mostwins","classic"],H7=["alltime","daily","weekly","monthly"],j7=()=>{const[n,e]=_.useState(new Map),{roomSession:t=null}=yt(),s=i=>V7[i],r=i=>H7[i];return $e(q.REQUEST_HIGH_SCORE_DISPLAY,i=>{const a=ee().getRoomObject(i.roomId,i.objectId,i.category);if(!a)return;const l=a.model.getValue(C.FURNITURE_DATA_FORMAT),c=un.getData(l);c.initializeFromRoomObjectModel(a.model),e(u=>{const h=new Map(u);return h.set(a.id,c),h})}),$e(q.REQUEST_HIDE_HIGH_SCORE_DISPLAY,i=>{i.roomId===t.roomId&&e(a=>{const l=new Map(a);return l.delete(i.objectId),l})}),{stuffDatas:n,getScoreType:s,getClearType:r}},W7=j7,Y7="internalLink",z7=()=>($e(q.REQUEST_INTERNAL_LINK,n=>{const e=ee().getRoomObject(n.roomId,n.objectId,n.category);if(!e)return;let s=e.model.getValue(C.FURNITURE_DATA)[Y7];(!s||!s.length)&&(s=e.model.getValue(C.FURNITURE_INTERNAL_LINK)),s&&s.length&&de(s)}),{}),K7=z7,X7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(null),[a,l]=_.useState(null),[c,u]=_.useState(_r.NO_CLUB),[h,d]=_.useState(null),f=()=>{e(-1),s(-1),i(null),l(null),d(null)},E=()=>{n!==-1&&(V(new BD(n)),f())},m=()=>{n!==-1&&(V(new Ml(n)),f())},R=()=>{n!==-1&&V(new kD(n,h))};return $e(q.REQUEST_MANNEQUIN,I=>{const S=ee().getRoomObject(I.roomId,I.objectId,I.category);if(!S)return;const A=S.model,N=A.getValue(C.FURNITURE_MANNEQUIN_FIGURE)||null,L=A.getValue(C.FURNITURE_MANNEQUIN_GENDER)||null,M=fs().createFigureContainer(N),b=fs().getFigureClubLevel(M,L,Ol.MANNEQUIN_CLOTHING_PART_TYPES);e(I.objectId),s(I.category),i(N),l(L),u(b),d(A.getValue(C.FURNITURE_MANNEQUIN_NAME)||null)}),si(n!==-1&&t!==-1,I=>{I.id!==n||I.category!==t||f()}),{objectId:n,figure:r,gender:a,clubLevel:c,name:h,setName:d,saveFigure:E,wearFigure:m,saveName:R,onClose:f}},q7=X7,Q7=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(-1),[a,l]=_.useState(new Zt),[c,u]=_.useState([]),{roomSession:h=null}=yt(),{showSingleBubble:d=null,simpleAlert:f=null}=Xt(),E=()=>{e(-1),s(-1)},m=_.useCallback((A,N)=>V(new gv(A,N)),[]),R=_.useCallback(A=>V(new Tv(A)),[]),I=_.useCallback((A,N)=>V(new Ml(A,N)),[]);$e(q.REQUEST_PLAYLIST_EDITOR,A=>{var L,M,b;const N=ee().getRoomObject(A.roomId,A.objectId,A.category);if(N){if(tr(N)){e(A.objectId),s(A.category),(L=ze().soundManager.musicController)==null||L.requestUserSongDisks(),(b=(M=ze().soundManager.musicController)==null?void 0:M.getRoomItemPlaylist())==null||b.requestPlayList();return}(h.isRoomOwner||h.controllerLevel>=ct.GUEST||$().isModerator)&&V(new Ml(A.objectId,-2))}}),si(n!==-1&&t!==-1,A=>{A.id!==n||A.category!==t||E()}),_o(Bi.NPE_SONG_CHANGED,A=>{i(A.position)}),_o(Zb.NOTIFY_PLAYED_SONG,A=>{d(p("soundmachine.notification.playing",["songname","songauthor"],[A.name,A.creator]),Bt.SOUNDMACHINE)}),_o(hl.SDIR_SONG_DISK_INVENTORY_RECEIVENT_EVENT,A=>{var N;l((N=ze().soundManager.musicController)==null?void 0:N.songDiskInventory.clone())}),_o(ln.PLUE_PLAY_LIST_UPDATED,A=>{var N,L;u((L=(N=ze().soundManager.musicController)==null?void 0:N.getRoomItemPlaylist())==null?void 0:L.entries.concat())}),_o(ln.PLUE_PLAY_LIST_FULL,A=>{f(p("playlist.editor.alert.playlist.full"),Le.ALERT,"","",p("playlist.editor.alert.playlist.full.title"))});const S=A=>{var N,L;n!==-1&&(A instanceof Ph?A.getParser().fragmentNumber===0&&((N=ze().soundManager.musicController)==null||N.requestUserSongDisks()):(L=ze().soundManager.musicController)==null||L.requestUserSongDisks())};return z(Ph,S),z(km,S),z(Bm,S),{objectId:n,diskInventory:a,playlist:c,currentPlayingIndex:r,onClose:E,addToPlaylist:m,removeFromPlaylist:R,togglePlayPause:I}},J7=Q7,gI="floor",Z7="wallpaper",fI="landscape",$7="poster",e8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(null),[a,l]=_.useState(null),[c,u]=_.useState(!1),[h,d]=_.useState(null),[f,E]=_.useState(null),[m,R]=_.useState(-1),[I,S]=_.useState(null),[A,N]=_.useState(!1),[L,M]=_.useState(null),{roomSession:b=null}=yt(),B=()=>{e(-1),s(-1),i(null),l(null),u(!1),d(null),E(null),R(-1),S(null),N(!1),M(null)},w=()=>{n!==-1&&(b.openGift(n),ee().changeObjectModelData(ee().activeRoomId,n,k.FLOOR,C.FURNITURE_DISABLE_PICKING_ANIMATION,1))},x=_.useMemo(()=>({imageReady:(U,G,K)=>{!K&&G&&(K=ht.generateImage(G)),M(K.src)},imageFailed:null}),[]);return kt(Dh.RSPE_PRESENT_OPENED,U=>{let G=null;U.itemType===Pe.FLOOR?G=$().getFloorItemData(U.classId):U.itemType===Pe.WALL&&(G=$().getWallItemData(U.classId));let K=!1;if(U.placedInRoom){const Y=ee().getRoomObject(b.roomId,U.placedItemId,k.FLOOR);Y&&(K=tr(Y))}switch(U.itemType){case Pe.WALL:{if(G)switch(G.className){case gI:case fI:case Z7:let Y=null;G.className===gI?Y=p("inventory.furni.item.floor.name"):G.className===fI?Y=p("inventory.furni.item.landscape.name"):Y=p("inventory.furni.item.wallpaper.name"),l(Y);break;case $7:{const te=U.productCode;let ne=null;te.indexOf("poster")===0&&(ne=te.replace("poster",""));const J=$().getProductData(te);let Ce=null;J?Ce=J.name:G&&(Ce=G.name),l(Ce),M(ee().getFurnitureWallIconUrl(U.classId,ne));break}default:{l(G.name||null),M(ee().getFurnitureWallIconUrl(U.classId));break}}break}case Pe.HABBO_CLUB:l(p("widget.furni.present.hc"));break;default:{if(U.placedItemType===Pe.PET){const te=U.petFigureString;if(te&&te.length){const ne=new gn(te),J=ee().getRoomObjectPetImage(ne.typeId,ne.paletteId,ne.color,new F(90),64,x,!0,0,ne.customParts);J&&M(J.getImage().src)}}else{const te=ee().getFurnitureFloorImage(U.classId,new F(90),64,x);te&&M(te.getImage().src)}const Y=$().getProductData(U.productCode);l(Y&&Y.name||G.name);break}}e(0),s(U.classId),i(U.itemType),u(K),R(U.placedItemId),S(U.placedItemType),N(U.placedInRoom)}),$e(q.REQUEST_PRESENT,U=>{const G=ee().getRoomObject(U.roomId,U.objectId,U.category);if(!G)return null;B(),e(U.objectId),s(-1),l(G.model.getValue(C.FURNITURE_DATA)||""),u(tr(G)),d(G.model.getValue(C.FURNITURE_PURCHASER_NAME)||null),E(G.model.getValue(C.FURNITURE_PURCHASER_FIGURE)||null)}),si(n!==-1,U=>{U.id===n&&B(),U.id===m&&A&&N(!1)}),{objectId:n,classId:t,itemType:r,text:a,isOwnerOfFurniture:c,senderName:h,senderFigure:f,placedItemId:m,placedItemType:I,placedInRoom:A,imageUrl:L,openPresent:w,onClose:B}},t8=e8,s8="internalLink",r8=()=>{const[n,e]=_.useState(0);return $e(q.REQUEST_ROOM_LINK,t=>{const s=ee().getRoomObject(t.roomId,t.objectId,t.category);if(!s)return;let i=s.model.getValue(C.FURNITURE_DATA)[s8];(!i||!i.length)&&(i=s.model.getValue(C.FURNITURE_INTERNAL_LINK)),!(!i||!i.length)&&(i=parseInt(i,10),!isNaN(i)&&(e(i),V(new Bc(i,!1,!1))))}),z(sa,t=>{!n||t.getParser().data.roomId!==n||e(0)}),{}},i8=r8,n8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(""),[a,l]=_.useState(""),[c,u]=_.useState("0"),[h,d]=_.useState(""),[f,E]=_.useState(!1),{getWallItemById:m=null}=Bo(),R=()=>{V(new CD(n,a,c,h)),e(-1),s(-1),i(""),l(""),u("0"),d(""),E(!1)};return z(HA,I=>{const S=I.getParser();e(S.itemId),s(k.WALL);const A=m(S.itemId);let N="post_it";if(A){const L=ee().getFurnitureWallName(A.type);L.match("post_it_")&&(N=L)}i(N),l(S.location),u("FFFF33"),d(""),E(!0)}),{objectId:n,color:c,setColor:u,text:h,setText:d,canModify:f,onClose:R}},a8=n8,V_=40,o8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(0),[a,l]=_.useState(-1),c=()=>{e(-1),s(-1),i(0),l(-1)},u=(h,d=!1)=>{h||(h=0),h=Math.abs(h),d||h>V_&&(h=V_),i(parseFloat(h.toFixed(2))),d||l(h*100)};return z(wA,h=>{const d=h.getParser();n===d.furniId&&u(d.height,!0)}),$e(q.REQUEST_STACK_HEIGHT,h=>{if(!Yc(at(),h.objectId,h.category))return;const d=ee().getRoomObject(h.roomId,h.objectId,h.category);d&&(e(h.objectId),s(h.category),i(d.getLocation().z),l(-1))}),si(n!==-1&&t!==-1,h=>{h.id!==n||h.category!==t||c()}),_.useEffect(()=>{if(n===-1||a===-1)return;const h=setTimeout(()=>V(new Kh(n,~~a)),10);return()=>clearTimeout(h)},[n,a]),{objectId:n,height:r,maxHeight:V_,onClose:c,updateHeight:u}},l8=o8,c8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState("0"),[a,l]=_.useState(""),[c,u]=_.useState(""),[h,d]=_.useState(!1),f=()=>{e(-1),s(-1),i("0"),l(""),u(""),d(!1)},E=I=>{I!==r&&(i(I),ee().modifyRoomObjectData(n,t,I,a))},m=I=>{l(I),ee().modifyRoomObjectData(n,t,r,I)},R=()=>ee().deleteRoomObject(n,t);return $e(q.REQUEST_STICKIE,I=>{const S=ee().getRoomObject(I.roomId,I.objectId,I.category);if(!S)return;const A=S.model.getValue(C.FURNITURE_ITEMDATA);if(A.length<6)return;let N=null,L=null;A.indexOf(" ")>0?(N=A.slice(0,A.indexOf(" ")),L=A.slice(A.indexOf(" ")+1,A.length)):N=A,e(I.objectId),s(I.category),i(N||"0"),l(L||""),u(S.type||"post_it"),d(at().isRoomOwner||$().isModerator||tr(S))}),si(n!==-1&&t!==-1,I=>{I.id!==n||I.category!==t||f()}),{objectId:n,color:r,text:a,type:c,canModify:h,updateColor:E,updateText:m,trash:R,onClose:f}},u8=c8,h8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState("1"),[a,l]=_.useState(""),[c,u]=_.useState(""),[h,d]=_.useState(""),f=()=>{e(-1),s(-1),i("1"),l(""),u(""),d("")};return $e(q.REQUEST_TROPHY,E=>{const m=ee().getRoomObject(E.roomId,E.objectId,E.category);if(!m)return;let R=m.model.getValue(C.FURNITURE_DATA);m.model.getValue(C.FURNITURE_EXTRAS),e(E.objectId),s(E.category),i(m.model.getValue(C.FURNITURE_COLOR)||"1");const I=R.substring(0,R.indexOf("	"));R=R.substring(I.length+1,R.length);const S=R.substring(0,R.indexOf("	")),A=R.substr(S.length+1,R.length);l(I),u(S),d(A)}),si(n!==-1&&t!==-1,E=>{E.id!==n||E.category!==t||f()}),{objectId:n,color:r,senderName:a,date:c,message:h,onClose:f}},d8=h8,_8=0,g8=1,f8=2,m8=3,E8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(-1),[r,i]=_.useState(null),[a,l]=_.useState(null),[c,u]=_.useState(null),[h,d]=_.useState(-1),[f,E]=_.useState(null),[m,R]=_.useState(null),[I,S]=_.useState(!1),A=()=>{e(-1),s(-1),i(null),l(null),u(null),d(-1),E(null),R(null),S(!1)},N=()=>V(new fc(n,_8)),L=()=>V(new fc(n,g8)),M=()=>I&&r&&r.length&&V(new fc(n,f8)),b=()=>I&&r&&r.length&&V(new fc(n,m8)),B=w=>{if(f===w){E(null),V(new If(n,""));return}E(w),V(new If(n,w))};return $e(q.REQUEST_YOUTUBE,w=>{if(Yn.isRoomPreviewerId(w.roomId))return;const x=ee().getRoomObject(w.roomId,w.objectId,w.category);x&&(e(w.objectId),s(w.category),S($().hasSecurity(Cr.EMPLOYEE)||tr(x)),V(new YD(w.objectId)))}),z(zA,w=>{const x=w.getParser();n===-1||n!==x.furniId||(i(x.videoId),l(x.startAtSeconds),u(x.endAtSeconds),d(x.state))}),z(YA,w=>{const x=w.getParser();n===-1||n!==x.furniId||(R(x.playlists),E(x.selectedPlaylistId),i(null),d(-1),u(null),l(null))}),z(WA,w=>{const x=w.getParser();if(!(n===-1||n!==x.furniId))switch(x.commandId){case 1:d(Ei.PLAYING);break;case 2:d(Ei.PAUSED);break}}),si(n!==-1&&t!==-1,w=>{w.id!==n||w.category!==t||A()}),{objectId:n,videoId:r,videoStart:a,videoEnd:c,currentVideoState:h,selectedVideo:f,playlists:m,onClose:A,previous:N,next:L,pause:M,play:b,selectVideo:B}},p8=E8,I8=()=>{const[n,e]=_.useState(null),[t,s]=_.useState([]),[r,i]=_.useState(""),[a,l]=_.useState([]),[c,u]=_.useState(0),[h,d]=_.useState(Se.STUFF_SELECTION_OPTION_NONE),{showConfirm:f=null}=Xt(),E=()=>{const R=I=>{I&&(I instanceof bm?V(new hv(I.id,t,r,a,c,I.stuffTypeSelectionCode)):I instanceof vm?V(new _v(I.id,t,r,a,I.stuffTypeSelectionCode)):I instanceof Dm&&V(new dv(I.id,t,r,a,I.stuffTypeSelectionCode)))};S6(n.id)?R(n):f(p("wiredfurni.nonowner.change.confirm.body"),()=>{R(n)},null,null,null,p("wiredfurni.nonowner.change.confirm.title"))},m=(R,I)=>{!n||!h||R<=0||l(S=>{const A=[...S],N=S.indexOf(R);return N>=0?(A.splice(N,1),Pc.hide(R)):A.length<n.maximumItemSelectionCount&&(A.push(R),Pc.show(R)),A})};return z(aN,R=>{R.getParser(),e(null)}),z(rN,R=>{const I=R.getParser();e(I.definition)}),z(iN,R=>{const I=R.getParser();e(I.definition)}),z(nN,R=>{const I=R.getParser();e(I.definition)}),_.useEffect(()=>{if(n)return()=>{s([]),i(""),u(0),l(R=>(R&&R.length&&Pc.clearSelectionShaderFromFurni(R),[])),d(Se.STUFF_SELECTION_OPTION_NONE)}},[n]),{trigger:n,setTrigger:e,intParams:t,setIntParams:s,stringParam:r,setStringParam:i,furniIds:a,setFurniIds:l,actionDelay:c,setActionDelay:u,setAllowsFurni:d,saveWired:E,selectObjectForWired:m}},et=()=>os(I8),T8=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(null),[r,i]=_.useState([]),[a,l]=_.useState([]),[c,u]=_.useState(null),[h,d]=_.useState(-1),[f,E]=_.useState(!1),{friends:m=[]}=Wr(),{selectObjectForWired:R=null}=et(),{roomSession:I=null}=yt(),S=b=>{i(B=>{const w=[...B];return w.splice(b,1),w})},A=b=>{l(B=>{const w=[...B],x=w.splice(b,1)[0];return c===x&&u(null),w})},N=b=>{u(b),l([])},L=(b,B)=>{const w=Yo.getObjectName(b,B);w&&(s(w),B!==k.UNIT&&l([]))},M=(b,B)=>{let w=null;switch(B){case k.FLOOR:case k.WALL:w=Yo.getFurniInfo(b,B),w&&R(b,B);break;case k.UNIT:{const x=I.userDataManager.getUserDataByIndex(b);if(!x)break;switch(x.type){case Rt.PET:I.userDataManager.requestPetInfo(x.webID),d(x.webID);break;case Rt.USER:w=Yo.getUserInfo(B,x);break;case Rt.BOT:w=Yo.getBotInfo(B,x);break;case Rt.RENTABLE_BOT:w=Yo.getRentableBotInfo(B,x);break}}}w&&e(w)};return kt(XR.USER_DATA_UPDATED,b=>{if(!b.addedUsers.length)return;let B=[];b.addedUsers.forEach(w=>{w.webID!==$().userId&&m.find(x=>x.id===w.webID)&&B.push(new LP(w.roomIndex,k.UNIT,w.webID,w.name,w.type,!0))}),B.length&&i(w=>{const x=[...w];return B.forEach(U=>{const G=x.findIndex(K=>K.id===U.id);G>-1&&x.splice(G,1),x.push(U)}),x})}),kt(xR.PET_INFO,b=>{const B=b.petInfo;if(!B||B.id!==h)return;const w=Yo.getPetInfo(B);w&&(e(w),d(-1))}),kt(VR.PET_STATUS_UPDATE,b=>{}),$e(Sl.USE_PRODUCT_FROM_INVENTORY,b=>{}),$e(Sl.USE_PRODUCT_FROM_ROOM,b=>{const B=ee().getRoomObject(I.roomId,b.objectId,k.FLOOR);if(!B||!tr(B))return;const w=B.model.getValue(C.FURNITURE_OWNER_ID),x=B.model.getValue(C.FURNITURE_TYPE_ID),U=$().getFloorItemData(x),G=U.customParams.split(" "),K=G.length?parseInt(G[0]):-1;if(K===-1)return;const Y=[],te=ee().getRoomObjects(I.roomId,k.UNIT);for(const ne of te){const J=I.userDataManager.getUserDataByIndex(ne.id);let Ce=!1;if(!(!J||J.type!==Rt.PET)){if(J.ownerId===w){J.hasSaddle&&U.specialType===he.PET_SADDLE&&(Ce=!0);const Ae=J.figure.split(" ");if((Ae.length?parseInt(Ae[0]):-1)===K){if(U.specialType===he.MONSTERPLANT_REVIVAL&&!J.canRevive||U.specialType===he.MONSTERPLANT_REBREED&&(J.petLevel<7||J.canRevive||J.canBreed)||U.specialType===he.MONSTERPLANT_FERTILIZE&&(J.petLevel>=7||J.canRevive))continue;Y.push(new Rq(J.roomIndex,k.UNIT,J.name,b.objectId,ne.id,-1,Ce))}}}}u(null),Y.length&&l(Y)}),$e(ue.REQUEST_MANIPULATION,b=>{Yc(I,b.objectId,b.category)&&E(!0)}),np(b=>{M(b.id,b.category)}),T7(b=>{e(null),l([])}),O7(b=>{n||b.category!==k.UNIT||L(b.id,b.category)}),R7(b=>{!t||b.category!==k.UNIT||t.roomIndex!==b.id||s(null)}),Ts([st.FURNI_REMOVED,st.USER_REMOVED],b=>{if(t&&t.category===b.category&&t.roomIndex===b.id&&s(null),b.category===k.UNIT){let B=r.findIndex(w=>w.roomIndex===b.id);B>-1&&i(w=>w.filter(x=>x.roomIndex===b.id)),B=a.findIndex(w=>w.id===b.id),B>-1&&l(w=>w.filter(x=>x.id!==b.id))}else b.category===k.FLOOR&&a.findIndex(w=>w.id===b.id)>-1&&l(w=>w.filter(x=>x.requestRoomObjectId!==b.id));n&&(n instanceof Fl?n.id===b.id&&e(null):(n instanceof Ds||n instanceof wl||n instanceof xl)&&n.roomIndex===b.id&&e(null))}),_.useEffect(()=>{n&&(s(null),i([]),l([]))},[n]),_.useEffect(()=>{t&&i([])},[t]),_.useEffect(()=>{I.isDecorating=f},[I,f]),{avatarInfo:n,setAvatarInfo:e,activeNameBubble:t,setActiveNameBubble:s,nameBubbles:r,productBubbles:a,confirmingProduct:c,isDecorating:f,setIsDecorating:E,removeNameBubble:S,removeProductBubble:A,updateConfirmingProduct:N,getObjectName:L}},R8=T8,O8=()=>{const[n,e]=_.useState(""),[t,s]=_.useState(!1),[r,i]=_.useState(!1),[a,l]=_.useState(!1),[c,u]=_.useState(!1),[h,d]=_.useState(0),{showNitroAlert:f=null,showConfirm:E=null}=Xt(),{roomSession:m=null}=yt(),R=(I,S,A="",N=0)=>{if(I==="")return null;const L=I.split(" ");if(L.length>0){const M=L[0];let b="";if(L.length>1&&(b=L[1]),M.charAt(0)===":"&&b==="x"){const B=ee().selectedAvatarId;if(B>-1){const w=m.userDataManager.getUserDataByIndex(B);w&&(b=w.name,I=I.replace(" x"," "+w.name))}}switch(M.toLowerCase()){case":shake":return $r.init(2500,5e3),$r.turnVisualizationOn(),null;case":rotate":return Zr.init(2500,5e3),Zr.turnVisualizationOn(),null;case":d":case";d":Qr()===_r.VIP&&m.sendExpressionMessage(on.LAUGH.ordinal);break;case"o/":case"_o/":return m.sendExpressionMessage(on.WAVE.ordinal),null;case":kiss":if(Qr()===_r.VIP)return m.sendExpressionMessage(on.BLOW.ordinal),null;break;case":jump":if(Qr()===_r.VIP)return m.sendExpressionMessage(on.JUMP.ordinal),null;break;case":idle":return m.sendExpressionMessage(on.IDLE.ordinal),null;case"_b":return m.sendExpressionMessage(on.RESPECT.ordinal),null;case":sign":return m.sendSignMessage(parseInt(b)),null;case":iddqd":case":flip":return ee().events.dispatchEvent(new Ig(m.roomId,-1,!0)),null;case":zoom":return ee().events.dispatchEvent(new Ig(m.roomId,parseFloat(b),!1)),null;case":screenshot":const B=ee().createTextureFromRoom(m.roomId,1),w=new Image;return w.src=ht.generateImageUrl(B),window.open("").document.write(w.outerHTML),null;case":pickall":return(m.isRoomOwner||$().isModerator)&&E(p("room.confirm.pick_all"),()=>{$().sendSpecialCommandMessage(":pickall")},null,null,null,p("generic.alert.title")),null;case":ejectall":return(m.isRoomOwner||$().isModerator||m.controllerLevel>=ct.GUEST)&&E(p("room.confirm.eject_all"),()=>{$().sendSpecialCommandMessage(":ejectall")},null,null,null,p("generic.alert.title")),null;case":furni":return de("furni-chooser/"),null;case":chooser":return de("user-chooser/"),null;case":floor":case":bcfloor":return m.controllerLevel>=ct.ROOM_OWNER&&de("floor-editor/show"),null;case":togglefps":return qs().maxFPS>0?qs().maxFPS=0:qs().maxFPS=ce("system.animation.fps"),null;case":client":case":nitro":case":billsonnn":return f(),null;case":settings":return(m.isRoomOwner||$().isModerator)&&V(new oE(m.roomId)),null}}switch(S){case Gi.CHAT_DEFAULT:m.sendChatMessage(I,N);break;case Gi.CHAT_SHOUT:m.sendShoutMessage(I,N);break;case Gi.CHAT_WHISPER:m.sendWhisperMessage(A,I,N);break}};return kt(we.FLOOD_EVENT,I=>{u(!0),d(parseFloat(I.message))}),np(I=>{if(I.category!==k.UNIT)return;const S=m.userDataManager.getUserDataByIndex(I.id);S&&e(S.name)}),$e(ue.DESELECTED,I=>e("")),_.useEffect(()=>{if(!c)return;let I=0;const S=setInterval(()=>{d(A=>(I=(A||0)-1,I)),I<0&&(clearInterval(S),u(!1))},1e3);return()=>clearInterval(S)},[c]),_.useEffect(()=>{if(!a)return;let I=null;return a&&(I=setTimeout(()=>{l(!1),s(!1)},1e4)),()=>clearTimeout(I)},[a]),_.useEffect(()=>{t?r||(i(!0),m.sendChatTypingMessage(t)):r&&(i(!1),m.sendChatTypingMessage(t))},[m,t,r]),{selectedUsername:n,floodBlocked:c,floodBlockedSeconds:h,setIsTyping:s,setIsIdle:l,sendChat:R}},S8=O8,mI=new Map,EI=new Map,pI=new Map,C8=()=>{const[n,e]=_.useState([]),[t,s]=_.useState({mode:dt.CHAT_MODE_FREE_FLOW,weight:dt.CHAT_BUBBLE_WIDTH_NORMAL,speed:dt.CHAT_SCROLL_SPEED_NORMAL,distance:50,protection:dt.FLOOD_FILTER_NORMAL}),{roomSession:r=null}=yt(),{addChatEntry:i}=m_(),a=_.useRef(!1),l=_.useMemo(()=>{if(!t)return 6e3;switch(t.speed){case dt.CHAT_SCROLL_SPEED_FAST:return 3e3;case dt.CHAT_SCROLL_SPEED_NORMAL:return 6e3;case dt.CHAT_SCROLL_SPEED_SLOW:return 12e3}},[t]),c=d=>{const f=fs().createAvatarImage(d,Xr.LARGE,null,{resetFigure:R=>{a.current||c(R)},dispose:()=>{},disposed:!1});if(!f)return;const E=f.getCroppedImage(bs.HEAD),m=f.getPartColor(qe.CHEST);return mI.set(d,m&&m.rgb||16777215),f.dispose(),EI.set(d,E.src),E.src},u=d=>{let f=EI.get(d);return f||(f=c(d)),f},h=(d,f,E,m=64,R=null)=>{let I=pI.get(d+R);if(I)return I;const S=new gn(d),A=S.typeId,N=ee().getRoomObjectPetImage(A,S.paletteId,S.color,new F(f*45),m,null,!1,0,S.customParts,R);return N&&(I=ht.generateImageUrl(N.data),pI.set(d+R,I)),I};return kt(we.CHAT_EVENT,d=>{const f=ee().getRoomObject(r.roomId,d.objectId,k.UNIT),E=f?_P(r.roomId,f==null?void 0:f.id,k.UNIT):new Ii,m=f?r.userDataManager.getUserDataByIndex(d.objectId):new Kb(-1);let R="",I=0,S=null,A=d.chatType,N=d.style,L=0,M=d.message;if(m){L=m.type;const x=m.figure;switch(L){case Rt.PET:S=h(x,2,!0,64,f.model.getValue(C.FIGURE_POSTURE)),new gn(x).typeId;break;case Rt.USER:S=u(x);break;case Rt.RENTABLE_BOT:case Rt.BOT:N=Vn.BOT;break}I=mI.get(x),R=m.name}switch(A){case we.CHAT_TYPE_RESPECT:M=p("widgets.chatbubble.respect",["username"],[R]),ce("respect.options").enabled&&mn(ce("respect.options").sound);break;case we.CHAT_TYPE_PETREVIVE:case we.CHAT_TYPE_PET_REBREED_FERTILIZE:case we.CHAT_TYPE_PET_SPEED_FERTILIZE:{let x="widget.chatbubble.petrevived";A===we.CHAT_TYPE_PET_REBREED_FERTILIZE?x="widget.chatbubble.petrefertilized;":A===we.CHAT_TYPE_PET_SPEED_FERTILIZE&&(x="widget.chatbubble.petspeedfertilized");let U=null;if(ee().getRoomObject(r.roomId,d.extraParam,k.UNIT)){const K=r.userDataManager.getUserDataByIndex(f.id);K&&(U=K.name)}M=p(x,["petName","userName"],[R,U]);break}case we.CHAT_TYPE_PETRESPECT:M=p("widget.chatbubble.petrespect",["petname"],[R]);break;case we.CHAT_TYPE_PETTREAT:M=p("widget.chatbubble.pettreat",["petname"],[R]);break;case we.CHAT_TYPE_HAND_ITEM_RECEIVED:M=p("widget.chatbubble.handitem",["username","handitem"],[R,p("handitem"+d.extraParam)]);break;case we.CHAT_TYPE_MUTE_REMAINING:{const x=(d.extraParam>0?Math.floor(d.extraParam/3600):0).toString(),U=(d.extraParam>0?Math.floor(d.extraParam%3600/60):0).toString(),G=(d.extraParam%60).toString();M=p("widget.chatbubble.mutetime",["hours","minutes","seconds"],[x,U,G]);break}}const b=H6(M),B=I&&("#"+I.toString(16).padStart(6,"0")||null),w=new _q(m.roomIndex,k.UNIT,r.roomId,M,b,R,new Ii(E.x,E.y),A,N,S,B);e(x=>[...x,w]),i({id:-1,webId:m.webID,entityId:m.roomIndex,name:R,imageUrl:S,style:N,chatType:A,entityType:m.type,message:b,timestamp:RP(),type:Ri.TYPE_CHAT,roomId:r.roomId,color:B})}),$e($T.ROOM_DRAG,d=>{if(!n.length||d.roomId!==r.roomId)return;const f=d.offsetX;n.forEach(E=>E.elementRef&&(E.left+=f))}),z(sa,d=>{const f=d.getParser();f.roomEnter&&s(f.chat)}),z(LA,d=>{const f=d.getParser();s(f.chat)}),_.useEffect(()=>(a.current=!1,()=>{a.current=!0}),[]),{chatMessages:n,setChatMessages:e,chatSettings:t,getScrollSpeed:l}},A8=C8,N8=()=>{const[n,e]=_.useState([]),t=i=>{n.indexOf(i)>=0||e([...n,i])},s=i=>{const a=n.indexOf(i);if(a===-1)return;const l=[...n];l.splice(a,1),e(l)},r=(i,a)=>{at().sendDoorbellApprovalMessage(i,a),s(i)};return kt(mi.DOORBELL,i=>t(i.userName)),kt(mi.RSDE_REJECTED,i=>s(i.userName)),kt(mi.RSDE_ACCEPTED,i=>s(i.userName)),{users:n,addUser:t,removeUser:s,answer:r}},y8=N8,M8=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(!1),r=()=>s(!1);return z(tA,i=>{const a=i.getParser();s(!0),e(a.words)}),{wordsFilter:n,isVisible:t,setWordsFilter:e,onClose:r}},D8=M8,v8=()=>{const[n,e]=_.useState([]),{requests:t=[],dismissedRequestIds:s=[],setDismissedRequestIds:r=null}=Wr(),i=_.useMemo(()=>n.filter(l=>s.indexOf(l.request.requesterUserId)===-1),[n,s]),a=l=>{r(c=>{if(c.indexOf(l)>=0)return c;const u=[...c];return u.push(l),u})};return gL(!0,l=>{if(l.category!==k.UNIT)return;const c=at().userDataManager.getUserDataByIndex(l.id);if(!c||c.type!==ft.getTypeNumber(ft.USER))return;const u=t.find(d=>d.requesterUserId===c.webID);if(!u||n.find(d=>d.request.requesterUserId===c.webID))return;const h=[...n];h.push({roomIndex:c.roomIndex,request:u}),e(h)}),fL(!0,l=>{if(l.category!==k.UNIT)return;const c=n.findIndex(h=>h.roomIndex===l.id);if(c===-1)return;const u=[...n];u.splice(c,1),e(u)}),_.useEffect(()=>{const l=[];for(const c of t){const u=at().userDataManager.getUserData(c.requesterUserId);u&&l.push({roomIndex:u.roomIndex,request:c})}e(l)},[t]),{displayedRequests:i,hideFriendRequest:a}},b8=v8,P8=()=>{const[n,e]=_.useState(null),{roomSession:t=null}=yt(),s=()=>e(null),r=a=>a&&ee().selectRoomObject(at().roomId,a.id,a.category),i=()=>{const a=$(),l=ee().getRoomObjects(t.roomId,k.WALL),c=ee().getRoomObjects(t.roomId,k.FLOOR),u=l.map(d=>{if(d.id<0)return null;let f=d.type;if(f.startsWith("poster"))f=p(`poster_${f.replace("poster","")}_name`);else{const E=d.model.getValue(C.FURNITURE_TYPE_ID),m=a.getWallItemData(E);m&&m.name.length&&(f=m.name)}return new _l(d.id,k.WALL,f)}),h=c.map(d=>{if(d.id<0)return null;let f=d.type;const E=d.model.getValue(C.FURNITURE_TYPE_ID),m=a.getFloorItemData(E);return m&&m.name.length&&(f=m.name),new _l(d.id,k.FLOOR,f)});e([...u,...h].sort((d,f)=>d.name<f.name?-1:1))};return I7(!!n,a=>{if(a.id<0)return;const l=ee().getRoomObject(at().roomId,a.id,a.category);if(!l)return;let c=null;switch(a.category){case k.WALL:{let u=l.type;if(u.startsWith("poster"))u=p(`poster_${u.replace("poster","")}_name`);else{const h=l.model.getValue(C.FURNITURE_TYPE_ID),d=$().getWallItemData(h);d&&d.name.length&&(u=d.name)}c=new _l(l.id,k.WALL,u);break}case k.FLOOR:{let u=l.type;const h=l.model.getValue(C.FURNITURE_TYPE_ID),d=$().getFloorItemData(h);d&&d.name.length&&(u=d.name),c=new _l(l.id,k.FLOOR,u)}}e(u=>[...u,c].sort((h,d)=>h.name<d.name?-1:1))}),si(!!n,a=>{a.id<0||e(l=>{const c=[...l];for(let u=0;u<c.length;u++){const h=c[u];if(!(h.id!==a.id||h.category!==a.category)){c.splice(u,1);break}}return c})}),{items:n,onClose:s,selectItem:r,populateChooser:i}},L8=P8,U8=()=>{const[n,e]=_.useState(!1),[t,s]=_.useState(-1),[r,i]=_.useState(""),[a,l]=_.useState(""),[c,u]=_.useState(""),h=()=>{u(""),l(""),i(""),s(-1),e(!1)},d=()=>{V(new uE(t,a))},f=m=>{l(m),c.length>0&&u("")},E=m=>{if(!(!m||m===0))switch(m){case 1:return p("catalog.alert.petname.long");case 2:return p("catalog.alert.petname.short");case 3:return p("catalog.alert.petname.chars");case 4:default:return p("catalog.alert.petname.bobba")}};return kt(Aa.RSOPPE_OPEN_PET_PACKAGE_REQUESTED,m=>{if(!m)return;const R=ee().getRoomObject(m.session.roomId,m.objectId,k.FLOOR);s(m.objectId),i(R.type),e(!0)}),kt(Aa.RSOPPE_OPEN_PET_PACKAGE_RESULT,m=>{m&&(m.nameValidationStatus===0&&h(),m.nameValidationStatus!==0&&u(E(m.nameValidationStatus)))}),{isVisible:n,errorResult:c,petName:a,objectType:r,onChangePetName:f,onConfirm:d,onClose:h}},F8=U8,x8=()=>{const{roomSession:n=null}=yt(),e=r=>n.sendPollStartMessage(r),t=r=>n.sendPollRejectMessage(r),s=(r,i,a)=>n.sendPollAnswerMessage(r,i,a);return kt(ui.OFFER,r=>{const i=new Bn(Bn.OFFER,r.id);i.summary=r.summary,i.headline=r.headline,Fs(i)}),kt(ui.ERROR,r=>{const i=new Bn(Bn.ERROR,r.id);i.summary=r.summary,i.headline=r.headline,Fs(i)}),kt(ui.CONTENT,r=>{const i=new Bn(Bn.CONTENT,r.id);i.startMessage=r.startMessage,i.endMessage=r.endMessage,i.numQuestions=r.numQuestions,i.questionArray=r.questionArray,i.npsPoll=r.npsPoll,Fs(i)}),{startPoll:e,rejectPoll:t,answerPoll:s}},w8=x8,G8=()=>{const[n,e]=_.useState(null);yt();const t=()=>e(null),s=i=>i&&ee().selectRoomObject(at().roomId,i.id,i.category),r=()=>{const i=at(),a=ee().getRoomObjects(i.roomId,k.UNIT);e(a.map(l=>{if(l.id<0)return null;const c=i.userDataManager.getUserDataByIndex(l.id);return c?new _l(c.roomIndex,k.UNIT,c.name):null}).sort((l,c)=>l.name<c.name?-1:1))};return gL(!!n,i=>{if(i.id<0)return;const a=at().userDataManager.getUserDataByIndex(i.id);a&&e(l=>{const c=[...l];return c.push(new _l(a.roomIndex,k.UNIT,a.name)),c.sort((u,h)=>u.name<h.name?-1:1),c})}),fL(!!n,i=>{i.id<0||e(a=>{const l=[...a];for(let c=0;c<l.length;c++){const u=l[c];if(!(u.id!==i.id||u.category!==i.category)){l.splice(c,1);break}}return l})}),{items:n,onClose:t,selectItem:s,populateChooser:r}},B8=G8,II=4e3,k8=3,V8=()=>{const[n,e]=_.useState(-1),[t,s]=_.useState(null),[r,i]=_.useState(!1),[a,l]=_.useState(null),[c,u]=_.useState(new Map),[h,d]=_.useState(new Map),{answerPoll:f=null}=w8(),{roomSession:E=null}=yt(),m=()=>{e(-1),s(null)},R=I=>{r||!t||(f(n,t.id,[I]),i(!0))};return kt(hi.ANSWERED,I=>{const S=E.userDataManager.getUserData(I.userId);S&&(u(I.answerCounts),d(A=>{if(!A.has(S.roomIndex)){const N=new Map(h);return N.set(S.roomIndex,{value:I.value,secondsLeft:k8}),N}return A}),ee().updateRoomObjectUserGesture(E.roomId,S.roomIndex,fe.getGestureId(I.value==="0"?fe.GESTURE_SAD:fe.GESTURE_SMILE)))}),kt(hi.FINISHED,I=>{t&&t.id===I.questionId&&(u(I.answerCounts),i(!0),l(S=>(S&&clearTimeout(S),setTimeout(()=>m(),II)))),d(new Map)}),kt(hi.QUESTION,I=>{e(I.id),s(I.question),i(!1),u(new Map),d(new Map),l(S=>{if(S&&clearTimeout(S),I.duration>0){const A=I.duration<1e3?II:I.duration;return setTimeout(()=>m(),A)}return null})}),_.useEffect(()=>{const I=()=>{d(A=>{const N=[];if(A.forEach((M,b)=>{M.secondsLeft--,M.secondsLeft<=0&&N.push(b)}),N.length===0)return A;const L=new Map(A);return N.forEach(M=>L.delete(M)),L})},S=setInterval(()=>I(),1e3);return()=>clearInterval(S)},[]),_.useEffect(()=>()=>{l(I=>(I&&clearTimeout(I),null))},[]),{question:t,answerSent:r,answerCounts:c,userAnswers:h,vote:R}},H8=V8,j8=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(null),[r,i]=_.useState(0),[a,l]=_.useState(0),[c,u]=_.useState(0),h=E=>{i(E),V(new ZD(E))},d=E=>{$().giveRespect(E),l($().respectsLeft)},f=E=>{$().givePetRespect(E),u($().respectsPetLeft)};return z(Nl,E=>{const m=E.getParser();e(m.userInfo),s(m.userInfo.figure),l(m.userInfo.respectsRemaining),u(m.userInfo.respectsPetRemaining)}),z(Pm,E=>{const m=E.getParser();s(m.figure)}),z(Qm,E=>{const m=E.getParser();i(m.chatType)}),{userInfo:n,userFigure:t,chatStyleId:r,userRespectRemaining:a,petRespectRemaining:c,respectUser:d,respectPet:f,updateChatStyleId:h}},za=()=>os(j8),W8=n=>_.useEffect(n,[]),pL=n=>W8(()=>n()),IL=n=>{const{achievement:e=null,scale:t=1,...s}=n;return e?o(xt,{badgeCode:wr.getAchievementBadgeCode(e),isGrayscale:!wr.getAchievementHasStarted(e),scale:t,...s}):null},Y8=n=>{const{achievement:e=null}=n,{selectedAchievement:t=null,setSelectedAchievementId:s=null}=f_();return e?o(Qe,{itemActive:t===e,itemUnseen:e.unseen>0,onClick:r=>s(e.achievementId),children:o(IL,{achievement:e})}):null},z8=n=>{const{achievements:e=null}=n;return o(Ot,{columnCount:6,columnMinWidth:50,columnMinHeight:50,children:e&&e.length>0&&e.map((t,s)=>o(Y8,{achievement:t},s))})},K8=n=>{const{achievement:e=null}=n;return e?g(P,{shrink:!0,className:"bg-muted rounded p-2 text-black",gap:2,overflow:"hidden",children:[g(D,{center:!0,gap:1,children:[o(IL,{className:"nitro-achievements-badge-image",achievement:e,scale:2}),o(y,{fontWeight:"bold",children:p("achievements.details.level",["level","limit"],[wr.getAchievementLevel(e).toString(),e.levelCount.toString()])})]}),g(D,{fullWidth:!0,justifyContent:"center",overflow:"hidden",children:[g(D,{gap:1,children:[o(y,{fontWeight:"bold",truncate:!0,children:Au(wr.getAchievementBadgeCode(e))}),o(y,{textBreak:!0,children:zE(wr.getAchievementBadgeCode(e))})]}),(e.levelRewardPoints>0||e.scoreLimit>0)&&g(D,{gap:1,children:[e.levelRewardPoints>0&&g(P,{alignItems:"center",gap:1,children:[o(y,{truncate:!0,className:"small",children:p("achievements.details.reward")}),g(P,{center:!0,className:"fw-bold small",gap:1,children:[e.levelRewardPoints,o(gs,{type:e.levelRewardPointType})]})]}),e.scoreLimit>0&&o(sp,{text:p("achievements.details.progress",["progress","limit"],[(e.currentPoints+e.scoreAtStartOfLevel).toString(),(e.scoreLimit+e.scoreAtStartOfLevel).toString()]),progress:e.currentPoints+e.scoreAtStartOfLevel,maxProgress:e.scoreLimit+e.scoreAtStartOfLevel})]})]})]}):null},X8=n=>{const{category:e=null}=n,{selectedAchievement:t=null,setSelectedAchievementId:s=null}=f_();return _.useEffect(()=>{var r,i;e&&(t||s((i=(r=e==null?void 0:e.achievements)==null?void 0:r[0])==null?void 0:i.achievementId))},[e,t,s]),e?g(D,{fullHeight:!0,justifyContent:"between",children:[o(z8,{achievements:e.achievements}),!!t&&o(K8,{achievement:t})]}):null},q8=n=>{const{category:e=null,selectedCategoryCode:t=null,setSelectedCategoryCode:s=null}=n;if(!e)return null;const r=wr.getAchievementCategoryProgress(e),i=wr.getAchievementCategoryMaxProgress(e),a=wr.getAchievementCategoryImageUrl(e,r),l=wr.getAchievementCategoryTotalUnseen(e);return g(Qe,{itemActive:t===e.code,itemCount:l,itemCountMinimum:0,gap:1,onClick:c=>s(e.code),children:[o(y,{fullWidth:!0,center:!0,small:!0,className:"pt-1",children:p(`quests.${e.code}.name`)}),o(jP,{position:"relative",imageUrl:a,children:g(y,{fullWidth:!0,center:!0,position:"absolute",variant:"white",style:{fontSize:12,bottom:9},children:[r," / ",i]})})]})},Q8=n=>{const{categories:e=null,selectedCategoryCode:t=null,setSelectedCategoryCode:s=null}=n;return o(Ot,{columnCount:3,columnMinWidth:90,columnMinHeight:100,children:e&&e.length>0&&e.map((r,i)=>o(q8,{category:r,selectedCategoryCode:t,setSelectedCategoryCode:s},i))})},J8=n=>{const[e,t]=_.useState(!1),{achievementCategories:s=[],selectedCategoryCode:r=null,setSelectedCategoryCode:i=null,achievementScore:a=0,getProgress:l=0,getMaxProgress:c=0,selectedCategory:u=null}=f_();return _.useEffect(()=>{const h={linkReceived:d=>{const f=d.split("/");if(!(f.length<2))switch(f[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(E=>!E);return}},eventUrlPrefix:"achievements/"};return Cs(h),()=>As(h)},[]),e?g(Re,{uniqueKey:"achievements",className:"nitro-achievements",theme:"primary-slim",children:[o(Te,{headerText:p("inventory.achievements"),onCloseClick:h=>t(!1)}),u&&g(HP,{position:"relative",className:"justify-content-center align-items-center cursor-pointer",gap:3,children:[o(j,{onClick:h=>i(null),className:"nitro-achievements-back-arrow"}),g(D,{grow:!0,gap:0,children:[o(y,{fontSize:4,fontWeight:"bold",className:"text-small",children:p(`quests.${u.code}.name`)}),o(y,{children:p("achievements.details.categoryprogress",["progress","limit"],[u.getProgress().toString(),u.getMaxProgress().toString()])})]}),o(Sn,{imageUrl:wr.getAchievementCategoryImageUrl(u,null,!0)})]}),g(Ee,{gap:1,children:[!u&&g(X,{children:[o(Q8,{categories:s,selectedCategoryCode:r,setSelectedCategoryCode:i}),g(D,{grow:!0,justifyContent:"end",gap:1,children:[o(y,{small:!0,center:!0,children:p("achievements.categories.score",["score"],[a.toString()])}),o(sp,{text:p("achievements.categories.totalprogress",["progress","limit"],[l.toString(),c.toString()]),progress:l,maxProgress:c})]})]}),u&&o(X8,{category:u})]})]}):null},Fa=n=>{const{icon:e=null,selected:t=!1,classNames:s=[],children:r=null,...i}=n,a=_.useMemo(()=>{const l=["nitro-avatar-editor-spritesheet"];return e&&e.length&&l.push(e+"-icon"),t&&l.push("selected"),s.length&&l.push(...s),l},[e,t,s]);return o(j,{classNames:a,...i})},Z8=n=>{const{figureData:e=null}=n,[t,s]=_.useState(-1),r=i=>{i<xr.MIN_DIRECTION&&(i=xr.MAX_DIRECTION+(i+1)),i>xr.MAX_DIRECTION&&(i=i-(xr.MAX_DIRECTION+1)),e.direction=i};return _.useEffect(()=>{if(e)return e.notify=()=>s(i=>i+1),()=>{e.notify=null}},[e]),g(D,{className:"figure-preview-container",overflow:"hidden",position:"relative",children:[o(as,{figure:e.getFigureString(),direction:e.direction,scale:2}),o(Fa,{className:"avatar-spotlight",icon:"spotlight"}),o(j,{className:"avatar-shadow"}),g(j,{className:"arrow-container",children:[o(Fa,{pointer:!0,icon:"arrow-left",onClick:i=>r(e.direction+1)}),o(Fa,{pointer:!0,icon:"arrow-right",onClick:i=>r(e.direction-1)})]})]})},$8=n=>{const{partItem:e=null,children:t=null,...s}=n,[r,i]=_.useState(-1),a=ce("hc.disabled",!1);return _.useEffect(()=>{const l=()=>i(c=>c+1);return e.notify=l,()=>e.notify=null},[e]),g(Qe,{itemImage:e.isClear?void 0:e.imageUrl,itemActive:e.isSelected,...s,children:[!a&&e.isHC&&o(gs,{className:"position-absolute end-1 bottom-1",type:"hc"}),e.isClear&&o(Fa,{icon:"clear"}),e.isSellable&&o(Fa,{icon:"sellable",position:"absolute",className:"end-1 bottom-1"}),t]})},e9=n=>{const{model:e=null,category:t=null,setMaxPaletteCount:s=null}=n,r=_.useRef(null),i=_.useCallback(a=>{const l=t.parts.indexOf(a);if(l===-1)return;e.selectPart(t.name,l);const c=t.getCurrentPart();s(c.maxColorIndex||1)},[e,t,s]);return _.useEffect(()=>{!e||!t||!r||!r.current||(r.current.scrollTop=0)},[e,t]),o(Ot,{innerRef:r,columnCount:3,columnMinHeight:50,children:t.parts.length>0&&t.parts.map((a,l)=>o($8,{partItem:a,onClick:c=>i(a)},l))})},t9=n=>{const{colorItem:e=null,children:t=null,...s}=n,[r,i]=_.useState(-1),a=ce("hc.disabled",!1);return _.useEffect(()=>{const l=()=>i(c=>c+1);return e.notify=l,()=>e.notify=null},[e]),g(Qe,{itemHighlight:!0,itemColor:e.color,itemActive:e.isSelected,className:"clear-bg",...s,children:[!a&&e.isHC&&o(gs,{className:"position-absolute end-1 bottom-1",type:"hc"}),t]})},TI=n=>{const{model:e=null,category:t=null,paletteSet:s=[],paletteIndex:r=-1}=n,i=_.useRef(null),a=_.useCallback(l=>{const c=s.indexOf(l);c!==-1&&e.selectColor(t.name,c,r)},[e,t,s,r]);return _.useEffect(()=>{!e||!t||!i||!i.current||(i.current.scrollTop=0)},[e,t]),o(Ot,{innerRef:i,gap:1,columnCount:5,columnMinWidth:30,children:s.length>0&&s.map((l,c)=>o(t9,{colorItem:l,onClick:u=>a(l)},c))})},s9=n=>{const{model:e=null,gender:t=null,setGender:s=null}=n,[r,i]=_.useState(null),[a,l]=_.useState(1),c=_.useCallback(u=>{const h=e.categories.get(u);if(h){h.init(),i(h);for(const d of h.parts)if(!(!d||!d.isSelected)){l(d.maxColorIndex||1);break}}},[e]);return _.useEffect(()=>{e.init();for(const u of e.categories.keys()){c(u);break}},[e,c]),!e||!r?null:g(ge,{children:[g(D,{size:2,children:[e.canSetGender&&g(X,{children:[o(P,{center:!0,pointer:!0,className:"category-item",onClick:u=>s(nt.MALE),children:o(Fa,{icon:"male",selected:t===nt.MALE})}),o(P,{center:!0,pointer:!0,className:"category-item",onClick:u=>s(nt.FEMALE),children:o(Fa,{icon:"female",selected:t===nt.FEMALE})})]}),!e.canSetGender&&e.categories&&e.categories.size>0&&Array.from(e.categories.keys()).map(u=>{const h=e.categories.get(u);return o(P,{center:!0,pointer:!0,className:"category-item",onClick:d=>c(u),children:o(Fa,{icon:h.name,selected:r===h})},u)})]}),o(D,{size:5,overflow:"hidden",children:o(e9,{model:e,category:r,setMaxPaletteCount:l})}),g(D,{size:5,overflow:"hidden",children:[a>=1&&o(TI,{model:e,category:r,paletteSet:r.getPalette(0),paletteIndex:0}),a===2&&o(TI,{model:e,category:r,paletteSet:r.getPalette(1),paletteIndex:1})]})]})},r9=n=>{const{figureData:e=null,savedFigures:t=[],setSavedFigures:s=null,loadAvatarInEditor:r=null}=n,i=ce("hc.disabled",!1),a=_.useCallback(u=>{if(u>=t.length||u<0)return;const[h,d]=t[u];r(h.getFigureString(),d)},[t,r]),l=_.useCallback(u=>{if(!e||u>=t.length||u<0)return;const h=[...t],d=e.getFigureString(),f=e.gender;h[u]=[fs().createFigureContainer(d),f],s(h),V(new VN(u+1,d,f))},[e,t,s]),c=_.useMemo(()=>{if(!t||!t.length)return[];const u=[];return t.forEach(([h,d],f)=>{let E=0;h&&(E=fs().getFigureClubLevel(h,d)),u.push(g(Qe,{position:"relative",overflow:"hidden",className:"nitro-avatar-editor-wardrobe-figure-preview",children:[h&&o(as,{figure:h.getFigureString(),gender:d,direction:2}),o(j,{className:"avatar-shadow"}),!i&&E>0&&o(gs,{className:"position-absolute top-1 start-1",type:"hc"}),g(P,{gap:1,className:"button-container",children:[o(H,{variant:"link",fullWidth:!0,onClick:m=>l(f),children:p("avatareditor.wardrobe.save")}),h&&o(H,{variant:"link",fullWidth:!0,onClick:m=>a(f),disabled:E>Qr(),children:p("generic_usable.button.use")})]})]},f))}),u},[t,i,l,a]);return o(Ot,{columnCount:5,columnMinWidth:80,columnMinHeight:140,children:c})},i9="hr-100.hd-180-7.ch-215-66.lg-270-79.sh-305-62.ha-1002-70.wa-2007",n9="hr-515-33.hd-600-1.ch-635-70.lg-716-66-62.sh-735-68",a9=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(null),[i,a]=_.useState(null),[l,c]=_.useState(null),[u,h]=_.useState(null),[d,f]=_.useState([]),[E,m]=_.useState([]),[R,I]=_.useState([]),[S,A]=_.useState(!1),[N,L]=_.useState(null),[M,b]=_.useState(null),[B,w]=_.useState(!0),[x,U]=_.useState(!1),G=_.useMemo(()=>ce("avatar.wardrobe.max.slots",10),[]);z(nC,Ae=>{const tt=Ae.getParser();f(tt.figureSetIds),m(tt.boundsFurnitureNames)}),z(xN,Ae=>{const tt=Ae.getParser(),Wt=[];let ls=0;for(;ls<G;)Wt.push([null,null]),ls++;for(let[cs,[mr,$t]]of tt.looks.entries()){const Gs=fs().createFigureContainer(mr);Wt[cs-1]=[Gs,$t]}I(Wt)});const K=_.useCallback(Ae=>{l&&h(l.get(Ae))},[l]),Y=_.useCallback(()=>{const Ae=new Map;Ae.set(ur.GENERIC,new v6),Ae.set(ur.HEAD,new X6),Ae.set(ur.TORSO,new Q6),Ae.set(ur.LEGS,new q6),c(Ae)},[]),te=_.useCallback(()=>{const Ae=new Map,tt=new nt,Wt=new nt;tt.loadAvatarData(i9,nt.MALE),Wt.loadAvatarData(n9,nt.FEMALE),Ae.set(nt.MALE,tt),Ae.set(nt.FEMALE,Wt),r(Ae),a(Ae.get(nt.MALE))},[]),ne=_.useCallback((Ae,tt,Wt=!0)=>{tt=ns.getGender(tt);let ls=i;tt!==ls.gender&&(ls=s.get(tt)),Ae!==ls.getFigureString()&&ls.loadAvatarData(Ae,tt),ls!==i&&a(ls),Wt&&(L(i.getFigureString()),b(i.gender))},[s,i]),J=_.useCallback(Ae=>{switch(Ae){case li.ACTION_CLEAR:ne(i.getFigureStringWithFace(0,!1),i.gender,!1),Y();return;case li.ACTION_RESET:ne(N,M),Y();return;case li.ACTION_RANDOMIZE:const tt=K6(i,i.gender,Qr(),d,[nt.FACE]);ne(tt,i.gender,!1),Y();return;case li.ACTION_SAVE:V(new mE(i.gender,i.getFigureString())),t(!1);return}},[i,N,M,d,ne,Y]),Ce=_.useCallback(Ae=>{Ae=ns.getGender(Ae),a(s.get(Ae))},[s]);return _.useEffect(()=>{const Ae={linkReceived:tt=>{const Wt=tt.split("/");if(!(Wt.length<2))switch(Wt[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(ls=>!ls);return}},eventUrlPrefix:"avatar-editor/"};return Cs(Ae),()=>As(Ae)},[]),_.useEffect(()=>{I(new Array(G))},[G]),_.useEffect(()=>{S&&(h(null),V(new kN))},[S]),_.useEffect(()=>{u&&A(!1)},[u]),_.useEffect(()=>{l&&K(ur.GENERIC)},[l,K]),_.useEffect(()=>{if(i)return ns.CURRENT_FIGURE=i,Y(),()=>ns.CURRENT_FIGURE=null},[i,Y]),_.useEffect(()=>(ns.FIGURE_SET_IDS=d,ns.BOUND_FURNITURE_NAMES=E,Y(),()=>{ns.FIGURE_SET_IDS=null,ns.BOUND_FURNITURE_NAMES=null}),[d,E,Y]),_.useEffect(()=>{if(e&&!s){te(),U(!0);return}},[e,s,te]),_.useEffect(()=>{!e||!x||!B||(ne($().figure,$().gender),w(!1))},[e,x,B,ne]),_.useEffect(()=>{if(!e)return()=>{w(!0)}},[e]),!e||!i?null:g(Re,{uniqueKey:"avatar-editor",className:"nitro-avatar-editor",children:[o(Te,{headerText:p("avatareditor.title"),onCloseClick:Ae=>t(!1)}),g(aa,{children:[l&&l.size>0&&Array.from(l.keys()).map(Ae=>{const tt=u&&u.name===Ae;return o(Yi,{isActive:tt,onClick:Wt=>K(Ae),children:p(`avatareditor.category.${Ae}`)},Ae)}),o(Yi,{isActive:S,onClick:Ae=>A(!0),children:p("avatareditor.category.wardrobe")})]}),o(Ee,{children:g(ge,{children:[g(D,{size:9,overflow:"hidden",children:[u&&!S&&o(s9,{model:u,gender:i.gender,setGender:Ce}),S&&o(r9,{figureData:i,savedFigures:R,setSavedFigures:I,loadAvatarInEditor:ne})]}),g(D,{size:3,overflow:"hidden",children:[o(Z8,{figureData:i}),g(D,{grow:!0,gap:1,children:[g($n,{children:[o(H,{variant:"secondary",onClick:Ae=>J(li.ACTION_RESET),children:o(cU,{className:"fa-icon"})}),o(H,{variant:"secondary",onClick:Ae=>J(li.ACTION_CLEAR),children:o(sm,{className:"fa-icon"})}),o(H,{variant:"secondary",onClick:Ae=>J(li.ACTION_RANDOMIZE),children:o(uU,{className:"fa-icon"})})]}),o(H,{className:"w-100",variant:"success",onClick:Ae=>J(li.ACTION_SAVE),children:p("avatareditor.save")})]})]})]})})]})},o9=5,l9=n=>{const{onClose:e=null,onEdit:t=null,onDelete:s=null}=n,{cameraRoll:r=null,setCameraRoll:i=null,selectedPictureIndex:a=-1,setSelectedPictureIndex:l=null}=KP(),{simpleAlert:c=null}=Xt(),u=_.useRef(),h=a>-1?r[a]:null,d=()=>{if(!u||!u.current)return null;const E=u.current.getBoundingClientRect();return new yT(Math.floor(E.x),Math.floor(E.y),Math.floor(E.width),Math.floor(E.height))},f=()=>{if(a>-1){l(-1);return}const E=ee().createTextureFromRoom(at().roomId,1,d()),m=[...r];m.length>=o9&&(c(p("camera.full.body")),m.pop()),mn(kr.CAMERA_SHUTTER),m.push(new J6(E,ht.generateImageUrl(E))),i(m)};return o(Ya,{uniqueKey:"nitro-camera-capture",children:g(D,{center:!0,className:"nitro-camera-capture",gap:0,children:[h&&o("img",{alt:"",className:"camera-area",src:h.imageUrl}),g("div",{className:"camera-canvas drag-handler",children:[o("div",{className:"position-absolute header-close",onClick:e,children:o(ei,{className:"fa-icon"})}),!h&&o("div",{ref:u,className:"camera-area camera-view-finder"}),h&&o("div",{className:"camera-area camera-frame",children:g("div",{className:"camera-frame-preview-actions w-100 position-absolute bottom-0 py-2 text-center",children:[o("button",{className:"btn btn-success me-3",title:p("camera.editor.button.tooltip"),onClick:t,children:p("camera.editor.button.text")}),o("button",{className:"btn btn-danger",onClick:s,children:p("camera.delete.button.text")})]})}),o("div",{className:"d-flex justify-content-center",children:o("div",{className:"camera-button",title:p("camera.take.photo.button.tooltip"),onClick:f})})]}),r.length>0&&o(P,{gap:2,justifyContent:"center",className:"camera-roll d-flex justify-content-center py-2",children:r.map((E,m)=>o("img",{alt:"",src:E.imageUrl,onClick:R=>l(m)},m))})]})})},c9=n=>{const{base64Url:e=null,onCloseClick:t=null,onCancelClick:s=null,price:r=null}=n,[i,a]=_.useState(null),[l,c]=_.useState(null),[u,h]=_.useState(0),[d,f]=_.useState(!1),[E,m]=_.useState(!1),[R,I]=_.useState(0),S=_.useMemo(()=>ce("camera.publish.disabled",!1),[]);z(sS,N=>{h(L=>L+1),m(!1)}),z(tS,N=>{const L=N.getParser();c(L.extraDataId),I(L.secondsToWait),f(L.ok),m(!1)}),z(rS,N=>{const L=N.getParser();a(ce("camera.url")+"/"+L.url)});const A=(N,L=null)=>{switch(N){case"close":t();return;case"buy":if(E)return;m(!0),V(new jN(""));return;case"publish":if(E)return;m(!0),V(new HN);return;case"cancel":s();return}};return _.useEffect(()=>{e&&ee().saveBase64AsScreenshot(e)},[e]),r?g(Re,{className:"nitro-camera-checkout",theme:"primary-slim",children:[o(Te,{headerText:p("camera.confirm_phase.title"),onCloseClick:N=>A("close")}),g(Ee,{children:[g(P,{center:!0,children:[i&&i.length&&o(Sn,{className:"picture-preview border",imageUrl:i}),(!i||!i.length)&&o(P,{center:!0,className:"picture-preview border",children:o(y,{bold:!0,children:p("camera.loading")})})]}),g(P,{justifyContent:"between",alignItems:"center",className:"bg-muted rounded p-2",children:[g(D,{size:S?10:6,gap:1,children:[o(y,{bold:!0,children:p("camera.purchase.header")}),(r.credits>0||r.duckets>0)&&g(P,{gap:1,children:[o(y,{children:p("catalog.purchase.confirmation.dialog.cost")}),r.credits>0&&g(P,{gap:1,children:[o(y,{bold:!0,children:r.credits}),o(gs,{type:-1})]}),r.duckets>0&&g(P,{gap:1,children:[o(y,{bold:!0,children:r.duckets}),o(gs,{type:5})]})]}),u>0&&g(y,{children:[o(y,{bold:!0,children:p("camera.purchase.count.info")})," ",u,o("u",{className:"ms-1 cursor-pointer",onClick:()=>de("inventory/toggle"),children:p("camera.open.inventory")})]})]}),o(P,{alignItems:"center",children:o(H,{variant:"success",disabled:E,onClick:N=>A("buy"),children:p(u?"camera.buy.another.button.text":"buy")})})]}),!S&&g(P,{justifyContent:"between",alignItems:"center",className:"bg-muted rounded p-2",children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p(d?"camera.publish.successful":"camera.publish.explanation")}),o(y,{children:p(d?"camera.publish.success.short.info":"camera.publish.detailed.explanation")}),d&&o("a",{href:l,rel:"noreferrer",target:"_blank",children:p("camera.link.to.published")}),!d&&r.publishDucketPrice>0&&g(P,{gap:1,children:[o(y,{children:p("catalog.purchase.confirmation.dialog.cost")}),g(P,{gap:1,children:[o(y,{bold:!0,children:r.publishDucketPrice}),o(gs,{type:5})]})]}),R>0&&o("div",{className:"mt-1 text-center fw-bold",children:p("camera.publish.wait",["minutes"],[Math.ceil(R/60).toString()])})]}),!d&&o(P,{className:"d-flex align-items-end",children:o(H,{variant:"success",disabled:E||R>0,onClick:N=>A("publish"),children:p("camera.publish.button.text")})})]}),o(y,{center:!0,children:p("camera.warning.disclaimer")}),o(P,{justifyContent:"end",children:o(H,{onClick:N=>A("cancel"),children:p("generic.cancel")})})]})]}):null},u9=n=>{const{effect:e=null,thumbnailUrl:t=null,isActive:s=!1,isLocked:r=!1,selectEffect:i=null,removeEffect:a=null}=n;return g(Qe,{title:p(r?`camera.effect.required.level ${e.minLevel}`:`camera.effect.name.${e.name}`),itemActive:s,onClick:l=>!s&&i(),children:[s&&o(H,{variant:"danger",className:"rounded-circle remove-effect",onClick:a,children:o(ei,{className:"fa-icon"})}),!r&&t&&t.length>0&&o("div",{className:"effect-thumbnail-image border",children:o("img",{alt:"",src:t})}),r&&g(y,{center:!0,bold:!0,children:[o("div",{children:o(_T,{className:"fa-icon"})}),e.minLevel]})]})},h9=n=>{const{myLevel:e=0,selectedEffects:t=[],effects:s=[],thumbnails:r=[],processAction:i=null}=n;return o(ge,{columnCount:3,overflow:"auto",children:s&&s.length>0&&s.map((a,l)=>{const c=r.find(h=>h.effectName===a.name),u=t.findIndex(h=>h.effect.name===a.name)>-1;return o(u9,{effect:a,thumbnailUrl:c&&c.thumbnailUrl||null,isActive:u,isLocked:a.minLevel>e,selectEffect:()=>i("select_effect",a.name),removeEffect:()=>i("remove_effect",a.name)},l)})})},RI=[Xc.COLORMATRIX,Xc.COMPOSITE],d9=n=>{const{picture:e=null,availableEffects:t=null,myLevel:s=1,onClose:r=null,onCancel:i=null,onCheckout:a=null}=n,[l,c]=_.useState(RI[0]),[u,h]=_.useState(null),[d,f]=_.useState([]),[E,m]=_.useState([]),[R,I]=_.useState(!1),S=_.useMemo(()=>t.filter(U=>U.colorMatrix),[t]),A=_.useMemo(()=>t.filter(U=>U.texture),[t]),N=_.useCallback(()=>l===Xc.COLORMATRIX?S:A,[l,S,A]),L=_.useCallback(U=>!U||!U.length||!d||!d.length?-1:d.findIndex(G=>G.effect.name===U),[d]),M=_.useMemo(()=>L(u),[u,L]),b=_.useMemo(()=>u&&d[M]||null,[u,M,d]),B=_.useCallback(U=>{const G=M;G!==-1&&f(K=>{const Y=[...K],te=Y[G];return Y[M]=new v_(te.effect,U),Y})},[M,f]),w=_.useMemo(()=>vc().applyEffects(e.texture,d,R).src,[e,d,R]),x=_.useCallback((U,G=null)=>{switch(U){case"close":r();return;case"cancel":i();return;case"checkout":a(w);return;case"change_tab":c(String(G));return;case"select_effect":{if(L(G)>=0)return;const Y=t.find(te=>te.name===G);if(!Y)return;f(te=>[...te,new v_(Y,1)]),h(Y.name);return}case"remove_effect":{let K=L(G);if(K===-1)return;f(Y=>{const te=[...Y];return te.splice(K,1),te}),u===G&&h(null);return}case"clear_effects":h(null),f([]);return;case"download":{const K=new Image;K.src=w,window.open("").document.write(K.outerHTML);return}case"zoom":I(!R);return}},[R,t,u,w,L,i,a,r,I,f]);return _.useEffect(()=>{const U=[];for(const G of t)U.push(new Z6(G.name,vc().applyEffects(e.texture,[new v_(G,1)],!1).src));m(U)},[e,t]),g(Re,{className:"nitro-camera-editor",children:[o(Te,{headerText:p("camera.editor.button.text"),onCloseClick:U=>x("close")}),o(aa,{children:RI.map(U=>o(Yi,{isActive:l===U,onClick:G=>x("change_tab",U),children:o("i",{className:"icon icon-camera-"+U})},U))}),o(Ee,{children:g(ge,{children:[o(D,{size:5,overflow:"hidden",children:o(h9,{myLevel:s,selectedEffects:d,effects:N(),thumbnails:E,processAction:x})}),g(D,{size:7,justifyContent:"between",overflow:"hidden",children:[g(D,{center:!0,children:[o(Sn,{imageUrl:w,className:"picture-preview"}),u&&g(D,{center:!0,fullWidth:!0,gap:1,children:[o(y,{children:p("camera.effect.name."+u)}),o(ws,{className:"nitro-slider",min:0,max:1,step:.01,value:b.alpha,onChange:U=>B(U),renderThumb:(U,G)=>o("div",{...U,children:G.valueNow})})]})]}),g(P,{justifyContent:"between",children:[g($n,{children:[o(H,{onClick:U=>x("clear_effects"),children:o(sm,{className:"fa-icon"})}),o(H,{onClick:U=>x("download"),children:o(hU,{className:"fa-icon"})}),g(H,{onClick:U=>x("zoom"),children:[R&&o(dU,{className:"fa-icon"}),!R&&o(_U,{className:"fa-icon"})]})]}),g(P,{gap:1,children:[o(H,{onClick:U=>x("cancel"),children:p("generic.cancel")}),o(H,{onClick:U=>x("checkout"),children:p("camera.preview.button.text")})]})]})]})]})})]})},zo=0,Yu=1,OI=2,SI=3,_9=n=>{const[e,t]=_.useState(zo),[s,r]=_.useState(null),{availableEffects:i=[],selectedPictureIndex:a=-1,cameraRoll:l=[],setCameraRoll:c=null,myLevel:u=0,price:h={credits:0,duckets:0,publishDucketPrice:0}}=KP(),d=E=>{switch(E){case"close":t(zo);return;case"edit":t(OI);return;case"delete":c(m=>{const R=[...m];return R.splice(a,1),R});return;case"editor_cancel":t(Yu);return}},f=E=>{r(E),t(SI)};return kt(Ne.ENDED,E=>t(zo)),_.useEffect(()=>{const E={linkReceived:m=>{const R=m.split("/");if(!(R.length<2))switch(R[1]){case"show":t(Yu);return;case"hide":t(zo);return;case"toggle":t(I=>I?zo:Yu);return}},eventUrlPrefix:"camera/"};return Cs(E),()=>As(E)},[]),e===zo?null:g(X,{children:[e===Yu&&o(l9,{onClose:()=>d("close"),onEdit:()=>d("edit"),onDelete:()=>d("delete")}),e===OI&&o(d9,{picture:l[a],myLevel:u,onClose:()=>d("close"),onCancel:()=>d("editor_cancel"),onCheckout:f,availableEffects:i}),e===SI&&o(c9,{base64Url:s,onCloseClick:()=>d("close"),onCancelClick:()=>d("editor_cancel"),price:h})]})},g9=n=>{const{itemId:e=-1,state:t=null,product:s=null,active:r=!1,onClick:i=null}=n,a=l=>{let c=$().getFloorItemDataByName(l),u=null;return c?u=ee().getFurnitureFloorIconUrl(c.id):(c=$().getWallItemDataByName(l),c&&(u=ee().getFurnitureWallIconUrl(c.id))),u};return g(D,{fit:!0,center:!0,pointer:!0,className:`campaign-spritesheet campaign-day-generic-bg rounded calendar-item ${r?"active":""}`,onClick:()=>i(e),children:[t===zs.STATE_UNLOCKED&&o(P,{center:!0,className:"campaign-spritesheet unlocked-bg",children:o(P,{center:!0,className:"campaign-spritesheet campaign-opened",children:s&&o(Sn,{imageUrl:s.customImage?ce("image.library.url")+s.customImage:a(s.productName)})})}),t!==zs.STATE_UNLOCKED&&g(P,{center:!0,className:"campaign-spritesheet locked-bg",children:[t===zs.STATE_LOCKED_AVAILABLE&&o(j,{className:"campaign-spritesheet available"}),(t===zs.STATE_LOCKED_EXPIRED||t===zs.STATE_LOCKED_FUTURE)&&o(j,{className:"campaign-spritesheet unavailable"})]})]})},H_=5,f9=n=>{const{onClose:e=null,campaignName:t=null,currentDay:s=null,numDays:r=null,missedDays:i=null,openedDays:a=null,openPackage:l=null,receivedProducts:c=null}=n,[u,h]=_.useState(s),[d,f]=_.useState(Math.max(0,u-1)),E=N=>a.includes(N)?zs.STATE_UNLOCKED:N>s?zs.STATE_LOCKED_FUTURE:i.includes(N)?zs.STATE_LOCKED_EXPIRED:zs.STATE_LOCKED_AVAILABLE,m=N=>{switch(E(N)){case zs.STATE_UNLOCKED:return p("campaign.calendar.info.unlocked");case zs.STATE_LOCKED_FUTURE:return p("campaign.calendar.info.future");case zs.STATE_LOCKED_EXPIRED:return p("campaign.calendar.info.expired");default:return p("campaign.calendar.info.available.desktop")}},R=()=>{const N=u+1;N!==r&&(h(N),d+H_<N+1&&f(d+1))},I=()=>{const N=u-1;N<0||(h(N),d>N&&f(d-1))},S=N=>{if(u===N){E(N)===zs.STATE_LOCKED_AVAILABLE&&l(N,!1);return}h(N)},A=()=>{const N=u;E(N)!==zs.STATE_UNLOCKED&&l(N,!0)};return g(Re,{className:"nitro-campaign-calendar",theme:"primary-slim",children:[o(Te,{headerText:p(`campaign.calendar.${t}.title`),onCloseClick:e}),g(Ee,{children:[g(ge,{fullHeight:!1,justifyContent:"between",alignItems:"center",children:[o(D,{size:1}),o(D,{size:10,children:g(P,{justifyContent:"between",alignItems:"center",gap:1,children:[g(D,{gap:1,children:[o(y,{fontSize:3,children:p("campaign.calendar.heading.day",["number"],[(u+1).toString()])}),o(y,{children:m(u)})]}),o("div",{children:$().isModerator&&o(H,{variant:"danger",onClick:A,children:"Force open"})})]})}),o(D,{size:1})]}),g(P,{fullHeight:!0,gap:2,children:[o(P,{center:!0,children:o(j,{pointer:!0,className:"campaign-spritesheet prev",onClick:I})}),o(D,{center:!0,fullWidth:!0,children:o(ge,{fit:!0,columnCount:H_,gap:1,children:[...Array(H_)].map((N,L)=>{const M=d+L;return o(D,{overflow:"hidden",children:o(g9,{itemId:M,state:E(M),active:u===M,product:c.has(M)?c.get(M):null,onClick:S})},L)})})}),o(P,{center:!0,children:o(j,{pointer:!0,className:"campaign-spritesheet next",onClick:R})})]})]})]})},m9=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(-1),[i,a]=_.useState(new Map),[l,c]=_.useState(!1),u=(h,d=!1)=>{e&&(r(h),V(d?new YN(e.campaignName,h):new zN(e.campaignName,h)))};return z(nS,h=>{const d=h.getParser();d&&t(d.calendarData)}),z(aS,h=>{const d=h.getParser();if(!d)return;const f=s;d.doorOpened&&(t(E=>{const m=E.clone();return m.openedDays.push(s),m}),a(E=>{const m=new Map(E);return m.set(f,new $6(d.productName,d.customImage,d.furnitureClassName)),m})),r(-1)}),_.useEffect(()=>{const h={linkReceived:d=>{const f=d.split("/");if(!(f.length<2))switch(f[1]){case"calendar":c(!0);break}},eventUrlPrefix:"openView/"};return Cs(h),()=>As(h)},[]),o(X,{children:e&&l&&o(f9,{onClose:()=>c(!1),campaignName:e.campaignName,currentDay:e.currentDay,numDays:e.campaignDays,openedDays:e.openedDays,missedDays:e.missedDays,openPackage:u,receivedProducts:i})})},TL=n=>{const{icon:e=0}=n,t=_.useMemo(()=>ce("catalog.asset.icon.url").replace("%name%",e.toString()),[e]);return o(Sn,{imageUrl:t,style:{width:20,height:20}})},E9=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(0),[i,a]=_.useState(0),[l,c]=_.useState(""),[u,h]=_.useState(""),[d,f]=_.useState(!0),[E,m]=_.useState(""),[R,I]=_.useState([]),[S,A]=_.useState(0),[N,L]=_.useState(0),[M,b]=_.useState(0),[B,w]=_.useState(0),[x,U]=_.useState(0),[G,K]=_.useState(!1),{catalogOptions:Y=null}=Ct(),{friends:te}=Wr(),{giftConfiguration:ne=null}=Y,[J,Ce]=_.useState([]),[Ae,tt]=_.useState([]),[Wt,ls]=_.useState(!0),cs=_.useCallback(()=>{t(!1),r(0),a(0),c(""),h(""),f(!0),m(""),A(0),L(0),ls(!1),tt([]),R.length&&b(R[0].id)},[R]),mr=_.useMemo(()=>ne?ne.defaultStuffTypes.findIndex(We=>We===J[S])>-1:!1,[J,ne,S]),$t=_.useMemo(()=>ne?(J[S]*1e3+ne.ribbonTypes[N]).toString():"",[ne,S,N,J]),Gs=_.useMemo(()=>{if(!ne||mr)return!1;const We=J[S];return!(We===8||We>=3&&We<=6)},[ne,S,mr,J]),yr=_.useMemo(()=>mr?J[S]:M,[mr,J,S,M]),ca=te.filter(We=>We.id!==-1),$i=We=>{const _t=We.target.value;let ii=[];_t.length>0&&(ii=ca.sort().filter(Xa=>Xa.name.includes(_t))),h(_t),ls(!0),tt(ii)},Er=We=>{h(We),ls(!1)},ri=_.useCallback(We=>{switch(We){case"prev_box":A(_t=>_t===0?B:_t-1);return;case"next_box":A(_t=>_t===B?0:_t+1);return;case"prev_ribbon":L(_t=>_t===0?x:_t-1);return;case"next_ribbon":L(_t=>_t===x?0:_t+1);return;case"buy":if(!u||u.length===0){K(!0);return}V(new ry(s,i,l,u,E,yr,S,N,d));return}},[yr,l,B,x,E,i,s,u,S,N,d]);z(_S,We=>K(!0)),Ts([wa.PURCHASE_SUCCESS,Vr.INIT_GIFT],We=>{switch(We.type){case wa.PURCHASE_SUCCESS:cs();return;case Vr.INIT_GIFT:const _t=We;cs(),r(_t.pageId),a(_t.offerId),c(_t.extraData),t(!0);return}}),_.useEffect(()=>{K(!1)},[u]);const ke=_.useCallback(()=>{ne&&Ce(We=>{let _t=[...ne.boxTypes];return _t.push(ne.defaultStuffTypes[Math.floor(Math.random()*(ne.defaultStuffTypes.length-1))]),w(_t.length-1),U(_t.length-1),_t})},[ne]);if(_.useEffect(()=>{if(!ne)return;const We=[];for(const _t of ne.stuffTypes){const ii=$().getFloorItemData(_t);ii&&ii.colors&&ii.colors.length>0&&We.push({id:_t,color:Jr.makeColorNumberHex(ii.colors[0])})}ke(),We.length&&(b(We[0].id),I(We))},[ne,ke]),_.useEffect(()=>{e&&ke()},[ke,e]),!ne||!ne.isEnabled||!e)return null;const ot="catalog.gift_wrapping_new.box."+(mr?"default":J[S]),Jt=`catalog.gift_wrapping_new.ribbon.${N}`,Mr="catalog.gift_wrapping_new."+(mr?"freeprice":"price");return g(Re,{uniqueKey:"catalog-gift",className:"nitro-catalog-gift",theme:"primary-slim",children:[o(Te,{headerText:p("catalog.gift_wrapping.title"),onCloseClick:cs}),g(Ee,{className:"text-black",children:[g(xq,{column:!0,children:[o(y,{children:p("catalog.gift_wrapping.receiver")}),o("input",{type:"text",className:$s("form-control form-control-sm",G&&"is-invalid"),value:u,onChange:We=>$i(We)}),Ae.length>0&&Wt&&o(D,{className:"autocomplete-gift-container",children:Ae.map(We=>o(j,{className:"autocomplete-gift-item",onClick:_t=>Er(We.name),children:We.name},We.id))}),G&&o(j,{className:"invalid-feedback",children:p("catalog.gift_wrapping.receiver_not_found.title")})]}),o(WP,{figure:$().figure,userName:$().userName,message:E,editable:!0,onChange:We=>m(We)}),g(j,{className:"form-check",children:[o("input",{className:"form-check-input",type:"checkbox",name:"showMyFace",checked:d,onChange:We=>f(_t=>!_t)}),o("label",{className:"form-check-label",children:p("catalog.gift_wrapping.show_face.title")})]}),g(P,{alignItems:"center",gap:2,children:[M&&o(j,{className:"gift-preview",children:o($E,{productType:Pe.FLOOR,productClassId:yr,extraData:$t})}),g(D,{gap:1,children:[g(P,{gap:2,children:[g($n,{children:[o(H,{variant:"primary",onClick:()=>ri("prev_box"),children:o(Ma,{className:"fa-icon"})}),o(H,{variant:"primary",onClick:()=>ri("next_box"),children:o(Da,{className:"fa-icon"})})]}),g(D,{gap:1,children:[o(y,{fontWeight:"bold",children:p(ot)}),g(P,{alignItems:"center",gap:1,children:[p(Mr,["price"],[ne.price.toString()]),o(gs,{type:-1})]})]})]}),g(P,{alignItems:"center",gap:2,className:Gs?"":"opacity-50 pointer-events-none",children:[g($n,{children:[o(H,{variant:"primary",onClick:()=>ri("prev_ribbon"),children:o(Ma,{className:"fa-icon"})}),o(H,{variant:"primary",onClick:()=>ri("next_ribbon"),children:o(Da,{className:"fa-icon"})})]}),o(y,{fontWeight:"bold",children:p(Jt)})]})]})]}),g(D,{gap:1,className:Gs?"":"opacity-50 pointer-events-none",children:[o(y,{fontWeight:"bold",children:p("catalog.gift_wrapping.pick_color")}),o($n,{fullWidth:!0,children:R.map(We=>o(H,{variant:"dark",active:We.id===M,disabled:!Gs,style:{backgroundColor:We.color},onClick:()=>b(We.id)},We.id))})]}),g(P,{justifyContent:"between",alignItems:"center",children:[o(H,{variant:"link",onClick:cs,className:"text-black",children:p("cancel")}),o(H,{variant:"success",onClick:()=>ri("buy"),children:p("catalog.gift_wrapping.give_gift")})]})]})]})},p9=n=>{const[e,t]=_.useState(""),{currentType:s=null,rootNode:r=null,offersToNodes:i=null,searchResult:a=null,setSearchResult:l=null,setCurrentPage:c=null}=Ct();return _.useEffect(()=>{let u=e==null?void 0:e.toLocaleLowerCase().replace(" ","");if(!u||!u.length){l(null);return}const h=setTimeout(()=>{const d=$().getAllFurnitureData({loadFurnitureData:null});if(!d||!d.length)return;const f=[],E=[];for(const I of d){if(s===ci.BUILDER&&!I.availableForBuildersClub||s===ci.NORMAL&&I.excludeDynamic)continue;const S=[I.className,I.name,I.description].join(" ").replace(/ /gi,"").toLowerCase();if(s===ci.BUILDER&&I.purchaseOfferId===-1&&I.rentOfferId===-1)I.furniLine!==""&&E.indexOf(I.furniLine)<0&&S.indexOf(u)>=0&&E.push(I.furniLine);else if([...Kp(i,I.purchaseOfferId),...Kp(i,I.rentOfferId)].length&&(S.indexOf(u)>=0&&f.push(I),f.length===250))break}const m=[];for(const I of f)m.push(new E6(I));let R=[];cP(u,E,r,R),l(new R6(u,m,R.filter(I=>I.isVisible))),c(new lP(-1,"default_3x3",new dP([],[]),m,!1,1))},300);return()=>clearTimeout(h)},[i,s,r,e,c,l]),g(P,{gap:1,children:[o(P,{fullWidth:!0,alignItems:"center",position:"relative",children:o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("generic.search"),value:e,onChange:u=>t(u.target.value)})}),(!e||!e.length)&&o(H,{variant:"primary",className:"catalog-search-button",children:o(rm,{className:"fa-icon"})}),e&&!!e.length&&o(H,{variant:"primary",className:"catalog-search-button",onClick:u=>t(""),children:o(ei,{className:"fa-icon"})})]})},RL=n=>{const{node:e=null,child:t=!1}=n;return o(X,{children:e&&e.children.length>0&&e.children.map((s,r)=>s.isVisible?o(OL,{node:s,child:t},r):null)})},OL=n=>{const{node:e=null,child:t=!1}=n,{activateNode:s=null}=Ct();return g(j,{className:"nitro-catalog-navigation-section",children:[g(Qe,{gap:1,column:!1,itemActive:e.isActive,onClick:r=>s(e),className:t?"inset":"",children:[o(TL,{icon:e.iconId}),o(y,{grow:!0,truncate:!0,children:e.localization}),e.isBranch&&g(X,{children:[e.isOpen&&o($f,{className:"fa-icon"}),!e.isOpen&&o(em,{className:"fa-icon"})]})]}),e.isOpen&&e.isBranch&&o(RL,{node:e,child:!0})]})},I9=n=>{const{node:e=null}=n,{searchResult:t=null}=Ct();return g(X,{children:[o(p9,{}),o(D,{fullHeight:!0,className:"nitro-catalog-navigation-grid-container rounded p-1",overflow:"hidden",children:g(Ot,{id:"nitro-catalog-main-navigation",gap:1,columnCount:1,children:[t&&t.filteredNodes.length>0&&t.filteredNodes.map((s,r)=>o(OL,{node:s},r)),!t&&o(RL,{node:e})]})})]})},T9=n=>{const{columnCount:e=5,...t}=n,[s,r]=_.useState(!1),[i,a]=_.useState(null),{currentOffer:l=null,setPurchaseOptions:c=null}=Ct(),{badgeCodes:u=[],activate:h=null,deactivate:d=null}=p_(),f=_.useMemo(()=>{if(!i)return null;const E=new ta;return E.setValue(["0",i,"",""]),E},[i]);return _.useEffect(()=>{l&&c(E=>{const m={...E};return m.extraParamRequired=!0,m.extraData=f&&f.getValue(1)||null,m.previewStuffData=f,m})},[l,f,c]),_.useEffect(()=>{if(!s)return;const E=h();return()=>d(E)},[s,h,d]),_.useEffect(()=>(r(!0),()=>r(!1)),[]),o(Ot,{columnCount:e,...t,children:u&&u.length>0&&u.map((E,m)=>o(Qe,{itemActive:i===E,onClick:R=>a(E),children:o(xt,{badgeCode:E})},m))})},I_=n=>{const{currentPage:e=null,setCurrentOffer:t=null}=Ct();return _.useEffect(()=>{!e||!e.offers.length||t(e.offers[0])},[e,t]),null},op=n=>{const{offer:e=null,selectOffer:t=null,itemActive:s=!1,...r}=n,[i,a]=_.useState(!1),{requestOfferToMover:l=null}=Ct(),{isVisible:c=!1}=Bo(),u=_.useMemo(()=>e.pricingModel===or.PRICING_MODEL_BUNDLE?null:e.product.getIconUrl(e),[e]),h=f=>{switch(f.type){case ie.MOUSE_DOWN:t(e),a(!0);return;case ie.MOUSE_UP:a(!1);return;case ie.ROLL_OUT:if(!i||!s||!c)return;l(e);return}},d=e.product;return d?o(Qe,{itemImage:u,itemCount:e.pricingModel===or.PRICING_MODEL_MULTI?d.productCount:1,itemUniqueSoldout:d.uniqueLimitedItemSeriesSize&&!d.uniqueLimitedItemsLeft,itemUniqueNumber:d.uniqueLimitedItemSeriesSize,itemActive:s,onMouseDown:h,onMouseUp:h,onMouseOut:h,...r,children:e.product.productType===Pe.ROBOT&&o(as,{figure:e.product.extraParam,headOnly:!0,direction:3})}):null},Pu=n=>{const{columnCount:e=5,children:t=null,...s}=n,{currentOffer:r=null,setCurrentOffer:i=null,currentPage:a=null,setPurchaseOptions:l=null}=Ct(),c=_.useRef();if(_.useEffect(()=>{c&&c.current&&(c.current.scrollTop=0)},[a]),!a)return null;const u=h=>{h.activate(),!h.isLazy&&(i(h),h.product&&h.product.productType===Pe.WALL&&l(d=>{const f={...d};return f.extraData=h.product.extraParam||null,f}))};return g(Ot,{innerRef:c,columnCount:e,...s,children:[a.offers&&a.offers.length>0&&a.offers.map((h,d)=>o(op,{itemActive:r&&r.offerId===h.offerId,offer:h,selectOffer:u},d)),t]})},T_=n=>{const{children:e=null,...t}=n,{currentOffer:s=null}=Ct();return!s||s.pricingModel!==or.PRICING_MODEL_SINGLE||!s.product.isUniqueLimitedItem?null:g(j,{...t,children:[o(Lq,{className:"mx-auto",uniqueLimitedItemsLeft:s.product.uniqueLimitedItemsLeft,uniqueLimitedSeriesSize:s.product.uniqueLimitedItemSeriesSize}),e]})},Zi=n=>{const{noGiftOption:e=!1,purchaseCallback:t=null}=n;_.useState(!1);const[s,r]=_.useState(Nt.NONE);ip(Nu.CATALOG_SKIP_PURCHASE_CONFIRMATION,!1);const{currentOffer:i=null,currentPage:a=null,purchaseOptions:l=null,setPurchaseOptions:c=null}=Ct(),{getCurrencyAmount:u=null}=ko(),h=_.useCallback(m=>{switch(m.type){case wa.PURCHASE_SUCCESS:r(Nt.NONE);return;case Bl.PURCHASE_FAILED:r(Nt.FAILED);return;case Yf.NOT_ALLOWED:r(Nt.FAILED);return;case zf.SOLD_OUT:r(Nt.SOLD_OUT);return}},[]);Ts(wa.PURCHASE_SUCCESS,h),Ts(Bl.PURCHASE_FAILED,h),Ts(Yf.NOT_ALLOWED,h),Ts(zf.SOLD_OUT,h);const d=_.useMemo(()=>{if(!i||l.extraParamRequired&&(!l.extraData||!l.extraData.length))return!1;if(i.pricingModel===or.PRICING_MODEL_SINGLE){const m=i.product;if(m&&m.isUniqueLimitedItem)return!m.uniqueLimitedItemsLeft}return!1},[i,l]),f=(m=!1)=>{if(!i)return;if(Qr()<i.clubLevel){de("habboUI/open/hccenter");return}if(m){Fs(new Wq(i.page.pageId,i.offerId,l.extraData));return}if(r(Nt.PURCHASE),t){t();return}let R=i.page.pageId;V(new au(R,i.offerId,l.extraData,l.quantity))};return _.useEffect(()=>{i&&r(Nt.NONE)},[i,c]),_.useEffect(()=>{let m=null;return(s===Nt.CONFIRM||s===Nt.FAILED)&&(m=setTimeout(()=>r(Nt.NONE),3e3)),()=>{m&&clearTimeout(m)}},[s]),i?g(X,{children:[o(()=>{const m=i.priceInCredits*l.quantity,R=i.priceInActivityPoints*l.quantity;if(Qr()<i.clubLevel)return o(H,{variant:"danger",disabled:!0,children:p("catalog.alert.hc.required")});if(d)return o(H,{variant:"danger",disabled:!0,children:p("catalog.alert.limited_edition_sold_out.title")});if(m>u(-1))return o(H,{variant:"danger",disabled:!0,children:p("catalog.alert.notenough.title")});if(R>u(i.activityPointType))return o(H,{variant:"danger",disabled:!0,children:p("catalog.alert.notenough.activitypoints.title."+i.activityPointType)});switch(s){case Nt.CONFIRM:return o(H,{variant:"warning",onClick:I=>f(),children:p("catalog.marketplace.confirm_title")});case Nt.PURCHASE:return o(H,{disabled:!0,children:o(ep,{})});case Nt.FAILED:return o(H,{variant:"danger",children:p("generic.failed")});case Nt.SOLD_OUT:return o(H,{variant:"danger",children:p("generic.failed")+" - "+p("catalog.alert.limited_edition_sold_out.title")});case Nt.NONE:default:return o(H,{disabled:l.extraParamRequired&&(!l.extraData||!l.extraData.length),onClick:I=>r(Nt.CONFIRM),children:p("catalog.purchase_confirmation."+(i.isRentOffer?"rent":"buy"))})}},{}),!e&&!i.isRentOffer&&o(H,{disabled:l.quantity>1||!i.giftable||d||l.extraParamRequired&&(!l.extraData||!l.extraData.length),onClick:m=>f(!0),children:p("catalog.purchase_confirmation.gift")})]}):null},SL=n=>{const{offer:e=null,separator:t=!1}=n,{purchaseOptions:s=null}=Ct(),{quantity:r=1}=s;return e?g(X,{children:[e.priceInCredits>0&&g(P,{alignItems:"center",gap:1,children:[o(y,{bold:!0,children:e.priceInCredits*r}),o(gs,{type:-1})]}),t&&e.priceInCredits>0&&e.priceInActivityPoints>0&&o(Qc,{size:"xs",color:"black",className:"fa-icon"}),e.priceInActivityPoints>0&&g(P,{alignItems:"center",gap:1,children:[o(y,{bold:!0,children:e.priceInActivityPoints*r}),o(gs,{type:e.activityPointType})]})]}):null},la=n=>{const{gap:e=1,...t}=n,{currentOffer:s=null}=Ct();return o(D,{gap:e,...t,children:o(SL,{offer:s})})},Ka=n=>{const{currentOffer:e=null,roomPreviewer:t=null,purchaseOptions:s=null}=Ct(),{previewStuffData:r=null}=s;return _.useEffect(()=>{if(!e||e.pricingModel===or.PRICING_MODEL_BUNDLE||!t)return;const i=e.product;if(i)switch(t.reset(!1),i.productType){case Pe.FLOOR:{if(!i.furnitureData)return;if(i.furnitureData.specialType===he.FIGURE_PURCHASABLE_SET){const l=$().getFloorItemData(i.furnitureData.id).customParams.split(",").map(h=>parseInt(h)),c=[];for(const h of l)fs().isValidFigureSetForGender(h,$().gender)&&c.push(h);const u=fs().getFigureStringWithFigureIds($().figure,$().gender,c);t.addAvatarIntoRoom(u,i.productClassId)}else t.addFurnitureIntoRoom(i.productClassId,new F(90),r,i.extraParam);return}case Pe.WALL:{if(!i.furnitureData)return;switch(i.furnitureData.specialType){case he.FLOOR:t.updateObjectRoom(i.extraParam);return;case he.WALL_PAPER:t.updateObjectRoom(null,i.extraParam);return;case he.LANDSCAPE:{t.updateObjectRoom(null,null,i.extraParam);const a=$().getWallItemDataByName("window_double_default");a&&t.addWallItemIntoRoom(a.id,new F(90),a.customParams);return}default:t.updateObjectRoom("default","default","default"),t.addWallItemIntoRoom(i.productClassId,new F(90),i.extraParam);return}}case Pe.ROBOT:t.addAvatarIntoRoom(i.extraParam,0);return;case Pe.EFFECT:t.addAvatarIntoRoom($().figure,i.productClassId);return}},[e,r,t]),e?e.pricingModel===or.PRICING_MODEL_BUNDLE?o(D,{fit:!0,overflow:"hidden",className:"bg-muted p-2 rounded",children:o(Ot,{fullWidth:!0,columnCount:4,className:"nitro-catalog-layout-bundle-grid",children:e.products.length>0&&e.products.map((i,a)=>o(Qe,{itemImage:i.getIconUrl(e),itemCount:i.productCount},a))})}):o(d_,{roomPreviewer:t,height:140}):null},R9=n=>{const{page:e=null}=n,{currentOffer:t=null}=Ct();return g(X,{children:[o(I_,{}),g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[o(Pu,{shrink:!0}),g(D,{gap:1,overflow:"hidden",children:[o(y,{truncate:!0,shrink:!0,fontWeight:"bold",children:p("catalog_selectbadge")}),o(T9,{})]})]}),g(D,{center:!t,size:5,overflow:"hidden",children:[!t&&g(X,{children:[!!e.localization.getImage(1)&&o("img",{alt:"",src:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),t&&g(X,{children:[o(j,{position:"relative",overflow:"hidden",children:o(Ka,{})}),g(D,{grow:!0,gap:1,children:[o(T_,{fullWidth:!0}),o(y,{grow:!0,truncate:!0,children:t.localizationName}),o(P,{justifyContent:"end",children:o(la,{alignItems:"end"})}),o(Zi,{})]})]})]})]})]})},Ga=n=>{const{...e}=n,{currentOffer:t=null}=Ct();return!t||!t.badgeCode||!t.badgeCode.length?null:o(xt,{badgeCode:t.badgeCode,...e})},O9=1,S9=100,lp=n=>{const{currentOffer:e=null,purchaseOptions:t=null,setPurchaseOptions:s=null}=Ct(),{quantity:r=1}=t,i=a=>{isNaN(a)&&(a=1),a=Math.max(a,O9),a=Math.min(a,S9),a!==r&&s(l=>{const c={...l};return c.quantity=a,c})};return!e||!e.bundlePurchaseAllowed?null:g(X,{children:[o(y,{children:p("catalog.bundlewidget.spinner.select.amount")}),g(P,{alignItems:"center",gap:1,children:[o(gT,{className:"text-black cursor-pointer fa-icon",onClick:a=>i(r-1)}),o("input",{type:"number",className:"form-control form-control-sm quantity-input",value:r,onChange:a=>i(a.target.valueAsNumber)}),o(fT,{className:"text-black cursor-pointer fa-icon",onClick:a=>i(r+1)})]})]})},C9=n=>{const{page:e=null}=n,[t,s]=_.useState(new Map),{currentOffer:r=null,setCurrentOffer:i=null}=Ct(),[a,l]=_.useState(!1),c=(E,m)=>!E.product.furnitureData.colorIndex||!m.product.furnitureData.colorIndex||E.product.furnitureData.colorIndex>m.product.furnitureData.colorIndex?1:E==m?0:-1,u=(E,m)=>E.product.furnitureData.className>m.product.furnitureData.className?1:E==m?0:-1,h=E=>{E.activate(),i(E)},d=(E,m)=>{const R=`${m}*${E}`,I=e.offers.findIndex(S=>S.product.furnitureData.fullName===R);I>-1&&h(e.offers[I])},f=_.useMemo(()=>{const E=[],m=new Map,R=new Map;return e.offers.sort(c),e.offers.forEach(I=>{if(!I.product)return;const S=I.product.furnitureData;if(!S||!S.hasIndexedColor)E.push(I);else{const A=S.className,N=S.colorIndex;R.has(A)||R.set(A,[]);let L=16777215;if(S.colors){for(let M of S.colors)M!==16777215&&(L=M);R.get(A).indexOf(L)===-1&&(R.get(A)[N]=L)}m.has(A)||(E.push(I),m.set(A,!0))}}),E.sort(u),s(R),E},[e.offers]);return g(ge,{children:[o(D,{size:7,overflow:"hidden",children:g(Ot,{columnCount:5,children:[(!a||!r||!t.has(r.product.furnitureData.className))&&f.map((E,m)=>o(op,{itemActive:r&&(r.product.furnitureData.hasIndexedColor?r.product.furnitureData.className===E.product.furnitureData.className:r.offerId===E.offerId),offer:E,selectOffer:h},m)),a&&r&&t.has(r.product.furnitureData.className)&&t.get(r.product.furnitureData.className).map((E,m)=>o(Qe,{itemHighlight:!0,itemActive:r.product.furnitureData.colorIndex===m,itemColor:sr.int2rgb(E),className:"clear-bg",onClick:R=>d(m,r.product.furnitureData.className)},m))]})}),g(D,{center:!r,size:5,overflow:"hidden",children:[!r&&g(X,{children:[!!e.localization.getImage(1)&&o("img",{alt:"",src:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),r&&g(X,{children:[g(j,{position:"relative",overflow:"hidden",children:[o(Ka,{}),o(Ga,{position:"absolute",className:"bg-muted rounded bottom-1 end-1"}),r.product.furnitureData.hasIndexedColor&&o(H,{position:"absolute",className:"bottom-1 start-1",onClick:E=>l(m=>!m),children:o(mT,{className:"fa-icon"})})]}),g(D,{grow:!0,gap:1,children:[o(T_,{fullWidth:!0}),o(y,{grow:!0,truncate:!0,children:r.localizationName}),g(P,{justifyContent:"between",children:[o(D,{gap:1,children:o(lp,{})}),o(la,{justifyContent:"end",alignItems:"end"})]}),o(Zi,{})]})]})]})]})},CL=n=>{const{imageUrl:e=null}=n,[t,s]=_.useState("");return _.useEffect(()=>{s(e??ce("catalog.asset.image.url").replace("%name%","catalog_header_roombuilder"))},[e]),o(P,{center:!0,fullWidth:!0,className:"nitro-catalog-header",children:o("img",{src:t,onError:({currentTarget:r})=>{r.src=ce("catalog.asset.image.url").replace("%name%","catalog_header_roombuilder")}})})},A9=n=>{const{page:e=null}=n,{currentOffer:t=null,currentPage:s=null}=Ct();return o(X,{children:g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[ce("catalog.headers")&&o(CL,{imageUrl:s.localization.getImage(0)}),o(Pu,{})]}),g(D,{center:!t,size:5,overflow:"hidden",children:[!t&&g(X,{children:[!!e.localization.getImage(1)&&o(Sn,{imageUrl:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),t&&g(X,{children:[g(P,{center:!0,overflow:"hidden",style:{height:140},children:[t.product.productType!==Pe.BADGE&&g(X,{children:[o(Ka,{}),o(Ga,{className:"bg-muted rounded bottom-1 end-1"})]}),t.product.productType===Pe.BADGE&&o(Ga,{className:"scale-2"})]}),g(D,{grow:!0,gap:1,children:[o(T_,{fullWidth:!0}),o(y,{grow:!0,truncate:!0,children:t.localizationName}),g(P,{justifyContent:"between",children:[o(D,{gap:1,children:o(lp,{})}),o(la,{justifyContent:"end",alignItems:"end"})]}),o(Zi,{})]})]})]})]})})},N9=n=>{const{...e}=n,{currentOffer:t=null,purchaseOptions:s=null}=Ct(),{previewStuffData:r=null}=s,i=_.useMemo(()=>{if(!t||!r)return null;const a=r.getValue(2);return!a||!a.length?null:a},[t,r]);return i?o(xt,{badgeCode:i,isGroup:!0,...e}):null},AL=n=>{const[e,t]=_.useState(0),{currentOffer:s=null,catalogOptions:r=null,setPurchaseOptions:i=null}=Ct(),{groups:a=null}=r,l=_.useMemo(()=>{if(!a||!a.length)return null;const u=a[e];if(!u)return null;const h=new ta;return h.setValue(["0",u.groupId.toString(),u.badgeCode,u.colorA,u.colorB]),h},[e,a]);if(_.useEffect(()=>{s&&i(u=>{const h={...u};return h.extraParamRequired=!0,h.extraData=l&&l.getValue(1)||null,h.previewStuffData=l,h})},[s,l,i]),_.useEffect(()=>{V(new gE)},[]),!a||!a.length)return g(j,{className:"bg-muted rounded p-1 text-black text-center",children:[p("catalog.guild_selector.members_only"),o(H,{className:"mt-1",children:p("catalog.guild_selector.find_groups")})]});const c=a[e];return g(P,{gap:1,children:[!!c&&g(P,{overflow:"hidden",className:"rounded border",children:[o(j,{fullHeight:!0,style:{width:"20px",backgroundColor:"#"+c.colorA}}),o(j,{fullHeight:!0,style:{width:"20px",backgroundColor:"#"+c.colorB}})]}),o("select",{className:"form-select form-select-sm",value:e,onChange:u=>t(parseInt(u.target.value)),children:a.map((u,h)=>o("option",{value:h,children:u.groupName},h))})]})},y9=n=>{const{page:e=null}=n,{currentOffer:t=null}=Ct();return g(ge,{children:[o(D,{size:7,overflow:"hidden",children:o(Pu,{})}),g(D,{center:!t,size:5,overflow:"hidden",children:[!t&&g(X,{children:[!!e.localization.getImage(1)&&o("img",{alt:"",src:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),t&&g(X,{children:[g(j,{position:"relative",overflow:"hidden",children:[o(Ka,{}),o(N9,{position:"absolute",className:"bottom-1 end-1"})]}),g(D,{grow:!0,gap:1,children:[o(y,{truncate:!0,children:t.localizationName}),o(j,{grow:!0,children:o(AL,{})}),o(P,{justifyContent:"end",children:o(la,{alignItems:"end"})}),o(Zi,{})]})]})]})]})},M9=n=>{const{page:e=null}=n;_.useState(0);const{currentOffer:t=null,setCurrentOffer:s=null,catalogOptions:r=null}=Ct();return _.useEffect(()=>{V(new gE)},[e]),g(X,{children:[o(I_,{}),g(ge,{children:[o(D,{className:"bg-muted rounded p-2 text-black",size:7,overflow:"hidden",children:o(j,{className:"overflow-auto",dangerouslySetInnerHTML:{__html:e.localization.getText(1)}})}),o(D,{size:5,overflow:"hidden",gap:1,children:!!t&&o(X,{children:g(D,{grow:!0,gap:1,children:[o(y,{truncate:!0,children:t.localizationName}),o(j,{grow:!0,children:o(AL,{})}),o(P,{justifyContent:"end",children:o(la,{alignItems:"end"})}),o(Zi,{noGiftOption:!0})]})})})]})]})},D9=n=>{const{page:e=null}=n;return g(ge,{children:[g(D,{size:7,overflow:"hidden",className:"bg-muted rounded p-2 text-black",children:[o(j,{dangerouslySetInnerHTML:{__html:e.localization.getText(2)}}),o(j,{overflow:"auto",dangerouslySetInnerHTML:{__html:e.localization.getText(0)}}),o(j,{dangerouslySetInnerHTML:{__html:e.localization.getText(1)}})]}),g(D,{center:!0,size:5,overflow:"hidden",children:[o(Sn,{imageUrl:e.localization.getImage(1)}),o(H,{onClick:()=>de("groups/create"),children:p("catalog.start.guild.purchase.button")})]})]})},v9=n=>{const{page:e=null}=n;return o("div",{className:"h-100 nitro-catalog-layout-info-loyalty text-black d-flex flex-row",children:o("div",{className:"overflow-auto h-100 d-flex flex-column info-loyalty-content",children:o("div",{dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})})})},NL=n=>{const{page:e=null}=n,t=e.localization.getImage(1);return g(D,{grow:!0,className:"bg-muted rounded text-black p-2",overflow:"hidden",children:[g(P,{alignItems:"center",gap:2,children:[t&&o("img",{alt:"",src:t}),o(j,{className:"fs-5",dangerouslySetInnerHTML:{__html:e.localization.getText(1)}})]}),o(D,{grow:!0,alignItems:"center",overflow:"auto",children:o(j,{dangerouslySetInnerHTML:{__html:e.localization.getText(2)}})}),o(P,{alignItems:"center",children:o(j,{className:"fw-bold",dangerouslySetInnerHTML:{__html:e.localization.getText(3)}})})]})},b9=n=>o(NL,{...n}),P9=n=>{const{page:e=null}=n,[t,s]=_.useState(""),[r,i]=_.useState(""),[a,l]=_.useState(-1),[c,u]=_.useState([]),[h,d]=_.useState(!1),[f,E]=_.useState(1),{categories:m=null}=Mi(),{setIsVisible:R=null}=Ct(),{promoteInformation:I,isExtended:S,setIsExtended:A}=ap();_.useEffect(()=>{S&&(l(I.data.flatId),s(I.data.eventName),i(I.data.eventDescription),E(I.data.categoryId),d(S),A(!1))},[S,t,r,f]);const N=()=>{l(-1),s(""),i(""),E(1),A(!1),R(!1)},L=()=>{const M=e.pageId,b=e.offers.length>=1?e.offers[0].offerId:-1,B=a,w=t,x=r,U=f;V(new iy(M,b,B,w,h,x,U)),N()};return z(RS,M=>{const b=M.getParser();b&&u(b.rooms)}),_.useEffect(()=>{V(new ty),V(new iE)},[]),g(X,{children:[o(y,{bold:!0,center:!0,children:p("roomad.catalog_header")}),g(D,{size:12,overflow:"hidden",className:"text-black",children:[o(j,{children:p("roomad.catalog_text",["duration"],["120"])}),g(j,{className:"bg-muted rounded p-1",children:[g(D,{gap:2,children:[o(y,{bold:!0,children:p("navigator.category")}),o("select",{className:"form-select form-select-sm",value:f,onChange:M=>E(parseInt(M.target.value)),disabled:h,children:m&&m.map((M,b)=>o("option",{value:M.id,children:p(M.name)},b))})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("roomad.catalog_name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:64,value:t,onChange:M=>s(M.target.value),readOnly:h})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("roomad.catalog_description")}),o("textarea",{className:"form-control form-control-sm",maxLength:64,value:r,onChange:M=>i(M.target.value),readOnly:h})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("roomad.catalog_roomname")}),g("select",{className:"form-select form-select-sm",value:a,onChange:M=>l(parseInt(M.target.value)),disabled:h,children:[o("option",{value:-1,disabled:!0,children:p("roomad.catalog_roomname")}),c&&c.map((M,b)=>o("option",{value:M.roomId,children:M.roomName},b))]})]}),o(D,{gap:1,children:o(H,{variant:!t||!r||a===-1?"danger":"success",onClick:L,disabled:!t||!r||a===-1,children:p(h?"roomad.extend.event":"buy")})})]})]})]})},yL=n=>{const{columnCount:e=5,children:t=null,...s}=n,{currentOffer:r=null}=Ct(),i=_.useRef();return _.useEffect(()=>{i&&i.current&&(i.current.scrollTop=0)},[r]),r?g(Ot,{innerRef:i,columnCount:5,...s,children:[r.products&&r.products.length>0&&r.products.map((a,l)=>o(Qe,{itemImage:a.getIconUrl(),itemCount:a.productCount},l)),t]}):null},ML=n=>{const{gap:e=1,...t}=n,{currentOffer:s=null}=Ct();return o(P,{gap:e,alignItems:"center",classNames:["bg-muted","p-1","rounded"],...t,children:o(SL,{separator:!0,offer:s})})},L9=n=>{const{page:e=null}=n;return g(X,{children:[o(I_,{}),g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[!!e.localization.getText(2)&&o(y,{dangerouslySetInnerHTML:{__html:e.localization.getText(2)}}),o(D,{grow:!0,overflow:"hidden",className:"bg-muted p-2 rounded",children:o(yL,{fullWidth:!0,className:"nitro-catalog-layout-bundle-grid"})})]}),g(D,{size:5,overflow:"hidden",gap:1,children:[!!e.localization.getText(1)&&o(y,{center:!0,small:!0,overflow:"auto",children:e.localization.getText(1)}),g(D,{grow:!0,position:"relative",overflow:"hidden",gap:0,children:[!!e.localization.getImage(1)&&o("img",{alt:"",className:"flex-grow-1",src:e.localization.getImage(1)}),o(Ga,{position:"absolute",className:"bg-muted rounded bottom-0 start-0"}),o(ML,{position:"absolute",className:"bottom-0 end-0"})]}),o(D,{gap:1,children:o(Zi,{})})]})]})]})},U9=n=>{const{page:e=null}=n;return g(X,{children:[o(I_,{}),g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[!!e.localization.getText(2)&&o(y,{dangerouslySetInnerHTML:{__html:e.localization.getText(2)}}),o(D,{grow:!0,overflow:"hidden",className:"bg-muted p-2 rounded",children:o(yL,{fullWidth:!0,className:"nitro-catalog-layout-bundle-grid"})})]}),g(D,{size:5,overflow:"hidden",gap:1,children:[!!e.localization.getText(1)&&o(y,{center:!0,small:!0,overflow:"auto",children:e.localization.getText(1)}),g(D,{grow:!0,position:"relative",overflow:"hidden",gap:0,children:[!!e.localization.getImage(1)&&o("img",{alt:"",className:"flex-grow-1",src:e.localization.getImage(1)}),o(Ga,{position:"absolute",className:"bg-muted rounded bottom-0 start-0"}),o(ML,{position:"absolute",className:"bottom-0 end-0"})]}),o(D,{gap:1,children:o(Zi,{})})]})]})]})},F9=n=>{const{page:e=null}=n,[t,s]=_.useState(-1),[r,i]=_.useState(""),{currentOffer:a=null,currentPage:l=null}=Ct(),c=u=>{var h;return(h=ze().soundManager.musicController)==null?void 0:h.playSong(u,Is.PRIORITY_PURCHASE_PREVIEW,15,0,0,0)};return z(EN,u=>{const h=u.getParser();h.officialSongId===r&&s(h.songId)}),_.useEffect(()=>{if(!a)return;const u=a.product;if(u){if(u.extraParam.length>0){const h=parseInt(u.extraParam);h>0?s(h):(i(u.extraParam),V(new Ev(u.extraParam)))}else i(""),s(-1);return()=>{var h;return(h=ze().soundManager.musicController)==null?void 0:h.stop(Is.PRIORITY_PURCHASE_PREVIEW)}}},[a]),_.useEffect(()=>()=>{var u;return(u=ze().soundManager.musicController)==null?void 0:u.stop(Is.PRIORITY_PURCHASE_PREVIEW)},[]),o(X,{children:g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[ce("catalog.headers")&&o(CL,{imageUrl:l.localization.getImage(0)}),o(Pu,{})]}),g(D,{center:!a,size:5,overflow:"hidden",children:[!a&&g(X,{children:[!!e.localization.getImage(1)&&o(Sn,{imageUrl:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),a&&g(X,{children:[g(P,{center:!0,overflow:"hidden",style:{height:140},children:[a.product.productType!==Pe.BADGE&&g(X,{children:[o(Ka,{}),o(Ga,{className:"bg-muted rounded bottom-1 end-1"})]}),a.product.productType===Pe.BADGE&&o(Ga,{className:"scale-2"})]}),g(D,{grow:!0,gap:1,children:[o(T_,{fullWidth:!0}),o(y,{grow:!0,truncate:!0,children:a.localizationName}),t>-1&&o(H,{onClick:()=>c(t),children:p("play_preview_button")}),g(P,{justifyContent:"between",children:[o(D,{gap:1,children:o(lp,{})}),o(la,{justifyContent:"end",alignItems:"end"})]}),o(Zi,{})]})]})]})]})})},x9=["floors","walls","views"],w9=n=>{const{columnCount:e=5,children:t=null,...s}=n,[r,i]=_.useState(null),[a,l]=_.useState(-1),[c,u]=_.useState(null),{currentPage:h=null,currentOffer:d=null,setCurrentOffer:f=null,setPurchaseOptions:E=null}=Ct(),m=_.useRef(),R=S=>{S&&u(A=>{const N=[...A];return N[a]=S,N})};if(_.useEffect(()=>{if(!h)return;const S=[[],[],[]];for(const A of h.offers){if(A.pricingModel!==or.PRICING_MODEL_SINGLE&&A.pricingModel!==or.PRICING_MODEL_MULTI)continue;const N=A.product;if(!N||N.productType!==Pe.WALL&&N.productType!==Pe.FLOOR||!N.furnitureData)continue;switch(N.furnitureData.className){case"floor":S[0].push(A);break;case"wallpaper":S[1].push(A);break;case"landscape":S[2].push(A);break}}i(S),l(0),u([S[0][0],S[1][0],S[2][0]])},[h]),_.useEffect(()=>{a===-1||!c||f(c[a])},[a,c,f]),_.useEffect(()=>{a===-1||!c||!d||E(S=>{const A={...S};return A.extraData=c[a].product.extraParam,A.extraParamRequired=!0,A})},[d,a,c,E]),_.useEffect(()=>{m&&m.current&&(m.current.scrollTop=0)},[a]),!r||a===-1)return null;const I=r[a];return g(X,{children:[o($n,{children:x9.map((S,A)=>o(H,{active:a===A,onClick:N=>l(A),children:p(`catalog.spaces.tab.${S}`)},A))}),g(Ot,{innerRef:m,columnCount:e,...s,children:[I&&I.length>0&&I.map((S,A)=>o(op,{itemActive:d&&d===S,offer:S,selectOffer:N=>R(N)},A)),t]})]})},G9=n=>{const{page:e=null}=n,{currentOffer:t=null,roomPreviewer:s=null}=Ct();return _.useEffect(()=>{s.updatePreviewObjectBoundingRectangle(new Ii)},[s]),g(ge,{children:[o(D,{size:7,overflow:"hidden",children:o(w9,{})}),g(D,{center:!t,size:5,overflow:"hidden",children:[!t&&g(X,{children:[!!e.localization.getImage(1)&&o("img",{alt:"",src:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),t&&g(X,{children:[o(j,{position:"relative",overflow:"hidden",children:o(Ka,{})}),g(D,{grow:!0,gap:1,children:[o(y,{grow:!0,truncate:!0,children:t.localizationName}),o(P,{justifyContent:"end",children:o(la,{alignItems:"end"})}),o(Zi,{})]})]})]})]})},B9=n=>{const{page:e=null}=n,[t,s]=_.useState(""),{currentOffer:r=null,setPurchaseOptions:i=null}=Ct();return _.useEffect(()=>{r&&i(a=>{const l={...a};return l.extraData=t,l})},[r,t,i]),g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[o(Pu,{}),o("textarea",{className:"flex-grow-1 form-control w-100",defaultValue:t||"",onChange:a=>s(a.target.value)})]}),g(D,{center:!r,size:5,overflow:"hidden",children:[!r&&g(X,{children:[!!e.localization.getImage(1)&&o("img",{alt:"",src:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),r&&g(X,{children:[o(Ka,{}),g(D,{grow:!0,gap:1,children:[o(y,{grow:!0,truncate:!0,children:r.localizationName}),o(P,{justifyContent:"end",children:o(la,{alignItems:"end"})}),o(Zi,{})]})]})]})]})},k9=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(Nt.NONE),{currentPage:i=null,catalogOptions:a=null}=Ct(),{purse:l=null,getCurrencyAmount:c=null}=ko(),{clubOffers:u=null}=a,h=_.useCallback(A=>{switch(A.type){case wa.PURCHASE_SUCCESS:r(Nt.NONE);return;case Bl.PURCHASE_FAILED:r(Nt.FAILED);return}},[]);Ts(wa.PURCHASE_SUCCESS,h),Ts(Bl.PURCHASE_FAILED,h);const d=_.useCallback(A=>{let N="";return A.months>0&&(N=p("catalog.vip.item.header.months",["num_months"],[A.months.toString()])),A.extraDays>0&&(N!==""&&(N+=" "),N+=" "+p("catalog.vip.item.header.days",["num_days"],[A.extraDays.toString()])),N},[]),f=_.useCallback(()=>{if(!l)return"";const A=l.clubDays>0||l.clubPeriods>0?"extension.":"subscription.",N=e.months===0?"days":"months",L=e.months===0?e.extraDays:e.months;return p("catalog.vip.buy.confirm."+A+N).replace("%NUM_"+N.toUpperCase()+"%",L.toString())},[e,l]),E=_.useCallback(()=>{let A=p("catalog.vip.buy.confirm.end_date");return A=A.replace("%month%",e.month.toString()),A=A.replace("%day%",e.day.toString()),A=A.replace("%year%",e.year.toString()),A},[e]),m=_.useMemo(()=>{const A=l.clubDays,L=l.clubPeriods*31+A;return p("catalog.vip.extend.info",["days"],[L.toString()])},[l]),R=_.useCallback(()=>{e&&(r(Nt.PURCHASE),V(new au(i.pageId,e.offerId,null,1)))},[e,i]),I=_.useCallback(A=>{r(Nt.NONE),t(A)},[]),S=_.useCallback(()=>{if(!e)return null;if(e.priceCredits>c(-1))return o(H,{fullWidth:!0,variant:"danger",children:p("catalog.alert.notenough.title")});if(e.priceActivityPoints>c(e.priceActivityPointsType))return o(H,{fullWidth:!0,variant:"danger",children:p("catalog.alert.notenough.activitypoints.title."+e.priceActivityPointsType)});switch(s){case Nt.CONFIRM:return o(H,{fullWidth:!0,variant:"warning",onClick:R,children:p("catalog.marketplace.confirm_title")});case Nt.PURCHASE:return o(H,{fullWidth:!0,variant:"primary",disabled:!0,children:o(ep,{})});case Nt.FAILED:return o(H,{fullWidth:!0,variant:"danger",disabled:!0,children:p("generic.failed")});case Nt.NONE:default:return o(H,{fullWidth:!0,variant:"success",onClick:()=>r(Nt.CONFIRM),children:p("buy")})}},[e,s,R,c]);return _.useEffect(()=>{u||V(new ZN(1))},[u]),g(ge,{children:[g(D,{fullHeight:!0,size:7,overflow:"hidden",justifyContent:"between",children:[o(Ot,{columnCount:1,className:"nitro-catalog-layout-vip-buy-grid",children:u&&u.length>0&&u.map((A,N)=>g(Qe,{column:!1,center:!1,alignItems:"center",justifyContent:"between",itemActive:e===A,className:"p-1",onClick:()=>I(A),children:[o("i",{className:"icon-hc-banner"}),g(D,{justifyContent:"end",gap:0,children:[o(y,{textEnd:!0,children:d(A)}),g(P,{justifyContent:"end",gap:1,children:[A.priceCredits>0&&g(P,{alignItems:"center",justifyContent:"end",gap:1,children:[o(y,{children:A.priceCredits}),o(gs,{type:-1})]}),A.priceActivityPoints>0&&g(P,{alignItems:"center",justifyContent:"end",gap:1,children:[o(y,{children:A.priceActivityPoints}),o(gs,{type:A.priceActivityPointsType})]})]})]})]},N))}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:p("catalog.vip.buy.hccenter")}})]}),g(D,{size:5,overflow:"hidden",children:[g(D,{fullHeight:!0,center:!0,overflow:"hidden",children:[i.localization.getImage(1)&&o("img",{alt:"",src:i.localization.getImage(1)}),o(y,{center:!0,overflow:"auto",dangerouslySetInnerHTML:{__html:m}})]}),e&&g(D,{fullWidth:!0,grow:!0,justifyContent:"end",children:[g(P,{alignItems:"end",children:[g(D,{grow:!0,gap:0,children:[o(y,{fontWeight:"bold",children:f()}),o(y,{children:E()})]}),g(D,{gap:1,children:[e.priceCredits>0&&g(P,{alignItems:"center",justifyContent:"end",gap:1,children:[o(y,{children:e.priceCredits}),o(gs,{type:-1})]}),e.priceActivityPoints>0&&g(P,{alignItems:"center",justifyContent:"end",gap:1,children:[o(y,{children:e.priceActivityPoints}),o(gs,{type:e.priceActivityPointsType})]})]})]}),S()]})]})]})},V9=n=>{const{text:e=null}=n,[t,s]=_.useState(""),[r,i]=_.useState(!1),{simpleAlert:a=null}=Xt(),l=()=>{!t||!t.length||r||(V(new ay(t)),i(!0))};return z(AS,c=>{const u=c.getParser();let h=p("catalog.alert.voucherredeem.ok.description");u.productName&&(h=p("catalog.alert.voucherredeem.ok.description.furni",["productName","productDescription"],[u.productName,u.productDescription])),a(h,null,null,null,p("catalog.alert.voucherredeem.ok.title")),i(!1),s("")}),z(CS,c=>{const u=c.getParser();a(p(`catalog.alert.voucherredeem.error.description.${u.errorCode}`),null,null,null,p("catalog.alert.voucherredeem.error.title")),i(!1)}),g(P,{gap:1,children:[o("input",{type:"text",className:"form-control form-control-sm",placeholder:e,value:t,onChange:c=>s(c.target.value)}),o(H,{variant:"primary",onClick:l,disabled:r,children:o(gU,{className:"fa-icon"})})]})},zu=n=>{const{item:e=null,position:t="relative",pointer:s=!0,overflow:r="hidden",fullHeight:i=!0,classNames:a=[],children:l=null,...c}=n,u=_.useMemo(()=>{const d=["rounded","nitro-front-page-item"];return a.length&&d.push(...a),d},[a]);if(!e)return null;const h=ce("image.library.url")+e.itemPromoImage;return g(jP,{imageUrl:h,classNames:u,position:t,fullHeight:i,pointer:s,overflow:r,...c,children:[o(y,{position:"absolute",variant:"white",className:"bg-dark rounded p-2 m-2 bottom-0",children:e.itemName}),l]})},H9=n=>{const{page:e=null,hideNavigation:t=null}=n,{frontPageItems:s=[]}=Ct(),r=_.useCallback(i=>{switch(i.type){case Mg.ITEM_CATALOGUE_PAGE:de(`catalog/open/${i.catalogPageLocation}`);return;case Mg.ITEM_PRODUCT_OFFER:de(`catalog/open/${i.productOfferId}`);return}},[]);return _.useEffect(()=>{t()},[e,t]),g(ge,{children:[o(D,{size:4,children:s[0]&&o(zu,{item:s[0],onClick:i=>r(s[0])})}),g(D,{size:8,children:[s[1]&&o(zu,{item:s[1],onClick:i=>r(s[1])}),s[2]&&o(zu,{item:s[2],onClick:i=>r(s[2])}),s[3]&&o(zu,{item:s[3],onClick:i=>r(s[3])}),o(V9,{text:e.localization.getText(1)})]})]})},Jf=1,Ch=2,DL=n=>{const{offerData:e=null,type:t=Ch,onClick:s=null}=n,r=_.useMemo(()=>e?p((e.furniType===2?"wallItem":"roomItem")+`.name.${e.furniId}`):"",[e]),i=_.useCallback(()=>{if(!e)return"";if(e.status===No.SOLD)return p("catalog.marketplace.offer.sold");if(e.timeLeftMinutes<=0)return p("catalog.marketplace.offer.expired");const a=Math.max(1,e.timeLeftMinutes),l=Math.floor(a/60);let u=a-l*60+" "+p("catalog.marketplace.offer.minutes");return l>0&&(u=l+" "+p("catalog.marketplace.offer.hours")+" "+u),p("catalog.marketplace.offer.time_left",["time"],[u])},[e]);return g(Qe,{shrink:!0,center:!1,column:!1,alignItems:"center",className:"p-1",children:[o(D,{style:{width:40,height:40},children:o(Qe,{column:!1,itemImage:p6(e.furniType===Su.TYPE_FLOOR?Pe.FLOOR:Pe.WALL,e.furniId,e.extraData),itemUniqueNumber:e.isUniqueLimitedItem?e.stuffData.uniqueNumber:0})}),g(D,{grow:!0,gap:0,children:[o(y,{fontWeight:"bold",children:r}),t===Jf&&g(X,{children:[o(y,{children:p("catalog.marketplace.offer.price_own_item",["price"],[e.price.toString()])}),o(y,{children:i()})]}),t===Ch&&g(X,{children:[o(y,{children:p("catalog.marketplace.offer.price_public_item",["price","average"],[e.price.toString(),e.averagePrice>0?e.averagePrice.toString():"-"])}),o(y,{children:p("catalog.marketplace.offer_count",["count"],[e.offerCount.toString()])})]})]}),g(D,{gap:1,children:[t===Jf&&e.status!==No.SOLD&&o(H,{variant:"secondary",onClick:()=>s(e),children:p("catalog.marketplace.offer.pick")}),t===Ch&&g(X,{children:[o(H,{variant:"secondary",onClick:()=>s(e),children:p("buy")}),o(H,{variant:"secondary",disabled:!0,children:p("catalog.marketplace.view_more")})]})]})]})},j9=n=>{const[e,t]=_.useState(0),[s,r]=_.useState([]),{simpleAlert:i=null}=Xt();z(MC,u=>{const h=u.getParser();if(!h)return;const d=h.offers.map(f=>{const E=new Su(f.offerId,f.furniId,f.furniType,f.extraData,f.stuffData,f.price,f.status,f.averagePrice,f.offerCount);return E.timeLeftMinutes=f.timeLeftMinutes,E});t(h.creditsWaiting),r(d)}),z(CC,u=>{const h=u.getParser();if(h){if(!h.success){i(p("catalog.marketplace.cancel_failed"),Le.DEFAULT,null,null,p("catalog.marketplace.operation_failed.topic"));return}r(d=>d.filter(f=>f.offerId!==h.offerId))}});const a=_.useMemo(()=>s.filter(u=>u.status===No.SOLD),[s]),l=_.useCallback(()=>{r(u=>{const h=a.map(d=>d.offerId);return u.filter(d=>h.indexOf(d.offerId)===-1)}),V(new pM)},[a]),c=u=>{V(new _M(u.offerId))};return _.useEffect(()=>{V(new mM)},[]),g(D,{overflow:"hidden",children:[e<=0&&o(y,{center:!0,className:"bg-muted rounded p-1",children:p("catalog.marketplace.redeem.no_sold_items")}),e>0&&g(D,{center:!0,gap:1,className:"bg-muted rounded p-2",children:[o(y,{children:p("catalog.marketplace.redeem.get_credits",["count","credits"],[a.length.toString(),e.toString()])}),o(H,{className:"mt-1",onClick:l,children:p("catalog.marketplace.offer.redeem")})]}),g(D,{gap:1,overflow:"hidden",children:[o(y,{truncate:!0,shrink:!0,fontWeight:"bold",children:p("catalog.marketplace.items_found",["count"],[s.length.toString()])}),o(D,{overflow:"auto",className:"nitro-catalog-layout-marketplace-grid",children:s.length>0&&s.map(u=>o(DL,{offerData:u,type:Jf,onClick:c},u.offerId))})]})]})},W9=n=>{const{searchType:e=null,sortTypes:t=null,onSearch:s=null}=n,[r,i]=_.useState(t?t[0]:3),[a,l]=_.useState(""),[c,u]=_.useState(0),[h,d]=_.useState(0),f=_.useCallback(m=>{i(m),(e===Ys.BY_ACTIVITY||e===Ys.BY_VALUE)&&s({minPrice:-1,maxPrice:-1,query:"",type:m})},[s,e]),E=_.useCallback(()=>{const m=c>0?c:-1,R=h>0?h:-1;s({minPrice:m,maxPrice:R,type:r,query:a})},[h,c,s,a,r]);return _.useEffect(()=>{if(!t||!t.length)return;const m=t[0];i(m),(e===Ys.BY_ACTIVITY||Ys.BY_VALUE===e)&&s({minPrice:-1,maxPrice:-1,query:"",type:m})},[s,e,t]),g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("catalog.marketplace.sort_order")}),o("select",{className:"form-select form-select-sm",value:r,onChange:m=>f(parseInt(m.target.value)),children:t.map(m=>o("option",{value:m,children:p(`catalog.marketplace.sort.${m}`)},m))})]}),e===Ys.ADVANCED&&g(X,{children:[g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("catalog.marketplace.search_name")}),o("input",{className:"form-control form-control-sm",type:"text",value:a,onChange:m=>l(m.target.value)})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("catalog.marketplace.search_price")}),g(P,{fullWidth:!0,gap:1,children:[o("input",{className:"form-control form-control-sm",type:"number",min:0,value:c,onChange:m=>u(m.target.valueAsNumber)}),o("input",{className:"form-control form-control-sm",type:"number",min:0,value:h,onChange:m=>d(m.target.valueAsNumber)})]})]}),o(H,{variant:"secondary",className:"mx-auto",onClick:E,children:p("generic.search")})]})]})},Y9=[1,2],z9=[3,4,5,6],K9=[1,2,3,4,5,6],X9=n=>{const[e,t]=_.useState(Ys.BY_ACTIVITY),[s,r]=_.useState(0),[i,a]=_.useState(new Map),[l,c]=_.useState({minPrice:-1,maxPrice:-1,query:"",type:3}),{getCurrencyAmount:u=null}=ko(),{simpleAlert:h=null,showConfirm:d=null}=Xt(),f=_.useCallback(R=>{c(R),V(new fM(R.minPrice,R.maxPrice,R.query,R.type))},[]),E=_.useMemo(()=>{switch(e){case Ys.BY_ACTIVITY:return z9;case Ys.BY_VALUE:return Y9;case Ys.ADVANCED:return K9}return[]},[e]),m=_.useCallback(R=>{if(R.price>u(-1)){h(p("catalog.alert.notenough.credits.description"),Le.DEFAULT,null,null,p("catalog.alert.notenough.title"));return}const I=R.offerId;d(p("catalog.marketplace.confirm_header"),()=>{V(new gf(I))},null,null,null,p("catalog.marketplace.confirm_title"))},[u,h,d]);return z(yC,R=>{const I=R.getParser();if(!I)return;const S=new Map;I.offers.forEach(A=>{const N=new Su(A.offerId,A.furniId,A.furniType,A.extraData,A.stuffData,A.price,A.status,A.averagePrice,A.offerCount);N.timeLeftMinutes=A.timeLeftMinutes,S.set(A.offerId,N)}),r(I.totalItemsFound),a(S)}),z(SC,R=>{const I=R.getParser();if(I)switch(I.result){case 1:f(l);break;case 2:a(S=>{const A=new Map(S);return A.delete(I.requestedOfferId),A}),h(p("catalog.marketplace.not_available_header"),Le.DEFAULT,null,null,p("catalog.marketplace.not_available_title"));break;case 3:a(S=>{const A=new Map(S),N=A.get(I.requestedOfferId);return N&&(N.offerId=I.offerId,N.price=I.newPrice,N.offerCount--,A.set(N.offerId,N)),A.delete(I.requestedOfferId),A}),d(p("catalog.marketplace.confirm_higher_header")+`
`+p("catalog.marketplace.confirm_price",["price"],[I.newPrice.toString()]),()=>{V(new gf(I.offerId))},null,null,null,p("catalog.marketplace.confirm_higher_title"));break;case 4:h(p("catalog.alert.notenough.credits.description"),Le.DEFAULT,null,null,p("catalog.alert.notenough.title"));break}}),g(X,{children:[g($n,{children:[o(H,{active:e===Ys.BY_ACTIVITY,onClick:()=>t(Ys.BY_ACTIVITY),children:p("catalog.marketplace.search_by_activity")}),o(H,{active:e===Ys.BY_VALUE,onClick:()=>t(Ys.BY_VALUE),children:p("catalog.marketplace.search_by_value")}),o(H,{active:e===Ys.ADVANCED,onClick:()=>t(Ys.ADVANCED),children:p("catalog.marketplace.search_advanced")})]}),o(W9,{sortTypes:E,searchType:e,onSearch:f}),g(D,{gap:1,overflow:"hidden",children:[o(y,{truncate:!0,shrink:!0,fontWeight:"bold",children:p("catalog.marketplace.items_found",["count"],[i.size.toString()])}),o(D,{className:"nitro-catalog-layout-marketplace-grid",overflow:"auto",children:Array.from(i.values()).map((R,I)=>o(DL,{offerData:R,type:Ch,onClick:m},I))})]})]})},q9=n=>{const{page:e=null}=n,[t,s]=_.useState(-1),[r,i]=_.useState([]),[a,l]=_.useState(-1),[c,u]=_.useState([]),[h,d]=_.useState(-1),[f,E]=_.useState(!1),[m,R]=_.useState("");_.useState(!0);const[I,S]=_.useState(-1),{currentOffer:A=null,setCurrentOffer:N=null,setPurchaseOptions:L=null,catalogOptions:M=null,roomPreviewer:b=null}=Ct(),{petPalettes:B=null}=M,w=_.useMemo(()=>!c.length||h===-1?16777215:c[h][0],[c,h]),x=_.useMemo(()=>t===-1||!r.length||a===-1?"":p(`pet.breed.${t}.${r[a].breedId}`),[t,r,a]),U=_.useMemo(()=>{if(!r.length||a===-1)return"";const Y=r[a].paletteId;let te=16777215;if(t<=7){if(h===-1)return"";te=c[h][0]}let ne=te.toString(16).toUpperCase();for(;ne.length<6;)ne="0"+ne;return`${Y}
${ne}`},[r,a,t,c,h]),G=_.useMemo(()=>{let Y="";switch(I){case 1:Y="catalog.alert.petname.long";break;case 2:Y="catalog.alert.petname.short";break;case 3:Y="catalog.alert.petname.chars";break;case 4:Y="catalog.alert.petname.bobba";break}return!Y||!Y.length?"":p(Y)},[I]),K=_.useCallback(()=>{if(I===-1){V(new Rv(m,1));return}if(I===0){V(new au(e.pageId,A.offerId,`${m}
${U}`,1));return}},[e,A,m,U,I]);return z(RN,Y=>{const te=Y.getParser();S(te.result),te.result===0?K():Fs(new Bl(-1))}),_.useEffect(()=>{if(!e||!e.offers.length)return;const Y=e.offers[0];N(Y),s(f6(Y.localizationId)),E(!1)},[e,N]),_.useEffect(()=>{if(!A)return;const Y=A.product.productData;if(Y){if(B)for(const te of B){if(te.breed!==Y.type)continue;const ne=[];for(const J of te.palettes)J.sellable&&ne.push(J);l(ne.length?0:-1),i(ne);return}l(-1),i([]),V(new sy(Y.type))}},[A,B]),_.useEffect(()=>{if(t===-1)return;const Y=m6(t,r);d(Y.length?0:-1),u(Y)},[t,r]),_.useEffect(()=>{if(!b||(b.reset(!1),t===-1||!r.length||a===-1))return;let Y=`${t} ${r[a].paletteId}`;t<=7&&(Y+=` ${w.toString(16)}`),b.addPetIntoRoom(Y)},[b,t,r,a,w]),_.useEffect(()=>{S(-1)},[m]),A?g(ge,{children:[o(D,{size:7,overflow:"hidden",children:g(Ot,{columnCount:5,children:[!f&&r.length>0&&r.map((Y,te)=>o(Qe,{itemActive:a===te,onClick:ne=>l(te),children:o(cn,{typeId:t,paletteId:Y.paletteId,direction:2,headOnly:!0})},te)),f&&c.length>0&&c.map((Y,te)=>o(Qe,{itemHighlight:!0,itemActive:h===te,itemColor:sr.int2rgb(Y[0]),className:"clear-bg",onClick:ne=>d(te)},te))]})}),g(D,{center:!A,size:5,overflow:"hidden",children:[!A&&g(X,{children:[!!e.localization.getImage(1)&&o("img",{alt:"",src:e.localization.getImage(1)}),o(y,{center:!0,dangerouslySetInnerHTML:{__html:e.localization.getText(0)}})]}),A&&g(X,{children:[g(j,{position:"relative",overflow:"hidden",children:[o(Ka,{}),o(Ga,{position:"absolute",className:"bg-muted rounded bottom-1 end-1"}),t>-1&&t<=7&&o(H,{position:"absolute",className:"bottom-1 start-1",onClick:Y=>E(!f),children:o(mT,{className:"fa-icon"})})]}),g(D,{grow:!0,gap:1,children:[o(y,{truncate:!0,children:x}),g(D,{grow:!0,gap:1,children:[o("input",{type:"text",className:"form-control form-control-sm w-100",placeholder:p("widgets.petpackage.name.title"),value:m,onChange:Y=>R(Y.target.value)}),I>0&&o(j,{className:"invalid-feedback d-block m-0",children:G})]}),o(P,{justifyContent:"end",children:o(la,{justifyContent:"end",alignItems:"end"})}),o(Zi,{purchaseCallback:K})]})]})]})]}):null},Q9=n=>{const{offer:e=null,isAvailable:t=!1,daysRequired:s=0,onSelect:r=null}=n,i=_.useCallback(()=>{if(!e||!e.products.length)return"";const l=e.products[0];return Sh.getProductImageUrl(l.productType,l.furniClassId,l.extraParam)},[e]),a=_.useCallback(()=>{if(!e||!e.products.length)return"";const l=e.products[0],c=Sh.getProductCategory(l.productType,l.furniClassId)===2?"wallItem.name."+l.furniClassId:"roomItem.name."+l.furniClassId;return p(c)},[e]);return _.useCallback(()=>{if(!e||!e.products.length)return"";const l=e.products[0],c=Sh.getProductCategory(l.productType,l.furniClassId)===2?"wallItem.desc."+l.furniClassId:"roomItem.desc."+l.furniClassId;return p(c)},[e]),_.useCallback(()=>Math.floor(s/31),[s]),g(Qe,{center:!1,column:!1,alignItems:"center",className:"p-1",children:[o(Sn,{imageUrl:i()}),o(y,{grow:!0,fontWeight:"bold",children:a()}),o(H,{variant:"secondary",onClick:()=>r(e.localizationId),disabled:!t,children:p("catalog.club_gift.select")})]})},J9=n=>{const{purse:e=null}=ko(),{catalogOptions:t=null,setCatalogOptions:s=null}=Ct(),{clubGifts:r=null}=t,{showConfirm:i=null}=Xt(),a=_.useCallback(()=>r?r.giftsAvailable>0?p("catalog.club_gift.available",["amount"],[r.giftsAvailable.toString()]):r.daysUntilNextGift>0?p("catalog.club_gift.days_until_next",["days"],[r.daysUntilNextGift.toString()]):e.isVip?p("catalog.club_gift.not_available"):p("catalog.club_gift.no_club"):"",[r,e]),l=_.useCallback(u=>{i(p("catalog.club_gift.confirm"),()=>{V(new oy(u)),s(h=>(h.clubGifts.giftsAvailable--,{...h}))},null)},[s,i]),c=_.useMemo(()=>r.offers.sort((h,d)=>r.getOfferExtraData(h.offerId).daysRequired-r.getOfferExtraData(d.offerId).daysRequired),[r]);return g(X,{children:[o(y,{truncate:!0,shrink:!0,fontWeight:"bold",children:a()}),o(Ot,{columnCount:1,className:"nitro-catalog-layout-vip-gifts-grid",children:r.offers.length>0&&c.map(u=>o(Q9,{offer:u,isAvailable:r.getOfferExtraData(u.offerId).isSelectable&&r.giftsAvailable>0,onSelect:l,daysRequired:r.getOfferExtraData(u.offerId).daysRequired},u.offerId))})]})},Z9=(n,e)=>{if(!n)return null;const t={page:n,hideNavigation:e};switch(n.layoutCode){case"frontpage_featured":return null;case"frontpage4":return o(H9,{...t});case"pets":return o(q9,{...t});case"pets2":return o(b9,{...t});case"pets3":return o(NL,{...t});case"vip_buy":return o(k9,{...t});case"guild_frontpage":return o(D9,{...t});case"guild_forum":return o(M9,{...t});case"guild_custom_furni":return o(y9,{...t});case"club_gifts":return o(J9,{...t});case"marketplace_own_items":return o(j9,{...t});case"marketplace":return o(X9,{...t});case"single_bundle":return o(U9,{...t});case"room_bundle":return o(L9,{...t});case"spaces_new":return o(G9,{...t});case"trophies":return o(B9,{...t});case"info_loyalty":return o(v9,{...t});case"badge_display":return o(R9,{...t});case"roomads":return o(P9,{...t});case"default_3x3_color_grouping":return o(C9,{...t});case"soundmachine":return o(F9,{...t});case"bots":case"default_3x3":default:return o(A9,{...t})}},$9=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(0),[i,a]=_.useState("0"),{catalogOptions:l=null,setCatalogOptions:c=null}=Ct(),{marketplaceConfiguration:u=null}=l,{showConfirm:h=null}=Xt(),d=I=>{a(I);const S=parseInt(I);isNaN(S)||S===s||r(parseInt(I))};if(z(AC,I=>{const S=I.getParser();c(A=>{const N={...A};return N.marketplaceConfiguration=S,N})}),Ts(QP.POST_MARKETPLACE,I=>t(I.item)),_.useEffect(()=>{!e||u||V(new gM)},[e,u]),_.useEffect(()=>{if(e)return()=>r(0)},[e]),!u||!e)return null;const f=e?p(e.isWallItem?"wallItem.name."+e.type:"roomItem.name."+e.type):"",E=e?p(e.isWallItem?"wallItem.desc."+e.type:"roomItem.desc."+e.type):"",m=()=>Math.max(Math.ceil(u.commission*.01*s),1),R=()=>{!e||s<u.minimumPrice||h(p("inventory.marketplace.confirm_offer.info",["furniname","price"],[f,s.toString()]),()=>{V(new EM(s,e.isWallItem?2:1,e.id)),t(null)},()=>{t(null)},null,null,p("inventory.marketplace.confirm_offer.title"))};return g(Re,{className:"nitro-catalog-layout-marketplace-post-offer",theme:"primary-slim",children:[o(Te,{headerText:p("inventory.marketplace.make_offer.title"),onCloseClick:I=>t(null)}),o(Ee,{overflow:"hidden",children:g(ge,{fullHeight:!0,children:[o(D,{center:!0,className:"bg-muted rounded p-2",size:4,overflow:"hidden",children:o($E,{productType:e.isWallItem?Pe.WALL:Pe.FLOOR,productClassId:e.type,extraData:e.extra.toString()})}),g(D,{size:8,justifyContent:"between",overflow:"hidden",children:[g(D,{grow:!0,gap:1,children:[o(y,{fontWeight:"bold",children:f}),o(y,{truncate:!0,shrink:!0,children:E})]}),g(D,{overflow:"auto",children:[o(y,{italics:!0,children:p("inventory.marketplace.make_offer.expiration_info",["time"],[u.offerTime.toString()])}),g("div",{className:"input-group has-validation",children:[o("input",{className:"form-control form-control-sm",type:"number",min:0,value:i,onChange:I=>d(I.target.value),placeholder:p("inventory.marketplace.make_offer.price_request")}),(s<u.minimumPrice||isNaN(s))&&o(j,{className:"invalid-feedback d-block",children:p("inventory.marketplace.make_offer.min_price",["minprice"],[u.minimumPrice.toString()])}),s>u.maximumPrice&&!isNaN(s)&&o(j,{className:"invalid-feedback d-block",children:p("inventory.marketplace.make_offer.max_price",["maxprice"],[u.maximumPrice.toString()])}),!(s<u.minimumPrice||s>u.maximumPrice||isNaN(s))&&o(j,{className:"invalid-feedback d-block",children:p("inventory.marketplace.make_offer.final_price",["commission","finalprice"],[m().toString(),(s+m()).toString()])})]}),o(H,{disabled:s<u.minimumPrice||s>u.maximumPrice||isNaN(s),onClick:R,children:p("inventory.marketplace.make_offer.post")})]})]})]})})]})},eQ=n=>{const{isVisible:e=!1,setIsVisible:t=null,rootNode:s=null,currentPage:r=null,navigationHidden:i=!1,setNavigationHidden:a=null,activeNodes:l=[],searchResult:c=null,setSearchResult:u=null,openPageByName:h=null,openPageByOfferId:d=null,activateNode:f=null,getNodeById:E}=Ct();return _.useEffect(()=>{const m={linkReceived:R=>{const I=R.split("/");if(!(I.length<2))switch(I[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(S=>!S);return;case"open":if(I.length>2)if(I.length===4)switch(I[2]){case"offerId":d(parseInt(I[3]));return}else h(I[2]);else t(!0);return}},eventUrlPrefix:"catalog/"};return Cs(m),()=>As(m)},[t,d,h]),g(X,{children:[e&&g(Re,{uniqueKey:"catalog",className:"nitro-catalog",style:ce("catalog.headers")?{width:710}:{},children:[o(Te,{headerText:p("catalog.title"),onCloseClick:m=>t(!1)}),o(aa,{children:s&&s.children.length>0&&s.children.map(m=>m.isVisible?o(Yi,{isActive:m.isActive,onClick:R=>{c&&u(null),f(m)},children:g(P,{gap:ce("catalog.tab.icons")?1:0,alignItems:"center",children:[ce("catalog.tab.icons")&&o(TL,{icon:m.iconId}),m.localization]})},m.pageId):null)}),o(Ee,{children:g(ge,{children:[!i&&o(D,{size:3,overflow:"hidden",children:l&&l.length>0&&o(I9,{node:l[0]})}),o(D,{size:i?12:9,overflow:"hidden",children:Z9(r,()=>a(!0))})]})})]}),o(E9,{}),o($9,{})]})},tQ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(""),{chatHistory:i=[]}=m_(),a=_.useRef(null),l=_.useMemo(()=>{if(s.length===0)return i;let c=s.toLowerCase();return i.filter(u=>u.message&&u.message.toLowerCase().includes(c)||u.name&&u.name.toLowerCase().includes(c))},[i,s]);return _.useEffect(()=>{a&&a.current&&e&&(a.current.scrollTop=a.current.scrollHeight)},[e]),_.useEffect(()=>{const c={linkReceived:u=>{const h=u.split("/");if(!(h.length<2))switch(h[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(d=>!d);return}},eventUrlPrefix:"chat-history/"};return Cs(c),()=>As(c)},[]),e?g(Re,{uniqueKey:"chat-history",className:"nitro-chat-history",theme:"primary-slim",children:[o(Te,{headerText:p("room.chathistory.button.text"),onCloseClick:c=>t(!1)}),g(Ee,{innerRef:a,overflow:"hidden",gap:2,children:[o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("generic.search"),value:s,onChange:c=>r(c.target.value)}),o(g_,{rows:l,scrollToBottom:!0,rowRender:c=>g(P,{alignItems:"center",className:"p-1",gap:2,children:[o(y,{variant:"muted",children:c.timestamp}),c.type===Ri.TYPE_CHAT&&g("div",{className:"bubble-container",style:{position:"relative"},children:[c.style===0&&o("div",{className:"user-container-bg",style:{backgroundColor:c.color}}),g("div",{className:`chat-bubble bubble-${c.style} type-${c.chatType}`,style:{maxWidth:"100%"},children:[o("div",{className:"user-container",children:c.imageUrl&&c.imageUrl.length>0&&o("div",{className:"user-image",style:{backgroundImage:`url(${c.imageUrl})`}})}),g("div",{className:"chat-content",children:[o("b",{className:"username mr-1",dangerouslySetInnerHTML:{__html:`${c.name}: `}}),o("span",{className:"message",dangerouslySetInnerHTML:{__html:`${c.message}`}})]})]})]}),c.type===Ri.TYPE_ROOM_INFO&&g(X,{children:[o("i",{className:"icon icon-small-room"}),o(y,{textBreak:!0,wrap:!0,grow:!0,children:c.name})]})]})})]})]}):null},pi=32,to=64,Lc="x0123456789abcdefghijklmnopq";class us{}us.DOOR=0;us.UP=1;us.DOWN=2;us.SET=3;us.UNSET=4;const sQ={x:"101010",0:"0065ff",1:"0091ff",2:"00bcff",3:"00e8ff",4:"00ffea",5:"00ffbf",6:"00ff93",7:"00ff68",8:"00ff3d",9:"19ff00",a:"44ff00",b:"70ff00",c:"9bff00",d:"f2ff00",e:"ffe000",f:"ffb500",g:"ff8900",h:"ff5e00",i:"ff3200",j:"ff0700",k:"ff0023",l:"ff007a",m:"ff00a5",n:"ff00d1",o:"ff00fc",p:"d600ff",q:"aa00ff"};class rQ{constructor(){this._currentAction=us.SET,this._currentHeight=Lc[1]}get currentAction(){return this._currentAction}set currentAction(e){this._currentAction=e}get currentHeight(){return this._currentHeight}set currentHeight(e){this._currentHeight=e}clear(){this._currentAction=us.SET,this._currentHeight=Lc[1]}}class Ku{constructor(e,t){this._height=e,this._isBlocked=t}get height(){return this._height}set height(e){this._height=e}get isBlocked(){return this._isBlocked}set isBlocked(e){this._isBlocked=e}}const iQ=(n,e)=>{let t=n*pi/2-e*pi/2;const s=n*pi/4+e*pi/4;return t=t+1024,[t,s]},nQ=(n,e)=>{const t=n-1024,s=(t/(pi/2)+e/(pi/4))/2,r=(e/(pi/4)-t/(pi/2))/2;return[s,r]},ud=n=>{switch(n=parseInt(n.toString()),n){case 0:return-2;case 1:return-1;case 3:return 1;default:return 0}},Xu=n=>{switch(n){case .25:return 0;case .5:return 1;case 2:return 3;default:return 2}},R_=class uo extends Us{constructor(){const e=pi*to+20,t=pi*to/2+100;super({width:e,height:t,backgroundColor:0,antialias:!0,autoDensity:!0,resolution:1,sharedLoader:!0,sharedTicker:!0}),this._tilemap=[],this._doorLocation=new Ii(0,0),this._width=0,this._height=0,this._isHolding=!1,this._lastUsedTile=new Ii(-1,-1),this._actionSettings=new rQ}initialize(){if(this._isInitialized)return;const e=Fr().getCollection("floor_editor");e&&(this._assetCollection=e,this._tilemapRenderer=new wU(e.baseTexture),this.registerEventListeners(),this.stage.addChild(this._tilemapRenderer),this._isInitialized=!0)}registerEventListeners(){const e=new Ii;this._tilemapRenderer.containsPoint=t=>(this._tilemapRenderer.worldTransform.applyInverse(t,e),this.tileHitDetection(e,!1)),this._tilemapRenderer.on("pointerup",()=>{this._isHolding=!1}),this._tilemapRenderer.on("pointerout",()=>{this._isHolding=!1}),this._tilemapRenderer.on("pointerdown",t=>{if(!(t.data.originalEvent instanceof PointerEvent)&&!(t.data.originalEvent instanceof TouchEvent))return;const s=t.data.originalEvent;if(s instanceof MouseEvent&&s.button===2)return;const r=t.data.global;this.tileHitDetection(r,!0)}),this._tilemapRenderer.on("click",t=>{if(!(t.data.originalEvent instanceof PointerEvent)||t.data.originalEvent.button===2)return;const r=t.data.global;this.tileHitDetection(r,!0,!0)})}tileHitDetection(e,t,s=!1){const r=this._tilemapRenderer.pointsBuf,i=fU,a=r.length;t&&(this._isHolding=!0);for(let l=0;l<a;l+=i){const c=l+i,u=r.slice(l,c),h=pi,d=pi/2,f=Math.floor(e.x),E=Math.floor(e.y),m=u[2],R=u[3],I=m+h/2,S=R+d/2,A=Math.abs(f-I),N=Math.abs(E-S);if(A/(h*.5)+N/(d*.5)<=1){if(this._isHolding){const[M,b]=nQ(m,R);s?this.onClick(M,b):(this._lastUsedTile.x!==M||this._lastUsedTile.y!==b)&&(this._lastUsedTile.x=M,this._lastUsedTile.y=b,this.onClick(M,b))}return!0}}return!1}onClick(e,t){const s=this._tilemap[t][e],r=Lc.indexOf(s.height);let i=0;switch(this._actionSettings.currentAction){case us.DOOR:s.height!=="x"&&(this._doorLocation.x=e,this._doorLocation.y=t,this.renderTiles());return;case us.UP:if(s.height==="x")return;i=r+1;break;case us.DOWN:if(s.height==="x"||r<=1)return;i=r-1;break;case us.SET:i=Lc.indexOf(this._actionSettings.currentHeight);break;case us.UNSET:i=0;break}if(i===-1||r===i)return;i>0&&(e+1>this._width&&(this._width=e+1),t+1>this._height&&(this._height=t+1));const a=Lc[i];a&&(s.isBlocked||(this._tilemap[t][e].height=a,this.renderTiles()))}renderTiles(){this.tilemapRenderer.clear();for(let e=0;e<this._tilemap.length;e++)for(let t=0;t<this.tilemap[e].length;t++){const s=this.tilemap[e][t];let r=s.height;this._doorLocation.x===t&&this._doorLocation.y===e&&(r=uo.TILE_DOOR),s.isBlocked&&(r=uo.TILE_BLOCKED);const[i,a]=iQ(t,e);this._tilemapRenderer.tile(this._assetCollection.getTexture(`floor_editor_${r}`),i,a)}}setTilemap(e,t){this._tilemap=[];const s=e.split("\r");let r=0,i=s.length;for(let a=0;a<i;a++){const l=s[a];if(l.length===0){s.splice(a,1),i=s.length,a--;continue}l.length>r&&(r=l.length)}for(let a=0;a<i;a++){this._tilemap[a]=[];const l=s[a];for(let c=0;c<r;c++){const u=t[a]&&t[a][c]||!1,h=l[c];h!=="x"&&h!=="X"&&h?this._tilemap[a][c]=new Ku(h,u):this._tilemap[a][c]=new Ku("x",u)}for(let c=r;c<to;c++)this.tilemap[a][c]=new Ku("x",!1)}for(let a=i;a<to;a++){this.tilemap[a]||(this.tilemap[a]=[]);for(let l=0;l<to;l++)this.tilemap[a][l]=new Ku("x",!1)}this._width=r,this._height=i}getCurrentTilemapString(){if(this._tilemap[this._height-1][this._width-1].height==="x"){this._width=-1,this._height=-1;for(let s=to-1;s>=0;s--)if(this._tilemap[s])for(let r=to-1;r>=0;r--){if(!this._tilemap[s][r])continue;this._tilemap[s][r].height!=="x"&&(r+1>this._width&&(this._width=r+1),s+1>this._height&&(this._height=s+1))}}const t=[];for(let s=0;s<this._height;s++){const r=[];for(let i=0;i<this._width;i++){const a=this._tilemap[s][i];r[i]=a.height}t[s]=r.join("")}return t.join("\r")}clear(){this._tilemapRenderer.interactive=!1,this._tilemap=[],this._doorLocation.set(-1,-1),this._width=0,this._height=0,this._isHolding=!1,this._lastUsedTile.set(-1,-1),this._actionSettings.clear(),this._tilemapRenderer.clear()}get tilemapRenderer(){return this._tilemapRenderer}get tilemap(){return this._tilemap}get doorLocation(){return this._doorLocation}set doorLocation(e){this._doorLocation=e}get actionSettings(){return this._actionSettings}static get instance(){return uo._INSTANCE||(uo._INSTANCE=new uo),uo._INSTANCE}};R_._INSTANCE=null;R_.TILE_BLOCKED="r_blocked";R_.TILE_DOOR="r_door";let lr=R_;const vL=_.createContext({originalFloorplanSettings:null,setOriginalFloorplanSettings:null,visualizationSettings:null,setVisualizationSettings:null}),aQ=n=>o(vL.Provider,{...n}),cp=()=>_.useContext(vL),oQ=n=>{const{gap:e=1,children:t=null,...s}=n,[r,i]=_.useState(!1),[a,l]=_.useState(!1),{originalFloorplanSettings:c=null,setOriginalFloorplanSettings:u=null,setVisualizationSettings:h=null}=cp(),d=_.useRef(null);z(KA,E=>{const m=E.getParser();u(R=>{const I={...R};return I.reservedTiles=m.blockedTilesMap,lr.instance.setTilemap(I.tilemap,I.reservedTiles),I}),i(!0),d.current.scrollTo(lr.instance.view.width/3,0)}),z(wh,E=>{const m=E.getParser();u(R=>{const I={...R};return I.entryPoint=[m.x,m.y],I.entryPointDir=m.direction,I}),h(R=>{const I={...R};return I.entryPointDir=m.direction,I}),lr.instance.doorLocation=new Ii(m.x,m.y),l(!0)});const f=E=>{const m=d.current;if(m)switch(E){case"up":m.scrollBy({top:-10});break;case"down":m.scrollBy({top:10});break;case"left":m.scrollBy({left:-10});break;case"right":m.scrollBy({left:10});break}};return _.useEffect(()=>()=>{lr.instance.clear(),h(E=>({wallHeight:c.wallHeight,thicknessWall:c.thicknessWall,thicknessFloor:c.thicknessFloor,entryPointDir:E.entryPointDir}))},[c.thicknessFloor,c.thicknessWall,c.wallHeight,h]),_.useEffect(()=>{!a||!r||lr.instance.renderTiles()},[a,r]),_.useEffect(()=>{V(new KD),V(new zD),lr.instance.tilemapRenderer.interactive=!0,d.current&&d.current.appendChild(lr.instance.renderer.view)},[]),g(D,{gap:e,...s,children:[g(ge,{overflow:"hidden",gap:1,children:[o(D,{center:!0,size:1,children:o(H,{className:"d-md-none",onClick:E=>f("left"),children:o(ET,{className:"fa-icon"})})}),g(D,{overflow:"hidden",size:10,gap:1,children:[o(P,{justifyContent:"center",className:"d-md-none",children:o(H,{shrink:!0,onClick:E=>f("up"),children:o(mU,{className:"fa-icon"})})}),o(j,{overflow:"auto",innerRef:d}),o(P,{justifyContent:"center",className:"d-md-none",children:o(H,{shrink:!0,onClick:E=>f("down"),children:o(EU,{className:"fa-icon"})})})]}),o(D,{center:!0,size:1,children:o(H,{className:"d-md-none",onClick:E=>f("right"),children:o(pT,{className:"fa-icon"})})})]}),t]})},CI=n=>n.replace(/\r\n|\r|\n/g,`
`).toLowerCase(),lQ=n=>{const{onCloseClick:e=null}=n,[t,s]=_.useState(""),{originalFloorplanSettings:r=null}=cp(),i=()=>{V(new hE(t.split(`
`).join("\r"),r.entryPoint[0],r.entryPoint[1],r.entryPointDir,ud(r.thicknessWall),ud(r.thicknessFloor),r.wallHeight-1))};return pL(()=>{s(CI(r.tilemap))}),g(Re,{theme:"primary-slim",className:"floorplan-import-export",children:[o(Te,{headerText:p("floor.plan.editor.import.export"),onCloseClick:e}),g(Ee,{children:[o("textarea",{className:"h-100",value:t,onChange:a=>s(a.target.value)}),g(P,{justifyContent:"between",children:[o(H,{onClick:a=>s(CI(r.tilemap)),children:p("floor.plan.editor.revert.to.last.received.map")}),o(H,{onClick:i,children:p("floor.plan.editor.save")})]})]})]})},AI=0,qu=16,cQ=0,uQ=26,hQ=n=>{const{visualizationSettings:e=null,setVisualizationSettings:t=null}=cp(),[s,r]=_.useState(us.SET),[i,a]=_.useState(0),l=R=>{r(R),lr.instance.actionSettings.currentAction=R},c=()=>{t(R=>{const I={...R};return I.entryPointDir<7?++I.entryPointDir:I.entryPointDir=0,I})},u=R=>{(isNaN(R)||R<=0)&&(R=0),R>26&&(R=26),a(R),lr.instance.actionSettings.currentHeight=R.toString(36)},h=R=>{t(I=>{const S={...I};return S.thicknessFloor=R,S})},d=R=>{t(I=>{const S={...I};return S.thicknessWall=R,S})},f=R=>{(isNaN(R)||R<=0)&&(R=AI),R>qu&&(R=qu),t(I=>{const S={...I};return S.wallHeight=R,S})},E=()=>{let R=e.wallHeight+1;R>qu&&(R=qu),f(R)},m=()=>{let R=e.wallHeight-1;R<=0&&(R=AI),f(R)};return g(D,{children:[g(P,{gap:1,children:[g(D,{size:5,gap:1,children:[o(y,{bold:!0,children:p("floor.plan.editor.draw.mode")}),g(P,{gap:3,children:[g(P,{gap:1,children:[o(Qe,{itemActive:s===us.SET,onClick:R=>l(us.SET),children:o("i",{className:"icon icon-set-tile"})}),o(Qe,{itemActive:s===us.UNSET,onClick:R=>l(us.UNSET),children:o("i",{className:"icon icon-unset-tile"})})]}),g(P,{gap:1,children:[o(Qe,{itemActive:s===us.UP,onClick:R=>l(us.UP),children:o("i",{className:"icon icon-increase-height"})}),o(Qe,{itemActive:s===us.DOWN,onClick:R=>l(us.DOWN),children:o("i",{className:"icon icon-decrease-height"})})]}),o(Qe,{itemActive:s===us.DOOR,onClick:R=>l(us.DOOR),children:o("i",{className:"icon icon-set-door"})})]})]}),g(D,{alignItems:"center",size:4,children:[o(y,{bold:!0,children:p("floor.plan.editor.enter.direction")}),o("i",{className:`icon icon-door-direction-${e.entryPointDir} cursor-pointer`,onClick:c})]}),g(D,{size:3,children:[o(y,{bold:!0,children:p("floor.editor.wall.height")}),g(P,{alignItems:"center",gap:1,children:[o(gT,{className:"cursor-pointer fa-icon",onClick:m}),o("input",{type:"number",className:"form-control form-control-sm quantity-input",value:e.wallHeight,onChange:R=>f(R.target.valueAsNumber)}),o(fT,{className:"cursor-pointer fa-icon",onClick:E})]})]})]}),g(P,{gap:1,children:[g(D,{size:6,children:[g(y,{bold:!0,children:[p("floor.plan.editor.tile.height"),": ",i]}),o(ws,{className:"nitro-slider",min:cQ,max:uQ,step:1,value:i,onChange:R=>u(R),renderThumb:({style:R,...I},S)=>o("div",{style:{backgroundColor:`#${sQ[S.valueNow.toString(33)]}`,...R},...I,children:S.valueNow})})]}),g(D,{size:6,children:[o(y,{bold:!0,children:p("floor.plan.editor.room.options")}),g(P,{className:"align-items-center",children:[g("select",{className:"form-control form-control-sm",value:e.thicknessWall,onChange:R=>d(parseInt(R.target.value)),children:[o("option",{value:0,children:p("navigator.roomsettings.wall_thickness.thinnest")}),o("option",{value:1,children:p("navigator.roomsettings.wall_thickness.thin")}),o("option",{value:2,children:p("navigator.roomsettings.wall_thickness.normal")}),o("option",{value:3,children:p("navigator.roomsettings.wall_thickness.thick")})]}),g("select",{className:"form-control form-control-sm",value:e.thicknessFloor,onChange:R=>h(parseInt(R.target.value)),children:[o("option",{value:0,children:p("navigator.roomsettings.floor_thickness.thinnest")}),o("option",{value:1,children:p("navigator.roomsettings.floor_thickness.thin")}),o("option",{value:2,children:p("navigator.roomsettings.floor_thickness.normal")}),o("option",{value:3,children:p("navigator.roomsettings.floor_thickness.thick")})]})]})]})]})]})},dQ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(!1),[i,a]=_.useState({tilemap:"",reservedTiles:[],entryPoint:[0,0],entryPointDir:2,wallHeight:-1,thicknessWall:1,thicknessFloor:1}),[l,c]=_.useState({entryPointDir:2,wallHeight:-1,thicknessWall:1,thicknessFloor:1}),u=()=>{V(new hE(lr.instance.getCurrentTilemapString(),lr.instance.doorLocation.x,lr.instance.doorLocation.y,l.entryPointDir,ud(l.thicknessWall),ud(l.thicknessFloor),l.wallHeight-1))},h=()=>{c({wallHeight:i.wallHeight,thicknessWall:i.thicknessWall,thicknessFloor:i.thicknessFloor,entryPointDir:i.entryPointDir}),lr.instance.doorLocation=new Ii(i.entryPoint[0],i.entryPoint[1]),lr.instance.setTilemap(i.tilemap,i.reservedTiles),lr.instance.renderTiles()};return $e(je.DISPOSED,d=>t(!1)),z(xh,d=>{const f=d.getParser();a(E=>{const m={...E};return m.tilemap=f.model,m.wallHeight=f.wallHeight+1,m}),c(E=>{const m={...E};return m.wallHeight=f.wallHeight+1,m})}),z(Gh,d=>{const f=d.getParser();a(E=>{const m={...E};return m.thicknessFloor=Xu(f.thicknessFloor),m.thicknessWall=Xu(f.thicknessWall),m}),c(E=>{const m={...E};return m.thicknessFloor=Xu(f.thicknessFloor),m.thicknessWall=Xu(f.thicknessWall),m})}),_.useEffect(()=>{const d={linkReceived:f=>{const E=f.split("/");if(!(E.length<2))switch(E[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(m=>!m);return}},eventUrlPrefix:"floor-editor/"};return Cs(d),()=>As(d)},[]),_.useEffect(()=>{lr.instance.initialize()},[]),g(aQ,{value:{originalFloorplanSettings:i,setOriginalFloorplanSettings:a,visualizationSettings:l,setVisualizationSettings:c},children:[e&&g(Re,{uniqueKey:"floorpan-editor",className:"nitro-floorplan-editor",theme:"primary-slim",children:[o(Te,{headerText:p("floor.plan.editor.title"),onCloseClick:()=>t(!1)}),g(Ee,{overflow:"hidden",children:[o(hQ,{}),o(oQ,{overflow:"hidden"}),g(P,{justifyContent:"between",children:[o(H,{onClick:h,children:p("floor.plan.editor.reload")}),g($n,{children:[o(H,{disabled:!0,children:p("floor.plan.editor.preview")}),o(H,{onClick:d=>r(!0),children:p("floor.plan.editor.import.export")}),o(H,{onClick:u,children:p("floor.plan.editor.save")})]})]})]})]}),s&&o(lQ,{onCloseClick:()=>r(!1)})]})},_Q=n=>{const{friend:e=null}=n,[t,s]=_.useState(!1);Wr();const r=_.useRef();return _.useEffect(()=>{const i=a=>{const l=r.current;l&&a.target!==l&&!l.contains(a.target)&&s(!1)};return document.addEventListener(ie.MOUSE_CLICK,i),()=>document.removeEventListener(ie.MOUSE_CLICK,i)},[]),e?g("div",{ref:r,className:"btn btn-success friend-bar-item "+(t?"friend-bar-item-active":""),onClick:i=>s(a=>!a),children:[g("div",{className:`friend-bar-item-head position-absolute ${e.id>0?"avatar":"group"}`,children:[e.id>0&&o(as,{headOnly:!0,figure:e.figure,direction:2}),e.id<=0&&o(xt,{isGroup:!0,badgeCode:e.figure})]}),o("div",{className:"text-truncate",children:e.name}),t&&g("div",{className:"d-flex justify-content-between",children:[o(j,{className:"nitro-friends-spritesheet icon-friendbar-chat cursor-pointer",onClick:i=>l_(e.id)}),o(j,{className:"nitro-friends-spritesheet icon-profile cursor-pointer",onClick:i=>Sr(e.id)})]})]}):null},j_=3,gQ=n=>{const{onlineFriends:e=null}=n,[t,s]=_.useState(0),r=_.useRef();return g(P,{innerRef:r,alignItems:"center",className:"friend-bar",children:[o(H,{variant:"black",className:"friend-bar-button",disabled:t<=0,onClick:i=>s(t-1),children:o(Ma,{className:"fa-icon"})}),Array.from(Array(j_),(i,a)=>o(_Q,{friend:e[t+a]||null},a)),o(H,{variant:"black",className:"friend-bar-button",disabled:!(e.length>j_&&t+j_<=e.length-1),onClick:i=>s(t+1),children:o(Da,{className:"fa-icon"})})]})},fQ=n=>{const{friend:e=null,selected:t=!1,selectFriend:s=null}=n,[r,i]=_.useState(!1),{followFriend:a=null,updateRelationship:l=null}=Wr(),c=E=>{E.stopPropagation(),a(e)},u=E=>{E.stopPropagation(),l_(e.id)},h=E=>{E.stopPropagation(),i(!0)},d=(E,m)=>{E.stopPropagation(),l(e,m),i(!1)},f=()=>{if(!e)return"none";switch(e.relationshipStatus){case Kr.RELATIONSHIP_HEART:return"heart";case Kr.RELATIONSHIP_SMILE:return"smile";case Kr.RELATIONSHIP_BOBBA:return"bobba";default:return"none"}};return e?g(od,{justifyContent:"between",className:`px-2 py-1 ${t&&"bg-primary text-white"}`,onClick:E=>s(e.id),children:[g(P,{alignItems:"center",gap:1,children:[o(j,{onClick:E=>E.stopPropagation(),children:o(Ci,{userId:e.id})}),o("div",{children:e.name})]}),g(P,{alignItems:"center",gap:1,children:[!r&&g(X,{children:[e.followingAllowed&&o(j,{pointer:!0,onClick:c,className:"nitro-friends-spritesheet icon-follow",title:p("friendlist.tip.follow")}),e.online&&o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-chat",onClick:u,title:p("friendlist.tip.im")}),e.id>0&&o(j,{className:`nitro-friends-spritesheet icon-${f()} cursor-pointer`,onClick:h,title:p("infostand.link.relationship")})]}),r&&g(X,{children:[o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-heart",onClick:E=>d(E,Kr.RELATIONSHIP_HEART)}),o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-smile",onClick:E=>d(E,Kr.RELATIONSHIP_SMILE)}),o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-bobba",onClick:E=>d(E,Kr.RELATIONSHIP_BOBBA)}),o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-none",onClick:E=>d(E,Kr.RELATIONSHIP_NONE)})]})]})]}):null},NI=n=>{const{list:e=null,selectedFriendsIds:t=null,selectFriend:s=null}=n;return!e||!e.length?null:o(X,{children:e.map((r,i)=>o(fQ,{friend:r,selected:t&&t.indexOf(r.id)>=0,selectFriend:s},i))})},mQ=n=>{const{request:e=null}=n,{requestResponse:t=null}=Wr();return e?g(od,{justifyContent:"between",className:"px-2 py-1",children:[g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:e.id}),o("div",{children:e.name})]}),g(P,{alignItems:"center",gap:1,children:[o(j,{className:"nitro-friends-spritesheet icon-accept cursor-pointer",onClick:s=>t(e.id,!0)}),o(j,{className:"nitro-friends-spritesheet icon-deny cursor-pointer",onClick:s=>t(e.id,!1)})]})]}):null},EQ=n=>{const{children:e=null,...t}=n,{requests:s=[],requestResponse:r=null}=Wr();return s.length?g(ld,{...t,children:[g(D,{fullHeight:!0,justifyContent:"between",gap:1,children:[o(D,{gap:0,children:s.map((i,a)=>o(mQ,{request:i},a))}),o(P,{justifyContent:"center",className:"px-2 py-1",children:o(H,{onClick:i=>r(-1,!1),children:p("friendlist.requests.dismissall")})})]}),e]}):null},pQ=n=>{const{selectedFriendsIds:e=null,removeFriendsText:t=null,removeSelectedFriends:s=null,onCloseClick:r=null}=n;return g(Re,{className:"nitro-friends-remove-confirmation",theme:"primary-slim",children:[o(Te,{headerText:p("friendlist.removefriendconfirm.title"),onCloseClick:r}),g(Ee,{className:"text-black",children:[o("div",{children:t}),g(P,{gap:1,children:[o(H,{fullWidth:!0,variant:"danger",disabled:e.length===0,onClick:s,children:p("generic.ok")}),o(H,{fullWidth:!0,onClick:r,children:p("generic.cancel")})]})]})]})},IQ=n=>{const{selectedFriendsIds:e=null,onCloseClick:t=null,sendRoomInvite:s=null}=n,[r,i]=_.useState("");return g(Re,{className:"nitro-friends-room-invite",uniqueKey:"nitro-friends-room-invite",theme:"primary-slim",children:[o(Te,{headerText:p("friendlist.invite.title"),onCloseClick:t}),g(Ee,{className:"text-black",children:[p("friendlist.invite.summary",["count"],[e.length.toString()]),o("textarea",{className:"form-control",value:r,maxLength:255,onChange:a=>i(a.target.value)}),o(y,{center:!0,className:"bg-muted rounded p-1",children:p("friendlist.invite.note")}),g(P,{gap:1,children:[o(H,{fullWidth:!0,variant:"success",disabled:r.length===0||e.length===0,onClick:()=>s(r),children:p("friendlist.invite.send")}),o(H,{fullWidth:!0,onClick:t,children:p("generic.cancel")})]})]})]})},TQ=n=>{const{...e}=n,[t,s]=_.useState(""),[r,i]=_.useState(null),[a,l]=_.useState(null),{canRequestFriend:c=null,requestFriend:u=null}=Wr();return z(US,h=>{const d=h.getParser();i(d.friends),l(d.others)}),_.useEffect(()=>{if(!t||!t.length)return;const h=setTimeout(()=>{!t||!t.length||V(new my(t))},500);return()=>clearTimeout(h)},[t]),g(ld,{...e,children:[o("input",{type:"text",className:"search-input form-control form-control-sm w-100 rounded-0",placeholder:p("generic.search"),value:t,maxLength:50,onChange:h=>s(h.target.value)}),g(D,{children:[r&&g(X,{children:[r.length===0&&o(y,{bold:!0,small:!0,className:"px-2 py-1",children:p("friendlist.search.nofriendsfound")}),r.length>0&&g(D,{gap:0,children:[o(y,{bold:!0,small:!0,className:"px-2 py-1",children:p("friendlist.search.friendscaption",["cnt"],[r.length.toString()])}),o("hr",{className:"mx-2 mt-0 mb-1 text-black"}),o(D,{gap:0,children:r.map(h=>g(od,{justifyContent:"between",className:"px-2 py-1",children:[g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:h.avatarId}),o("div",{children:h.avatarName})]}),o(P,{alignItems:"center",gap:1,children:h.isAvatarOnline&&o(j,{className:"nitro-friends-spritesheet icon-chat cursor-pointer",onClick:d=>l_(h.avatarId),title:p("friendlist.tip.im")})})]},h.avatarId))})]})]}),a&&g(X,{children:[a.length===0&&o(y,{bold:!0,small:!0,className:"px-2 py-1",children:p("friendlist.search.noothersfound")}),a.length>0&&g(D,{gap:0,children:[o(y,{bold:!0,small:!0,className:"px-2 py-1",children:p("friendlist.search.otherscaption",["cnt"],[a.length.toString()])}),o("hr",{className:"mx-2 mt-0 mb-1 text-black"}),o(D,{gap:0,children:a.map(h=>g(od,{justifyContent:"between",className:"px-2 py-1",children:[g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:h.avatarId}),o("div",{children:h.avatarName})]}),o(P,{alignItems:"center",gap:1,children:c(h.avatarId)&&o(j,{className:"nitro-friends-spritesheet icon-add cursor-pointer",onClick:d=>u(h.avatarId,h.avatarName),title:p("friendlist.tip.addfriend")})})]},h.avatarId))})]})]})]})]})},RQ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState([]),[i,a]=_.useState(!1),[l,c]=_.useState(!1),{onlineFriends:u=[],offlineFriends:h=[],requests:d=[],requestFriend:f=null}=Wr(),E=_.useMemo(()=>{if(!s||!s.length)return"";const S=[];for(const A of s){let N=u.find(L=>L.id===A);N||(N=h.find(L=>L.id===A)),N&&S.push(N.name)}return p("friendlist.removefriendconfirm.userlist",["user_names"],[S.join(", ")])},[h,u,s]),m=_.useCallback(S=>{S<0||r(A=>{const N=[...A],L=N.indexOf(S);return L>-1?N.splice(L,1):N.push(S),N})},[r]),R=S=>{!s.length||!S||!S.length||S.length>255||(V(new Ty(S,s)),a(!1))},I=()=>{s.length!==0&&(r(S=>(V(new py(...S)),[])),c(!1))};return _.useEffect(()=>{const S={linkReceived:A=>{const N=A.split("/");if(!(N.length<2))switch(N[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(L=>!L);return;case"request":if(N.length<4)return;f(parseInt(N[2]),N[3])}},eventUrlPrefix:"friends/"};return Cs(S),()=>As(S)},[f]),e?g(X,{children:[g(Re,{className:"nitro-friends",uniqueKey:"nitro-friends",theme:"primary-slim",children:[o(Te,{headerText:p("friendlist.friends"),onCloseClick:S=>t(!1)}),g(Ee,{overflow:"hidden",gap:1,className:"text-black p-0",children:[g(Dq,{fullHeight:!0,overflow:"hidden",children:[o(ld,{headerText:p("friendlist.friends")+` (${u.length})`,isExpanded:!0,children:o(NI,{list:u,selectedFriendsIds:s,selectFriend:m})}),o(ld,{headerText:p("friendlist.friends.offlinecaption")+` (${h.length})`,children:o(NI,{list:h,selectedFriendsIds:s,selectFriend:m})}),o(EQ,{headerText:p("friendlist.tab.friendrequests")+` (${d.length})`,isExpanded:!0}),o(TQ,{headerText:p("people.search.title")})]}),s&&s.length>0&&g(P,{gap:1,className:"p-1",children:[o(H,{fullWidth:!0,onClick:()=>a(!0),children:p("friendlist.tip.invite")}),o(H,{fullWidth:!0,variant:"danger",onClick:S=>c(!0),children:p("generic.delete")})]})]})]}),i&&o(IQ,{selectedFriendsIds:s,onCloseClick:()=>a(!1),sendRoomInvite:R}),l&&o(pQ,{selectedFriendsIds:s,removeFriendsText:E,onCloseClick:()=>c(!1),removeSelectedFriends:I})]}):null},OQ=n=>{const{thread:e=null,group:t=null}=n,s=_.useMemo(()=>t.type===Oo.GROUP_CHAT&&OP(t.chats[0].extraData),[t]),r=_.useMemo(()=>!e||!t?!1:!!(t.type===Oo.PRIVATE_CHAT&&t.userId===$().userId||s&&t.chats.length&&s.userId===$().userId),[e,t,s]);return!e||!t?null:t.userId?g(P,{fullWidth:!0,justifyContent:r?"end":"start",gap:2,children:[g(j,{shrink:!0,className:"message-avatar",children:[t.type===Oo.PRIVATE_CHAT&&!r&&o(as,{figure:e.participant.figure,direction:2}),s&&!r&&o(as,{figure:s.figure,direction:2})]}),g(j,{className:"bg-light text-black border-radius mb-2 rounded py-1 px-2 messages-group-"+(r?"right":"left"),children:[g(j,{className:"fw-bold",children:[r&&$().userName,!r&&(s?s.username:e.participant.name)]}),t.chats.map((i,a)=>o(j,{className:"text-break",children:i.message},a))]}),r&&o(j,{shrink:!0,className:"message-avatar",children:o(as,{figure:$().figure,direction:4})})]}):o(X,{children:t.chats.map((i,a)=>o(P,{fullWidth:!0,gap:2,justifyContent:"start",children:g(j,{className:"w-100 text-break",children:[i.type===Vi.SECURITY_NOTIFICATION&&g(P,{gap:2,alignItems:"center",className:"bg-light rounded mb-2 px-2 py-1 small text-muted",children:[o(j,{className:"nitro-friends-spritesheet icon-warning flex-shrink-0"}),o(j,{children:i.message})]}),i.type===Vi.ROOM_INVITE&&g(P,{gap:2,alignItems:"center",className:"bg-light rounded mb-2 px-2 py-1 small text-black",children:[o(j,{className:"messenger-notification-icon flex-shrink-0"}),g(j,{children:[p("messenger.invitation")+" ",i.message]})]})]})},a))})},SQ=n=>{const{thread:e=null}=n;return e.setRead(),o(X,{children:e.groups.length>0&&e.groups.map((t,s)=>o(OQ,{thread:e,group:t},s))})},CQ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(-1),[i,a]=_.useState(""),{visibleThreads:l=[],activeThread:c=null,getMessageThread:u=null,sendMessage:h=null,setActiveThreadId:d=null,closeThread:f=null}=uL(),{report:E=null}=Ji(),m=_.useRef(),R=()=>c&&c.participant&&V(new wd(c.participant.id)),I=()=>c&&c.participant&&Sr(c.participant.id),S=()=>{!c||!i.length||(h(c,$().userId,i),a(""))},A=N=>{N.key==="Enter"&&S()};return _.useEffect(()=>{const N={linkReceived:L=>{const M=L.split("/");if(M.length===2){if(M[1]==="open"){t(!0);return}if(M[1]==="toggle"){t(B=>!B);return}const b=u(parseInt(M[1]));if(!b)return;d(b.threadId),t(!0)}},eventUrlPrefix:"friends-messenger/"};return Cs(N),()=>As(N)},[u,d]),_.useEffect(()=>{!e||!c||(m.current.scrollTop=m.current.scrollHeight)},[e,c]),_.useEffect(()=>{if(e&&!c){s>0?d(s):l.length>0&&d(l[0].threadId);return}!e&&c&&(r(c.threadId),d(-1))},[e,c,s,l,d]),e?g(Re,{className:"nitro-friends-messenger",uniqueKey:"nitro-friends-messenger",theme:"primary-slim",children:[o(Te,{headerText:p("messenger.window.title",["OPEN_CHAT_COUNT"],[l.length.toString()]),onCloseClick:N=>t(!1)}),o(Ee,{children:g(ge,{overflow:"hidden",children:[g(D,{size:4,overflow:"hidden",children:[o(y,{bold:!0,children:p("toolbar.icon.label.messenger")}),o(D,{fit:!0,overflow:"auto",children:o(D,{children:l&&l.length>0&&l.map(N=>g(Qe,{itemActive:c===N,onClick:L=>d(N.threadId),children:[N.unread&&o(So,{count:N.unreadCount}),g(P,{fullWidth:!0,alignItems:"center",gap:1,children:[g(P,{alignItems:"center",className:"friend-head px-1",children:[N.participant.id>0&&o(as,{figure:N.participant.figure,headOnly:!0,direction:3}),N.participant.id<=0&&o(xt,{isGroup:!0,badgeCode:N.participant.figure})]}),o(y,{truncate:!0,grow:!0,children:N.participant.name})]})]},N.threadId))})})]}),o(D,{size:8,overflow:"hidden",children:c&&g(X,{children:[o(y,{bold:!0,center:!0,children:p("messenger.window.separator",["FRIEND_NAME"],[c.participant.name])}),g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[g(P,{gap:1,children:[g($n,{children:[o(H,{onClick:R,children:o(j,{className:"nitro-friends-spritesheet icon-follow"})}),o(H,{onClick:I,children:o(j,{className:"nitro-friends-spritesheet icon-profile-sm"})})]}),o(H,{variant:"danger",onClick:()=>E(bt.IM,{reportedUserId:c.participant.id}),children:p("messenger.window.button.report")})]}),o(H,{onClick:N=>f(c.threadId),children:o(ei,{className:"fa-icon"})})]}),o(D,{fit:!0,className:"bg-muted p-2 rounded chat-messages",children:o(D,{innerRef:m,overflow:"auto",children:o(SQ,{thread:c})})}),g(P,{gap:1,children:[o("input",{type:"text",className:"form-control form-control-sm",maxLength:255,placeholder:p("messenger.window.input.default",["FRIEND_NAME"],[c.participant.name]),value:i,onChange:N=>a(N.target.value),onKeyDown:A}),o(H,{variant:"success",onClick:S,children:p("widgets.chatinput.say")})]})]})})]})})]}):null},AQ=n=>{const{settings:e=null,onlineFriends:t=[]}=Wr();return e?g(X,{children:[tm.createPortal(o(gQ,{onlineFriends:t}),document.getElementById("toolbar-friend-bar-container")),o(RQ,{}),o(CQ,{})]}):null},NQ=[0,1,2,3,4,5,6,7,8],yQ=n=>{const{badgeParts:e=[],setBadgeParts:t=null}=n,[s,r]=_.useState(-1),{groupCustomize:i=null}=bu(),a=(l,c,u)=>{const h=[...e];h[l][c]=u,t(h),c==="key"&&r(-1)};return!e||!e.length?null:g(X,{children:[s<0&&e&&e.length>0&&e.map((l,c)=>g(P,{alignItems:"center",justifyContent:"between",gap:2,className:"bg-muted rounded px-2 py-1",children:[g(P,{pointer:!0,center:!0,className:"bg-muted rounded p-1",onClick:u=>r(c),children:[e[c].code&&e[c].code.length>0&&o(xt,{badgeCode:e[c].code,isGroup:!0}),(!e[c].code||!e[c].code.length)&&o(P,{center:!0,className:"badge-image group-badge",children:o(Qc,{className:"fa-icon"})})]}),l.type!==br.BASE&&o(ge,{gap:1,columnCount:3,children:NQ.map((u,h)=>o(j,{pointer:!0,className:`group-badge-position-swatch ${e[c].position===u?"active":""}`,onClick:d=>a(c,"position",u)},h))}),o(ge,{gap:1,columnCount:8,children:i.badgePartColors.length>0&&i.badgePartColors.map((u,h)=>o(j,{pointer:!0,className:`group-badge-color-swatch ${e[c].color===h+1?"active":""}`,style:{backgroundColor:"#"+u.color},onClick:d=>a(c,"color",h+1)},h))})]},c)),s>=0&&g(ge,{gap:1,columnCount:5,children:[e[s].type===br.SYMBOL&&o(D,{pointer:!0,center:!0,className:"bg-muted rounded p-1",onClick:l=>a(s,"key",0),children:o(P,{center:!0,className:"badge-image group-badge",children:o(ei,{className:"fa-icon"})})}),(e[s].type===br.BASE?i.badgeBases:i.badgeSymbols).map((l,c)=>o(D,{pointer:!0,center:!0,className:"bg-muted rounded p-1",onClick:u=>a(s,"key",l.id),children:o(xt,{badgeCode:br.getCode(e[s].type,l.id,e[s].color,4),isGroup:!0})},c))]})]})},bL=n=>{const{groupData:e=null,setGroupData:t=null,setCloseAction:s=null,skipDefault:r=null}=n,[i,a]=_.useState(null),{groupCustomize:l=null}=bu(),c=()=>{if(!i||!i.length)return"";let h="";return i.forEach(d=>d.code&&(h+=d.code)),h},u=_.useCallback(()=>{if(!e||!i||!i.length)return!1;if(e.groupBadgeParts===i)return!0;if(e.groupId<=0)return t(d=>{const f={...d};return f.groupBadgeParts=i,f}),!0;const h=[];return i.forEach(d=>{d.code&&(h.push(d.key),h.push(d.color),h.push(d.position))}),V(new xy(e.groupId,h)),!0},[e,i,t]);return _.useEffect(()=>{if(e.groupBadgeParts)return;const h=[new br(br.BASE,l.badgeBases[0].id,l.badgePartColors[0].id),new br(br.SYMBOL,0,l.badgePartColors[0].id),new br(br.SYMBOL,0,l.badgePartColors[0].id),new br(br.SYMBOL,0,l.badgePartColors[0].id),new br(br.SYMBOL,0,l.badgePartColors[0].id)];t(d=>({...d,groupBadgeParts:h}))},[e.groupBadgeParts,l,t]),_.useEffect(()=>{if(e.groupId<=0){a(e.groupBadgeParts?[...e.groupBadgeParts]:null);return}a(e.groupBadgeParts)},[e]),_.useEffect(()=>(s({action:u}),()=>s(null)),[s,u]),g(ge,{overflow:"hidden",gap:1,children:[o(D,{size:2,children:o(P,{center:!0,className:"bg-muted rounded p-1",children:o(xt,{badgeCode:c(),isGroup:!0})})}),o(D,{size:10,overflow:"auto",children:o(yQ,{badgeParts:i,setBadgeParts:a})})]})},PL=n=>{const{groupData:e=null,setGroupData:t=null,setCloseAction:s=null}=n,[r,i]=_.useState(null),{groupCustomize:a=null}=bu(),l=h=>h===0?a.groupColorsA.find(d=>d.id===r[h]).color:a.groupColorsB.find(d=>d.id===r[h]).color,c=(h,d)=>{i(f=>{const E=[...f];return E[h]=d,E})},u=_.useCallback(()=>!e||!r||!r.length?!1:e.groupColors===r?!0:e.groupId<=0?(t(h=>{const d={...h};return d.groupColors=[...r],d}),!0):(V(new wy(e.groupId,r[0],r[1])),!0),[e,r,t]);return _.useEffect(()=>{if(!a.groupColorsA||!a.groupColorsB||e.groupColors)return;const h=[a.groupColorsA[0].id,a.groupColorsB[0].id];t(d=>({...d,groupColors:h}))},[a,e.groupColors,t]),_.useEffect(()=>{if(e.groupId<=0){i(e.groupColors?[...e.groupColors]:null);return}i(e.groupColors)},[e]),_.useEffect(()=>(s({action:u}),()=>s(null)),[s,u]),r?g(ge,{overflow:"hidden",children:[g(D,{size:2,gap:1,children:[o(y,{bold:!0,children:p("group.edit.color.guild.color")}),e.groupColors&&e.groupColors.length>0&&g(P,{overflow:"hidden",className:"rounded border",children:[o(j,{className:"group-color-swatch",style:{backgroundColor:"#"+l(0)}}),o(j,{className:"group-color-swatch",style:{backgroundColor:"#"+l(1)}})]})]}),g(D,{size:5,gap:1,overflow:"hidden",children:[o(y,{bold:!0,children:p("group.edit.color.primary.color")}),o(Ot,{gap:1,columnCount:7,columnMinWidth:16,columnMinHeight:16,children:e.groupColors&&a.groupColorsA&&a.groupColorsA.map((h,d)=>o("div",{className:$s("group-badge-color-swatch cursor-pointer",e.groupColors[0]===h.id&&"active"),style:{backgroundColor:"#"+h.color},onClick:()=>c(0,h.id)},d))})]}),g(D,{size:5,gap:1,overflow:"hidden",children:[o(y,{bold:!0,children:p("group.edit.color.secondary.color")}),o(Ot,{gap:1,columnCount:7,columnMinWidth:16,columnMinHeight:16,children:e.groupColors&&a.groupColorsB&&a.groupColorsB.map((h,d)=>o("div",{className:$s("group-badge-color-swatch cursor-pointer",e.groupColors[1]===h.id&&"active"),style:{backgroundColor:"#"+h.color},onClick:()=>c(1,h.id)},d))})]})]}):null},MQ=n=>{const{groupData:e=null,setGroupData:t=null,purchaseCost:s=0}=n,{groupCustomize:r=null}=bu(),i=()=>{if(!e||!e.groupBadgeParts||!e.groupBadgeParts.length)return"";let l="";return e.groupBadgeParts.forEach(c=>c.code&&(l+=c.code)),l},a=l=>l===0?r.groupColorsA.find(c=>c.id===e.groupColors[l]).color:r.groupColorsB.find(c=>c.id===e.groupColors[l]).color;return e?g(ge,{overflow:"hidden",gap:1,children:[g(D,{size:3,children:[g(D,{center:!0,className:"bg-muted rounded p-1",gap:2,children:[o(y,{bold:!0,center:!0,children:p("group.create.confirm.guildbadge")}),o(xt,{badgeCode:i(),isGroup:!0})]}),g(D,{center:!0,className:"bg-muted rounded p-1",gap:2,children:[o(y,{bold:!0,center:!0,children:p("group.edit.color.guild.color")}),g(P,{overflow:"hidden",className:"rounded border",children:[o(j,{className:"group-color-swatch",style:{backgroundColor:"#"+a(0)}}),o(j,{className:"group-color-swatch",style:{backgroundColor:"#"+a(1)}})]})]})]}),g(D,{size:9,justifyContent:"between",children:[g(D,{children:[g(D,{gap:1,children:[o(y,{bold:!0,children:e.groupName}),o(y,{children:e.groupDescription})]}),o(y,{overflow:"auto",children:p("group.create.confirm.info")})]}),o(y,{center:!0,variant:"white",className:"bg-primary rounded p-1",children:p("group.create.confirm.buyinfo",["amount"],[s.toString()])})]})]}):null},LL=n=>{const{groupData:e=null,setGroupData:t=null,setCloseAction:s=null,onClose:r=null,isCreator:i=!1,availableRooms:a=[]}=n,[l,c]=_.useState(""),[u,h]=_.useState(""),[d,f]=_.useState(-1),{showConfirm:E=null}=Xt(),m=()=>{!e||e.groupId<=0||E(p("group.deleteconfirm.desc"),()=>{V(new by(e.groupId)),r&&r()},null,null,null,p("group.deleteconfirm.title"))},R=_.useCallback(()=>!e||!l||!l.length?!1:l===e.groupName&&u===e.groupDescription?!0:e.groupId<=0?d<=0?!1:(t(I=>{const S={...I};return S.groupName=l,S.groupDescription=u,S.groupHomeroomId=d,S}),!0):(V(new Gy(e.groupId,l,u||"")),!0),[e,l,u,d,t]);return _.useEffect(()=>{c(e.groupName||""),h(e.groupDescription||""),f(e.groupHomeroomId)},[e]),_.useEffect(()=>(s({action:R}),()=>s(null)),[s,R]),e?g(D,{justifyContent:"between",overflow:"auto",children:[g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o(y,{center:!0,className:"col-3",children:p("group.edit.name")}),o("input",{type:"text",className:"form-control form-control-sm",value:l,maxLength:29,onChange:I=>c(I.target.value)})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{center:!0,className:"col-3",children:p("group.edit.desc")}),o("textarea",{className:"form-control form-control-sm",value:u,maxLength:254,onChange:I=>h(I.target.value)})]}),i&&g(X,{children:[g(P,{alignItems:"center",gap:1,children:[o(y,{center:!0,className:"col-3",children:p("group.edit.base")}),o(D,{fullWidth:!0,gap:1,children:g("select",{className:"form-select form-select-sm",value:d,onChange:I=>f(parseInt(I.target.value)),children:[o("option",{value:-1,disabled:!0,children:p("group.edit.base.select.room")}),a&&a.map((I,S)=>o("option",{value:I.id,children:I.name},S))]})})]}),g(P,{gap:1,children:[o(j,{className:"col-3",children:" "}),o(y,{small:!0,children:p("group.edit.base.warning")})]})]})]}),!i&&o(H,{variant:"danger",onClick:m,children:p("group.delete")}),i&&o(y,{underline:!0,center:!0,fullWidth:!0,pointer:!0,onClick:I=>de("navigator/create"),children:p("group.createroom")})]}):null},DQ=[1,2,3,4],vQ=n=>{const{onClose:e=null}=n,[t,s]=_.useState(1),[r,i]=_.useState(null),[a,l]=_.useState(null),[c,u]=_.useState(null),[h,d]=_.useState(0),f=()=>{i(null),l(null),e&&e()},E=()=>{if(!a)return;const I=[];a.groupBadgeParts.forEach(S=>{S.code&&(I.push(S.key),I.push(S.color),I.push(S.position))}),V(new My(a.groupName,a.groupDescription,a.groupHomeroomId,a.groupColors[0],a.groupColors[1],I))},m=()=>{if(!(r&&r.action&&!r.action())){if(t===1){e();return}s(I=>I-1)}},R=()=>{if(!(r&&r.action&&!r.action())){if(t===4){E();return}s(I=>I===4?I:I+1)}};return z(GS,I=>{const S=I.getParser(),A=[];S.availableRooms.forEach((N,L)=>A.push({id:L,name:N})),u(A),d(S.groupCost)}),_.useEffect(()=>{s(1),l({groupId:-1,groupName:null,groupDescription:null,groupHomeroomId:-1,groupState:1,groupCanMembersDecorate:!0,groupColors:null,groupBadgeParts:null}),V(new Dy)},[l]),a?g(Re,{className:"nitro-group-creator",theme:"primary-slim",children:[o(Te,{headerText:p("group.create.title"),onCloseClick:f}),g(Ee,{children:[o(P,{center:!0,className:"creator-tabs",children:DQ.map((I,S)=>o(P,{center:!0,className:`tab tab-${I===1?"blue-flat":I===4?"yellow":"blue-arrow"} ${t===I?"active":""}`,children:o(y,{variant:"white",children:p(`group.create.steplabel.${I}`)})},S))}),g(D,{overflow:"hidden",children:[g(P,{alignItems:"center",gap:2,children:[o(j,{className:`nitro-group-tab-image tab-${t}`}),g(D,{grow:!0,gap:0,children:[o(y,{bold:!0,fontSize:4,children:p(`group.create.stepcaption.${t}`)}),o(y,{children:p(`group.create.stepdesc.${t}`)})]})]}),g(D,{overflow:"hidden",children:[t===1&&o(LL,{groupData:a,setGroupData:l,setCloseAction:i,onClose:null,isCreator:!0,availableRooms:c}),t===2&&o(bL,{groupData:a,setGroupData:l,setCloseAction:i}),t===3&&o(PL,{groupData:a,setGroupData:l,setCloseAction:i}),t===4&&o(MQ,{groupData:a,setGroupData:l,purchaseCost:h})]}),g(P,{justifyContent:"between",children:[o(H,{variant:"link",className:"text-black",onClick:m,children:p(t===1?"generic.cancel":"group.create.previousstep")}),o(H,{disabled:t===4&&!Io(),variant:t===4?Io()?"success":"danger":"primary",onClick:R,children:p(t===4?Io()?"group.create.confirm.buy":"group.create.confirm.viprequired":"group.create.nextstep")})]})]})]})]}):null},bQ=["regular","exclusive","private"],UL=n=>{const{groupInformation:e=null,onClose:t=null,overflow:s="hidden",...r}=n,{showConfirm:i=null}=Xt(),a=e&&e.ownerName===$().userName,l=()=>e&&JE(e.id),c=()=>{i(p("group.leaveconfirm.desc"),()=>{V(new Gd(e.id,$().userId)),t&&t()},null)},u=()=>e.membershipType===ps.NOT_MEMBER||e.membershipType===ps.REQUEST_PENDING?null:a?o("i",{className:"icon icon-group-owner",title:p("group.youareowner")}):e.isAdmin?o("i",{className:"icon icon-group-admin",title:p("group.youareadmin")}):o("i",{className:"icon icon-group-member",title:p("group.youaremember")}),h=()=>{if(a)return"group.youareowner";if(e.type===Ur.PRIVATE&&e.membershipType!==ps.MEMBER)return"";if(e.membershipType===ps.MEMBER)return"group.leave";if(e.membershipType===ps.NOT_MEMBER&&e.type===Ur.REGULAR)return"group.join";if(e.membershipType===ps.REQUEST_PENDING)return"group.membershippending";if(e.membershipType===ps.NOT_MEMBER&&e.type===Ur.EXCLUSIVE)return"group.requestmembership"},d=()=>{if(!(e.type===Ur.PRIVATE&&e.membershipType===ps.NOT_MEMBER)){if(e.membershipType===ps.MEMBER){c();return}l()}},f=E=>{switch(E){case"members":iI(e.id);break;case"members_pending":iI(e.id,2);break;case"manage":AP(e.id);break;case"homeroom":Wi(e.roomId);break;case"furniture":de("catalog/open/"+ss.GUILD_CUSTOM_FURNI);break;case"popular_groups":de("navigator/search/groups");break}};return e?g(ge,{overflow:s,...r,children:[g(D,{center:!0,size:3,overflow:"hidden",children:[o(P,{alignItems:"center",overflow:"hidden",className:"group-badge",children:o(xt,{badgeCode:e.badge,isGroup:!0,scale:2})}),g(D,{alignItems:"center",gap:1,children:[o(y,{small:!0,underline:!0,pointer:!0,onClick:()=>f("members"),children:p("group.membercount",["totalMembers"],[e.membersCount.toString()])}),e.pendingRequestsCount>0&&o(y,{small:!0,underline:!0,pointer:!0,onClick:()=>f("members_pending"),children:p("group.pendingmembercount",["amount"],[e.pendingRequestsCount.toString()])}),e.isOwner&&o(y,{small:!0,underline:!0,pointer:!0,onClick:()=>f("manage"),children:p("group.manage")})]}),u()]}),g(D,{size:9,justifyContent:"between",overflow:"auto",children:[g(D,{overflow:"hidden",children:[g(D,{gap:1,children:[g(P,{alignItems:"center",gap:2,children:[o(y,{bold:!0,children:e.title}),g(P,{gap:1,children:[o("i",{className:"icon icon-group-type-"+e.type,title:p(`group.edit.settings.type.${bQ[e.type]}.help`)}),e.canMembersDecorate&&o("i",{className:"icon icon-group-decorate",title:p("group.memberscandecorate")})]})]}),o(y,{small:!0,children:p("group.created",["date","owner"],[e.createdAt,e.ownerName])})]}),o(y,{small:!0,overflow:"auto",className:"group-description",children:e.description})]}),g(D,{children:[g(D,{gap:1,children:[o(y,{small:!0,underline:!0,pointer:!0,onClick:()=>f("homeroom"),children:p("group.linktobase")}),o(y,{small:!0,underline:!0,pointer:!0,onClick:()=>f("furniture"),children:p("group.buyfurni")}),o(y,{small:!0,underline:!0,pointer:!0,onClick:()=>f("popular_groups"),children:p("group.showgroups")})]}),(e.type!==Ur.PRIVATE||e.type===Ur.PRIVATE&&e.membershipType===ps.MEMBER)&&o(H,{disabled:e.membershipType===ps.REQUEST_PENDING||a,onClick:d,children:p(h())})]})]})]}):null},PQ=n=>{const[e,t]=_.useState(null);return z(jl,s=>{const r=s.getParser();(e&&e.id===r.id||r.flag)&&t(r)}),e?g(Re,{className:"nitro-group-information-standalone",theme:"primary-slim",children:[o(Te,{headerText:p("group.window.title"),onCloseClick:s=>t(null)}),o(Ee,{children:o(UL,{groupInformation:e,onClose:()=>t(null)})})]}):null},LQ=["regular","exclusive","private"],UQ=n=>{const{groupData:e=null,setGroupData:t=null,setCloseAction:s=null}=n,[r,i]=_.useState(e.groupState),[a,l]=_.useState(e.groupCanMembersDecorate),c=_.useCallback(()=>e?r===e.groupState&&a===e.groupCanMembersDecorate?!0:e.groupId<=0?(t(u=>{const h={...u};return h.groupState=r,h.groupCanMembersDecorate=a,h}),!0):(V(new By(e.groupId,r,a?0:1)),!0):!1,[e,r,a,t]);return _.useEffect(()=>{i(e.groupState),l(e.groupCanMembersDecorate)},[e]),_.useEffect(()=>(s({action:c}),()=>s(null)),[s,c]),g(D,{overflow:"auto",children:[o(D,{children:LQ.map((u,h)=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"groupState",checked:r===h,onChange:d=>i(h)}),g(D,{gap:0,children:[g(P,{gap:1,children:[o("i",{className:`icon icon-group-type-${h}`}),o(y,{bold:!0,children:p(`group.edit.settings.type.${u}.label`)})]}),o(y,{children:p(`group.edit.settings.type.${u}.help`)})]})]},h))}),o(wq,{}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:a,onChange:u=>l(h=>!h)}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("group.edit.settings.rights.caption")}),o(y,{children:p("group.edit.settings.rights.members.help")})]})]})]})},FQ=[1,2,3,5],xQ=n=>{const[e,t]=_.useState(1),[s,r]=_.useState(null),[i,a]=_.useState(null),l=()=>{r(u=>(u&&u.action&&u.action(),null)),a(null)},c=u=>{s&&s.action&&s.action(),t(u)};return z(jl,u=>{const h=u.getParser();!i||i.groupId!==h.id||a(d=>{const f={...d};return f.groupName=h.title,f.groupDescription=h.description,f.groupState=h.type,f.groupCanMembersDecorate=h.canMembersDecorate,f})}),z(HS,u=>{const h=u.getParser(),d=[];h.badgeParts.forEach((f,E)=>{d.push(new Il(f.isBase?Il.BASE:Il.SYMBOL,f.key,f.color,f.position))}),a({groupId:h.id,groupName:h.title,groupDescription:h.description,groupHomeroomId:h.roomId,groupState:h.state,groupCanMembersDecorate:h.canMembersDecorate,groupColors:[h.colorA,h.colorB],groupBadgeParts:d})}),!i||i.groupId<=0?null:g(Re,{className:"nitro-group-manager",children:[o(Te,{headerText:p("group.window.title"),onCloseClick:l}),o(aa,{children:FQ.map(u=>o(Yi,{isActive:e===u,onClick:()=>c(u),children:p(`group.edit.tab.${u}`)},u))}),g(Ee,{children:[g(P,{alignItems:"center",gap:2,children:[o(j,{className:`nitro-group-tab-image tab-${e}`}),g(D,{grow:!0,gap:0,children:[o(y,{bold:!0,fontSize:4,children:p(`group.edit.tabcaption.${e}`)}),o(y,{children:p(`group.edit.tabdesc.${e}`)})]})]}),g(D,{grow:!0,overflow:"hidden",children:[e===1&&o(LL,{groupData:i,setGroupData:a,setCloseAction:r,onClose:l}),e===2&&o(bL,{groupData:i,setGroupData:a,setCloseAction:r,skipDefault:!0}),e===3&&o(PL,{groupData:i,setGroupData:a,setCloseAction:r}),e===5&&o(UQ,{groupData:i,setGroupData:a,setCloseAction:r})]})]})]})},wQ=n=>{const[e,t]=_.useState(-1),[s,r]=_.useState(-1),[i,a]=_.useState(null),[l,c]=_.useState(-1),[u,h]=_.useState(0),[d,f]=_.useState(""),[E,m]=_.useState(null),{showConfirm:R=null}=Xt(),I=M=>{if(M.rank===Ms.OWNER)return"group.members.owner";if(i.admin){if(M.rank===Ms.ADMIN)return"group.members.removerights";if(M.rank===Ms.MEMBER)return"group.members.giverights"}return""},S=_.useCallback(()=>{e===-1||s===-1||l===-1||V(new uf(e,l,d,s))},[e,s,l,d]),A=M=>{!i.admin||M.rank===Ms.OWNER||(M.rank!==Ms.ADMIN?V(new Ay(i.groupId,M.id)):V(new Ny(i.groupId,M.id)),S())},N=M=>{!i.admin||M.rank!==Ms.REQUESTED||(V(new Uy(i.groupId,M.id)),S())},L=M=>{if(i.admin){if(M.rank===Ms.REQUESTED){V(new Fy(i.groupId,M.id)),S();return}m(M.name),V(new vy(i.groupId,M.id))}};return z(kS,M=>{const b=M.getParser();a(b),r(b.level),h(Math.ceil(b.totalMembersCount/b.pageSize))}),z(BS,M=>{const b=M.getParser();R(p(b.furnitureCount>0?"group.kickconfirm.desc":"group.kickconfirm_nofurni.desc",["user","amount"],[E,b.furnitureCount.toString()]),()=>{V(new Gd(i.groupId,b.userId)),S()},null),m(null)}),_.useEffect(()=>{const M={linkReceived:b=>{const B=b.split("/");if(B.length<2)return;const w=parseInt(B[1])||-1,x=parseInt(B[2])||3;t(w),r(x),c(0)},eventUrlPrefix:"group-members/"};return Cs(M),()=>As(M)},[]),_.useEffect(()=>{c(0)},[e,s,d]),_.useEffect(()=>{e===-1||s===-1||l===-1||V(new uf(e,l,d,s))},[e,s,l,d]),_.useEffect(()=>{e!==-1&&(r(-1),a(null),h(0),f(""),m(null))},[e]),e===-1||!i?null:g(Re,{className:"nitro-group-members",theme:"primary-slim",children:[o(Te,{headerText:p("group.members.title",["groupName"],[i?i.groupTitle:""]),onCloseClick:M=>t(-1)}),g(Ee,{overflow:"hidden",children:[g(P,{gap:2,children:[o(P,{center:!0,className:"group-badge",children:o(xt,{badgeCode:i.badge,isGroup:!0,className:"mx-auto d-block"})}),g(D,{fullWidth:!0,gap:1,children:[o("input",{type:"text",className:"form-control form-control-sm w-100",placeholder:p("group.members.searchinfo"),value:d,onChange:M=>f(M.target.value)}),g("select",{className:"form-select form-select-sm w-100",value:s,onChange:M=>r(parseInt(M.target.value)),children:[o("option",{value:"0",children:p("group.members.search.all")}),o("option",{value:"1",children:p("group.members.search.admins")}),o("option",{value:"2",children:p("group.members.search.pending")})]})]})]}),o(ge,{columnCount:2,overflow:"auto",className:"nitro-group-members-list-grid",children:i.result.map((M,b)=>g(P,{gap:2,alignItems:"center",overflow:"hidden",className:"member-list-item bg-white rounded p-2",children:[o("div",{className:"avatar-head cursor-pointer",onClick:()=>Sr(M.id),children:o(as,{figure:M.figure,headOnly:!0,direction:2})}),g(D,{grow:!0,gap:1,children:[o(y,{bold:!0,small:!0,pointer:!0,onClick:B=>Sr(M.id),children:M.name}),M.rank!==Ms.REQUESTED&&o(y,{small:!0,italics:!0,variant:"muted",children:p("group.members.since",["date"],[M.joinedAt])})]}),g(D,{gap:1,children:[M.rank!==Ms.REQUESTED&&o(P,{center:!0,children:o(j,{pointer:i.admin,className:`icon icon-group-small-${M.rank===Ms.OWNER?"owner":M.rank===Ms.ADMIN?"admin":i.admin&&M.rank===Ms.MEMBER?"not-admin":""}`,title:p(I(M)),onClick:B=>A(M)})}),i.admin&&M.rank===Ms.REQUESTED&&o(P,{alignItems:"center",children:o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-accept",title:p("group.members.accept"),onClick:B=>N(M)})}),i.admin&&M.rank!==Ms.OWNER&&M.id!==$().userId&&o(P,{alignItems:"center",children:o(j,{pointer:!0,className:"nitro-friends-spritesheet icon-deny",title:p(M.rank===Ms.REQUESTED?"group.members.reject":"group.members.kick"),onClick:B=>L(M)})})]})]},b))}),g(P,{gap:1,justifyContent:"between",alignItems:"center",children:[o(H,{disabled:i.pageIndex===0,onClick:M=>c(b=>b-1),children:o(Ma,{className:"fa-icon"})}),o(y,{small:!0,children:p("group.members.pageinfo",["amount","page","totalPages"],[i.totalMembersCount.toString(),(i.pageIndex+1).toString(),u.toString()])}),o(H,{disabled:i.pageIndex===u-1,onClick:M=>c(b=>b+1),children:o(Da,{className:"fa-icon"})})]})]})]})},GQ=n=>{const[e,t]=_.useState(!1);return bu(),z(VS,s=>{const r=s.getParser();t(!1),Wi(r.roomId)}),_.useEffect(()=>{const s={linkReceived:r=>{const i=r.split("/");if(!(i.length<2))switch(i[1]){case"create":t(!0);return;case"manage":if(!i[2])return;t(!1),V(new ky(Number(i[2])));return}},eventUrlPrefix:"groups/"};return Cs(s),()=>As(s)},[]),g(X,{children:[e&&o(vQ,{onClose:()=>t(!1)}),!e&&o(xQ,{}),o(wQ,{}),o(PQ,{})]})},BQ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(null),[i,a]=_.useState(0),[l,c]=_.useState(null),{userFigure:u=null}=za(),{purse:h=null,clubStatus:d=null}=ko(),{badgeCodes:f=[],activate:E=null,deactivate:m=null}=p_(),R=()=>h.clubDays<=0?p("purse.clubdays.zero.amount.text"):h.minutesUntilExpiration>-1&&h.minutesUntilExpiration<60*24?Jn.shortFormat(h.minutesUntilExpiration*60):Jn.shortFormat((h.clubPeriods*31+h.clubDays)*86400),I=()=>{switch(d){case wi.ACTIVE:return p(`hccenter.status.${d}.info`,["timeleft","joindate","streakduration"],[R(),s==null?void 0:s.firstSubscriptionDate,Jn.shortFormat((s==null?void 0:s.currentHcStreak)*86400)]);case wi.EXPIRED:return p(`hccenter.status.${d}.info`,["joindate"],[s==null?void 0:s.firstSubscriptionDate]);default:return p(`hccenter.status.${d}.info`)}},S=()=>!s||s.timeUntilPayday<60?p("hccenter.special.time.soon"):Jn.shortFormat(s.timeUntilPayday*60),A=()=>p("hccenter.special.sum",["credits"],[((s==null?void 0:s.creditRewardForStreakBonus)+(s==null?void 0:s.creditRewardForMonthlySpent)).toString()]);if(z(Lm,L=>{const M=L.getParser();a(M.giftsAvailable)}),z(FN,L=>{const M=L.getParser();r(M.data)}),_.useEffect(()=>{const L={linkReceived:M=>{const b=M.split("/");if(!(b.length<2))switch(b[1]){case"open":if(b.length>2)switch(b[2]){case"hccenter":t(!0);break}return}},eventUrlPrefix:"habboUI/"};return Cs(L),()=>As(L)},[]),_.useEffect(()=>{c(oq(f))},[f]),_.useEffect(()=>{if(!e)return;const L=E();return()=>m(L)},[e,E,m]),_.useEffect(()=>{V(new $m),V(new bv)},[]),!e)return null;const N=o(Ah,{id:"popover-basic",children:g(Ah.Body,{className:"text-black py-2 px-3",children:[o("h5",{children:p("hccenter.breakdown.title")}),o("div",{children:p("hccenter.breakdown.creditsspent",["credits"],[s==null?void 0:s.totalCreditsSpent.toString()])}),o("div",{children:p("hccenter.breakdown.paydayfactor.percent",["percent"],[((s==null?void 0:s.kickbackPercentage)*100).toString()])}),o("div",{children:p("hccenter.breakdown.streakbonus",["credits"],[s==null?void 0:s.creditRewardForStreakBonus.toString()])}),o("hr",{className:"w-100 text-black my-1"}),o("div",{children:p("hccenter.breakdown.total",["credits","actual"],[A(),(((s==null?void 0:s.kickbackPercentage)*(s==null?void 0:s.totalCreditsSpent)+(s==null?void 0:s.creditRewardForStreakBonus))*100/100).toString()])}),o("div",{className:"btn btn-link text-primary p-0",onClick:()=>de("habbopages/"+ce("hc.center")["payday.habbopage"]),children:p("hccenter.special.infolink")})]})});return g(Re,{theme:"primary-slim",className:"nitro-hc-center",children:[o(Te,{headerText:p("generic.hccenter"),onCloseClick:()=>t(!1)}),g(P,{position:"relative",className:"bg-muted p-2",children:[g(D,{gap:1,children:[o("div",{className:"hc-logo"}),o(P,{children:o(H,{variant:"success",onClick:L=>de("catalog/open/"+ce("catalog.links")["hc.buy_hc"]),children:p(d===wi.ACTIVE?"hccenter.btn.extend":"hccenter.btn.buy")})})]}),o(j,{position:"absolute",className:"end-0 p-4 top-0 habbo-avatar",children:o(as,{figure:u,direction:4,scale:2})})]}),g(Ee,{children:[g(P,{gap:2,children:[o(xt,{badgeCode:l,className:"align-self-center flex-shrink-0 me-1"}),g(D,{size:5,className:"streak-info",gap:0,children:[o(y,{children:p("hccenter.status."+d)}),o(y,{dangerouslySetInnerHTML:{__html:I()}})]})]}),ce("hc.center")["payday.info"]&&g(P,{alignItems:"center",children:[g(D,{className:"rounded-start bg-primary p-2 payday-special mb-1",children:[o("h4",{className:"mb-1",children:p("hccenter.special.title")}),o("div",{children:p("hccenter.special.info")}),o("div",{className:"btn btn-link text-white p-0 mt-auto align-self-baseline",onClick:()=>de("habbopages/"+ce("hc.center")["payday.habbopage"]),children:p("hccenter.special.infolink")})]}),g("div",{className:"payday flex-shrink-0 p-2",children:[o("h5",{className:"mb-2 ms-2",children:p("hccenter.special.time.title")}),g("div",{className:"d-flex flex-row mb-2",children:[o("div",{className:"clock me-2"}),o("h6",{className:"mb-0 align-self-center",children:S()})]}),d===wi.ACTIVE&&g("div",{className:"pe-3",children:[o("h5",{className:"ms-2 mb-1 bolder",children:p("hccenter.special.amount.title")}),g("div",{className:"d-flex flex-column",children:[o("div",{className:"w-100 text-center ms-4n",children:A()}),o(pU,{trigger:["hover","focus"],placement:"left",overlay:N,children:o("div",{className:"btn btn-link align-self-end text-primary",children:p("hccenter.breakdown.infolink")})})]})]})]})]}),ce("hc.center")["gift.info"]&&g("div",{className:"rounded bg-success p-2 d-flex flex-row mb-0",children:[g("div",{children:[o("h4",{className:"mb-1",children:p("hccenter.gift.title")}),o("div",{dangerouslySetInnerHTML:{__html:i>0?p("hccenter.unclaimedgifts",["unclaimedgifts"],[i.toString()]):p("hccenter.gift.info")}})]}),o("button",{className:"btn btn-primary btn-lg align-self-center ms-auto",onClick:()=>de("catalog/open/"+ce("catalog.links")["hc.hc_gifts"]),children:p(d===wi.ACTIVE?"hccenter.btn.gifts.redeem":"hccenter.btn.gifts.view")})]}),ce("hc.center")["benefits.info"]&&g("div",{className:"benefits text-black py-2",children:[o("h5",{className:"mb-1 text-primary",children:p("hccenter.general.title")}),o("div",{className:"mb-2",dangerouslySetInnerHTML:{__html:p("hccenter.general.info")}}),o("button",{className:"btn btn-link p-0 text-primary",onClick:()=>de("habbopages/"+ce("hc.center")["benefits.habbopage"]),children:p("hccenter.general.infolink")})]})]})]})},kQ=n=>{const[e,t]=_.useState(""),{activeReport:s=null,setActiveReport:r=null}=Ji(),i=()=>{e.length<15||r(l=>{const c=Ls.REPORT_SUMMARY;return{...l,message:e,currentStep:c}})},a=()=>{r(l=>({...l,currentStep:l.currentStep-1}))};return g(X,{children:[g(D,{gap:1,children:[o(y,{fontSize:4,children:p("help.emergency.chat_report.subtitle")}),o(y,{children:p("help.cfh.input.text")})]}),o("textarea",{className:"form-control h-100",value:e,onChange:l=>t(l.target.value)}),g(P,{gap:2,justifyContent:"between",children:[o(H,{variant:"secondary",disabled:!(s.reportType===bt.BULLY||s.reportType===bt.EMERGENCY),onClick:a,children:p("generic.back")}),o(H,{disabled:e.length<15,onClick:i,children:p("help.emergency.main.submit.button")})]})]})},VQ=n=>{const{setActiveReport:e=null}=Ji(),t=()=>{e(s=>{const r=Ls.SELECT_USER,i=bt.BULLY;return{...s,currentStep:r,reportType:i}})};return g(X,{children:[g(D,{grow:!0,center:!0,gap:1,children:[o(y,{fontSize:3,children:p("help.main.frame.title")}),o(y,{children:p("help.main.self.description")})]}),g(D,{gap:1,children:[o(H,{onClick:t,children:p("help.main.bully.subtitle")}),o(H,{disabled:!0,children:p("help.main.self.tips.title")})]}),o(H,{variant:"link",textColor:"black",onClick:()=>V(new Zy(!1)),children:p("help.main.my.sanction.status")})]})},HQ=n=>{const{username:e="",onAction:t=null}=n,[s,r]=_.useState(!1),i=()=>{s||(r(!0),V(new GN(e)))};return z(xd,a=>{const l=a.getParser();l&&l.webId===$().userId&&t("close")}),g("div",{className:"d-flex flex-column gap-4 h-100",children:[o("div",{className:"bg-muted rounded p-2 text-center",children:p("tutorial.name_change.info.confirm")}),g("div",{className:"d-flex flex-column align-items-center gap-1 h-100",children:[o("div",{children:p("tutorial.name_change.confirm")}),o("div",{className:"fw-bold",children:e})]}),g("div",{className:"d-flex gap-2",children:[o("button",{className:"btn btn-success w-100",disabled:s,onClick:i,children:p("generic.ok")}),o("button",{className:"btn btn-primary w-100",onClick:()=>t("close"),children:p("cancel")})]})]})},jQ=n=>{const{onAction:e=null}=n;return g("div",{className:"d-flex flex-column gap-4 h-100",children:[o("div",{className:"bg-muted rounded p-2 text-center",children:p("tutorial.name_change.info.main")}),o("div",{className:"fw-bold d-flex align-items-center justify-content-center h-100 w-100",children:p("tutorial.name_change.current",["name"],[$().userName])}),g("div",{className:"d-flex gap-2",children:[o("button",{className:"btn btn-success w-100",onClick:()=>e("start"),children:p("tutorial.name_change.change")}),o("button",{className:"btn btn-primary w-100",onClick:()=>e("confirmation",$().userName),children:p("tutorial.name_change.keep")})]})]})},WQ=0,YQ=2,zQ=3,KQ=4,XQ=5,qQ=6,QQ=n=>{const{onAction:e=null}=n,[t,s]=_.useState(""),[r,i]=_.useState(!1),[a,l]=_.useState(!1),[c,u]=_.useState(null),[h,d]=_.useState([]),f=()=>{t!==""&&(i(!1),d([]),u(null),l(!0),V(new BN(t)))},E=m=>{i(!1),d([]),u(null),s(m)};return z(XO,m=>{l(!1);const R=m.getParser();if(R)switch(R.resultCode){case WQ:i(!0);break;case YQ:u("short");break;case zQ:u("long");break;case KQ:u("invalid");break;case XQ:d(R.nameSuggestions),u("taken");break;case qQ:u("change_not_allowed")}}),g("div",{className:"d-flex flex-column gap-3 h-100",children:[o("div",{children:p("tutorial.name_change.info.select")}),g("div",{className:"d-flex gap-2",children:[o("input",{type:"text",className:"form-control form-control-sm",value:t,onChange:m=>E(m.target.value)}),o("button",{className:"btn btn-primary",disabled:t===""||a,onClick:f,children:p("tutorial.name_change.check")})]}),!c&&!r&&o("div",{className:"bg-muted rounded p-2 text-center",children:p("help.tutorial.name.info")}),c&&o("div",{className:"bg-danger rounded p-2 text-center text-white",children:p(`help.tutorial.name.${c}`,["name"],[t])}),r&&o("div",{className:"bg-success rounded p-2 text-center text-white",children:p("help.tutorial.name.available",["name"],[t])}),h&&o("div",{className:"d-flex flex-column gap-2",children:h.map((m,R)=>o("div",{className:"col bg-muted rounded p-1 cursor-pointer",onClick:()=>E(m),children:m},R))}),g("div",{className:"d-flex gap-2",children:[o("button",{className:"btn btn-success w-100",disabled:!r,onClick:()=>e("confirmation",t),children:p("tutorial.name_change.pick")}),o("button",{className:"btn btn-primary w-100",onClick:()=>e("close"),children:p("cancel")})]})]})},Qu="INIT",W_="INPUT",Y_="CONFIRMATION",JQ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(Qu),[i,a]=_.useState(""),l=(u,h)=>{switch(u){case"start":r(W_);break;case"confirmation":a(h),r(Y_);break;case"close":a(""),t(!1);break}},c=_.useMemo(()=>{switch(s){case Qu:return"tutorial.name_change.title.main";case W_:return"tutorial.name_change.title.select";case Y_:return"tutorial.name_change.title.confirm"}},[s]);return Ts(cd.INIT,u=>{r(Qu),t(!0)}),e?g(Re,{className:"nitro-change-username",theme:"primary-slim",children:[o(Te,{headerText:p(c),onCloseClick:()=>l("close")}),g(Ee,{className:"text-black",children:[s===Qu&&o(jQ,{onAction:l}),s===W_&&o(QQ,{onAction:l}),s===Y_&&o(HQ,{username:i,onAction:l})]})]}):null},ZQ=n=>{const{activeReport:e=null,setActiveReport:t=null}=Ji(),s=()=>{const r=[];switch(e.reportType){case bt.BULLY:case bt.EMERGENCY:case bt.ROOM:{const i=e.roomId<=0?e.reportedChats[0].roomId:e.roomId;e.reportedChats.forEach(a=>r.push(a.webId,a.message)),V(new Qy(e.message,e.cfhTopic,e.reportedUserId,i,r));break}case bt.IM:e.reportedChats.forEach(i=>r.push(i.webId,i.message)),V(new Xy(e.message,e.cfhTopic,e.reportedUserId,r));break;case bt.THREAD:V(new Ky(e.groupId,e.threadId,e.cfhTopic,e.message));break;case bt.MESSAGE:V(new zy(e.groupId,e.threadId,e.messageId,e.cfhTopic,e.message));break;case bt.PHOTO:V(new qy(e.extraData,e.roomId,e.reportedUserId,e.cfhTopic,e.roomObjectId));break}t(null)};return g(X,{children:[g(D,{gap:1,children:[o(y,{fontSize:4,children:p("help.cfh.button.send")}),o(y,{children:p("help.main.summary")})]}),o(H,{variant:"success",onClick:s,children:p("guide.help.request.emergency.submit.button")})]})},$Q=n=>{const{sanctionInfo:e=null,setSanctionInfo:t=null}=Ji(),s=(r,i,a)=>{let l=`help.sanction.${r}`;switch(i){case"ALERT":l=l+".alert";break;case"MUTE":l=l+".mute";break;case"BAN_PERMANENT":l=l+".permban";break;default:if(l=l+".ban",a>24)return l=l+".days",p(l,["days"],[(a/24).toString()])}return p(l,["hours"],[a.toString()])};return e?g(Re,{className:"nitro-help",theme:"primary-slim",children:[o(Te,{headerText:p("help.sanction.info.title"),onCloseClick:()=>t(null)}),o(Ee,{className:"text-black",children:g(ge,{children:[o(D,{center:!0,size:5,overflow:"hidden",children:o(j,{className:"index-image"})}),g(D,{justifyContent:"between",size:7,overflow:"hidden",children:[e.sanctionReason==="cfh.reason.EMPTY"?o("div",{className:"col-12 fw-bold",children:p("help.sanction.current.none")}):g(X,{children:[(e.probationHoursLeft>0||e.isSanctionActive)&&o("div",{className:"col-12 fw-bold",children:p("help.sanction.probation.reminder")}),g("div",{className:`col-12 fw-bold ${e.isSanctionNew?"text-danger":""}`,children:[p("help.sanction.last.sanction")," ",s("current",e.sanctionName,e.sanctionLengthHours)]}),g("div",{className:"col-12",children:[p("generic.start.time")," ",e.sanctionCreationTime]}),g("div",{className:"col-12",children:[p("generic.reason")," ",e.sanctionReason]}),g("div",{className:"col-12",children:[p("help.sanction.probation.days.left")," ",Math.trunc(e.probationHoursLeft/24)+1]})]}),e.hasCustomMute&&!e.isSanctionActive&&o("div",{className:"col-12 fw-bold",children:p("help.sanction.custom.mute")}),e.tradeLockExpiryTime&&e.tradeLockExpiryTime.length>0&&g("div",{className:"col-12 fw-bold",children:[p("trade.locked.until")," ",e.tradeLockExpiryTime]}),o("div",{className:"col-12",children:s("next",e.nextSanctionName,e.nextSanctionLengthHours)}),o(H,{variant:"success",onClick:r=>t(null),children:p("habbo.way.ok.button")})]})]})})]}):null},eJ=n=>{const[e,t]=_.useState([]),{activeReport:s=null,setActiveReport:r=null}=Ji(),{chatHistory:i=[],messengerHistory:a=[]}=m_(),l=_.useMemo(()=>{switch(s.reportType){case bt.BULLY:case bt.EMERGENCY:return i.filter(d=>d.type===Ri.TYPE_CHAT&&d.webId===s.reportedUserId&&d.entityType===Rt.USER);case bt.IM:return a.filter(d=>d.webId===s.reportedUserId&&d.type===Ri.TYPE_IM)}return[]},[s,i,a]),c=d=>{t(f=>{const E=[...f],m=E.indexOf(d);return m>=0?E.splice(m,1):E.push(d),E})},u=()=>{!e||e.length<=0||r(d=>({...d,reportedChats:e,currentStep:Ls.SELECT_TOPICS}))},h=()=>{r(d=>({...d,currentStep:d.currentStep-1}))};return g(X,{children:[g(D,{gap:1,children:[o(y,{fontSize:4,children:p("help.emergency.chat_report.subtitle")}),o(y,{children:p("help.emergency.chat_report.description")})]}),g(D,{gap:1,overflow:"hidden",children:[!l||!l.length&&o(y,{children:p("help.cfh.error.no_user_data")}),l.length>0&&o(Ot,{gap:1,columnCount:1,columnMinHeight:25,overflow:"auto",children:l.map((d,f)=>o(Qe,{onClick:E=>c(d),itemActive:e.indexOf(d)>=0,children:o(y,{children:d.message})},d.id))})]}),g(P,{gap:2,justifyContent:"between",children:[o(H,{variant:"secondary",onClick:h,disabled:s.reportType===bt.IM,children:p("generic.back")}),o(H,{disabled:e.length<=0,onClick:u,children:p("help.emergency.main.submit.button")})]})]})},tJ=n=>{const[e,t]=_.useState(-1),{chatHistory:s=[]}=m_(),{activeReport:r=null,setActiveReport:i=null}=Ji(),a=_.useMemo(()=>{const h=new Map;return s.forEach(d=>{d.type===Ri.TYPE_CHAT&&d.entityType===Rt.USER&&d.webId!==$().userId&&!h.has(d.webId)&&h.set(d.webId,{id:d.webId,username:d.name})}),Array.from(h.values())},[s]),l=h=>{h<=0||i(d=>({...d,reportedUserId:h,currentStep:Ls.SELECT_CHATS}))},c=h=>{t(d=>h===d?-1:h)},u=()=>{i(h=>({...h,currentStep:h.currentStep-1}))};return g(X,{children:[g(D,{gap:1,children:[o(y,{fontSize:4,children:p("help.emergency.main.step.two.title")}),a.length>0&&o(y,{children:p("report.user.pick.user")})]}),g(D,{gap:1,overflow:"hidden",children:[!a.length&&o(y,{children:p("report.user.error.nolist")}),a.length>0&&o(Ot,{columnCount:1,columnMinHeight:25,gap:1,children:a.map((h,d)=>o(Qe,{onClick:f=>c(h.id),itemActive:e===h.id,children:o("span",{dangerouslySetInnerHTML:{__html:h.username}})},h.id))})]}),g(P,{gap:2,justifyContent:"between",children:[o(H,{variant:"secondary",onClick:u,children:p("generic.back")}),o(H,{disabled:e<=0,onClick:()=>l(e),children:p("help.emergency.main.submit.button")})]})]})},sJ=n=>{const[e,t]=_.useState(-1),[s,r]=_.useState(-1),{setActiveReport:i=null}=Ji(),{cfhCategories:a=[]}=sc(),l=()=>{e<0||s<0||i(u=>({...u,cfhCategory:e,cfhTopic:a[e].topics[s].id,currentStep:Ls.INPUT_REPORT_MESSAGE}))},c=()=>{i(u=>({...u,currentStep:u.currentStep-1}))};return g(X,{children:[g(D,{gap:1,children:[o(y,{fontSize:4,children:p("help.emergency.chat_report.subtitle")}),o(y,{children:p("help.cfh.pick.topic")})]}),g(D,{gap:1,overflow:"auto",children:[e<0&&a.map((u,h)=>o(H,{variant:"danger",onClick:d=>t(h),children:p(`help.cfh.reason.${u.name}`)},h)),e>=0&&a[e].topics.map((u,h)=>o(H,{variant:"danger",onClick:d=>r(h),active:s===h,children:p(`help.cfh.topic.${u.id}`)},h))]}),g(P,{gap:2,justifyContent:"between",children:[o(H,{variant:"secondary",onClick:c,children:p("generic.back")}),o(H,{disabled:s<0,onClick:l,children:p("help.emergency.main.submit.button")})]})]})},rJ=n=>{const[e,t]=_.useState(!1),{activeReport:s=null,setActiveReport:r=null,report:i=null}=Ji(),a=()=>{r(null),t(!1)};_.useEffect(()=>{const c={linkReceived:u=>{const h=u.split("/");if(!(h.length<2))switch(h[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(d=>!d);return;case"tour":return;case"report":h.length>=5&&h[2]==="room"&&(parseInt(h[3]),unescape(h.splice(4).join("/")));return}},eventUrlPrefix:"help/"};return Cs(c),()=>As(c)},[]),_.useEffect(()=>{s&&t(!0)},[s]);const l=()=>{if(s)switch(s.currentStep){case Ls.SELECT_USER:return o(tJ,{});case Ls.SELECT_CHATS:return o(eJ,{});case Ls.SELECT_TOPICS:return o(sJ,{});case Ls.INPUT_REPORT_MESSAGE:return o(kQ,{});case Ls.REPORT_SUMMARY:return o(ZQ,{})}return o(VQ,{})};return g(X,{children:[e&&g(Re,{className:"nitro-help",theme:"primary-slim",children:[o(Te,{headerText:p("help.button.cfh"),onCloseClick:a}),o(Ee,{className:"text-black",children:g(ge,{children:[o(D,{center:!0,size:5,overflow:"hidden",children:o(j,{className:"index-image"})}),o(D,{justifyContent:"between",size:7,overflow:"hidden",children:o(l,{})})]})})]}),o($Q,{}),o(JQ,{})]})},yI=n=>{const{badgeCode:e=null,children:t=null,...s}=n,{selectedBadgeCode:r=null,setSelectedBadgeCode:i=null,toggleBadge:a=null,getBadgeId:l=null}=p_(),{isUnseen:c=null}=ti(),u=c(wt.BADGE,l(e));return g(Qe,{itemActive:r===e,itemUnseen:u,onMouseDown:h=>i(e),onDoubleClick:h=>a(r),...s,children:[o(xt,{badgeCode:e}),t]})},iJ=n=>{const[e,t]=_.useState(!1),{badgeCodes:s=[],activeBadgeCodes:r=[],selectedBadgeCode:i=null,isWearingBadge:a=null,canWearBadges:l=null,toggleBadge:c=null,getBadgeId:u=null,activate:h=null,deactivate:d=null}=p_(),{isUnseen:f=null,removeUnseen:E=null}=ti();return _.useEffect(()=>{!i||!f(wt.BADGE,u(i))||E(wt.BADGE,u(i))},[i,f,E,u]),_.useEffect(()=>{if(!e)return;const m=h();return()=>d(m)},[e,h,d]),_.useEffect(()=>(t(!0),()=>t(!1)),[]),g(ge,{children:[o(D,{size:7,overflow:"hidden",children:o(Ot,{columnCount:4,children:s&&s.length>0&&s.map((m,R)=>a(m)?null:o(yI,{badgeCode:m},R))})}),g(D,{className:"justify-content-between",size:5,overflow:"auto",children:[g(D,{overflow:"hidden",gap:2,children:[o(y,{children:p("inventory.badges.activebadges")}),o(Ot,{columnCount:3,children:r&&r.length>0&&r.map((m,R)=>o(yI,{badgeCode:m},R))})]}),!!i&&g(D,{grow:!0,justifyContent:"end",gap:2,children:[g(P,{alignItems:"center",gap:2,children:[o(xt,{shrink:!0,badgeCode:i}),o(y,{children:Au(i)})]}),o(H,{variant:a(i)?"danger":"success",disabled:!a(i)&&!l(),onClick:m=>c(i),children:p(a(i)?"inventory.badges.clearbadge":"inventory.badges.wearbadge")})]})]})]})},up=n=>{const{title:e="",desc:t="",children:s=null,...r}=n;return g(ge,{...r,children:[o(D,{center:!0,size:5,overflow:"hidden",children:o("div",{className:"empty-image"})}),g(D,{justifyContent:"center",size:7,overflow:"hidden",children:[o(y,{fontWeight:"bold",fontSize:5,overflow:"unset",truncate:!0,children:e}),o(y,{overflow:"auto",children:t})]}),s]})},nJ=n=>{const{botItem:e=null,children:t=null,...s}=n,[r,i]=_.useState(!1),{selectedBot:a=null,setSelectedBot:l=null}=hL(),{isUnseen:c=null}=ti(),u=c(wt.BOT,e.botData.id),h=d=>{switch(d.type){case ie.MOUSE_DOWN:l(e),i(!0);return;case ie.MOUSE_UP:i(!1);return;case ie.ROLL_OUT:if(!r||a!==e)return;kf(e);return;case"dblclick":kf(e);return}};return g(Qe,{itemActive:a===e,itemUnseen:u,onMouseDown:h,onMouseUp:h,onMouseOut:h,onDoubleClick:h,...s,children:[o(as,{figure:e.botData.figure,direction:3,headOnly:!0}),t]})},aJ=n=>{const{roomSession:e=null,roomPreviewer:t=null}=n,[s,r]=_.useState(!1),{botItems:i=[],selectedBot:a=null,activate:l=null,deactivate:c=null}=hL(),{isUnseen:u=null,removeUnseen:h=null}=ti();return _.useEffect(()=>{if(!a||!t)return;const d=a.botData,f=ee();let E=f.getRoomInstanceVariable(f.activeRoomId,C.ROOM_WALL_TYPE),m=f.getRoomInstanceVariable(f.activeRoomId,C.ROOM_FLOOR_TYPE),R=f.getRoomInstanceVariable(f.activeRoomId,C.ROOM_LANDSCAPE_TYPE);E=E&&E.length?E:"101",m=m&&m.length?m:"101",R=R&&R.length?R:"1.1",t.reset(!1),t.updateRoomWallsAndFloorVisibility(!0,!0),t.updateObjectRoom(m,E,R),t.addAvatarIntoRoom(d.figure,0)},[t,a]),_.useEffect(()=>{!a||!u(wt.BOT,a.botData.id)||h(wt.BOT,a.botData.id)},[a,u,h]),_.useEffect(()=>{if(!s)return;const d=l();return()=>c(d)},[s,l,c]),_.useEffect(()=>(r(!0),()=>r(!1)),[]),!i||!i.length?o(up,{title:p("inventory.empty.bots.title"),desc:p("inventory.empty.bots.desc")}):g(ge,{children:[o(D,{size:7,overflow:"hidden",children:o(Ot,{columnCount:5,children:i&&i.length>0&&i.map(d=>o(nJ,{botItem:d},d.botData.id))})}),g(D,{size:5,overflow:"auto",children:[o(D,{overflow:"hidden",position:"relative",children:o(d_,{roomPreviewer:t,height:140})}),a&&g(D,{grow:!0,justifyContent:"between",gap:2,children:[o(y,{grow:!0,truncate:!0,children:a.botData.name}),!!e&&o(H,{variant:"success",onClick:d=>kf(a),children:p("inventory.furni.placetoroom")})]})]})]})},oJ=n=>{const{groupItem:e=null,...t}=n,[s,r]=_.useState(!1),{selectedItem:i=null,setSelectedItem:a=null}=Bo(),l=u=>{switch(u.type){case ie.MOUSE_DOWN:a(e),r(!0);return;case ie.MOUSE_UP:r(!1);return;case ie.ROLL_OUT:if(!s||e!==i)return;Ul(e);return;case"dblclick":Ul(e);return}},c=e.getUnlockedCount();return o(Qe,{className:c?"":"opacity-0-5 ",itemImage:e.iconUrl,itemCount:e.getUnlockedCount(),itemActive:e===i,itemUniqueNumber:e.stuffData.uniqueNumber,itemUnseen:e.hasUnseenItems,onMouseDown:l,onMouseUp:l,onMouseOut:l,onDoubleClick:l,...t})},FL=n=>{const{groupItems:e=[],setGroupItems:t=null}=n,[s,r]=_.useState("");return _.useEffect(()=>{let i=[...e];if(s&&s.length){const a=s.toLocaleLowerCase();i=e.filter(l=>a&&a.length&&l.name.toLocaleLowerCase().includes(a)?l:null)}t(i)},[e,t,s]),g(P,{gap:1,children:[o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("generic.search"),value:s,onChange:i=>r(i.target.value)}),o(H,{variant:"primary",children:o(rm,{className:"fa-icon"})})]})},lJ=n=>{const e=n.getLastItem();if(!e||!e.sellable)return!1;Fs(new QP(e))},cJ=n=>{const{roomSession:e=null,roomPreviewer:t=null}=n,[s,r]=_.useState(!1),[i,a]=_.useState([]),{groupItems:l=[],selectedItem:c=null,activate:u=null,deactivate:h=null}=Bo(),{resetItems:d=null}=ti();return _.useEffect(()=>{if(!c||!t)return;const f=c.getLastItem();if(!f)return;const E=ee();let m=E.getRoomInstanceVariable(E.activeRoomId,C.ROOM_WALL_TYPE),R=E.getRoomInstanceVariable(E.activeRoomId,C.ROOM_FLOOR_TYPE),I=E.getRoomInstanceVariable(E.activeRoomId,C.ROOM_LANDSCAPE_TYPE);if(m=m&&m.length?m:"101",R=R&&R.length?R:"101",I=I&&I.length?I:"1.1",t.reset(!1),t.updateObjectRoom(R,m,I),t.updateRoomWallsAndFloorVisibility(!0,!0),f.category===he.WALL_PAPER||f.category===he.FLOOR||f.category===he.LANDSCAPE){if(R=f.category===he.FLOOR?c.stuffData.getLegacyString():R,m=f.category===he.WALL_PAPER?c.stuffData.getLegacyString():m,I=f.category===he.LANDSCAPE?c.stuffData.getLegacyString():I,t.updateObjectRoom(R,m,I),f.category===he.LANDSCAPE){const S=$().getWallItemDataByName("window_double_default");S&&t.addWallItemIntoRoom(S.id,new F(90,0,0),S.customParams)}}else c.isWallItem?t.addWallItemIntoRoom(c.type,new F(90),f.stuffData.getLegacyString()):t.addFurnitureIntoRoom(c.type,new F(90),c.stuffData,f.extra.toString())},[t,c]),_.useEffect(()=>{!c||!c.hasUnseenItems||(d(wt.FURNI,c.items.map(f=>f.id)),c.hasUnseenItems=!1)},[c,d]),_.useEffect(()=>{if(!s)return;const f=u();return()=>h(f)},[s,u,h]),_.useEffect(()=>(r(!0),()=>r(!1)),[]),!l||!l.length?o(up,{title:p("inventory.empty.title"),desc:p("inventory.empty.desc")}):g(ge,{children:[g(D,{size:7,overflow:"hidden",children:[o(FL,{groupItems:l,setGroupItems:a}),o(Ot,{columnCount:5,children:i&&i.length>0&&i.map((f,E)=>o(oJ,{groupItem:f},E))})]}),g(D,{size:5,overflow:"auto",children:[g(D,{overflow:"hidden",position:"relative",children:[o(d_,{roomPreviewer:t,height:140}),c&&c.stuffData.isUnique&&o(YP,{className:"top-2 end-2",position:"absolute",uniqueNumber:c.stuffData.uniqueNumber,uniqueSeries:c.stuffData.uniqueSeries}),c&&c.stuffData.rarityLevel>-1&&o(rp,{className:"top-2 end-2",position:"absolute",level:c.stuffData.rarityLevel})]}),c&&g(D,{grow:!0,justifyContent:"between",gap:2,children:[o(y,{grow:!0,truncate:!0,children:c.name}),g(D,{gap:1,children:[!!e&&o(H,{variant:"success",onClick:f=>Ul(c),children:p("inventory.furni.placetoroom")}),c&&c.isSellable&&o(H,{onClick:f=>lJ(c),children:p("inventory.marketplace.sell")})]})]})]})]})},z_=9,uJ=n=>{const{cancelTrade:e=null}=n,[t,s]=_.useState(null),[r,i]=_.useState(null),[a,l]=_.useState(null),[c,u]=_.useState(null),[h,d]=_.useState(3),[f,E]=_.useState(1),{ownUser:m=null,otherUser:R=null,groupItems:I=[],tradeState:S=qt.TRADING_STATE_READY,progressTrade:A=null,removeItem:N=null,setTradeState:L=null}=_L(),{simpleAlert:M=null}=Xt(),b=(G,K,Y,te,ne)=>{if(!m||m.accepts||!m.userItems)return!1;if(m.userItems.length<z_)return!0;if(!te)return!1;let J=K.toString();return Y===he.POSTER?J=J+"poster"+ne.getLegacyString():Y===he.GUILD_FURNI?J=k6(K,ne):J=(G?"I":"S")+J,!!m.userItems.getValue(J)},B=G=>{if(!t)return;const K=t.getTradeItems(G);if(!K||!K.length)return;let Y=null;const te=[];for(const J of K)te.push(J.id),Y||(Y=J);if(m.userItems.length+te.length<=1500)if(!Y.isGroupable&&te.length)V(new _f(te.pop()));else{const J=[];for(const Ce of te)b(Y.isWallItem,Y.type,Y.category,Y.isGroupable,Y.stuffData)&&J.push(Ce);J.length&&(J.length===1?V(new _f(J.pop())):V(new oM(...J)))}else M(p("trading.items.too_many_items.desc"),Le.DEFAULT,null,null,p("trading.items.too_many_items.title"))},w=G=>G?o(_T,{className:"text-success fa-icon"}):o(IU,{className:"text-danger fa-icon"}),x=(G,K)=>{(isNaN(Number(G))||Number(G)<0||!G)&&(G=1),G=Math.max(Number(G),1),G=Math.min(Number(G),K),G!==f&&E(G)},U=G=>{x(f,G),B(f)};return _.useEffect(()=>{E(1)},[t]),_.useEffect(()=>{if(S!==qt.TRADING_STATE_COUNTDOWN)return;d(3);const G=setInterval(()=>{d(K=>{const Y=K-1;return Y===0&&clearInterval(G),Y})},1e3);return()=>clearInterval(G)},[S,L]),_.useEffect(()=>{h===0&&L(qt.TRADING_STATE_CONFIRMING)},[h,L]),S===qt.TRADING_STATE_READY||!m||!R?null:g(ge,{children:[g(D,{size:4,overflow:"hidden",children:[o(FL,{groupItems:I,setGroupItems:u}),g(P,{column:!0,fullHeight:!0,justifyContent:"between",overflow:"hidden",gap:2,children:[o(Ot,{columnCount:3,children:c&&c.length>0&&c.map((G,K)=>{const Y=G.getUnlockedCount();return o(Qe,{className:Y?"":"opacity-0-5 ",itemImage:G.iconUrl,itemCount:Y,itemActive:t===G,itemUniqueNumber:G.stuffData.uniqueNumber,onClick:te=>Y&&s(G),onDoubleClick:te=>B(1),children:Y>0&&t===G&&o(H,{position:"absolute",variant:"success",className:"trade-button bottom-1 end-1",onClick:te=>B(1),children:o(Da,{className:"fa-icon"})})},K)})}),g(D,{gap:1,alignItems:"end",children:[g(ge,{overflow:"hidden",children:[o(D,{size:6,overflow:"hidden",children:o("input",{type:"number",className:"form-control form-control-sm quantity-input",placeholder:p("catalog.bundlewidget.spinner.select.amount"),disabled:!t,value:f,onChange:G=>E(G.target.valueAsNumber)})}),o(D,{size:6,overflow:"hidden",children:o(H,{variant:"secondary",disabled:!t,onClick:G=>U(t.getUnlockedCount()),children:p("inventory.trading.areoffering")})})]}),o(j,{fullWidth:!0,className:"badge bg-muted",children:t?t.name:p("catalog_selectproduct")})]})]})]}),g(D,{size:8,overflow:"hidden",children:[g(ge,{overflow:"hidden",children:[g(D,{size:6,overflow:"hidden",children:[g(P,{justifyContent:"between",alignItems:"center",children:[g(y,{children:[p("inventory.trading.you")," ",p("inventory.trading.areoffering"),":"]}),w(m.accepts)]}),o(Ot,{columnCount:3,children:Array.from(Array(z_),(G,K)=>{const Y=m.userItems.getWithIndex(K)||null;return Y?o(Qe,{itemActive:r===Y,itemImage:Y.iconUrl,itemCount:Y.getTotalCount(),itemUniqueNumber:Y.stuffData.uniqueNumber,onClick:te=>i(Y),onDoubleClick:te=>N(Y),children:r===Y&&o(H,{position:"absolute",variant:"danger",className:"trade-button bottom-1 start-1",onClick:te=>N(Y),children:o(Ma,{className:"fa-icon"})})},K):o(Qe,{},K)})}),o(j,{fullWidth:!0,className:"badge bg-muted",children:r?r.name:p("catalog_selectproduct")})]}),g(D,{size:6,overflow:"hidden",children:[g(P,{justifyContent:"between",alignItems:"center",children:[g(y,{children:[R.userName," ",p("inventory.trading.isoffering"),":"]}),w(R.accepts)]}),o(Ot,{columnCount:3,children:Array.from(Array(z_),(G,K)=>{const Y=R.userItems.getWithIndex(K)||null;return Y?o(Qe,{itemActive:a===Y,itemImage:Y.iconUrl,itemCount:Y.getTotalCount(),itemUniqueNumber:Y.stuffData.uniqueNumber,onClick:te=>l(Y)},K):o(Qe,{},K)})}),o(j,{fullWidth:!0,className:"badge bg-muted w-100",children:a?a.name:p("catalog_selectproduct")})]})]}),g(P,{grow:!0,justifyContent:"between",children:[o(H,{variant:"danger",onClick:e,children:p("generic.cancel")}),S===qt.TRADING_STATE_READY&&o(H,{variant:"secondary",disabled:!m.itemCount&&!R.itemCount,onClick:A,children:p("inventory.trading.accept")}),S===qt.TRADING_STATE_RUNNING&&o(H,{variant:"secondary",disabled:!m.itemCount&&!R.itemCount,onClick:A,children:p(m.accepts?"inventory.trading.modify":"inventory.trading.accept")}),S===qt.TRADING_STATE_COUNTDOWN&&o(H,{variant:"secondary",disabled:!0,children:p("inventory.trading.countdown",["counter"],[h.toString()])}),S===qt.TRADING_STATE_CONFIRMING&&o(H,{variant:"secondary",onClick:A,children:p("inventory.trading.button.restore")}),S===qt.TRADING_STATE_CONFIRMED&&o(H,{variant:"secondary",children:p("inventory.trading.info.waiting")})]})]})]})},hJ=n=>{const{petItem:e=null,children:t=null,...s}=n,[r,i]=_.useState(!1),{selectedPet:a=null,setSelectedPet:l=null}=dL(),{isUnseen:c}=ti(),u=c(wt.PET,e.petData.id),h=d=>{switch(d.type){case ie.MOUSE_DOWN:l(e),i(!0);return;case ie.MOUSE_UP:i(!1);return;case ie.ROLL_OUT:if(!r||e!==a)return;Bf(e);return;case"dblclick":Bf(e);return}};return g(Qe,{itemActive:e===a,itemUnseen:u,onMouseDown:h,onMouseUp:h,onMouseOut:h,onDoubleClick:h,...s,children:[o(cn,{figure:e.petData.figureData.figuredata,direction:3,headOnly:!0}),t]})},dJ=n=>{const{roomSession:e=null,roomPreviewer:t=null}=n,[s,r]=_.useState(!1),{petItems:i=null,selectedPet:a=null,activate:l=null,deactivate:c=null}=dL(),{isUnseen:u=null,removeUnseen:h=null}=ti();return _.useEffect(()=>{if(!a||!t)return;const d=a.petData,f=ee();let E=f.getRoomInstanceVariable(f.activeRoomId,C.ROOM_WALL_TYPE),m=f.getRoomInstanceVariable(f.activeRoomId,C.ROOM_FLOOR_TYPE),R=f.getRoomInstanceVariable(f.activeRoomId,C.ROOM_LANDSCAPE_TYPE);E=E&&E.length?E:"101",m=m&&m.length?m:"101",R=R&&R.length?R:"1.1",t.reset(!1),t.updateRoomWallsAndFloorVisibility(!0,!0),t.updateObjectRoom(m,E,R),t.addPetIntoRoom(d.figureString)},[t,a]),_.useEffect(()=>{!a||!u(wt.PET,a.petData.id)||h(wt.PET,a.petData.id)},[a,u,h]),_.useEffect(()=>{if(!s)return;const d=l();return()=>c(d)},[s,l,c]),_.useEffect(()=>(r(!0),()=>r(!1)),[]),!i||!i.length?o(up,{title:p("inventory.empty.pets.title"),desc:p("inventory.empty.pets.desc")}):g(ge,{children:[o(D,{size:7,overflow:"hidden",children:o(Ot,{columnCount:5,children:i&&i.length>0&&i.map(d=>o(hJ,{petItem:d},d.petData.id))})}),g(D,{size:5,overflow:"auto",children:[o(D,{overflow:"hidden",position:"relative",children:o(d_,{roomPreviewer:t,height:140})}),a&&a.petData&&g(D,{grow:!0,justifyContent:"between",gap:2,children:[o(y,{grow:!0,truncate:!0,children:a.petData.name}),!!e&&o(H,{variant:"success",onClick:d=>Bf(a),children:p("inventory.furni.placetoroom")})]})]})]})},xL="inventory.furni",wL="inventory.bots",GL="inventory.furni.tab.pets",BL="inventory.badges",MI=[xL,wL,GL,BL],_J=[wt.FURNI,wt.BOT,wt.PET,wt.BADGE],gJ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(MI[0]),[i,a]=_.useState(null),[l,c]=_.useState(null),{isTrading:u=!1,stopTrading:h=null}=_L(),{getCount:d=null,resetCategory:f=null}=ti(),E=()=>{u&&h(),t(!1)};return $e(ue.PLACED,m=>{x6()&&(yu(!1),m.placedInRoom||t(!0))}),kt([Ne.CREATED,Ne.ENDED],m=>{switch(m.type){case Ne.CREATED:a(m.session);return;case Ne.ENDED:a(null),t(!1);return}}),z(Gm,m=>{const R=m.getParser();for(const I of R.data)nP().setBadgePointLimit(I.badgeId,I.limit)}),_.useEffect(()=>{const m={linkReceived:R=>{const I=R.split("/");if(!(I.length<2))switch(I[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(S=>!S);return}},eventUrlPrefix:"inventory/"};return Cs(m),()=>As(m)},[]),_.useEffect(()=>(c(new td(ee(),++td.PREVIEW_COUNTER)),()=>{c(m=>(m.dispose(),null))}),[]),_.useEffect(()=>{!e&&u&&t(!0)},[e,u]),e?g(Re,{uniqueKey:"inventory",className:"nitro-inventory",theme:u?"primary-slim":"",children:[o(Te,{headerText:p("inventory.title"),onCloseClick:E}),!u&&g(X,{children:[o(aa,{children:MI.map((m,R)=>o(Yi,{isActive:s===m,onClick:I=>r(m),count:d(_J[R]),children:p(m)},R))}),g(Ee,{children:[s===xL&&o(cJ,{roomSession:i,roomPreviewer:l}),s===wL&&o(aJ,{roomSession:i,roomPreviewer:l}),s===GL&&o(dJ,{roomSession:i,roomPreviewer:l}),s===BL&&o(iJ,{})]})]}),u&&o(Ee,{children:o(uJ,{cancelTrade:E})})]}):null},hp=n=>{const{records:e=null}=n,{openRoomInfo:t=null}=sc(),s=_.useMemo(()=>{const i=[];return e.forEach(a=>{i.push({isRoomInfo:!0,roomId:a.roomId,roomName:a.roomName}),a.chatlog.forEach(l=>{i.push({timestamp:l.timestamp,habboId:l.userId,username:l.userName,hasHighlighting:l.hasHighlighting,message:l.message,isRoomInfo:!1})})}),i},[e]),r=i=>g(P,{gap:2,alignItems:"center",justifyContent:"between",className:"bg-muted rounded p-1",children:[g(P,{gap:1,children:[o(y,{bold:!0,children:"Room name:"}),o(y,{children:i.roomName})]}),g(P,{gap:1,children:[o(H,{onClick:a=>Wi(i.roomId),children:"Visit Room"}),o(H,{onClick:a=>t(i.roomId),children:"Room Tools"})]})]});return o(X,{children:g(D,{fit:!0,gap:0,overflow:"hidden",children:[o(D,{gap:2,children:g(ge,{gap:1,className:"text-black fw-bold border-bottom pb-1",children:[o(j,{className:"g-col-2",children:"Time"}),o(j,{className:"g-col-3",children:"User"}),o(j,{className:"g-col-7",children:"Message"})]})}),e&&e.length>0&&o(g_,{rows:s,rowRender:i=>g(X,{children:[i.isRoomInfo&&o(r,{roomId:i.roomId,roomName:i.roomName}),!i.isRoomInfo&&g(ge,{fullHeight:!1,gap:1,alignItems:"center",className:"log-entry py-1 border-bottom",children:[o(y,{className:"g-col-2",children:i.timestamp}),o(y,{className:"g-col-3",bold:!0,underline:!0,pointer:!0,onClick:a=>de(`mod-tools/open-user-info/${i.habboId}`),children:i.username}),o(y,{textBreak:!0,wrap:!0,className:"g-col-7",children:i.message})]})]})})]})})},fJ=n=>{const{roomId:e=null,onCloseClick:t=null}=n,[s,r]=_.useState(null);return z(kC,i=>{const a=i.getParser();!a||a.data.roomId!==e||r(a.data)}),_.useEffect(()=>{V(new AM(e))},[e]),s?g(Re,{className:"nitro-mod-tools-chatlog",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:`Room Chatlog ${s.roomName}`,onCloseClick:t}),o(Ee,{className:"text-black",overflow:"hidden",children:s&&o(hp,{records:[s]})})]}):null},mJ=n=>{const{roomId:e=null,onCloseClick:t=null}=n,[s,r]=_.useState(!1),[i,a]=_.useState(null),[l,c]=_.useState(null),[u,h]=_.useState(null),[d,f]=_.useState(null),[E,m]=_.useState(!1),[R,I]=_.useState(0),[S,A]=_.useState(!1),[N,L]=_.useState(!1),[M,b]=_.useState(!1),[B,w]=_.useState(""),x=(U,G)=>{if(U)switch(U){case"alert_only":if(B.trim().length===0)return;V(new zn(zn.ACTION_ALERT,B,"")),V(new ff(e,N?1:0,M?1:0,S?1:0));return;case"send_message":if(B.trim().length===0)return;V(new zn(zn.ACTION_MESSAGE,B,"")),V(new ff(e,N?1:0,M?1:0,S?1:0));return}};return z(wC,U=>{const G=U.getParser();!G||G.data.flatId!==e||(a(G.data.flatId),c(G.data.room.name),h(G.data.ownerId),f(G.data.ownerName),m(G.data.ownerInRoom),I(G.data.userCount))}),_.useEffect(()=>{s||(V(new SM(e)),r(!0))},[e,s,r]),g(Re,{className:"nitro-mod-tools-room",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:"Room Info"+(l?": "+l:""),onCloseClick:U=>t()}),g(Ee,{className:"text-black",children:[g(P,{gap:2,children:[g(D,{justifyContent:"center",grow:!0,gap:1,children:[g(P,{alignItems:"center",gap:2,children:[o(y,{bold:!0,align:"end",className:"col-7",children:"Room Owner:"}),o(y,{underline:!0,pointer:!0,truncate:!0,children:d})]}),g(P,{alignItems:"center",gap:2,children:[o(y,{bold:!0,align:"end",className:"col-7",children:"Users in room:"}),o(y,{children:R})]}),g(P,{alignItems:"center",gap:2,children:[o(y,{bold:!0,align:"end",className:"col-7",children:"Owner in room:"}),o(y,{children:E?"Yes":"No"})]})]}),g(D,{gap:1,children:[o(H,{onClick:U=>Wi(e),children:"Visit Room"}),o(H,{onClick:U=>de(`mod-tools/open-room-chatlog/${e}`),children:"Chatlog"})]})]}),g(D,{className:"bg-muted rounded p-2",gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:S,onChange:U=>A(U.target.checked)}),o(y,{small:!0,children:"Kick everyone out"})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:N,onChange:U=>L(U.target.checked)}),o(y,{small:!0,children:"Enable the doorbell"})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:M,onChange:U=>b(U.target.checked)}),o(y,{small:!0,children:"Change room name"})]})]}),o("textarea",{className:"form-control",placeholder:"Type a mandatory message to the users in this text box...",value:B,onChange:U=>w(U.target.value)}),g(P,{justifyContent:"between",children:[o(H,{variant:"danger",onClick:U=>x("send_message"),children:"Send Caution"}),o(H,{onClick:U=>x("alert_only"),children:"Send Alert only"})]})]})]})},EJ=n=>{const{onCloseClick:e=null,issueId:t=null}=n,[s,r]=_.useState(null);return z(DC,i=>{const a=i.getParser();!a||a.data.issueId!==t||r(a.data)}),_.useEffect(()=>{V(new OM(t))},[t]),g(Re,{className:"nitro-mod-tools-chatlog",theme:"primary-slim",children:[o(Te,{headerText:"Issue Chatlog",onCloseClick:e}),o(Ee,{className:"text-black",children:s&&o(hp,{records:[s.chatRecord]})})]})},pJ=n=>{const{issueId:e=null,onIssueInfoClosed:t=null}=n,[s,r]=_.useState(!1),{tickets:i=[],openUserInfo:a=null}=sc(),l=i.find(h=>h.issueId===e),c=h=>{V(new rE([h])),t(h)},u=h=>{V(new Na([e],h)),t(e)};return g(X,{children:[g(Re,{className:"nitro-mod-tools-handle-issue",theme:"primary-slim",children:[o(Te,{headerText:"Resolving issue "+e,onCloseClick:()=>t(e)}),g(Ee,{className:"text-black",children:[o(y,{fontSize:4,children:"Issue Information"}),g(ge,{overflow:"auto",children:[o(D,{size:8,children:o("table",{className:"table table-striped table-sm table-text-small text-black m-0",children:g("tbody",{children:[g("tr",{children:[o("th",{children:"Source"}),o("td",{children:cq(l.categoryId)})]}),g("tr",{children:[o("th",{children:"Category"}),o("td",{className:"text-break",children:p("help.cfh.topic."+l.reportedCategoryId)})]}),g("tr",{children:[o("th",{children:"Description"}),o("td",{className:"text-break",children:l.message})]}),g("tr",{children:[o("th",{children:"Caller"}),o("td",{children:o(y,{bold:!0,underline:!0,pointer:!0,onClick:h=>a(l.reporterUserId),children:l.reporterUserName})})]}),g("tr",{children:[o("th",{children:"Reported User"}),o("td",{children:o(y,{bold:!0,underline:!0,pointer:!0,onClick:h=>a(l.reportedUserId),children:l.reportedUserName})})]})]})})}),g(D,{size:4,gap:1,children:[o(H,{variant:"secondary",onClick:()=>r(!s),children:"Chatlog"}),o(H,{onClick:h=>u(Na.RESOLUTION_USELESS),children:"Close as useless"}),o(H,{variant:"danger",onClick:h=>u(Na.RESOLUTION_ABUSIVE),children:"Close as abusive"}),o(H,{variant:"success",onClick:h=>u(Na.RESOLUTION_RESOLVED),children:"Close as resolved"}),o(H,{variant:"secondary",onClick:h=>c(e),children:"Release"})]})]})]})]}),s&&o(EJ,{issueId:e,onCloseClick:()=>r(!1)})]})},IJ=n=>{const{myIssues:e=null,handleIssue:t=null}=n;return g(D,{gap:0,overflow:"hidden",children:[o(D,{gap:2,children:g(ge,{gap:1,className:"text-black fw-bold border-bottom pb-1",children:[o(j,{className:"g-col-2",children:"Type"}),o(j,{className:"g-col-3",children:"Room/Player"}),o(j,{className:"g-col-3",children:"Opened"}),o(j,{className:"g-col-2"}),o(j,{className:"g-col-2"})]})}),o(D,{overflow:"auto",className:"striped-children",gap:0,children:e&&e.length>0&&e.map(s=>g(ge,{gap:1,alignItems:"center",className:"text-black py-1 border-bottom",children:[o(j,{className:"g-col-2",children:s.categoryId}),o(j,{className:"g-col-3",children:s.reportedUserName}),o(j,{className:"g-col-3",children:new Date(Date.now()-s.issueAgeInMilliseconds).toLocaleTimeString()}),o(j,{className:"g-col-2",children:o(H,{variant:"primary",onClick:r=>t(s.issueId),children:"Handle"})}),o(j,{className:"g-col-2",children:o(H,{variant:"danger",onClick:r=>V(new rE([s.issueId])),children:"Release"})})]},s.issueId))})]})},TJ=n=>{const{openIssues:e=null}=n;return g(D,{gap:0,overflow:"hidden",children:[o(D,{gap:2,children:g(ge,{gap:1,className:"text-black fw-bold border-bottom pb-1",children:[o(j,{className:"g-col-2",children:"Type"}),o(j,{className:"g-col-3",children:"Room/Player"}),o(j,{className:"g-col-4",children:"Opened"}),o(j,{className:"g-col-3"})]})}),o(D,{overflow:"auto",className:"striped-children",gap:0,children:e&&e.length>0&&e.map(t=>g(ge,{gap:1,alignItems:"center",className:"text-black py-1 border-bottom",children:[o(j,{className:"g-col-2",children:t.categoryId}),o(j,{className:"g-col-3",children:t.reportedUserName}),o(j,{className:"g-col-4",children:new Date(Date.now()-t.issueAgeInMilliseconds).toLocaleTimeString()}),o(j,{className:"g-col-3",children:o(H,{variant:"success",onClick:s=>V(new PM([t.issueId],!1,0,"pick issue button")),children:"Pick Issue"})})]},t.issueId))})]})},RJ=n=>{const{pickedIssues:e=null}=n;return g(D,{gap:0,overflow:"hidden",children:[o(D,{gap:2,children:g(ge,{gap:1,className:"text-black fw-bold border-bottom pb-1",children:[o(j,{className:"g-col-2",children:"Type"}),o(j,{className:"g-col-3",children:"Room/Player"}),o(j,{className:"g-col-4",children:"Opened"}),o(j,{className:"g-col-3",children:"Picker"})]})}),o(D,{overflow:"auto",className:"striped-children",gap:0,children:e&&e.length>0&&e.map(t=>g(ge,{gap:1,alignItems:"center",className:"text-black py-1 border-bottom",children:[o(j,{className:"g-col-2",children:t.categoryId}),o(j,{className:"g-col-3",children:t.reportedUserName}),o(j,{className:"g-col-4",children:new Date(Date.now()-t.issueAgeInMilliseconds).toLocaleTimeString()}),o(j,{className:"g-col-3",children:t.pickerUserName})]},t.issueId))})]})},OJ=["Open Issues","My Issues","Picked Issues"],SJ=n=>{const{onCloseClick:e=null}=n,[t,s]=_.useState(0),[r,i]=_.useState([]),{tickets:a=[]}=sc(),l=a.filter(E=>E.state===La.STATE_OPEN),c=a.filter(E=>E.state===La.STATE_PICKED&&E.pickerUserId===$().userId),u=a.filter(E=>E.state===La.STATE_PICKED),h=E=>{i(m=>{const R=[...m],I=R.indexOf(E);return I>=0&&R.splice(I,1),R})},d=E=>{i(m=>{const R=[...m],I=R.indexOf(E);return I===-1?R.push(E):R.splice(I,1),R})},f=()=>{switch(t){case 0:return o(TJ,{openIssues:l});case 1:return o(IJ,{myIssues:c,handleIssue:d});case 2:return o(RJ,{pickedIssues:u})}return null};return g(X,{children:[g(Re,{className:"nitro-mod-tools-tickets",children:[o(Te,{headerText:"Tickets",onCloseClick:e}),o(aa,{children:OJ.map((E,m)=>o(Yi,{isActive:t===m,onClick:R=>s(m),children:E},m))}),o(Ee,{gap:1,children:o(f,{})})]}),r&&r.length>0&&r.map(E=>o(pJ,{issueId:E,onIssueInfoClosed:h},E))]})},CJ=n=>{const{userId:e=null,onCloseClick:t=null}=n,[s,r]=_.useState(null),[i,a]=_.useState(null);return z(jC,l=>{const c=l.getParser();!c||c.data.userId!==e||(a(c.data.username),r(c.data.roomChatlogs))}),_.useEffect(()=>{V(new yM(e))},[e]),g(Re,{className:"nitro-mod-tools-chatlog",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:`User Chatlog: ${i||""}`,onCloseClick:t}),o(Ee,{className:"text-black h-100",children:s&&o(hp,{records:s})})]})},DI=[new gt(1,"Alert",gt.ALERT,1,0),new gt(2,"Mute 1h",gt.MUTE,2,0),new gt(3,"Ban 18h",gt.BAN,3,0),new gt(4,"Ban 7 days",gt.BAN,4,0),new gt(5,"Ban 30 days (step 1)",gt.BAN,5,0),new gt(7,"Ban 30 days (step 2)",gt.BAN,7,0),new gt(6,"Ban 100 years",gt.BAN,6,0),new gt(106,"Ban avatar-only 100 years",gt.BAN,6,0),new gt(101,"Kick",gt.KICK,0,0),new gt(102,"Lock trade 1 week",gt.TRADE_LOCK,0,168),new gt(104,"Lock trade permanent",gt.TRADE_LOCK,0,876e3),new gt(105,"Message",gt.MESSAGE,0,0)],AJ=n=>{const{user:e=null,onCloseClick:t=null}=n,[s,r]=_.useState(-1),[i,a]=_.useState(-1),[l,c]=_.useState(""),{cfhCategories:u=null,settings:h=null}=sc(),{simpleAlert:d=null}=Xt(),f=_.useMemo(()=>{const I=[];if(u&&u.length)for(const S of u)for(const A of S.topics)I.push(A);return I},[u]),E=I=>d(I,Le.DEFAULT,null,null,"Error"),m=()=>{let I=null;const S=f[s];if(s===-1&&(I="You must select a CFH topic"),I)return E(I);const A=l.trim().length===0?p(`help.cfh.topic.${S.id}`):l;V(new RM(e.userId,s,A)),t()},R=()=>{let I=null;const S=f[s],A=DI[i];if(s===-1||i===-1?I="You must select a CFH topic and Sanction":!h||!h.cfhPermission?I="You do not have permission to do this":S?A||(I="You must select a sanction"):I="You must select a CFH topic",I){E(I);return}const N=l.trim().length===0?p(`help.cfh.topic.${S.id}`):l;switch(A.actionType){case gt.ALERT:{if(!h.alertPermission){E("You have insufficient permissions");return}V(new MM(e.userId,N,S.id));break}case gt.MUTE:V(new vM(e.userId,N,S.id));break;case gt.BAN:{if(!h.banPermission){E("You have insufficient permissions");return}V(new Ha(e.userId,N,S.id,i,A.actionId===106));break}case gt.KICK:{if(!h.kickPermission){E("You have insufficient permissions");return}V(new DM(e.userId,N,S.id));break}case gt.TRADE_LOCK:{const L=A.actionLengthHours*60;V(new bM(e.userId,N,L,S.id));break}case gt.MESSAGE:{if(l.trim().length===0){E("Please write a message to user");return}V(new sE(e.userId,l,S.id));break}}t()};return e?g(Re,{className:"nitro-mod-tools-user-action",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:"Mod Action: "+(e?e.username:""),onCloseClick:()=>t()}),g(Ee,{className:"text-black",children:[g("select",{className:"form-select form-select-sm",value:s,onChange:I=>r(parseInt(I.target.value)),children:[o("option",{value:-1,disabled:!0,children:"CFH Topic"}),f.map((I,S)=>o("option",{value:S,children:p("help.cfh.topic."+I.id)},S))]}),g("select",{className:"form-select form-select-sm",value:i,onChange:I=>a(parseInt(I.target.value)),children:[o("option",{value:-1,disabled:!0,children:"Sanction Type"}),DI.map((I,S)=>o("option",{value:S,children:I.name},S))]}),g(D,{gap:1,children:[o(y,{small:!0,children:"Optional message type, overrides default"}),o("textarea",{className:"form-control",value:l,onChange:I=>c(I.target.value)})]}),g(P,{justifyContent:"between",gap:1,children:[o(H,{variant:"primary",onClick:m,children:"Default Sanction"}),o(H,{variant:"success",onClick:R,children:"Sanction"})]})]})]}):null},NJ=n=>{const{userId:e=null,onCloseClick:t=null}=n,[s,r]=_.useState(null);return z(VC,i=>{const a=i.getParser();a.data.userId===e&&r(a.data)}),_.useEffect(()=>{V(new NM(e))},[e]),e?g(Re,{className:"nitro-mod-tools-user-visits",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:"User Visits",onCloseClick:t}),o(Ee,{className:"text-black",gap:1,children:g(D,{fullHeight:!0,gap:0,overflow:"hidden",children:[o(D,{gap:2,children:g(ge,{gap:1,className:"text-black fw-bold border-bottom pb-1",children:[o(j,{className:"g-col-2",children:"Time"}),o(j,{className:"g-col-7",children:"Room name"}),o(j,{className:"g-col-3",children:"Visit"})]})}),o(g_,{rows:(s==null?void 0:s.rooms)??[],rowRender:i=>g(ge,{fullHeight:!1,gap:1,alignItems:"center",className:"text-black py-1 border-bottom",children:[g(y,{className:"g-col-2",children:[i.enterHour.toString().padStart(2,"0"),": ",i.enterMinute.toString().padStart(2,"0")]}),o(y,{className:"g-col-7",children:i.roomName}),o(y,{bold:!0,underline:!0,pointer:!0,variant:"primary",className:"g-col-3",onClick:a=>Wi(i.roomId),children:"Visit Room"})]})})]})})]}):null},yJ=n=>{const{user:e=null,onCloseClick:t=null}=n,[s,r]=_.useState(""),{simpleAlert:i=null}=Xt();if(!e)return null;const a=()=>{if(s.trim().length===0){i("Please write a message to user.",null,null,null,"Error",null);return}V(new sE(e.userId,s,-999)),t()};return g(Re,{className:"nitro-mod-tools-user-message",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:"Send Message",onCloseClick:()=>t()}),g(Ee,{className:"text-black",children:[g(y,{children:["Message To: ",e.username]}),o("textarea",{className:"form-control",value:s,onChange:l=>r(l.target.value)}),o(H,{fullWidth:!0,onClick:a,children:"Send message"})]})]})},MJ=n=>{const{onCloseClick:e=null,userId:t=null}=n,[s,r]=_.useState(null),[i,a]=_.useState(!1),[l,c]=_.useState(!1),[u,h]=_.useState(!1),d=_.useMemo(()=>s?[{localeKey:"modtools.userinfo.userName",value:s.userName,showOnline:!0},{localeKey:"modtools.userinfo.cfhCount",value:s.cfhCount.toString()},{localeKey:"modtools.userinfo.abusiveCfhCount",value:s.abusiveCfhCount.toString()},{localeKey:"modtools.userinfo.cautionCount",value:s.cautionCount.toString()},{localeKey:"modtools.userinfo.banCount",value:s.banCount.toString()},{localeKey:"modtools.userinfo.lastSanctionTime",value:s.lastSanctionTime},{localeKey:"modtools.userinfo.tradingLockCount",value:s.tradingLockCount.toString()},{localeKey:"modtools.userinfo.tradingExpiryDate",value:s.tradingExpiryDate},{localeKey:"modtools.userinfo.minutesSinceLastLogin",value:Jn.format(s.minutesSinceLastLogin*60,".ago",2)},{localeKey:"modtools.userinfo.lastPurchaseDate",value:s.lastPurchaseDate},{localeKey:"modtools.userinfo.primaryEmailAddress",value:s.primaryEmailAddress},{localeKey:"modtools.userinfo.identityRelatedBanCount",value:s.identityRelatedBanCount.toString()},{localeKey:"modtools.userinfo.registrationAgeInMinutes",value:Jn.format(s.registrationAgeInMinutes*60,".ago",2)},{localeKey:"modtools.userinfo.userClassification",value:s.userClassification}]:null,[s]);return z(BC,f=>{const E=f.getParser();!E||E.data.userId!==t||r(E.data)}),_.useEffect(()=>{V(new CM(t))},[t]),s?g(X,{children:[g(Re,{className:"nitro-mod-tools-user",theme:"primary-slim",windowPosition:xs.TOP_LEFT,children:[o(Te,{headerText:p("modtools.userinfo.title",["username"],[s.userName]),onCloseClick:()=>e()}),o(Ee,{className:"text-black",children:g(ge,{overflow:"hidden",children:[o(D,{size:8,overflow:"auto",children:o("table",{className:"table table-striped table-sm table-text-small text-black m-0",children:o("tbody",{children:d.map((f,E)=>g("tr",{children:[o("th",{scope:"row",children:p(f.localeKey)}),g("td",{children:[f.value,f.showOnline&&o("i",{className:`icon icon-pf-${s.online?"online":"offline"} ms-2`})]})]},E))})})}),g(D,{size:4,gap:1,children:[o(H,{onClick:f=>de(`mod-tools/open-user-chatlog/${t}`),children:"Room Chat"}),o(H,{onClick:f=>a(!i),children:"Send Message"}),o(H,{onClick:f=>h(!u),children:"Room Visits"}),o(H,{onClick:f=>c(!l),children:"Mod Action"})]})]})})]}),i&&o(yJ,{user:{userId:t,username:s.userName},onCloseClick:()=>a(!1)}),l&&o(AJ,{user:{userId:t,username:s.userName},onCloseClick:()=>c(!1)}),u&&o(NJ,{userId:t,onCloseClick:()=>h(!1)})]}):null},DJ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(-1),[i,a]=_.useState(null),[l,c]=_.useState(!1),{openRooms:u=[],openRoomChatlogs:h=[],openUserChatlogs:d=[],openUserInfos:f=[],openRoomInfo:E=null,closeRoomInfo:m=null,toggleRoomInfo:R=null,openRoomChatlog:I=null,closeRoomChatlog:S=null,toggleRoomChatlog:A=null,openUserInfo:N=null,closeUserInfo:L=null,toggleUserInfo:M=null,openUserChatlog:b=null,closeUserChatlog:B=null,toggleUserChatlog:w=null}=sc(),x=_.useRef(null);return $e([je.INITIALIZED,je.DISPOSED],U=>{if(!Yn.isRoomPreviewerId(U.roomId))switch(U.type){case je.INITIALIZED:r(U.roomId);return;case je.DISPOSED:r(-1);return}}),np(U=>{if(U.category!==k.UNIT)return;const G=at();if(!G)return;const K=G.userDataManager.getUserDataByIndex(U.id);!K||K.type!==Rt.USER||a({userId:K.webID,username:K.name})}),_.useEffect(()=>{const U={linkReceived:G=>{const K=G.split("/");if(!(K.length<2))switch(K[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(Y=>!Y);return;case"open-room-info":E(Number(K[2]));return;case"close-room-info":m(Number(K[2]));return;case"toggle-room-info":R(Number(K[2]));return;case"open-room-chatlog":I(Number(K[2]));return;case"close-room-chatlog":S(Number(K[2]));return;case"toggle-room-chatlog":A(Number(K[2]));return;case"open-user-info":N(Number(K[2]));return;case"close-user-info":L(Number(K[2]));return;case"toggle-user-info":M(Number(K[2]));return;case"open-user-chatlog":b(Number(K[2]));return;case"close-user-chatlog":B(Number(K[2]));return;case"toggle-user-chatlog":w(Number(K[2]));return}},eventUrlPrefix:"mod-tools/"};return Cs(U),()=>As(U)},[E,m,R,I,S,A,N,L,M,b,B,w]),g(X,{children:[e&&g(Re,{uniqueKey:"mod-tools",className:"nitro-mod-tools",windowPosition:xs.TOP_LEFT,theme:"primary-slim",children:[o(Te,{headerText:"Mod Tools",onCloseClick:U=>t(!1)}),g(Ee,{className:"text-black",gap:1,children:[g(H,{gap:1,onClick:U=>de(`mod-tools/toggle-room-info/${s}`),disabled:s<=0,className:"position-relative",children:[o(j,{className:"icon icon-small-room position-absolute start-1"})," Room Tool"]}),g(H,{innerRef:x,gap:1,onClick:U=>de(`mod-tools/toggle-room-chatlog/${s}`),disabled:s<=0,className:"position-relative",children:[o(j,{className:"icon icon-chat-history position-absolute start-1"})," Chatlog Tool"]}),g(H,{gap:1,onClick:()=>de(`mod-tools/toggle-user-info/${i.userId}`),disabled:!i,className:"position-relative",children:[o(j,{className:"icon icon-user position-absolute start-1"})," User: ",i?i.username:""]}),g(H,{gap:1,onClick:()=>c(U=>!U),className:"position-relative",children:[o(j,{className:"icon icon-tickets position-absolute start-1"})," Report Tool"]})]})]}),u.length>0&&u.map(U=>o(mJ,{roomId:U,onCloseClick:()=>de(`mod-tools/close-room-info/${U}`)},U)),h.length>0&&h.map(U=>o(fJ,{roomId:U,onCloseClick:()=>de(`mod-tools/close-room-chatlog/${U}`)},U)),f.length>0&&f.map(U=>o(MJ,{userId:U,onCloseClick:()=>de(`mod-tools/close-user-info/${U}`)},U)),d.length>0&&d.map(U=>o(CJ,{userId:U,onCloseClick:()=>de(`mod-tools/close-user-chatlog/${U}`)},U)),l&&o(SJ,{onCloseClick:()=>c(!1)})]})},vJ=[ut.START_DOORBELL,ut.STATE_WAITING,ut.STATE_NO_ANSWER,ut.START_PASSWORD,ut.STATE_WRONG_PASSWORD],bJ=[ut.START_DOORBELL,ut.STATE_WAITING,ut.STATE_NO_ANSWER],PJ=n=>{const[e,t]=_.useState(""),{doorData:s=null,setDoorData:r=null}=Mi(),i=()=>{s&&s.state===ut.STATE_WAITING&&xf(),r(null)},a=()=>{!s||!s.roomInfo||(po(s.roomInfo.roomId),r(u=>{const h={...u};return h.state=ut.STATE_PENDING_SERVER,h}))},l=()=>{!s||!s.roomInfo||(po(s.roomInfo.roomId,e),r(u=>{const h={...u};return h.state=ut.STATE_PENDING_SERVER,h}))};if(_.useEffect(()=>{!s||s.state!==ut.STATE_NO_ANSWER||xf()},[s]),!s||s.state===ut.NONE||vJ.indexOf(s.state)===-1)return null;const c=bJ.indexOf(s.state)>=0;return g(Re,{className:"nitro-navigator-doorbell",theme:"primary-slim",children:[o(Te,{headerText:p(c?"navigator.doorbell.title":"navigator.password.title"),onCloseClick:i}),g(Ee,{children:[g(D,{gap:1,children:[o(y,{bold:!0,children:s&&s.roomInfo&&s.roomInfo.roomName}),s.state===ut.START_DOORBELL&&o(y,{children:p("navigator.doorbell.info")}),s.state===ut.STATE_WAITING&&o(y,{children:p("navigator.doorbell.waiting")}),s.state===ut.STATE_NO_ANSWER&&o(y,{children:p("navigator.doorbell.no.answer")}),s.state===ut.START_PASSWORD&&o(y,{children:p("navigator.password.info")}),s.state===ut.STATE_WRONG_PASSWORD&&o(y,{children:p("navigator.password.retryinfo")})]}),c&&g(D,{gap:1,children:[s.state===ut.START_DOORBELL&&o(H,{variant:"success",onClick:a,children:p("navigator.doorbell.button.ring")}),o(H,{variant:"danger",onClick:i,children:p("generic.cancel")})]}),!c&&g(X,{children:[g(D,{gap:1,children:[o(y,{children:p("navigator.password.enter")}),o("input",{type:"password",className:"form-control form-control-sm",onChange:u=>t(u.target.value)})]}),g(D,{gap:1,children:[o(H,{variant:"success",onClick:l,children:p("navigator.password.button.try")}),o(H,{variant:"danger",onClick:i,children:p("generic.cancel")})]})]})]})]})},LJ=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(null),[i,a]=_.useState(null),[l,c]=_.useState(null),[u,h]=_.useState(null),[d,f]=_.useState(0),[E,m]=_.useState([]),[R,I]=_.useState(""),{categories:S=null}=Mi(),A=ce("hc.disabled",!1),N=b=>ce("images.url")+`/navigator/models/model_${b}.png`,L=(b,B)=>{!b||b.clubLevel>Qr()||I(E[B].name)},M=()=>{V(new FM(s,i,"model_"+R,Number(l),Number(u),d))};return _.useEffect(()=>{if(!e){const b=[];for(let B=10;B<=100;B=B+10)b.push(B);t(b),h(b[0])}},[e]),_.useEffect(()=>{S&&S.length&&c(S[0].id)},[S]),_.useEffect(()=>{const b=ce("navigator.room.models");b&&b.length&&(m(b),I(b[0].name))},[]),g(D,{overflow:"hidden",children:[g(ge,{overflow:"hidden",children:[g(D,{size:6,gap:1,overflow:"auto",children:[g(D,{gap:1,children:[o(y,{children:p("navigator.createroom.roomnameinfo")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:60,onChange:b=>r(b.target.value),placeholder:p("navigator.createroom.roomnameinfo")})]}),g(D,{grow:!0,gap:1,children:[o(y,{children:p("navigator.createroom.roomdescinfo")}),o("textarea",{className:"flex-grow-1 form-control form-control-sm w-100",maxLength:255,onChange:b=>a(b.target.value),placeholder:p("navigator.createroom.roomdescinfo")})]}),g(D,{gap:1,children:[o(y,{children:p("navigator.category")}),o("select",{className:"form-select form-select-sm",onChange:b=>c(Number(b.target.value)),children:S&&S.length>0&&S.map(b=>o("option",{value:b.id,children:p(b.name)},b.id))})]}),g(D,{gap:1,children:[o(y,{children:p("navigator.maxvisitors")}),o("select",{className:"form-select form-select-sm",onChange:b=>h(Number(b.target.value)),children:e&&e.map(b=>o("option",{value:b,children:b},b))})]}),g(D,{gap:1,children:[o(y,{children:p("navigator.tradesettings")}),g("select",{className:"form-select form-select-sm",onChange:b=>f(Number(b.target.value)),children:[o("option",{value:"0",children:p("navigator.roomsettings.trade_not_allowed")}),o("option",{value:"1",children:p("navigator.roomsettings.trade_not_with_Controller")}),o("option",{value:"2",children:p("navigator.roomsettings.trade_allowed")})]})]})]}),o(D,{size:6,gap:1,overflow:"auto",children:E.map((b,B)=>g(Qe,{fullHeight:!0,onClick:()=>L(b,B),itemActive:R===b.name,overflow:"unset",gap:0,className:"p-1",disabled:Qr()<b.clubLevel,children:[o(P,{fullHeight:!0,center:!0,overflow:"hidden",children:o("img",{alt:"",src:N(b.name)})}),g(y,{bold:!0,children:[b.tileSize," ",p("navigator.createroom.tilesize")]}),!A&&b.clubLevel>_r.NO_CLUB&&o(gs,{position:"absolute",className:"top-1 end-1",type:"hc"})]},b.name))})]}),o(H,{fullWidth:!0,variant:!s||s.length<3?"danger":"success",onClick:M,disabled:!s||s.length<3,children:p("navigator.createroom.create")})]})},UJ=n=>{const{onCloseClick:e=null}=n,[t,s]=_.useState(!1),[r,i]=_.useState(!1),{report:a=null}=Ji(),{navigatorData:l=null}=Mi(),c=h=>{switch(h){case"settings":return $().userId===l.enteredGuestRoom.ownerId||$().isModerator;case"staff_pick":return $().securityLevel>=Cr.COMMUNITY;default:return!1}},u=(h,d)=>{if(!(!l||!l.enteredGuestRoom))switch(h){case"set_home_room":let f=-1;l.homeRoomId!==l.enteredGuestRoom.roomId&&(f=l.enteredGuestRoom.roomId),f>0&&V(new HM(f));return;case"navigator_search_tag":de(`navigator/search/${d}`),V(new Co("hotel_view",`tag:${d}`));return;case"open_room_thumbnail_camera":Fs(new Fi(Fi.TOGGLE_THUMBNAIL));return;case"open_group_info":Mu(l.enteredGuestRoom.habboGroupId);return;case"toggle_room_link":de("navigator/toggle-room-link");return;case"open_room_settings":V(new oE(l.enteredGuestRoom.roomId));return;case"toggle_pick":s(E=>!E),V(new VM(l.enteredGuestRoom.roomId));return;case"toggle_mute":i(E=>!E),V(new uv);return;case"room_filter":V(new wM(l.enteredGuestRoom.roomId));return;case"open_floorplan_editor":de("floor-editor/toggle");return;case"report_room":a(bt.ROOM,{roomId:l.enteredGuestRoom.roomId,roomName:l.enteredGuestRoom.roomName});return;case"close":e();return}};return _.useEffect(()=>{l&&(s(l.currentRoomIsStaffPick),l.enteredGuestRoom&&i(l.enteredGuestRoom.allInRoomMuted))},[l]),l.enteredGuestRoom?g(Re,{className:"nitro-room-info",theme:"primary-slim",children:[o(Te,{headerText:p("navigator.roomsettings.roominfo"),onCloseClick:()=>u("close")}),o(Ee,{className:"text-black",children:l.enteredGuestRoom&&g(X,{children:[g(P,{gap:2,overflow:"hidden",children:[o(__,{roomId:l.enteredGuestRoom.roomId,customUrl:l.enteredGuestRoom.officialRoomPicRef,children:c("settings")&&o("i",{className:"icon icon-camera-small position-absolute b-0 r-0 m-1 cursor-pointer top-0",onClick:()=>u("open_room_thumbnail_camera")})}),g(D,{grow:!0,gap:1,overflow:"hidden",children:[g(P,{gap:1,children:[g(D,{grow:!0,gap:1,children:[g(P,{gap:1,children:[o("i",{onClick:()=>u("set_home_room"),className:$s("flex-shrink-0 icon icon-house-small cursor-pointer",l.homeRoomId!==l.enteredGuestRoom.roomId&&"gray")}),o(y,{bold:!0,children:l.enteredGuestRoom.roomName})]}),l.enteredGuestRoom.showOwner&&g(P,{alignItems:"center",gap:1,children:[o(y,{variant:"muted",children:p("navigator.roomownercaption")}),g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:l.enteredGuestRoom.ownerId}),o(y,{children:l.enteredGuestRoom.ownerName})]})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{variant:"muted",children:p("navigator.roomrating")}),o(y,{children:l.currentRoomRating})]}),l.enteredGuestRoom.tags.length>0&&o(P,{alignItems:"center",gap:1,children:l.enteredGuestRoom.tags.map(h=>g(y,{pointer:!0,className:"bg-muted rounded p-1",onClick:d=>u("navigator_search_tag",h),children:["#",h]},h))})]}),g(D,{alignItems:"center",gap:1,children:[c("settings")&&o("i",{className:"icon icon-cog cursor-pointer",title:p("navigator.room.popup.info.room.settings"),onClick:h=>u("open_room_settings")}),o(TU,{title:p("navigator.embed.caption"),className:"cursor-pointer fa-icon",onClick:h=>de("navigator/toggle-room-link")})]})]}),o(y,{overflow:"auto",style:{maxHeight:50},children:l.enteredGuestRoom.description}),l.enteredGuestRoom.habboGroupId>0&&g(P,{pointer:!0,alignItems:"center",gap:1,onClick:()=>u("open_group_info"),children:[o(xt,{className:"flex-none",badgeCode:l.enteredGuestRoom.groupBadgeCode,isGroup:!0}),o(y,{underline:!0,children:p("navigator.guildbase",["groupName"],[l.enteredGuestRoom.groupName])})]})]})]}),g(D,{gap:1,children:[c("staff_pick")&&o(H,{onClick:()=>u("toggle_pick"),children:p(t?"navigator.staffpicks.unpick":"navigator.staffpicks.pick")}),o(H,{variant:"danger",onClick:()=>u("report_room"),children:p("help.emergency.main.report.room")}),c("settings")&&g(X,{children:[o(H,{onClick:()=>u("toggle_mute"),children:p(r?"navigator.muteall_on":"navigator.muteall_off")}),o(H,{onClick:()=>u("room_filter"),children:p("navigator.roomsettings.roomfilter")}),o(H,{onClick:()=>u("open_floorplan_editor"),children:p("open.floor.plan.editor")})]})]})]})})]}):null},FJ=n=>{const{onCloseClick:e=null}=n,{navigatorData:t=null}=Mi();return t.enteredGuestRoom?g(Re,{className:"nitro-room-link",theme:"primary-slim",children:[o(Te,{headerText:p("navigator.embed.title"),onCloseClick:e}),o(Ee,{className:"text-black d-flex align-items-center",children:g(P,{gap:2,children:[o(__,{roomId:t.enteredGuestRoom.roomId,customUrl:t.enteredGuestRoom.officialRoomPicRef}),g(D,{children:[o(y,{bold:!0,fontSize:5,children:p("navigator.embed.headline")}),o(y,{children:p("navigator.embed.info")}),o("input",{type:"text",readOnly:!0,className:"form-control form-control-sm",value:p("navigator.embed.src",["roomId"],[t.enteredGuestRoom.roomId.toString()]).replace("${url.prefix}",ce("url.prefix",""))})]})]})})]}):null},xJ=n=>{const{roomData:e=null,handleChange:t=null}=n,[s,r]=_.useState(""),[i,a]=_.useState(""),[l,c]=_.useState(!1),u=()=>{!l||s.length<=0||i.length<=0||s!==i||t("password",s)};return _.useEffect(()=>{r(""),a(""),c(!1)},[e]),g(X,{children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.roomaccess.caption")}),o(y,{children:p("navigator.roomsettings.roomaccess.info")})]}),g(D,{overflow:"auto",children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.doormode")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"lockState",checked:e.lockState===Ft.OPEN_STATE&&!l,onChange:h=>t("lock_state",Ft.OPEN_STATE)}),o(y,{children:p("navigator.roomsettings.doormode.open")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"lockState",checked:e.lockState===Ft.DOORBELL_STATE&&!l,onChange:h=>t("lock_state",Ft.DOORBELL_STATE)}),o(y,{children:p("navigator.roomsettings.doormode.doorbell")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"lockState",checked:e.lockState===Ft.INVISIBLE_STATE&&!l,onChange:h=>t("lock_state",Ft.INVISIBLE_STATE)}),o(y,{children:p("navigator.roomsettings.doormode.invisible")})]}),g(P,{fullWidth:!0,gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"lockState",checked:e.lockState===Ft.PASSWORD_STATE||l,onChange:h=>c(h.target.checked)}),!l&&e.lockState!==Ft.PASSWORD_STATE&&o(y,{children:p("navigator.roomsettings.doormode.password")}),(l||e.lockState===Ft.PASSWORD_STATE)&&g(D,{gap:1,children:[o(y,{children:p("navigator.roomsettings.doormode.password")}),o("input",{type:"password",className:"form-control form-control-sm col-4",value:s,onChange:h=>r(h.target.value),placeholder:p("navigator.roomsettings.password"),onFocus:h=>c(!0)}),l&&s.length<=0&&o(y,{bold:!0,small:!0,variant:"danger",children:p("navigator.roomsettings.passwordismandatory")}),o("input",{type:"password",className:"form-control form-control-sm col-4",value:i,onChange:h=>a(h.target.value),onBlur:u,placeholder:p("navigator.roomsettings.passwordconfirm")}),l&&s.length>0&&s!==i&&o(y,{bold:!0,small:!0,variant:"danger",children:p("navigator.roomsettings.invalidconfirm")})]})]})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.pets")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:e.allowPets,onChange:h=>t("allow_pets",h.target.checked)}),o(y,{children:p("navigator.roomsettings.allowpets")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:e.allowPetsEat,onChange:h=>t("allow_pets_eat",h.target.checked)}),o(y,{children:p("navigator.roomsettings.allowfoodconsume")})]})]})]})]})},vI=3,bI=60,PI=255,Ju=15,wJ=n=>{const{roomData:e=null,handleChange:t=null,onClose:s=null}=n,[r,i]=_.useState(""),[a,l]=_.useState(""),[c,u]=_.useState(""),[h,d]=_.useState(""),[f,E]=_.useState(0),[m,R]=_.useState(""),{showConfirm:I=null}=Xt(),{categories:S=null}=Mi();z(dN,b=>{const B=b.getParser();if(B)switch(B.code){case gr.ERROR_INVALID_TAG:R("navigator.roomsettings.unacceptablewords");case gr.ERROR_NON_USER_CHOOSABLE_TAG:R("navigator.roomsettings.nonuserchoosabletag");break;default:R("");break}});const A=()=>{I(p("navigator.roomsettings.deleteroom.confirm.message",["room_name"],[e.roomName]),()=>{V(new aD(e.roomId)),s&&s(),de("navigator/search/myworld_view")},null,null,null,p("navigator.roomsettings.deleteroom.confirm.title"))},N=()=>{r===e.roomName||r.length<vI||r.length>bI||t("name",r)},L=()=>{a===e.roomDescription||a.length>PI||t("description",a)},M=b=>{b===0&&c===e.tags[0]||c.length>Ju||b===1&&h===e.tags[1]||h.length>Ju||(c===""&&h!==""&&d(""),R(""),E(b),t("tags",c===""&&h!==""?[h]:[c,h]))};return _.useEffect(()=>{i(e.roomName),l(e.roomDescription),u(e.tags.length>0&&e.tags[0]?e.tags[0]:""),d(e.tags.length>0&&e.tags[1]?e.tags[1]:"")},[e]),g(X,{children:[g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("navigator.roomname")}),g(D,{fullWidth:!0,gap:0,children:[o("input",{className:"form-control form-control-sm",value:r,maxLength:bI,onChange:b=>i(b.target.value),onBlur:N}),r.length<vI&&o(y,{bold:!0,small:!0,variant:"danger",children:p("navigator.roomsettings.roomnameismandatory")})]})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("navigator.roomsettings.desc")}),o("textarea",{className:"form-control form-control-sm",value:a,maxLength:PI,onChange:b=>l(b.target.value),onBlur:L})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("navigator.category")}),o("select",{className:"form-select form-select-sm",value:e.categoryId,onChange:b=>t("category",b.target.value),children:S&&S.map(b=>o("option",{value:b.id,children:p(b.name)},b.id))})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("navigator.maxvisitors")}),o("select",{className:"form-select form-select-sm",value:e.userCount,onChange:b=>t("max_visitors",b.target.value),children:nI&&nI.map(b=>o("option",{value:b,children:b},b))})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("navigator.tradesettings")}),g("select",{className:"form-select form-select-sm",value:e.tradeState,onChange:b=>t("trade_state",b.target.value),children:[o("option",{value:"0",children:p("navigator.roomsettings.trade_not_allowed")}),o("option",{value:"1",children:p("navigator.roomsettings.trade_not_with_Controller")}),o("option",{value:"2",children:p("navigator.roomsettings.trade_allowed")})]})]}),g(P,{alignItems:"center",gap:1,children:[o(y,{className:"col-3",children:p("navigator.tags")}),g(D,{fullWidth:!0,gap:0,children:[o("input",{className:"form-control form-control-sm",value:c,onChange:b=>u(b.target.value),onBlur:()=>M(0)}),c.length>Ju&&o(y,{bold:!0,small:!0,variant:"danger",children:p("navigator.roomsettings.toomanycharacters")}),f===0&&m!=""&&o(y,{bold:!0,small:!0,variant:"danger",children:p(m)})]}),g(D,{fullWidth:!0,gap:0,children:[o("input",{className:"form-control form-control-sm",value:h,onChange:b=>d(b.target.value),onBlur:()=>M(1)}),h.length>Ju&&o(y,{bold:!0,small:!0,variant:"danger",children:p("navigator.roomsettings.toomanycharacters")}),f===1&&m!=""&&o(y,{bold:!0,small:!0,variant:"danger",children:p(m)})]})]}),g(P,{alignItems:"center",gap:1,children:[o(j,{className:"col-3"}),o("input",{className:"form-check-input",type:"checkbox",checked:e.allowWalkthrough,onChange:b=>t("allow_walkthrough",b.target.checked)}),o(y,{children:p("navigator.roomsettings.allow_walk_through")})]}),g(y,{variant:"danger",underline:!0,bold:!0,pointer:!0,className:"d-flex justify-content-center align-items-center gap-1",onClick:A,children:[o(ei,{className:"fa-icon"}),p("navigator.roomsettings.delete")]})]})},GJ=n=>{var c;const{roomData:e=null,handleChange:t=null}=n,[s,r]=_.useState(-1),[i,a]=_.useState([]),l=u=>{a(h=>{const d=[...h],f=d.findIndex(E=>E.userId===u);return f>=0&&d.splice(f,1),d}),V(new uD(u,e.roomId)),r(-1)};return z(oN,u=>{const h=u.getParser();!e||e.roomId!==h.roomId||a(h.bannedUsers)}),_.useEffect(()=>{V(new aE(e.roomId))},[e.roomId]),g(ge,{overflow:"auto",children:[g(D,{size:6,children:[g(y,{bold:!0,children:[p("navigator.roomsettings.moderation.banned.users")," (",i.length,")"]}),o(P,{overflow:"hidden",className:"bg-white rounded list-container p-2",children:o(D,{fullWidth:!0,overflow:"auto",gap:1,children:i&&i.length>0&&i.map((u,h)=>g(P,{shrink:!0,alignItems:"center",gap:1,overflow:"hidden",children:[o(Ci,{userName:u.userName}),g(y,{pointer:!0,grow:!0,onClick:d=>r(u.userId),children:[" ",u.userName]})]},h))})}),g(H,{disabled:s<=0,onClick:u=>l(s),children:[p("navigator.roomsettings.moderation.unban")," ",s>0&&((c=i.find(u=>u.userId===s))==null?void 0:c.userName)]})]}),g(D,{size:6,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.moderation.mute.header")}),o(P,{alignItems:"center",gap:1,children:g("select",{className:"form-select form-select-sm",value:e.moderationSettings.allowMute,onChange:u=>t("moderation_mute",u.target.value),children:[o("option",{value:ar.MODERATION_LEVEL_NONE,children:p("navigator.roomsettings.moderation.none")}),o("option",{value:ar.MODERATION_LEVEL_USER_WITH_RIGHTS,children:p("navigator.roomsettings.moderation.rights")})]})})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.moderation.kick.header")}),o(P,{alignItems:"center",gap:1,children:g("select",{className:"form-select form-select-sm",value:e.moderationSettings.allowKick,onChange:u=>t("moderation_kick",u.target.value),children:[o("option",{value:ar.MODERATION_LEVEL_NONE,children:p("navigator.roomsettings.moderation.none")}),o("option",{value:ar.MODERATION_LEVEL_USER_WITH_RIGHTS,children:p("navigator.roomsettings.moderation.rights")}),o("option",{value:ar.MODERATION_LEVEL_ALL,children:p("navigator.roomsettings.moderation.all")})]})})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.moderation.ban.header")}),o(P,{alignItems:"center",gap:1,children:g("select",{className:"form-select form-select-sm",value:e.moderationSettings.allowBan,onChange:u=>t("moderation_ban",u.target.value),children:[o("option",{value:ar.MODERATION_LEVEL_NONE,children:p("navigator.roomsettings.moderation.none")}),o("option",{value:ar.MODERATION_LEVEL_USER_WITH_RIGHTS,children:p("navigator.roomsettings.moderation.rights")})]})})]})]})]})},BJ=n=>{const{roomData:e=null}=n,[t,s]=_.useState(new Map);return z(uN,r=>{const i=r.getParser();!e||e.roomId!==i.roomId||s(i.users)}),z(lN,r=>{const i=r.getParser();!e||e.roomId!==i.roomId||s(a=>{const l=new Map(a);return l.set(i.data.userId,i.data.userName),l})}),z(cN,r=>{const i=r.getParser();!e||e.roomId!==i.roomId||s(a=>{const l=new Map(a);return l.delete(i.userId),l})}),_.useEffect(()=>{V(new dD(e.roomId))},[e.roomId]),g(ge,{children:[g(D,{size:6,children:[o(y,{bold:!0,children:p("navigator.flatctrls.userswithrights",["displayed","total"],[t.size.toString(),t.size.toString()])}),o(P,{overflow:"hidden",className:"bg-white rounded list-container p-2",children:o(D,{fullWidth:!0,overflow:"auto",gap:1,children:Array.from(t.entries()).map(([r,i],a)=>g(P,{shrink:!0,alignItems:"center",gap:1,overflow:"hidden",children:[o(Ci,{userName:i}),g(y,{pointer:!0,grow:!0,onClick:l=>V(new nE(r)),children:[" ",i]})]},a))})})]}),o(D,{size:6,justifyContent:"end",children:o(H,{variant:"danger",disabled:!t.size,onClick:r=>V(new rD(e.roomId)),children:p("navigator.flatctrls.clear")})})]})},kJ=n=>{const{roomData:e=null,handleChange:t=null}=n,[s,r]=_.useState(0);return _.useEffect(()=>{r(e.chatSettings.distance)},[e.chatSettings]),g(X,{children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.vip.caption")}),o(y,{children:p("navigator.roomsettings.vip.info")})]}),g(ge,{overflow:"auto",children:[g(D,{size:6,gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.chat_settings")}),o(y,{children:p("navigator.roomsettings.chat_settings.info")}),g("select",{className:"form-select form-select-sm",value:e.chatSettings.mode,onChange:i=>t("bubble_mode",i.target.value),children:[o("option",{value:dt.CHAT_MODE_FREE_FLOW,children:p("navigator.roomsettings.chat.mode.free.flow")}),o("option",{value:dt.CHAT_MODE_LINE_BY_LINE,children:p("navigator.roomsettings.chat.mode.line.by.line")})]}),g("select",{className:"form-select form-select-sm",value:e.chatSettings.weight,onChange:i=>t("chat_weight",i.target.value),children:[o("option",{value:dt.CHAT_BUBBLE_WIDTH_NORMAL,children:p("navigator.roomsettings.chat.bubbles.width.normal")}),o("option",{value:dt.CHAT_BUBBLE_WIDTH_THIN,children:p("navigator.roomsettings.chat.bubbles.width.thin")}),o("option",{value:dt.CHAT_BUBBLE_WIDTH_WIDE,children:p("navigator.roomsettings.chat.bubbles.width.wide")})]}),g("select",{className:"form-select form-select-sm",value:e.chatSettings.speed,onChange:i=>t("bubble_speed",i.target.value),children:[o("option",{value:dt.CHAT_SCROLL_SPEED_FAST,children:p("navigator.roomsettings.chat.speed.fast")}),o("option",{value:dt.CHAT_SCROLL_SPEED_NORMAL,children:p("navigator.roomsettings.chat.speed.normal")}),o("option",{value:dt.CHAT_SCROLL_SPEED_SLOW,children:p("navigator.roomsettings.chat.speed.slow")})]}),g("select",{className:"form-select form-select-sm",value:e.chatSettings.protection,onChange:i=>t("flood_protection",i.target.value),children:[o("option",{value:dt.FLOOD_FILTER_LOOSE,children:p("navigator.roomsettings.chat.flood.loose")}),o("option",{value:dt.FLOOD_FILTER_NORMAL,children:p("navigator.roomsettings.chat.flood.normal")}),o("option",{value:dt.FLOOD_FILTER_STRICT,children:p("navigator.roomsettings.chat.flood.strict")})]}),o(y,{children:p("navigator.roomsettings.chat_settings.hearing.distance")}),o("input",{type:"number",min:"0",className:"form-control form-control-sm",value:s,onChange:i=>r(i.target.valueAsNumber),onBlur:i=>t("chat_distance",s)})]}),g(D,{size:6,gap:1,children:[o(y,{bold:!0,children:p("navigator.roomsettings.vip_settings")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:e.hideWalls,onChange:i=>t("hide_walls",i.target.checked)}),o(y,{children:p("navigator.roomsettings.hide_walls")})]}),g("select",{className:"form-select form-select-sm",value:e.wallThickness,onChange:i=>t("wall_thickness",i.target.value),children:[o("option",{value:"0",children:p("navigator.roomsettings.wall_thickness.normal")}),o("option",{value:"1",children:p("navigator.roomsettings.wall_thickness.thick")}),o("option",{value:"-1",children:p("navigator.roomsettings.wall_thickness.thin")}),o("option",{value:"-2",children:p("navigator.roomsettings.wall_thickness.thinnest")})]}),g("select",{className:"form-select form-select-sm",value:e.floorThickness,onChange:i=>t("floor_thickness",i.target.value),children:[o("option",{value:"0",children:p("navigator.roomsettings.floor_thickness.normal")}),o("option",{value:"1",children:p("navigator.roomsettings.floor_thickness.thick")}),o("option",{value:"-1",children:p("navigator.roomsettings.floor_thickness.thin")}),o("option",{value:"-2",children:p("navigator.roomsettings.floor_thickness.thinnest")})]})]})]})]})},_a=["navigator.roomsettings.tab.1","navigator.roomsettings.tab.2","navigator.roomsettings.tab.3","navigator.roomsettings.tab.4","navigator.roomsettings.tab.5"],VJ=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(_a[0]);z(hN,l=>{const c=l.getParser();if(!c)return;const u=c.data;t({roomId:u.roomId,roomName:u.name,roomDescription:u.description,categoryId:u.categoryId,userCount:u.maximumVisitorsLimit,tags:u.tags,tradeState:u.tradeMode,allowWalkthrough:u.allowWalkThrough,lockState:u.doorMode,password:null,allowPets:u.allowPets,allowPetsEat:u.allowFoodConsume,hideWalls:u.hideWalls,wallThickness:u.wallThickness,floorThickness:u.floorThickness,chatSettings:{mode:u.chatSettings.mode,weight:u.chatSettings.weight,speed:u.chatSettings.speed,distance:u.chatSettings.distance,protection:u.chatSettings.protection},moderationSettings:{allowMute:u.roomModerationSettings.allowMute,allowKick:u.roomModerationSettings.allowKick,allowBan:u.roomModerationSettings.allowBan}}),V(new aE(u.roomId))});const i=()=>{t(null),r(_a[0])},a=(l,c)=>{t(u=>{const h={...u};switch(l){case"name":h.roomName=String(c);break;case"description":h.roomDescription=String(c);break;case"category":h.categoryId=Number(c);break;case"max_visitors":h.userCount=Number(c);break;case"trade_state":h.tradeState=Number(c);break;case"tags":h.tags=c;break;case"allow_walkthrough":h.allowWalkthrough=!!c;break;case"allow_pets":h.allowPets=!!c;break;case"allow_pets_eat":h.allowPetsEat=!!c;break;case"hide_walls":h.hideWalls=!!c;break;case"wall_thickness":h.wallThickness=Number(c);break;case"floor_thickness":h.floorThickness=Number(c);break;case"lock_state":h.lockState=Number(c);break;case"password":h.lockState=Ft.PASSWORD_STATE,h.password=String(c);break;case"moderation_mute":h.moderationSettings.allowMute=Number(c);break;case"moderation_kick":h.moderationSettings.allowKick=Number(c);break;case"moderation_ban":h.moderationSettings.allowBan=Number(c);break;case"bubble_mode":h.chatSettings.mode=Number(c);break;case"chat_weight":h.chatSettings.weight=Number(c);break;case"bubble_speed":h.chatSettings.speed=Number(c);break;case"flood_protection":h.chatSettings.protection=Number(c);break;case"chat_distance":h.chatSettings.distance=Number(c);break}return V(new _D(h.roomId,h.roomName,h.roomDescription,h.lockState,h.password,h.userCount,h.categoryId,h.tags.length,h.tags,h.tradeState,h.allowPets,h.allowPetsEat,h.allowWalkthrough,h.hideWalls,h.wallThickness,h.floorThickness,h.moderationSettings.allowMute,h.moderationSettings.allowKick,h.moderationSettings.allowBan,h.chatSettings.mode,h.chatSettings.weight,h.chatSettings.speed,h.chatSettings.distance,h.chatSettings.protection)),h})};return e?g(Re,{uniqueKey:"nitro-room-settings",className:"nitro-room-settings",children:[o(Te,{headerText:p("navigator.roomsettings"),onCloseClick:i}),o(aa,{children:_a.map(l=>o(Yi,{isActive:s===l,onClick:c=>r(l),children:p(l)},l))}),g(Ee,{children:[s===_a[0]&&o(wJ,{roomData:e,handleChange:a,onClose:i}),s===_a[1]&&o(xJ,{roomData:e,handleChange:a}),s===_a[2]&&o(BJ,{roomData:e,handleChange:a}),s===_a[3]&&o(kJ,{roomData:e,handleChange:a}),s===_a[4]&&o(GJ,{roomData:e,handleChange:a})]})]}):null},LI=n=>{const{roomData:e=null}=n,[t,s]=_.useState(!1),r=_.useRef(),i=()=>{const a=100*(e.userCount/e.maxUserCount);let l="bg-primary";return a>=92?l="bg-danger":a>=50?l="bg-warning":a>0&&(l="bg-success"),l};return g(X,{children:[o(j,{pointer:!0,innerRef:r,className:"icon icon-navigator-info",onMouseOver:a=>s(!0),onMouseLeave:a=>s(!1)}),o(IT,{show:t,target:r.current,placement:"right",children:o(Ah,{children:o(Ee,{overflow:"hidden",className:"room-info image-rendering-pixelated bg-transparent",children:g(P,{gap:2,overflow:"hidden",children:[g(__,{roomId:e.roomId,customUrl:e.officialRoomPicRef,className:"d-flex flex-column align-items-center justify-content-end mb-1",children:[e.habboGroupId>0&&o(xt,{badgeCode:e.groupBadgeCode,isGroup:!0,className:"position-absolute top-0 start-0 m-1 "}),e.doorMode!==Ft.OPEN_STATE&&o("i",{className:"position-absolute end-0 mb-1 me-1 icon icon-navigator-room-"+(e.doorMode===Ft.DOORBELL_STATE?"locked":e.doorMode===Ft.PASSWORD_STATE?"password":e.doorMode===Ft.INVISIBLE_STATE?"invisible":"")})]}),g(D,{gap:1,children:[o(y,{bold:!0,truncate:!0,className:"flex-grow-1",style:{maxHeight:13},children:e.roomName}),g(P,{gap:2,children:[o(y,{italics:!0,variant:"muted",children:p("navigator.roomownercaption")}),g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:e.ownerId}),o(y,{italics:!0,children:e.ownerName})]})]}),o(y,{className:"flex-grow-1",children:e.description}),g(P,{className:"badge p-1 position-absolute m-1 bottom-0 end-0 m-2 "+i(),gap:1,children:[o(ug,{className:"fa-icon"}),e.userCount]})]})]})})})})]})},UI=n=>{const{roomData:e=null,children:t=null,thumbnail:s=!1,...r}=n,{setDoorData:i=null}=Mi(),a=()=>{const c=100*(e.userCount/e.maxUserCount);let u="bg-primary";return c>=92?u="bg-danger":c>=50?u="bg-warning":c>0&&(u="bg-success"),u},l=c=>{if(e.ownerId!==$().userId){if(e.habboGroupId!==0){Wi(e.roomId);return}switch(e.doorMode){case Ft.DOORBELL_STATE:i(u=>{const h={...u};return h.roomInfo=e,h.state=ut.START_DOORBELL,h});return;case Ft.PASSWORD_STATE:i(u=>{const h={...u};return h.roomInfo=e,h.state=ut.START_PASSWORD,h});return}}po(e.roomId)};return s?g(D,{pointer:!0,overflow:"hidden",alignItems:"center",onClick:l,gap:0,className:"navigator-item p-1 bg-light rounded-3 small mb-1 flex-column border border-muted",...r,children:[g(__,{roomId:e.roomId,customUrl:e.officialRoomPicRef,className:"d-flex flex-column align-items-center justify-content-end mb-1",children:[e.habboGroupId>0&&o(xt,{badgeCode:e.groupBadgeCode,isGroup:!0,className:"position-absolute top-0 start-0 m-1"}),g(P,{center:!0,className:"badge p-1 position-absolute m-1 "+a(),gap:1,children:[o(ug,{className:"fa-icon"}),e.userCount]}),e.doorMode!==Ft.OPEN_STATE&&o("i",{className:"position-absolute end-0 mb-1 me-1 icon icon-navigator-room-"+(e.doorMode===Ft.DOORBELL_STATE?"locked":e.doorMode===Ft.PASSWORD_STATE?"password":e.doorMode===Ft.INVISIBLE_STATE?"invisible":"")})]}),g(P,{className:"w-100",children:[o(y,{truncate:!0,className:"flex-grow-1",children:e.roomName}),o(P,{reverse:!0,alignItems:"center",gap:1,children:o(LI,{roomData:e})}),t]})]}):g(P,{pointer:!0,overflow:"hidden",alignItems:"center",onClick:l,gap:2,className:"navigator-item px-2 py-1 small",...r,children:[g(P,{center:!0,className:"badge p-1 "+a(),gap:1,children:[o(ug,{className:"fa-icon"}),e.userCount]}),o(y,{truncate:!0,grow:!0,children:e.roomName}),g(P,{reverse:!0,alignItems:"center",gap:1,children:[o(LI,{roomData:e}),e.habboGroupId>0&&o("i",{className:"icon icon-navigator-room-group"}),e.doorMode!==Ft.OPEN_STATE&&o("i",{className:"icon icon-navigator-room-"+(e.doorMode===Ft.DOORBELL_STATE?"locked":e.doorMode===Ft.PASSWORD_STATE?"password":e.doorMode===Ft.INVISIBLE_STATE?"invisible":"")})]}),t]})},HJ=n=>{const{searchResult:e=null,...t}=n,[s,r]=_.useState(!0),[i,a]=_.useState(0),{topLevelContext:l=null}=Mi(),c=()=>{let f=e.code;return!f||!f.length||p("navigator.searchcode.title."+f)=="navigator.searchcode.title."+f?e.data:f.startsWith("${")?f.slice(2,f.length-1):"navigator.searchcode.title."+f},u=()=>{a(f=>f===Gn.LIST?Gn.THUMBNAILS:Gn.LIST)},h=()=>{e.action==1?V(new Co(e.code,"")):e.action==2&&l&&V(new Co(l.code,""))};_.useEffect(()=>{e&&(r(!e.closed),a(e.mode))},[e]);const d=i>=Gn.THUMBNAILS;return g(D,{className:"bg-white rounded border border-muted",gap:0,children:[g(P,{fullWidth:!0,alignItems:"center",justifyContent:"between",className:"px-2 py-1",children:[g(P,{grow:!0,pointer:!0,alignItems:"center",gap:1,onClick:f=>r(E=>!E),children:[s&&o(RU,{className:"text-secondary fa-icon"}),!s&&o(Qc,{className:"text-secondary fa-icon"}),o(y,{children:p(c())})]}),g(P,{gap:2,children:[i===Gn.LIST&&o(OU,{className:"text-secondary fa-icon",onClick:u}),i>=Gn.THUMBNAILS&&o(SU,{className:"text-secondary fa-icon",onClick:u}),e.action>0&&e.action===1&&o(CU,{className:"text-secondary fa-icon",onClick:h}),e.action>0&&e.action!==1&&o(AU,{className:"text-secondary fa-icon",onClick:h})]})]})," ",s&&o(X,{children:d?o(Ot,{columnCount:3,...t,columnMinWidth:110,columnMinHeight:130,className:"mx-2",children:e.rooms.length>0&&e.rooms.map((f,E)=>o(UI,{roomData:f,thumbnail:!0},E))}):o(ge,{columnCount:1,className:"navigator-grid",gap:0,children:e.rooms.length>0&&e.rooms.map((f,E)=>o(UI,{roomData:f},E))})})]})},jJ=n=>{const{sendSearch:e=null}=n,[t,s]=_.useState(0),[r,i]=_.useState(""),{topLevelContext:a=null,searchResult:l=null}=Mi(),c=()=>{if(!a)return;let h=Wo[t];h||(h=Wo[0]);const d=(h.query?h.query+":":"")+r;e(d||"",a.code)},u=h=>{h.key==="Enter"&&c()};return _.useEffect(()=>{if(!l)return;const h=l.data.split(":");let d=null,f="";if(h.length>=2){const[E,...m]=h;d=Wo.find(R=>R.query===E),f=m.join(":")}else f=l.data;d||(d=Wo[0]),s(Wo.findIndex(E=>E===d)),i(f)},[l]),g(P,{fullWidth:!0,gap:1,children:[o(P,{shrink:!0,children:o("select",{className:"form-select form-select-sm",value:t,onChange:h=>s(parseInt(h.target.value)),children:Wo.map((h,d)=>o("option",{value:d,children:p("navigator.filter."+h.name)},d))})}),g(P,{fullWidth:!0,gap:1,children:[o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("navigator.filter.input.placeholder"),value:r,onChange:h=>i(h.target.value),onKeyDown:h=>u(h)}),o(H,{variant:"primary",onClick:c,children:o(rm,{className:"fa-icon"})})]})]})},WJ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(!1),[i,a]=_.useState(!1),[l,c]=_.useState(!1),[u,h]=_.useState(!1),[d,f]=_.useState(!1),[E,m]=_.useState(!0),[R,I]=_.useState(!1),{searchResult:S=null,topLevelContext:A=null,topLevelContexts:N=null,navigatorData:L=null}=Mi(),M=_.useRef(null),b=_.useRef();kt(Ne.CREATED,x=>{t(!1),a(!1)});const B=_.useCallback((x,U)=>{a(!1),V(new Co(U,x)),f(!0)},[]),w=_.useCallback(()=>{if(!s){I(!0);return}if(M.current){B(M.current.value,M.current.code),M.current=null;return}if(S){B(S.data,S.code);return}A&&B("",A.code)},[s,S,A,B]);return _.useEffect(()=>{const x={linkReceived:U=>{const G=U.split("/");if(!(G.length<2))switch(G[1]){case"show":{t(!0),I(!0);return}case"hide":t(!1);return;case"toggle":{if(e){t(!1);return}t(!0),I(!0);return}case"toggle-room-info":c(K=>!K);return;case"toggle-room-link":h(K=>!K);return;case"goto":if(G.length<=2)return;switch(G[2]){case"home":if(L.homeRoomId<=0)return;Wi(L.homeRoomId);break;default:{const K=parseInt(G[2]);Wi(K)}}return;case"create":t(!0),a(!0);return;case"search":if(G.length>2){const K=G[2];let Y="";G.length>3&&(Y=G[3]),M.current={value:Y,code:K},t(!0),I(!0)}return}},eventUrlPrefix:"navigator/"};return Cs(x),()=>As(x)},[e,L]),_.useEffect(()=>{S&&(f(!1),b&&b.current&&(b.current.scrollTop=0))},[S]),_.useEffect(()=>{!e||!s||!R||(w(),I(!1))},[e,s,R,w]),_.useEffect(()=>{s||!A||r(!0)},[s,A]),_.useEffect(()=>{!e||!E||(V(new BM),m(!1))},[e,E]),_.useEffect(()=>{Je.addCallback(ra.OPENROOM,(x,U=!1,G=null)=>V(new UM(x)))},[]),g(X,{children:[e&&g(Re,{uniqueKey:"navigator",className:"nitro-navigator",children:[o(Te,{headerText:p(i?"navigator.createroom.title":"navigator.title"),onCloseClick:x=>t(!1)}),g(aa,{children:[N&&N.length>0&&N.map((x,U)=>o(Yi,{isActive:A===x&&!i,onClick:G=>B("",x.code),children:p("navigator.toplevelview."+x.code)},U)),o(Yi,{isActive:i,onClick:x=>a(!0),children:o(Qc,{className:"fa-icon"})})]}),g(Ee,{position:"relative",children:[d&&o(j,{fit:!0,position:"absolute",className:"top-0 start-0 z-index-1 bg-muted opacity-0-5"}),!i&&g(X,{children:[o(jJ,{sendSearch:B}),o(D,{innerRef:b,overflow:"auto",children:S&&S.results.map((x,U)=>o(HJ,{searchResult:x},U))})]}),i&&o(LJ,{})]})]}),o(PJ,{}),l&&o(UJ,{onCloseClick:()=>c(!1)}),u&&o(FJ,{onCloseClick:()=>h(!1)}),o(VJ,{})]})},YJ=/\n\r|\n|\r/mg,zJ=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(""),[i,a]=_.useState(null),l=_.useRef(null);return _.useEffect(()=>{const c=async h=>{try{const d=await fetch(h);if(!d)return;const E=(await d.text()).split(YJ),m=E.shift().split("|");r(m[0]),a(R=>m[1]&&m[1].split(";").length===2?{width:parseInt(m[1].split(";")[0]),height:parseInt(m[1].split(";")[1])}:null),t(E.join(""))}catch{me.error(`Failed to fetch ${h}`)}},u={linkReceived:h=>{const d=h.split("/");d.length<2||(d.shift(),c(ce("habbopages.url")+d.join("/")))},eventUrlPrefix:"habbopages/"};return Cs(u),()=>As(u)},[]),_.useEffect(()=>{const c=u=>{if(!(u.target instanceof HTMLAnchorElement))return;u.preventDefault();const h=u.target.href;!h||!h.length||Ou(h)};return document.addEventListener("click",c),()=>{document.removeEventListener("click",c)}},[]),e?g(Re,{className:"nitropedia",theme:"primary-slim",style:i?{width:i.width,height:i.height}:{},children:[o(Te,{headerText:s,onCloseClick:()=>t(null)}),o(Ee,{children:o(j,{fit:!0,innerRef:l,className:"text-black",dangerouslySetInnerHTML:{__html:e}})})]}):null},KJ=n=>{const{offer:e=null,setOpen:t=null}=n;if(e)return g(tp,{fadesOut:!1,onClose:null,onClick:s=>t(!0),gap:2,children:[o(j,{className:"nitro-targeted-offer-icon",style:{backgroundImage:`url(${ce("image.library.url")+e.iconImageUrl})`}}),o(y,{variant:"light",className:"ubuntu-bold",children:e.title})]})},XJ=n=>{const{offer:e=null,setOpen:t=null}=n,{getCurrencyAmount:s}=ko(),[r,i]=_.useState(1),a=_.useMemo(()=>{let u=!1,h=!1,d=!1;return e.priceInCredits>0&&(u=s(-1)>=e.priceInCredits),e.priceInActivityPoints>0?h=s(e.activityPointType)>=e.priceInActivityPoints:h=!0,e.purchaseLimit>0&&(d=!0),u&&h&&d},[e,s]),l=()=>{let u=Math.max(0,(e.expirationTime-Date.now())/1e3);return Jn.format(u)},c=()=>{V(new ny(e.id,r)),V(new eE)};if(e)return g(Re,{theme:"primary-slim",uniqueKey:"targeted-offer",className:"nitro-targeted-offer",children:[o(Te,{headerText:p(e.title),onCloseClick:u=>t(!1)}),o(HP,{position:"relative",className:"justify-content-center align-items-center cursor-pointer",variant:"danger",gap:3,children:p("targeted.offer.timeleft",["timeleft"],[l()])}),g(Ee,{gap:1,children:[g(P,{gap:1,fullHeight:!0,children:[g(P,{gap:1,column:!0,className:"w-75 text-black",children:[g(D,{className:"bg-warning p-2",fullHeight:!0,children:[o("h4",{children:p(e.title)}),o(j,{dangerouslySetInnerHTML:{__html:e.description}})]}),g(P,{alignSelf:"center",alignItems:"center",justifyContent:"center",gap:2,children:[e.purchaseLimit>1&&g(P,{gap:1,children:[o(y,{variant:"muted",children:p("catalog.bundlewidget.quantity")}),o("input",{type:"number",value:r,onChange:u=>i(parseInt(u.target.value)),min:1,max:e.purchaseLimit})]}),o(H,{variant:"primary",disabled:!a,onClick:()=>c(),children:p("targeted.offer.button.buy")})]})]}),o(j,{className:"w-50",fullHeight:!0,style:{background:`url(${ce("image.library.url")+e.imageUrl}) no-repeat center`}})]}),g(P,{className:"price-ray position-absolute",alignItems:"center",justifyContent:"center",column:!0,children:[o(y,{children:p("targeted.offer.price.label")}),e.priceInCredits>0&&g(P,{gap:1,children:[o(y,{variant:"light",children:e.priceInCredits}),o(gs,{type:-1})]}),e.priceInActivityPoints>0&&g(P,{gap:1,children:[g(y,{className:"ubuntu-bold",variant:"light",children:["+",e.priceInActivityPoints]})," ",o(gs,{type:e.activityPointType})]})]})]})]})},qJ=()=>{const[n,e]=_.useState(null),[t,s]=_.useState(!1);if(z(SS,r=>{let i=r.getParser();i&&e(i.data)}),pL(()=>{V(new eE)}),!!n)return o(X,{children:t?o(XJ,{offer:n,setOpen:s}):o(KJ,{offer:n,setOpen:s})})},QJ=n=>{const[e,t]=_.useState(0),[s,r]=_.useState(null),[i,a]=_.useState(!0),{showConfirm:l=null}=Xt();z(Gc,f=>{t(0),r(null)}),z(Wm,f=>{t(0),r(null)}),z(sa,f=>{const E=f.getParser();E.roomEnter&&(E.data.habboGroupId>0?(t(E.data.habboGroupId),V(new yl(E.data.habboGroupId,!1))):(t(0),r(null)))}),z(jS,f=>{const E=f.getParser();!s||E.groupId!==s.id&&E.groupId!==e||(t(0),r(null))}),z(jl,f=>{const E=f.getParser();E.id===e&&r(E)});const c=()=>{l(p("group.leaveconfirm.desc"),()=>{V(new Gd(s.id,$().userId))},null)},u=s&&s.ownerName===$().userName,h=()=>{if(u)return"group.manage";if(s.type===Ur.PRIVATE)return"";if(s.membershipType===ps.MEMBER)return"group.leave";if(s.membershipType===ps.NOT_MEMBER&&s.type===Ur.REGULAR)return"group.join";if(s.membershipType===ps.REQUEST_PENDING)return"group.membershippending";if(s.membershipType===ps.NOT_MEMBER&&s.type===Ur.EXCLUSIVE)return"group.requestmembership"},d=()=>{if(u)return AP(s.id);if(!(s.type===Ur.PRIVATE&&s.membershipType===ps.NOT_MEMBER)){if(s.membershipType===ps.MEMBER){c();return}JE(s.id)}};return s?o(j,{className:"nitro-notification-bubble rounded",children:g(D,{children:[g(P,{alignItems:"center",justifyContent:"between",pointer:!0,onClick:f=>a(E=>!E),children:[o(y,{variant:"white",children:p("group.homeroominfo.title")}),i&&o(im,{className:"fa-icon"}),!i&&o(nm,{className:"fa-icon"})]}),i&&g(X,{children:[g(P,{pointer:!0,alignItems:"center",gap:2,onClick:f=>Mu(s.id),children:[o(j,{className:"group-badge",children:o(xt,{badgeCode:s.badge,isGroup:!0})}),o(y,{variant:"white",children:s.title})]}),(s.type!==Ur.PRIVATE||u)&&o(H,{fullWidth:!0,variant:"success",disabled:s.membershipType===ps.REQUEST_PENDING,onClick:d,children:p(h())})]})]})}):null},JJ=n=>{const{title:e="Nitro",onClose:t=null,...s}=n;return o(u_,{title:e,onClose:t,...s,children:g(ge,{children:[o(D,{center:!0,size:5,children:o("object",{data:"https://assets.nitrodev.co/logos/nitro-n-dark.svg",width:"100",height:"100",children:" "})}),g(D,{size:7,children:[g(D,{alignItems:"center",gap:0,children:[o(y,{bold:!0,fontSize:4,children:"Nitro React"}),g(y,{children:["v",CP()]})]}),g(D,{alignItems:"center",children:[g(y,{children:[o("b",{children:"Renderer:"})," v",rq()]}),g(D,{fullWidth:!0,gap:1,children:[o(H,{fullWidth:!0,variant:"success",onClick:r=>window.open("https://discord.nitrodev.co"),children:"Discord"}),g(P,{gap:1,children:[o(H,{fullWidth:!0,onClick:r=>window.open("https://git.krews.org/nitro/nitro-react"),children:"Git"}),o(H,{fullWidth:!0,onClick:r=>window.open("https://git.krews.org/nitro/nitro-react/-/issues"),children:"Bug Report"})]})]})]})]})]})})},ZJ=n=>{const{item:e=null,title:t=n.item&&n.item.title||"",onClose:s=null,...r}=n,[i,a]=_.useState(!1),l=()=>{Ou(e.clickUrl),s()},c=e.alertType===Le.DEFAULT;return g(u_,{title:t,onClose:s,...r,type:c?Le.DEFAULT:e.alertType,children:[g(P,{fullHeight:!0,overflow:"auto",gap:c||e.imageUrl&&!i?2:0,children:[c&&!e.imageUrl&&o(j,{className:"notification-frank flex-shrink-0"}),e.imageUrl&&!i&&o("img",{src:e.imageUrl,alt:e.title,onError:()=>{a(!0)},className:"align-self-baseline"}),g(j,{classNames:["notification-text overflow-y-auto d-flex flex-column w-100",e.clickUrl&&!c?"justify-content-center":""],children:[e.messages.length>0&&e.messages.map((u,h)=>{const d=u.replace(/\r\n|\r|\n/g,"<br />");return o(j,{dangerouslySetInnerHTML:{__html:d}},h)}),e.clickUrl&&e.clickUrl.length>0&&e.imageUrl&&!i&&g(X,{children:[o("hr",{className:"my-2 w-100"}),o(H,{onClick:l,className:"align-self-center px-3",children:p(e.clickUrlText)})]})]})]}),(!e.imageUrl||e.imageUrl&&i)&&o(X,{children:g(D,{alignItems:"center",center:!0,gap:0,children:[o("hr",{className:"my-2 w-100"}),!e.clickUrl&&o(H,{onClick:s,children:p("generic.close")}),e.clickUrl&&e.clickUrl.length>0&&o(H,{onClick:l,children:p(e.clickUrlText)})]})})]})},$J=n=>{const{item:e=null,title:t=n.item&&n.item.title||"",onClose:s=null,...r}=n,[i,a]=_.useState(""),[l,c]=_.useState([]),u=()=>{Ou(e.clickUrl),s()},h=f=>{let E=JSON.parse(e.messages[0]);c(E.filter(m=>m.includes(f))),a(f)};_.useEffect(()=>{c(JSON.parse(e.messages[0]))},[e]);const d=e.clickUrl&&e.clickUrl.startsWith("event:");return g(u_,{title:t,onClose:s,...r,children:[o(P,{fullWidth:!0,alignItems:"center",position:"relative",children:o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("generic.search"),value:i,onChange:f=>h(f.target.value)})}),o(D,{fullHeight:!0,className:"py-1",overflow:"hidden",children:o(Ot,{gap:1,columnCount:1,children:l&&l.map((f,E)=>o("span",{children:f},E))})}),o("hr",{className:"my-2"}),g(D,{alignItems:"center",center:!0,gap:1,children:[!d&&!e.clickUrl&&o(H,{onClick:s,children:p("generic.close")}),e.clickUrl&&e.clickUrl.length>0&&o(H,{onClick:u,children:p(e.clickUrlText)})]})]})},eZ=(n,e)=>{if(!n)return null;const t={key:n.id,item:n,onClose:e};switch(n.alertType){case Le.NITRO:return o(JJ,{...t});case Le.SEARCH:return o($J,{...t});default:return o(ZJ,{...t})}},tZ=n=>{const{item:e=null,onClose:t=null,...s}=n;return g(tp,{fadesOut:!1,className:"flex-column club-gift",onClose:t,...s,children:[g("div",{className:"d-flex align-items-center gap-2 mb-2",children:[o(gs,{type:"hc",className:"flex-shrink-0"}),o("span",{className:"ms-1",children:p("notifications.text.club_gift")})]}),g("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[o("button",{type:"button",className:"btn btn-success w-100 btn-sm",onClick:()=>Ou(e.linkUrl),children:p("notifications.button.show_gift_list")}),o("span",{className:"text-decoration-underline cursor-pointer text-nowrap",onClick:t,children:p("notifications.button.later")})]})]})},sZ=n=>{const{item:e=null,onClose:t=null,...s}=n,r=e.message.replace(/\r\n|\r|\n/g,"<br />");return g(tp,{onClose:t,gap:2,alignItems:"center",onClick:i=>e.linkUrl&&e.linkUrl.length&&Ou(e.linkUrl),...s,children:[o(P,{center:!0,className:"bubble-image-container",children:e.iconUrl&&e.iconUrl.length&&o("img",{className:"no-select",src:e.iconUrl,alt:""})}),o(y,{wrap:!0,variant:"white",dangerouslySetInnerHTML:{__html:r}})]})},rZ=(n,e)=>{if(!n)return null;const t={key:n.id,item:n,onClose:e};switch(n.notificationType){case Bt.CLUBGIFT:return o(tZ,{...t});default:return o(sZ,{...t})}},iZ=n=>{const{item:e=null,onClose:t=null,...s}=n,{message:r=null,onConfirm:i=null,onCancel:a=null,confirmText:l=null,cancelText:c=null,title:u=null}=e,h=()=>{i&&i(),t()},d=()=>{a&&a(),t()};return g(u_,{title:u,onClose:t,...s,type:Le.ALERT,children:[o(P,{grow:!0,center:!0,children:o(y,{children:r})}),g(P,{gap:1,children:[o(H,{fullWidth:!0,variant:"danger",onClick:d,children:c}),o(H,{fullWidth:!0,onClick:h,children:l})]})]})},nZ=(n,e)=>{if(!n)return null;const t={key:n.id,item:n,onClose:e};switch(n.confirmType){default:return o(iZ,{...t})}},aZ=n=>{const{alerts:e=[],bubbleAlerts:t=[],confirms:s=[],closeAlert:r=null,closeBubbleAlert:i=null,closeConfirm:a=null}=Xt(),l=_.useMemo(()=>{if(!e||!e.length)return null;const h=[];for(const d of e){const f=eZ(d,()=>r(d));h.push(f)}return h},[e,r]),c=_.useMemo(()=>{if(!t||!t.length)return null;const h=[];for(const d of t){const f=rZ(d,()=>i(d));if(d.notificationType===Bt.CLUBGIFT){h.unshift(f);continue}h.push(f)}return h},[t,i]),u=_.useMemo(()=>{if(!s||!s.length)return null;const h=[];for(const d of s){const f=nZ(d,()=>a(d));h.push(f)}return h},[s,a]);return g(X,{children:[o(D,{gap:1,children:c}),u,l]})},oZ={purple:9452386,blue:3891856,green:6459451,yellow:10658089,lilac:6897548,orange:10841125,turquoise:2661026,red:10104881},lZ=n=>{const[e,t]=_.useState(!0),[s,r]=_.useState(""),[i,a]=_.useState("");Vq(hR.MYSTERY_BOX_KEYS_UPDATE,c=>{r(c.keyColor),a(c.boxColor)});const l=c=>{const u=oZ[c];return Jr.int2rgb(u)};return s===""&&i===""?null:o(j,{className:"nitro-notification-bubble rounded mysterybox-extension",children:g(D,{children:[g(P,{alignItems:"center",justifyContent:"between",pointer:!0,onClick:c=>t(u=>!u),children:[o(y,{variant:"white",children:p("mysterybox.tracker.title")}),e&&o(im,{className:"fa-icon"}),!e&&o(nm,{className:"fa-icon"})]}),e&&g(X,{children:[o(y,{variant:"white",children:p("mysterybox.tracker.description")}),g(P,{justifyContent:"center",alignItems:"center",gap:2,children:[o(Qe,{className:"mysterybox-container",children:o("div",{className:"box-image flex-shrink-0",style:{backgroundColor:l(i)},children:o("div",{className:"chain-overlay-image"})})}),o(Qe,{className:"mysterybox-container",children:o("div",{className:"key-image flex-shrink-0",style:{backgroundColor:l(s)},children:o("div",{className:"key-overlay-image"})})})]})]})]})})},cZ=n=>{const{eventId:e=-1,eventName:t="",eventDescription:s="",setIsEditingPromote:r=null}=n,[i,a]=_.useState(t),[l,c]=_.useState(s),u=()=>{V(new xM(e,i,l)),r(!1)};return g(Re,{className:"nitro-guide-tool",theme:"primary-slim",children:[o(Te,{headerText:p("navigator.eventsettings.editcaption"),onCloseClick:()=>r(!1)}),g(Ee,{className:"text-black",children:[g(D,{children:[o(y,{bold:!0,children:p("navigator.eventsettings.name")}),o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("navigator.eventsettings.name"),maxLength:64,value:i,onChange:h=>a(h.target.value)})]}),g(D,{children:[o(y,{bold:!0,children:p("navigator.eventsettings.desc")}),o("textarea",{className:"form-control form-control-sm",placeholder:p("navigator.eventsettings.desc"),maxLength:64,value:l,onChange:h=>c(h.target.value)})]}),o(D,{children:o(H,{fullWidth:!0,disabled:!i||!l,variant:!i||!l?"danger":"success",onClick:h=>u(),children:p("navigator.eventsettings.edit")})})]})]})},uZ=n=>{const{eventDescription:e="",setIsEditingPromote:t=null}=n,{setIsExtended:s}=ap(),r=()=>{s(!0),de("catalog/open/room_event")};return g(X,{children:[o(P,{alignItems:"center",gap:2,style:{overflowWrap:"anywhere"},children:o(y,{variant:"white",children:e})}),o("br",{}),o("br",{}),g(ge,{className:"d-flex align-items-center justify-content-end gap-2",children:[o(H,{className:"btn btn-primary w-100 btn-sm",onClick:i=>t(!0),children:p("navigator.roominfo.editevent")}),o(H,{className:"btn btn-success w-100 btn-sm",onClick:i=>r(),children:p("roomad.extend.event")})]})]})},hZ=n=>{const{eventDescription:e=""}=n;return g(X,{children:[o(P,{alignItems:"center",gap:2,style:{overflowWrap:"anywhere"},children:o(y,{variant:"white",children:e})}),o("br",{}),o("br",{}),o(D,{alignItems:"center",gap:1,children:g(j,{fullWidth:!0,overflow:"hidden",position:"relative",className:"bg-light-dark rounded",children:[o(P,{fit:!0,center:!0,position:"absolute",children:o(y,{variant:"white",center:!0,children:p("navigator.eventinprogress")})}),o(y,{children:" "})]})})]})},dZ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(!0),{promoteInformation:i,setPromoteInformation:a}=ap();return z(Gc,l=>{a(null)}),i?o(X,{children:i.data.adId!==-1&&o(j,{className:"nitro-notification-bubble rounded",children:g(D,{children:[g(P,{alignItems:"center",justifyContent:"between",pointer:!0,onClick:l=>r(c=>!c),children:[o(y,{variant:"white",overflow:"hidden",children:i.data.eventName}),s&&o(im,{className:"fa-icon"}),!s&&o(nm,{className:"fa-icon"})]}),s&&$().userId!==i.data.ownerAvatarId&&o(hZ,{eventDescription:i.data.eventDescription}),s&&$().userId===i.data.ownerAvatarId&&o(uZ,{eventDescription:i.data.eventDescription,setIsEditingPromote:()=>t(!0)}),e&&o(cZ,{eventId:i.data.adId,eventName:i.data.eventName,eventDescription:i.data.eventDescription,setIsEditingPromote:()=>t(!1)})]})})}):null},_Z=n=>o("div",{className:"nitro-right-side",children:g(D,{position:"relative",gap:1,children:[o(QJ,{}),o(lZ,{}),o(qJ,{}),o(dZ,{}),o(aZ,{})]})}),gZ=n=>o("div",{className:"room-spectator"}),fZ=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(null),{chatStyleId:i=0}=za(),{roomSession:a=null}=yt();z(RA,c=>{const u=c.getParser();if(!u)return;const h=a.userDataManager.getPetData(u.petId);h&&(t(h),r(u))});const l=(c,u)=>{!c||!u||a==null||a.sendChatMessage(`${c} ${u}`,i)};return!e||!s?null:g(Re,{uniqueKey:"user-settings",className:"user-settings-window no-resize",theme:"primary-slim",children:[o(Te,{headerText:p("widgets.pet.commands.title"),onCloseClick:()=>r(null)}),g(Ee,{className:"text-black",children:[o(P,{alignItems:"center",justifyContent:"center",gap:2,children:g(ge,{columnCount:2,children:[o(D,{fullWidth:!0,overflow:"hidden",className:"body-image pet p-1",children:o(cn,{figure:e.figure,posture:"std",direction:2})}),o(y,{variant:"black",small:!0,wrap:!0,children:e.name})]})}),o(ge,{columnCount:2,children:s.commands&&s.commands.length>0&&s.commands.map((c,u)=>o(H,{disabled:!s.enabledCommands.includes(c),onClick:()=>l(e.name,p(`pet.command.${c}`)),children:p(`pet.command.${c}`)},u))})]})]})},cr=n=>{const{justifyContent:e="center",alignItems:t="center",classNames:s=[],...r}=n,i=_.useMemo(()=>{const a=["menu-header","p-1"];return s.length&&a.push(...s),a},[s]);return o(P,{justifyContent:e,alignItems:t,classNames:i,...r})},mZ=n=>{const{chatEvent:e=null,onClose:t=null}=n,[s,r]=_.useState(e.chat==="${bot.skill.chatter.configuration.text.placeholder}"?"":e.chat),[i,a]=_.useState(e.automaticChat),[l,c]=_.useState(e.mixSentences),[u,h]=_.useState(e.chatDelay),d=_.useMemo(()=>WE(at().roomId,e.objectId,e.category,1),[e]),f=m=>m.replace(/;#;/g," ").replace(/\r\n|\r|\n/g,"\r"),E=()=>{const m=f(s)+";#;"+i+";#;"+u+";#;"+l;V(new an(e.botId,Ze.SETUP_CHAT,m)),t()};return o(Ya,{windowPosition:xs.NOTHING,handleSelector:".drag-handler",dragStyle:{top:d.y,left:d.x},children:g(j,{className:"nitro-context-menu bot-chat",children:[o(cr,{className:"drag-handler",children:p("bot.skill.chatter.configuration.title")}),g(D,{className:"p-1",children:[g(D,{gap:1,children:[o(y,{variant:"white",children:p("bot.skill.chatter.configuration.chat.text")}),o("textarea",{className:"form-control form-control-sm",placeholder:p("bot.skill.chatter.configuration.text.placeholder"),value:s,rows:7,onChange:m=>r(m.target.value)})]}),g(D,{gap:1,children:[g(P,{gap:1,alignItems:"center",justifyContent:"between",children:[o(y,{fullWidth:!0,variant:"white",children:p("bot.skill.chatter.configuration.automatic.chat")}),o("input",{type:"checkbox",className:"form-check-input",checked:i,onChange:m=>a(m.target.checked)})]}),g(P,{gap:1,alignItems:"center",justifyContent:"between",children:[o(y,{fullWidth:!0,variant:"white",children:p("bot.skill.chatter.configuration.markov")}),o("input",{type:"checkbox",className:"form-check-input",checked:l,onChange:m=>c(m.target.checked)})]}),g(P,{gap:1,alignItems:"center",justifyContent:"between",children:[o(y,{fullWidth:!0,variant:"white",children:p("bot.skill.chatter.configuration.chat.delay")}),o("input",{type:"number",className:"form-control form-control-sm",value:u,onChange:m=>h(m.target.valueAsNumber)})]})]}),g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(H,{fullWidth:!0,variant:"primary",onClick:t,children:p("cancel")}),o(H,{fullWidth:!0,variant:"success",onClick:E,children:p("save")})]})]})]})})},FI=-1,xI=0,wI=1,GI=2,BI=3,kI=4,VI=5,HI=6,EZ=n=>{const{item:e=null,onClose:t=null}=n,[s,r]=_.useState(FI),[i,a]=_.useState(null),[l,c]=_.useState(null),{roomSession:u=null}=yt(),h=()=>{i&&ee().selectRoomObject(u.roomId,i.roomIndex,k.UNIT)},d=()=>{u.usePetProduct(e.requestRoomObjectId,i.webID),t()},f=_.useMemo(()=>{if(!i||!l)return null;const E=new gn(i.figure),m=l.customParams.split(" "),R=parseInt(m[0]);switch(l.specialType){case he.PET_SHAMPOO:{if(m.length<2)return null;const I=ee().getPetColorResult(R,E.paletteId),S=ee().getPetColorResultsForTag(R,m[1]);let A=-1;for(const N of S)if(N.breed===I.breed){A=parseInt(N.id);break}return o(cn,{typeId:E.typeId,paletteId:A,petColor:E.color,customParts:E.customParts,direction:2})}case he.PET_CUSTOM_PART:{if(m.length<4)return null;const I=[],S=m[1].split(",").map(M=>parseInt(M)),A=m[2].split(",").map(M=>parseInt(M)),N=m[3].split(",").map(M=>parseInt(M));let L=0;for(;L<S.length;){const M=S[L],b=E.getCustomPart(M);let B=N[L];b!=null&&(B=b.paletteId),I.push(new Oh(M,A[L],B)),L++}return o(cn,{typeId:E.typeId,paletteId:E.paletteId,petColor:E.color,customParts:I,direction:2})}case he.PET_CUSTOM_PART_SHAMPOO:{if(m.length<3)return null;const I=[],S=m[1].split(",").map(L=>parseInt(L)),A=m[2].split(",").map(L=>parseInt(L));let N=0;for(;N<S.length;){const L=S[N],M=E.getCustomPart(L);let b=-1;M!=null&&(b=M.partId),I.push(new Oh(S[N],b,A[N])),N++}return o(cn,{typeId:E.typeId,paletteId:E.paletteId,petColor:E.color,customParts:I,direction:2})}case he.PET_SADDLE:{if(m.length<4)return null;const I=[],S=m[1].split(",").map(M=>parseInt(M)),A=m[2].split(",").map(M=>parseInt(M)),N=m[3].split(",").map(M=>parseInt(M));let L=0;for(;L<S.length;)I.push(new Oh(S[L],A[L],N[L])),L++;for(const M of E.customParts)S.indexOf(M.layerId)===-1&&I.push(M);return o(cn,{typeId:E.typeId,paletteId:E.paletteId,petColor:E.color,customParts:I,direction:2})}case he.MONSTERPLANT_REBREED:case he.MONSTERPLANT_REVIVAL:case he.MONSTERPLANT_FERTILIZE:{let I="rip";const S=ee().getRoomObject(u.roomId,i.roomIndex,k.UNIT);if(S&&(I=S.model.getValue(C.FIGURE_POSTURE),I==="rip")){const A=i.petLevel;A<7?I=`grw${A}`:I="std"}return o(cn,{typeId:E.typeId,paletteId:E.paletteId,petColor:E.color,customParts:E.customParts,posture:I,direction:2})}}},[i,l,u]);return _.useEffect(()=>{const E=u.userDataManager.getUserDataByIndex(e.id);a(E);const m=i_(u.roomId,e.requestRoomObjectId,k.FLOOR);if(!m)return;c(m);let R=FI;switch(m.specialType){case he.PET_SHAMPOO:R=xI;break;case he.PET_CUSTOM_PART:R=wI;break;case he.PET_CUSTOM_PART_SHAMPOO:R=GI;break;case he.PET_SADDLE:R=BI;break;case he.MONSTERPLANT_REVIVAL:R=kI;break;case he.MONSTERPLANT_REBREED:R=VI;break;case he.MONSTERPLANT_FERTILIZE:R=HI;break}r(R)},[u,e]),i?g(Re,{className:"nitro-use-product-confirmation",children:[o(Te,{headerText:p("useproduct.widget.title",["name"],[i.name]),onCloseClick:t}),o(Ee,{center:!0,children:g(P,{gap:2,overflow:"hidden",children:[o(D,{children:o(j,{pointer:!0,className:"product-preview",onClick:h,children:f})}),g(D,{justifyContent:"between",overflow:"auto",children:[g(D,{gap:2,children:[s===xI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.shampoo",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.shampoo")})]}),s===wI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.custompart",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.custompart")})]}),s===GI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.custompartshampoo",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.custompartshampoo")})]}),s===BI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.saddle",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.saddle")})]}),s===kI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.revive_monsterplant",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.revive_monsterplant")})]}),s===VI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.rebreed_monsterplant",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.rebreed_monsterplant")})]}),s===HI&&g(X,{children:[o(y,{children:p("useproduct.widget.text.fertilize_monsterplant",["productName"],[l.name])}),o(y,{children:p("useproduct.widget.info.fertilize_monsterplant")})]})]}),g(P,{alignItems:"center",justifyContent:"between",children:[o(H,{variant:"danger",onClick:t,children:p("useproduct.widget.cancel")}),o(H,{variant:"success",onClick:d,children:p("useproduct.widget.use")})]})]})]})})]}):null},ae=n=>{const{disabled:e=!1,fullWidth:t=!0,justifyContent:s="center",alignItems:r="center",classNames:i=[],onClick:a=null,...l}=n,c=h=>{e||a&&a(h)},u=_.useMemo(()=>{const h=["menu-item","list-item"];return e&&h.push("disabled"),i.length&&h.push(...i),h},[e,i]);return o(P,{fullWidth:t,justifyContent:s,alignItems:r,classNames:u,onClick:c,...l})},pZ=n=>{const{justifyContent:e="center",alignItems:t="center",classNames:s=[],collapsed:r=!0,...i}=n,a=_.useMemo(()=>{const l=["menu-footer"];return s.length&&l.push(...s),l},[s]);return g(P,{justifyContent:e,alignItems:t,classNames:a,...i,children:[!r&&o(em,{className:"fa-icon align-self-center"}),r&&o($f,{className:"fa-icon align-self-center"})]})},IZ=25,jI=3,TZ=5e3,RZ=75,Ko=10;let K_=!1,Zu=null,$u=-1e6,X_=1;const Cn=n=>{const{objectId:e=-1,category:t=-1,userType:s=-1,fades:r=!1,onClose:i=null,position:a="absolute",classNames:l=[],style:c={},children:u=null,collapsable:h=!1,...d}=n,[f,E]=_.useState({x:null,y:null}),[m,R]=_.useState(1),[I,S]=_.useState(!1),[A,N]=_.useState(K_),L=_.useRef(),M=_.useCallback(x=>{if(!I)return;X_+=x;let U=(1-X_/RZ)*1;if(U<=0)return i(),!1;R(U)},[I,i]),b=_.useCallback((x,U)=>{if(!x||!U||!Zu)return;let G=-L.current.offsetHeight;s>-1&&(s===Rt.USER||s===Rt.BOT||s===Rt.RENTABLE_BOT)?G=G+(x.height>50?15:0):G=G-14,Zu.addValue(U.y-x.top);let K=Zu.getMax();K<$u-jI&&(K=$u-jI),$u=K;const Y=U.y-K;let te=~~(U.x-L.current.offsetWidth/2),ne=~~(Y+G);const J=ze().width-L.current.offsetWidth-Ko,Ce=ze().height-L.current.offsetHeight-Ko;te<Ko?te=Ko:te>J&&(te=J),ne<Ko?ne=Ko:ne>Ce&&(ne=Ce),E({x:te,y:ne})},[s]),B=_.useMemo(()=>{const x=["nitro-context-menu"];return A&&x.push("menu-hidden"),x.push(f.x!==null?"visible":"invisible"),l.length&&x.push(...l),x},[f,l,A]),w=_.useMemo(()=>{let x={};return x.left=f.x||0,x.top=f.y||0,x.opacity=m,Object.keys(c).length&&(x={...x,...c}),x},[f,m,c]);return _.useEffect(()=>{if(!L.current)return;const x=U=>{if(!L.current)return;M(U);const G=WE(at().roomId,e,t),K=_P(at().roomId,e,t);b(G,K)};return qs().add(x),()=>{qs().remove(x)}},[e,t,M,b]),_.useEffect(()=>{if(!r)return;const x=setTimeout(()=>S(!0),TZ);return()=>clearTimeout(x)},[r]),_.useEffect(()=>{K_=A},[A]),_.useEffect(()=>{Zu=new k0(IZ),$u=-1e6,X_=1},[]),g(j,{innerRef:L,position:a,classNames:B,style:w,...d,children:[!(h&&K_)&&u,h&&o(pZ,{onClick:()=>N(!A),collapsed:A})]})},WI=0,YI=1,zI=2,KI=3,XI=4,qI=5,QI=6,JI=7,OZ=n=>{const{item:e=null,updateConfirmingProduct:t=null,onClose:s=null}=n,[r,i]=_.useState(0),{roomSession:a=null}=yt(),l=c=>{if(c)switch(c){case"use_product":case"use_product_shampoo":case"use_product_custom_part":case"use_product_custom_part_shampoo":case"use_product_saddle":case"replace_product_saddle":case"revive_monsterplant":case"rebreed_monsterplant":case"fertilize_monsterplant":t(e);break}};return _.useEffect(()=>{if(!e)return;const c=i_(a.roomId,e.requestRoomObjectId,k.FLOOR);if(!c)return;let u=WI;switch(c.specialType){case he.PET_SHAMPOO:u=YI;break;case he.PET_CUSTOM_PART:u=zI;break;case he.PET_CUSTOM_PART_SHAMPOO:u=KI;break;case he.PET_SADDLE:u=XI;break;case he.MONSTERPLANT_REVIVAL:u=qI;break;case he.MONSTERPLANT_REBREED:u=QI;break;case he.MONSTERPLANT_FERTILIZE:u=JI;break}i(u)},[a,e]),g(Cn,{objectId:e.id,category:k.UNIT,userType:Rt.PET,onClose:s,collapsable:!0,children:[o(cr,{children:e.name}),r===WI&&o(ae,{onClick:c=>l("use_product"),children:p("infostand.button.useproduct")}),r===YI&&o(ae,{onClick:c=>l("use_product_shampoo"),children:p("infostand.button.useproduct_shampoo")}),r===zI&&o(ae,{onClick:c=>l("use_product_custom_part"),children:p("infostand.button.useproduct_custom_part")}),r===KI&&o(ae,{onClick:c=>l("use_product_custom_part_shampoo"),children:p("infostand.button.useproduct_custom_part_shampoo")}),r===XI&&g(X,{children:[e.replace&&o(ae,{onClick:c=>l("replace_product_saddle"),children:p("infostand.button.replaceproduct_saddle")}),!e.replace&&o(ae,{onClick:c=>l("use_product_saddle"),children:p("infostand.button.useproduct_saddle")})]}),r===qI&&o(ae,{onClick:c=>l("revive_monsterplant"),children:p("infostand.button.revive_monsterplant")}),r===QI&&o(ae,{onClick:c=>l("rebreed_monsterplant"),children:p("infostand.button.rebreed_monsterplant")}),r===JI&&o(ae,{onClick:c=>l("fertilize_monsterplant"),children:p("infostand.button.fertilize_monsterplant")})]})},SZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n;return e?o(D,{className:"nitro-infostand rounded",children:g(D,{overflow:"visible",className:"container-fluid content-area",gap:1,children:[g(D,{gap:1,children:[g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(y,{variant:"white",small:!0,wrap:!0,children:e.name}),o(ei,{className:"cursor-pointer fa-icon",onClick:t})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{gap:1,children:[o(D,{fullWidth:!0,className:"body-image bot",children:o(as,{figure:e.figure,direction:4})}),o(D,{grow:!0,center:!0,gap:0,children:e.badges.length>0&&e.badges.map(s=>o(xt,{badgeCode:s,showInfo:!0},s))})]}),o("hr",{className:"m-0"})]}),o(P,{alignItems:"center",className:"bg-light-dark rounded py-1 px-2",children:o(y,{fullWidth:!0,wrap:!0,textBreak:!0,variant:"white",small:!0,className:"motto-content",children:e.motto})}),e.carryItem>0&&g(D,{gap:1,children:[o("hr",{className:"m-0"}),o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.handitem",["item"],[p("handitem"+e.carryItem)])})]})]})}):null},q_=0,ZI=1,$I=2,CZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,{roomSession:s=null}=yt(),[r,i]=_.useState(0),[a,l]=_.useState(!1),[c,u]=_.useState(!1),[h,d]=_.useState(!1),[f,E]=_.useState([]),[m,R]=_.useState([]),[I,S]=_.useState([]),[A,N]=_.useState([]),[L,M]=_.useState(!1),[b,B]=_.useState(0),[w,x]=_.useState(0),[U,G]=_.useState(!1),[K,Y]=_.useState(!1),[te,ne]=_.useState(null),[J,Ce]=_.useState(!1),[Ae,tt]=_.useState(!1),[Wt,ls]=_.useState(-1),[cs,mr]=_.useState(""),[$t,Gs]=_.useState("");_o(Bi.NPE_SONG_CHANGED,ke=>{ls(ke.id)},J||Ae),_o(Pl.SIR_TRAX_SONG_INFO_RECEIVED,ke=>{if(ke.id!==Wt)return;const ot=ze().soundManager.musicController.getSongInfo(ke.id);ot&&(mr(ot.name),Gs(ot.creator))},J||Ae),_.useEffect(()=>{let ke=q_,ot=!1,Jt=!1,Mr=!1,We=[],_t=[],ii=[],Xa=[],Dr=!1,Lu=0,rc=0,qa=!1,Qa=!1,Vo=!1,ic=!1,ua=-1;const Ja=e.roomControllerLevel>=ct.GUEST;if((Ja||e.isOwner||e.isRoomOwner||e.isAnyRoomController)&&(ot=!0,Jt=!e.isWallItem,e.roomControllerLevel>=ct.MODERATOR&&(qa=!0)),e.isAnyRoomController&&(Qa=!0),(e.usagePolicy===Fc.EVERYBODY||e.usagePolicy===Fc.CONTROLLER&&Ja||e.extraParam===Kt.JUKEBOX&&Ja||e.extraParam===Kt.USABLE_PRODUCT&&Ja)&&(Mr=!0),e.extraParam){if(e.extraParam===Kt.CRACKABLE_FURNI){const Qs=e.stuffData;Mr=!0,Dr=!0,Lu=Qs.hits,rc=Qs.target}else if(e.extraParam===Kt.JUKEBOX){const Qs=ze().soundManager.musicController.getRoomItemPlaylist();Qs&&(ua=Qs.nowPlayingSongId),Vo=!0}else e.extraParam.indexOf(Kt.SONGDISK)===0&&(ua=parseInt(e.extraParam.substr(Kt.SONGDISK.length)),ic=!0);if(qa){const Qs=e.extraParam.substr(Kt.BRANDING_OPTIONS.length);if(Qs){const en=Qs.split("	");for(const Ho of en){const tn=Ho.split("=");tn&&tn.length===2&&(We.push(tn[0]),_t.push(tn[1]))}}}}if(qa){const Qs=ee().getRoomObject(s.roomId,e.id,e.isWallItem?k.WALL:k.FLOOR);if(Qs){const en=Qs.model.getValue(C.FURNITURE_CUSTOM_VARIABLES),Ho=Qs.model.getValue(C.FURNITURE_DATA);if(en&&en.length)for(const tn of en)ii.push(tn),Xa.push(Ho[tn]||"")}}e.isOwner||e.isAnyRoomController?ke=$I:(e.isRoomOwner||e.roomControllerLevel>=ct.GUILD_ADMIN)&&(ke=ZI),e.isStickie&&(ke=q_),i(ke),l(ot),u(Jt),d(Mr),E(We),R(_t),S(ii),N(Xa),M(Dr),B(Lu),x(rc),G(qa),Y(Qa),ne(null),Ce(Vo),tt(ic),ls(ua),e.groupId&&V(new yl(e.groupId,!1))},[s,e]),z(jl,ke=>{const ot=ke.getParser();!e||e.groupId!==ot.id||ot.flag||(te&&ne(null),ne(ot.title))}),_.useEffect(()=>{const ke=ze().soundManager.musicController.getSongInfo(Wt);mr((ke==null?void 0:ke.name)??""),Gs((ke==null?void 0:ke.creator)??"")},[Wt]);const yr=_.useCallback((ke,ot)=>{const Jt=Array.from(m);Jt[ke]=ot,R(Jt)},[m]),ca=_.useCallback((ke,ot)=>{const Jt=Array.from(A);Jt[ke]=ot,N(Jt)},[A]),$i=_.useCallback(()=>{if(f.length===0||m.length===0)return"";let ke="",ot=0;for(;ot<f.length;){const Jt=f[ot],Mr=m[ot];ke=ke+(Jt+"="+Mr+"	"),ot++}return ke},[f,m]),Er=_.useCallback(ke=>{if(!(!ke||ke===""))switch(ke){case"buy_one":de(`catalog/open/offerId/${e.purchaseOfferId}`);return;case"move":ee().processRoomObjectOperation(e.id,e.category,ye.OBJECT_MOVE);break;case"rotate":ee().processRoomObjectOperation(e.id,e.category,ye.OBJECT_ROTATE_POSITIVE);break;case"pickup":r===$I?ee().processRoomObjectOperation(e.id,e.category,ye.OBJECT_PICKUP):ee().processRoomObjectOperation(e.id,e.category,ye.OBJECT_EJECT);break;case"use":ee().useRoomObject(e.id,e.category);break;case"save_branding_configuration":{const ot=new Map,Jt=$i().split("	");if(Jt)for(const Mr of Jt){const[We,_t]=Mr.split("=",2);ot.set(We,_t)}ee().modifyRoomObjectDataWithMap(e.id,e.category,ye.OBJECT_SAVE_STUFF_DATA,ot);break}case"save_custom_variables":{const ot=new Map;for(let Jt=0;Jt<I.length;Jt++){const Mr=I[Jt],We=A[Jt];Mr&&Mr.length&&We&&We.length&&ot.set(Mr,We)}V(new lE(e.id,ot));break}}},[e,r,I,A,$i]),ri=_.useCallback(()=>{const ke=e.stuffData;return!ke||!(ke instanceof ta)?null:ke.getValue(2)},[e]);return e?g(D,{gap:1,alignItems:"end",children:[o(D,{className:"nitro-infostand rounded",children:g(D,{overflow:"visible",className:"container-fluid content-area",gap:1,children:[g(D,{gap:1,children:[g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(y,{variant:"white",small:!0,wrap:!0,children:e.name}),o(ei,{className:"cursor-pointer fa-icon",onClick:t})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{position:"relative",gap:1,children:[e.stuffData.isUnique&&o("div",{className:"position-absolute end-0",children:o(YP,{uniqueNumber:e.stuffData.uniqueNumber,uniqueSeries:e.stuffData.uniqueSeries})}),e.stuffData.rarityLevel>-1&&o("div",{className:"position-absolute end-0",children:o(rp,{level:e.stuffData.rarityLevel})}),e.image&&e.image.src.length&&o("img",{className:"d-block mx-auto",src:e.image.src,alt:""})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[o(y,{fullWidth:!0,wrap:!0,textBreak:!0,variant:"white",small:!0,children:e.description}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:e.ownerId}),o(y,{variant:"white",small:!0,wrap:!0,children:p("furni.owner",["name"],[e.ownerName])})]}),e.purchaseOfferId>0&&o(P,{children:o(y,{variant:"white",small:!0,underline:!0,pointer:!0,onClick:ke=>Er("buy_one"),children:p("infostand.button.buy")})})]}),(J||Ae)&&g(D,{gap:1,children:[o("hr",{className:"m-0"}),Wt===-1&&o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.jukebox.text.not.playing")}),!!cs.length&&g(P,{alignItems:"center",gap:1,children:[o(j,{className:"icon disk-icon"}),o(y,{variant:"white",small:!0,wrap:!0,children:cs})]}),!!$t.length&&g(P,{alignItems:"center",gap:1,children:[o(j,{className:"icon disk-creator"}),o(y,{variant:"white",small:!0,wrap:!0,children:$t})]})]}),g(D,{gap:1,children:[L&&g(X,{children:[o("hr",{className:"m-0"}),o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.crackable_furni.hits_remaining",["hits","target"],[b.toString(),w.toString()])})]}),e.groupId>0&&g(X,{children:[o("hr",{className:"m-0"}),g(P,{pointer:!0,alignItems:"center",gap:2,onClick:()=>Mu(e.groupId),children:[o(xt,{badgeCode:ri(),isGroup:!0}),o(y,{variant:"white",underline:!0,children:te})]})]}),U&&g(X,{children:[o("hr",{className:"m-0"}),K&&g(y,{small:!0,wrap:!0,variant:"white",children:["ID: ",e.id]}),f.length>0&&g(X,{children:[o("hr",{className:"m-0"}),o(D,{gap:1,children:f.map((ke,ot)=>g(P,{alignItems:"center",gap:1,children:[o(y,{small:!0,wrap:!0,align:"end",variant:"white",className:"col-4",children:ke}),o("input",{type:"text",className:"form-control form-control-sm",value:m[ot],onChange:Jt=>yr(ot,Jt.target.value)})]},ot))})]})]}),I.length>0&&g(X,{children:[o("hr",{className:"m-0 my-1"}),o(D,{gap:1,children:I.map((ke,ot)=>g(P,{alignItems:"center",gap:1,children:[o(y,{small:!0,wrap:!0,align:"end",variant:"white",className:"col-4",children:ke}),o("input",{type:"text",className:"form-control form-control-sm",value:A[ot],onChange:Jt=>ca(ot,Jt.target.value)})]},ot))})]})]})]})}),g(P,{gap:1,justifyContent:"end",children:[a&&o(H,{variant:"dark",onClick:ke=>Er("move"),children:p("infostand.button.move")}),c&&o(H,{variant:"dark",onClick:ke=>Er("rotate"),children:p("infostand.button.rotate")}),r!==q_&&o(H,{variant:"dark",onClick:ke=>Er("pickup"),children:p(r===ZI?"infostand.button.eject":"infostand.button.pickup")}),h&&o(H,{variant:"dark",onClick:ke=>Er("use"),children:p("infostand.button.use")}),f.length>0&&m.length>0&&f.length===m.length&&o(H,{variant:"dark",onClick:()=>Er("save_branding_configuration"),children:p("save")}),I.length>0&&A.length>0&&I.length===A.length&&o(H,{variant:"dark",onClick:()=>Er("save_custom_variables"),children:p("save")})]})]}):null},AZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,[s,r]=_.useState(0),[i,a]=_.useState(0),{roomSession:l=null}=yt(),{petRespectRemaining:c=0,respectPet:u=null}=za();if(_.useEffect(()=>{r(e.remainingGrowTime),a(e.remainingTimeToLive)},[e]),_.useEffect(()=>{if(e.petType!==be.MONSTERPLANT||e.dead)return;const d=setInterval(()=>{r(f=>f-1),a(f=>f-1)},1e3);return()=>clearInterval(d)},[e]),!e)return null;const h=d=>{let f=!0;if(!(!d||d=="")){switch(d){case"respect":u(e.id),c-1>=1&&(f=!1);break;case"buyfood":de("catalog/open/"+ce("catalog.links")["pets.buy_food"]);break;case"train":l==null||l.requestPetCommands(e.id);break;case"treat":V(new lu(e.id));break;case"compost":l==null||l.compostPlant(e.id);break;case"pick_up":l==null||l.pickupPet(e.id);break}f&&t()}};return g(D,{gap:1,alignItems:"end",children:[o(D,{className:"nitro-infostand rounded",children:g(D,{overflow:"visible",className:"container-fluid content-area",gap:1,children:[g(D,{gap:1,children:[g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(y,{variant:"white",small:!0,wrap:!0,children:e.name}),o(ei,{className:"cursor-pointer fa-icon",onClick:t})]}),o(y,{variant:"white",small:!0,wrap:!0,children:p(`pet.breed.${e.petType}.${e.petBreed}`)}),o("hr",{className:"m-0"})]}),e.petType===be.MONSTERPLANT&&g(X,{children:[g(D,{center:!0,gap:1,children:[o(cn,{figure:e.petFigure,posture:e.posture,direction:4}),o("hr",{className:"m-0"})]}),g(D,{gap:2,children:[!e.dead&&o(D,{alignItems:"center",gap:1,children:o(y,{variant:"white",center:!0,small:!0,wrap:!0,children:p("pet.level",["level","maxlevel"],[e.level.toString(),e.maximumLevel.toString()])})}),g(D,{alignItems:"center",gap:1,children:[o(y,{variant:"white",small:!0,truncate:!0,children:p("infostand.pet.text.wellbeing")}),g(j,{fullWidth:!0,overflow:"hidden",position:"relative",className:"bg-light-dark rounded",children:[o(P,{fit:!0,center:!0,position:"absolute",children:o(y,{variant:"white",small:!0,children:e.dead?"00:00:00":$a(i==0?e.remainingTimeToLive:i).split(":")[1]+":"+$a(i==null||i==null?0:i).split(":")[2]+":"+$a(i==null||i==null?0:i).split(":")[3]})}),o(j,{className:"bg-success rounded pet-stats",style:{width:e.dead?"0":Math.round(e.maximumTimeToLive*100/i).toString()}})]})]}),s!=0&&s>0&&g(D,{alignItems:"center",gap:1,children:[o(y,{variant:"white",small:!0,truncate:!0,children:p("infostand.pet.text.growth")}),o(Pq,{className:"top-2 end-2",day:$a(s).split(":")[0],hour:$a(s).split(":")[1],minutes:$a(s).split(":")[2],seconds:$a(s).split(":")[3]})]}),g(D,{alignItems:"center",gap:1,children:[o(y,{variant:"white",small:!0,truncate:!0,children:p("infostand.pet.text.raritylevel",["level"],[p(`infostand.pet.raritylevel.${e.rarityLevel}`)])}),o(rp,{className:"top-2 end-2",level:e.rarityLevel})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[o(y,{variant:"white",small:!0,wrap:!0,children:p("pet.age",["age"],[e.age.toString()])}),o("hr",{className:"m-0"})]})]}),e.petType!==be.MONSTERPLANT&&g(X,{children:[g(D,{gap:1,children:[g(P,{gap:1,children:[o(D,{fullWidth:!0,overflow:"hidden",className:"body-image pet p-1",children:o(cn,{figure:e.petFigure,posture:e.posture,direction:4})}),g(D,{grow:!0,gap:1,children:[o(y,{variant:"white",center:!0,small:!0,wrap:!0,children:p("pet.level",["level","maxlevel"],[e.level.toString(),e.maximumLevel.toString()])}),g(D,{alignItems:"center",gap:1,children:[o(y,{variant:"white",small:!0,truncate:!0,children:p("infostand.pet.text.happiness")}),g(j,{fullWidth:!0,overflow:"hidden",position:"relative",className:"bg-light-dark rounded",children:[o(P,{fit:!0,center:!0,position:"absolute",children:o(y,{variant:"white",small:!0,children:e.happyness+"/"+e.maximumHappyness})}),o(j,{className:"bg-info rounded pet-stats",style:{width:e.happyness/e.maximumHappyness*100+"%"}})]})]}),g(D,{alignItems:"center",gap:1,children:[o(y,{variant:"white",small:!0,truncate:!0,children:p("infostand.pet.text.experience")}),g(j,{fullWidth:!0,overflow:"hidden",position:"relative",className:"bg-light-dark rounded",children:[o(P,{fit:!0,center:!0,position:"absolute",children:o(y,{variant:"white",small:!0,children:e.experience+"/"+e.levelExperienceGoal})}),o(j,{className:"bg-purple rounded pet-stats",style:{width:e.experience/e.levelExperienceGoal*100+"%"}})]})]}),g(D,{alignItems:"center",gap:1,children:[o(y,{variant:"white",small:!0,truncate:!0,children:p("infostand.pet.text.energy")}),g(j,{fullWidth:!0,overflow:"hidden",position:"relative",className:"bg-light-dark rounded",children:[o(P,{fit:!0,center:!0,position:"absolute",children:o(y,{variant:"white",small:!0,children:e.energy+"/"+e.maximumEnergy})}),o(j,{className:"bg-success rounded pet-stats",style:{width:e.energy/e.maximumEnergy*100+"%"}})]})]})]})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[e.petType!==be.MONSTERPLANT&&o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.petrespect",["count"],[e.respect.toString()])}),o(y,{variant:"white",small:!0,wrap:!0,children:p("pet.age",["age"],[e.age.toString()])}),o("hr",{className:"m-0"})]})]}),o(D,{gap:1,children:g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:e.ownerId}),o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.petowner",["name"],[e.ownerName])})]})})]})}),g(P,{gap:1,justifyContent:"end",children:[e.petType!==be.MONSTERPLANT&&o(H,{variant:"dark",onClick:d=>h("buyfood"),children:p("infostand.button.buyfood")}),e.isOwner&&e.petType!==be.MONSTERPLANT&&o(H,{variant:"dark",onClick:d=>h("train"),children:p("infostand.button.train")}),!e.dead&&e.energy/e.maximumEnergy<.98&&e.petType===be.MONSTERPLANT&&o(H,{variant:"dark",onClick:d=>h("treat"),children:p("infostand.button.pettreat")}),(l==null?void 0:l.isRoomOwner)&&e.petType===be.MONSTERPLANT&&o(H,{variant:"dark",onClick:d=>h("compost"),children:p("infostand.button.compost")}),e.isOwner&&o(H,{variant:"dark",onClick:d=>h("pick_up"),children:p("inventory.pets.pickup")}),c>0&&e.petType!==be.MONSTERPLANT&&o(H,{variant:"dark",onClick:d=>h("respect"),children:p("infostand.button.petrespect",["count"],[c.toString()])})]})]})},NZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,s=_.useMemo(()=>!(e.botSkills.indexOf(Ze.NO_PICK_UP)>=0||!e.amIOwner&&!e.amIAnyRoomController),[e]),r=()=>V(new Bd(e.webID));if(e)return g(D,{gap:1,children:[o(D,{className:"nitro-infostand rounded",children:g(D,{overflow:"visible",className:"container-fluid content-area",gap:1,children:[g(D,{gap:1,children:[g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(y,{variant:"white",small:!0,wrap:!0,children:e.name}),o(ei,{className:"cursor-pointer fa-icon",onClick:t})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{gap:1,children:[o(D,{fullWidth:!0,className:"body-image bot",children:o(as,{figure:e.figure,direction:4})}),o(D,{grow:!0,center:!0,gap:0,children:e.badges.length>0&&e.badges.map(i=>o(xt,{badgeCode:i,showInfo:!0},i))})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[o(P,{alignItems:"center",className:"bg-light-dark rounded py-1 px-2",children:o(y,{fullWidth:!0,wrap:!0,textBreak:!0,variant:"white",small:!0,className:"motto-content",children:e.motto})}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:e.ownerId}),o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.botowner",["name"],[e.ownerName])})]}),e.carryItem>0&&g(X,{children:[o("hr",{className:"m-0"}),o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.handitem",["item"],[p("handitem"+e.carryItem)])})]})]})]})}),s&&o(P,{justifyContent:"end",children:o(H,{variant:"dark",onClick:r,children:p("infostand.button.pickup")})})]})},Q_=n=>{const{type:e=-1,relationship:t=null}=n;if(!t)return null;const s=Xs.RELATIONSHIP_NAMES[e].toLocaleLowerCase();return g(P,{alignItems:"center",gap:1,children:[o("i",{className:`nitro-friends-spritesheet icon-${s}`}),o(P,{alignItems:"center",gap:0,children:g(y,{small:!0,variant:"white",onClick:r=>Sr(t.randomFriendId),children:[o("u",{children:t.randomFriendName}),t.friendCount>1&&" "+p(`extendedprofile.relstatus.others.${s}`,["count"],[(t.friendCount-1).toString()])]})})]})},yZ=n=>{const{relationships:e=null}=n;return!e||!e.relationshipStatusMap.length?null:g(X,{children:[o(Q_,{type:Xs.HEART,relationship:e.relationshipStatusMap.getValue(Xs.HEART)}),o(Q_,{type:Xs.SMILE,relationship:e.relationshipStatusMap.getValue(Xs.SMILE)}),o(Q_,{type:Xs.BOBBA,relationship:e.relationshipStatusMap.getValue(Xs.BOBBA)})]})},MZ=n=>{de(`navigator/search/${n}`),V(new Co("hotel_view",`tag:${n}`))},DZ=n=>{const{tags:e=null}=n;return!e||!e.length?null:g(X,{children:[o("hr",{className:"m-0"}),o(P,{className:"flex-tags",children:e&&e.length>0&&e.map((t,s)=>o(y,{variant:"white",className:"text-tags",onClick:r=>MZ(t),children:t},s))})]})},vZ=n=>{const{avatarInfo:e=null,setAvatarInfo:t=null,onClose:s=null}=n,[r,i]=_.useState(null),[a,l]=_.useState(!1),[c,u]=_.useState(null),{roomSession:h=null}=yt(),d=m=>{!a||m.length>ce("motto.max.length",38)||(h.sendMottoMessage(m),l(!1))},f=m=>d(m.target.value),E=m=>{switch(m.stopPropagation(),m.key){case"Enter":d(m.target.value);return}};return kt(YR.RSUBE_BADGES,m=>{!e||e.webID!==m.userId||e.badges.join("")===m.badges.join("")||t(I=>{const S=dr(I);return S.badges=m.badges,S})}),kt(JR.USER_FIGURE,m=>{!e||e.roomIndex!==m.roomIndex||t(R=>{const I=dr(R);return I.figure=m.figure,I.motto=m.customInfo,I.achievementScore=m.activityPoints,I})}),kt(OR.FAVOURITE_GROUP_UPDATE,m=>{!e||e.roomIndex!==m.roomIndex||t(R=>{const I=dr(R),S=m.status===-1||m.habboGroupId<=0;return I.groupId=S?-1:m.habboGroupId,I.groupName=S?null:m.habboGroupName,I.groupBadgeId=S?null:$().getGroupBadge(m.habboGroupId),I})}),z(Xm,m=>{const R=m.getParser();!e||e.webID!==R.userId||u(R)}),_.useEffect(()=>(l(!1),i(e.motto),V(new EE(e.webID)),()=>{l(!1),i(null),u(null)}),[e]),e?o(D,{className:"nitro-infostand rounded",children:g(D,{overflow:"visible",className:"container-fluid content-area",gap:1,children:[g(D,{gap:1,children:[g(P,{alignItems:"center",justifyContent:"between",children:[g(P,{alignItems:"center",gap:1,children:[o(Ci,{userId:e.webID}),o(y,{variant:"white",small:!0,wrap:!0,children:e.name})]}),o(ei,{className:"cursor-pointer fa-icon",onClick:s})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{gap:1,children:[o(D,{fullWidth:!0,className:"body-image",onClick:m=>Sr(e.webID),children:o(as,{figure:e.figure,direction:4})}),g(D,{grow:!0,alignItems:"center",gap:0,children:[g(P,{gap:1,children:[o(P,{center:!0,className:"badge-image",children:e.badges[0]&&o(xt,{badgeCode:e.badges[0],showInfo:!0})}),o(P,{center:!0,pointer:e.groupId>0,className:"badge-image",onClick:m=>Mu(e.groupId),children:e.groupId>0&&o(xt,{badgeCode:e.groupBadgeId,isGroup:!0,showInfo:!0,customTitle:e.groupName})})]}),g(P,{center:!0,gap:1,children:[o(P,{center:!0,className:"badge-image",children:e.badges[1]&&o(xt,{badgeCode:e.badges[1],showInfo:!0})}),o(P,{center:!0,className:"badge-image",children:e.badges[2]&&o(xt,{badgeCode:e.badges[2],showInfo:!0})})]}),g(P,{center:!0,gap:1,children:[o(P,{center:!0,className:"badge-image",children:e.badges[3]&&o(xt,{badgeCode:e.badges[3],showInfo:!0})}),o(P,{center:!0,className:"badge-image",children:e.badges[4]&&o(xt,{badgeCode:e.badges[4],showInfo:!0})})]})]})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[g(P,{alignItems:"center",className:"bg-light-dark rounded py-1 px-2",children:[e.type!==Ds.OWN_USER&&o(P,{grow:!0,alignItems:"center",className:"motto-content",children:o(y,{fullWidth:!0,pointer:!0,wrap:!0,textBreak:!0,small:!0,variant:"white",children:r})}),e.type===Ds.OWN_USER&&g(P,{grow:!0,alignItems:"center",gap:2,children:[o(NU,{className:"small fa-icon"}),g(P,{grow:!0,alignItems:"center",className:"motto-content",children:[!a&&g(y,{fullWidth:!0,pointer:!0,wrap:!0,textBreak:!0,small:!0,variant:"white",onClick:m=>l(!0),children:[r," "]}),a&&o("input",{type:"text",className:"motto-input",maxLength:ce("motto.max.length",38),value:r,onChange:m=>i(m.target.value),onBlur:f,onKeyDown:E,autoFocus:!0})]})]})]}),o("hr",{className:"m-0"})]}),g(D,{gap:1,children:[o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.achievement_score")+" "+e.achievementScore}),e.carryItem>0&&g(X,{children:[o("hr",{className:"m-0"}),o(y,{variant:"white",small:!0,wrap:!0,children:p("infostand.text.handitem",["item"],[p("handitem"+e.carryItem)])})]})]}),o(D,{gap:1,children:o(yZ,{relationships:c})}),ce("user.tags.enabled")&&o(D,{gap:1,className:"mt-1",children:o(DZ,{tags:$().tags})})]})}):null};class bZ{constructor(e){this._data=[e]}getMessageArray(){return this._data}dispose(){}}function PZ(n){V(new bZ(n))}const J_=0,LZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,[s,r]=_.useState(J_),{canRequestFriend:i=null}=Wr(),a=_.useMemo(()=>{let c=!1;const u=Go();if(u){const h=u.model.getValue(C.FIGURE_CARRY_OBJECT);h>0&&h<999999&&(c=!0)}return c},[]),l=c=>{if(c)switch(c){case"attack":PZ(e.webID);break;case"whisper":Fs(new bc(bc.WHISPER,e.name));break;case"friend":de(`friends/request/${e.webID}/${e.name}`);break;case"trade":V(new cM(e.roomIndex));break;case"pass_hand_item":V(new nv(e.webID));break}t()};return _.useEffect(()=>{r(J_)},[e]),g(Cn,{objectId:e.roomIndex,category:k.UNIT,userType:e.userType,onClose:t,collapsable:!0,children:[o(cr,{className:"cursor-pointer",onClick:c=>Sr(e.webID),children:e.name}),s===J_&&g(X,{children:[o(ae,{onClick:c=>l("attack"),children:p("infostand.button.attack")}),i(e.webID)&&o(ae,{onClick:c=>l("friend"),children:p("infostand.button.friend")}),o(ae,{onClick:c=>l("trade"),children:p("infostand.button.trade")}),o(ae,{onClick:c=>l("whisper"),children:p("infostand.button.whisper")}),a&&o(ae,{onClick:c=>l("pass_hand_item"),children:p("avatar.widget.pass_hand_item")})]})]})},kL=n=>{const{classNames:e=[],...t}=n,s=_.useMemo(()=>{const r=["menu-list"];return e.length&&r.push(...e),r},[e]);return o(D,{classNames:s,...t})},UZ=n=>{const{userId:e=-1,userName:t="",roomIndex:s=-1,setIsDecorating:r=null}=n;return o(Cn,{objectId:s,category:k.UNIT,onClose:null,children:o(kL,{children:o(ae,{onClick:i=>r(!1),children:p("widget.avatar.stop_decorating")})})})},FZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,s=r=>{if(r)switch(r){case"move":dl(e.id,e.category,ye.OBJECT_MOVE);break;case"rotate":dl(e.id,e.category,ye.OBJECT_ROTATE_POSITIVE);break;case"pickup":dl(e.id,e.category,ye.OBJECT_PICKUP);break;case"eject":dl(e.id,e.category,ye.OBJECT_EJECT);break}};return g(Cn,{objectId:e.id,category:e.category,onClose:t,collapsable:!0,children:[o(cr,{children:e.name}),g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:r=>s("move"),children:o(yU,{className:"center fa-icon"})}),o(ae,{onClick:r=>s("rotate"),disabled:e.isWallItem,children:o(MU,{className:"center fa-icon"})}),(e.isOwner||e.isAnyRoomController)&&o(ae,{onClick:r=>s("pickup"),children:o(mp,{className:"center fa-icon"})}),!e.isOwner&&!e.isAnyRoomController&&(e.isRoomOwner||e.roomControllerLevel>=ct.GUILD_ADMIN)&&o(ae,{onClick:r=>s("eject"),children:o(mp,{className:"center fa-icon"})})]})]})},eT=n=>{const{nameInfo:e=null,onClose:t=null}=n,s=_.useMemo(()=>{const r=["name-only"];return e.isFriend&&r.push("is-friend"),r},[e]);return o(Cn,{objectId:e.roomIndex,category:e.category,userType:e.userType,fades:e.id!==$().userId,classNames:s,onClose:t,children:o("div",{className:"text-shadow",children:e.name})})},Z_=0,$_=1,tT=3,sT=4,xZ=n=>{const{avatarInfo:e=null,isDancing:t=!1,setIsDecorating:s=null,onClose:r=null}=n,[i,a]=_.useState(t&&Io()?$_:Z_),{roomSession:l=null}=yt(),c=d=>{let f=!0;if(d)if(d.startsWith("sign_")){const E=parseInt(d.split("_")[1]);l.sendSignMessage(E)}else switch(d){case"decorate":s(!0);break;case"change_name":Fs(new cd(cd.INIT));break;case"change_looks":de("avatar-editor/show");break;case"expressions":f=!1,a(tT);break;case"sit":l.sendPostureMessage(nd.POSTURE_SIT);break;case"stand":l.sendPostureMessage(nd.POSTURE_STAND);break;case"wave":l.sendExpressionMessage(on.WAVE.ordinal);break;case"blow":l.sendExpressionMessage(on.BLOW.ordinal);break;case"laugh":l.sendExpressionMessage(on.LAUGH.ordinal);break;case"idle":l.sendExpressionMessage(on.IDLE.ordinal);break;case"dance_menu":f=!1,a($_);break;case"dance":l.sendDanceMessage(1);break;case"dance_stop":l.sendDanceMessage(0);break;case"dance_1":case"dance_2":case"dance_3":case"dance_4":l.sendDanceMessage(parseInt(d.charAt(d.length-1)));break;case"signs":f=!1,a(sT);break;case"back":f=!1,a(Z_);break;case"drop_carry_item":V(new iv);break}f&&r()},u=()=>e.amIOwner||e.amIAnyRoomController||e.roomControllerLevel>ct.GUEST,h=C6();return g(Cn,{objectId:e.roomIndex,category:k.UNIT,userType:e.userType,onClose:r,collapsable:!0,children:[o(cr,{className:"cursor-pointer",onClick:d=>Sr(e.webID),children:e.name}),i===Z_&&g(X,{children:[e.allowNameChange&&o(ae,{onClick:d=>c("change_name"),children:p("widget.avatar.change_name")}),u()&&o(ae,{onClick:d=>c("decorate"),children:p("widget.avatar.decorate")}),o(ae,{onClick:d=>c("change_looks"),children:p("widget.memenu.myclothes")}),Io()&&!h&&g(ae,{onClick:d=>c("dance_menu"),children:[o(Da,{className:"right fa-icon"}),p("widget.memenu.dance")]}),!t&&!Io()&&!h&&o(ae,{onClick:d=>c("dance"),children:p("widget.memenu.dance")}),t&&!Io()&&!h&&o(ae,{onClick:d=>c("dance_stop"),children:p("widget.memenu.dance.stop")}),g(ae,{onClick:d=>c("expressions"),children:[o(Da,{className:"right fa-icon"}),p("infostand.link.expressions")]}),g(ae,{onClick:d=>c("signs"),children:[o(Da,{className:"right fa-icon"}),p("infostand.show.signs")]}),e.carryItem>0&&o(ae,{onClick:d=>c("drop_carry_item"),children:p("avatar.widget.drop_hand_item")})]}),i===$_&&g(X,{children:[t&&o(ae,{onClick:d=>c("dance_stop"),children:p("widget.memenu.dance.stop")}),o(ae,{onClick:d=>c("dance_1"),children:p("widget.memenu.dance1")}),o(ae,{onClick:d=>c("dance_2"),children:p("widget.memenu.dance2")}),o(ae,{onClick:d=>c("dance_3"),children:p("widget.memenu.dance3")}),o(ae,{onClick:d=>c("dance_4"),children:p("widget.memenu.dance4")}),g(ae,{onClick:d=>c("back"),children:[o(Ma,{className:"left fa-icon"}),p("generic.back")]})]}),i===tT&&g(X,{children:[O6()===fe.POSTURE_STAND&&o(ae,{onClick:d=>c("sit"),children:p("widget.memenu.sit")}),u6()&&o(ae,{onClick:d=>c("stand"),children:p("widget.memenu.stand")}),k_()&&o(ae,{onClick:d=>c("wave"),children:p("widget.memenu.wave")}),k_()&&g(ae,{disabled:!Hu(),onClick:d=>c("laugh"),children:[!Hu()&&o(gs,{type:"hc"}),p("widget.memenu.laugh")]}),k_()&&g(ae,{disabled:!Hu(),onClick:d=>c("blow"),children:[!Hu()&&o(gs,{type:"hc"}),p("widget.memenu.blow")]}),o(ae,{onClick:d=>c("idle"),children:p("widget.memenu.idle")}),g(ae,{onClick:d=>c("back"),children:[o(Ma,{className:"left fa-icon"}),p("generic.back")]})]}),i===sT&&g(X,{children:[g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:d=>c("sign_1"),children:"1"}),o(ae,{onClick:d=>c("sign_2"),children:"2"}),o(ae,{onClick:d=>c("sign_3"),children:"3"})]}),g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:d=>c("sign_4"),children:"4"}),o(ae,{onClick:d=>c("sign_5"),children:"5"}),o(ae,{onClick:d=>c("sign_6"),children:"6"})]}),g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:d=>c("sign_7"),children:"7"}),o(ae,{onClick:d=>c("sign_8"),children:"8"}),o(ae,{onClick:d=>c("sign_9"),children:"9"})]}),g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:d=>c("sign_10"),children:"10"}),o(ae,{onClick:d=>c("sign_11"),children:o("i",{className:"icon icon-sign-heart"})}),o(ae,{onClick:d=>c("sign_12"),children:o("i",{className:"icon icon-sign-skull"})})]}),g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:d=>c("sign_0"),children:"0"}),o(ae,{onClick:d=>c("sign_13"),children:o("i",{className:"icon icon-sign-exclamation"})}),o(ae,{onClick:d=>c("sign_15"),children:o("i",{className:"icon icon-sign-smile"})})]}),g(P,{className:"menu-list-split-3",children:[o(ae,{onClick:d=>c("sign_14"),children:o("i",{className:"icon icon-sign-soccer"})}),o(ae,{onClick:d=>c("sign_17"),children:o("i",{className:"icon icon-sign-yellow"})}),o(ae,{onClick:d=>c("sign_16"),children:o("i",{className:"icon icon-sign-red"})})]}),g(ae,{onClick:d=>c("back"),children:[o(Ma,{className:"left fa-icon"}),p("generic.back")]})]})]})},eg=0,rT=1,iT=2,nT=3,wZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,[s,r]=_.useState(eg),{roomSession:i=null}=yt(),{petRespectRemaining:a=0,respectPet:l=null}=za(),c=_.useMemo(()=>{let h=!1;const d=Go();if(d){const f=d.model.getValue(C.FIGURE_CARRY_OBJECT);f>0&&f<999999&&(h=!0)}return h},[]),u=h=>{let d=!0;if(h)switch(h){case"respect":l(e.id),a-1>=1&&(d=!1);break;case"treat":V(new lu(e.id));break;case"pass_handitem":V(new _E(e.id));break;case"train":i.requestPetCommands(e.id);break;case"pick_up":i.pickupPet(e.id);break;case"mount":i.mountPet(e.id);break;case"toggle_riding_permission":i.togglePetRiding(e.id);break;case"toggle_breeding_permission":i.togglePetBreeding(e.id);break;case"dismount":i.dismountPet(e.id);break;case"saddle_off":i.removePetSaddle(e.id);break;case"breed":break;case"harvest":i.harvestPet(e.id);break;case"revive":break;case"compost":i.compostPlant(e.id);break;case"buy_saddle":de("catalog/open/"+ce("catalog.links")["pets.buy_saddle"]);break}d&&t()};return _.useEffect(()=>{r(h=>e.petType===be.MONSTERPLANT?nT:e.saddle&&!e.rider?rT:e.rider?iT:eg)},[e]),g(Cn,{objectId:e.roomIndex,category:k.UNIT,userType:Rt.PET,onClose:t,collapsable:!0,children:[o(cr,{children:e.name}),s===eg&&g(X,{children:[a>0&&o(ae,{onClick:h=>u("respect"),children:p("infostand.button.petrespect",["count"],[a.toString()])}),o(ae,{onClick:h=>u("train"),children:p("infostand.button.train")}),o(ae,{onClick:h=>u("pick_up"),children:p("infostand.button.pickup")}),e.petType===be.HORSE&&o(ae,{onClick:h=>u("buy_saddle"),children:p("infostand.button.buy_saddle")}),[be.BEAR,be.TERRIER,be.CAT,be.DOG,be.PIG].indexOf(e.petType)>-1&&o(ae,{onClick:h=>u("breed"),children:p("infostand.button.breed")})]}),s===rT&&g(X,{children:[o(ae,{onClick:h=>u("mount"),children:p("infostand.button.mount")}),g(ae,{onClick:h=>u("toggle_riding_permission"),gap:1,children:[o("input",{type:"checkbox",checked:!!e.publiclyRideable,readOnly:!0}),p("infostand.button.toggle_riding_permission")]}),a>0&&o(ae,{onClick:h=>u("respect"),children:p("infostand.button.petrespect",["count"],[a.toString()])}),o(ae,{onClick:h=>u("train"),children:p("infostand.button.train")}),o(ae,{onClick:h=>u("pick_up"),children:p("infostand.button.pickup")}),o(ae,{onClick:h=>u("saddle_off"),children:p("infostand.button.saddleoff")})]}),s===iT&&g(X,{children:[o(ae,{onClick:h=>u("dismount"),children:p("infostand.button.dismount")}),a>0&&o(ae,{onClick:h=>u("respect"),children:p("infostand.button.petrespect",["count"],[a.toString()])})]}),s===nT&&g(X,{children:[o(ae,{onClick:h=>u("pick_up"),children:p("infostand.button.pickup")}),e.dead&&o(ae,{onClick:h=>u("revive"),children:p("infostand.button.revive")}),i.isRoomOwner&&o(ae,{onClick:h=>u("compost"),children:p("infostand.button.compost")}),!e.dead&&e.energy/e.maximumEnergy<.98&&o(ae,{onClick:h=>u("treat"),children:p("infostand.button.pettreat")}),!e.dead&&e.level===e.maximumLevel&&e.breedable&&g(X,{children:[g(ae,{onClick:h=>u("toggle_breeding_permission"),gap:1,children:[o("input",{type:"checkbox",checked:e.publiclyBreedable,readOnly:!0}),p("infostand.button.toggle_breeding_permission")]}),o(ae,{onClick:h=>u("breed"),children:p("infostand.button.breed")})]})]}),c&&o(ae,{onClick:h=>u("pass_hand_item"),children:p("infostand.button.pass_hand_item")})]})},tg=0,aT=1,oT=2,lT=3,GZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,[s,r]=_.useState(tg),{roomSession:i=null}=yt(),{petRespectRemaining:a=0,respectPet:l=null}=za(),c=_.useMemo(()=>i.isRoomOwner||i.controllerLevel>=ct.GUEST||$().isModerator,[i]),u=_.useMemo(()=>{let d=!1;const f=Go();if(f){const E=f.model.getValue(C.FIGURE_CARRY_OBJECT);E>0&&E<999999&&(d=!0)}return d},[]),h=d=>{let f=!0;if(d)switch(d){case"respect":l(e.id),a-1>=1&&(f=!1);break;case"treat":V(new lu(e.id));break;case"pass_handitem":V(new _E(e.id));break;case"pick_up":i.pickupPet(e.id);break;case"mount":i.mountPet(e.id);break;case"dismount":i.dismountPet(e.id);break}f&&t()};return _.useEffect(()=>{r(d=>e.petType===be.MONSTERPLANT?lT:e.saddle&&!e.rider?aT:e.rider?oT:tg)},[e]),g(Cn,{objectId:e.roomIndex,category:k.UNIT,userType:Rt.PET,onClose:t,collapsable:!0,children:[o(cr,{children:e.name}),s===tg&&a>0&&o(ae,{onClick:d=>h("respect"),children:p("infostand.button.petrespect",["count"],[a.toString()])}),s===aT&&g(X,{children:[!!e.publiclyRideable&&o(ae,{onClick:d=>h("mount"),children:p("infostand.button.mount")}),a>0&&o(ae,{onClick:d=>h("respect"),children:p("infostand.button.petrespect",["count"],[a.toString()])})]}),s===oT&&g(X,{children:[o(ae,{onClick:d=>h("dismount"),children:p("infostand.button.dismount")}),a>0&&o(ae,{onClick:d=>h("respect"),children:p("infostand.button.petrespect",["count"],[a.toString()])})]}),s===lT&&!e.dead&&e.energy/e.maximumEnergy<.98&&o(ae,{onClick:d=>h("treat"),children:p("infostand.button.pettreat")}),c&&o(ae,{onClick:d=>h("pick_up"),children:p("infostand.button.pickup")}),u&&o(ae,{onClick:d=>h("pass_hand_item"),children:p("infostand.button.pass_hand_item")})]})},sg=0,cT=1,uT=2,BZ=n=>{const{avatarInfo:e=null,onClose:t=null}=n,[s,r]=_.useState(sg),[i,a]=_.useState(""),[l,c]=_.useState("");z(PA,f=>{const E=f.getParser();if(E.botId===e.webID)switch(E.commandId){case Ze.CHANGE_BOT_NAME:a(E.data),r(cT);return;case Ze.CHANGE_BOT_MOTTO:c(E.data),r(uT);return;case Ze.SETUP_CHAT:{const m=E.data,R=m.split(m.indexOf(";#;")===-1?";":";#;");(R.length===3||R.length===4)&&(Fs(new PP(e.roomIndex,k.UNIT,e.webID,R[0],R[1].toLowerCase()==="true"||R[1]==="1",parseInt(R[2]),R[3]?R[3].toLowerCase()==="true"||R[3]==="1":!1)),t());return}}});const u=f=>V(new hD(e.webID,f)),h=f=>{let E=!0;if(f)switch(f){case"donate_to_all":u(Ze.DONATE_TO_ALL),V(new an(e.webID,Ze.DONATE_TO_ALL,""));break;case"donate_to_user":u(Ze.DONATE_TO_USER),V(new an(e.webID,Ze.DONATE_TO_USER,""));break;case"change_bot_name":u(Ze.CHANGE_BOT_NAME),E=!1;break;case"save_bot_name":V(new an(e.webID,Ze.CHANGE_BOT_NAME,i));break;case"change_bot_motto":u(Ze.CHANGE_BOT_MOTTO),E=!1;break;case"save_bot_motto":V(new an(e.webID,Ze.CHANGE_BOT_MOTTO,l));break;case"dress_up":V(new an(e.webID,Ze.DRESS_UP,""));break;case"random_walk":V(new an(e.webID,Ze.RANDOM_WALK,""));break;case"setup_chat":u(Ze.SETUP_CHAT),E=!1;break;case"dance":V(new an(e.webID,Ze.DANCE,""));break;case"nux_take_tour":ze().createLinkEvent("help/tour"),V(new an(e.webID,Ze.NUX_TAKE_TOUR,""));break;case"pick":V(new Bd(e.webID));break}E&&t()};_.useEffect(()=>{r(sg)},[e]);const d=e.amIOwner||e.amIAnyRoomController;return g(Cn,{objectId:e.roomIndex,category:k.UNIT,userType:Rt.RENTABLE_BOT,onClose:t,collapsable:!0,children:[o(cr,{children:e.name}),s===sg&&d&&g(X,{children:[e.botSkills.indexOf(Ze.DONATE_TO_ALL)>=0&&o(ae,{onClick:f=>h("donate_to_all"),children:p("avatar.widget.donate_to_all")}),e.botSkills.indexOf(Ze.DONATE_TO_USER)>=0&&o(ae,{onClick:f=>h("donate_to_user"),children:p("avatar.widget.donate_to_user")}),e.botSkills.indexOf(Ze.CHANGE_BOT_NAME)>=0&&o(ae,{onClick:f=>h("change_bot_name"),children:p("avatar.widget.change_bot_name")}),e.botSkills.indexOf(Ze.CHANGE_BOT_MOTTO)>=0&&o(ae,{onClick:f=>h("change_bot_motto"),children:p("avatar.widget.change_bot_motto")}),e.botSkills.indexOf(Ze.DRESS_UP)>=0&&o(ae,{onClick:f=>h("dress_up"),children:p("avatar.widget.dress_up")}),e.botSkills.indexOf(Ze.RANDOM_WALK)>=0&&o(ae,{onClick:f=>h("random_walk"),children:p("avatar.widget.random_walk")}),e.botSkills.indexOf(Ze.SETUP_CHAT)>=0&&o(ae,{onClick:f=>h("setup_chat"),children:p("avatar.widget.setup_chat")}),e.botSkills.indexOf(Ze.DANCE)>=0&&o(ae,{onClick:f=>h("dance"),children:p("avatar.widget.dance")}),e.botSkills.indexOf(Ze.NO_PICK_UP)===-1&&o(ae,{onClick:f=>h("pick"),children:p("avatar.widget.pick_up")})]}),s===cT&&g(D,{className:"menu-item",onClick:null,gap:1,children:[o(y,{variant:"white",children:p("bot.skill.name.configuration.new.name")}),o("input",{type:"text",className:"form-control form-control-sm",value:i,maxLength:ce("bot.name.max.length",15),onChange:f=>a(f.target.value)}),g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(H,{fullWidth:!0,variant:"secondary",onClick:f=>h(null),children:p("cancel")}),o(H,{fullWidth:!0,variant:"success",onClick:f=>h("save_bot_name"),children:p("save")})]})]}),s===uT&&g(D,{className:"menu-item",onClick:null,gap:1,children:[o(y,{variant:"white",children:p("bot.skill.name.configuration.new.motto")}),o("input",{type:"text",className:"form-control form-control-sm",value:l,maxLength:ce("motto.max.length",38),onChange:f=>c(f.target.value)}),g(P,{alignItems:"center",justifyContent:"between",gap:1,children:[o(H,{fullWidth:!0,variant:"secondary",onClick:f=>h(null),children:p("cancel")}),o(H,{fullWidth:!0,variant:"success",onClick:f=>h("save_bot_motto"),children:p("save")})]})]})]})},kZ=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(!1),[i,a]=_.useState(null),{avatarInfo:l=null,setAvatarInfo:c=null,activeNameBubble:u=null,setActiveNameBubble:h=null,nameBubbles:d=[],removeNameBubble:f=null,productBubbles:E=[],confirmingProduct:m=null,updateConfirmingProduct:R=null,removeProductBubble:I=null,isDecorating:S=!1,setIsDecorating:A=null}=R8(),{roomSession:N=null}=yt();$e(je.NORMAL_MODE,b=>{e&&t(!1)}),$e(je.GAME_MODE,b=>{e||t(!0)}),kt(IR.RSDE_DANCE,b=>{b.roomIndex===N.ownRoomIndex&&r(b.danceId!==0)}),Ts(PP.UPDATE_CHAT,b=>a(b));const L=()=>{if(!N||e)return null;if(u)return o(eT,{nameInfo:u,onClose:()=>h(null)});if(l)switch(l.type){case Fl.FURNI:{const b=l;return S?o(FZ,{avatarInfo:b,onClose:()=>c(null)}):null}case Ds.OWN_USER:case Ds.PEER:{const b=l;return ce("user.tags.enabled")&&$().getUserTags(b.roomIndex),b.isSpectatorMode?null:b.isOwnUser?xi.isRunning()?null:o(xZ,{avatarInfo:b,isDancing:s,setIsDecorating:A,onClose:()=>c(null)}):o(LZ,{avatarInfo:b,onClose:()=>c(null)})}case xl.PET_INFO:{const b=l;return b.isOwner?o(wZ,{avatarInfo:b,onClose:()=>c(null)}):o(GZ,{avatarInfo:b,onClose:()=>c(null)})}case wl.RENTABLE_BOT:return o(BZ,{avatarInfo:l,onClose:()=>c(null)})}return null},M=()=>{if(!l)return null;switch(l.type){case Fl.FURNI:return o(CZ,{avatarInfo:l,onClose:()=>c(null)});case Ds.OWN_USER:case Ds.PEER:return o(vZ,{avatarInfo:l,setAvatarInfo:c,onClose:()=>c(null)});case Ds.BOT:return o(SZ,{avatarInfo:l,onClose:()=>c(null)});case wl.RENTABLE_BOT:return o(NZ,{avatarInfo:l,onClose:()=>c(null)});case xl.PET_INFO:return o(AZ,{avatarInfo:l,onClose:()=>c(null)})}};return g(X,{children:[S&&o(UZ,{userId:$().userId,userName:$().userName,roomIndex:N.ownRoomIndex,setIsDecorating:A}),L(),l&&o(D,{alignItems:"end",className:"nitro-infostand-container",children:M()}),d.length>0&&d.map((b,B)=>o(eT,{nameInfo:b,onClose:()=>f(B)},B)),E.length>0&&E.map((b,B)=>o(OZ,{item:b,updateConfirmingProduct:R,onClose:()=>I(B)},b.id)),i&&o(mZ,{chatEvent:i,onClose:()=>a(null)}),m&&o(EZ,{item:m,onClose:()=>R(null)}),o(fZ,{})]})},VZ=n=>{const{chatStyleId:e=0,chatStyleIds:t=null,selectChatStyleId:s=null}=n,[r,i]=_.useState(null),[a,l]=_.useState(!1),c=h=>{s(h),l(!1)},u=h=>{let d=!1;l(f=>(d=!f,d)),d&&i(h.target)};return _.useEffect(()=>{a||i(null)},[a]),g(X,{children:[o(j,{pointer:!0,className:"icon chatstyles-icon",onClick:u}),o(IT,{show:a,target:r,placement:"top",children:o(Ah,{className:"nitro-chat-style-selector-container image-rendering-pixelated",children:o(Ee,{overflow:"hidden",className:"bg-transparent",children:o(ge,{columnCount:3,overflow:"auto",children:t&&t.length>0&&t.map(h=>o(P,{center:!0,pointer:!0,className:"bubble-parent-container",onClick:d=>c(h),children:o(j,{className:"bubble-container",children:o(j,{className:`chat-bubble bubble-${h}`,children:" "})},h)},h))})})})})]})},HZ=n=>{const[e,t]=_.useState(""),{chatStyleId:s=0,updateChatStyleId:r=null}=za(),{selectedUsername:i="",floodBlocked:a=!1,floodBlockedSeconds:l=0,setIsTyping:c=null,setIsIdle:u=null,sendChat:h=null}=S8(),{roomSession:d=null}=yt(),f=_.useRef(),E=_.useMemo(()=>p("widgets.chatinput.mode.whisper"),[]),m=_.useMemo(()=>p("widgets.chatinput.mode.shout"),[]),R=_.useMemo(()=>p("widgets.chatinput.mode.speak"),[]),I=_.useMemo(()=>ce("chat.input.maxlength",100),[]),S=_.useCallback(()=>{const w=document.activeElement;return!(!w||f&&f.current===w||!(w instanceof HTMLInputElement)&&!(w instanceof HTMLTextAreaElement))},[f]),A=_.useCallback(()=>{f.current.focus(),f.current.setSelectionRange(f.current.value.length*2,f.current.value.length*2)},[f]),N=_.useCallback(()=>{t(w=>w!==E||!i.length?w:`${w} ${i}`)},[i,E]),L=_.useCallback((w,x=!1)=>{if(!w||w==="")return;let U=x?Gi.CHAT_SHOUT:Gi.CHAT_DEFAULT,G=w;const K=G.split(" ");let Y="",te="";switch(K[0]){case E:U=Gi.CHAT_WHISPER,Y=K[1],te=E+" "+Y+" ",K.shift(),K.shift();break;case m:U=Gi.CHAT_SHOUT,K.shift();break;case R:U=Gi.CHAT_DEFAULT,K.shift();break}G=K.join(" "),c(!1),u(!1),G.length<=I&&(/%CC%/g.test(encodeURIComponent(G))?t(""):(t(""),h(G,U,Y,s))),t(te)},[E,m,R,I,s,c,u,h]),M=_.useCallback(w=>{!w||!w.length?c(!1):(c(!0),u(!0)),t(w)},[c,u]),b=_.useCallback(w=>{if(a||!f.current||S())return;document.activeElement!==f.current&&A();const x=w.target.value;switch(w.key){case" ":case"Space":N();return;case"NumpadEnter":case"Enter":L(x,w.shiftKey);return;case"Backspace":if(x){const U=x.split(" ");U[0]===E&&U.length===3&&U[2]===""&&t("")}return}},[a,f,E,S,A,N,L]);Ts(bc.CHAT_INPUT_CONTENT,w=>{switch(w.chatMode){case bc.WHISPER:{t(`${E} ${w.userName} `);return}case bc.SHOUT:return}});const B=_.useMemo(()=>{let w=[];const x=ce("chat.styles");for(const U of x)if(U){if(U.minRank>0){$().hasSecurity(U.minRank)&&w.push(U.styleId);continue}if(U.isSystemStyle&&$().hasSecurity(ct.MODERATOR)){w.push(U.styleId);continue}if(!(ce("chat.styles.disabled").indexOf(U.styleId)>=0)){if(U.isHcOnly&&Qr()>=_r.CLUB){w.push(U.styleId);continue}if(U.isAmbassadorOnly&&$().isAmbassador){w.push(U.styleId);continue}!U.isHcOnly&&!U.isAmbassadorOnly&&w.push(U.styleId)}}return w},[]);return _.useEffect(()=>(document.body.addEventListener("keydown",b),()=>{document.body.removeEventListener("keydown",b)}),[b]),_.useEffect(()=>{f.current&&(f.current.parentElement.dataset.value=e)},[e]),!d||d.isSpectator?null:tm.createPortal(g("div",{className:"nitro-chat-input-container",children:[g("div",{className:"input-sizer align-items-center",children:[!a&&o("input",{ref:f,type:"text",className:"chat-input",placeholder:p("widgets.chatinput.default"),value:e,maxLength:I,onChange:w=>M(w.target.value),onMouseDown:w=>A()}),a&&g(y,{variant:"danger",children:[p("chat.input.alert.flood",["time"],[l.toString()])," "]})]}),o(VZ,{chatStyleId:s,chatStyleIds:B,selectChatStyleId:r})]}),document.getElementById("toolbar-chat-input-container"))},jZ=()=>{let n=null;self.onmessage=e=>{if(!e)return;const t=e.data;switch(t.action){case"START":n=setInterval(()=>postMessage(null),t.content);break;case"STOP":n&&(clearInterval(n),n=null);break}}};class WZ extends Worker{constructor(e){const t=e.toString(),s=new Blob([`(${t})()`]);super(URL.createObjectURL(s))}}const YZ=n=>{const{chat:e=null,makeRoom:t=null,bubbleWidth:s=dt.CHAT_BUBBLE_WIDTH_NORMAL}=n,[r,i]=_.useState(!1),[a,l]=_.useState(!1),c=_.useRef(),u=_.useMemo(()=>{switch(s){case dt.CHAT_BUBBLE_WIDTH_NORMAL:return 350;case dt.CHAT_BUBBLE_WIDTH_THIN:return 240;case dt.CHAT_BUBBLE_WIDTH_WIDE:return 2e3}},[s]);return _.useEffect(()=>{i(!1);const h=c.current;if(!h)return;const d=h.offsetWidth,f=h.offsetHeight;e.width=d,e.height=f,e.elementRef=h;let E=e.left,m=e.top;return!E&&!m&&(E=e.location.x-d/2,m=h.parentElement.offsetHeight-f,e.left=E,e.top=m),l(!0),()=>{e.elementRef=null,l(!1)}},[e]),_.useEffect(()=>{!a||!e||r||(t&&t(e),i(!0))},[e,a,r,t]),g("div",{ref:c,className:`bubble-container ${r?"visible":"invisible"}`,onClick:h=>ee().selectRoomObject(e.roomId,e.senderId,k.UNIT),children:[e.styleId===0&&o("div",{className:"user-container-bg",style:{backgroundColor:e.color}}),g("div",{className:`chat-bubble bubble-${e.styleId} type-${e.type}`,style:{maxWidth:u},children:[o("div",{className:"user-container",children:e.imageUrl&&e.imageUrl.length>0&&o("div",{className:"user-image",style:{backgroundImage:`url(${e.imageUrl})`}})}),g("div",{className:"chat-content",children:[o("b",{className:"username mr-1",dangerouslySetInnerHTML:{__html:`${e.username}: `}}),o("span",{className:"message",dangerouslySetInnerHTML:{__html:`${e.formattedText}`}})]}),o("div",{className:"pointer"})]})]})},zZ=n=>{const{chatMessages:e=[],setChatMessages:t=null,chatSettings:s=null,getScrollSpeed:r=6e3}=A8(),i=_.useRef(),a=_.useCallback(()=>{t(u=>{if(u){const h=u.filter(d=>d.top>-d.height*2);if(h.length!==u.length)return h}return u})},[t]),l=_.useCallback((u,h,d)=>{for(let f=e.indexOf(u)-1;f>=0;f--){const E=e[f];if(!(!E||u===E||d.indexOf(E)>=0||E.top+E.height-h>u.top+u.height)&&gq(u,E,-h,0)){const m=Math.abs(E.top+E.height-u.top);d.push(E),E.top-=m,E.skipMovement=!0,l(E,m,d)}}},[e]),c=_.useCallback(u=>{if(s.mode===dt.CHAT_MODE_FREE_FLOW)u.skipMovement=!0,l(u,0,[u]),a();else{const h=u.top+u.height,d=u.height,f=i.current.offsetHeight-h,E=d-f;f<d&&(t(m=>(m.forEach(R=>{R!==u&&(R.top-=E)}),m)),a())}},[s,l,a,t]);return _.useEffect(()=>{const u=(h=null)=>{if(!i||!i.current)return;const d=i.current.offsetHeight,f=Math.round(document.body.offsetHeight*ce("chat.viewer.height.percentage"));i.current.style.height=`${f}px`,t(E=>(E&&E.forEach(m=>m.top-=d-f),E))};return window.addEventListener("resize",u),u(),()=>{window.removeEventListener("resize",u)}},[t]),_.useEffect(()=>{const u=d=>{t(f=>(f.forEach(E=>{if(E.skipMovement){E.skipMovement=!1;return}E.top-=d}),f)),a()},h=new WZ(jZ);return h.onmessage=()=>u(15),h.postMessage({action:"START",content:r}),()=>{h.postMessage({action:"STOP"})}},[r,a,t]),o("div",{ref:i,className:"nitro-chat-widget",children:e.map(u=>o(YZ,{chat:u,makeRoom:c,bubbleWidth:s.weight},u.id))})},VL=n=>{const{title:e=null,items:t=[],selectItem:s=null,onClose:r=null}=n,[i,a]=_.useState(null),[l,c]=_.useState(""),u=$().isModerator,h=_.useMemo(()=>{const d=l.toLocaleLowerCase();return t.filter(f=>{var E;return(E=f.name)==null?void 0:E.toLocaleLowerCase().includes(d)})},[t,l]);return _.useEffect(()=>{i&&s(i)},[i,s]),g(Re,{className:"nitro-chooser-widget",theme:"primary-slim",children:[o(Te,{headerText:e,onCloseClick:r}),g(Ee,{overflow:"hidden",gap:2,children:[o("input",{type:"text",className:"form-control form-control-sm",placeholder:p("generic.search"),value:l,onChange:d=>c(d.target.value)}),o(g_,{rows:h,rowRender:d=>o(P,{alignItems:"center",className:$s("rounded p-1",i===d&&"bg-muted"),pointer:!0,onClick:f=>a(d),children:g(y,{truncate:!0,children:[d.name," ",u&&" - "+d.id]})})})]})]})},KZ=n=>{const{items:e=null,onClose:t=null,selectItem:s=null,populateChooser:r=null}=L8();return _.useEffect(()=>{const i={linkReceived:a=>{a.split("/"),r()},eventUrlPrefix:"furni-chooser/"};return Cs(i),()=>As(i)},[r]),e?o(VL,{title:p("widget.chooser.furni.title"),items:e,selectItem:s,onClose:t}):null},XZ=n=>{const{items:e=null,onClose:t=null,selectItem:s=null,populateChooser:r=null}=B8();return _.useEffect(()=>{const i={linkReceived:a=>{a.split("/"),r()},eventUrlPrefix:"user-chooser/"};return Cs(i),()=>As(i)},[r]),e?o(VL,{title:p("widget.chooser.user.title"),items:e,selectItem:s,onClose:t}):null},qZ=n=>{const[e,t]=_.useState(!1),{users:s=[],answer:r=null}=y8();return _.useEffect(()=>{t(!!s.length)},[s]),e?g(Re,{className:"nitro-widget-doorbell",theme:"primary-slim",children:[o(Te,{headerText:p("navigator.doorbell.title"),onCloseClick:i=>t(!1)}),g(Ee,{overflow:"hidden",gap:0,children:[o(D,{gap:2,children:g(ge,{gap:1,className:"text-black fw-bold border-bottom px-1 pb-1",children:[o(j,{className:"g-col-6",children:p("generic.username")}),o(j,{className:"g-col-6"})]})}),o(D,{overflow:"auto",className:"striped-children",gap:0,children:s&&s.length>0&&s.map(i=>g(ge,{gap:1,alignItems:"center",className:"text-black border-bottom p-1",children:[o(j,{className:"g-col-6",children:i}),o(j,{className:"g-col-6",children:g(P,{alignItems:"center",justifyContent:"end",gap:1,children:[o(H,{variant:"success",onClick:()=>r(i,!0),children:p("generic.accept")}),o(H,{variant:"danger",onClick:()=>r(i,!1),children:p("generic.deny")})]})})]},i))})]})]}):null},dp=n=>{const{objectId:e=-1,category:t=-1,noFollow:s=!1,position:r="absolute",...i}=n,[a,l]=_.useState({x:-1,y:-1}),c=_.useRef();return _.useEffect(()=>{let u=!1;const h=()=>{const f=at();return WE(f.roomId,e,t,1)},d=()=>{const f=h();!f||!c.current||l({x:Math.round(f.left+f.width/2-c.current.offsetWidth/2),y:Math.round(f.top-c.current.offsetHeight+10)})};return s?d():(u=!0,qs().add(d)),()=>{u&&qs().remove(d)}},[e,t,s]),o(j,{innerRef:c,position:r,visible:a.x+(c.current?c.current.offsetWidth:0)>-1,className:"object-location",style:{left:a.x,top:a.y},...i})},QZ=n=>{const{roomIndex:e=-1,request:t=null,hideFriendRequest:s=null,requestResponse:r=null}=n;return o(dp,{objectId:e,category:k.UNIT,children:o(j,{className:"nitro-friend-request-dialog nitro-context-menu p-2",children:g(D,{children:[g(P,{alignItems:"center",justifyContent:"between",gap:2,children:[o(y,{variant:"white",fontSize:6,children:p("widget.friendrequest.from",["username"],[t.name])}),o(ei,{className:"cursor-pointer fa-icon",onClick:i=>s(t.requesterUserId)})]}),g(P,{justifyContent:"end",gap:1,children:[o(H,{variant:"danger",onClick:i=>r(t.requesterUserId,!1),children:p("widget.friendrequest.decline")}),o(H,{variant:"success",onClick:i=>r(t.requesterUserId,!0),children:p("widget.friendrequest.accept")})]})]})})})},JZ=n=>{const{displayedRequests:e=[],hideFriendRequest:t=null}=b8(),{requestResponse:s=null}=Wr();return e.length?o(X,{children:e.map((r,i)=>o(QZ,{roomIndex:r.roomIndex,request:r.request,hideFriendRequest:t,requestResponse:s},i))}):null},ZZ=n=>{const{productType:e=Pe.FLOOR,classId:t=-1,extraParam:s=void 0}=n;switch(e){case Pe.WALL:case Pe.FLOOR:return o($E,{productType:e,productClassId:t});case Pe.BADGE:return o(xt,{badgeCode:s});case Pe.HABBO_CLUB:return o(gs,{type:"hc"})}return null},$Z=n=>{const{ownerId:e=-1}=n,[t,s]=_.useState(0),[r,i]=_.useState(void 0),a=()=>{t===1&&V(new LM(e)),s(0),i(void 0)};z(KC,c=>{s(1)}),z(WC,c=>{s(0),i(void 0)}),z(YC,c=>{const u=c.getParser();i({contentType:u.contentType,classId:u.classId}),s(2)});const l=$().userId===e;return t===0?null:g(Re,{className:"nitro-mysterybox-dialog",theme:"primary-slim",children:[o(Te,{headerText:p(t===1?`mysterybox.dialog.${l?"owner":"other"}.title`:"mysterybox.reward.title"),onCloseClick:a}),g(Ee,{children:[t===1&&g(X,{children:[g(y,{variant:"primary",children:[" ",p(`mysterybox.dialog.${l?"owner":"other"}.subtitle`)," "]}),g(y,{children:[" ",p(`mysterybox.dialog.${l?"owner":"other"}.description`)," "]}),g(y,{children:[" ",p(`mysterybox.dialog.${l?"owner":"other"}.waiting`)]}),g(H,{variant:"danger",onClick:a,className:"mt-auto",children:[" ",p(`mysterybox.dialog.${l?"owner":"other"}.cancel`)," "]})]}),t===2&&r&&g(X,{children:[g(y,{variant:"black",children:[" ",p("mysterybox.reward.text")," "]}),o(P,{className:"prize-container justify-content-center mx-auto",children:o(ZZ,{classId:r.classId,productType:r.contentType})}),g(H,{variant:"success",onClick:a,className:"mt-auto",children:[" ",p("mysterybox.reward.close")," "]})]})]})]})},e$=n=>{const{objectId:e=-1,onClose:t=null}=n,[s,r]=_.useState(""),i=()=>{V(new VD(e,s)),t()};return e===-1?null:g(Re,{className:"nitro-mysterytrophy-dialog no-resize",theme:"primary-slim",children:[o(Te,{center:!0,headerText:p("mysterytrophy.header.title"),onCloseClick:t}),g(Ee,{children:[g(P,{className:"mysterytrophy-dialog-top p-3",children:[o("div",{className:"mysterytrophy-image flex-shrink-0"}),o("div",{className:"m-2",children:o(y,{variant:"white",className:"mysterytrophy-text-big",children:p("mysterytrophy.header.description")})})]}),o(P,{className:"mysterytrophy-dialog-bottom p-2",children:g(D,{gap:1,children:[g(P,{alignItems:"center",className:"bg-white rounded py-1 px-2 input-mysterytrophy-dialog",children:[o("textarea",{className:"form-control form-control-sm input-mysterytrophy",value:s,onChange:a=>r(a.target.value)}),o("div",{className:"mysterytrophy-pencil-image flex-shrink-0 small fa-icon"})]}),g(P,{className:"mt-2",gap:5,display:"flex",justifyContent:"center",alignItems:"center",children:[o(y,{pointer:!0,className:"text-decoration",onClick:()=>t(),children:p("cancel")}),o(H,{variant:"success",onClick:()=>i(),children:p("generic.ok")})]})]})})]})]})},t$=n=>{const{objectId:e=-1,onClose:t=null}=n,{roomSession:s=null}=yt(),r=()=>{s.useMultistateItem(e),t()};return g(Re,{className:"nitro-use-product-confirmation",children:[o(Te,{headerText:p("effectbox.header.title"),onCloseClick:t}),o(Ee,{center:!0,children:o(P,{gap:2,children:g(D,{justifyContent:"between",children:[o(y,{children:p("effectbox.header.description")}),g(P,{alignItems:"center",justifyContent:"between",children:[o(H,{variant:"danger",onClick:t,children:p("generic.cancel")}),o(H,{variant:"success",onClick:r,children:p("generic.ok")})]})]})})})]})},eh=-1,s$=0,r$=n=>{const{objectId:e=-1,onClose:t=null}=n,[s,r]=_.useState(null),[i,a]=_.useState(eh),{roomSession:l=null}=yt(),c=()=>{l.useMultistateItem(e),t()};return _.useEffect(()=>{if(!l||e===-1)return;const u=i_(l.roomId,e,k.FLOOR);if(!u)return;r(u);let h=eh;switch(u.specialType){case he.MONSTERPLANT_SEED:h=s$;break}if(h===eh){t();return}a(h)},[l,e,t]),i===eh?null:g(Re,{className:"nitro-use-product-confirmation",children:[o(Te,{headerText:p("useproduct.widget.title.plant_seed",["name"],[s.name]),onCloseClick:t}),o(Ee,{center:!0,children:g(P,{gap:2,overflow:"hidden",children:[o(D,{children:o(j,{className:"product-preview",children:o(j,{className:"monsterplant-image"})})}),g(D,{justifyContent:"between",overflow:"auto",children:[g(D,{gap:2,children:[o(y,{children:p("useproduct.widget.text.plant_seed",["productName"],[s.name])}),o(y,{children:p("useproduct.widget.info.plant_seed")})]}),g(P,{alignItems:"center",justifyContent:"between",children:[o(H,{variant:"danger",onClick:t,children:p("useproduct.widget.cancel")}),o(H,{variant:"success",onClick:c,children:p("widget.monsterplant_seed.button.use")})]})]})]})})]})},th=-1,i$=0,n$=n=>{const{objectId:e=-1,onClose:t=null}=n,[s,r]=_.useState(th),[i,a]=_.useState(nt.MALE),[l,c]=_.useState(null),{roomSession:u=null}=yt(),h=()=>{Uf().send(new XD(e)),Uf().send(new mE(i,l)),t()};return _.useEffect(()=>{let d=th;const f=$().figure,E=$().gender,m=[];if(u&&e>=0){const R=i_(u.roomId,e,k.FLOOR);if(R)switch(R.specialType){case he.FIGURE_PURCHASABLE_SET:d=i$;const I=R.customParams.split(",").map(S=>parseInt(S));for(const S of I)fs().isValidFigureSetForGender(S,E)&&m.push(S);break}}if(d===th){t();return}a(E),c(fs().getFigureStringWithFigureIds(f,E,m)),r(d)},[u,e,t]),s===th?null:g(Re,{className:"nitro-use-product-confirmation",children:[o(Te,{headerText:p("useproduct.widget.title.bind_clothing"),onCloseClick:t}),o(Ee,{center:!0,children:g(P,{gap:2,overflow:"hidden",children:[o(D,{children:o(j,{className:"mannequin-preview",children:o(as,{figure:l,direction:2})})}),g(D,{justifyContent:"between",overflow:"auto",children:[g(D,{gap:2,children:[o(y,{children:p("useproduct.widget.text.bind_clothing")}),o(y,{children:p("useproduct.widget.info.bind_clothing")})]}),g(P,{alignItems:"center",justifyContent:"between",children:[o(H,{variant:"danger",onClick:t,children:p("useproduct.widget.cancel")}),o(H,{variant:"success",onClick:h,children:p("useproduct.widget.bind_clothing")})]})]})]})})]})},a$=n=>{const{closeConfirm:e=null,processAction:t=null,onClose:s=null,objectId:r=-1,mode:i=null,confirmMode:a=null,confirmingObjectId:l=-1,groupData:c=null,isGroupMember:u=!1,objectOwnerId:h=-1}=v7(),{simpleAlert:d=null}=Xt();z(xA,E=>{const m=E.getParser();if(m)switch(m.count){case 1:d(p("costumehopper.costumerequired.bodytext"),null,"catalog/open/temporary_effects",p("costumehopper.costumerequired.buy"),p("costumehopper.costumerequired.header"),null);break;case 2:d(p("viphopper.viprequired.bodytext"),null,"catalog/open/habbo_club",p("viprequired.buy.vip"),p("viprequired.header"),null);break;case 3:d(p("gate.viprequired.bodytext"),null,"catalog/open/habbo_club",p("viprequired.buy.vip"),p("gate.viprequired.title"),null);break}});const f=$().userId===h;return g(X,{children:[a===Xf&&o(r$,{objectId:l,onClose:e}),a===qf&&o(n$,{objectId:l,onClose:e}),a===EL&&o(t$,{objectId:l,onClose:e}),a===Qf&&o(e$,{objectId:l,onClose:e}),o($Z,{ownerId:h}),r>=0&&i&&g(Cn,{objectId:r,category:k.FLOOR,onClose:s,fades:!0,children:[i===Tt.FRIEND_FURNITURE&&g(X,{children:[o(cr,{children:p("friendfurni.context.title")}),o(ae,{onClick:E=>t("use_friend_furni"),children:p("friendfurni.context.use")})]}),i===Tt.MONSTERPLANT_SEED&&g(X,{children:[o(cr,{children:p("furni.mnstr_seed.name")}),o(ae,{onClick:E=>t("use_monsterplant_seed"),children:p("widget.monsterplant_seed.button.use")})]}),i===Tt.RANDOM_TELEPORT&&g(X,{children:[o(cr,{children:p("furni.random_teleport.name")}),o(ae,{onClick:E=>t("use_random_teleport"),children:p("widget.random_teleport.button.use")})]}),i===Tt.PURCHASABLE_CLOTHING&&g(X,{children:[o(cr,{children:p("furni.generic_usable.name")}),o(ae,{onClick:E=>t("use_purchaseable_clothing"),children:p("widget.generic_usable.button.use")})]}),i===Tt.MYSTERY_BOX&&g(X,{children:[o(cr,{children:p("mysterybox.context.title")}),o(ae,{onClick:E=>t("use_mystery_box"),children:p("mysterybox.context."+(f?"owner":"other")+".use")})]}),i===Tt.MYSTERY_TROPHY&&g(X,{children:[o(cr,{children:p("mysterytrophy.header.title")}),o(ae,{onClick:E=>t("use_mystery_trophy"),children:p("friendfurni.context.use")})]}),i===mL&&c&&g(X,{children:[o(cr,{className:"cursor-pointer text-truncate",onClick:()=>Mu(c.guildId),children:c.guildName}),!u&&o(ae,{onClick:E=>t("join_group"),children:p("widget.furniture.button.join.group")}),o(ae,{onClick:E=>t("go_to_group_homeroom"),children:p("widget.furniture.button.go.to.group.home.room")}),c.guildHasReadableForum&&o(ae,{onClick:E=>t("open_forum"),children:p("widget.furniture.button.open_group_forum")})]})]})]})},o$=n=>{const{objectId:e=-1,color:t=0,setColor:s=null,applyToner:r=null,toggleToner:i=null,onClose:a=null}=N7();return e===-1?null:g(Re,{theme:"primary-slim",className:"nitro-room-widget-toner",children:[o(Te,{headerText:p("widget.backgroundcolor.title"),onCloseClick:a}),g(Ee,{overflow:"hidden",justifyContent:"between",children:[o(D,{overflow:"auto",gap:1,children:o("input",{type:"color",className:"form-control",value:Jr.makeColorNumberHex(t),onChange:l=>s(Jr.convertFromHex(l.target.value))})}),g(D,{gap:1,children:[o(H,{fullWidth:!0,variant:"primary",onClick:i,children:p("widget.backgroundcolor.button.on")}),o(H,{fullWidth:!0,variant:"primary",onClick:r,children:p("widget.backgroundcolor.button.apply")})]})]})]})},l$=n=>{const{objectId:e=-1,color:t="1",badgeName:s="",badgeDesc:r="",date:i="",senderName:a="",onClose:l=null}=M7();return e===-1?null:o(zP,{color:t,message:r,date:i,senderName:a,customTitle:s,onCloseClick:l})},c$=n=>{const{objectId:e=-1,recipes:t=[],ingredients:s=[],selectedRecipe:r=null,requiredIngredients:i=null,isCrafting:a=!1,craft:l=null,selectRecipe:c=null,onClose:u=null}=P7(),{roomSession:h=null}=yt(),[d,f]=_.useState(!1),E=_.useMemo(()=>{const I=ee().getRoomObject(h.roomId,e,k.FLOOR);return tr(I)},[e,h.roomId]),m=_.useMemo(()=>{if(!i||!i.length)return!1;for(const I of i){const S=s.find(A=>A.name===I.itemName);if(!S||S.count<I.count)return!1}return!0},[s,i]),R=()=>{if(!d){f(!0);return}l(),f(!1)};return _.useEffect(()=>{f(!1)},[r]),e===-1?null:g(Re,{className:"nitro-widget-crafting",theme:"primary-slim",children:[o(Te,{headerText:p("crafting.title"),onCloseClick:u}),o(Ee,{children:g(P,{grow:!0,overflow:"hidden",gap:2,children:[g(P,{column:!0,fullWidth:!0,gap:2,children:[g(D,{overflow:"hidden",fullHeight:!0,children:[o("div",{className:"bg-muted rounded py-1 text-center",children:p("crafting.title.products")}),o(Ot,{columnCount:5,children:t.length>0&&t.map(I=>o(Qe,{itemImage:I.iconUrl,itemActive:r&&r.name===I.name,onClick:()=>c(I)},I.name))})]}),g(D,{overflow:"hidden",fullHeight:!0,children:[o("div",{className:"bg-muted rounded py-1 text-center",children:p("crafting.title.mixer")}),o(Ot,{columnCount:5,children:s.length>0&&s.map(I=>o(Qe,{itemImage:I.iconUrl,itemCount:I.count,itemCountMinimum:0,className:(I.count?"":"opacity-0-5 ")+"cursor-default"},I.name))})]})]}),g(P,{column:!0,fullWidth:!0,gap:2,children:[!r&&o(D,{center:!0,fullHeight:!0,className:"text-black text-center",children:p("crafting.info.start")}),r&&g(X,{children:[g(D,{overflow:"hidden",fullHeight:!0,children:[o("div",{className:"bg-muted rounded py-1 text-center",children:p("crafting.current_recipe")}),o(Ot,{columnCount:5,children:!!i&&i.length>0&&i.map(I=>{const S=s.find(N=>N.name===I.itemName),A=[];for(let N=0;N<I.count;N++)A.push(o(Qe,{itemImage:S.iconUrl,className:(S.count-N<=0?"opacity-0-5 ":"")+"cursor-default"},N));return A})})]}),g(P,{gap:2,column:!0,fullHeight:!0,children:[g(P,{gap:2,className:"bg-muted rounded",column:!0,fullHeight:!0,children:[o("div",{className:"py-1 text-center",children:p("crafting.result")}),g(P,{gap:1,center:!0,column:!0,fullHeight:!0,className:"pb-1",children:[o(D,{fullHeight:!0,children:o("img",{src:r.iconUrl})}),o("div",{className:"text-black",children:r.localizedName})]})]}),g(H,{variant:!E||!m?"danger":d?"warning":a?"primary":"success",disabled:!E||!m||a,onClick:R,children:[!a&&p(E?m?d?"generic.confirm":"crafting.btn.craft":"crafting.status.recipe.incomplete":"crafting.btn.notowner"),a&&o(ep,{})]})]})]})]})]})})]})},u$=n=>{const[e,t]=_.useState(!1),{presets:s=[],dimmerState:r=0,selectedPresetId:i=0,color:a=16777215,brightness:l=255,effectId:c=0,selectedColor:u=0,setSelectedColor:h=null,selectedBrightness:d=0,setSelectedBrightness:f=null,selectedEffectId:E=0,setSelectedEffectId:m=null,selectPresetId:R=null,applyChanges:I}=U7(),S=()=>{Pr.previewDimmer(a,l,c===2),t(!1)};$e(q.REMOVE_DIMMER,N=>t(!1)),_.useEffect(()=>{!s||!s.length||t(!0)},[s]);const A=_.useMemo(()=>ce("widget.dimmer.colorwheel",!1),[]);return e?g(Re,{className:"nitro-room-widget-dimmer",children:[o(Te,{headerText:p("widget.dimmer.title"),onCloseClick:S}),r===1&&o(aa,{children:s.map(N=>o(Yi,{isActive:i===N.id,onClick:L=>R(N.id),children:p(`widget.dimmer.tab.${N.id}`)},N.id))}),g(Ee,{children:[r===0&&g(D,{alignItems:"center",children:[o(j,{className:"dimmer-banner"}),o(y,{center:!0,className:"bg-muted rounded p-1",children:p("widget.dimmer.info.off")}),o(H,{fullWidth:!0,variant:"success",onClick:()=>Pr.changeState(),children:p("widget.dimmer.button.on")})]}),r===1&&g(X,{children:[g(D,{gap:1,children:[o(y,{fontWeight:"bold",children:p("widget.backgroundcolor.hue")}),A&&o("input",{type:"color",className:"form-control",value:Jr.makeColorNumberHex(u),onChange:N=>h(Jr.convertFromHex(N.target.value))}),!A&&o(ge,{gap:1,columnCount:7,children:Pr.AVAILABLE_COLORS.map((N,L)=>o(D,{fullWidth:!0,pointer:!0,className:$s("color-swatch rounded",N===u&&"active"),onClick:()=>h(N),style:{backgroundColor:Pr.HTML_COLORS[L]}},L))})]}),g(D,{gap:1,children:[o(y,{fontWeight:"bold",children:p("widget.backgroundcolor.lightness")}),o(ws,{className:"nitro-slider",min:Pr.MIN_BRIGHTNESS,max:Pr.MAX_BRIGHTNESS,value:d,onChange:N=>f(N),thumbClassName:"thumb percent",renderThumb:(N,L)=>o("div",{...N,children:Pr.scaleBrightness(L.valueNow)})})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:E===2,onChange:N=>m(N.target.checked?2:1)}),o(y,{children:p("widget.dimmer.type.checkbox")})]}),g(P,{gap:1,children:[o(H,{fullWidth:!0,variant:"danger",onClick:()=>Pr.changeState(),children:p("widget.dimmer.button.off")}),o(H,{fullWidth:!0,variant:"success",onClick:I,children:p("widget.dimmer.button.apply")})]})]})]})]}):null},h$=n=>{const{objectId:e=-1,value:t=0,onClose:s=null,redeem:r=null}=x7();return e===-1?null:g(Re,{className:"nitro-widget-exchange-credit",theme:"primary-slim",children:[o(Te,{headerText:p("catalog.redeem.dialog.title"),onCloseClick:s}),o(Ee,{center:!0,children:g(P,{overflow:"hidden",gap:2,children:[o(D,{center:!0,children:o(j,{className:"exchange-image"})}),g(D,{grow:!0,justifyContent:"between",overflow:"hidden",children:[g(D,{gap:1,overflow:"auto",children:[o(y,{fontWeight:"bold",children:p("creditfurni.description",["credits"],[t.toString()])}),o(y,{children:p("creditfurni.prompt")})]}),o(H,{variant:"success",onClick:r,children:p("catalog.redeem.dialog.button.exchange")})]})]})})]})},d$=n=>{const{currentIndex:e=-1,currentPhotos:t=null}=n,[s,r]=_.useState(0),i=t&&t.length?t[s]:null,a=()=>{r(c=>{let u=c+1;return u>=t.length&&(u=0),u})},l=()=>{r(c=>{let u=c-1;return u<0&&(u=t.length-1),u})};return _.useEffect(()=>{r(e)},[e]),i?g(ge,{style:{display:"flex",flexDirection:"column"},children:[o(P,{center:!0,className:"picture-preview border border-black",style:i.w?{backgroundImage:"url("+i.w+")"}:{},children:!i.w&&o(y,{bold:!0,children:p("camera.loading")})}),i.m&&i.m.length&&o(y,{center:!0,children:i.m}),g(P,{alignItems:"center",justifyContent:"between",children:[o(y,{children:i.n||""}),o(y,{children:new Date(i.t*1e3).toLocaleDateString()})]}),t.length>1&&g(P,{className:"picture-preview-buttons",children:[o(ET,{className:"cursor-pointer picture-preview-buttons-previous fa-icon",onClick:l}),o(y,{underline:!0,className:"cursor-pointer",onClick:c=>Sr(i.oi),children:i.o}),o(pT,{className:"cursor-pointer picture-preview-buttons-next fa-icon",onClick:a})]})]}):null},_$=n=>{const{objectId:e=-1,currentPhotoIndex:t=-1,currentPhotos:s=null,onClose:r=null}=G7(),{report:i=null}=Ji();return e===-1||t===-1?null:g(Re,{className:"nitro-external-image-widget",theme:"primary-slim",children:[o(Te,{headerText:"",isGalleryPhoto:!0,onReportPhoto:()=>i(bt.PHOTO,{extraData:s[t].w,roomId:s[t].s,reportedUserId:$().userId,roomObjectId:Number(s[t].u)}),onCloseClick:r}),o(Ee,{children:o(d$,{currentIndex:t,currentPhotos:s})})]})},g$=n=>{const{objectId:e=-1,type:t=0,stage:s=0,usernames:r=[],figures:i=[],date:a=null,onClose:l=null,respond:c=null}=k7();if(e===-1)return null;if(s>0)return g(Re,{className:"nitro-engraving-lock",theme:"primary-slim",children:[o(Te,{headerText:p("friend.furniture.confirm.lock.caption"),onCloseClick:l}),g(Ee,{children:[o("h5",{className:"text-black text-center fw-bold mt-2 mb-2",children:p("friend.furniture.confirm.lock.subtitle")}),o("div",{className:"d-flex justify-content-center mb-2",children:o("div",{className:`engraving-lock-stage-${s}`})}),s===2&&o("div",{className:"text-small text-black text-center mb-2",children:p("friend.furniture.confirm.lock.other.locked")}),g(P,{gap:1,children:[o(H,{fullWidth:!0,onClick:u=>c(!1),children:p("friend.furniture.confirm.lock.button.cancel")}),o(H,{fullWidth:!0,variant:"success",onClick:u=>c(!0),children:p("friend.furniture.confirm.lock.button.confirm")})]})]})]});if(r.length>0)return o(Ya,{handleSelector:".nitro-engraving-lock-view",children:g("div",{className:`nitro-engraving-lock-view engraving-lock-${t}`,children:[o("div",{className:"engraving-lock-close",onClick:l}),g(P,{justifyContent:"center",children:[o("div",{className:"engraving-lock-avatar",children:o(as,{figure:i[0],direction:2})}),o("div",{className:"engraving-lock-avatar",children:o(as,{figure:i[1],direction:4})})]}),g(D,{justifyContent:"between",className:"mt-1",children:[g(D,{alignItems:"center",justifyContent:"center",gap:1,children:[g("div",{children:[t===0&&p("lovelock.engraving.caption"),t===3&&p("wildwest.engraving.caption")]}),o("div",{children:a})]}),g(P,{justifyContent:"center",gap:4,children:[o("div",{children:r[0]}),o("div",{children:r[1]})]})]})]})})},f$=n=>{const{objectId:e=-1,classId:t=-1,itemType:s=null,text:r=null,isOwnerOfFurniture:i=!1,senderName:a=null,senderFigure:l=null,placedItemId:c=-1,placedItemType:u=null,placedInRoom:h=!1,imageUrl:d=null,openPresent:f=null,onClose:E=null}=t8(),{groupItems:m=[]}=Bo();if(e===-1)return null;const R=I=>{const S=m.find(A=>{var N;return((N=A.getItemById(I))==null?void 0:N.id)===I});S&&Ul(S),E()};return g(Re,{className:"nitro-gift-opening",theme:"primary-slim",children:[o(Te,{headerText:p(a?"widget.furni.present.window.title_from":"widget.furni.present.window.title",["name"],[a]),onCloseClick:E}),g(Ee,{children:[c===-1&&g(D,{overflow:"hidden",children:[o(P,{center:!0,overflow:"auto",children:o(WP,{userName:a,figure:l,message:r})}),i&&g(P,{gap:1,children:[a&&o(H,{fullWidth:!0,onClick:I=>de("catalog/open"),children:p("widget.furni.present.give_gift",["name"],[a])}),o(H,{fullWidth:!0,variant:"success",onClick:f,children:p("widget.furni.present.open_gift")})]})]}),c>-1&&g(P,{gap:2,overflow:"hidden",children:[o(D,{center:!0,className:"p-2",children:o(Sn,{imageUrl:d})}),g(D,{grow:!0,children:[g(D,{center:!0,gap:1,children:[o(y,{wrap:!0,small:!0,children:p("widget.furni.present.message_opened")}),o(y,{bold:!0,fontSize:5,children:r})]}),g(D,{grow:!0,gap:1,children:[g(P,{gap:1,children:[h&&o(H,{fullWidth:!0,onClick:null,children:p("widget.furni.present.put_in_inventory")}),o(H,{fullWidth:!0,variant:"success",onClick:I=>R(c),children:p(h?"widget.furni.present.keep_in_room":"widget.furni.present.place_in_room")})]}),a&&a.length&&o(H,{fullWidth:!0,onClick:I=>de("catalog/open"),children:p("widget.furni.present.give_gift",["name"],[a])})]})]})]})]})]})},m$=n=>{const{stuffDatas:e=null,getScoreType:t=null,getClearType:s=null}=W7();return!e||!e.size?null:o(X,{children:Array.from(e.entries()).map(([r,i],a)=>o(dp,{objectId:r,category:k.FLOOR,children:g(D,{className:"nitro-widget-high-score nitro-context-menu",gap:0,children:[o(cr,{children:p("high.score.display.caption",["scoretype","cleartype"],[p(`high.score.display.scoretype.${t(i.scoreType)}`),p(`high.score.display.cleartype.${s(i.clearType)}`)])}),g(kL,{overflow:"hidden",gap:1,className:"h-100",children:[g(D,{gap:1,children:[g(P,{alignItems:"center",children:[o(y,{center:!0,bold:!0,variant:"white",className:"col-8",children:p("high.score.display.users.header")}),o(y,{center:!0,bold:!0,variant:"white",className:"col-4",children:p("high.score.display.score.header")})]}),o("hr",{className:"m-0"})]}),o(D,{overflow:"auto",gap:1,className:"overflow-y-scroll",children:i.entries.map((l,c)=>g(P,{alignItems:"center",children:[o(y,{center:!0,variant:"white",className:"col-8",children:l.users.join(", ")}),o(y,{center:!0,variant:"white",className:"col-4",children:l.score})]},c))})]})]})},a))})},E$=n=>(K7(),null),p$=-1,sh=0,rg=1,ig=2,ng=3,ag=4,I$=n=>{const[e,t]=_.useState(null),[s,r]=_.useState(p$),{objectId:i=-1,figure:a=null,gender:l=null,clubLevel:c=_r.NO_CLUB,name:u=null,setName:h=null,saveFigure:d=null,wearFigure:f=null,saveName:E=null,onClose:m=null}=q7();return _.useEffect(()=>{if(i===-1)return;const R=at();if(R.isRoomOwner||R.controllerLevel>=ct.GUEST||$().isModerator){r(sh);return}if($().gender.toLowerCase()!==l.toLowerCase()){r(ag);return}if(Qr()<c){r(ng);return}r(ig)},[i,l,c]),_.useEffect(()=>{switch(s){case sh:case ag:{const R=fs().createFigureContainer(a);Ol.transformAsMannequinFigure(R),t(R.getFigureString());break}case rg:{const R=fs().createFigureContainer($().figure);Ol.transformAsMannequinFigure(R),t(R.getFigureString());break}case ig:case ng:{const R=Ol.getMergedMannequinFigureContainer($().figure,a);t(R.getFigureString());break}}},[s,a,c]),i===-1?null:g(Re,{className:"nitro-mannequin no-resize",theme:"primary-slim",children:[o(Te,{headerText:p("mannequin.widget.title"),onCloseClick:m}),o(Ee,{center:!0,children:g(P,{fullWidth:!0,gap:2,overflow:"hidden",children:[o(D,{children:g(j,{position:"relative",className:"mannequin-preview",children:[o(as,{position:"absolute",figure:e,direction:2}),c>0&&o(gs,{className:"position-absolute end-2 bottom-2",type:"hc"})]})}),g(D,{grow:!0,justifyContent:"between",overflow:"auto",children:[s===sh&&g(X,{children:[o("input",{type:"text",className:"form-control form-control-sm",value:u,onChange:R=>h(R.target.value),onBlur:E}),g(D,{gap:1,children:[o(H,{variant:"success",onClick:R=>r(rg),children:p("mannequin.widget.style")}),o(H,{variant:"success",onClick:f,children:p("mannequin.widget.wear")})]})]}),s===rg&&g(X,{children:[g(D,{gap:1,children:[o(y,{bold:!0,children:u}),o(y,{wrap:!0,children:p("mannequin.widget.savetext")})]}),g(P,{alignItems:"center",justifyContent:"between",children:[o(y,{underline:!0,pointer:!0,onClick:R=>r(sh),children:p("mannequin.widget.back")}),o(H,{variant:"success",onClick:d,children:p("mannequin.widget.save")})]})]}),s===ig&&g(X,{children:[g(D,{gap:1,children:[o(y,{bold:!0,children:u}),o(y,{children:p("mannequin.widget.weartext")})]}),o(H,{variant:"success",onClick:f,children:p("mannequin.widget.wear")})]}),s===ng&&o(P,{center:!0,grow:!0,children:o(y,{children:p("mannequin.widget.clubnotification")})}),s===ag&&o(y,{children:p("mannequin.widget.wronggender")})]})]})})]})},T$=n=>(i8(),null),HL=["9CCEFF","FF9CFF","9CFF9C","FFFF33"],R$=["blue","pink","green","yellow"],O$=n=>{let e=HL.indexOf(n);return e===-1&&(e=0),R$[e]},S$=n=>{const{objectId:e=-1,color:t="0",setColor:s=null,text:r="",setText:i=null,canModify:a=!1,onClose:l=null}=a8();return e===-1?null:o(Ya,{handleSelector:".drag-handler",windowPosition:xs.TOP_LEFT,children:g("div",{className:"nitro-stickie nitro-stickie-image stickie-"+O$(t),children:[g("div",{className:"d-flex align-items-center stickie-header drag-handler",children:[o("div",{className:"d-flex align-items-center flex-grow-1 h-100",children:a&&g(X,{children:[o("div",{className:"nitro-stickie-image stickie-trash header-trash",onClick:l}),HL.map(c=>o("div",{className:"stickie-color ms-1",onClick:u=>s(c),style:{backgroundColor:Jr.makeColorHex(c)}},c))]})}),o("div",{className:"d-flex align-items-center nitro-stickie-image stickie-close header-close",onClick:l})]}),o("div",{className:"stickie-context",children:o("textarea",{className:"context-text",value:r,onChange:c=>i(c.target.value),tabIndex:0,autoFocus:!0})})]})})},C$=n=>{const{objectId:e=-1,height:t=0,maxHeight:s=40,onClose:r=null,updateHeight:i=null}=l8(),[a,l]=_.useState(""),c=u=>{l(u);const h=parseFloat(u);isNaN(h)||h===t||i(h)};return _.useEffect(()=>{l(t.toString())},[t]),e===-1?null:g(Re,{className:"nitro-widget-custom-stack-height",theme:"primary-slim",children:[o(Te,{headerText:p("widget.custom.stack.height.title"),onCloseClick:r}),g(Ee,{justifyContent:"between",children:[o(y,{children:p("widget.custom.stack.height.text")}),g(P,{gap:2,children:[o(ws,{className:"nitro-slider",min:0,max:s,step:.01,value:t,onChange:u=>i(u),renderThumb:(u,h)=>o("div",{...u,children:h.valueNow})}),o("input",{className:"show-number-arrows",style:{width:50},type:"number",min:0,max:s,value:a,onChange:u=>c(u.target.value)})]}),g(D,{gap:1,children:[o(H,{onClick:u=>V(new Kh(e,-100)),children:p("furniture.above.stack")}),o(H,{onClick:u=>V(new Kh(e,0)),children:p("furniture.floor.level")})]})]})]})},jL=["9CCEFF","FF9CFF","9CFF9C","FFFF33"],A$=["blue","pink","green","yellow"],N$=["post_it","post_it_shakesp","post_it_dreams","post_it_xmas","post_it_vd","post_it_juninas"],y$=["post_it","shakesp","dreams","christmas","heart","juninas"],M$=n=>{let e=jL.indexOf(n);return e===-1&&(e=0),A$[e]},D$=n=>{let e=N$.indexOf(n);return e===-1&&(e=0),y$[e]},v$=n=>{const{objectId:e=-1,color:t="0",text:s="",type:r="",canModify:i=!1,updateColor:a=null,updateText:l=null,trash:c=null,onClose:u=null}=u8(),[h,d]=_.useState(!1);return _.useEffect(()=>{d(!1)},[e,t,s,r]),e===-1?null:o(Ya,{handleSelector:".drag-handler",windowPosition:xs.TOP_LEFT,children:g("div",{className:"nitro-stickie nitro-stickie-image stickie-"+(r=="post_it"?M$(t):D$(r)),children:[g("div",{className:"d-flex align-items-center stickie-header drag-handler",children:[o("div",{className:"d-flex align-items-center flex-grow-1 h-100",children:i&&g(X,{children:[o("div",{className:"nitro-stickie-image stickie-trash header-trash",onClick:c}),r=="post_it"&&o(X,{children:jL.map(f=>o("div",{className:"stickie-color ms-1",onClick:E=>a(f),style:{backgroundColor:Jr.makeColorHex(f)}},f))})]})}),o("div",{className:"d-flex align-items-center nitro-stickie-image stickie-close header-close",onClick:u})]}),o("div",{className:"stickie-context",children:!h||!i?o("div",{className:"context-text",onClick:f=>i&&d(!0),children:s}):o("textarea",{className:"context-text",defaultValue:s,tabIndex:0,onBlur:f=>l(f.target.value),autoFocus:!0})})]})})},b$=n=>{const{objectId:e=-1,color:t="1",senderName:s="",date:r="",message:i="",onClose:a=null}=d8();return e===-1?null:o(zP,{color:t,message:i,date:r,senderName:s,onCloseClick:a})},P$=n=>{const[e,t]=_.useState(null),{objectId:s=-1,videoId:r=null,videoStart:i=0,videoEnd:a=0,currentVideoState:l=null,selectedVideo:c=null,playlists:u=[],onClose:h=null,previous:d=null,next:f=null,pause:E=null,play:m=null,selectVideo:R=null}=p8(),I=A=>{if(t(A.target),s!==-1)switch(A.target.getPlayerState()){case-1:case 1:l!==1&&m();return;case 2:l!==2&&E()}};if(_.useEffect(()=>{if(!(l===null||!e)){if(l===Ei.PLAYING&&e.getPlayerState()!==Ei.PLAYING){e.playVideo();return}if(l===Ei.PAUSED&&e.getPlayerState()!==Ei.PAUSED){e.pauseVideo();return}}},[l,e]),s===-1)return null;const S={height:"375",width:"500",playerVars:{autoplay:1,disablekb:1,controls:0,origin:window.origin,modestbranding:1,start:i,end:a}};return g(Re,{className:"youtube-tv-widget",children:[o(Te,{headerText:p("catalog.page.youtube_tvs"),onCloseClick:h}),o(Ee,{children:g("div",{className:"row w-100 h-100",children:[g("div",{className:"youtube-video-container col-9 overflow-hidden",children:[r&&r.length>0&&o(DU,{videoId:r,opts:S,onReady:A=>t(A.target),onStateChange:I,containerClassName:"youtubeContainer"}),(!r||r.length===0)&&o("div",{className:"empty-video w-100 h-100 justify-content-center align-items-center d-flex",children:p("widget.furni.video_viewer.no_videos")})]}),g("div",{className:"playlist-container col-3 d-flex flex-column",children:[g("span",{className:"playlist-controls justify-content-center d-flex",children:[o("i",{className:"icon icon-youtube-prev cursor-pointer",onClick:d}),o("i",{className:"icon icon-youtube-next cursor-pointer",onClick:f})]}),o("div",{className:"mb-1",children:p("widget.furni.video_viewer.playlists")}),o(Ot,{columnCount:1,columnMinWidth:80,columnMinHeight:100,className:"mb-1",overflow:"auto",children:u&&u.map((A,N)=>o(Qe,{onClick:L=>R(A.video),itemActive:A.video===c,children:o("b",{children:A.title})},N))})]})]})})]})},L$=n=>{const{diskInventory:e=null,addToPlaylist:t=null}=n,[s,r]=_.useState(-1),[i,a]=_.useState(-1),l=_.useCallback((h,d)=>{h.stopPropagation(),a(f=>f===d?-1:d)},[]),c=_.useCallback((h,d)=>{var f,E;h.stopPropagation(),t(d,(E=(f=ze().soundManager.musicController)==null?void 0:f.getRoomItemPlaylist())==null?void 0:E.length)},[t]),u=()=>{de("catalog/open/"+ss.TRAX_SONGS)};return _.useEffect(()=>{var h;if(i!==-1)return(h=ze().soundManager.musicController)==null||h.playSong(i,Is.PRIORITY_SONG_PLAY,0,0,0,0),()=>{var d;(d=ze().soundManager.musicController)==null||d.stop(Is.PRIORITY_SONG_PLAY)}},[i]),_.useEffect(()=>()=>a(-1),[]),g(X,{children:[g("div",{className:"bg-success py-3 container-fluid justify-content-center d-flex rounded",children:[o("img",{src:ce("image.library.url")+"playlist/title_mymusic.gif",className:"my-music"}),o("h2",{className:"ms-4",children:p("playlist.editor.my.music")})]}),o("div",{className:"h-100 overflow-y-scroll mt-4 py-2",children:o(Ot,{columnCount:3,columnMinWidth:95,gap:1,children:e&&e.getKeys().map((h,d)=>{var R;const f=e.getKey(d),E=e.getWithIndex(d),m=(R=ze().soundManager.musicController)==null?void 0:R.getSongInfo(E);return g(Qe,{itemActive:s===d,onClick:()=>r(I=>I===d?-1:d),classNames:["text-black"],children:[o("div",{className:"disk-image flex-shrink-0 mb-n2",style:{backgroundColor:wP(m==null?void 0:m.songData)}}),o(y,{truncate:!0,fullWidth:!0,className:"text-center",children:m==null?void 0:m.name}),s===d&&g(P,{position:"absolute",className:"bottom-0 mb-1 bg-secondary p-1 rounded",alignItems:"center",justifyContent:"center",gap:2,children:[o(H,{onClick:I=>l(I,E),variant:"light",children:o(j,{className:i===E?"pause-btn":"preview-song"})}),o(H,{onClick:I=>c(I,f),variant:"light",children:o(j,{className:"move-disk"})})]})]},d)})})}),g("div",{className:"playlist-bottom text-black p-1",children:[o("h5",{children:p("playlist.editor.text.get.more.music")}),o("div",{children:p("playlist.editor.text.you.have.no.songdisks.available")}),o("div",{children:p("playlist.editor.text.you.can.buy.some.from.the.catalogue")}),o("button",{className:"btn btn-primary btn-sm",onClick:()=>u(),children:p("playlist.editor.button.open.catalogue")})]}),o("img",{src:ce("image.library.url")+"playlist/background_get_more_music.gif",className:"get-more"})]})},U$=n=>{var h,d;const{furniId:e=-1,playlist:t=null,currentPlayingIndex:s=-1,removeFromPlaylist:r=null,togglePlayPause:i=null}=n,[a,l]=_.useState(-1),c=f=>{a===f&&r(f)},u=(f,E)=>{i(f,E!==-1?E:0)};return g(X,{children:[g("div",{className:"bg-primary py-3 container-fluid justify-content-center d-flex rounded",children:[o("img",{src:ce("image.library.url")+"playlist/title_playlist.gif",className:"playlist-img"}),o("h2",{className:"ms-4",children:p("playlist.editor.playlist")})]}),o("div",{className:"h-100 overflow-y-scroll py-2",children:o(P,{column:!0,gap:2,children:t&&t.map((f,E)=>g(P,{gap:1,className:"text-black cursor-pointer "+(a===E?"border border-muted border-2 rounded":"border-2"),alignItems:"center",onClick:()=>l(m=>m===E?-1:E),children:[o(j,{onClick:()=>c(E),className:"disk-2 "+(a===E?"selected-song":""),style:{backgroundColor:a===E?"":wP(f.songData)}}),f.name]},E))})}),(!t||t.length===0)&&g(X,{children:[g("div",{className:"playlist-bottom text-black p-1 ms-5",children:[o("h5",{children:p("playlist.editor.add.songs.to.your.playlist")}),o("div",{children:p("playlist.editor.text.click.song.to.choose.click.again.to.move")})]}),o("img",{src:ce("image.library.url")+"playlist/background_add_songs.gif",className:"add-songs"})]}),t&&t.length>0&&g(X,{children:[s===-1&&o(H,{variant:"success",size:"lg",onClick:()=>u(e,a),children:p("playlist.editor.button.play.now")}),s!==-1&&g(P,{gap:1,children:[o(H,{variant:"danger",onClick:()=>u(e,a),children:o(j,{className:"pause-song"})}),g(P,{column:!0,children:[o(y,{bold:!0,display:"block",children:p("playlist.editor.text.now.playing.in.your.room")}),o(y,{children:((h=t[s])==null?void 0:h.name)+" - "+((d=t[s])==null?void 0:d.creator)})]})]})]})]})},F$=n=>{const{objectId:e=-1,currentPlayingIndex:t=-1,playlist:s=null,diskInventory:r=null,onClose:i=null,togglePlayPause:a=null,removeFromPlaylist:l=null,addToPlaylist:c=null}=J7();return e===-1?null:g(Re,{className:"nitro-playlist-editor-widget",theme:"primary-slim",children:[o(Te,{headerText:p("playlist.editor.title"),onCloseClick:i}),o(Ee,{children:g("div",{className:"d-flex flex-row gap-1 h-100",children:[o("div",{className:"w-50 position-relative overflow-hidden h-100 rounded d-flex flex-column",children:o(L$,{addToPlaylist:c,diskInventory:r})}),o("div",{className:"w-50 position-relative overflow-hidden h-100 rounded d-flex flex-column",children:o(U$,{furniId:e,removeFromPlaylist:l,playlist:s,togglePlayPause:a,currentPlayingIndex:t})})]})})]})},x$=n=>g(j,{fit:!0,position:"absolute",className:"nitro-room-widgets top-0 start-0",children:[o(o$,{}),o(l$,{}),o(c$,{}),o(u$,{}),o(h$,{}),o(_$,{}),o(g$,{}),o(f$,{}),o(m$,{}),o(E$,{}),o(I$,{}),o(F$,{}),o(T$,{}),o(S$,{}),o(C$,{}),o(v$,{}),o(b$,{}),o(a$,{}),o(P$,{})]}),w$=n=>{const{isVisible:e=!1,errorResult:t=null,petName:s=null,objectType:r=null,onChangePetName:i=null,onConfirm:a=null,onClose:l=null}=F8();return o(X,{children:e&&g(Re,{className:"nitro-pet-package no-resize",theme:"primary-slim",children:[o(Te,{center:!0,headerText:p(r==="gnome_box"?"widgets.gnomepackage.name.title":"furni.petpackage.open"),onCloseClick:()=>l()}),g(Ee,{children:[g(P,{className:"pet-package-container-top p-3",children:[o("div",{className:`package-image-${r} flex-shrink-0`}),o("div",{className:"m-2",children:o(y,{variant:"white",className:"package-text-big",children:p(r==="gnome_box"?"widgets.gnomepackage.name.title":"furni.petpackage")})})]}),o(P,{className:"pet-package-container-bottom p-2",children:g(D,{gap:1,children:[g(P,{alignItems:"center",className:"bg-white rounded py-1 px-2 input-pet-package-container",children:[o("input",{type:"text",className:"form-control form-control-sm input-pet-package",maxLength:ce("pet.package.name.max.length"),placeholder:p(r==="gnome_box"?"widgets.gnomepackage.name.select":"widgets.petpackage.name.title"),value:s,onChange:c=>i(c.target.value)}),o("div",{className:"package-pencil-image flex-shrink-0 small fa-icon"})]}),t.length>0&&o(j,{className:"invalid-feedback d-block m-0",children:t}),g(P,{className:"mt-2",gap:5,display:"flex",justifyContent:"center",alignItems:"center",children:[o(y,{pointer:!0,className:"text-decoration",onClick:()=>l(),children:p("cancel")}),o(vU,{variant:s.length<3?"danger":"success",disabled:s.length<3,onClick:()=>a(),children:p(r==="gnome_box"?"widgets.gnomepackage.name.pick":"furni.petpackage.confirm")})]})]})})]})]})})},G$=n=>{const[e,t]=_.useState("bobba"),[s,r]=_.useState(""),[i,a]=_.useState(!1),{wordsFilter:l=[],isVisible:c=null,setWordsFilter:u,onClose:h=null}=D8(),{navigatorData:d=null}=Mi(),f=R=>{(i?!s:!e)||(V(new jM(d.enteredGuestRoom.roomId,R,i?s:e)),r(""),t("bobba"),a(!1),!(R&&l.includes(i?s:e))&&u(I=>{const S=[...I];return R?S.push(i?s:e):S.splice(S.indexOf(i?s:e),1),S}))},E=R=>{t(R),a(!1)},m=R=>{r(R),a(!0)};return c?g(Re,{className:"nitro-guide-tool no-resize",theme:"primary-slim",children:[o(Te,{headerText:p("navigator.roomsettings.roomfilter"),onCloseClick:()=>h()}),g(Ee,{className:"text-black",children:[g(ge,{className:"d-flex align-items-center justify-content-end gap-2",children:[o("input",{type:"text",className:"form-control form-control-sm",maxLength:255,value:e,onChange:R=>E(R.target.value)}),o(H,{onClick:()=>f(!0),children:p("navigator.roomsettings.roomfilter.addword")})]}),o(D,{overflow:"auto",gap:0,className:"form-control form-control-sm",style:{height:"100px"},children:l&&l.length>0&&l.map((R,I)=>o(P,{alignItems:"center",className:$s("rounded p-1",s===R&&"bg-muted"),pointer:!0,onClick:S=>m(R),children:o(y,{truncate:!0,children:R})},I))}),o(ge,{className:"d-flex align-items-center justify-content-end gap-2",children:o(H,{variant:"danger",onClick:()=>f(!1),disabled:l.length===0||!i,children:p("navigator.roomsettings.roomfilter.removeword")})})]})]}):null},B$=n=>{const[e,t]=_.useState(!1),{roomSession:s=null}=yt();Ts([Fi.SHOW_THUMBNAIL,Fi.HIDE_THUMBNAIL,Fi.TOGGLE_THUMBNAIL],i=>{switch(i.type){case Fi.SHOW_THUMBNAIL:t(!0);return;case Fi.HIDE_THUMBNAIL:t(!1);return;case Fi.TOGGLE_THUMBNAIL:t(a=>!a);return}});const r=i=>{ee().saveTextureAsScreenshot(i,!0),t(!1)};return e?o(Uq,{roomId:s.roomId,textureReceiver:r,onClose:()=>t(!1)}):null},k$=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(null),[i,a]=_.useState(null),[l,c]=_.useState(null),[u,h]=_.useState(!1),{navigatorData:d=null}=Mi(),{roomSession:f=null}=yt(),E=(m,R)=>{switch(m){case"settings":de("navigator/toggle-room-info");return;case"zoom":t(I=>{let S=ee().getRoomInstanceRenderingCanvasScale(f.roomId,1);return I?S*=2:S/=2,ee().setRoomInstanceRenderingCanvasScale(f.roomId,1,S),!I});return;case"chat_history":de("chat-history/toggle");return;case"like_room":V(new kM(1));return;case"toggle_room_link":de("navigator/toggle-room-link");return;case"navigator_search_tag":de(`navigator/search/${R}`),V(new Co("hotel_view",`tag:${R}`));return}};return z(sa,m=>{const R=m.getParser();!R.roomEnter||R.data.roomId!==f.roomId||(s!==R.data.roomName&&r(R.data.roomName),i!==R.data.ownerName&&a(R.data.ownerName),l!==R.data.tags&&c(R.data.tags))}),_.useEffect(()=>{h(!0);const m=setTimeout(()=>h(!1),5e3);return()=>clearTimeout(m)},[s,i,l]),g(P,{className:"nitro-room-tools-container",gap:2,children:[g(D,{center:!0,className:"nitro-room-tools p-2",children:[o(j,{pointer:!0,title:p("room.settings.button.text"),className:"icon icon-cog",onClick:()=>E("settings")}),o(j,{pointer:!0,title:p("room.zoom.button.text"),onClick:()=>E("zoom"),className:$s("icon",!e&&"icon-zoom-less",e&&"icon-zoom-more")}),o(j,{pointer:!0,title:p("room.chathistory.button.text"),onClick:()=>E("chat_history"),className:"icon icon-chat-history"}),d.canRate&&o(j,{pointer:!0,title:p("room.like.button.text"),onClick:()=>E("like_room"),className:"icon icon-like-room"})]}),o(D,{justifyContent:"center",children:o(h_,{type:vs.SLIDE_LEFT,inProp:u,timeout:300,children:o(D,{center:!0,children:g(D,{className:"nitro-room-tools-info rounded py-2 px-3",children:[g(D,{gap:1,children:[o(y,{wrap:!0,variant:"white",fontSize:4,children:s}),o(y,{variant:"muted",fontSize:5,children:i})]}),l&&l.length>0&&o(P,{gap:2,children:l.map((m,R)=>g(y,{small:!0,pointer:!0,variant:"white",className:"rounded bg-primary p-1",onClick:()=>E("navigator_search_tag",m),children:["#",m]},R))})]})})})})]})},V$=n=>{const{question:e=null,canVote:t=null,vote:s=null,noVotes:r=null,yesVotes:i=null}=n;return g(D,{gap:2,className:"wordquiz-question p-2",children:[!t&&g(P,{fullWidth:!0,alignItems:"center",gap:2,children:[o(P,{center:!0,pointer:!0,className:"bg-danger rounded p-2",children:o(y,{variant:"white",children:r})}),o(y,{variant:"white",center:!0,textBreak:!0,children:e}),o(P,{center:!0,pointer:!0,className:"bg-success rounded p-2",children:o(y,{variant:"white",children:i})})]}),t&&g(D,{children:[o(y,{variant:"white",center:!0,textBreak:!0,children:e}),g(P,{fullWidth:!0,justifyContent:"center",gap:1,children:[o(P,{center:!0,pointer:!0,className:"bg-danger rounded p-1",onClick:a=>s(ad),children:o(j,{className:"word-quiz-dislike"})}),o(P,{center:!0,pointer:!0,className:"bg-success rounded p-1",onClick:a=>s(GP),children:o(j,{className:"word-quiz-like"})})]})]})]})},H$=n=>{const{userIndex:e=null,vote:t=null,...s}=n;return o(dp,{objectId:e,category:k.UNIT,...s,children:o(P,{center:!0,pointer:!0,className:`bg-${t===ad?"danger":"success"} rounded p-1`,children:o(j,{className:`word-quiz-${t===ad?"dislike":"like"}-sm`})})})},j$=n=>{const{question:e=null,answerSent:t=!1,answerCounts:s=null,userAnswers:r=null,vote:i=null}=H8();return g(X,{children:[e&&o(V$,{question:e.content,canVote:!t,vote:i,noVotes:s.get(ad)||0,yesVotes:s.get(GP)||0}),r&&Array.from(r.entries()).map(([a,l],c)=>o(H$,{userIndex:a,vote:l.value},c))]})},W$=n=>{const{roomSession:e=null}=yt(),{simpleAlert:t=null}=Xt();return $e(Ig.ROOM_ZOOM,s=>ee().setRoomInstanceRenderingCanvasScale(s.roomId,1,s.level,null,null,!1,s.asDelta)),$e([q.REQUEST_TEASER,q.REQUEST_ECOTRONBOX,q.REQUEST_CLOTHING_CHANGE,q.REQUEST_PLAYLIST_EDITOR,q.OPEN_WIDGET,q.CLOSE_WIDGET,gi.FURNI_CLICK,gi.FURNI_DOUBLE_CLICK,gi.TOOLTIP_SHOW,gi.TOOLTIP_HIDE],s=>{if(e)switch(s.objectId,s.category,s.type){}}),kt([Be.RSEME_KICKED,Be.RSEME_PETS_FORBIDDEN_IN_HOTEL,Be.RSEME_PETS_FORBIDDEN_IN_FLAT,Be.RSEME_MAX_PETS,Be.RSEME_MAX_NUMBER_OF_OWN_PETS,Be.RSEME_NO_FREE_TILES_FOR_PET,Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET,Be.RSEME_BOTS_FORBIDDEN_IN_HOTEL,Be.RSEME_BOTS_FORBIDDEN_IN_FLAT,Be.RSEME_BOT_LIMIT_REACHED,Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT,Be.RSEME_BOT_NAME_NOT_ACCEPTED],s=>{let r=p("error.title"),i="";switch(s.type){case Be.RSEME_MAX_PETS:i=p("room.error.max_pets");break;case Be.RSEME_MAX_NUMBER_OF_OWN_PETS:i=p("room.error.max_own_pets");break;case Be.RSEME_KICKED:i=p("room.error.kicked"),r=p("generic.alert.title");break;case Be.RSEME_PETS_FORBIDDEN_IN_HOTEL:i=p("room.error.pets.forbidden_in_hotel");break;case Be.RSEME_PETS_FORBIDDEN_IN_FLAT:i=p("room.error.pets.forbidden_in_flat");break;case Be.RSEME_NO_FREE_TILES_FOR_PET:i=p("room.error.pets.no_free_tiles");break;case Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_PET:i=p("room.error.pets.selected_tile_not_free");break;case Be.RSEME_BOTS_FORBIDDEN_IN_HOTEL:i=p("room.error.bots.forbidden_in_hotel");break;case Be.RSEME_BOTS_FORBIDDEN_IN_FLAT:i=p("room.error.bots.forbidden_in_flat");break;case Be.RSEME_BOT_LIMIT_REACHED:i=p("room.error.max_bots");break;case Be.RSEME_SELECTED_TILE_NOT_FREE_FOR_BOT:i=p("room.error.bots.selected_tile_not_free");break;case Be.RSEME_BOT_NAME_NOT_ACCEPTED:i=p("room.error.bots.name.not.accepted");break;default:return}t(i,Le.DEFAULT,null,null,r)}),g(X,{children:[o(kZ,{}),o(zZ,{}),o(HZ,{}),o(qZ,{}),o(x$,{}),o(k$,{}),o(G$,{}),o(B$,{}),o(KZ,{}),o(w$,{}),o(XZ,{}),o(j$,{}),o(JZ,{})]})},Y$=n=>{const{roomSession:e=null}=yt(),t=_.useRef();return _.useEffect(()=>{const s=ze().application.renderer.view;if(!s)return;s.onclick=i=>Gu(i),s.onmousemove=i=>Gu(i),s.onmousedown=i=>Gu(i),s.onmouseup=i=>Gu(i),s.ontouchstart=i=>Vu(i),s.ontouchmove=i=>Vu(i),s.ontouchend=i=>Vu(i),s.ontouchcancel=i=>Vu(i);const r=t.current;r&&r.appendChild(s)},[]),o(j,{fit:!0,innerRef:t,className:!e&&"d-none",children:e&&g(X,{children:[o(W$,{}),e.isSpectator&&o(gZ,{})]})})},z$=n=>{const{unseenAchievementCount:e=0,setMeExpanded:t=null,children:s=null,...r}=n,i=_.useRef();return _.useEffect(()=>{const a=at();a&&ee().selectRoomObject(a.roomId,a.ownRoomIndex,k.UNIT)},[]),_.useEffect(()=>{const a=l=>t(!1);return document.addEventListener("click",a),()=>document.removeEventListener(ie.MOUSE_CLICK,a)},[t]),g(P,{innerRef:i,alignItems:"center",className:"nitro-toolbar-me p-2",gap:2,children:[o(j,{pointer:!0,className:"navigation-item icon icon-me-achievements",onClick:a=>de("achievements/toggle"),children:e>0&&o(So,{count:e})}),o(j,{pointer:!0,className:"navigation-item icon icon-me-profile",onClick:a=>Sr($().userId)}),o(j,{pointer:!0,className:"navigation-item icon icon-me-rooms",onClick:a=>de("navigator/search/myworld_view")}),o(j,{pointer:!0,className:"navigation-item icon icon-me-clothing",onClick:a=>de("avatar-editor/toggle")}),o(j,{pointer:!0,className:"navigation-item icon icon-me-settings",onClick:a=>de("user-settings/toggle")}),s]})},K$=n=>{const{isInRoom:e}=n,[t,s]=_.useState(!1),{userFigure:r=null}=za(),{getFullCount:i=0}=ti(),{getTotalUnseen:a=0}=f_(),{requests:l=[]}=Wr(),{iconState:c=ki.HIDDEN}=uL(),u=$().isModerator;return $e(Eg.ANIMATE_ICON,h=>{((f,E,m,R)=>{const I=document.body.getElementsByClassName(f)[0];if(!I)return;E.className="toolbar-icon-animation",E.style.visibility="visible",E.style.left=m+"px",E.style.top=R+"px",document.body.append(E);const S=I.getBoundingClientRect(),A=E.getBoundingClientRect(),N=A.x-S.x,L=A.y-S.y,M=Math.sqrt(N*N+L*L),b=500-Math.abs(1/M*100*500*.5),B=20,w=`ToolbarBouncing[${f}]`;w_.getMotionByTag(w)||(w_.runMotion(new Wp(new o6(b+8),new s6(I,400,12))).tag=w);const x=new Wp(new n6(new a6(E,b,S.x-A.x+B,S.y-A.y,100,1),1),new t6(E));w_.runMotion(x)})("icon-inventory",h.image,h.x,h.y)}),g(X,{children:[o(h_,{type:vs.FADE_IN,inProp:t,timeout:300,children:o(z$,{unseenAchievementCount:a,setMeExpanded:s})}),g(P,{alignItems:"center",justifyContent:"between",gap:2,className:"nitro-toolbar py-1 px-3",children:[g(P,{gap:2,alignItems:"center",children:[g(P,{alignItems:"center",gap:2,children:[g(P,{center:!0,pointer:!0,className:"navigation-item item-avatar "+(t?"active ":""),onClick:h=>s(!t),children:[o(as,{figure:r,direction:2,position:"absolute"}),a>0&&o(So,{count:a})]}),o(j,{pointer:!0,className:"navigation-item icon icon-rooms",onClick:h=>de("navigator/toggle")}),ce("game.center.enabled")&&o(j,{pointer:!0,className:"navigation-item icon icon-game",onClick:h=>de("games/toggle")}),o(j,{pointer:!0,className:"navigation-item icon icon-catalog",onClick:h=>de("catalog/toggle")}),o(j,{pointer:!0,className:"navigation-item icon icon-inventory",onClick:h=>de("inventory/toggle"),children:i>0&&o(So,{count:i})}),e&&o(j,{pointer:!0,className:"navigation-item icon icon-camera",onClick:h=>de("camera/toggle")}),u&&o(j,{pointer:!0,className:"navigation-item icon icon-modtools",onClick:h=>de("mod-tools/toggle")})]}),o(P,{alignItems:"center",id:"toolbar-chat-input-container"})]}),g(P,{alignItems:"center",gap:2,children:[g(P,{gap:2,children:[o(j,{pointer:!0,className:"navigation-item icon icon-friendall",onClick:h=>de("friends/toggle"),children:l.length>0&&o(So,{count:l.length})}),(c===ki.SHOW||c===ki.UNREAD)&&o(j,{pointer:!0,className:`navigation-item icon icon-message ${c===ki.UNREAD&&"is-unseen"}`,onClick:h=>l_()})]}),o(j,{id:"toolbar-friend-bar-container",className:"d-none d-lg-block"})]})]})]})},X$=n=>{const{badges:e=null,gap:t=1,justifyContent:s="between",...r}=n;return o(X,{children:e&&e.length>0&&e.map((i,a)=>o(D,{center:!0,children:o(xt,{badgeCode:i},i)},i))})},q$=n=>{const{relationships:e=null}=n,t=({type:s})=>{const r=e&&e.relationshipStatusMap.hasKey(s)?e.relationshipStatusMap.getValue(s):null,i=Xs.RELATIONSHIP_NAMES[s].toLocaleLowerCase();return g(P,{fullWidth:!0,gap:1,children:[o(P,{center:!0,className:"user-relationship",children:o("i",{className:`nitro-friends-spritesheet icon-${i}`})}),g(D,{grow:!0,gap:0,children:[g(P,{alignItems:"center",justifyContent:"between",className:"bg-white rounded px-2 py-1 user-relationship",children:[g(y,{small:!0,underline:!0,pointer:!0,onClick:a=>r&&r.randomFriendId>=1&&Sr(r.randomFriendId),children:[(!r||r.friendCount===0)&&p("extendedprofile.add.friends"),r&&r.friendCount>=1&&r.randomFriendName]}),r&&r.friendCount>=1&&o(P,{center:!0,position:"relative",className:"avatar-image-container",children:o(as,{figure:r.randomFriendFigure,headOnly:!0,direction:4})})]}),g(y,{small:!0,italics:!0,className:"user-relationship-count",children:[(!r||r.friendCount===0)&&p("extendedprofile.no.friends.in.this.category"),r&&r.friendCount>1&&p(`extendedprofile.relstatus.others.${i}`,["count"],[(r.friendCount-1).toString()])," "]})]})]})};return g(X,{children:[o(t,{type:Xs.HEART}),o(t,{type:Xs.SMILE}),o(t,{type:Xs.BOBBA})]})},Q$=n=>{const{relationships:e=null,friendsCount:t=null}=n;return g(D,{gap:1,children:[g(y,{small:!0,children:[o("b",{children:p("extendedprofile.friends.count")})," ",t]}),o(y,{bold:!0,small:!0,children:p("extendedprofile.relstatus")}),o(D,{children:o(q$,{relationships:e})})]})},J$=n=>{const{itsMe:e=null,groups:t=null,onLeaveGroup:s=null,overflow:r="hidden",gap:i=2,...a}=n,[l,c]=_.useState(null),[u,h]=_.useState(null);return z(jl,d=>{const f=d.getParser();!l||l!==f.id||f.flag||h(f)}),_.useEffect(()=>{l&&V(new yl(l,!1))},[l]),_.useEffect(()=>{h(null),t.length>0&&c(d=>(d===t[0].groupId&&V(new yl(t[0].groupId,!1)),t[0].groupId))},[t]),!t||!t.length?o(D,{center:!0,fullHeight:!0,children:g(P,{justifyContent:"center",gap:2,children:[o(j,{className:"no-group-spritesheet image-1"}),o(j,{className:"no-group-spritesheet image-2"}),o(j,{className:"no-group-spritesheet image-3"})]})}):g(ge,{overflow:r,gap:2,...a,children:[o(D,{alignItems:"center",size:2,overflow:"auto",children:o(Ot,{overflow:null,columnCount:1,columnMinHeight:50,className:"user-groups-container",children:t.map((d,f)=>g(Qe,{overflow:"unset",itemActive:l===d.groupId,onClick:()=>c(d.groupId),className:"p-1",children:[e&&o("i",{className:"position-absolute end-0 top-0 z-index-1 icon icon-group-"+(d.favourite?"favorite":"not-favorite"),onClick:()=>iq(d)}),o(xt,{badgeCode:d.badgeCode,isGroup:!0})]},f))})}),o(D,{size:10,overflow:"hidden",children:u&&o(UL,{groupInformation:u,onClose:s})})]})},Z$=n=>{const{userProfile:e=null}=n,[t,s]=_.useState(e.requestSent),r=e.id===$().userId,i=!t&&!r&&!e.isMyFriend&&!e.requestSent,a=()=>{s(!0),V(new tE(e.username))};return _.useEffect(()=>{s(e.requestSent)},[e]),g(P,{gap:2,children:[o(D,{center:!0,className:"avatar-container",children:o(as,{figure:e.figure,direction:2})}),g(D,{children:[g(D,{gap:0,children:[o(y,{bold:!0,children:e.username}),g(y,{italics:!0,textBreak:!0,small:!0,children:[e.motto," "]})]}),g(D,{gap:1,children:[g(y,{small:!0,children:[o("b",{children:p("extendedprofile.created")})," ",e.registration]}),g(y,{small:!0,children:[o("b",{children:p("extendedprofile.last.login")})," ",Jn.format(e.secondsSinceLastVisit,".ago",2)]}),g(y,{small:!0,children:[o("b",{children:p("extendedprofile.achievementscore")})," ",e.achievementPoints]})]}),g(P,{gap:1,children:[e.isOnline&&o("i",{className:"icon icon-pf-online"}),!e.isOnline&&o("i",{className:"icon icon-pf-offline"}),g(P,{alignItems:"center",gap:1,children:[i&&o(y,{small:!0,underline:!0,pointer:!0,onClick:a,children:p("extendedprofile.addasafriend")}),!i&&g(X,{children:[o("i",{className:"icon icon-pf-tick"}),r&&o(y,{children:p("extendedprofile.me")}),e.isMyFriend&&o(y,{children:p("extendedprofile.friend")}),(t||e.requestSent)&&o(y,{children:p("extendedprofile.friendrequestsent")})]})]})]})]})]})},$$=n=>{const[e,t]=_.useState(null),[s,r]=_.useState([]),[i,a]=_.useState(null),l=()=>{t(null),r([]),a(null)},c=()=>{!e||e.id!==$().userId||Sr(e.id)};return z(qm,u=>{const h=u.getParser();!e||h.userId!==e.id||r(h.badges)}),z(Xm,u=>{const h=u.getParser();!e||h.userId!==e.id||a(h)}),z(ON,u=>{const h=u.getParser();let d=!1;t(f=>(f&&f.id&&(d=f.id===h.id),h)),d||(r([]),a(null)),V(new fE(h.id)),V(new EE(h.id))}),z(AN,u=>{const h=u.getParser();h.userId==(e==null?void 0:e.id)&&Sr(h.userId)}),$e(ue.SELECTED,u=>{if(!e||u.category!==k.UNIT)return;const h=at().userDataManager.getUserDataByIndex(u.objectId);h.type===Rt.USER&&Sr(h.webID)}),e?g(Re,{uniqueKey:"nitro-user-profile",theme:"primary-slim",className:"user-profile",children:[o(Te,{headerText:p("extendedprofile.caption"),onCloseClick:l}),g(Ee,{overflow:"hidden",children:[g(ge,{fullHeight:!1,gap:2,children:[g(D,{size:7,gap:1,className:"user-container pe-2",children:[o(Z$,{userProfile:e}),o(ge,{columnCount:5,fullHeight:!0,className:"bg-muted rounded px-2 py-1",children:o(X$,{fullWidth:!0,center:!0,badges:s})})]}),o(D,{size:5,children:i&&o(Q$,{relationships:i,friendsCount:e.friendsCount})})]}),o(P,{alignItems:"center",className:"rooms-button-container px-2 py-1",children:g(P,{alignItems:"center",gap:1,onClick:u=>de(`navigator/search/hotel_view/owner:${e.username}`),children:[o("i",{className:"icon icon-rooms"}),o(y,{bold:!0,underline:!0,pointer:!0,children:p("extendedprofile.rooms")})]})}),o(J$,{fullWidth:!0,itsMe:e.id===$().userId,groups:e.groups,onLeaveGroup:c})]})]}):null},eee=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(null),[i,a]=lL(),[l,c]=cL(),u=(d,f)=>{let E=!0;const m=s.clone();switch(d){case"close_view":t(!1),E=!1;return;case"oldchat":m.oldChat=f,V(new Lv(m.oldChat));break;case"room_invites":m.roomInvites=f,V(new Uv(m.roomInvites));break;case"camera_follow":m.cameraFollow=f,V(new Pv(m.cameraFollow));break;case"system_volume":m.volumeSystem=f,m.volumeSystem=Math.max(0,m.volumeSystem),m.volumeSystem=Math.min(100,m.volumeSystem);break;case"furni_volume":m.volumeFurni=f,m.volumeFurni=Math.max(0,m.volumeFurni),m.volumeFurni=Math.min(100,m.volumeFurni);break;case"trax_volume":m.volumeTrax=f,m.volumeTrax=Math.max(0,m.volumeTrax),m.volumeTrax=Math.min(100,m.volumeTrax);break}E&&r(m),Gf(m)},h=d=>{switch(d){case"volume":V(new Fv(Math.round(s.volumeSystem),Math.round(s.volumeFurni),Math.round(s.volumeTrax)));break}};return z(Qm,d=>{const f=d.getParser(),E=new fl;E.volumeSystem=f.volumeSystem,E.volumeFurni=f.volumeFurni,E.volumeTrax=f.volumeTrax,E.oldChat=f.oldChat,E.roomInvites=f.roomInvites,E.cameraFollow=f.cameraFollow,E.flags=f.flags,E.chatType=f.chatType,r(E),Gf(E)}),_.useEffect(()=>{const d={linkReceived:f=>{const E=f.split("/");if(!(E.length<2))switch(E[1]){case"show":t(!0);return;case"hide":t(!1);return;case"toggle":t(m=>!m);return}},eventUrlPrefix:"user-settings/"};return Cs(d),()=>As(d)},[]),_.useEffect(()=>{s&&Fs(s)},[s]),!e||!s?null:g(Re,{uniqueKey:"user-settings",className:"user-settings-window",theme:"primary-slim",children:[o(Te,{headerText:p("widget.memenu.settings.title"),onCloseClick:d=>u("close_view")}),g(Ee,{className:"text-black",children:[g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:s.oldChat,onChange:d=>u("oldchat",d.target.checked)}),o(y,{children:p("memenu.settings.chat.prefer.old.chat")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:s.roomInvites,onChange:d=>u("room_invites",d.target.checked)}),o(y,{children:p("memenu.settings.other.ignore.room.invites")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:s.cameraFollow,onChange:d=>u("camera_follow",d.target.checked)}),o(y,{children:p("memenu.settings.other.disable.room.camera.follow")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:i,onChange:d=>a(d.target.checked)}),o(y,{children:p("memenu.settings.other.place.multiple.objects")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:l,onChange:d=>c(d.target.checked)}),o(y,{children:p("memenu.settings.other.skip.purchase.confirmation")})]})]}),g(D,{children:[o(y,{bold:!0,children:p("widget.memenu.settings.volume")}),g(D,{gap:1,children:[o(y,{children:p("widget.memenu.settings.volume.ui")}),g(P,{alignItems:"center",gap:1,children:[s.volumeSystem===0&&o(C_,{className:$s(s.volumeSystem>=50&&"text-muted","fa-icon")}),s.volumeSystem>0&&o(A_,{className:$s(s.volumeSystem>=50&&"text-muted","fa-icon")}),o("input",{type:"range",className:"custom-range w-100",min:"0",max:"100",step:"1",id:"volumeSystem",value:s.volumeSystem,onChange:d=>u("system_volume",d.target.value),onMouseUp:()=>h("volume")}),o(N_,{className:$s(s.volumeSystem<50&&"text-muted","fa-icon")})]})]}),g(D,{gap:1,children:[o(y,{children:p("widget.memenu.settings.volume.furni")}),g(P,{alignItems:"center",gap:1,children:[s.volumeFurni===0&&o(C_,{className:$s(s.volumeFurni>=50&&"text-muted","fa-icon")}),s.volumeFurni>0&&o(A_,{className:$s(s.volumeFurni>=50&&"text-muted","fa-icon")}),o("input",{type:"range",className:"custom-range w-100",min:"0",max:"100",step:"1",id:"volumeFurni",value:s.volumeFurni,onChange:d=>u("furni_volume",d.target.value),onMouseUp:()=>h("volume")}),o(N_,{className:$s(s.volumeFurni<50&&"text-muted","fa-icon")})]})]}),g(D,{gap:1,children:[o(y,{children:p("widget.memenu.settings.volume.trax")}),g(P,{alignItems:"center",gap:1,children:[s.volumeTrax===0&&o(C_,{className:$s(s.volumeTrax>=50&&"text-muted","fa-icon")}),s.volumeTrax>0&&o(A_,{className:$s(s.volumeTrax>=50&&"text-muted","fa-icon")}),o("input",{type:"range",className:"custom-range w-100",min:"0",max:"100",step:"1",id:"volumeTrax",value:s.volumeTrax,onChange:d=>u("trax_volume",d.target.value),onMouseUp:()=>h("volume")}),o(N_,{className:$s(s.volumeTrax<50&&"text-muted","fa-icon")})]})]})]})]})]})},tee=n=>{const{trigger:e=null,furniIds:t=[]}=et();return g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.pickfurnis.caption",["count","limit"],[t.length.toString(),e.maximumItemSelectionCount.toString()])}),o(y,{small:!0,children:p("wiredfurni.pickfurnis.desc")})]})},_p=n=>{const{wiredType:e="",requiresFurni:t=Se.STUFF_SELECTION_OPTION_NONE,save:s=null,validate:r=null,children:i=null,hasSpecialInput:a=!1}=n,[l,c]=_.useState(null),[u,h]=_.useState(null),[d,f]=_.useState(!1),{trigger:E=null,setTrigger:m=null,setIntParams:R=null,setStringParam:I=null,setFurniIds:S=null,setAllowsFurni:A=null,saveWired:N=null}=et(),L=()=>m(null),M=()=>{r&&!r()||(s&&s(),f(!0))};return _.useEffect(()=>{d&&(N(),f(!1))},[d,N]),_.useEffect(()=>{if(!E)return;const b=E.spriteId||-1,B=$().getFloorItemData(b);B?(c(B.name),h(B.description)):(c("NAME: "+b),h("NAME: "+b)),a&&(R(E.intData),I(E.stringData)),t>Se.STUFF_SELECTION_OPTION_NONE&&S(w=>(w&&w.length&&Pc.clearSelectionShaderFromFurni(w),E.selectedItems&&E.selectedItems.length?(Pc.applySelectionShaderToFurni(E.selectedItems),E.selectedItems):[])),A(t)},[E,a,t,R,I,S,A]),g(Re,{uniqueKey:"nitro-wired",className:"nitro-wired",theme:"primary-slim",children:[o(Te,{headerText:p("wiredfurni.title"),onCloseClick:L}),g(Ee,{children:[g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("i",{className:`icon icon-wired-${e}`}),o(y,{bold:!0,children:l})]}),o(y,{small:!0,children:u})]}),!!i&&o("hr",{className:"m-0 bg-dark"}),i,t>Se.STUFF_SELECTION_OPTION_NONE&&g(X,{children:[o("hr",{className:"m-0 bg-dark"}),o(tee,{})]}),g(P,{alignItems:"center",gap:1,children:[o(H,{fullWidth:!0,variant:"success",onClick:M,children:p("wiredfurni.ready")}),o(H,{fullWidth:!0,variant:"secondary",onClick:L,children:p("cancel")})]})]})]})},rs=n=>{const{requiresFurni:e=Se.STUFF_SELECTION_OPTION_NONE,save:t=null,hasSpecialInput:s=!1,children:r=null}=n,{trigger:i=null,actionDelay:a=0,setActionDelay:l=null}=et();return _.useEffect(()=>{l(i.delayInPulses)},[i,l]),g(_p,{wiredType:"action",requiresFurni:e,save:t,hasSpecialInput:s,children:[r,!!r&&o("hr",{className:"m-0 bg-dark"}),g(D,{children:[o(y,{bold:!0,children:p("wiredfurni.params.delay",["seconds"],[vu(a)])}),o(ws,{className:"nitro-slider",min:0,max:20,value:a,onChange:c=>l(c)})]})]})},see="hd-180-1.ch-210-66.lg-270-82.sh-290-81",ree=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(""),{trigger:i=null,setStringParam:a=null}=et(),l=()=>a(e+Gl+s);return _.useEffect(()=>{const c=i.stringData.split(Gl);c.length>0&&t(c[0]),c.length>1&&r(c[1].length>0?c[1]:see)},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:c=>t(c.target.value)})]}),g(P,{center:!0,children:[o(as,{figure:s,direction:4}),o(H,{onClick:c=>r($().figure),children:p("wiredfurni.params.capture.figure")})]})]})},iee=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(-1),{trigger:i=null,setStringParam:a=null,setIntParams:l=null}=et(),c=()=>{a(e),l([s])};return _.useEffect(()=>{t(i.stringData),r(i.intData.length>0?i.intData[0]:0)},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:c,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:u=>t(u.target.value)})]}),g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"followMode",id:"followMode1",checked:s===1,onChange:u=>r(1)}),o(y,{children:p("wiredfurni.params.start.following")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"followMode",id:"followMode2",checked:s===0,onChange:u=>r(0)}),o(y,{children:p("wiredfurni.params.stop.following")})]})]})]})},nee=[2,5,7,8,9,10,27],aee=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(-1),{trigger:i=null,setStringParam:a=null,setIntParams:l=null}=et(),c=()=>{a(e),l([s])};return _.useEffect(()=>{t(i.stringData),r(i.intData.length>0?i.intData[0]:0)},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:c,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:u=>t(u.target.value)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.handitem")}),g("select",{className:"form-select form-select-sm",value:s,onChange:u=>r(parseInt(u.target.value)),children:[o("option",{value:"0",children:"------"}),nee.map(u=>o("option",{value:u,children:p(`handitem${u}`)},u))]})]})]})},oee=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:a=>t(a.target.value)})]})})},lee=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(""),[i,a]=_.useState(-1),{trigger:l=null,setStringParam:c=null,setIntParams:u=null}=et(),h=()=>{c(e+Gl+s),u([i])};return _.useEffect(()=>{const d=l.stringData.split(Gl);d.length>0&&t(d[0]),d.length>1&&r(d[1].length>0?d[1]:""),a(l.intData.length>0?l.intData[0]:0)},[l]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:h,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:d=>t(d.target.value)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.message")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:ce("wired.action.bot.talk.to.avatar.max.length",64),value:s,onChange:d=>r(d.target.value)})]}),g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"talkMode",id:"talkMode1",checked:i===0,onChange:d=>a(0)}),o(y,{children:p("wiredfurni.params.talk")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"talkMode",id:"talkMode2",checked:i===1,onChange:d=>a(1)}),o(y,{children:p("wiredfurni.params.whisper")})]})]})]})},cee=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(""),[i,a]=_.useState(-1),{trigger:l=null,setStringParam:c=null,setIntParams:u=null}=et(),h=()=>{c(e+Gl+s),u([i])};return _.useEffect(()=>{const d=l.stringData.split(Gl);d.length>0&&t(d[0]),d.length>1&&r(d[1].length>0?d[1]:""),a(l.intData.length>0?l.intData[0]:0)},[l]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:h,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:d=>t(d.target.value)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.message")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:ce("wired.action.bot.talk.max.length",64),value:s,onChange:d=>r(d.target.value)})]}),g(D,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"talkMode",id:"talkMode1",checked:i===0,onChange:d=>a(0)}),o(y,{children:p("wiredfurni.params.talk")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"talkMode",id:"talkMode2",checked:i===1,onChange:d=>a(1)}),o(y,{children:p("wiredfurni.params.shout")})]})]})]})},uee=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:a=>t(a.target.value)})]})})},hee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!1,save:null}),dee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!1,save:null}),_ee=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.message")}),o("input",{type:"text",className:"form-control form-control-sm",value:e,onChange:a=>t(a.target.value),maxLength:ce("wired.action.chat.max.length",100)})]})})},gee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!1,save:null}),fee=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(1),[i,a]=_.useState(!1),[l,c]=_.useState(1),[u,h]=_.useState(1),[d,f]=_.useState([]),{trigger:E=null,setIntParams:m=null,setStringParam:R=null}=et(),I=()=>f(L=>[...L,{isBadge:!1,itemCode:"",probability:null}]),S=L=>{f(M=>{const b=Array.from(M);return b.splice(L,1),b})},A=(L,M,b,B)=>{const w=Array.from(d),x=w[L];x&&(x.isBadge=M,x.itemCode=b,x.probability=B,f(w))},N=()=>{let L=[];for(const M of d){if(!M.itemCode)continue;const b=[M.isBadge?"0":"1",M.itemCode,M.probability.toString()];L.push(b.join(","))}L.length>0&&(R(L.join(";")),m([s,i?1:0,l,u]))};return _.useEffect(()=>{const L=[];if(E.stringData.length>0&&E.stringData.includes(";")){const M=E.stringData.split(";");for(const b of M){const B=b.split(",");B.length===3&&L.push({isBadge:B[0]==="0",itemCode:B[1],probability:Number(B[2])})}}L.length===0&&L.push({isBadge:!1,itemCode:"",probability:null}),r(E.intData.length>0?E.intData[0]:0),a(E.intData.length>1?E.intData[1]===1:!1),c(E.intData.length>2?E.intData[2]:0),h(E.intData.length>3?E.intData[3]:0),t(E.intData.length>3?E.intData[3]>0:!1),f(L)},[E]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:N,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"limitEnabled",onChange:L=>t(L.target.checked)}),o(y,{children:p("wiredfurni.params.prizelimit",["amount"],[e?l.toString():""])})]}),!e&&o(y,{center:!0,small:!0,className:"bg-muted rounded p-1",children:"Reward limit not set. Make sure rewards are badges or non-tradeable items."}),e&&o(ws,{className:"nitro-slider",min:1,max:1e3,value:l,onChange:L=>c(L)}),o("hr",{className:"m-0 bg-dark"}),g(D,{gap:1,children:[o(y,{bold:!0,children:"How often can a user be rewarded?"}),g(P,{gap:1,children:[g("select",{className:"form-select form-select-sm w-100",value:s,onChange:L=>r(Number(L.target.value)),children:[o("option",{value:"0",children:"Once"}),g("option",{value:"3",children:["Once every ",u," minutes"]}),g("option",{value:"2",children:["Once every ",u," hours"]}),g("option",{value:"1",children:["Once every ",u," days"]})]}),s>0&&o("input",{type:"number",className:"form-control form-control-sm",value:u,onChange:L=>h(Number(L.target.value))})]})]}),o("hr",{className:"m-0 bg-dark"}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"uniqueRewards",checked:i,onChange:L=>a(L.target.checked)}),o(y,{children:"Unique rewards"})]}),o(y,{center:!0,small:!0,className:"bg-muted rounded p-1",children:"If checked each reward will be given once to each user. This will disable the probabilities option."}),o("hr",{className:"m-0 bg-dark"}),g(P,{justifyContent:"between",alignItems:"center",children:[o(y,{bold:!0,children:"Rewards"}),o(H,{variant:"success",onClick:I,children:o(Qc,{className:"fa-icon"})})]}),o(D,{gap:1,children:d&&d.map((L,M)=>g(P,{gap:1,children:[g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",checked:L.isBadge,onChange:b=>A(M,b.target.checked,L.itemCode,L.probability)}),o(y,{small:!0,children:"Badge?"})]}),o("input",{type:"text",className:"form-control form-control-sm",value:L.itemCode,onChange:b=>A(M,L.isBadge,b.target.value,L.probability),placeholder:"Item Code"}),o("input",{type:"number",className:"form-control form-control-sm",value:L.probability,onChange:b=>A(M,L.isBadge,L.itemCode,Number(b.target.value)),placeholder:"Probability"}),M>0&&o(H,{variant:"danger",onClick:b=>S(M),children:o(sm,{className:"fa-icon"})})]},M))})]})},mee=n=>{const[e,t]=_.useState(1),[s,r]=_.useState(1),[i,a]=_.useState(1),{trigger:l=null,setIntParams:c=null}=et(),u=()=>c([e,s,i]);return _.useEffect(()=>{l.intData.length>=2?(t(l.intData[0]),r(l.intData[1]),a(l.intData[2])):(t(1),r(1),a(1))},[l]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:u,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.setpoints",["points"],[e.toString()])}),o(ws,{className:"nitro-slider",min:1,max:100,value:e,onChange:h=>t(h)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.settimesingame",["times"],[s.toString()])}),o(ws,{className:"nitro-slider",min:1,max:10,value:s,onChange:h=>r(h)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.team")}),[1,2,3,4].map(h=>g(P,{gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"selectedTeam",id:`selectedTeam${h}`,checked:i===h,onChange:d=>a(h)}),o(y,{children:p("wiredfurni.params.team."+h)})]},h))]})]})},Eee=n=>{const[e,t]=_.useState(1),[s,r]=_.useState(1),{trigger:i=null,setIntParams:a=null}=et(),l=()=>a([e,s]);return _.useEffect(()=>{i.intData.length>=2?(t(i.intData[0]),r(i.intData[1])):(t(1),r(1))},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.setpoints",["points"],[e.toString()])}),o(ws,{className:"nitro-slider",min:1,max:100,value:e,onChange:c=>t(c)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.settimesingame",["times"],[s.toString()])}),o(ws,{className:"nitro-slider",min:1,max:10,value:s,onChange:c=>r(c)})]})]})},pee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.team")}),[1,2,3,4].map(a=>g(P,{gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"selectedTeam",id:`selectedTeam${a}`,checked:e===a,onChange:l=>t(a)}),o(y,{children:p(`wiredfurni.params.team.${a}`)})]},a))]})})},Iee=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.message")}),o("input",{type:"text",className:"form-control form-control-sm",value:e,onChange:a=>t(a.target.value),maxLength:ce("wired.action.kick.from.room.max.length",100)})]})})},Tee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!1,save:null}),Ree=[{value:0,icon:"ne"},{value:2,icon:"se"},{value:4,icon:"sw"},{value:6,icon:"nw"}],Oee=[0,1,2,3,4,5,6],See=n=>{const[e,t]=_.useState(-1),[s,r]=_.useState(-1),{trigger:i=null,setIntParams:a=null}=et(),l=()=>a([e,s]);return _.useEffect(()=>{i.intData.length>=2?(t(i.intData[0]),r(i.intData[1])):(t(-1),r(-1))},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.startdir")}),o(P,{gap:1,children:Ree.map(c=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"movement",id:`movement${c.value}`,checked:e===c.value,onChange:u=>t(c.value)}),o(y,{children:o("i",{className:`icon icon-${c.icon}`})})]},c.value))})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.turn")}),Oee.map(c=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"rotation",id:`rotation${c}`,checked:s===c,onChange:u=>r(c)}),o(y,{children:p(`wiredfurni.params.turn.${c}`)})]},c))]})]})},Cee=[{value:0,icon:"ne"},{value:2,icon:"se"},{value:4,icon:"sw"},{value:6,icon:"nw"}],Aee=n=>{const[e,t]=_.useState(-1),[s,r]=_.useState(-1),{trigger:i=null,setIntParams:a=null}=et(),l=()=>a([s,e]);return _.useEffect(()=>{i.intData.length>=2?(t(i.intData[1]),r(i.intData[0])):(t(-1),r(-1))},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.emptytiles",["tiles"],[e.toString()])}),o(ws,{className:"nitro-slider",min:1,max:5,value:e,onChange:c=>t(c)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.startdir")}),o(P,{gap:1,children:Cee.map(c=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"movement",id:`movement${c.value}`,checked:s===c.value,onChange:u=>r(c.value)}),o(y,{children:o("i",{className:`icon icon-${c.icon}`})})]},c.value))})]})]})},Nee=[{value:4,icon:"ne"},{value:5,icon:"se"},{value:6,icon:"sw"},{value:7,icon:"nw"},{value:2,icon:"mv-2"},{value:3,icon:"mv-3"},{value:1,icon:"mv-1"}],yee=[0,1,2,3],Mee=n=>{const[e,t]=_.useState(-1),[s,r]=_.useState(-1),{trigger:i=null,setIntParams:a=null}=et(),l=()=>a([e,s]);return _.useEffect(()=>{i.intData.length>=2?(t(i.intData[0]),r(i.intData[1])):(t(-1),r(-1))},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.movefurni")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"selectedTeam",id:"movement0",checked:e===0,onChange:c=>t(0)}),o(y,{children:p("wiredfurni.params.movefurni.0")})]}),g(P,{gap:1,children:[Nee.map(c=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"movement",id:`movement${c.value}`,checked:e===c.value,onChange:u=>t(c.value)}),o("i",{className:`icon icon-${c.icon}`})]},c.value)),o("div",{className:"col"})]})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.rotatefurni")}),yee.map(c=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"rotation",id:`rotation${c}`,checked:s===c,onChange:u=>r(c)}),g(y,{children:[[1,2].includes(c)&&o("i",{className:`icon icon-rot-${c}`}),p(`wiredfurni.params.rotatefurni.${c}`)]})]},c))]})]})},Dee=n=>{const[e,t]=_.useState(-1),[s,r]=_.useState(""),{trigger:i=null,setIntParams:a=null,setStringParam:l=null}=et(),c=()=>{a([e]),l(s)};return _.useEffect(()=>{t(i.intData.length>0?i.intData[0]:0),r(i.stringData)},[i]),g(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:c,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.length.minutes",["minutes"],[e.toString()])}),o(ws,{className:"nitro-slider",min:1,max:10,value:e,onChange:u=>t(u)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.message")}),o("input",{type:"text",className:"form-control form-control-sm",value:s,onChange:u=>r(u.target.value),maxLength:ce("wired.action.mute.user.max.length",100)})]})]})},vee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!1,save:null}),bee=n=>{const[e,t]=_.useState(0),[s,r]=_.useState(0),[i,a]=_.useState(0),{trigger:l=null,setIntParams:c=null}=et(),u=()=>c([e,s,i]);return _.useEffect(()=>{t(l.getBoolean(0)?1:0),r(l.getBoolean(1)?1:0),a(l.getBoolean(2)?1:0)},[l]),o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!0,save:u,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.conditions")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"stateFlag",checked:!!e,onChange:h=>t(h.target.checked?1:0)}),o(y,{children:p("wiredfurni.params.condition.state")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"directionFlag",checked:!!s,onChange:h=>r(h.target.checked?1:0)}),o(y,{children:p("wiredfurni.params.condition.direction")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"positionFlag",checked:!!i,onChange:h=>a(h.target.checked?1:0)}),o(y,{children:p("wiredfurni.params.condition.position")})]})]})})},Pee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!1,save:null}),Lee=n=>o(rs,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_BY_TYPE_OR_FROM_CONTEXT,hasSpecialInput:!1,save:null}),Uee=n=>{switch(n){case Ge.BOT_CHANGE_FIGURE:return o(ree,{});case Ge.BOT_FOLLOW_AVATAR:return o(iee,{});case Ge.BOT_GIVE_HAND_ITEM:return o(aee,{});case Ge.BOT_MOVE:return o(oee,{});case Ge.BOT_TALK:return o(cee,{});case Ge.BOT_TALK_DIRECT_TO_AVTR:return o(lee,{});case Ge.BOT_TELEPORT:return o(uee,{});case Ge.CALL_ANOTHER_STACK:return o(hee,{});case Ge.CHASE:return o(dee,{});case Ge.CHAT:return o(_ee,{});case Ge.FLEE:return o(gee,{});case Ge.GIVE_REWARD:return o(fee,{});case Ge.GIVE_SCORE:return o(Eee,{});case Ge.GIVE_SCORE_TO_PREDEFINED_TEAM:return o(mee,{});case Ge.JOIN_TEAM:return o(pee,{});case Ge.KICK_FROM_ROOM:return o(Iee,{});case Ge.LEAVE_TEAM:return o(Tee,{});case Ge.MOVE_FURNI:return o(Mee,{});case Ge.MOVE_AND_ROTATE_FURNI:return o(See,{});case Ge.MOVE_FURNI_TO:return o(Aee,{});case Ge.MUTE_USER:return o(Dee,{});case Ge.RESET:return o(vee,{});case Ge.SET_FURNI_STATE:return o(bee,{});case Ge.TELEPORT:return o(Pee,{});case Ge.TOGGLE_FURNI_STATE:return o(Lee,{})}return null},Nr=n=>{const{requiresFurni:e=Se.STUFF_SELECTION_OPTION_NONE,save:t=null,hasSpecialInput:s=!1,children:r=null}=n;return o(_p,{wiredType:"condition",requiresFurni:e,hasSpecialInput:s,save:()=>t&&t(),children:r})},Fee=[2,5,7,8,9,10,27],xee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.handitem")}),o("select",{className:"form-select form-select-sm",value:e,onChange:a=>t(parseInt(a.target.value)),children:Fee.map(a=>o("option",{value:a,children:p(`handitem${a}`)},a))})]})})},wee=n=>o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!1,save:null}),Gee=n=>o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!1,save:null}),Bee=[1,2,3,4],kee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.team")}),Bee.map(a=>g(P,{gap:1,alignItems:"center",children:[o("input",{className:"form-check-input",type:"radio",name:"selectedTeam",id:`selectedTeam${a}`,checked:e===a,onChange:l=>t(a)}),o(y,{children:p(`wiredfurni.params.team.${a}`)})]},a))]})})},Vee=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.badgecode")}),o("input",{type:"text",className:"form-control form-control-sm",value:e,onChange:a=>t(a.target.value)})]})})},Hee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t((s==null?void 0:s.intData[0])??0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.tooltip.effectid")}),o("input",{type:"number",className:"form-control form-control-sm",value:e,onChange:a=>t(parseInt(a.target.value))})]})})},jee=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(""),{trigger:i=null,setIntParams:a=null}=et(),l=()=>{let c=0,u=0;const h=new Date(e),d=new Date(s);h&&d&&(c=h.getTime()/1e3,u=d.getTime()/1e3),a([c,u])};return _.useEffect(()=>{if(i.intData.length>=2){let c=new Date,u=new Date;i.intData[0]>0&&(c=new Date(i.intData[0]*1e3)),i.intData[1]>0&&(u=new Date(i.intData[1]*1e3)),t(lI(c)),r(lI(u))}},[i]),g(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.startdate")}),o("input",{type:"text",className:"form-control form-control-sm",value:e,onChange:c=>t(c.target.value)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.enddate")}),o("input",{type:"text",className:"form-control form-control-sm",value:s,onChange:c=>r(c.target.value)})]})]})},Wee=n=>o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!1,save:null}),Yee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.requireall")}),[0,1].map(a=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"requireAll",id:`requireAll${a}`,checked:e===a,onChange:l=>t(a)}),o(y,{children:p("wiredfurni.params.requireall."+a)})]},a))]})})},zee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.not_requireall")}),[0,1].map(a=>g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"requireAll",id:`requireAll${a}`,checked:e===a,onChange:l=>t(a)}),o(y,{children:p(`wiredfurni.params.not_requireall.${a}`)})]},a))]})})},Kee=n=>o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE,hasSpecialInput:!1,save:null}),Xee=n=>{const[e,t]=_.useState(0),[s,r]=_.useState(0),[i,a]=_.useState(0),{trigger:l=null,setIntParams:c=null}=et(),u=()=>c([e,s,i]);return _.useEffect(()=>{t(l.getBoolean(0)?1:0),r(l.getBoolean(1)?1:0),a(l.getBoolean(2)?1:0)},[l]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID,hasSpecialInput:!0,save:u,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.conditions")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"stateFlag",checked:!!e,onChange:h=>t(h.target.checked?1:0)}),o(y,{children:p("wiredfurni.params.condition.state")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"directionFlag",checked:!!s,onChange:h=>r(h.target.checked?1:0)}),o(y,{children:p("wiredfurni.params.condition.direction")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"checkbox",id:"positionFlag",checked:!!i,onChange:h=>a(h.target.checked?1:0)}),o(y,{children:p("wiredfurni.params.condition.position")})]})]})})},qee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.allowbefore",["seconds"],[vu(e)])}),o(ws,{className:"nitro-slider",min:1,max:1200,value:e,onChange:a=>t(a)})]})})},Qee=n=>{const[e,t]=_.useState(-1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.allowafter",["seconds"],[vu(e)])}),o(ws,{className:"nitro-slider",min:1,max:1200,value:e,onChange:a=>t(a)})]})})},Jee=n=>{const[e,t]=_.useState(1),[s,r]=_.useState(1),{trigger:i=null,setIntParams:a=null}=et(),l=()=>a([e,s]);return _.useEffect(()=>{i.intData.length>=2?(t(i.intData[0]),r(i.intData[1])):(t(1),r(1))},[i]),g(Nr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:l,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.usercountmin",["value"],[e.toString()])}),o(ws,{className:"nitro-slider",min:1,max:50,value:e,onChange:c=>t(c)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.usercountmax",["value"],[s.toString()])}),o(ws,{className:"nitro-slider",min:1,max:50,value:s,onChange:c=>r(c)})]})]})},Zee=n=>{switch(n){case Ve.ACTOR_HAS_HANDITEM:return o(xee,{});case Ve.ACTOR_IS_GROUP_MEMBER:case Ve.NOT_ACTOR_IN_GROUP:return o(wee,{});case Ve.ACTOR_IS_ON_FURNI:case Ve.NOT_ACTOR_ON_FURNI:return o(Gee,{});case Ve.ACTOR_IS_IN_TEAM:case Ve.NOT_ACTOR_IN_TEAM:return o(kee,{});case Ve.ACTOR_IS_WEARING_BADGE:case Ve.NOT_ACTOR_WEARS_BADGE:return o(Vee,{});case Ve.ACTOR_IS_WEARING_EFFECT:case Ve.NOT_ACTOR_WEARING_EFFECT:return o(Hee,{});case Ve.DATE_RANGE_ACTIVE:return o(jee,{});case Ve.FURNIS_HAVE_AVATARS:case Ve.FURNI_NOT_HAVE_HABBO:return o(Wee,{});case Ve.HAS_STACKED_FURNIS:return o(Yee,{});case Ve.NOT_HAS_STACKED_FURNIS:return o(zee,{});case Ve.STUFF_TYPE_MATCHES:case Ve.NOT_FURNI_IS_OF_TYPE:return o(Kee,{});case Ve.STATES_MATCH:case Ve.NOT_STATES_MATCH:return o(Xee,{});case Ve.TIME_ELAPSED_LESS:return o(qee,{});case Ve.TIME_ELAPSED_MORE:return o(Qee,{});case Ve.USER_COUNT_IN:case Ve.NOT_USER_COUNT_IN:return o(Jee,{})}return null},Yr=n=>{const{requiresFurni:e=Se.STUFF_SELECTION_OPTION_NONE,save:t=null,hasSpecialInput:s=!1,children:r=null}=n;return o(_p,{wiredType:"trigger",requiresFurni:e,hasSpecialInput:s,save:()=>t&&t(),children:r})},$ee=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(0),{trigger:i=null,setStringParam:a=null}=et(),l=()=>a(s===1?e:"");return _.useEffect(()=>{t(i.stringData),r(i.stringData?1:0)},[i]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:l,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.picktriggerer")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"avatarMode",id:"avatarMode0",checked:s===0,onChange:c=>r(0)}),o(y,{children:p("wiredfurni.params.anyavatar")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"avatarMode",id:"avatarMode1",checked:s===1,onChange:c=>r(1)}),o(y,{children:p("wiredfurni.params.certainavatar")})]}),s===1&&o("input",{type:"text",className:"form-control form-control-sm",value:e,onChange:c=>t(c.target.value)})]})})},ete=n=>{const[e,t]=_.useState(""),[s,r]=_.useState(-1),{trigger:i=null,setStringParam:a=null,setIntParams:l=null}=et(),c=()=>{a(e),l([s])};return _.useEffect(()=>{t(i.stringData),r(i.intData.length>0?i.intData[0]:0)},[i]),g(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:c,children:[g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.whatissaid")}),o("input",{type:"text",className:"form-control form-control-sm",value:e,onChange:u=>t(u.target.value)})]}),g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.picktriggerer")}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"triggererAvatar",id:"triggererAvatar0",checked:s===0,onChange:u=>r(0)}),o(y,{children:p("wiredfurni.params.anyavatar")})]}),g(P,{alignItems:"center",gap:1,children:[o("input",{className:"form-check-input",type:"radio",name:"triggererAvatar",id:"triggererAvatar1",checked:s===1,onChange:u=>r(1)}),o(y,{children:$().userName})]})]})]})},tte=n=>o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE,hasSpecialInput:!1,save:null}),ste=n=>o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE,hasSpecialInput:!1,save:null}),rte=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:a=>t(a.target.value)})]})})},ite=n=>{const[e,t]=_.useState(""),{trigger:s=null,setStringParam:r=null}=et(),i=()=>r(e);return _.useEffect(()=>{t(s.stringData)},[s]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.bot.name")}),o("input",{type:"text",className:"form-control form-control-sm",maxLength:32,value:e,onChange:a=>t(a.target.value)})]})})},nte=n=>o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!1,save:null}),ate=n=>{const[e,t]=_.useState(1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.settime",["seconds"],[vu(e)])}),o(ws,{className:"nitro-slider",min:1,max:1200,value:e,onChange:a=>t(a)})]})})},ote=n=>{const[e,t]=_.useState(1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.setlongtime",["time"],[Jn.format(e*5).toString()])}),o(ws,{className:"nitro-slider",min:1,max:120,value:e,onChange:a=>t(a)})]})})},lte=n=>{const[e,t]=_.useState(1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.settime",["seconds"],[vu(e)])}),o(ws,{className:"nitro-slider",min:1,max:60,value:e,onChange:a=>t(a)})]})})},cte=n=>o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!1,save:null}),ute=n=>o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!1,save:null}),hte=n=>{const[e,t]=_.useState(1),{trigger:s=null,setIntParams:r=null}=et(),i=()=>r([e]);return _.useEffect(()=>{t(s.intData.length>0?s.intData[0]:0)},[s]),o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_NONE,hasSpecialInput:!0,save:i,children:g(D,{gap:1,children:[o(y,{bold:!0,children:p("wiredfurni.params.setscore",["points"],[e.toString()])}),o(ws,{className:"nitro-slider",min:1,max:1e3,value:e,onChange:a=>t(a)})]})})},dte=n=>o(Yr,{requiresFurni:Se.STUFF_SELECTION_OPTION_BY_ID_OR_BY_TYPE,hasSpecialInput:!1,save:null}),_te=n=>{switch(n){case zt.AVATAR_ENTERS_ROOM:return o($ee,{});case zt.AVATAR_SAYS_SOMETHING:return o(ete,{});case zt.AVATAR_WALKS_OFF_FURNI:return o(tte,{});case zt.AVATAR_WALKS_ON_FURNI:return o(ste,{});case zt.BOT_REACHED_AVATAR:return o(rte,{});case zt.BOT_REACHED_STUFF:return o(ite,{});case zt.COLLISION:return o(nte,{});case zt.EXECUTE_ONCE:return o(ate,{});case zt.EXECUTE_PERIODICALLY:return o(lte,{});case zt.EXECUTE_PERIODICALLY_LONG:return o(ote,{});case zt.GAME_ENDS:return o(cte,{});case zt.GAME_STARTS:return o(ute,{});case zt.SCORE_ACHIEVED:return o(hte,{});case zt.TOGGLE_FURNI:return o(dte,{})}return null},gte=n=>{const{trigger:e=null}=et();return e?e instanceof bm?Uee(e.code):e instanceof vm?_te(e.code):e instanceof Dm?Zee(e.code):null:null};function fte({username:n,figure:e,bankBalance:t,cashBalance:s,healthMaximum:r,healthCurrent:i,energyMaximum:a,energyCurrent:l}){return o("div",{className:"nitro-roleplay-stats-container",children:g("div",{className:"nitro-roleplay-stats rounded-bottom p-1",children:[g("div",{className:"nitro-roleplay-user",children:[o("div",{className:"nitro-roleplay-avatar",children:o(as,{className:"avatar",figure:e,direction:2})}),o(y,{bold:!0,center:!0,fontSize:5,variant:"white",children:n})]}),g("div",{className:"p-2 rounded",children:[o(y,{bold:!0,variant:"light",children:p("roleplay.stats.bank")}),o("div",{className:"nitro-stats-item",children:g(y,{bold:!0,variant:"white",children:["$",t]})})]}),g("div",{className:"p-2 rounded",children:[o(y,{bold:!0,variant:"light",children:p("roleplay.stats.cash")}),o("div",{className:"nitro-stats-item",children:g(y,{bold:!0,variant:"white",children:["$",s]})})]}),g("div",{className:"p-2 rounded",children:[o(y,{bold:!0,variant:"light",children:p("roleplay.stats.health")}),o("progress",{value:i,max:r})]}),g("div",{className:"p-2 rounded",children:[o(y,{bold:!0,variant:"light",children:p("roleplay.stats.energy")}),o("progress",{value:l,max:a})]})]})})}function mte(){const{userFigure:n=null,userInfo:e}=za(),{getCurrencyAmount:t}=ko();return o(fte,{username:(e==null?void 0:e.username)??"-",figure:n??"-",bankBalance:0,cashBalance:t(-1),healthCurrent:100,healthMaximum:100,energyCurrent:100,energyMaximum:100})}function Ete(){return null}function pte(){return g(X,{children:[o(mte,{}),o(Ete,{})]})}function Ite(){return o("div",{className:"nitro-left-side",children:o(D,{position:"relative",gap:1,children:o(pte,{})})})}const Tte=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(!0);return kt(Ne.CREATED,i=>r(!1)),kt(Ne.ENDED,i=>r(i.openLandingView)),_.useEffect(()=>{t(!0),Wc().connection.onReady()},[]),_.useEffect(()=>{const i={linkReceived:a=>{const l=a.split("/");if(!(l.length<2))switch(l[1]){case"open":if(l.length>2)switch(l[2]){case"credits":break;default:{const c=l[2];ra.openHabblet(c)}}return}},eventUrlPrefix:"habblet/"};return Cs(i),()=>As(i)},[]),g(j,{fit:!0,children:[o(K$,{isInRoom:!s}),o(DJ,{}),o(Y$,{}),o(tQ,{}),o(gte,{}),o(a9,{}),o(J8,{}),o(WJ,{}),o(gJ,{}),o(eQ,{}),o(AQ,{}),o(Ite,{}),o(_Z,{}),o(eee,{}),o($$,{}),o(GQ,{}),o(_9,{}),o(rJ,{}),o(zJ,{}),o(BQ,{}),o(m9,{}),o(dQ,{})]})};Id.UI_VERSION=CP();const Rte=n=>{const[e,t]=_.useState(!1),[s,r]=_.useState(!1),[i,a]=_.useState("Getting Ready"),[l,c]=_.useState(0),[u,h]=_.useState(!0);if(!ze()){if(!NitroConfig)throw new Error("NitroConfig is not defined!");pe.bootstrap()}const d=_.useCallback(async f=>{switch(f.type){case _i.LOADED:ze().localization.init(),c(E=>E+20);return;case _i.FAILED:r(!0),a("Configuration Failed");return;case pe.WEBGL_UNAVAILABLE:r(!0),a("WebGL Required");return;case pe.WEBGL_CONTEXT_LOST:r(!0),a("WebGL Context Lost - Reloading"),setTimeout(()=>window.location.reload(),1500);return;case Qt.CONNECTION_HANDSHAKING:c(E=>E+20);return;case Qt.CONNECTION_HANDSHAKE_FAILED:r(!0),a("Handshake Failed");return;case Qt.CONNECTION_AUTHENTICATED:c(E=>E+20),ze().init(),Je.available&&Je.call("legacyTrack","authentication","authok",[]);return;case Qt.CONNECTION_ERROR:r(!0),a("Connection Error");return;case Qt.CONNECTION_CLOSED:a("Connection Error"),ra.send(-1,"client.init.handshake.fail");return;case je.ENGINE_INITIALIZED:c(E=>E+20),setTimeout(()=>t(!0),300);return;case Ca.LOADED:{const E=ce("preload.assets.urls"),m=[];if(E&&E.length)for(const I of E)m.push(Ue.interpolate(I));await Fr().downloadAssets(m)?(Wc().init(),c(I=>I+20)):(r(!0),a("Assets Failed"));return}}},[]);return eo(pe.WEBGL_UNAVAILABLE,d),eo(pe.WEBGL_CONTEXT_LOST,d),eo(Qt.CONNECTION_HANDSHAKING,d),eo(Qt.CONNECTION_HANDSHAKE_FAILED,d),eo(Qt.CONNECTION_AUTHENTICATED,d),eo(Qt.CONNECTION_ERROR,d),eo(Qt.CONNECTION_CLOSED,d),$e(je.ENGINE_INITIALIZED,d),kq(Ca.LOADED,d),hI(_i.LOADED,d),hI(_i.FAILED,d),_.useEffect(()=>{ze().core.configuration.init();const f=E=>h(!(window.devicePixelRatio%1));return window.addEventListener("resize",f),f(),()=>{window.removeEventListener("resize",f)}},[]),g(j,{fit:!0,overflow:"hidden",className:u&&"image-rendering-pixelated",children:[(!e||s)&&o(Gq,{isError:s,message:i,percent:l}),o(h_,{type:vs.FADE_IN,inProp:e,children:o(Tte,{})}),o(j,{id:"draggable-windows-container"})]})};bU(document.getElementById("root")).render(o(Rte,{}));
